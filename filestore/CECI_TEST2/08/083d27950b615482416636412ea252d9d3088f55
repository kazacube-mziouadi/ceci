
/* /web/static/lib/jquery.validate/jquery.validate.js defined in bundle 'web.assets_backend' */
(function(factory){if(typeof define==="function"&&define.amd){define(["jquery"],factory);}else{factory(jQuery);}}(function($){$.extend($.fn,{validate:function(options){if(!this.length){if(options&&options.debug&&window.console){console.warn("Nothing selected, can't validate, returning nothing.");}
return;}
var validator=$.data(this[0],"validator");if(validator){return validator;}
this.attr("novalidate","novalidate");validator=new $.validator(options,this[0]);$.data(this[0],"validator",validator);if(validator.settings.onsubmit){this.validateDelegate(":submit","click",function(event){if(validator.settings.submitHandler){validator.submitButton=event.target;}
if($(event.target).hasClass("cancel")){validator.cancelSubmit=true;}
if($(event.target).attr("formnovalidate")!==undefined){validator.cancelSubmit=true;}});this.submit(function(event){if(validator.settings.debug){event.preventDefault();}
function handle(){var hidden,result;if(validator.settings.submitHandler){if(validator.submitButton){hidden=$("<input type='hidden'/>").attr("name",validator.submitButton.name).val($(validator.submitButton).val()).appendTo(validator.currentForm);}
result=validator.settings.submitHandler.call(validator,validator.currentForm,event);if(validator.submitButton){hidden.remove();}
if(result!==undefined){return result;}
return false;}
return true;}
if(validator.cancelSubmit){validator.cancelSubmit=false;return handle();}
if(validator.form()){if(validator.pendingRequest){validator.formSubmitted=true;return false;}
return handle();}else{validator.focusInvalid();return false;}});}
return validator;},valid:function(){var valid,validator;if($(this[0]).is("form")){valid=this.validate().form();}else{valid=true;validator=$(this[0].form).validate();this.each(function(){valid=validator.element(this)&&valid;});}
return valid;},removeAttrs:function(attributes){var result={},$element=this;$.each(attributes.split(/\s/),function(index,value){result[value]=$element.attr(value);$element.removeAttr(value);});return result;},rules:function(command,argument){var element=this[0],settings,staticRules,existingRules,data,param,filtered;if(command){settings=$.data(element.form,"validator").settings;staticRules=settings.rules;existingRules=$.validator.staticRules(element);switch(command){case"add":$.extend(existingRules,$.validator.normalizeRule(argument));delete existingRules.messages;staticRules[element.name]=existingRules;if(argument.messages){settings.messages[element.name]=$.extend(settings.messages[element.name],argument.messages);}
break;case"remove":if(!argument){delete staticRules[element.name];return existingRules;}
filtered={};$.each(argument.split(/\s/),function(index,method){filtered[method]=existingRules[method];delete existingRules[method];if(method==="required"){$(element).removeAttr("aria-required");}});return filtered;}}
data=$.validator.normalizeRules($.extend({},$.validator.classRules(element),$.validator.attributeRules(element),$.validator.dataRules(element),$.validator.staticRules(element)),element);if(data.required){param=data.required;delete data.required;data=$.extend({required:param},data);$(element).attr("aria-required","true");}
if(data.remote){param=data.remote;delete data.remote;data=$.extend(data,{remote:param});}
return data;}});$.extend($.expr[":"],{blank:function(a){return!$.trim(""+$(a).val());},filled:function(a){return!!$.trim(""+$(a).val());},unchecked:function(a){return!$(a).prop("checked");}});$.validator=function(options,form){this.settings=$.extend(true,{},$.validator.defaults,options);this.currentForm=form;this.init();};$.validator.format=function(source,params){if(arguments.length===1){return function(){var args=$.makeArray(arguments);args.unshift(source);return $.validator.format.apply(this,args);};}
if(arguments.length>2&&params.constructor!==Array){params=$.makeArray(arguments).slice(1);}
if(params.constructor!==Array){params=[params];}
$.each(params,function(i,n){source=source.replace(new RegExp("\\{"+i+"\\}","g"),function(){return n;});});return source;};$.extend($.validator,{defaults:{messages:{},groups:{},rules:{},errorClass:"error",validClass:"valid",errorElement:"label",focusCleanup:false,focusInvalid:true,errorContainer:$([]),errorLabelContainer:$([]),onsubmit:true,ignore:":hidden",ignoreTitle:false,onfocusin:function(element){this.lastActive=element;if(this.settings.focusCleanup){if(this.settings.unhighlight){this.settings.unhighlight.call(this,element,this.settings.errorClass,this.settings.validClass);}
this.hideThese(this.errorsFor(element));}},onfocusout:function(element){if(!this.checkable(element)&&(element.name in this.submitted||!this.optional(element))){this.element(element);}},onkeyup:function(element,event){if(event.which===9&&this.elementValue(element)===""){return;}else if(element.name in this.submitted||element===this.lastElement){this.element(element);}},onclick:function(element){if(element.name in this.submitted){this.element(element);}else if(element.parentNode.name in this.submitted){this.element(element.parentNode);}},highlight:function(element,errorClass,validClass){if(element.type==="radio"){this.findByName(element.name).addClass(errorClass).removeClass(validClass);}else{$(element).addClass(errorClass).removeClass(validClass);}},unhighlight:function(element,errorClass,validClass){if(element.type==="radio"){this.findByName(element.name).removeClass(errorClass).addClass(validClass);}else{$(element).removeClass(errorClass).addClass(validClass);}}},setDefaults:function(settings){$.extend($.validator.defaults,settings);},messages:{required:"This field is required.",remote:"Please fix this field.",email:"Please enter a valid email address.",url:"Please enter a valid URL.",date:"Please enter a valid date.",dateISO:"Please enter a valid date ( ISO ).",number:"Please enter a valid number.",digits:"Please enter only digits.",creditcard:"Please enter a valid credit card number.",equalTo:"Please enter the same value again.",maxlength:$.validator.format("Please enter no more than {0} characters."),minlength:$.validator.format("Please enter at least {0} characters."),rangelength:$.validator.format("Please enter a value between {0} and {1} characters long."),range:$.validator.format("Please enter a value between {0} and {1}."),max:$.validator.format("Please enter a value less than or equal to {0}."),min:$.validator.format("Please enter a value greater than or equal to {0}.")},autoCreateRanges:false,prototype:{init:function(){this.labelContainer=$(this.settings.errorLabelContainer);this.errorContext=this.labelContainer.length&&this.labelContainer||$(this.currentForm);this.containers=$(this.settings.errorContainer).add(this.settings.errorLabelContainer);this.submitted={};this.valueCache={};this.pendingRequest=0;this.pending={};this.invalid={};this.reset();var groups=(this.groups={}),rules;$.each(this.settings.groups,function(key,value){if(typeof value==="string"){value=value.split(/\s/);}
$.each(value,function(index,name){groups[name]=key;});});rules=this.settings.rules;$.each(rules,function(key,value){rules[key]=$.validator.normalizeRule(value);});function delegate(event){var validator=$.data(this[0].form,"validator"),eventType="on"+event.type.replace(/^validate/,""),settings=validator.settings;if(settings[eventType]&&!this.is(settings.ignore)){settings[eventType].call(validator,this[0],event);}}
$(this.currentForm).validateDelegate(":text, [type='password'], [type='file'], select, textarea, "+"[type='number'], [type='search'] ,[type='tel'], [type='url'], "+"[type='email'], [type='datetime'], [type='date'], [type='month'], "+"[type='week'], [type='time'], [type='datetime-local'], "+"[type='range'], [type='color'], [type='radio'], [type='checkbox']","focusin focusout keyup",delegate).validateDelegate("select, option, [type='radio'], [type='checkbox']","click",delegate);if(this.settings.invalidHandler){$(this.currentForm).bind("invalid-form.validate",this.settings.invalidHandler);}
$(this.currentForm).find("[required], [data-rule-required], .required").attr("aria-required","true");},form:function(){this.checkForm();$.extend(this.submitted,this.errorMap);this.invalid=$.extend({},this.errorMap);if(!this.valid()){$(this.currentForm).triggerHandler("invalid-form",[this]);}
this.showErrors();return this.valid();},checkForm:function(){this.prepareForm();for(var i=0,elements=(this.currentElements=this.elements());elements[i];i++){this.check(elements[i]);}
return this.valid();},element:function(element){var cleanElement=this.clean(element),checkElement=this.validationTargetFor(cleanElement),result=true;this.lastElement=checkElement;if(checkElement===undefined){delete this.invalid[cleanElement.name];}else{this.prepareElement(checkElement);this.currentElements=$(checkElement);result=this.check(checkElement)!==false;if(result){delete this.invalid[checkElement.name];}else{this.invalid[checkElement.name]=true;}}
$(element).attr("aria-invalid",!result);if(!this.numberOfInvalids()){this.toHide=this.toHide.add(this.containers);}
this.showErrors();return result;},showErrors:function(errors){if(errors){$.extend(this.errorMap,errors);this.errorList=[];for(var name in errors){this.errorList.push({message:errors[name],element:this.findByName(name)[0]});}
this.successList=$.grep(this.successList,function(element){return!(element.name in errors);});}
if(this.settings.showErrors){this.settings.showErrors.call(this,this.errorMap,this.errorList);}else{this.defaultShowErrors();}},resetForm:function(){if($.fn.resetForm){$(this.currentForm).resetForm();}
this.submitted={};this.lastElement=null;this.prepareForm();this.hideErrors();this.elements().removeClass(this.settings.errorClass).removeData("previousValue").removeAttr("aria-invalid");},numberOfInvalids:function(){return this.objectLength(this.invalid);},objectLength:function(obj){var count=0,i;for(i in obj){count++;}
return count;},hideErrors:function(){this.hideThese(this.toHide);},hideThese:function(errors){errors.not(this.containers).text("");this.addWrapper(errors).hide();},valid:function(){return this.size()===0;},size:function(){return this.errorList.length;},focusInvalid:function(){if(this.settings.focusInvalid){try{$(this.findLastActive()||this.errorList.length&&this.errorList[0].element||[]).filter(":visible").focus().trigger("focusin");}catch(e){}}},findLastActive:function(){var lastActive=this.lastActive;return lastActive&&$.grep(this.errorList,function(n){return n.element.name===lastActive.name;}).length===1&&lastActive;},elements:function(){var validator=this,rulesCache={};return $(this.currentForm).find("input, select, textarea").not(":submit, :reset, :image, [disabled], [readonly]").not(this.settings.ignore).filter(function(){if(!this.name&&validator.settings.debug&&window.console){console.error("%o has no name assigned",this);}
if(this.name in rulesCache||!validator.objectLength($(this).rules())){return false;}
rulesCache[this.name]=true;return true;});},clean:function(selector){return $(selector)[0];},errors:function(){var errorClass=this.settings.errorClass.split(" ").join(".");return $(this.settings.errorElement+"."+errorClass,this.errorContext);},reset:function(){this.successList=[];this.errorList=[];this.errorMap={};this.toShow=$([]);this.toHide=$([]);this.currentElements=$([]);},prepareForm:function(){this.reset();this.toHide=this.errors().add(this.containers);},prepareElement:function(element){this.reset();this.toHide=this.errorsFor(element);},elementValue:function(element){var val,$element=$(element),type=element.type;if(type==="radio"||type==="checkbox"){return $("input[name='"+element.name+"']:checked").val();}else if(type==="number"&&typeof element.validity!=="undefined"){return element.validity.badInput?false:$element.val();}
val=$element.val();if(typeof val==="string"){return val.replace(/\r/g,"");}
return val;},check:function(element){element=this.validationTargetFor(this.clean(element));var rules=$(element).rules(),rulesCount=$.map(rules,function(n,i){return i;}).length,dependencyMismatch=false,val=this.elementValue(element),result,method,rule;for(method in rules){rule={method:method,parameters:rules[method]};try{result=$.validator.methods[method].call(this,val,element,rule.parameters);if(result==="dependency-mismatch"&&rulesCount===1){dependencyMismatch=true;continue;}
dependencyMismatch=false;if(result==="pending"){this.toHide=this.toHide.not(this.errorsFor(element));return;}
if(!result){this.formatAndAdd(element,rule);return false;}}catch(e){if(this.settings.debug&&window.console){console.log("Exception occurred when checking element "+element.id+", check the '"+rule.method+"' method.",e);}
throw e;}}
if(dependencyMismatch){return;}
if(this.objectLength(rules)){this.successList.push(element);}
return true;},customDataMessage:function(element,method){return $(element).data("msg"+method.charAt(0).toUpperCase()+
method.substring(1).toLowerCase())||$(element).data("msg");},customMessage:function(name,method){var m=this.settings.messages[name];return m&&(m.constructor===String?m:m[method]);},findDefined:function(){for(var i=0;i<arguments.length;i++){if(arguments[i]!==undefined){return arguments[i];}}
return undefined;},defaultMessage:function(element,method){return this.findDefined(this.customMessage(element.name,method),this.customDataMessage(element,method),!this.settings.ignoreTitle&&element.title||undefined,$.validator.messages[method],"<strong>Warning: No message defined for "+element.name+"</strong>");},formatAndAdd:function(element,rule){var message=this.defaultMessage(element,rule.method),theregex=/\$?\{(\d+)\}/g;if(typeof message==="function"){message=message.call(this,rule.parameters,element);}else if(theregex.test(message)){message=$.validator.format(message.replace(theregex,"{$1}"),rule.parameters);}
this.errorList.push({message:message,element:element,method:rule.method});this.errorMap[element.name]=message;this.submitted[element.name]=message;},addWrapper:function(toToggle){if(this.settings.wrapper){toToggle=toToggle.add(toToggle.parent(this.settings.wrapper));}
return toToggle;},defaultShowErrors:function(){var i,elements,error;for(i=0;this.errorList[i];i++){error=this.errorList[i];if(this.settings.highlight){this.settings.highlight.call(this,error.element,this.settings.errorClass,this.settings.validClass);}
this.showLabel(error.element,error.message);}
if(this.errorList.length){this.toShow=this.toShow.add(this.containers);}
if(this.settings.success){for(i=0;this.successList[i];i++){this.showLabel(this.successList[i]);}}
if(this.settings.unhighlight){for(i=0,elements=this.validElements();elements[i];i++){this.settings.unhighlight.call(this,elements[i],this.settings.errorClass,this.settings.validClass);}}
this.toHide=this.toHide.not(this.toShow);this.hideErrors();this.addWrapper(this.toShow).show();},validElements:function(){return this.currentElements.not(this.invalidElements());},invalidElements:function(){return $(this.errorList).map(function(){return this.element;});},showLabel:function(element,message){var place,group,errorID,error=this.errorsFor(element),elementID=this.idOrName(element),describedBy=$(element).attr("aria-describedby");if(error.length){error.removeClass(this.settings.validClass).addClass(this.settings.errorClass);error.html(message);}else{error=$("<"+this.settings.errorElement+">").attr("id",elementID+"-error").addClass(this.settings.errorClass).html(message||"");place=error;if(this.settings.wrapper){place=error.hide().show().wrap("<"+this.settings.wrapper+"/>").parent();}
if(this.labelContainer.length){this.labelContainer.append(place);}else if(this.settings.errorPlacement){this.settings.errorPlacement(place,$(element));}else{place.insertAfter(element);}
if(error.is("label")){error.attr("for",elementID);}else if(error.parents("label[for='"+elementID+"']").length===0){errorID=error.attr("id").replace(/(:|\.|\[|\])/g,"\\$1");if(!describedBy){describedBy=errorID;}else if(!describedBy.match(new RegExp("\\b"+errorID+"\\b"))){describedBy+=" "+errorID;}
$(element).attr("aria-describedby",describedBy);group=this.groups[element.name];if(group){$.each(this.groups,function(name,testgroup){if(testgroup===group){$("[name='"+name+"']",this.currentForm).attr("aria-describedby",error.attr("id"));}});}}}
if(!message&&this.settings.success){error.text("");if(typeof this.settings.success==="string"){error.addClass(this.settings.success);}else{this.settings.success(error,element);}}
this.toShow=this.toShow.add(error);},errorsFor:function(element){var name=this.idOrName(element),describer=$(element).attr("aria-describedby"),selector="label[for='"+name+"'], label[for='"+name+"'] *";if(describer){selector=selector+", #"+describer.replace(/\s+/g,", #");}
return this.errors().filter(selector);},idOrName:function(element){return this.groups[element.name]||(this.checkable(element)?element.name:element.id||element.name);},validationTargetFor:function(element){if(this.checkable(element)){element=this.findByName(element.name);}
return $(element).not(this.settings.ignore)[0];},checkable:function(element){return(/radio|checkbox/i).test(element.type);},findByName:function(name){return $(this.currentForm).find("[name='"+name+"']");},getLength:function(value,element){switch(element.nodeName.toLowerCase()){case"select":return $("option:selected",element).length;case"input":if(this.checkable(element)){return this.findByName(element.name).filter(":checked").length;}}
return value.length;},depend:function(param,element){return this.dependTypes[typeof param]?this.dependTypes[typeof param](param,element):true;},dependTypes:{"boolean":function(param){return param;},"string":function(param,element){return!!$(param,element.form).length;},"function":function(param,element){return param(element);}},optional:function(element){var val=this.elementValue(element);return!$.validator.methods.required.call(this,val,element)&&"dependency-mismatch";},startRequest:function(element){if(!this.pending[element.name]){this.pendingRequest++;this.pending[element.name]=true;}},stopRequest:function(element,valid){this.pendingRequest--;if(this.pendingRequest<0){this.pendingRequest=0;}
delete this.pending[element.name];if(valid&&this.pendingRequest===0&&this.formSubmitted&&this.form()){$(this.currentForm).submit();this.formSubmitted=false;}else if(!valid&&this.pendingRequest===0&&this.formSubmitted){$(this.currentForm).triggerHandler("invalid-form",[this]);this.formSubmitted=false;}},previousValue:function(element){return $.data(element,"previousValue")||$.data(element,"previousValue",{old:null,valid:true,message:this.defaultMessage(element,"remote")});}},classRuleSettings:{required:{required:true},email:{email:true},url:{url:true},date:{date:true},dateISO:{dateISO:true},number:{number:true},digits:{digits:true},creditcard:{creditcard:true}},addClassRules:function(className,rules){if(className.constructor===String){this.classRuleSettings[className]=rules;}else{$.extend(this.classRuleSettings,className);}},classRules:function(element){var rules={},classes=$(element).attr("class");if(classes){$.each(classes.split(" "),function(){if(this in $.validator.classRuleSettings){$.extend(rules,$.validator.classRuleSettings[this]);}});}
return rules;},attributeRules:function(element){var rules={},$element=$(element),type=element.getAttribute("type"),method,value;for(method in $.validator.methods){if(method==="required"){value=element.getAttribute(method);if(value===""){value=true;}
value=!!value;}else{value=$element.attr(method);}
if(/min|max/.test(method)&&(type===null||/number|range|text/.test(type))){value=Number(value);}
if(value||value===0){rules[method]=value;}else if(type===method&&type!=="range"){rules[method]=true;}}
if(rules.maxlength&&/-1|2147483647|524288/.test(rules.maxlength)){delete rules.maxlength;}
return rules;},dataRules:function(element){var method,value,rules={},$element=$(element);for(method in $.validator.methods){value=$element.data("rule"+method.charAt(0).toUpperCase()+method.substring(1).toLowerCase());if(value!==undefined){rules[method]=value;}}
return rules;},staticRules:function(element){var rules={},validator=$.data(element.form,"validator");if(validator.settings.rules){rules=$.validator.normalizeRule(validator.settings.rules[element.name])||{};}
return rules;},normalizeRules:function(rules,element){$.each(rules,function(prop,val){if(val===false){delete rules[prop];return;}
if(val.param||val.depends){var keepRule=true;switch(typeof val.depends){case"string":keepRule=!!$(val.depends,element.form).length;break;case"function":keepRule=val.depends.call(element,element);break;}
if(keepRule){rules[prop]=val.param!==undefined?val.param:true;}else{delete rules[prop];}}});$.each(rules,function(rule,parameter){rules[rule]=$.isFunction(parameter)?parameter(element):parameter;});$.each(["minlength","maxlength"],function(){if(rules[this]){rules[this]=Number(rules[this]);}});$.each(["rangelength","range"],function(){var parts;if(rules[this]){if($.isArray(rules[this])){rules[this]=[Number(rules[this][0]),Number(rules[this][1])];}else if(typeof rules[this]==="string"){parts=rules[this].replace(/[\[\]]/g,"").split(/[\s,]+/);rules[this]=[Number(parts[0]),Number(parts[1])];}}});if($.validator.autoCreateRanges){if(rules.min!=null&&rules.max!=null){rules.range=[rules.min,rules.max];delete rules.min;delete rules.max;}
if(rules.minlength!=null&&rules.maxlength!=null){rules.rangelength=[rules.minlength,rules.maxlength];delete rules.minlength;delete rules.maxlength;}}
return rules;},normalizeRule:function(data){if(typeof data==="string"){var transformed={};$.each(data.split(/\s/),function(){transformed[this]=true;});data=transformed;}
return data;},addMethod:function(name,method,message){$.validator.methods[name]=method;$.validator.messages[name]=message!==undefined?message:$.validator.messages[name];if(method.length<3){$.validator.addClassRules(name,$.validator.normalizeRule(name));}},methods:{required:function(value,element,param){if(!this.depend(param,element)){return"dependency-mismatch";}
if(element.nodeName.toLowerCase()==="select"){var val=$(element).val();return val&&val.length>0;}
if(this.checkable(element)){return this.getLength(value,element)>0;}
return $.trim(value).length>0;},email:function(value,element){return this.optional(element)||/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.test(value);},url:function(value,element){return this.optional(element)||/^(https?|s?ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(value);},date:function(value,element){return this.optional(element)||!/Invalid|NaN/.test(new Date(value).toString());},dateISO:function(value,element){return this.optional(element)||/^\d{4}[\/\-](0?[1-9]|1[012])[\/\-](0?[1-9]|[12][0-9]|3[01])$/.test(value);},number:function(value,element){return this.optional(element)||/^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/.test(value);},digits:function(value,element){return this.optional(element)||/^\d+$/.test(value);},creditcard:function(value,element){if(this.optional(element)){return"dependency-mismatch";}
if(/[^0-9 \-]+/.test(value)){return false;}
var nCheck=0,nDigit=0,bEven=false,n,cDigit;value=value.replace(/\D/g,"");if(value.length<13||value.length>19){return false;}
for(n=value.length-1;n>=0;n--){cDigit=value.charAt(n);nDigit=parseInt(cDigit,10);if(bEven){if((nDigit*=2)>9){nDigit-=9;}}
nCheck+=nDigit;bEven=!bEven;}
return(nCheck%10)===0;},minlength:function(value,element,param){var length=$.isArray(value)?value.length:this.getLength(value,element);return this.optional(element)||length>=param;},maxlength:function(value,element,param){var length=$.isArray(value)?value.length:this.getLength(value,element);return this.optional(element)||length<=param;},rangelength:function(value,element,param){var length=$.isArray(value)?value.length:this.getLength(value,element);return this.optional(element)||(length>=param[0]&&length<=param[1]);},min:function(value,element,param){return this.optional(element)||value>=param;},max:function(value,element,param){return this.optional(element)||value<=param;},range:function(value,element,param){return this.optional(element)||(value>=param[0]&&value<=param[1]);},equalTo:function(value,element,param){var target=$(param);if(this.settings.onfocusout){target.unbind(".validate-equalTo").bind("blur.validate-equalTo",function(){$(element).valid();});}
return value===target.val();},remote:function(value,element,param){if(this.optional(element)){return"dependency-mismatch";}
var previous=this.previousValue(element),validator,data;if(!this.settings.messages[element.name]){this.settings.messages[element.name]={};}
previous.originalMessage=this.settings.messages[element.name].remote;this.settings.messages[element.name].remote=previous.message;param=typeof param==="string"&&{url:param}||param;if(previous.old===value){return previous.valid;}
previous.old=value;validator=this;this.startRequest(element);data={};data[element.name]=value;$.ajax($.extend(true,{url:param,mode:"abort",port:"validate"+element.name,dataType:"json",data:data,context:validator.currentForm,success:function(response){var valid=response===true||response==="true",errors,message,submitted;validator.settings.messages[element.name].remote=previous.originalMessage;if(valid){submitted=validator.formSubmitted;validator.prepareElement(element);validator.formSubmitted=submitted;validator.successList.push(element);delete validator.invalid[element.name];validator.showErrors();}else{errors={};message=response||validator.defaultMessage(element,"remote");errors[element.name]=previous.message=$.isFunction(message)?message(value):message;validator.invalid[element.name]=true;validator.showErrors(errors);}
previous.valid=valid;validator.stopRequest(element,valid);}},param));return"pending";}}});$.format=function deprecated(){throw"$.format has been deprecated. Please use $.validator.format instead.";};var pendingRequests={},ajax;if($.ajaxPrefilter){$.ajaxPrefilter(function(settings,_,xhr){var port=settings.port;if(settings.mode==="abort"){if(pendingRequests[port]){pendingRequests[port].abort();}
pendingRequests[port]=xhr;}});}else{ajax=$.ajax;$.ajax=function(settings){var mode=("mode"in settings?settings:$.ajaxSettings).mode,port=("port"in settings?settings:$.ajaxSettings).port;if(mode==="abort"){if(pendingRequests[port]){pendingRequests[port].abort();}
pendingRequests[port]=ajax.apply(this,arguments);return pendingRequests[port];}
return ajax.apply(this,arguments);};}
$.extend($.fn,{validateDelegate:function(delegate,type,handler){return this.bind(type,function(event){var target=$(event.target);if(target.is(delegate)){return handler.apply(target,arguments);}});}});}));;

/* /web/static/lib/jquery.scrollTo/jquery.scrollTo.js defined in bundle 'web.assets_backend' */
;(function(define){'use strict';define(['jquery'],function($){var $scrollTo=$.scrollTo=function(target,duration,settings){return $(window).scrollTo(target,duration,settings);};$scrollTo.defaults={axis:'xy',duration:0,limit:true};$scrollTo.window=function(scope){return $(window)._scrollable();};$.fn._scrollable=function(){return this.map(function(){var elem=this,isWin=!elem.nodeName||$.inArray(elem.nodeName.toLowerCase(),['iframe','#document','html','body'])!=-1;if(!isWin)
return elem;var doc=(elem.contentWindow||elem).document||elem.ownerDocument||elem;return/webkit/i.test(navigator.userAgent)||doc.compatMode=='BackCompat'?doc.body:doc.documentElement;});};$.fn.scrollTo=function(target,duration,settings){if(typeof duration=='object'){settings=duration;duration=0;}
if(typeof settings=='function')
settings={onAfter:settings};if(target=='max')
target=9e9;settings=$.extend({},$scrollTo.defaults,settings);duration=duration||settings.duration;settings.queue=settings.queue&&settings.axis.length>1;if(settings.queue)
duration/=2;settings.offset=both(settings.offset);settings.over=both(settings.over);return this._scrollable().each(function(){if(target==null)return;var elem=this,$elem=$(elem),targ=target,toff,attr={},win=$elem.is('html,body');switch(typeof targ){case'number':case'string':if(/^([+-]=?)?\d+(\.\d+)?(px|%)?$/.test(targ)){targ=both(targ);break;}
targ=win?$(targ):$(targ,this);if(!targ.length)return;case'object':if(targ.is||targ.style)
toff=(targ=$(targ)).offset();}
var offset=$.isFunction(settings.offset)&&settings.offset(elem,targ)||settings.offset;$.each(settings.axis.split(''),function(i,axis){var Pos=axis=='x'?'Left':'Top',pos=Pos.toLowerCase(),key='scroll'+Pos,old=elem[key],max=$scrollTo.max(elem,axis);if(toff){attr[key]=toff[pos]+(win?0:old-$elem.offset()[pos]);if(settings.margin){attr[key]-=parseInt(targ.css('margin'+Pos))||0;attr[key]-=parseInt(targ.css('border'+Pos+'Width'))||0;}
attr[key]+=offset[pos]||0;if(settings.over[pos])
attr[key]+=targ[axis=='x'?'width':'height']()*settings.over[pos];}else{var val=targ[pos];attr[key]=val.slice&&val.slice(-1)=='%'?parseFloat(val)/100*max:val;}
if(settings.limit&&/^\d+$/.test(attr[key]))
attr[key]=attr[key]<=0?0:Math.min(attr[key],max);if(!i&&settings.queue){if(old!=attr[key])
animate(settings.onAfterFirst);delete attr[key];}});animate(settings.onAfter);function animate(callback){$elem.animate(attr,duration,settings.easing,callback&&function(){callback.call(this,targ,settings);});}}).end();};$scrollTo.max=function(elem,axis){var Dim=axis=='x'?'Width':'Height',scroll='scroll'+Dim;if(!$(elem).is('html,body'))
return elem[scroll]-$(elem)[Dim.toLowerCase()]();var size='client'+Dim,html=elem.ownerDocument.documentElement,body=elem.ownerDocument.body;return Math.max(html[scroll],body[scroll])-Math.min(html[size],body[size]);};function both(val){return $.isFunction(val)||$.isPlainObject(val)?val:{top:val,left:val};}
return $scrollTo;})}(typeof define==='function'&&define.amd?define:function(deps,factory){if(typeof module!=='undefined'&&module.exports){module.exports=factory(require('jquery'));}else{factory(jQuery);}}));;

/* /web/static/lib/jquery.textext/jquery.textext.js defined in bundle 'web.assets_backend' */
;(function($,undefined)
{function TextExt(){};function ItemManager(){};function TextExtPlugin(){};var stringify=(JSON||{}).stringify,slice=Array.prototype.slice,UNDEFINED='undefined',OPT_ITEM_MANAGER='item.manager',OPT_PLUGINS='plugins',OPT_EXT='ext',OPT_HTML_WRAP='html.wrap',OPT_HTML_HIDDEN='html.hidden',OPT_KEYS='keys',EVENT_PRE_INVALIDATE='preInvalidate',EVENT_POST_INVALIDATE='postInvalidate',EVENT_GET_FORM_DATA='getFormData',EVENT_SET_FORM_DATA='setFormData',EVENT_SET_INPUT_DATA='setInputData',EVENT_POST_INIT='postInit',EVENT_READY='ready',DEFAULT_OPTS={itemManager:ItemManager,plugins:[],ext:{},html:{wrap:'<div class="text-core"><div class="text-wrap"/></div>',hidden:'<input type="hidden" />'},keys:{8:'backspace',9:'tab',13:'enter!',27:'escape!',37:'left',38:'up!',39:'right',40:'down!',46:'delete',108:'numpadEnter'}};if(!stringify)
throw new Error('JSON.stringify() not found');function getProperty(source,name)
{if(typeof(name)==='string')
name=name.split('.');var fullCamelCaseName=name.join('.').replace(/\.(\w)/g,function(match,letter){return letter.toUpperCase()}),nestedName=name.shift(),result;if(typeof(result=source[fullCamelCaseName])!=UNDEFINED)
result=result;else if(typeof(result=source[nestedName])!=UNDEFINED&&name.length>0)
result=getProperty(result,name);return result;};function hookupEvents()
{var args=slice.apply(arguments),self=this,target=args.length===1?self:args.shift(),event;args=args[0]||{};function bind(event,handler)
{target.bind(event,function()
{return handler.apply(self,arguments);});}
for(event in args)
bind(event,args[event]);};function formDataObject(input,form)
{return{'input':input,'form':form};};p=ItemManager.prototype;p.init=function(core)
{};p.filter=function(list,query)
{var result=[],i,item;for(i=0;i<list.length;i++)
{item=list[i];if(this.itemContains(item,query))
result.push(item);}
return result;};p.itemContains=function(item,needle)
{return this.itemToString(item).toLowerCase().indexOf(needle.toLowerCase())==0;};p.stringToItem=function(str)
{return str;};p.itemToString=function(item)
{return item;};p.compareItems=function(item1,item2)
{return item1==item2;};p=TextExt.prototype;p.init=function(input,opts)
{var self=this,hiddenInput,itemManager,container;self._defaults=$.extend({},DEFAULT_OPTS);self._opts=opts||{};self._plugins={};self._itemManager=itemManager=new(self.opts(OPT_ITEM_MANAGER))();input=$(input);container=$(self.opts(OPT_HTML_WRAP));hiddenInput=$(self.opts(OPT_HTML_HIDDEN));input.wrap(container).keydown(function(e){return self.onKeyDown(e)}).keyup(function(e){return self.onKeyUp(e)}).data('textext',self);$(self).data({'hiddenInput':hiddenInput,'wrapElement':input.parents('.text-wrap').first(),'input':input});hiddenInput.attr('name',input.attr('name'));input.attr('name',null);hiddenInput.insertAfter(input);$.extend(true,itemManager,self.opts(OPT_EXT+'.item.manager'));$.extend(true,self,self.opts(OPT_EXT+'.*'),self.opts(OPT_EXT+'.core'));self.originalWidth=input.outerWidth();self.invalidateBounds();itemManager.init(self);self.initPatches();self.initPlugins(self.opts(OPT_PLUGINS),$.fn.textext.plugins);self.on({setFormData:self.onSetFormData,getFormData:self.onGetFormData,setInputData:self.onSetInputData,anyKeyUp:self.onAnyKeyUp});self.trigger(EVENT_POST_INIT);self.trigger(EVENT_READY);self.getFormData(0);};p.initPatches=function()
{var list=[],source=$.fn.textext.patches,name;for(name in source)
list.push(name);this.initPlugins(list,source);};p.initPlugins=function(plugins,source)
{var self=this,ext,name,plugin,initList=[],i;if(typeof(plugins)=='string')
plugins=plugins.split(/\s*,\s*|\s+/g);for(i=0;i<plugins.length;i++)
{name=plugins[i];plugin=source[name];if(plugin)
{self._plugins[name]=plugin=new plugin();self[name]=(function(plugin){return function(){return plugin;}})(plugin);initList.push(plugin);$.extend(true,plugin,self.opts(OPT_EXT+'.*'),self.opts(OPT_EXT+'.'+name));}}
initList.sort(function(p1,p2)
{p1=p1.initPriority();p2=p2.initPriority();return p1===p2?0:p1<p2?1:-1;});for(i=0;i<initList.length;i++)
initList[i].init(self);};p.hasPlugin=function(name)
{return!!this._plugins[name];};p.on=hookupEvents;p.bind=function(event,handler)
{this.input().bind(event,handler);};p.trigger=function()
{var args=arguments;this.input().trigger(args[0],slice.call(args,1));};p.itemManager=function()
{return this._itemManager;};p.input=function()
{return $(this).data('input');};p.opts=function(name)
{var result=getProperty(this._opts,name);return typeof(result)=='undefined'?getProperty(this._defaults,name):result;};p.wrapElement=function()
{return $(this).data('wrapElement');};p.invalidateBounds=function()
{var self=this,input=self.input(),wrap=self.wrapElement(),container=wrap.parent(),width=self.originalWidth,height;self.trigger(EVENT_PRE_INVALIDATE);height=input.outerHeight();input.width(width);wrap.width(width).height(height);container.height(height);self.trigger(EVENT_POST_INVALIDATE);};p.focusInput=function()
{this.input()[0].focus();};p.serializeData=stringify;p.hiddenInput=function(value)
{return $(this).data('hiddenInput');};p.getWeightedEventResponse=function(event,args)
{var self=this,data={},maxWeight=0;self.trigger(event,data,args);for(var weight in data)
maxWeight=Math.max(maxWeight,weight);return data[maxWeight];};p.getFormData=function(keyCode)
{var self=this,data=self.getWeightedEventResponse(EVENT_GET_FORM_DATA,keyCode||0);self.trigger(EVENT_SET_FORM_DATA,data['form']);self.trigger(EVENT_SET_INPUT_DATA,data['input']);};p.onAnyKeyUp=function(e,keyCode)
{this.getFormData(keyCode);};p.onSetInputData=function(e,data)
{this.input().val(data);};p.onSetFormData=function(e,data)
{var self=this;self.hiddenInput().val(self.serializeData(data));};p.onGetFormData=function(e,data)
{var val=this.input().val();data[0]=formDataObject(val,val);};$(['Down','Up']).each(function()
{var type=this.toString();p['onKey'+type]=function(e)
{var self=this,keyName=self.opts(OPT_KEYS)[e.keyCode],defaultResult=true;if(keyName)
{defaultResult=keyName.substr(-1)!='!';keyName=keyName.replace('!','');self.trigger(keyName+'Key'+type);if(type=='Up'&&self._lastKeyDown==e.keyCode)
{self._lastKeyDown=null;self.trigger(keyName+'KeyPress');}
if(type=='Down')
self._lastKeyDown=e.keyCode;}
self.trigger('anyKey'+type,e.keyCode);return defaultResult;};});p=TextExtPlugin.prototype;p.on=hookupEvents;p.formDataObject=formDataObject;p.init=function(core){throw new Error('Not implemented')};p.baseInit=function(core,defaults)
{var self=this;core._defaults=$.extend(true,core._defaults,defaults);self._core=core;self._timers={};};p.startTimer=function(name,delay,callback)
{var self=this;self.stopTimer(name);self._timers[name]=setTimeout(function()
{delete self._timers[name];callback.apply(self);},delay*1000);};p.stopTimer=function(name)
{clearTimeout(this._timers[name]);};p.core=function()
{return this._core;};p.opts=function(name)
{return this.core().opts(name);};p.itemManager=function()
{return this.core().itemManager();};p.input=function()
{return this.core().input();};p.val=function(value)
{var input=this.input();if(typeof(value)===UNDEFINED)
return input.val();else
input.val(value);};p.trigger=function()
{var core=this.core();core.trigger.apply(core,arguments);};p.bind=function(event,handler)
{this.core().bind(event,handler);};p.initPriority=function()
{return 0;};var cssInjected=false;var textext=$.fn.textext=function(opts)
{var css;if(!cssInjected&&(css=$.fn.textext.css)!=null)
{$('head').append('<style>'+css+'</style>');cssInjected=true;}
return this.map(function()
{var self=$(this);if(opts==null)
return self.data('textext');var instance=new TextExt();instance.init(self,opts);self.data('textext',instance);return instance.input()[0];});};textext.addPlugin=function(name,constructor)
{textext.plugins[name]=constructor;constructor.prototype=new textext.TextExtPlugin();};textext.addPatch=function(name,constructor)
{textext.patches[name]=constructor;constructor.prototype=new textext.TextExtPlugin();};textext.TextExt=TextExt;textext.TextExtPlugin=TextExtPlugin;textext.ItemManager=ItemManager;textext.plugins={};textext.patches={};})(jQuery);(function($)
{function TextExtIE9Patches(){};$.fn.textext.TextExtIE9Patches=TextExtIE9Patches;$.fn.textext.addPatch('ie9',TextExtIE9Patches);var p=TextExtIE9Patches.prototype;p.init=function(core)
{if(navigator.userAgent.indexOf('MSIE 9')==-1)
return;var self=this;core.on({postInvalidate:self.onPostInvalidate});};p.onPostInvalidate=function()
{var self=this,input=self.input(),val=input.val();input.val(Math.random());input.val(val);};})(jQuery);;(function($)
{function TextExtAjax(){};$.fn.textext.TextExtAjax=TextExtAjax;$.fn.textext.addPlugin('ajax',TextExtAjax);var p=TextExtAjax.prototype,OPT_DATA_CALLBACK='ajax.data.callback',OPT_CACHE_RESULTS='ajax.cache.results',OPT_LOADING_DELAY='ajax.loading.delay',OPT_LOADING_MESSAGE='ajax.loading.message',OPT_TYPE_DELAY='ajax.type.delay',EVENT_SET_SUGGESTION='setSuggestions',EVENT_SHOW_DROPDOWN='showDropdown',TIMER_LOADING='loading',DEFAULT_OPTS={ajax:{typeDelay:0.5,loadingMessage:'Loading...',loadingDelay:0.5,cacheResults:false,dataCallback:null}};p.init=function(core)
{var self=this;self.baseInit(core,DEFAULT_OPTS);self.on({getSuggestions:self.onGetSuggestions});self._suggestions=null;};p.load=function(query)
{var self=this,dataCallback=self.opts(OPT_DATA_CALLBACK)||function(query){return{q:query}},opts;opts=$.extend(true,{data:dataCallback(query),success:function(data){self.onComplete(data,query)},error:function(jqXHR,message){console.error(message,query)}},self.opts('ajax'));$.ajax(opts);};p.onComplete=function(data,query)
{var self=this,result=data;self.dontShowLoading();if(self.opts(OPT_CACHE_RESULTS)==true)
{self._suggestions=data;result=self.itemManager().filter(data,query);}
self.trigger(EVENT_SET_SUGGESTION,{result:result});};p.dontShowLoading=function()
{this.stopTimer(TIMER_LOADING);};p.showLoading=function()
{var self=this;self.dontShowLoading();self.startTimer(TIMER_LOADING,self.opts(OPT_LOADING_DELAY),function()
{self.trigger(EVENT_SHOW_DROPDOWN,function(autocomplete)
{autocomplete.clearItems();var node=autocomplete.addDropdownItem(self.opts(OPT_LOADING_MESSAGE));node.addClass('text-loading');});});};p.onGetSuggestions=function(e,data)
{var self=this,suggestions=self._suggestions,query=(data||{}).query||'';if(suggestions&&self.opts(OPT_CACHE_RESULTS)===true)
return self.onComplete(suggestions,query);self.startTimer('ajax',self.opts(OPT_TYPE_DELAY),function()
{self.showLoading();self.load(query);});};})(jQuery);;(function($)
{function TextExtArrow(){};$.fn.textext.TextExtArrow=TextExtArrow;$.fn.textext.addPlugin('arrow',TextExtArrow);var p=TextExtArrow.prototype,OPT_HTML_ARROW='html.arrow',DEFAULT_OPTS={html:{arrow:'<div class="text-arrow"/>'}};p.init=function(core)
{var self=this,arrow;self.baseInit(core,DEFAULT_OPTS);self._arrow=arrow=$(self.opts(OPT_HTML_ARROW));self.core().wrapElement().append(arrow);arrow.bind('click',function(e){self.onArrowClick(e);});};p.onArrowClick=function(e)
{this.trigger('toggleDropdown');this.core().focusInput();};})(jQuery);;(function($)
{function TextExtAutocomplete(){};$.fn.textext.TextExtAutocomplete=TextExtAutocomplete;$.fn.textext.addPlugin('autocomplete',TextExtAutocomplete);var p=TextExtAutocomplete.prototype,CSS_DOT='.',CSS_SELECTED='text-selected',CSS_DOT_SELECTED=CSS_DOT+CSS_SELECTED,CSS_SUGGESTION='text-suggestion',CSS_DOT_SUGGESTION=CSS_DOT+CSS_SUGGESTION,CSS_LABEL='text-label',CSS_DOT_LABEL=CSS_DOT+CSS_LABEL,OPT_ENABLED='autocomplete.enabled',OPT_POSITION='autocomplete.dropdown.position',OPT_MAX_HEIGHT='autocomplete.dropdown.maxHeight',OPT_RENDER='autocomplete.render',OPT_HTML_DROPDOWN='html.dropdown',OPT_HTML_SUGGESTION='html.suggestion',EVENT_HIDE_DROPDOWN='hideDropdown',EVENT_SHOW_DROPDOWN='showDropdown',EVENT_GET_SUGGESTIONS='getSuggestions',EVENT_GET_FORM_DATA='getFormData',EVENT_TOGGLE_DROPDOWN='toggleDropdown',POSITION_ABOVE='above',POSITION_BELOW='below',DATA_MOUSEDOWN_ON_AUTOCOMPLETE='mousedownOnAutocomplete',DEFAULT_OPTS={autocomplete:{enabled:true,dropdown:{position:POSITION_BELOW,maxHeight:'100px'}},html:{dropdown:'<div class="text-dropdown"><div class="text-list"/></div>',suggestion:'<div class="text-suggestion"><span class="text-label"/></div>'}};p.init=function(core)
{var self=this;self.baseInit(core,DEFAULT_OPTS);var input=self.input(),container;if(self.opts(OPT_ENABLED)===true)
{self.on({blur:self.onBlur,anyKeyUp:self.onAnyKeyUp,deleteKeyUp:self.onAnyKeyUp,backspaceKeyPress:self.onBackspaceKeyPress,enterKeyPress:self.onEnterKeyPress,escapeKeyPress:self.onEscapeKeyPress,setSuggestions:self.onSetSuggestions,showDropdown:self.onShowDropdown,hideDropdown:self.onHideDropdown,toggleDropdown:self.onToggleDropdown,postInvalidate:self.positionDropdown,getFormData:self.onGetFormData,downKeyDown:self.onDownKeyDown,upKeyDown:self.onUpKeyDown});container=$(self.opts(OPT_HTML_DROPDOWN));container.insertAfter(input);self.on(container,{mouseover:self.onMouseOver,mousedown:self.onMouseDown,click:self.onClick});container.css('maxHeight',self.opts(OPT_MAX_HEIGHT)).addClass('text-position-'+self.opts(OPT_POSITION));$(self).data('container',container);$(document.body).click(function(e)
{if(self.isDropdownVisible()&&!self.withinWrapElement(e.target))
self.trigger(EVENT_HIDE_DROPDOWN);});self.positionDropdown();}};p.containerElement=function()
{return $(this).data('container');};p.onMouseOver=function(e)
{var self=this,target=$(e.target);if(target.is(CSS_DOT_SUGGESTION))
{self.clearSelected();target.addClass(CSS_SELECTED);}};p.onMouseDown=function(e)
{this.containerElement().data(DATA_MOUSEDOWN_ON_AUTOCOMPLETE,true);};p.onClick=function(e)
{var self=this,target=$(e.target);if($(CSS_DOT_SUGGESTION).has(target[0])||$(CSS_DOT_LABEL).has(target[0]))
self.trigger('enterKeyPress');if(self.core().hasPlugin('tags'))
self.val('');};p.onBlur=function(e)
{var self=this,container=self.containerElement(),isBlurByMousedown=container.data(DATA_MOUSEDOWN_ON_AUTOCOMPLETE)===true;if(self.isDropdownVisible())
isBlurByMousedown?self.core().focusInput():self.trigger(EVENT_HIDE_DROPDOWN);container.removeData(DATA_MOUSEDOWN_ON_AUTOCOMPLETE);};p.onBackspaceKeyPress=function(e)
{var self=this,isEmpty=self.val().length>0;if(isEmpty||self.isDropdownVisible())
self.getSuggestions();};p.onAnyKeyUp=function(e,keyCode)
{var self=this,isFunctionKey=self.opts('keys.'+keyCode)!=null;if(self.val().length>0&&!isFunctionKey)
self.getSuggestions();};p.onDownKeyDown=function(e)
{var self=this;self.isDropdownVisible()?self.toggleNextSuggestion():self.getSuggestions();};p.onUpKeyDown=function(e)
{this.togglePreviousSuggestion();};p.onEnterKeyPress=function(e)
{var self=this;if(self.isDropdownVisible())
self.selectFromDropdown();};p.onEscapeKeyPress=function(e)
{var self=this;if(self.isDropdownVisible())
self.trigger(EVENT_HIDE_DROPDOWN);};p.positionDropdown=function()
{var self=this,container=self.containerElement(),direction=self.opts(OPT_POSITION),height=self.core().wrapElement().outerHeight(),css={};css[direction===POSITION_ABOVE?'bottom':'top']=height+'px';container.css(css);};p.suggestionElements=function()
{return this.containerElement().find(CSS_DOT_SUGGESTION);};p.setSelectedSuggestion=function(suggestion)
{if(!suggestion)
return;var self=this,all=self.suggestionElements(),target=all.first(),item,i;self.clearSelected();for(i=0;i<all.length;i++)
{item=$(all[i]);if(self.itemManager().compareItems(item.data(CSS_SUGGESTION),suggestion))
{target=item.addClass(CSS_SELECTED);break;}}
target.addClass(CSS_SELECTED);self.scrollSuggestionIntoView(target);};p.selectedSuggestionElement=function()
{return this.suggestionElements().filter(CSS_DOT_SELECTED).first();};p.isDropdownVisible=function()
{return this.containerElement().is(':visible')===true;};p.onGetFormData=function(e,data,keyCode)
{var self=this,val=self.val(),inputValue=val,formValue=val;data[100]=self.formDataObject(inputValue,formValue);};p.initPriority=function()
{return 200;};p.onHideDropdown=function(e)
{this.hideDropdown();};p.onToggleDropdown=function(e)
{var self=this;self.trigger(self.containerElement().is(':visible')?EVENT_HIDE_DROPDOWN:EVENT_SHOW_DROPDOWN);};p.onShowDropdown=function(e,renderCallback)
{var self=this,current=self.selectedSuggestionElement().data(CSS_SUGGESTION),suggestions=self._suggestions;if(!suggestions)
return self.trigger(EVENT_GET_SUGGESTIONS);if($.isFunction(renderCallback))
{renderCallback(self);}
else
{self.renderSuggestions(self._suggestions);self.toggleNextSuggestion();}
self.showDropdown(self.containerElement());self.setSelectedSuggestion(current);};p.onSetSuggestions=function(e,data)
{var self=this,suggestions=self._suggestions=data.result;if(data.showHideDropdown!==false)
self.trigger(suggestions===null||suggestions.length===0?EVENT_HIDE_DROPDOWN:EVENT_SHOW_DROPDOWN);};p.getSuggestions=function()
{var self=this,val=self.val();if(self._previousInputValue==val)
return;if(val=='')
current=null;self._previousInputValue=val;self.trigger(EVENT_GET_SUGGESTIONS,{query:val});};p.clearItems=function()
{this.containerElement().find('.text-list').children().remove();};p.renderSuggestions=function(suggestions)
{var self=this;self.clearItems();$.each(suggestions||[],function(index,item)
{self.addSuggestion(item);});};p.showDropdown=function()
{this.containerElement().show();};p.hideDropdown=function()
{var self=this,dropdown=self.containerElement();self._previousInputValue=null;dropdown.hide();};p.addSuggestion=function(suggestion)
{var self=this,renderer=self.opts(OPT_RENDER),node=self.addDropdownItem(renderer?renderer.call(self,suggestion):self.itemManager().itemToString(suggestion));node.data(CSS_SUGGESTION,suggestion);};p.addDropdownItem=function(html)
{var self=this,container=self.containerElement().find('.text-list'),node=$(self.opts(OPT_HTML_SUGGESTION));node.find('.text-label').html(html);container.append(node);return node;};p.clearSelected=function()
{this.suggestionElements().removeClass(CSS_SELECTED);};p.toggleNextSuggestion=function()
{var self=this,selected=self.selectedSuggestionElement(),next;if(selected.length>0)
{next=selected.next();if(next.length>0)
selected.removeClass(CSS_SELECTED);}
else
{next=self.suggestionElements().first();}
next.addClass(CSS_SELECTED);self.scrollSuggestionIntoView(next);};p.togglePreviousSuggestion=function()
{var self=this,selected=self.selectedSuggestionElement(),prev=selected.prev();if(prev.length==0)
return;self.clearSelected();prev.addClass(CSS_SELECTED);self.scrollSuggestionIntoView(prev);};p.scrollSuggestionIntoView=function(item)
{var itemHeight=item.outerHeight(),dropdown=this.containerElement(),dropdownHeight=dropdown.innerHeight(),scrollPos=dropdown.scrollTop(),itemTop=(item.position()||{}).top,scrollTo=null,paddingTop=parseInt(dropdown.css('paddingTop'));if(itemTop==null)
return;if(itemTop+itemHeight>dropdownHeight)
scrollTo=itemTop+scrollPos+itemHeight-dropdownHeight+paddingTop;if(itemTop<0)
scrollTo=itemTop+scrollPos-paddingTop;if(scrollTo!=null)
dropdown.scrollTop(scrollTo);};p.selectFromDropdown=function()
{var self=this,suggestion=self.selectedSuggestionElement().data(CSS_SUGGESTION);if(suggestion)
{self.val(self.itemManager().itemToString(suggestion));self.core().getFormData();}
self.trigger(EVENT_HIDE_DROPDOWN);};p.withinWrapElement=function(element)
{return this.core().wrapElement().find(element).size()>0;}})(jQuery);;(function($)
{function TextExtFilter(){};$.fn.textext.TextExtFilter=TextExtFilter;$.fn.textext.addPlugin('filter',TextExtFilter);var p=TextExtFilter.prototype,OPT_ENABLED='filter.enabled',OPT_ITEMS='filter.items',DEFAULT_OPTS={filter:{enabled:true,items:null}};p.init=function(core)
{var self=this;self.baseInit(core,DEFAULT_OPTS);self.on({getFormData:self.onGetFormData,isTagAllowed:self.onIsTagAllowed,setSuggestions:self.onSetSuggestions});self._suggestions=null;};p.onGetFormData=function(e,data,keyCode)
{var self=this,val=self.val(),inputValue=val,formValue='';if(!self.core().hasPlugin('tags'))
{if(self.isValueAllowed(inputValue))
formValue=val;data[300]=self.formDataObject(inputValue,formValue);}};p.isValueAllowed=function(value)
{var self=this,list=self.opts('filterItems')||self._suggestions||[],itemManager=self.itemManager(),result=!self.opts(OPT_ENABLED),i;for(i=0;i<list.length&&!result;i++)
if(itemManager.compareItems(value,list[i]))
result=true;return result;};p.onIsTagAllowed=function(e,data)
{data.result=this.isValueAllowed(data.tag);};p.onSetSuggestions=function(e,data)
{this._suggestions=data.result;};})(jQuery);;(function($)
{function TextExtFocus(){};$.fn.textext.TextExtFocus=TextExtFocus;$.fn.textext.addPlugin('focus',TextExtFocus);var p=TextExtFocus.prototype,OPT_HTML_FOCUS='html.focus',DEFAULT_OPTS={html:{focus:'<div class="text-focus"/>'}};p.init=function(core)
{var self=this;self.baseInit(core,DEFAULT_OPTS);self.core().wrapElement().append(self.opts(OPT_HTML_FOCUS));self.on({blur:self.onBlur,focus:self.onFocus});self._timeoutId=0;};p.onBlur=function(e)
{var self=this;clearTimeout(self._timeoutId);self._timeoutId=setTimeout(function()
{self.getFocus().hide();},100);};p.onFocus=function(e)
{var self=this;clearTimeout(self._timeoutId);self.getFocus().show();};p.getFocus=function()
{return this.core().wrapElement().find('.text-focus');};})(jQuery);;(function($)
{function TextExtPrompt(){};$.fn.textext.TextExtPrompt=TextExtPrompt;$.fn.textext.addPlugin('prompt',TextExtPrompt);var p=TextExtPrompt.prototype,CSS_HIDE_PROMPT='text-hide-prompt',OPT_PROMPT='prompt',OPT_HTML_PROMPT='html.prompt',DEFAULT_OPTS={prompt:'Awaiting input...',html:{prompt:'<div class="text-prompt"/>'}};p.init=function(core)
{var self=this,placeholderKey='placeholder',container,prompt;self.baseInit(core,DEFAULT_OPTS);container=$(self.opts(OPT_HTML_PROMPT));$(self).data('container',container);self.core().wrapElement().append(container);self.setPrompt(self.opts(OPT_PROMPT));prompt=core.input().attr(placeholderKey);if(!prompt)
prompt=self.opts(OPT_PROMPT);core.input().attr(placeholderKey,'');if(prompt)
self.setPrompt(prompt);if($.trim(self.val()).length>0)
self.hidePrompt();self.on({blur:self.onBlur,focus:self.onFocus,postInvalidate:self.onPostInvalidate,postInit:self.onPostInit});};p.onPostInit=function(e)
{this.invalidateBounds();};p.onPostInvalidate=function(e)
{this.invalidateBounds();};p.invalidateBounds=function()
{var self=this,input=self.input();self.containerElement().css({paddingLeft:input.css('paddingLeft'),paddingTop:input.css('paddingTop')});};p.onBlur=function(e)
{var self=this;self.startTimer('prompt',0.1,function()
{self.showPrompt();});};p.showPrompt=function()
{var self=this,input=self.input();if($.trim(self.val()).length===0&&!input.is(':focus'))
self.containerElement().removeClass(CSS_HIDE_PROMPT);};p.hidePrompt=function()
{this.stopTimer('prompt');this.containerElement().addClass(CSS_HIDE_PROMPT);};p.onFocus=function(e)
{this.hidePrompt();};p.setPrompt=function(str)
{this.containerElement().text(str);};p.containerElement=function()
{return $(this).data('container');};})(jQuery);;(function($)
{function TextExtSuggestions(){};$.fn.textext.TextExtSuggestions=TextExtSuggestions;$.fn.textext.addPlugin('suggestions',TextExtSuggestions);var p=TextExtSuggestions.prototype,OPT_SUGGESTIONS='suggestions',DEFAULT_OPTS={suggestions:null};p.init=function(core)
{var self=this;self.baseInit(core,DEFAULT_OPTS);self.on({getSuggestions:self.onGetSuggestions,postInit:self.onPostInit});};p.setSuggestions=function(suggestions,showHideDropdown)
{this.trigger('setSuggestions',{result:suggestions,showHideDropdown:showHideDropdown!=false});};p.onPostInit=function(e)
{var self=this;self.setSuggestions(self.opts(OPT_SUGGESTIONS),false);};p.onGetSuggestions=function(e,data)
{var self=this,suggestions=self.opts(OPT_SUGGESTIONS);suggestions.sort();self.setSuggestions(self.itemManager().filter(suggestions,data.query));};})(jQuery);;(function($)
{function TextExtTags(){};$.fn.textext.TextExtTags=TextExtTags;$.fn.textext.addPlugin('tags',TextExtTags);var p=TextExtTags.prototype,CSS_DOT='.',CSS_TAGS_ON_TOP='text-tags-on-top',CSS_DOT_TAGS_ON_TOP=CSS_DOT+CSS_TAGS_ON_TOP,CSS_TAG='text-tag',CSS_DOT_TAG=CSS_DOT+CSS_TAG,CSS_TAGS='text-tags',CSS_DOT_TAGS=CSS_DOT+CSS_TAGS,CSS_LABEL='text-label',CSS_DOT_LABEL=CSS_DOT+CSS_LABEL,CSS_REMOVE='text-remove',CSS_DOT_REMOVE=CSS_DOT+CSS_REMOVE,OPT_ENABLED='tags.enabled',OPT_ITEMS='tags.items',OPT_HTML_TAG='html.tag',OPT_HTML_TAGS='html.tags',EVENT_IS_TAG_ALLOWED='isTagAllowed',EVENT_TAG_CLICK='tagClick',DEFAULT_OPTS={tags:{enabled:true,items:null},html:{tags:'<div class="text-tags"/>',tag:'<div class="text-tag"><div class="text-button"><span class="text-label"/><a class="text-remove"/></div></div>'}};p.init=function(core)
{this.baseInit(core,DEFAULT_OPTS);var self=this,input=self.input(),container;if(self.opts(OPT_ENABLED))
{container=$(self.opts(OPT_HTML_TAGS));input.after(container);$(self).data('container',container);self.on({enterKeyPress:self.onEnterKeyPress,backspaceKeyDown:self.onBackspaceKeyDown,preInvalidate:self.onPreInvalidate,postInit:self.onPostInit,getFormData:self.onGetFormData});self.on(container,{click:self.onClick,mousemove:self.onContainerMouseMove});self.on(input,{mousemove:self.onInputMouseMove});}
self._originalPadding={left:parseInt(input.css('paddingLeft')||0),top:parseInt(input.css('paddingTop')||0)};self._paddingBox={left:0,top:0};self.updateFormCache();};p.containerElement=function()
{return $(this).data('container');};p.onPostInit=function(e)
{var self=this;self.addTags(self.opts(OPT_ITEMS));};p.onGetFormData=function(e,data,keyCode)
{var self=this,inputValue=keyCode===13?'':self.val(),formValue=self._formData;data[200]=self.formDataObject(inputValue,formValue);};p.initPriority=function()
{return 100;};p.onInputMouseMove=function(e)
{this.toggleZIndex(e);};p.onContainerMouseMove=function(e)
{this.toggleZIndex(e);};p.onBackspaceKeyDown=function(e)
{var self=this,lastTag=self.tagElements().last();if(self.val().length==0)
self.removeTag(lastTag);};p.onPreInvalidate=function(e)
{var self=this,lastTag=self.tagElements().last(),pos=lastTag.position();if(lastTag.length>0)
pos.left+=lastTag.innerWidth();else
pos=self._originalPadding;self._paddingBox=pos;self.input().css({paddingLeft:pos.left,paddingTop:pos.top});};p.onClick=function(e)
{var self=this,core=self.core(),source=$(e.target),focus=0,tag;if(source.is(CSS_DOT_TAGS))
{focus=1;}
else if(source.is(CSS_DOT_REMOVE))
{self.removeTag(source.parents(CSS_DOT_TAG+':first'));focus=1;}
else if(source.is(CSS_DOT_LABEL))
{tag=source.parents(CSS_DOT_TAG+':first');self.trigger(EVENT_TAG_CLICK,tag,tag.data(CSS_TAG),tagClickCallback);}
function tagClickCallback(newValue,refocus)
{tag.data(CSS_TAG,newValue);tag.find(CSS_DOT_LABEL).text(self.itemManager().itemToString(newValue));self.updateFormCache();core.getFormData();core.invalidateBounds();if(refocus)
core.focusInput();}
if(focus)
core.focusInput();};p.onEnterKeyPress=function(e)
{var self=this,val=self.val(),tag=self.itemManager().stringToItem(val);if(self.isTagAllowed(tag))
{self.addTags([tag]);self.core().focusInput();}};p.updateFormCache=function()
{var self=this,result=[];self.tagElements().each(function()
{result.push($(this).data(CSS_TAG));});self._formData=result;};p.toggleZIndex=function(e)
{var self=this,offset=self.input().offset(),mouseX=e.clientX-offset.left,mouseY=e.clientY-offset.top,box=self._paddingBox,container=self.containerElement(),isOnTop=container.is(CSS_DOT_TAGS_ON_TOP),isMouseOverText=mouseX>box.left&&mouseY>box.top;if(!isOnTop&&!isMouseOverText||isOnTop&&isMouseOverText)
container[(!isOnTop?'add':'remove')+'Class'](CSS_TAGS_ON_TOP);};p.tagElements=function()
{return this.containerElement().find(CSS_DOT_TAG);};p.isTagAllowed=function(tag)
{var opts={tag:tag,result:true};this.trigger(EVENT_IS_TAG_ALLOWED,opts);return opts.result===true;};p.addTags=function(tags)
{if(!tags||tags.length==0)
return;var self=this,core=self.core(),container=self.containerElement(),i,tag;for(i=0;i<tags.length;i++)
{tag=tags[i];if(tag&&self.isTagAllowed(tag))
container.append(self.renderTag(tag));}
self.updateFormCache();core.getFormData();core.invalidateBounds();};p.getTagElement=function(tag)
{var self=this,list=self.tagElements(),i,item;for(i=0;i<list.length,item=$(list[i]);i++)
if(self.itemManager().compareItems(item.data(CSS_TAG),tag))
return item;};p.removeTag=function(tag)
{var self=this,core=self.core(),element;if(tag instanceof $)
{element=tag;tag=tag.data(CSS_TAG);}
else
{element=self.getTagElement(tag);}
element.remove();self.updateFormCache();core.getFormData();core.invalidateBounds();};p.renderTag=function(tag)
{var self=this,node=$(self.opts(OPT_HTML_TAG));node.find('.text-label').text(self.itemManager().itemToString(tag));node.data(CSS_TAG,tag);return node;};})(jQuery);;

/* /web/static/lib/bootstrap/js/affix.js defined in bundle 'web.assets_backend' */
+function($){'use strict';var Affix=function(element,options){this.options=$.extend({},Affix.DEFAULTS,options)
this.$target=$(this.options.target).on('scroll.bs.affix.data-api',$.proxy(this.checkPosition,this)).on('click.bs.affix.data-api',$.proxy(this.checkPositionWithEventLoop,this))
this.$element=$(element)
this.affixed=null
this.unpin=null
this.pinnedOffset=null
this.checkPosition()}
Affix.VERSION='3.3.4'
Affix.RESET='affix affix-top affix-bottom'
Affix.DEFAULTS={offset:0,target:window}
Affix.prototype.getState=function(scrollHeight,height,offsetTop,offsetBottom){var scrollTop=this.$target.scrollTop()
var position=this.$element.offset()
var targetHeight=this.$target.height()
if(offsetTop!=null&&this.affixed=='top')return scrollTop<offsetTop?'top':false
if(this.affixed=='bottom'){if(offsetTop!=null)return(scrollTop+this.unpin<=position.top)?false:'bottom'
return(scrollTop+targetHeight<=scrollHeight-offsetBottom)?false:'bottom'}
var initializing=this.affixed==null
var colliderTop=initializing?scrollTop:position.top
var colliderHeight=initializing?targetHeight:height
if(offsetTop!=null&&scrollTop<=offsetTop)return'top'
if(offsetBottom!=null&&(colliderTop+colliderHeight>=scrollHeight-offsetBottom))return'bottom'
return false}
Affix.prototype.getPinnedOffset=function(){if(this.pinnedOffset)return this.pinnedOffset
this.$element.removeClass(Affix.RESET).addClass('affix')
var scrollTop=this.$target.scrollTop()
var position=this.$element.offset()
return(this.pinnedOffset=position.top-scrollTop)}
Affix.prototype.checkPositionWithEventLoop=function(){setTimeout($.proxy(this.checkPosition,this),1)}
Affix.prototype.checkPosition=function(){if(!this.$element.is(':visible'))return
var height=this.$element.height()
var offset=this.options.offset
var offsetTop=offset.top
var offsetBottom=offset.bottom
var scrollHeight=$(document.body).height()
if(typeof offset!='object')offsetBottom=offsetTop=offset
if(typeof offsetTop=='function')offsetTop=offset.top(this.$element)
if(typeof offsetBottom=='function')offsetBottom=offset.bottom(this.$element)
var affix=this.getState(scrollHeight,height,offsetTop,offsetBottom)
if(this.affixed!=affix){if(this.unpin!=null)this.$element.css('top','')
var affixType='affix'+(affix?'-'+affix:'')
var e=$.Event(affixType+'.bs.affix')
this.$element.trigger(e)
if(e.isDefaultPrevented())return
this.affixed=affix
this.unpin=affix=='bottom'?this.getPinnedOffset():null
this.$element.removeClass(Affix.RESET).addClass(affixType).trigger(affixType.replace('affix','affixed')+'.bs.affix')}
if(affix=='bottom'){this.$element.offset({top:scrollHeight-height-offsetBottom})}}
function Plugin(option){return this.each(function(){var $this=$(this)
var data=$this.data('bs.affix')
var options=typeof option=='object'&&option
if(!data)$this.data('bs.affix',(data=new Affix(this,options)))
if(typeof option=='string')data[option]()})}
var old=$.fn.affix
$.fn.affix=Plugin
$.fn.affix.Constructor=Affix
$.fn.affix.noConflict=function(){$.fn.affix=old
return this}
$(window).on('load',function(){$('[data-spy="affix"]').each(function(){var $spy=$(this)
var data=$spy.data()
data.offset=data.offset||{}
if(data.offsetBottom!=null)data.offset.bottom=data.offsetBottom
if(data.offsetTop!=null)data.offset.top=data.offsetTop
Plugin.call($spy,data)})})}(jQuery);;

/* /web/static/lib/bootstrap/js/alert.js defined in bundle 'web.assets_backend' */
+function($){'use strict';var dismiss='[data-dismiss="alert"]'
var Alert=function(el){$(el).on('click',dismiss,this.close)}
Alert.VERSION='3.3.4'
Alert.TRANSITION_DURATION=150
Alert.prototype.close=function(e){var $this=$(this)
var selector=$this.attr('data-target')
if(!selector){selector=$this.attr('href')
selector=selector&&selector.replace(/.*(?=#[^\s]*$)/,'')}
var $parent=$(selector)
if(e)e.preventDefault()
if(!$parent.length){$parent=$this.closest('.alert')}
$parent.trigger(e=$.Event('close.bs.alert'))
if(e.isDefaultPrevented())return
$parent.removeClass('in')
function removeElement(){$parent.detach().trigger('closed.bs.alert').remove()}
$.support.transition&&$parent.hasClass('fade')?$parent.one('bsTransitionEnd',removeElement).emulateTransitionEnd(Alert.TRANSITION_DURATION):removeElement()}
function Plugin(option){return this.each(function(){var $this=$(this)
var data=$this.data('bs.alert')
if(!data)$this.data('bs.alert',(data=new Alert(this)))
if(typeof option=='string')data[option].call($this)})}
var old=$.fn.alert
$.fn.alert=Plugin
$.fn.alert.Constructor=Alert
$.fn.alert.noConflict=function(){$.fn.alert=old
return this}
$(document).on('click.bs.alert.data-api',dismiss,Alert.prototype.close)}(jQuery);;

/* /web/static/lib/bootstrap/js/button.js defined in bundle 'web.assets_backend' */
+function($){'use strict';var Button=function(element,options){this.$element=$(element)
this.options=$.extend({},Button.DEFAULTS,options)
this.isLoading=false}
Button.VERSION='3.3.4'
Button.DEFAULTS={loadingText:'loading...'}
Button.prototype.setState=function(state){var d='disabled'
var $el=this.$element
var val=$el.is('input')?'val':'html'
var data=$el.data()
state=state+'Text'
if(data.resetText==null)$el.data('resetText',$el[val]())
setTimeout($.proxy(function(){$el[val](data[state]==null?this.options[state]:data[state])
if(state=='loadingText'){this.isLoading=true
$el.addClass(d).attr(d,d)}else if(this.isLoading){this.isLoading=false
$el.removeClass(d).removeAttr(d)}},this),0)}
Button.prototype.toggle=function(){var changed=true
var $parent=this.$element.closest('[data-toggle="buttons"]')
if($parent.length){var $input=this.$element.find('input')
if($input.prop('type')=='radio'){if($input.prop('checked')&&this.$element.hasClass('active'))changed=false
else $parent.find('.active').removeClass('active')}
if(changed)$input.prop('checked',!this.$element.hasClass('active')).trigger('change')}else{this.$element.attr('aria-pressed',!this.$element.hasClass('active'))}
if(changed)this.$element.toggleClass('active')}
function Plugin(option){return this.each(function(){var $this=$(this)
var data=$this.data('bs.button')
var options=typeof option=='object'&&option
if(!data)$this.data('bs.button',(data=new Button(this,options)))
if(option=='toggle')data.toggle()
else if(option)data.setState(option)})}
var old=$.fn.button
$.fn.button=Plugin
$.fn.button.Constructor=Button
$.fn.button.noConflict=function(){$.fn.button=old
return this}
$(document).on('click.bs.button.data-api','[data-toggle^="button"]',function(e){var $btn=$(e.target)
if(!$btn.hasClass('btn'))$btn=$btn.closest('.btn')
Plugin.call($btn,'toggle')
e.preventDefault()}).on('focus.bs.button.data-api blur.bs.button.data-api','[data-toggle^="button"]',function(e){$(e.target).closest('.btn').toggleClass('focus',/^focus(in)?$/.test(e.type))})}(jQuery);;

/* /web/static/lib/bootstrap/js/carousel.js defined in bundle 'web.assets_backend' */
+function($){'use strict';var Carousel=function(element,options){this.$element=$(element)
this.$indicators=this.$element.find('.carousel-indicators')
this.options=options
this.paused=null
this.sliding=null
this.interval=null
this.$active=null
this.$items=null
this.options.keyboard&&this.$element.on('keydown.bs.carousel',$.proxy(this.keydown,this))
this.options.pause=='hover'&&!('ontouchstart'in document.documentElement)&&this.$element.on('mouseenter.bs.carousel',$.proxy(this.pause,this)).on('mouseleave.bs.carousel',$.proxy(this.cycle,this))}
Carousel.VERSION='3.3.4'
Carousel.TRANSITION_DURATION=600
Carousel.DEFAULTS={interval:5000,pause:'hover',wrap:true,keyboard:true}
Carousel.prototype.keydown=function(e){if(/input|textarea/i.test(e.target.tagName))return
switch(e.which){case 37:this.prev();break
case 39:this.next();break
default:return}
e.preventDefault()}
Carousel.prototype.cycle=function(e){e||(this.paused=false)
this.interval&&clearInterval(this.interval)
this.options.interval&&!this.paused&&(this.interval=setInterval($.proxy(this.next,this),this.options.interval))
return this}
Carousel.prototype.getItemIndex=function(item){this.$items=item.parent().children('.item')
return this.$items.index(item||this.$active)}
Carousel.prototype.getItemForDirection=function(direction,active){var activeIndex=this.getItemIndex(active)
var willWrap=(direction=='prev'&&activeIndex===0)||(direction=='next'&&activeIndex==(this.$items.length-1))
if(willWrap&&!this.options.wrap)return active
var delta=direction=='prev'?-1:1
var itemIndex=(activeIndex+delta)%this.$items.length
return this.$items.eq(itemIndex)}
Carousel.prototype.to=function(pos){var that=this
var activeIndex=this.getItemIndex(this.$active=this.$element.find('.item.active'))
if(pos>(this.$items.length-1)||pos<0)return
if(this.sliding)return this.$element.one('slid.bs.carousel',function(){that.to(pos)})
if(activeIndex==pos)return this.pause().cycle()
return this.slide(pos>activeIndex?'next':'prev',this.$items.eq(pos))}
Carousel.prototype.pause=function(e){e||(this.paused=true)
if(this.$element.find('.next, .prev').length&&$.support.transition){this.$element.trigger($.support.transition.end)
this.cycle(true)}
this.interval=clearInterval(this.interval)
return this}
Carousel.prototype.next=function(){if(this.sliding)return
return this.slide('next')}
Carousel.prototype.prev=function(){if(this.sliding)return
return this.slide('prev')}
Carousel.prototype.slide=function(type,next){var $active=this.$element.find('.item.active')
var $next=next||this.getItemForDirection(type,$active)
var isCycling=this.interval
var direction=type=='next'?'left':'right'
var that=this
if($next.hasClass('active'))return(this.sliding=false)
var relatedTarget=$next[0]
var slideEvent=$.Event('slide.bs.carousel',{relatedTarget:relatedTarget,direction:direction})
this.$element.trigger(slideEvent)
if(slideEvent.isDefaultPrevented())return
this.sliding=true
isCycling&&this.pause()
if(this.$indicators.length){this.$indicators.find('.active').removeClass('active')
var $nextIndicator=$(this.$indicators.children()[this.getItemIndex($next)])
$nextIndicator&&$nextIndicator.addClass('active')}
var slidEvent=$.Event('slid.bs.carousel',{relatedTarget:relatedTarget,direction:direction})
if($.support.transition&&this.$element.hasClass('slide')){$next.addClass(type)
$next[0].offsetWidth
$active.addClass(direction)
$next.addClass(direction)
$active.one('bsTransitionEnd',function(){$next.removeClass([type,direction].join(' ')).addClass('active')
$active.removeClass(['active',direction].join(' '))
that.sliding=false
setTimeout(function(){that.$element.trigger(slidEvent)},0)}).emulateTransitionEnd(Carousel.TRANSITION_DURATION)}else{$active.removeClass('active')
$next.addClass('active')
this.sliding=false
this.$element.trigger(slidEvent)}
isCycling&&this.cycle()
return this}
function Plugin(option){return this.each(function(){var $this=$(this)
var data=$this.data('bs.carousel')
var options=$.extend({},Carousel.DEFAULTS,$this.data(),typeof option=='object'&&option)
var action=typeof option=='string'?option:options.slide
if(!data)$this.data('bs.carousel',(data=new Carousel(this,options)))
if(typeof option=='number')data.to(option)
else if(action)data[action]()
else if(options.interval)data.pause().cycle()})}
var old=$.fn.carousel
$.fn.carousel=Plugin
$.fn.carousel.Constructor=Carousel
$.fn.carousel.noConflict=function(){$.fn.carousel=old
return this}
var clickHandler=function(e){var href
var $this=$(this)
var $target=$($this.attr('data-target')||(href=$this.attr('href'))&&href.replace(/.*(?=#[^\s]+$)/,''))
if(!$target.hasClass('carousel'))return
var options=$.extend({},$target.data(),$this.data())
var slideIndex=$this.attr('data-slide-to')
if(slideIndex)options.interval=false
Plugin.call($target,options)
if(slideIndex){$target.data('bs.carousel').to(slideIndex)}
e.preventDefault()}
$(document).on('click.bs.carousel.data-api','[data-slide]',clickHandler).on('click.bs.carousel.data-api','[data-slide-to]',clickHandler)
$(window).on('load',function(){$('[data-ride="carousel"]').each(function(){var $carousel=$(this)
Plugin.call($carousel,$carousel.data())})})}(jQuery);;

/* /web/static/lib/bootstrap/js/collapse.js defined in bundle 'web.assets_backend' */
+function($){'use strict';var Collapse=function(element,options){this.$element=$(element)
this.options=$.extend({},Collapse.DEFAULTS,options)
this.$trigger=$('[data-toggle="collapse"][href="#'+element.id+'"],'+'[data-toggle="collapse"][data-target="#'+element.id+'"]')
this.transitioning=null
if(this.options.parent){this.$parent=this.getParent()}else{this.addAriaAndCollapsedClass(this.$element,this.$trigger)}
if(this.options.toggle)this.toggle()}
Collapse.VERSION='3.3.4'
Collapse.TRANSITION_DURATION=350
Collapse.DEFAULTS={toggle:true}
Collapse.prototype.dimension=function(){var hasWidth=this.$element.hasClass('width')
return hasWidth?'width':'height'}
Collapse.prototype.show=function(){if(this.transitioning||this.$element.hasClass('in'))return
var activesData
var actives=this.$parent&&this.$parent.children('.panel').children('.in, .collapsing')
if(actives&&actives.length){activesData=actives.data('bs.collapse')
if(activesData&&activesData.transitioning)return}
var startEvent=$.Event('show.bs.collapse')
this.$element.trigger(startEvent)
if(startEvent.isDefaultPrevented())return
if(actives&&actives.length){Plugin.call(actives,'hide')
activesData||actives.data('bs.collapse',null)}
var dimension=this.dimension()
this.$element.removeClass('collapse').addClass('collapsing')[dimension](0).attr('aria-expanded',true)
this.$trigger.removeClass('collapsed').attr('aria-expanded',true)
this.transitioning=1
var complete=function(){this.$element.removeClass('collapsing').addClass('collapse in')[dimension]('')
this.transitioning=0
this.$element.trigger('shown.bs.collapse')}
if(!$.support.transition)return complete.call(this)
var scrollSize=$.camelCase(['scroll',dimension].join('-'))
this.$element.one('bsTransitionEnd',$.proxy(complete,this)).emulateTransitionEnd(Collapse.TRANSITION_DURATION)[dimension](this.$element[0][scrollSize])}
Collapse.prototype.hide=function(){if(this.transitioning||!this.$element.hasClass('in'))return
var startEvent=$.Event('hide.bs.collapse')
this.$element.trigger(startEvent)
if(startEvent.isDefaultPrevented())return
var dimension=this.dimension()
this.$element[dimension](this.$element[dimension]())[0].offsetHeight
this.$element.addClass('collapsing').removeClass('collapse in').attr('aria-expanded',false)
this.$trigger.addClass('collapsed').attr('aria-expanded',false)
this.transitioning=1
var complete=function(){this.transitioning=0
this.$element.removeClass('collapsing').addClass('collapse').trigger('hidden.bs.collapse')}
if(!$.support.transition)return complete.call(this)
this.$element
[dimension](0).one('bsTransitionEnd',$.proxy(complete,this)).emulateTransitionEnd(Collapse.TRANSITION_DURATION)}
Collapse.prototype.toggle=function(){this[this.$element.hasClass('in')?'hide':'show']()}
Collapse.prototype.getParent=function(){return $(this.options.parent).find('[data-toggle="collapse"][data-parent="'+this.options.parent+'"]').each($.proxy(function(i,element){var $element=$(element)
this.addAriaAndCollapsedClass(getTargetFromTrigger($element),$element)},this)).end()}
Collapse.prototype.addAriaAndCollapsedClass=function($element,$trigger){var isOpen=$element.hasClass('in')
$element.attr('aria-expanded',isOpen)
$trigger.toggleClass('collapsed',!isOpen).attr('aria-expanded',isOpen)}
function getTargetFromTrigger($trigger){var href
var target=$trigger.attr('data-target')||(href=$trigger.attr('href'))&&href.replace(/.*(?=#[^\s]+$)/,'')
return $(target)}
function Plugin(option){return this.each(function(){var $this=$(this)
var data=$this.data('bs.collapse')
var options=$.extend({},Collapse.DEFAULTS,$this.data(),typeof option=='object'&&option)
if(!data&&options.toggle&&/show|hide/.test(option))options.toggle=false
if(!data)$this.data('bs.collapse',(data=new Collapse(this,options)))
if(typeof option=='string')data[option]()})}
var old=$.fn.collapse
$.fn.collapse=Plugin
$.fn.collapse.Constructor=Collapse
$.fn.collapse.noConflict=function(){$.fn.collapse=old
return this}
$(document).on('click.bs.collapse.data-api','[data-toggle="collapse"]',function(e){var $this=$(this)
if(!$this.attr('data-target'))e.preventDefault()
var $target=getTargetFromTrigger($this)
var data=$target.data('bs.collapse')
var option=data?'toggle':$this.data()
Plugin.call($target,option)})}(jQuery);;

/* /web/static/lib/bootstrap/js/dropdown.js defined in bundle 'web.assets_backend' */
+function($){'use strict';var backdrop='.dropdown-backdrop'
var toggle='[data-toggle="dropdown"]'
var Dropdown=function(element){$(element).on('click.bs.dropdown',this.toggle)}
Dropdown.VERSION='3.3.4'
Dropdown.prototype.toggle=function(e){var $this=$(this)
if($this.is('.disabled, :disabled'))return
var $parent=getParent($this)
var isActive=$parent.hasClass('open')
if($parent[0].parentElement.attributes[0].value==='menu_more'){var listeSiblings=$($parent[0]).siblings();for(var i=0;i<=listeSiblings.length;i++){$(listeSiblings[i]).removeClass('open');}}
else
clearMenus()
if(!isActive){if('ontouchstart'in document.documentElement&&!$parent.closest('.navbar-nav').length){$('<div class="dropdown-backdrop"/>').insertAfter($(this)).on('click',clearMenus)}
var relatedTarget={relatedTarget:this}
$parent.trigger(e=$.Event('show.bs.dropdown',relatedTarget))
if(e.isDefaultPrevented())return
$this.trigger('focus').attr('aria-expanded','true')
$parent.toggleClass('open').trigger('shown.bs.dropdown',relatedTarget)}
return false}
Dropdown.prototype.keydown=function(e){if(!/(38|40|27|32)/.test(e.which)||/input|textarea/i.test(e.target.tagName))return
var $this=$(this)
e.preventDefault()
e.stopPropagation()
if($this.is('.disabled, :disabled'))return
var $parent=getParent($this)
var isActive=$parent.hasClass('open')
if((!isActive&&e.which!=27)||(isActive&&e.which==27)){if(e.which==27)$parent.find(toggle).trigger('focus')
return $this.trigger('click')}
var desc=' li:not(.disabled):visible a'
var $items=$parent.find('[role="menu"]'+desc+', [role="listbox"]'+desc)
if(!$items.length)return
var index=$items.index(e.target)
if(e.which==38&&index>0)index--
if(e.which==40&&index<$items.length-1)index++
if(!~index)index=0
$items.eq(index).trigger('focus')}
function clearMenus(e){if(e&&e.which===3)return
$(backdrop).remove()
$(toggle).each(function(){var $this=$(this)
var $parent=getParent($this)
var relatedTarget={relatedTarget:this}
if(!$parent.hasClass('open'))return
$parent.trigger(e=$.Event('hide.bs.dropdown',relatedTarget))
if(e.isDefaultPrevented())return
$this.attr('aria-expanded','false')
$parent.removeClass('open').trigger('hidden.bs.dropdown',relatedTarget)})}
function getParent($this){var selector=$this.attr('data-target')
if(!selector){selector=$this.attr('href')
selector=selector&&/#[A-Za-z]/.test(selector)&&selector.replace(/.*(?=#[^\s]*$)/,'')}
var $parent=selector&&$(selector)
return $parent&&$parent.length?$parent:$this.parent()}
function Plugin(option){return this.each(function(){var $this=$(this)
var data=$this.data('bs.dropdown')
if(!data)$this.data('bs.dropdown',(data=new Dropdown(this)))
if(typeof option=='string')data[option].call($this)})}
var old=$.fn.dropdown
$.fn.dropdown=Plugin
$.fn.dropdown.Constructor=Dropdown
$.fn.dropdown.noConflict=function(){$.fn.dropdown=old
return this}
$(document).on('click.bs.dropdown.data-api',clearMenus).on('click.bs.dropdown.data-api','.dropdown form',function(e){e.stopPropagation()}).on('click.bs.dropdown.data-api',toggle,Dropdown.prototype.toggle).on('keydown.bs.dropdown.data-api',toggle,Dropdown.prototype.keydown).on('keydown.bs.dropdown.data-api','[role="menu"]',Dropdown.prototype.keydown).on('keydown.bs.dropdown.data-api','[role="listbox"]',Dropdown.prototype.keydown)}(jQuery);;

/* /web/static/lib/bootstrap/js/modal.js defined in bundle 'web.assets_backend' */
+function($){'use strict';var Modal=function(element,options){this.options=options
this.$body=$(document.body)
this.$element=$(element)
this.$dialog=this.$element.find('.modal-dialog')
this.$backdrop=null
this.isShown=null
this.originalBodyPad=null
this.scrollbarWidth=0
this.ignoreBackdropClick=false
if(this.options.remote){this.$element.find('.modal-content').load(this.options.remote,$.proxy(function(){this.$element.trigger('loaded.bs.modal')},this))}}
Modal.VERSION='3.3.4'
Modal.TRANSITION_DURATION=300
Modal.BACKDROP_TRANSITION_DURATION=150
Modal.DEFAULTS={backdrop:true,keyboard:true,show:true}
Modal.prototype.toggle=function(_relatedTarget){return this.isShown?this.hide():this.show(_relatedTarget)}
Modal.prototype.show=function(_relatedTarget){var that=this
var e=$.Event('show.bs.modal',{relatedTarget:_relatedTarget})
this.$element.trigger(e)
if(this.isShown||e.isDefaultPrevented())return
this.isShown=true
this.checkScrollbar()
this.setScrollbar()
this.$body.addClass('modal-open')
this.escape()
this.resize()
this.$element.on('click.dismiss.bs.modal','[data-dismiss="modal"]',$.proxy(this.hide,this))
this.$dialog.on('mousedown.dismiss.bs.modal',function(){that.$element.one('mouseup.dismiss.bs.modal',function(e){if($(e.target).is(that.$element))that.ignoreBackdropClick=true})})
this.backdrop(function(){var transition=$.support.transition&&that.$element.hasClass('fade')
if(!that.$element.parent().length){that.$element.appendTo(that.$body)}
that.$element.show().scrollTop(0)
that.adjustDialog()
if(transition){that.$element[0].offsetWidth}
that.$element.addClass('in').attr('aria-hidden',false)
that.enforceFocus()
var e=$.Event('shown.bs.modal',{relatedTarget:_relatedTarget})
transition?that.$dialog.one('bsTransitionEnd',function(){that.$element.trigger('focus').trigger(e)}).emulateTransitionEnd(Modal.TRANSITION_DURATION):that.$element.trigger('focus').trigger(e)})}
Modal.prototype.hide=function(e){if(e)e.preventDefault()
e=$.Event('hide.bs.modal')
this.$element.trigger(e)
if(!this.isShown||e.isDefaultPrevented())return
this.isShown=false
this.escape()
this.resize()
$(document).off('focusin.bs.modal')
this.$element.removeClass('in').attr('aria-hidden',true).off('click.dismiss.bs.modal').off('mouseup.dismiss.bs.modal')
this.$dialog.off('mousedown.dismiss.bs.modal')
$.support.transition&&this.$element.hasClass('fade')?this.$element.one('bsTransitionEnd',$.proxy(this.hideModal,this)).emulateTransitionEnd(Modal.TRANSITION_DURATION):this.hideModal()}
Modal.prototype.enforceFocus=function(){$(document).off('focusin.bs.modal').on('focusin.bs.modal',$.proxy(function(e){if(this.$element[0]!==e.target&&!this.$element.has(e.target).length){this.$element.trigger('focus')}},this))}
Modal.prototype.escape=function(){if(this.isShown&&this.options.keyboard){this.$element.on('keydown.dismiss.bs.modal',$.proxy(function(e){e.which==27&&this.hide()},this))}else if(!this.isShown){this.$element.off('keydown.dismiss.bs.modal')}}
Modal.prototype.resize=function(){if(this.isShown){$(window).on('resize.bs.modal',$.proxy(this.handleUpdate,this))}else{$(window).off('resize.bs.modal')}}
Modal.prototype.hideModal=function(){var that=this
this.$element.hide()
this.backdrop(function(){that.$body.removeClass('modal-open')
that.resetAdjustments()
that.resetScrollbar()
that.$element.trigger('hidden.bs.modal')})}
Modal.prototype.removeBackdrop=function(){this.$backdrop&&this.$backdrop.remove()
this.$backdrop=null}
Modal.prototype.backdrop=function(callback){var that=this
var animate=this.$element.hasClass('fade')?'fade':''
if(this.isShown&&this.options.backdrop){var doAnimate=$.support.transition&&animate
this.$backdrop=$('<div class="modal-backdrop '+animate+'" />').appendTo(this.$body)
this.$element.on('click.dismiss.bs.modal',$.proxy(function(e){if(this.ignoreBackdropClick){this.ignoreBackdropClick=false
return}
if(e.target!==e.currentTarget)return
this.options.backdrop=='static'?this.$element[0].focus():this.hide()},this))
if(doAnimate)this.$backdrop[0].offsetWidth
this.$backdrop.addClass('in')
if(!callback)return
doAnimate?this.$backdrop.one('bsTransitionEnd',callback).emulateTransitionEnd(Modal.BACKDROP_TRANSITION_DURATION):callback()}else if(!this.isShown&&this.$backdrop){this.$backdrop.removeClass('in')
var callbackRemove=function(){that.removeBackdrop()
callback&&callback()}
$.support.transition&&this.$element.hasClass('fade')?this.$backdrop.one('bsTransitionEnd',callbackRemove).emulateTransitionEnd(Modal.BACKDROP_TRANSITION_DURATION):callbackRemove()}else if(callback){callback()}}
Modal.prototype.handleUpdate=function(){this.adjustDialog()}
Modal.prototype.adjustDialog=function(){var modalIsOverflowing=this.$element[0].scrollHeight>document.documentElement.clientHeight
this.$element.css({paddingLeft:!this.bodyIsOverflowing&&modalIsOverflowing?this.scrollbarWidth:'',paddingRight:this.bodyIsOverflowing&&!modalIsOverflowing?this.scrollbarWidth:''})}
Modal.prototype.resetAdjustments=function(){this.$element.css({paddingLeft:'',paddingRight:''})}
Modal.prototype.checkScrollbar=function(){var fullWindowWidth=window.innerWidth
if(!fullWindowWidth){var documentElementRect=document.documentElement.getBoundingClientRect()
fullWindowWidth=documentElementRect.right-Math.abs(documentElementRect.left)}
this.bodyIsOverflowing=document.body.clientWidth<fullWindowWidth
this.scrollbarWidth=this.measureScrollbar()}
Modal.prototype.setScrollbar=function(){var bodyPad=parseInt((this.$body.css('padding-right')||0),10)
this.originalBodyPad=document.body.style.paddingRight||''
if(this.bodyIsOverflowing)this.$body.css('padding-right',bodyPad+this.scrollbarWidth)}
Modal.prototype.resetScrollbar=function(){this.$body.css('padding-right',this.originalBodyPad)}
Modal.prototype.measureScrollbar=function(){var scrollDiv=document.createElement('div')
scrollDiv.className='modal-scrollbar-measure'
this.$body.append(scrollDiv)
var scrollbarWidth=scrollDiv.offsetWidth-scrollDiv.clientWidth
this.$body[0].removeChild(scrollDiv)
return scrollbarWidth}
function Plugin(option,_relatedTarget){return this.each(function(){var $this=$(this)
var data=$this.data('bs.modal')
var options=$.extend({},Modal.DEFAULTS,$this.data(),typeof option=='object'&&option)
if(!data)$this.data('bs.modal',(data=new Modal(this,options)))
if(typeof option=='string')data[option](_relatedTarget)
else if(options.show)data.show(_relatedTarget)})}
var old=$.fn.modal
$.fn.modal=Plugin
$.fn.modal.Constructor=Modal
$.fn.modal.noConflict=function(){$.fn.modal=old
return this}
$(document).on('click.bs.modal.data-api','[data-toggle="modal"]',function(e){var $this=$(this)
var href=$this.attr('href')
var $target=$($this.attr('data-target')||(href&&href.replace(/.*(?=#[^\s]+$)/,'')))
var option=$target.data('bs.modal')?'toggle':$.extend({remote:!/#/.test(href)&&href},$target.data(),$this.data())
if($this.is('a'))e.preventDefault()
$target.one('show.bs.modal',function(showEvent){if(showEvent.isDefaultPrevented())return
$target.one('hidden.bs.modal',function(){$this.is(':visible')&&$this.trigger('focus')})})
Plugin.call($target,option,this)})}(jQuery);;

/* /web/static/lib/bootstrap/js/tooltip.js defined in bundle 'web.assets_backend' */
+function($){'use strict';var Tooltip=function(element,options){this.type=null
this.options=null
this.enabled=null
this.timeout=null
this.hoverState=null
this.$element=null
this.init('tooltip',element,options)}
Tooltip.VERSION='3.3.4'
Tooltip.TRANSITION_DURATION=150
Tooltip.DEFAULTS={animation:true,placement:'top',selector:false,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:'hover focus',title:'',delay:0,html:false,container:false,viewport:{selector:'body',padding:0}}
Tooltip.prototype.init=function(type,element,options){this.enabled=true
this.type=type
this.$element=$(element)
this.options=this.getOptions(options)
this.$viewport=this.options.viewport&&$(this.options.viewport.selector||this.options.viewport)
if(this.$element[0]instanceof document.constructor&&!this.options.selector){throw new Error('`selector` option must be specified when initializing '+this.type+' on the window.document object!')}
var triggers=this.options.trigger.split(' ')
for(var i=triggers.length;i--;){var trigger=triggers[i]
if(trigger=='click'){this.$element.on('click.'+this.type,this.options.selector,$.proxy(this.toggle,this))}else if(trigger!='manual'){var eventIn=trigger=='hover'?'mouseenter':'focusin'
var eventOut=trigger=='hover'?'mouseleave':'focusout'
this.$element.on(eventIn+'.'+this.type,this.options.selector,$.proxy(this.enter,this))
this.$element.on(eventOut+'.'+this.type,this.options.selector,$.proxy(this.leave,this))}}
this.options.selector?(this._options=$.extend({},this.options,{trigger:'manual',selector:''})):this.fixTitle()}
Tooltip.prototype.getDefaults=function(){return Tooltip.DEFAULTS}
Tooltip.prototype.getOptions=function(options){options=$.extend({},this.getDefaults(),this.$element.data(),options)
if(options.delay&&typeof options.delay=='number'){options.delay={show:options.delay,hide:options.delay}}
return options}
Tooltip.prototype.getDelegateOptions=function(){var options={}
var defaults=this.getDefaults()
this._options&&$.each(this._options,function(key,value){if(defaults[key]!=value)options[key]=value})
return options}
Tooltip.prototype.enter=function(obj){var self=obj instanceof this.constructor?obj:$(obj.currentTarget).data('bs.'+this.type)
if(self&&self.$tip&&self.$tip.is(':visible')){self.hoverState='in'
return}
if(!self){self=new this.constructor(obj.currentTarget,this.getDelegateOptions())
$(obj.currentTarget).data('bs.'+this.type,self)}
clearTimeout(self.timeout)
self.hoverState='in'
if(!self.options.delay||!self.options.delay.show)return self.show()
self.timeout=setTimeout(function(){if(self.hoverState=='in')self.show()},self.options.delay.show)}
Tooltip.prototype.leave=function(obj){var self=obj instanceof this.constructor?obj:$(obj.currentTarget).data('bs.'+this.type)
if(!self){self=new this.constructor(obj.currentTarget,this.getDelegateOptions())
$(obj.currentTarget).data('bs.'+this.type,self)}
clearTimeout(self.timeout)
self.hoverState='out'
if(!self.options.delay||!self.options.delay.hide)return self.hide()
self.timeout=setTimeout(function(){if(self.hoverState=='out')self.hide()},self.options.delay.hide)}
Tooltip.prototype.show=function(){var e=$.Event('show.bs.'+this.type)
if(this.hasContent()&&this.enabled){this.$element.trigger(e)
var inDom=$.contains(this.$element[0].ownerDocument.documentElement,this.$element[0])
if(e.isDefaultPrevented()||!inDom)return
var that=this
var $tip=this.tip()
var tipId=this.getUID(this.type)
this.setContent()
$tip.attr('id',tipId)
this.$element.attr('aria-describedby',tipId)
if(this.options.animation)$tip.addClass('fade')
var placement=typeof this.options.placement=='function'?this.options.placement.call(this,$tip[0],this.$element[0]):this.options.placement
var autoToken=/\s?auto?\s?/i
var autoPlace=autoToken.test(placement)
if(autoPlace)placement=placement.replace(autoToken,'')||'top'
$tip.detach().css({top:0,left:0,display:'block'}).addClass(placement).data('bs.'+this.type,this)
this.options.container?$tip.appendTo(this.options.container):$tip.insertAfter(this.$element)
var pos=this.getPosition()
var actualWidth=$tip[0].offsetWidth
var actualHeight=$tip[0].offsetHeight
if(autoPlace){var orgPlacement=placement
var $container=this.options.container?$(this.options.container):this.$element.parent()
var containerDim=this.getPosition($container)
placement=placement=='bottom'&&pos.bottom+actualHeight>containerDim.bottom?'top':placement=='top'&&pos.top-actualHeight<containerDim.top?'bottom':placement=='right'&&pos.right+actualWidth>containerDim.width?'left':placement=='left'&&pos.left-actualWidth<containerDim.left?'right':placement
$tip.removeClass(orgPlacement).addClass(placement)}
var calculatedOffset=this.getCalculatedOffset(placement,pos,actualWidth,actualHeight)
this.applyPlacement(calculatedOffset,placement)
var complete=function(){var prevHoverState=that.hoverState
that.$element.trigger('shown.bs.'+that.type)
that.hoverState=null
if(prevHoverState=='out')that.leave(that)}
$.support.transition&&this.$tip.hasClass('fade')?$tip.one('bsTransitionEnd',complete).emulateTransitionEnd(Tooltip.TRANSITION_DURATION):complete()}}
Tooltip.prototype.applyPlacement=function(offset,placement){var $tip=this.tip()
var width=$tip[0].offsetWidth
var height=$tip[0].offsetHeight
var marginTop=parseInt($tip.css('margin-top'),10)
var marginLeft=parseInt($tip.css('margin-left'),10)
if(isNaN(marginTop))marginTop=0
if(isNaN(marginLeft))marginLeft=0
offset.top=offset.top+marginTop
offset.left=offset.left+marginLeft
$.offset.setOffset($tip[0],$.extend({using:function(props){$tip.css({top:Math.round(props.top),left:Math.round(props.left)})}},offset),0)
$tip.addClass('in')
var actualWidth=$tip[0].offsetWidth
var actualHeight=$tip[0].offsetHeight
if(placement=='top'&&actualHeight!=height){offset.top=offset.top+height-actualHeight}
var delta=this.getViewportAdjustedDelta(placement,offset,actualWidth,actualHeight)
if(delta.left)offset.left+=delta.left
else offset.top+=delta.top
var isVertical=/top|bottom/.test(placement)
var arrowDelta=isVertical?delta.left*2-width+actualWidth:delta.top*2-height+actualHeight
var arrowOffsetPosition=isVertical?'offsetWidth':'offsetHeight'
$tip.offset(offset)
this.replaceArrow(arrowDelta,$tip[0][arrowOffsetPosition],isVertical)}
Tooltip.prototype.replaceArrow=function(delta,dimension,isVertical){this.arrow().css(isVertical?'left':'top',50*(1-delta/dimension)+'%').css(isVertical?'top':'left','')}
Tooltip.prototype.setContent=function(){var $tip=this.tip()
var title=this.getTitle()
$tip.find('.tooltip-inner')[this.options.html?'html':'text'](title)
$tip.removeClass('fade in top bottom left right')}
Tooltip.prototype.hide=function(callback){var that=this
var $tip=$(this.$tip)
var e=$.Event('hide.bs.'+this.type)
function complete(){if(that.hoverState!='in')$tip.detach()
that.$element.removeAttr('aria-describedby').trigger('hidden.bs.'+that.type)
callback&&callback()}
this.$element.trigger(e)
if(e.isDefaultPrevented())return
$tip.removeClass('in')
$.support.transition&&$tip.hasClass('fade')?$tip.one('bsTransitionEnd',complete).emulateTransitionEnd(Tooltip.TRANSITION_DURATION):complete()
this.hoverState=null
return this}
Tooltip.prototype.fixTitle=function(){var $e=this.$element
if($e.attr('title')||typeof($e.attr('data-original-title'))!='string'){$e.attr('data-original-title',$e.attr('title')||'').attr('title','')}}
Tooltip.prototype.hasContent=function(){return this.getTitle()}
Tooltip.prototype.getPosition=function($element){$element=$element||this.$element
var el=$element[0]
var isBody=el.tagName=='BODY'
var elRect=el.getBoundingClientRect()
if(elRect.width==null){elRect=$.extend({},elRect,{width:elRect.right-elRect.left,height:elRect.bottom-elRect.top})}
var elOffset=isBody?{top:0,left:0}:$element.offset()
var scroll={scroll:isBody?document.documentElement.scrollTop||document.body.scrollTop:$element.scrollTop()}
var outerDims=isBody?{width:$(window).width(),height:$(window).height()}:null
return $.extend({},elRect,scroll,outerDims,elOffset)}
Tooltip.prototype.getCalculatedOffset=function(placement,pos,actualWidth,actualHeight){return placement=='bottom'?{top:pos.top+pos.height,left:pos.left+pos.width/2-actualWidth/2}:placement=='top'?{top:pos.top-actualHeight,left:pos.left+pos.width/2-actualWidth/2}:placement=='left'?{top:pos.top+pos.height/2-actualHeight/2,left:pos.left-actualWidth}:{top:pos.top+pos.height/2-actualHeight/2,left:pos.left+pos.width}}
Tooltip.prototype.getViewportAdjustedDelta=function(placement,pos,actualWidth,actualHeight){var delta={top:0,left:0}
if(!this.$viewport)return delta
var viewportPadding=this.options.viewport&&this.options.viewport.padding||0
var viewportDimensions=this.getPosition(this.$viewport)
if(/right|left/.test(placement)){var topEdgeOffset=pos.top-viewportPadding-viewportDimensions.scroll
var bottomEdgeOffset=pos.top+viewportPadding-viewportDimensions.scroll+actualHeight
if(topEdgeOffset<viewportDimensions.top){delta.top=viewportDimensions.top-topEdgeOffset}else if(bottomEdgeOffset>viewportDimensions.top+viewportDimensions.height){delta.top=viewportDimensions.top+viewportDimensions.height-bottomEdgeOffset}}else{var leftEdgeOffset=pos.left-viewportPadding
var rightEdgeOffset=pos.left+viewportPadding+actualWidth
if(leftEdgeOffset<viewportDimensions.left){delta.left=viewportDimensions.left-leftEdgeOffset}else if(rightEdgeOffset>viewportDimensions.width){delta.left=viewportDimensions.left+viewportDimensions.width-rightEdgeOffset}}
return delta}
Tooltip.prototype.getTitle=function(){var title
var $e=this.$element
var o=this.options
title=$e.attr('data-original-title')||(typeof o.title=='function'?o.title.call($e[0]):o.title)
return title}
Tooltip.prototype.getUID=function(prefix){do prefix+=~~(Math.random()*1000000)
while(document.getElementById(prefix))
return prefix}
Tooltip.prototype.tip=function(){return(this.$tip=this.$tip||$(this.options.template))}
Tooltip.prototype.arrow=function(){return(this.$arrow=this.$arrow||this.tip().find('.tooltip-arrow'))}
Tooltip.prototype.enable=function(){this.enabled=true}
Tooltip.prototype.disable=function(){this.enabled=false}
Tooltip.prototype.toggleEnabled=function(){this.enabled=!this.enabled}
Tooltip.prototype.toggle=function(e){var self=this
if(e){self=$(e.currentTarget).data('bs.'+this.type)
if(!self){self=new this.constructor(e.currentTarget,this.getDelegateOptions())
$(e.currentTarget).data('bs.'+this.type,self)}}
self.tip().hasClass('in')?self.leave(self):self.enter(self)}
Tooltip.prototype.destroy=function(){var that=this
clearTimeout(this.timeout)
this.hide(function(){that.$element.off('.'+that.type).removeData('bs.'+that.type)})}
function Plugin(option){return this.each(function(){var $this=$(this)
var data=$this.data('bs.tooltip')
var options=typeof option=='object'&&option
if(!data&&/destroy|hide/.test(option))return
if(!data)$this.data('bs.tooltip',(data=new Tooltip(this,options)))
if(typeof option=='string')data[option]()})}
var old=$.fn.tooltip
$.fn.tooltip=Plugin
$.fn.tooltip.Constructor=Tooltip
$.fn.tooltip.noConflict=function(){$.fn.tooltip=old
return this}}(jQuery);;

/* /web/static/lib/bootstrap/js/popover.js defined in bundle 'web.assets_backend' */
+function($){'use strict';var Popover=function(element,options){this.init('popover',element,options)}
if(!$.fn.tooltip)throw new Error('Popover requires tooltip.js')
Popover.VERSION='3.3.4'
Popover.DEFAULTS=$.extend({},$.fn.tooltip.Constructor.DEFAULTS,{placement:'right',trigger:'click',content:'',template:'<div class="popover" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'})
Popover.prototype=$.extend({},$.fn.tooltip.Constructor.prototype)
Popover.prototype.constructor=Popover
Popover.prototype.getDefaults=function(){return Popover.DEFAULTS}
Popover.prototype.setContent=function(){var $tip=this.tip()
var title=this.getTitle()
var content=this.getContent()
$tip.find('.popover-title')[this.options.html?'html':'text'](title)
$tip.find('.popover-content').children().detach().end()[this.options.html?(typeof content=='string'?'html':'append'):'text'](content)
$tip.removeClass('fade top bottom left right in')
if(!$tip.find('.popover-title').html())$tip.find('.popover-title').hide()}
Popover.prototype.hasContent=function(){return this.getTitle()||this.getContent()}
Popover.prototype.getContent=function(){var $e=this.$element
var o=this.options
return $e.attr('data-content')||(typeof o.content=='function'?o.content.call($e[0]):o.content)}
Popover.prototype.arrow=function(){return(this.$arrow=this.$arrow||this.tip().find('.arrow'))}
function Plugin(option){return this.each(function(){var $this=$(this)
var data=$this.data('bs.popover')
var options=typeof option=='object'&&option
if(!data&&/destroy|hide/.test(option))return
if(!data)$this.data('bs.popover',(data=new Popover(this,options)))
if(typeof option=='string')data[option]()})}
var old=$.fn.popover
$.fn.popover=Plugin
$.fn.popover.Constructor=Popover
$.fn.popover.noConflict=function(){$.fn.popover=old
return this}}(jQuery);;

/* /web/static/lib/bootstrap/js/scrollspy.js defined in bundle 'web.assets_backend' */
+function($){'use strict';function ScrollSpy(element,options){this.$body=$(document.body)
this.$scrollElement=$(element).is(document.body)?$(window):$(element)
this.options=$.extend({},ScrollSpy.DEFAULTS,options)
this.selector=(this.options.target||'')+' .nav li > a'
this.offsets=[]
this.targets=[]
this.activeTarget=null
this.scrollHeight=0
this.$scrollElement.on('scroll.bs.scrollspy',$.proxy(this.process,this))
this.refresh()
this.process()}
ScrollSpy.VERSION='3.3.4'
ScrollSpy.DEFAULTS={offset:10}
ScrollSpy.prototype.getScrollHeight=function(){return this.$scrollElement[0].scrollHeight||Math.max(this.$body[0].scrollHeight,document.documentElement.scrollHeight)}
ScrollSpy.prototype.refresh=function(){var that=this
var offsetMethod='offset'
var offsetBase=0
this.offsets=[]
this.targets=[]
this.scrollHeight=this.getScrollHeight()
if(!$.isWindow(this.$scrollElement[0])){offsetMethod='position'
offsetBase=this.$scrollElement.scrollTop()}
this.$body.find(this.selector).map(function(){var $el=$(this)
var href=$el.data('target')||$el.attr('href')
var $href=/^#./.test(href)&&$(href)
return($href&&$href.length&&$href.is(':visible')&&[[$href[offsetMethod]().top+offsetBase,href]])||null}).sort(function(a,b){return a[0]-b[0]}).each(function(){that.offsets.push(this[0])
that.targets.push(this[1])})}
ScrollSpy.prototype.process=function(){var scrollTop=this.$scrollElement.scrollTop()+this.options.offset
var scrollHeight=this.getScrollHeight()
var maxScroll=this.options.offset+scrollHeight-this.$scrollElement.height()
var offsets=this.offsets
var targets=this.targets
var activeTarget=this.activeTarget
var i
if(this.scrollHeight!=scrollHeight){this.refresh()}
if(scrollTop>=maxScroll){return activeTarget!=(i=targets[targets.length-1])&&this.activate(i)}
if(activeTarget&&scrollTop<offsets[0]){this.activeTarget=null
return this.clear()}
for(i=offsets.length;i--;){activeTarget!=targets[i]&&scrollTop>=offsets[i]&&(offsets[i+1]===undefined||scrollTop<offsets[i+1])&&this.activate(targets[i])}}
ScrollSpy.prototype.activate=function(target){this.activeTarget=target
this.clear()
var selector=this.selector+'[data-target="'+target+'"],'+
this.selector+'[href="'+target+'"]'
var active=$(selector).parents('li').addClass('active')
if(active.parent('.dropdown-menu').length){active=active.closest('li.dropdown').addClass('active')}
active.trigger('activate.bs.scrollspy')}
ScrollSpy.prototype.clear=function(){$(this.selector).parentsUntil(this.options.target,'.active').removeClass('active')}
function Plugin(option){return this.each(function(){var $this=$(this)
var data=$this.data('bs.scrollspy')
var options=typeof option=='object'&&option
if(!data)$this.data('bs.scrollspy',(data=new ScrollSpy(this,options)))
if(typeof option=='string')data[option]()})}
var old=$.fn.scrollspy
$.fn.scrollspy=Plugin
$.fn.scrollspy.Constructor=ScrollSpy
$.fn.scrollspy.noConflict=function(){$.fn.scrollspy=old
return this}
$(window).on('load.bs.scrollspy.data-api',function(){$('[data-spy="scroll"]').each(function(){var $spy=$(this)
Plugin.call($spy,$spy.data())})})}(jQuery);;

/* /web/static/lib/bootstrap/js/tab.js defined in bundle 'web.assets_backend' */
+function($){'use strict';var Tab=function(element){this.element=$(element)}
Tab.VERSION='3.3.4'
Tab.TRANSITION_DURATION=150
Tab.prototype.show=function(){var $this=this.element
var $ul=$this.closest('ul:not(.dropdown-menu)')
var selector=$this.data('target')
if(!selector){selector=$this.attr('href')
selector=selector&&selector.replace(/.*(?=#[^\s]*$)/,'')}
if($this.parent('li').hasClass('active'))return
var $previous=$ul.find('.active:last a')
var hideEvent=$.Event('hide.bs.tab',{relatedTarget:$this[0]})
var showEvent=$.Event('show.bs.tab',{relatedTarget:$previous[0]})
$previous.trigger(hideEvent)
$this.trigger(showEvent)
if(showEvent.isDefaultPrevented()||hideEvent.isDefaultPrevented())return
var $target=$(selector)
this.activate($this.closest('li'),$ul)
this.activate($target,$target.parent(),function(){$previous.trigger({type:'hidden.bs.tab',relatedTarget:$this[0]})
$this.trigger({type:'shown.bs.tab',relatedTarget:$previous[0]})})}
Tab.prototype.activate=function(element,container,callback){var $active=container.find('> .active')
var transition=callback&&$.support.transition&&(($active.length&&$active.hasClass('fade'))||!!container.find('> .fade').length)
function next(){$active.removeClass('active').find('> .dropdown-menu > .active').removeClass('active').end().find('[data-toggle="tab"]').attr('aria-expanded',false)
element.addClass('active').find('[data-toggle="tab"]').attr('aria-expanded',true)
if(transition){element[0].offsetWidth
element.addClass('in')}else{element.removeClass('fade')}
if(element.parent('.dropdown-menu').length){element.closest('li.dropdown').addClass('active').end().find('[data-toggle="tab"]').attr('aria-expanded',true)}
callback&&callback()}
$active.length&&transition?$active.one('bsTransitionEnd',next).emulateTransitionEnd(Tab.TRANSITION_DURATION):next()
$active.removeClass('in')}
function Plugin(option){return this.each(function(){var $this=$(this)
var data=$this.data('bs.tab')
if(!data)$this.data('bs.tab',(data=new Tab(this)))
if(typeof option=='string')data[option]()})}
var old=$.fn.tab
$.fn.tab=Plugin
$.fn.tab.Constructor=Tab
$.fn.tab.noConflict=function(){$.fn.tab=old
return this}
var clickHandler=function(e){e.preventDefault()
Plugin.call($(this),'show')}
$(document).on('click.bs.tab.data-api','[data-toggle="tab"]',clickHandler).on('click.bs.tab.data-api','[data-toggle="pill"]',clickHandler)}(jQuery);;

/* /web/static/lib/bootstrap/js/transition.js defined in bundle 'web.assets_backend' */
+function($){'use strict';function transitionEnd(){var el=document.createElement('bootstrap')
var transEndEventNames={WebkitTransition:'webkitTransitionEnd',MozTransition:'transitionend',OTransition:'oTransitionEnd otransitionend',transition:'transitionend'}
for(var name in transEndEventNames){if(el.style[name]!==undefined){return{end:transEndEventNames[name]}}}
return false}
$.fn.emulateTransitionEnd=function(duration){var called=false
var $el=this
$(this).one('bsTransitionEnd',function(){called=true})
var callback=function(){if(!called)$($el).trigger($.support.transition.end)}
setTimeout(callback,duration)
return this}
$(function(){$.support.transition=transitionEnd()
if(!$.support.transition)return
$.event.special.bsTransitionEnd={bindType:$.support.transition.end,delegateType:$.support.transition.end,handle:function(e){if($(e.target).is(this))return e.handleObj.handler.apply(this,arguments)}}})}(jQuery);;

/* /web/static/lib/jquery.ui.notify/js/jquery.notify.js defined in bundle 'web.assets_backend' */
(function($){$.widget("ech.notify",{options:{speed:500,expires:5000,stack:'below',custom:false},_create:function(){var self=this;this.templates={};this.keys=[];this.element.addClass("ui-notify").children().addClass("ui-notify-message ui-notify-message-style").each(function(i){var key=this.id||i;self.keys.push(key);self.templates[key]=$(this).removeAttr("id").wrap("<div></div>").parent().html();}).end().empty().show();},create:function(template,msg,opts){if(typeof template==="object"){opts=msg;msg=template;template=null;}
var tpl=this.templates[template||this.keys[0]];if(opts&&opts.custom){tpl=$(tpl).removeClass("ui-notify-message-style").wrap("<div></div>").parent().html();}
return new $.ech.notify.instance(this)._create(msg,$.extend({},this.options,opts),tpl);}});$.extend($.ech.notify,{instance:function(widget){this.parent=widget;this.isOpen=false;}});$.extend($.ech.notify.instance.prototype,{_create:function(params,options,template){this.options=options;var self=this,html=template.replace(/#(?:\{|%7B)(.*?)(?:\}|%7D)/g,function($1,$2){return($2 in params)?params[$2]:'';}),m=(this.element=$(html)),closelink=m.find(".ui-notify-close");if(typeof this.options.click==="function"){m.addClass("ui-notify-click").bind("click",function(e){self._trigger("click",e,self);});}
if(closelink.length){closelink.bind("click",function(){self.close();return false;});}
this.open();if(typeof options.expires==="number"){window.setTimeout(function(){self.close();},options.expires);}
return this;},close:function(){var self=this,speed=this.options.speed;this.element.fadeTo(speed,0).slideUp(speed,function(){self._trigger("close");self.isOpen=false;});return this;},open:function(){if(this.isOpen||this._trigger("beforeopen")===false){return this;}
var self=this;this.element[this.options.stack==='above'?'prependTo':'appendTo'](this.parent.element).css({display:"none",opacity:""}).fadeIn(this.options.speed,function(){self._trigger("open");self.isOpen=true;});return this;},widget:function(){return this.element;},_trigger:function(type,e,instance){return this.parent._trigger.call(this,type,e,instance);}});})(jQuery);;

/* /web/static/lib/nvd3/d3.v3.js defined in bundle 'web.assets_backend' */
!function(){var d3={version:"3.5.6"};var d3_arraySlice=[].slice,d3_array=function(list){return d3_arraySlice.call(list);};var d3_document=this.document;function d3_documentElement(node){return node&&(node.ownerDocument||node.document||node).documentElement;}
function d3_window(node){return node&&(node.ownerDocument&&node.ownerDocument.defaultView||node.document&&node||node.defaultView);}
if(d3_document){try{d3_array(d3_document.documentElement.childNodes)[0].nodeType;}catch(e){d3_array=function(list){var i=list.length,array=new Array(i);while(i--)array[i]=list[i];return array;};}}
if(!Date.now)Date.now=function(){return+new Date();};if(d3_document){try{d3_document.createElement("DIV").style.setProperty("opacity",0,"");}catch(error){var d3_element_prototype=this.Element.prototype,d3_element_setAttribute=d3_element_prototype.setAttribute,d3_element_setAttributeNS=d3_element_prototype.setAttributeNS,d3_style_prototype=this.CSSStyleDeclaration.prototype,d3_style_setProperty=d3_style_prototype.setProperty;d3_element_prototype.setAttribute=function(name,value){d3_element_setAttribute.call(this,name,value+"");};d3_element_prototype.setAttributeNS=function(space,local,value){d3_element_setAttributeNS.call(this,space,local,value+"");};d3_style_prototype.setProperty=function(name,value,priority){d3_style_setProperty.call(this,name,value+"",priority);};}}
d3.ascending=d3_ascending;function d3_ascending(a,b){return a<b?-1:a>b?1:a>=b?0:NaN;}
d3.descending=function(a,b){return b<a?-1:b>a?1:b>=a?0:NaN;};d3.min=function(array,f){var i=-1,n=array.length,a,b;if(arguments.length===1){while(++i<n)if((b=array[i])!=null&&b>=b){a=b;break;}
while(++i<n)if((b=array[i])!=null&&a>b)a=b;}else{while(++i<n)if((b=f.call(array,array[i],i))!=null&&b>=b){a=b;break;}
while(++i<n)if((b=f.call(array,array[i],i))!=null&&a>b)a=b;}
return a;};d3.max=function(array,f){var i=-1,n=array.length,a,b;if(arguments.length===1){while(++i<n)if((b=array[i])!=null&&b>=b){a=b;break;}
while(++i<n)if((b=array[i])!=null&&b>a)a=b;}else{while(++i<n)if((b=f.call(array,array[i],i))!=null&&b>=b){a=b;break;}
while(++i<n)if((b=f.call(array,array[i],i))!=null&&b>a)a=b;}
return a;};d3.extent=function(array,f){var i=-1,n=array.length,a,b,c;if(arguments.length===1){while(++i<n)if((b=array[i])!=null&&b>=b){a=c=b;break;}
while(++i<n)if((b=array[i])!=null){if(a>b)a=b;if(c<b)c=b;}}else{while(++i<n)if((b=f.call(array,array[i],i))!=null&&b>=b){a=c=b;break;}
while(++i<n)if((b=f.call(array,array[i],i))!=null){if(a>b)a=b;if(c<b)c=b;}}
return[a,c];};function d3_number(x){return x===null?NaN:+x;}
function d3_numeric(x){return!isNaN(x);}
d3.sum=function(array,f){var s=0,n=array.length,a,i=-1;if(arguments.length===1){while(++i<n)if(d3_numeric(a=+array[i]))s+=a;}else{while(++i<n)if(d3_numeric(a=+f.call(array,array[i],i)))s+=a;}
return s;};d3.mean=function(array,f){var s=0,n=array.length,a,i=-1,j=n;if(arguments.length===1){while(++i<n)if(d3_numeric(a=d3_number(array[i])))s+=a;else--j;}else{while(++i<n)if(d3_numeric(a=d3_number(f.call(array,array[i],i))))s+=a;else--j;}
if(j)return s/j;};d3.quantile=function(values,p){var H=(values.length-1)*p+1,h=Math.floor(H),v=+values[h-1],e=H-h;return e?v+e*(values[h]-v):v;};d3.median=function(array,f){var numbers=[],n=array.length,a,i=-1;if(arguments.length===1){while(++i<n)if(d3_numeric(a=d3_number(array[i])))numbers.push(a);}else{while(++i<n)if(d3_numeric(a=d3_number(f.call(array,array[i],i))))numbers.push(a);}
if(numbers.length)return d3.quantile(numbers.sort(d3_ascending),.5);};d3.variance=function(array,f){var n=array.length,m=0,a,d,s=0,i=-1,j=0;if(arguments.length===1){while(++i<n){if(d3_numeric(a=d3_number(array[i]))){d=a-m;m+=d/++j;s+=d*(a-m);}}}else{while(++i<n){if(d3_numeric(a=d3_number(f.call(array,array[i],i)))){d=a-m;m+=d/++j;s+=d*(a-m);}}}
if(j>1)return s/(j-1);};d3.deviation=function(){var v=d3.variance.apply(this,arguments);return v?Math.sqrt(v):v;};function d3_bisector(compare){return{left:function(a,x,lo,hi){if(arguments.length<3)lo=0;if(arguments.length<4)hi=a.length;while(lo<hi){var mid=lo+hi>>>1;if(compare(a[mid],x)<0)lo=mid+1;else hi=mid;}
return lo;},right:function(a,x,lo,hi){if(arguments.length<3)lo=0;if(arguments.length<4)hi=a.length;while(lo<hi){var mid=lo+hi>>>1;if(compare(a[mid],x)>0)hi=mid;else lo=mid+1;}
return lo;}};}
var d3_bisect=d3_bisector(d3_ascending);d3.bisectLeft=d3_bisect.left;d3.bisect=d3.bisectRight=d3_bisect.right;d3.bisector=function(f){return d3_bisector(f.length===1?function(d,x){return d3_ascending(f(d),x);}:f);};d3.shuffle=function(array,i0,i1){if((m=arguments.length)<3){i1=array.length;if(m<2)i0=0;}
var m=i1-i0,t,i;while(m){i=Math.random()*m--|0;t=array[m+i0],array[m+i0]=array[i+i0],array[i+i0]=t;}
return array;};d3.permute=function(array,indexes){var i=indexes.length,permutes=new Array(i);while(i--)permutes[i]=array[indexes[i]];return permutes;};d3.pairs=function(array){var i=0,n=array.length-1,p0,p1=array[0],pairs=new Array(n<0?0:n);while(i<n)pairs[i]=[p0=p1,p1=array[++i]];return pairs;};d3.zip=function(){if(!(n=arguments.length))return[];for(var i=-1,m=d3.min(arguments,d3_zipLength),zips=new Array(m);++i<m;){for(var j=-1,n,zip=zips[i]=new Array(n);++j<n;){zip[j]=arguments[j][i];}}
return zips;};function d3_zipLength(d){return d.length;}
d3.transpose=function(matrix){return d3.zip.apply(d3,matrix);};d3.keys=function(map){var keys=[];for(var key in map)keys.push(key);return keys;};d3.values=function(map){var values=[];for(var key in map)values.push(map[key]);return values;};d3.entries=function(map){var entries=[];for(var key in map)entries.push({key:key,value:map[key]});return entries;};d3.merge=function(arrays){var n=arrays.length,m,i=-1,j=0,merged,array;while(++i<n)j+=arrays[i].length;merged=new Array(j);while(--n>=0){array=arrays[n];m=array.length;while(--m>=0){merged[--j]=array[m];}}
return merged;};var abs=Math.abs;d3.range=function(start,stop,step){if(arguments.length<3){step=1;if(arguments.length<2){stop=start;start=0;}}
if((stop-start)/step===Infinity)throw new Error("infinite range");var range=[],k=d3_range_integerScale(abs(step)),i=-1,j;start*=k,stop*=k,step*=k;if(step<0)while((j=start+step*++i)>stop)range.push(j/k);else while((j=start+step*++i)<stop)range.push(j/k);return range;};function d3_range_integerScale(x){var k=1;while(x*k%1)k*=10;return k;}
function d3_class(ctor,properties){for(var key in properties){Object.defineProperty(ctor.prototype,key,{value:properties[key],enumerable:false});}}
d3.map=function(object,f){var map=new d3_Map();if(object instanceof d3_Map){object.forEach(function(key,value){map.set(key,value);});}else if(Array.isArray(object)){var i=-1,n=object.length,o;if(arguments.length===1)while(++i<n)map.set(i,object[i]);else while(++i<n)map.set(f.call(object,o=object[i],i),o);}else{for(var key in object)map.set(key,object[key]);}
return map;};function d3_Map(){this._=Object.create(null);}
var d3_map_proto="__proto__",d3_map_zero="\x00";d3_class(d3_Map,{has:d3_map_has,get:function(key){return this._[d3_map_escape(key)];},set:function(key,value){return this._[d3_map_escape(key)]=value;},remove:d3_map_remove,keys:d3_map_keys,values:function(){var values=[];for(var key in this._)values.push(this._[key]);return values;},entries:function(){var entries=[];for(var key in this._)entries.push({key:d3_map_unescape(key),value:this._[key]});return entries;},size:d3_map_size,empty:d3_map_empty,forEach:function(f){for(var key in this._)f.call(this,d3_map_unescape(key),this._[key]);}});function d3_map_escape(key){return(key+="")===d3_map_proto||key[0]===d3_map_zero?d3_map_zero+key:key;}
function d3_map_unescape(key){return(key+="")[0]===d3_map_zero?key.slice(1):key;}
function d3_map_has(key){return d3_map_escape(key)in this._;}
function d3_map_remove(key){return(key=d3_map_escape(key))in this._&&delete this._[key];}
function d3_map_keys(){var keys=[];for(var key in this._)keys.push(d3_map_unescape(key));return keys;}
function d3_map_size(){var size=0;for(var key in this._)++size;return size;}
function d3_map_empty(){for(var key in this._)return false;return true;}
d3.nest=function(){var nest={},keys=[],sortKeys=[],sortValues,rollup;function map(mapType,array,depth){if(depth>=keys.length)return rollup?rollup.call(nest,array):sortValues?array.sort(sortValues):array;var i=-1,n=array.length,key=keys[depth++],keyValue,object,setter,valuesByKey=new d3_Map(),values;while(++i<n){if(values=valuesByKey.get(keyValue=key(object=array[i]))){values.push(object);}else{valuesByKey.set(keyValue,[object]);}}
if(mapType){object=mapType();setter=function(keyValue,values){object.set(keyValue,map(mapType,values,depth));};}else{object={};setter=function(keyValue,values){object[keyValue]=map(mapType,values,depth);};}
valuesByKey.forEach(setter);return object;}
function entries(map,depth){if(depth>=keys.length)return map;var array=[],sortKey=sortKeys[depth++];map.forEach(function(key,keyMap){array.push({key:key,values:entries(keyMap,depth)});});return sortKey?array.sort(function(a,b){return sortKey(a.key,b.key);}):array;}
nest.map=function(array,mapType){return map(mapType,array,0);};nest.entries=function(array){return entries(map(d3.map,array,0),0);};nest.key=function(d){keys.push(d);return nest;};nest.sortKeys=function(order){sortKeys[keys.length-1]=order;return nest;};nest.sortValues=function(order){sortValues=order;return nest;};nest.rollup=function(f){rollup=f;return nest;};return nest;};d3.set=function(array){var set=new d3_Set();if(array)for(var i=0,n=array.length;i<n;++i)set.add(array[i]);return set;};function d3_Set(){this._=Object.create(null);}
d3_class(d3_Set,{has:d3_map_has,add:function(key){this._[d3_map_escape(key+="")]=true;return key;},remove:d3_map_remove,values:d3_map_keys,size:d3_map_size,empty:d3_map_empty,forEach:function(f){for(var key in this._)f.call(this,d3_map_unescape(key));}});d3.behavior={};function d3_identity(d){return d;}
d3.rebind=function(target,source){var i=1,n=arguments.length,method;while(++i<n)target[method=arguments[i]]=d3_rebind(target,source,source[method]);return target;};function d3_rebind(target,source,method){return function(){var value=method.apply(source,arguments);return value===source?target:value;};}
function d3_vendorSymbol(object,name){if(name in object)return name;name=name.charAt(0).toUpperCase()+name.slice(1);for(var i=0,n=d3_vendorPrefixes.length;i<n;++i){var prefixName=d3_vendorPrefixes[i]+name;if(prefixName in object)return prefixName;}}
var d3_vendorPrefixes=["webkit","ms","moz","Moz","o","O"];function d3_noop(){}
d3.dispatch=function(){var dispatch=new d3_dispatch(),i=-1,n=arguments.length;while(++i<n)dispatch[arguments[i]]=d3_dispatch_event(dispatch);return dispatch;};function d3_dispatch(){}
d3_dispatch.prototype.on=function(type,listener){var i=type.indexOf("."),name="";if(i>=0){name=type.slice(i+1);type=type.slice(0,i);}
if(type)return arguments.length<2?this[type].on(name):this[type].on(name,listener);if(arguments.length===2){if(listener==null)for(type in this){if(this.hasOwnProperty(type))this[type].on(name,null);}
return this;}};function d3_dispatch_event(dispatch){var listeners=[],listenerByName=new d3_Map();function event(){var z=listeners,i=-1,n=z.length,l;while(++i<n)if(l=z[i].on)l.apply(this,arguments);return dispatch;}
event.on=function(name,listener){var l=listenerByName.get(name),i;if(arguments.length<2)return l&&l.on;if(l){l.on=null;listeners=listeners.slice(0,i=listeners.indexOf(l)).concat(listeners.slice(i+1));listenerByName.remove(name);}
if(listener)listeners.push(listenerByName.set(name,{on:listener}));return dispatch;};return event;}
d3.event=null;function d3_eventPreventDefault(){d3.event.preventDefault();}
function d3_eventSource(){var e=d3.event,s;while(s=e.sourceEvent)e=s;return e;}
function d3_eventDispatch(target){var dispatch=new d3_dispatch(),i=0,n=arguments.length;while(++i<n)dispatch[arguments[i]]=d3_dispatch_event(dispatch);dispatch.of=function(thiz,argumentz){return function(e1){try{var e0=e1.sourceEvent=d3.event;e1.target=target;d3.event=e1;dispatch[e1.type].apply(thiz,argumentz);}finally{d3.event=e0;}};};return dispatch;}
d3.requote=function(s){return s.replace(d3_requote_re,"\\$&");};var d3_requote_re=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g;var d3_subclass={}.__proto__?function(object,prototype){object.__proto__=prototype;}:function(object,prototype){for(var property in prototype)object[property]=prototype[property];};function d3_selection(groups){d3_subclass(groups,d3_selectionPrototype);return groups;}
var d3_select=function(s,n){return n.querySelector(s);},d3_selectAll=function(s,n){return n.querySelectorAll(s);},d3_selectMatches=function(n,s){var d3_selectMatcher=n.matches||n[d3_vendorSymbol(n,"matchesSelector")];d3_selectMatches=function(n,s){return d3_selectMatcher.call(n,s);};return d3_selectMatches(n,s);};if(typeof Sizzle==="function"){d3_select=function(s,n){return Sizzle(s,n)[0]||null;};d3_selectAll=Sizzle;d3_selectMatches=Sizzle.matchesSelector;}
d3.selection=function(){return d3.select(d3_document.documentElement);};var d3_selectionPrototype=d3.selection.prototype=[];d3_selectionPrototype.select=function(selector){var subgroups=[],subgroup,subnode,group,node;selector=d3_selection_selector(selector);for(var j=-1,m=this.length;++j<m;){subgroups.push(subgroup=[]);subgroup.parentNode=(group=this[j]).parentNode;for(var i=-1,n=group.length;++i<n;){if(node=group[i]){subgroup.push(subnode=selector.call(node,node.__data__,i,j));if(subnode&&"__data__"in node)subnode.__data__=node.__data__;}else{subgroup.push(null);}}}
return d3_selection(subgroups);};function d3_selection_selector(selector){return typeof selector==="function"?selector:function(){return d3_select(selector,this);};}
d3_selectionPrototype.selectAll=function(selector){var subgroups=[],subgroup,node;selector=d3_selection_selectorAll(selector);for(var j=-1,m=this.length;++j<m;){for(var group=this[j],i=-1,n=group.length;++i<n;){if(node=group[i]){subgroups.push(subgroup=d3_array(selector.call(node,node.__data__,i,j)));subgroup.parentNode=node;}}}
return d3_selection(subgroups);};function d3_selection_selectorAll(selector){return typeof selector==="function"?selector:function(){return d3_selectAll(selector,this);};}
var d3_nsPrefix={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};d3.ns={prefix:d3_nsPrefix,qualify:function(name){var i=name.indexOf(":"),prefix=name;if(i>=0){prefix=name.slice(0,i);name=name.slice(i+1);}
return d3_nsPrefix.hasOwnProperty(prefix)?{space:d3_nsPrefix[prefix],local:name}:name;}};d3_selectionPrototype.attr=function(name,value){if(arguments.length<2){if(typeof name==="string"){var node=this.node();name=d3.ns.qualify(name);return name.local?node.getAttributeNS(name.space,name.local):node.getAttribute(name);}
for(value in name)this.each(d3_selection_attr(value,name[value]));return this;}
return this.each(d3_selection_attr(name,value));};function d3_selection_attr(name,value){name=d3.ns.qualify(name);function attrNull(){this.removeAttribute(name);}
function attrNullNS(){this.removeAttributeNS(name.space,name.local);}
function attrConstant(){this.setAttribute(name,value);}
function attrConstantNS(){this.setAttributeNS(name.space,name.local,value);}
function attrFunction(){var x=value.apply(this,arguments);if(x==null)this.removeAttribute(name);else this.setAttribute(name,x);}
function attrFunctionNS(){var x=value.apply(this,arguments);if(x==null)this.removeAttributeNS(name.space,name.local);else this.setAttributeNS(name.space,name.local,x);}
return value==null?name.local?attrNullNS:attrNull:typeof value==="function"?name.local?attrFunctionNS:attrFunction:name.local?attrConstantNS:attrConstant;}
function d3_collapse(s){return s.trim().replace(/\s+/g," ");}
d3_selectionPrototype.classed=function(name,value){if(arguments.length<2){if(typeof name==="string"){var node=this.node(),n=(name=d3_selection_classes(name)).length,i=-1;if(value=node.classList){while(++i<n)if(!value.contains(name[i]))return false;}else{value=node.getAttribute("class");while(++i<n)if(!d3_selection_classedRe(name[i]).test(value))return false;}
return true;}
for(value in name)this.each(d3_selection_classed(value,name[value]));return this;}
return this.each(d3_selection_classed(name,value));};function d3_selection_classedRe(name){return new RegExp("(?:^|\\s+)"+d3.requote(name)+"(?:\\s+|$)","g");}
function d3_selection_classes(name){return(name+"").trim().split(/^|\s+/);}
function d3_selection_classed(name,value){name=d3_selection_classes(name).map(d3_selection_classedName);var n=name.length;function classedConstant(){var i=-1;while(++i<n)name[i](this,value);}
function classedFunction(){var i=-1,x=value.apply(this,arguments);while(++i<n)name[i](this,x);}
return typeof value==="function"?classedFunction:classedConstant;}
function d3_selection_classedName(name){var re=d3_selection_classedRe(name);return function(node,value){if(c=node.classList)return value?c.add(name):c.remove(name);var c=node.getAttribute("class")||"";if(value){re.lastIndex=0;if(!re.test(c))node.setAttribute("class",d3_collapse(c+" "+name));}else{node.setAttribute("class",d3_collapse(c.replace(re," ")));}};}
d3_selectionPrototype.style=function(name,value,priority){var n=arguments.length;if(n<3){if(typeof name!=="string"){if(n<2)value="";for(priority in name)this.each(d3_selection_style(priority,name[priority],value));return this;}
if(n<2){var node=this.node();return d3_window(node).getComputedStyle(node,null).getPropertyValue(name);}
priority="";}
return this.each(d3_selection_style(name,value,priority));};function d3_selection_style(name,value,priority){function styleNull(){this.style.removeProperty(name);}
function styleConstant(){this.style.setProperty(name,value,priority);}
function styleFunction(){var x=value.apply(this,arguments);if(x==null)this.style.removeProperty(name);else this.style.setProperty(name,x,priority);}
return value==null?styleNull:typeof value==="function"?styleFunction:styleConstant;}
d3_selectionPrototype.property=function(name,value){if(arguments.length<2){if(typeof name==="string")return this.node()[name];for(value in name)this.each(d3_selection_property(value,name[value]));return this;}
return this.each(d3_selection_property(name,value));};function d3_selection_property(name,value){function propertyNull(){delete this[name];}
function propertyConstant(){this[name]=value;}
function propertyFunction(){var x=value.apply(this,arguments);if(x==null)delete this[name];else this[name]=x;}
return value==null?propertyNull:typeof value==="function"?propertyFunction:propertyConstant;}
d3_selectionPrototype.text=function(value){return arguments.length?this.each(typeof value==="function"?function(){var v=value.apply(this,arguments);this.textContent=v==null?"":v;}:value==null?function(){this.textContent="";}:function(){this.textContent=value;}):this.node().textContent;};d3_selectionPrototype.html=function(value){return arguments.length?this.each(typeof value==="function"?function(){var v=value.apply(this,arguments);this.innerHTML=v==null?"":v;}:value==null?function(){this.innerHTML="";}:function(){this.innerHTML=value;}):this.node().innerHTML;};d3_selectionPrototype.append=function(name){name=d3_selection_creator(name);return this.select(function(){return this.appendChild(name.apply(this,arguments));});};function d3_selection_creator(name){function create(){var document=this.ownerDocument,namespace=this.namespaceURI;return namespace?document.createElementNS(namespace,name):document.createElement(name);}
function createNS(){return this.ownerDocument.createElementNS(name.space,name.local);}
return typeof name==="function"?name:(name=d3.ns.qualify(name)).local?createNS:create;}
d3_selectionPrototype.insert=function(name,before){name=d3_selection_creator(name);before=d3_selection_selector(before);return this.select(function(){return this.insertBefore(name.apply(this,arguments),before.apply(this,arguments)||null);});};d3_selectionPrototype.remove=function(){return this.each(d3_selectionRemove);};function d3_selectionRemove(){var parent=this.parentNode;if(parent)parent.removeChild(this);}
d3_selectionPrototype.data=function(value,key){var i=-1,n=this.length,group,node;if(!arguments.length){value=new Array(n=(group=this[0]).length);while(++i<n){if(node=group[i]){value[i]=node.__data__;}}
return value;}
function bind(group,groupData){var i,n=group.length,m=groupData.length,n0=Math.min(n,m),updateNodes=new Array(m),enterNodes=new Array(m),exitNodes=new Array(n),node,nodeData;if(key){var nodeByKeyValue=new d3_Map(),keyValues=new Array(n),keyValue;for(i=-1;++i<n;){if(nodeByKeyValue.has(keyValue=key.call(node=group[i],node.__data__,i))){exitNodes[i]=node;}else{nodeByKeyValue.set(keyValue,node);}
keyValues[i]=keyValue;}
for(i=-1;++i<m;){if(!(node=nodeByKeyValue.get(keyValue=key.call(groupData,nodeData=groupData[i],i)))){enterNodes[i]=d3_selection_dataNode(nodeData);}else if(node!==true){updateNodes[i]=node;node.__data__=nodeData;}
nodeByKeyValue.set(keyValue,true);}
for(i=-1;++i<n;){if(nodeByKeyValue.get(keyValues[i])!==true){exitNodes[i]=group[i];}}}else{for(i=-1;++i<n0;){node=group[i];nodeData=groupData[i];if(node){node.__data__=nodeData;updateNodes[i]=node;}else{enterNodes[i]=d3_selection_dataNode(nodeData);}}
for(;i<m;++i){enterNodes[i]=d3_selection_dataNode(groupData[i]);}
for(;i<n;++i){exitNodes[i]=group[i];}}
enterNodes.update=updateNodes;enterNodes.parentNode=updateNodes.parentNode=exitNodes.parentNode=group.parentNode;enter.push(enterNodes);update.push(updateNodes);exit.push(exitNodes);}
var enter=d3_selection_enter([]),update=d3_selection([]),exit=d3_selection([]);if(typeof value==="function"){while(++i<n){bind(group=this[i],value.call(group,group.parentNode.__data__,i));}}else{while(++i<n){bind(group=this[i],value);}}
update.enter=function(){return enter;};update.exit=function(){return exit;};return update;};function d3_selection_dataNode(data){return{__data__:data};}
d3_selectionPrototype.datum=function(value){return arguments.length?this.property("__data__",value):this.property("__data__");};d3_selectionPrototype.filter=function(filter){var subgroups=[],subgroup,group,node;if(typeof filter!=="function")filter=d3_selection_filter(filter);for(var j=0,m=this.length;j<m;j++){subgroups.push(subgroup=[]);subgroup.parentNode=(group=this[j]).parentNode;for(var i=0,n=group.length;i<n;i++){if((node=group[i])&&filter.call(node,node.__data__,i,j)){subgroup.push(node);}}}
return d3_selection(subgroups);};function d3_selection_filter(selector){return function(){return d3_selectMatches(this,selector);};}
d3_selectionPrototype.order=function(){for(var j=-1,m=this.length;++j<m;){for(var group=this[j],i=group.length-1,next=group[i],node;--i>=0;){if(node=group[i]){if(next&&next!==node.nextSibling)next.parentNode.insertBefore(node,next);next=node;}}}
return this;};d3_selectionPrototype.sort=function(comparator){comparator=d3_selection_sortComparator.apply(this,arguments);for(var j=-1,m=this.length;++j<m;)this[j].sort(comparator);return this.order();};function d3_selection_sortComparator(comparator){if(!arguments.length)comparator=d3_ascending;return function(a,b){return a&&b?comparator(a.__data__,b.__data__):!a-!b;};}
d3_selectionPrototype.each=function(callback){return d3_selection_each(this,function(node,i,j){callback.call(node,node.__data__,i,j);});};function d3_selection_each(groups,callback){for(var j=0,m=groups.length;j<m;j++){for(var group=groups[j],i=0,n=group.length,node;i<n;i++){if(node=group[i])callback(node,i,j);}}
return groups;}
d3_selectionPrototype.call=function(callback){var args=d3_array(arguments);callback.apply(args[0]=this,args);return this;};d3_selectionPrototype.empty=function(){return!this.node();};d3_selectionPrototype.node=function(){for(var j=0,m=this.length;j<m;j++){for(var group=this[j],i=0,n=group.length;i<n;i++){var node=group[i];if(node)return node;}}
return null;};d3_selectionPrototype.size=function(){var n=0;d3_selection_each(this,function(){++n;});return n;};function d3_selection_enter(selection){d3_subclass(selection,d3_selection_enterPrototype);return selection;}
var d3_selection_enterPrototype=[];d3.selection.enter=d3_selection_enter;d3.selection.enter.prototype=d3_selection_enterPrototype;d3_selection_enterPrototype.append=d3_selectionPrototype.append;d3_selection_enterPrototype.empty=d3_selectionPrototype.empty;d3_selection_enterPrototype.node=d3_selectionPrototype.node;d3_selection_enterPrototype.call=d3_selectionPrototype.call;d3_selection_enterPrototype.size=d3_selectionPrototype.size;d3_selection_enterPrototype.select=function(selector){var subgroups=[],subgroup,subnode,upgroup,group,node;for(var j=-1,m=this.length;++j<m;){upgroup=(group=this[j]).update;subgroups.push(subgroup=[]);subgroup.parentNode=group.parentNode;for(var i=-1,n=group.length;++i<n;){if(node=group[i]){subgroup.push(upgroup[i]=subnode=selector.call(group.parentNode,node.__data__,i,j));subnode.__data__=node.__data__;}else{subgroup.push(null);}}}
return d3_selection(subgroups);};d3_selection_enterPrototype.insert=function(name,before){if(arguments.length<2)before=d3_selection_enterInsertBefore(this);return d3_selectionPrototype.insert.call(this,name,before);};function d3_selection_enterInsertBefore(enter){var i0,j0;return function(d,i,j){var group=enter[j].update,n=group.length,node;if(j!=j0)j0=j,i0=0;if(i>=i0)i0=i+1;while(!(node=group[i0])&&++i0<n);return node;};}
d3.select=function(node){var group;if(typeof node==="string"){group=[d3_select(node,d3_document)];group.parentNode=d3_document.documentElement;}else{group=[node];group.parentNode=d3_documentElement(node);}
return d3_selection([group]);};d3.selectAll=function(nodes){var group;if(typeof nodes==="string"){group=d3_array(d3_selectAll(nodes,d3_document));group.parentNode=d3_document.documentElement;}else{group=nodes;group.parentNode=null;}
return d3_selection([group]);};d3_selectionPrototype.on=function(type,listener,capture){var n=arguments.length;if(n<3){if(typeof type!=="string"){if(n<2)listener=false;for(capture in type)this.each(d3_selection_on(capture,type[capture],listener));return this;}
if(n<2)return(n=this.node()["__on"+type])&&n._;capture=false;}
return this.each(d3_selection_on(type,listener,capture));};function d3_selection_on(type,listener,capture){var name="__on"+type,i=type.indexOf("."),wrap=d3_selection_onListener;if(i>0)type=type.slice(0,i);var filter=d3_selection_onFilters.get(type);if(filter)type=filter,wrap=d3_selection_onFilter;function onRemove(){var l=this[name];if(l){this.removeEventListener(type,l,l.$);delete this[name];}}
function onAdd(){var l=wrap(listener,d3_array(arguments));onRemove.call(this);this.addEventListener(type,this[name]=l,l.$=capture);l._=listener;}
function removeAll(){var re=new RegExp("^__on([^.]+)"+d3.requote(type)+"$"),match;for(var name in this){if(match=name.match(re)){var l=this[name];this.removeEventListener(match[1],l,l.$);delete this[name];}}}
return i?listener?onAdd:onRemove:listener?d3_noop:removeAll;}
var d3_selection_onFilters=d3.map({mouseenter:"mouseover",mouseleave:"mouseout"});if(d3_document){d3_selection_onFilters.forEach(function(k){if("on"+k in d3_document)d3_selection_onFilters.remove(k);});}
function d3_selection_onListener(listener,argumentz){return function(e){var o=d3.event;d3.event=e;argumentz[0]=this.__data__;try{listener.apply(this,argumentz);}finally{d3.event=o;}};}
function d3_selection_onFilter(listener,argumentz){var l=d3_selection_onListener(listener,argumentz);return function(e){var target=this,related=e.relatedTarget;if(!related||related!==target&&!(related.compareDocumentPosition(target)&8)){l.call(target,e);}};}
var d3_event_dragSelect,d3_event_dragId=0;function d3_event_dragSuppress(node){var name=".dragsuppress-"+ ++d3_event_dragId,click="click"+name,w=d3.select(d3_window(node)).on("touchmove"+name,d3_eventPreventDefault).on("dragstart"+name,d3_eventPreventDefault).on("selectstart"+name,d3_eventPreventDefault);if(d3_event_dragSelect==null){d3_event_dragSelect="onselectstart"in node?false:d3_vendorSymbol(node.style,"userSelect");}
if(d3_event_dragSelect){var style=d3_documentElement(node).style,select=style[d3_event_dragSelect];style[d3_event_dragSelect]="none";}
return function(suppressClick){w.on(name,null);if(d3_event_dragSelect)style[d3_event_dragSelect]=select;if(suppressClick){var off=function(){w.on(click,null);};w.on(click,function(){d3_eventPreventDefault();off();},true);setTimeout(off,0);}};}
d3.mouse=function(container){return d3_mousePoint(container,d3_eventSource());};var d3_mouse_bug44083=this.navigator&&/WebKit/.test(this.navigator.userAgent)?-1:0;function d3_mousePoint(container,e){if(e.changedTouches)e=e.changedTouches[0];var svg=container.ownerSVGElement||container;if(svg.createSVGPoint){var point=svg.createSVGPoint();if(d3_mouse_bug44083<0){var window=d3_window(container);if(window.scrollX||window.scrollY){svg=d3.select("body").append("svg").style({position:"absolute",top:0,left:0,margin:0,padding:0,border:"none"},"important");var ctm=svg[0][0].getScreenCTM();d3_mouse_bug44083=!(ctm.f||ctm.e);svg.remove();}}
if(d3_mouse_bug44083)point.x=e.pageX,point.y=e.pageY;else point.x=e.clientX,point.y=e.clientY;point=point.matrixTransform(container.getScreenCTM().inverse());return[point.x,point.y];}
var rect=container.getBoundingClientRect();return[e.clientX-rect.left-container.clientLeft,e.clientY-rect.top-container.clientTop];}
d3.touch=function(container,touches,identifier){if(arguments.length<3)identifier=touches,touches=d3_eventSource().changedTouches;if(touches)for(var i=0,n=touches.length,touch;i<n;++i){if((touch=touches[i]).identifier===identifier){return d3_mousePoint(container,touch);}}};d3.behavior.drag=function(){var event=d3_eventDispatch(drag,"drag","dragstart","dragend"),origin=null,mousedown=dragstart(d3_noop,d3.mouse,d3_window,"mousemove","mouseup"),touchstart=dragstart(d3_behavior_dragTouchId,d3.touch,d3_identity,"touchmove","touchend");function drag(){this.on("mousedown.drag",mousedown).on("touchstart.drag",touchstart);}
function dragstart(id,position,subject,move,end){return function(){var that=this,target=d3.event.target,parent=that.parentNode,dispatch=event.of(that,arguments),dragged=0,dragId=id(),dragName=".drag"+(dragId==null?"":"-"+dragId),dragOffset,dragSubject=d3.select(subject(target)).on(move+dragName,moved).on(end+dragName,ended),dragRestore=d3_event_dragSuppress(target),position0=position(parent,dragId);if(origin){dragOffset=origin.apply(that,arguments);dragOffset=[dragOffset.x-position0[0],dragOffset.y-position0[1]];}else{dragOffset=[0,0];}
dispatch({type:"dragstart"});function moved(){var position1=position(parent,dragId),dx,dy;if(!position1)return;dx=position1[0]-position0[0];dy=position1[1]-position0[1];dragged|=dx|dy;position0=position1;dispatch({type:"drag",x:position1[0]+dragOffset[0],y:position1[1]+dragOffset[1],dx:dx,dy:dy});}
function ended(){if(!position(parent,dragId))return;dragSubject.on(move+dragName,null).on(end+dragName,null);dragRestore(dragged&&d3.event.target===target);dispatch({type:"dragend"});}};}
drag.origin=function(x){if(!arguments.length)return origin;origin=x;return drag;};return d3.rebind(drag,event,"on");};function d3_behavior_dragTouchId(){return d3.event.changedTouches[0].identifier;}
d3.touches=function(container,touches){if(arguments.length<2)touches=d3_eventSource().touches;return touches?d3_array(touches).map(function(touch){var point=d3_mousePoint(container,touch);point.identifier=touch.identifier;return point;}):[];};var ε=1e-6,ε2=ε*ε,π=Math.PI,τ=2*π,τε=τ-ε,halfπ=π/2,d3_radians=π/180,d3_degrees=180/π;function d3_sgn(x){return x>0?1:x<0?-1:0;}
function d3_cross2d(a,b,c){return(b[0]-a[0])*(c[1]-a[1])-(b[1]-a[1])*(c[0]-a[0]);}
function d3_acos(x){return x>1?0:x<-1?π:Math.acos(x);}
function d3_asin(x){return x>1?halfπ:x<-1?-halfπ:Math.asin(x);}
function d3_sinh(x){return((x=Math.exp(x))-1/x)/2;}
function d3_cosh(x){return((x=Math.exp(x))+1/x)/2;}
function d3_tanh(x){return((x=Math.exp(2*x))-1)/(x+1);}
function d3_haversin(x){return(x=Math.sin(x/2))*x;}
var ρ=Math.SQRT2,ρ2=2,ρ4=4;d3.interpolateZoom=function(p0,p1){var ux0=p0[0],uy0=p0[1],w0=p0[2],ux1=p1[0],uy1=p1[1],w1=p1[2];var dx=ux1-ux0,dy=uy1-uy0,d2=dx*dx+dy*dy,d1=Math.sqrt(d2),b0=(w1*w1-w0*w0+ρ4*d2)/(2*w0*ρ2*d1),b1=(w1*w1-w0*w0-ρ4*d2)/(2*w1*ρ2*d1),r0=Math.log(Math.sqrt(b0*b0+1)-b0),r1=Math.log(Math.sqrt(b1*b1+1)-b1),dr=r1-r0,S=(dr||Math.log(w1/w0))/ρ;function interpolate(t){var s=t*S;if(dr){var coshr0=d3_cosh(r0),u=w0/(ρ2*d1)*(coshr0*d3_tanh(ρ*s+r0)-d3_sinh(r0));return[ux0+u*dx,uy0+u*dy,w0*coshr0/d3_cosh(ρ*s+r0)];}
return[ux0+t*dx,uy0+t*dy,w0*Math.exp(ρ*s)];}
interpolate.duration=S*1e3;return interpolate;};d3.behavior.zoom=function(){var view={x:0,y:0,k:1},translate0,center0,center,size=[960,500],scaleExtent=d3_behavior_zoomInfinity,duration=250,zooming=0,mousedown="mousedown.zoom",mousemove="mousemove.zoom",mouseup="mouseup.zoom",mousewheelTimer,touchstart="touchstart.zoom",touchtime,event=d3_eventDispatch(zoom,"zoomstart","zoom","zoomend"),x0,x1,y0,y1;if(!d3_behavior_zoomWheel){d3_behavior_zoomWheel="onwheel"in d3_document?(d3_behavior_zoomDelta=function(){return-d3.event.deltaY*(d3.event.deltaMode?120:1);},"wheel"):"onmousewheel"in d3_document?(d3_behavior_zoomDelta=function(){return d3.event.wheelDelta;},"mousewheel"):(d3_behavior_zoomDelta=function(){return-d3.event.detail;},"MozMousePixelScroll");}
function zoom(g){g.on(mousedown,mousedowned).on(d3_behavior_zoomWheel+".zoom",mousewheeled).on("dblclick.zoom",dblclicked).on(touchstart,touchstarted);}
zoom.event=function(g){g.each(function(){var dispatch=event.of(this,arguments),view1=view;if(d3_transitionInheritId){d3.select(this).transition().each("start.zoom",function(){view=this.__chart__||{x:0,y:0,k:1};zoomstarted(dispatch);}).tween("zoom:zoom",function(){var dx=size[0],dy=size[1],cx=center0?center0[0]:dx/2,cy=center0?center0[1]:dy/2,i=d3.interpolateZoom([(cx-view.x)/view.k,(cy-view.y)/view.k,dx/view.k],[(cx-view1.x)/view1.k,(cy-view1.y)/view1.k,dx/view1.k]);return function(t){var l=i(t),k=dx/l[2];this.__chart__=view={x:cx-l[0]*k,y:cy-l[1]*k,k:k};zoomed(dispatch);};}).each("interrupt.zoom",function(){zoomended(dispatch);}).each("end.zoom",function(){zoomended(dispatch);});}else{this.__chart__=view;zoomstarted(dispatch);zoomed(dispatch);zoomended(dispatch);}});};zoom.translate=function(_){if(!arguments.length)return[view.x,view.y];view={x:+_[0],y:+_[1],k:view.k};rescale();return zoom;};zoom.scale=function(_){if(!arguments.length)return view.k;view={x:view.x,y:view.y,k:+_};rescale();return zoom;};zoom.scaleExtent=function(_){if(!arguments.length)return scaleExtent;scaleExtent=_==null?d3_behavior_zoomInfinity:[+_[0],+_[1]];return zoom;};zoom.center=function(_){if(!arguments.length)return center;center=_&&[+_[0],+_[1]];return zoom;};zoom.size=function(_){if(!arguments.length)return size;size=_&&[+_[0],+_[1]];return zoom;};zoom.duration=function(_){if(!arguments.length)return duration;duration=+_;return zoom;};zoom.x=function(z){if(!arguments.length)return x1;x1=z;x0=z.copy();view={x:0,y:0,k:1};return zoom;};zoom.y=function(z){if(!arguments.length)return y1;y1=z;y0=z.copy();view={x:0,y:0,k:1};return zoom;};function location(p){return[(p[0]-view.x)/view.k,(p[1]-view.y)/view.k];}
function point(l){return[l[0]*view.k+view.x,l[1]*view.k+view.y];}
function scaleTo(s){view.k=Math.max(scaleExtent[0],Math.min(scaleExtent[1],s));}
function translateTo(p,l){l=point(l);view.x+=p[0]-l[0];view.y+=p[1]-l[1];}
function zoomTo(that,p,l,k){that.__chart__={x:view.x,y:view.y,k:view.k};scaleTo(Math.pow(2,k));translateTo(center0=p,l);that=d3.select(that);if(duration>0)that=that.transition().duration(duration);that.call(zoom.event);}
function rescale(){if(x1)x1.domain(x0.range().map(function(x){return(x-view.x)/view.k;}).map(x0.invert));if(y1)y1.domain(y0.range().map(function(y){return(y-view.y)/view.k;}).map(y0.invert));}
function zoomstarted(dispatch){if(!zooming++)dispatch({type:"zoomstart"});}
function zoomed(dispatch){rescale();dispatch({type:"zoom",scale:view.k,translate:[view.x,view.y]});}
function zoomended(dispatch){if(!--zooming)dispatch({type:"zoomend"}),center0=null;}
function mousedowned(){var that=this,target=d3.event.target,dispatch=event.of(that,arguments),dragged=0,subject=d3.select(d3_window(that)).on(mousemove,moved).on(mouseup,ended),location0=location(d3.mouse(that)),dragRestore=d3_event_dragSuppress(that);d3_selection_interrupt.call(that);zoomstarted(dispatch);function moved(){dragged=1;translateTo(d3.mouse(that),location0);zoomed(dispatch);}
function ended(){subject.on(mousemove,null).on(mouseup,null);dragRestore(dragged&&d3.event.target===target);zoomended(dispatch);}}
function touchstarted(){var that=this,dispatch=event.of(that,arguments),locations0={},distance0=0,scale0,zoomName=".zoom-"+d3.event.changedTouches[0].identifier,touchmove="touchmove"+zoomName,touchend="touchend"+zoomName,targets=[],subject=d3.select(that),dragRestore=d3_event_dragSuppress(that);started();zoomstarted(dispatch);subject.on(mousedown,null).on(touchstart,started);function relocate(){var touches=d3.touches(that);scale0=view.k;touches.forEach(function(t){if(t.identifier in locations0)locations0[t.identifier]=location(t);});return touches;}
function started(){var target=d3.event.target;d3.select(target).on(touchmove,moved).on(touchend,ended);targets.push(target);var changed=d3.event.changedTouches;for(var i=0,n=changed.length;i<n;++i){locations0[changed[i].identifier]=null;}
var touches=relocate(),now=Date.now();if(touches.length===1){if(now-touchtime<500){var p=touches[0];zoomTo(that,p,locations0[p.identifier],Math.floor(Math.log(view.k)/Math.LN2)+1);d3_eventPreventDefault();}
touchtime=now;}else if(touches.length>1){var p=touches[0],q=touches[1],dx=p[0]-q[0],dy=p[1]-q[1];distance0=dx*dx+dy*dy;}}
function moved(){var touches=d3.touches(that),p0,l0,p1,l1;d3_selection_interrupt.call(that);for(var i=0,n=touches.length;i<n;++i,l1=null){p1=touches[i];if(l1=locations0[p1.identifier]){if(l0)break;p0=p1,l0=l1;}}
if(l1){var distance1=(distance1=p1[0]-p0[0])*distance1+(distance1=p1[1]-p0[1])*distance1,scale1=distance0&&Math.sqrt(distance1/distance0);p0=[(p0[0]+p1[0])/2,(p0[1]+p1[1])/2];l0=[(l0[0]+l1[0])/2,(l0[1]+l1[1])/2];scaleTo(scale1*scale0);}
touchtime=null;translateTo(p0,l0);zoomed(dispatch);}
function ended(){if(d3.event.touches.length){var changed=d3.event.changedTouches;for(var i=0,n=changed.length;i<n;++i){delete locations0[changed[i].identifier];}
for(var identifier in locations0){return void relocate();}}
d3.selectAll(targets).on(zoomName,null);subject.on(mousedown,mousedowned).on(touchstart,touchstarted);dragRestore();zoomended(dispatch);}}
function mousewheeled(){var dispatch=event.of(this,arguments);if(mousewheelTimer)clearTimeout(mousewheelTimer);else d3_selection_interrupt.call(this),translate0=location(center0=center||d3.mouse(this)),zoomstarted(dispatch);mousewheelTimer=setTimeout(function(){mousewheelTimer=null;zoomended(dispatch);},50);d3_eventPreventDefault();scaleTo(Math.pow(2,d3_behavior_zoomDelta()*.002)*view.k);translateTo(center0,translate0);zoomed(dispatch);}
function dblclicked(){var p=d3.mouse(this),k=Math.log(view.k)/Math.LN2;zoomTo(this,p,location(p),d3.event.shiftKey?Math.ceil(k)-1:Math.floor(k)+1);}
return d3.rebind(zoom,event,"on");};var d3_behavior_zoomInfinity=[0,Infinity],d3_behavior_zoomDelta,d3_behavior_zoomWheel;d3.color=d3_color;function d3_color(){}
d3_color.prototype.toString=function(){return this.rgb()+"";};d3.hsl=d3_hsl;function d3_hsl(h,s,l){return this instanceof d3_hsl?void(this.h=+h,this.s=+s,this.l=+l):arguments.length<2?h instanceof d3_hsl?new d3_hsl(h.h,h.s,h.l):d3_rgb_parse(""+h,d3_rgb_hsl,d3_hsl):new d3_hsl(h,s,l);}
var d3_hslPrototype=d3_hsl.prototype=new d3_color();d3_hslPrototype.brighter=function(k){k=Math.pow(.7,arguments.length?k:1);return new d3_hsl(this.h,this.s,this.l/k);};d3_hslPrototype.darker=function(k){k=Math.pow(.7,arguments.length?k:1);return new d3_hsl(this.h,this.s,k*this.l);};d3_hslPrototype.rgb=function(){return d3_hsl_rgb(this.h,this.s,this.l);};function d3_hsl_rgb(h,s,l){var m1,m2;h=isNaN(h)?0:(h%=360)<0?h+360:h;s=isNaN(s)?0:s<0?0:s>1?1:s;l=l<0?0:l>1?1:l;m2=l<=.5?l*(1+s):l+s-l*s;m1=2*l-m2;function v(h){if(h>360)h-=360;else if(h<0)h+=360;if(h<60)return m1+(m2-m1)*h/60;if(h<180)return m2;if(h<240)return m1+(m2-m1)*(240-h)/60;return m1;}
function vv(h){return Math.round(v(h)*255);}
return new d3_rgb(vv(h+120),vv(h),vv(h-120));}
d3.hcl=d3_hcl;function d3_hcl(h,c,l){return this instanceof d3_hcl?void(this.h=+h,this.c=+c,this.l=+l):arguments.length<2?h instanceof d3_hcl?new d3_hcl(h.h,h.c,h.l):h instanceof d3_lab?d3_lab_hcl(h.l,h.a,h.b):d3_lab_hcl((h=d3_rgb_lab((h=d3.rgb(h)).r,h.g,h.b)).l,h.a,h.b):new d3_hcl(h,c,l);}
var d3_hclPrototype=d3_hcl.prototype=new d3_color();d3_hclPrototype.brighter=function(k){return new d3_hcl(this.h,this.c,Math.min(100,this.l+d3_lab_K*(arguments.length?k:1)));};d3_hclPrototype.darker=function(k){return new d3_hcl(this.h,this.c,Math.max(0,this.l-d3_lab_K*(arguments.length?k:1)));};d3_hclPrototype.rgb=function(){return d3_hcl_lab(this.h,this.c,this.l).rgb();};function d3_hcl_lab(h,c,l){if(isNaN(h))h=0;if(isNaN(c))c=0;return new d3_lab(l,Math.cos(h*=d3_radians)*c,Math.sin(h)*c);}
d3.lab=d3_lab;function d3_lab(l,a,b){return this instanceof d3_lab?void(this.l=+l,this.a=+a,this.b=+b):arguments.length<2?l instanceof d3_lab?new d3_lab(l.l,l.a,l.b):l instanceof d3_hcl?d3_hcl_lab(l.h,l.c,l.l):d3_rgb_lab((l=d3_rgb(l)).r,l.g,l.b):new d3_lab(l,a,b);}
var d3_lab_K=18;var d3_lab_X=.95047,d3_lab_Y=1,d3_lab_Z=1.08883;var d3_labPrototype=d3_lab.prototype=new d3_color();d3_labPrototype.brighter=function(k){return new d3_lab(Math.min(100,this.l+d3_lab_K*(arguments.length?k:1)),this.a,this.b);};d3_labPrototype.darker=function(k){return new d3_lab(Math.max(0,this.l-d3_lab_K*(arguments.length?k:1)),this.a,this.b);};d3_labPrototype.rgb=function(){return d3_lab_rgb(this.l,this.a,this.b);};function d3_lab_rgb(l,a,b){var y=(l+16)/116,x=y+a/500,z=y-b/200;x=d3_lab_xyz(x)*d3_lab_X;y=d3_lab_xyz(y)*d3_lab_Y;z=d3_lab_xyz(z)*d3_lab_Z;return new d3_rgb(d3_xyz_rgb(3.2404542*x-1.5371385*y-.4985314*z),d3_xyz_rgb(-.969266*x+1.8760108*y+.041556*z),d3_xyz_rgb(.0556434*x-.2040259*y+1.0572252*z));}
function d3_lab_hcl(l,a,b){return l>0?new d3_hcl(Math.atan2(b,a)*d3_degrees,Math.sqrt(a*a+b*b),l):new d3_hcl(NaN,NaN,l);}
function d3_lab_xyz(x){return x>.206893034?x*x*x:(x-4/29)/7.787037;}
function d3_xyz_lab(x){return x>.008856?Math.pow(x,1/3):7.787037*x+4/29;}
function d3_xyz_rgb(r){return Math.round(255*(r<=.00304?12.92*r:1.055*Math.pow(r,1/2.4)-.055));}
d3.rgb=d3_rgb;function d3_rgb(r,g,b){return this instanceof d3_rgb?void(this.r=~~r,this.g=~~g,this.b=~~b):arguments.length<2?r instanceof d3_rgb?new d3_rgb(r.r,r.g,r.b):d3_rgb_parse(""+r,d3_rgb,d3_hsl_rgb):new d3_rgb(r,g,b);}
function d3_rgbNumber(value){return new d3_rgb(value>>16,value>>8&255,value&255);}
function d3_rgbString(value){return d3_rgbNumber(value)+"";}
var d3_rgbPrototype=d3_rgb.prototype=new d3_color();d3_rgbPrototype.brighter=function(k){k=Math.pow(.7,arguments.length?k:1);var r=this.r,g=this.g,b=this.b,i=30;if(!r&&!g&&!b)return new d3_rgb(i,i,i);if(r&&r<i)r=i;if(g&&g<i)g=i;if(b&&b<i)b=i;return new d3_rgb(Math.min(255,r/k),Math.min(255,g/k),Math.min(255,b/k));};d3_rgbPrototype.darker=function(k){k=Math.pow(.7,arguments.length?k:1);return new d3_rgb(k*this.r,k*this.g,k*this.b);};d3_rgbPrototype.hsl=function(){return d3_rgb_hsl(this.r,this.g,this.b);};d3_rgbPrototype.toString=function(){return"#"+d3_rgb_hex(this.r)+d3_rgb_hex(this.g)+d3_rgb_hex(this.b);};function d3_rgb_hex(v){return v<16?"0"+Math.max(0,v).toString(16):Math.min(255,v).toString(16);}
function d3_rgb_parse(format,rgb,hsl){var r=0,g=0,b=0,m1,m2,color;m1=/([a-z]+)\((.*)\)/.exec(format=format.toLowerCase());if(m1){m2=m1[2].split(",");switch(m1[1]){case"hsl":{return hsl(parseFloat(m2[0]),parseFloat(m2[1])/100,parseFloat(m2[2])/100);}
case"rgb":{return rgb(d3_rgb_parseNumber(m2[0]),d3_rgb_parseNumber(m2[1]),d3_rgb_parseNumber(m2[2]));}}}
if(color=d3_rgb_names.get(format)){return rgb(color.r,color.g,color.b);}
if(format!=null&&format.charAt(0)==="#"&&!isNaN(color=parseInt(format.slice(1),16))){if(format.length===4){r=(color&3840)>>4;r=r>>4|r;g=color&240;g=g>>4|g;b=color&15;b=b<<4|b;}else if(format.length===7){r=(color&16711680)>>16;g=(color&65280)>>8;b=color&255;}}
return rgb(r,g,b);}
function d3_rgb_hsl(r,g,b){var min=Math.min(r/=255,g/=255,b/=255),max=Math.max(r,g,b),d=max-min,h,s,l=(max+min)/2;if(d){s=l<.5?d/(max+min):d/(2-max-min);if(r==max)h=(g-b)/d+(g<b?6:0);else if(g==max)h=(b-r)/d+2;else h=(r-g)/d+4;h*=60;}else{h=NaN;s=l>0&&l<1?0:h;}
return new d3_hsl(h,s,l);}
function d3_rgb_lab(r,g,b){r=d3_rgb_xyz(r);g=d3_rgb_xyz(g);b=d3_rgb_xyz(b);var x=d3_xyz_lab((.4124564*r+.3575761*g+.1804375*b)/d3_lab_X),y=d3_xyz_lab((.2126729*r+.7151522*g+.072175*b)/d3_lab_Y),z=d3_xyz_lab((.0193339*r+.119192*g+.9503041*b)/d3_lab_Z);return d3_lab(116*y-16,500*(x-y),200*(y-z));}
function d3_rgb_xyz(r){return(r/=255)<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4);}
function d3_rgb_parseNumber(c){var f=parseFloat(c);return c.charAt(c.length-1)==="%"?Math.round(f*2.55):f;}
var d3_rgb_names=d3.map({aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074});d3_rgb_names.forEach(function(key,value){d3_rgb_names.set(key,d3_rgbNumber(value));});function d3_functor(v){return typeof v==="function"?v:function(){return v;};}
d3.functor=d3_functor;d3.xhr=d3_xhrType(d3_identity);function d3_xhrType(response){return function(url,mimeType,callback){if(arguments.length===2&&typeof mimeType==="function")callback=mimeType,mimeType=null;return d3_xhr(url,mimeType,response,callback);};}
function d3_xhr(url,mimeType,response,callback){var xhr={},dispatch=d3.dispatch("beforesend","progress","load","error"),headers={},request=new XMLHttpRequest(),responseType=null;if(this.XDomainRequest&&!("withCredentials"in request)&&/^(http(s)?:)?\/\//.test(url))request=new XDomainRequest();"onload"in request?request.onload=request.onerror=respond:request.onreadystatechange=function(){request.readyState>3&&respond();};function respond(){var status=request.status,result;if(!status&&d3_xhrHasResponse(request)||status>=200&&status<300||status===304){try{result=response.call(xhr,request);}catch(e){dispatch.error.call(xhr,e);return;}
dispatch.load.call(xhr,result);}else{dispatch.error.call(xhr,request);}}
request.onprogress=function(event){var o=d3.event;d3.event=event;try{dispatch.progress.call(xhr,request);}finally{d3.event=o;}};xhr.header=function(name,value){name=(name+"").toLowerCase();if(arguments.length<2)return headers[name];if(value==null)delete headers[name];else headers[name]=value+"";return xhr;};xhr.mimeType=function(value){if(!arguments.length)return mimeType;mimeType=value==null?null:value+"";return xhr;};xhr.responseType=function(value){if(!arguments.length)return responseType;responseType=value;return xhr;};xhr.response=function(value){response=value;return xhr;};["get","post"].forEach(function(method){xhr[method]=function(){return xhr.send.apply(xhr,[method].concat(d3_array(arguments)));};});xhr.send=function(method,data,callback){if(arguments.length===2&&typeof data==="function")callback=data,data=null;request.open(method,url,true);if(mimeType!=null&&!("accept"in headers))headers["accept"]=mimeType+",*/*";if(request.setRequestHeader)for(var name in headers)request.setRequestHeader(name,headers[name]);if(mimeType!=null&&request.overrideMimeType)request.overrideMimeType(mimeType);if(responseType!=null)request.responseType=responseType;if(callback!=null)xhr.on("error",callback).on("load",function(request){callback(null,request);});dispatch.beforesend.call(xhr,request);request.send(data==null?null:data);return xhr;};xhr.abort=function(){request.abort();return xhr;};d3.rebind(xhr,dispatch,"on");return callback==null?xhr:xhr.get(d3_xhr_fixCallback(callback));}
function d3_xhr_fixCallback(callback){return callback.length===1?function(error,request){callback(error==null?request:null);}:callback;}
function d3_xhrHasResponse(request){var type=request.responseType;return type&&type!=="text"?request.response:request.responseText;}
d3.dsv=function(delimiter,mimeType){var reFormat=new RegExp('["'+delimiter+"\n]"),delimiterCode=delimiter.charCodeAt(0);function dsv(url,row,callback){if(arguments.length<3)callback=row,row=null;var xhr=d3_xhr(url,mimeType,row==null?response:typedResponse(row),callback);xhr.row=function(_){return arguments.length?xhr.response((row=_)==null?response:typedResponse(_)):row;};return xhr;}
function response(request){return dsv.parse(request.responseText);}
function typedResponse(f){return function(request){return dsv.parse(request.responseText,f);};}
dsv.parse=function(text,f){var o;return dsv.parseRows(text,function(row,i){if(o)return o(row,i-1);var a=new Function("d","return {"+row.map(function(name,i){return JSON.stringify(name)+": d["+i+"]";}).join(",")+"}");o=f?function(row,i){return f(a(row),i);}:a;});};dsv.parseRows=function(text,f){var EOL={},EOF={},rows=[],N=text.length,I=0,n=0,t,eol;function token(){if(I>=N)return EOF;if(eol)return eol=false,EOL;var j=I;if(text.charCodeAt(j)===34){var i=j;while(i++<N){if(text.charCodeAt(i)===34){if(text.charCodeAt(i+1)!==34)break;++i;}}
I=i+2;var c=text.charCodeAt(i+1);if(c===13){eol=true;if(text.charCodeAt(i+2)===10)++I;}else if(c===10){eol=true;}
return text.slice(j+1,i).replace(/""/g,'"');}
while(I<N){var c=text.charCodeAt(I++),k=1;if(c===10)eol=true;else if(c===13){eol=true;if(text.charCodeAt(I)===10)++I,++k;}else if(c!==delimiterCode)continue;return text.slice(j,I-k);}
return text.slice(j);}
while((t=token())!==EOF){var a=[];while(t!==EOL&&t!==EOF){a.push(t);t=token();}
if(f&&(a=f(a,n++))==null)continue;rows.push(a);}
return rows;};dsv.format=function(rows){if(Array.isArray(rows[0]))return dsv.formatRows(rows);var fieldSet=new d3_Set(),fields=[];rows.forEach(function(row){for(var field in row){if(!fieldSet.has(field)){fields.push(fieldSet.add(field));}}});return[fields.map(formatValue).join(delimiter)].concat(rows.map(function(row){return fields.map(function(field){return formatValue(row[field]);}).join(delimiter);})).join("\n");};dsv.formatRows=function(rows){return rows.map(formatRow).join("\n");};function formatRow(row){return row.map(formatValue).join(delimiter);}
function formatValue(text){return reFormat.test(text)?'"'+text.replace(/\"/g,'""')+'"':text;}
return dsv;};d3.csv=d3.dsv(",","text/csv");d3.tsv=d3.dsv("	","text/tab-separated-values");var d3_timer_queueHead,d3_timer_queueTail,d3_timer_interval,d3_timer_timeout,d3_timer_active,d3_timer_frame=this[d3_vendorSymbol(this,"requestAnimationFrame")]||function(callback){setTimeout(callback,17);};d3.timer=function(callback,delay,then){var n=arguments.length;if(n<2)delay=0;if(n<3)then=Date.now();var time=then+delay,timer={c:callback,t:time,f:false,n:null};if(d3_timer_queueTail)d3_timer_queueTail.n=timer;else d3_timer_queueHead=timer;d3_timer_queueTail=timer;if(!d3_timer_interval){d3_timer_timeout=clearTimeout(d3_timer_timeout);d3_timer_interval=1;d3_timer_frame(d3_timer_step);}};function d3_timer_step(){var now=d3_timer_mark(),delay=d3_timer_sweep()-now;if(delay>24){if(isFinite(delay)){clearTimeout(d3_timer_timeout);d3_timer_timeout=setTimeout(d3_timer_step,delay);}
d3_timer_interval=0;}else{d3_timer_interval=1;d3_timer_frame(d3_timer_step);}}
d3.timer.flush=function(){d3_timer_mark();d3_timer_sweep();};function d3_timer_mark(){var now=Date.now();d3_timer_active=d3_timer_queueHead;while(d3_timer_active){if(now>=d3_timer_active.t)d3_timer_active.f=d3_timer_active.c(now-d3_timer_active.t);d3_timer_active=d3_timer_active.n;}
return now;}
function d3_timer_sweep(){var t0,t1=d3_timer_queueHead,time=Infinity;while(t1){if(t1.f){t1=t0?t0.n=t1.n:d3_timer_queueHead=t1.n;}else{if(t1.t<time)time=t1.t;t1=(t0=t1).n;}}
d3_timer_queueTail=t0;return time;}
function d3_format_precision(x,p){return p-(x?Math.ceil(Math.log(x)/Math.LN10):1);}
d3.round=function(x,n){return n?Math.round(x*(n=Math.pow(10,n)))/n:Math.round(x);};var d3_formatPrefixes=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"].map(d3_formatPrefix);d3.formatPrefix=function(value,precision){var i=0;if(value){if(value<0)value*=-1;if(precision)value=d3.round(value,d3_format_precision(value,precision));i=1+Math.floor(1e-12+Math.log(value)/Math.LN10);i=Math.max(-24,Math.min(24,Math.floor((i-1)/3)*3));}
return d3_formatPrefixes[8+i/3];};function d3_formatPrefix(d,i){var k=Math.pow(10,abs(8-i)*3);return{scale:i>8?function(d){return d/k;}:function(d){return d*k;},symbol:d};}
function d3_locale_numberFormat(locale){var locale_decimal=locale.decimal,locale_thousands=locale.thousands,locale_grouping=locale.grouping,locale_currency=locale.currency,formatGroup=locale_grouping&&locale_thousands?function(value,width){var i=value.length,t=[],j=0,g=locale_grouping[0],length=0;while(i>0&&g>0){if(length+g+1>width)g=Math.max(1,width-length);t.push(value.substring(i-=g,i+g));if((length+=g+1)>width)break;g=locale_grouping[j=(j+1)%locale_grouping.length];}
return t.reverse().join(locale_thousands);}:d3_identity;return function(specifier){var match=d3_format_re.exec(specifier),fill=match[1]||" ",align=match[2]||">",sign=match[3]||"-",symbol=match[4]||"",zfill=match[5],width=+match[6],comma=match[7],precision=match[8],type=match[9],scale=1,prefix="",suffix="",integer=false,exponent=true;if(precision)precision=+precision.substring(1);if(zfill||fill==="0"&&align==="="){zfill=fill="0";align="=";}
switch(type){case"n":comma=true;type="g";break;case"%":scale=100;suffix="%";type="f";break;case"p":scale=100;suffix="%";type="r";break;case"b":case"o":case"x":case"X":if(symbol==="#")prefix="0"+type.toLowerCase();case"c":exponent=false;case"d":integer=true;precision=0;break;case"s":scale=-1;type="r";break;}
if(symbol==="$")prefix=locale_currency[0],suffix=locale_currency[1];if(type=="r"&&!precision)type="g";if(precision!=null){if(type=="g")precision=Math.max(1,Math.min(21,precision));else if(type=="e"||type=="f")precision=Math.max(0,Math.min(20,precision));}
type=d3_format_types.get(type)||d3_format_typeDefault;var zcomma=zfill&&comma;return function(value){var fullSuffix=suffix;if(integer&&value%1)return"";var negative=value<0||value===0&&1/value<0?(value=-value,"-"):sign==="-"?"":sign;if(scale<0){var unit=d3.formatPrefix(value,precision);value=unit.scale(value);fullSuffix=unit.symbol+suffix;}else{value*=scale;}
value=type(value,precision);var i=value.lastIndexOf("."),before,after;if(i<0){var j=exponent?value.lastIndexOf("e"):-1;if(j<0)before=value,after="";else before=value.substring(0,j),after=value.substring(j);}else{before=value.substring(0,i);after=locale_decimal+value.substring(i+1);}
if(!zfill&&comma)before=formatGroup(before,Infinity);var length=prefix.length+before.length+after.length+(zcomma?0:negative.length),padding=length<width?new Array(length=width-length+1).join(fill):"";if(zcomma)before=formatGroup(padding+before,padding.length?width-after.length:Infinity);negative+=prefix;value=before+after;return(align==="<"?negative+value+padding:align===">"?padding+negative+value:align==="^"?padding.substring(0,length>>=1)+negative+value+padding.substring(length):negative+(zcomma?value:padding+value))+fullSuffix;};};}
var d3_format_re=/(?:([^{])?([<>=^]))?([+\- ])?([$#])?(0)?(\d+)?(,)?(\.-?\d+)?([a-z%])?/i;var d3_format_types=d3.map({b:function(x){return x.toString(2);},c:function(x){return String.fromCharCode(x);},o:function(x){return x.toString(8);},x:function(x){return x.toString(16);},X:function(x){return x.toString(16).toUpperCase();},g:function(x,p){return x.toPrecision(p);},e:function(x,p){return x.toExponential(p);},f:function(x,p){return x.toFixed(p);},r:function(x,p){return(x=d3.round(x,d3_format_precision(x,p))).toFixed(Math.max(0,Math.min(20,d3_format_precision(x*(1+1e-15),p))));}});function d3_format_typeDefault(x){return x+"";}
var d3_time=d3.time={},d3_date=Date;function d3_date_utc(){this._=new Date(arguments.length>1?Date.UTC.apply(this,arguments):arguments[0]);}
d3_date_utc.prototype={getDate:function(){return this._.getUTCDate();},getDay:function(){return this._.getUTCDay();},getFullYear:function(){return this._.getUTCFullYear();},getHours:function(){return this._.getUTCHours();},getMilliseconds:function(){return this._.getUTCMilliseconds();},getMinutes:function(){return this._.getUTCMinutes();},getMonth:function(){return this._.getUTCMonth();},getSeconds:function(){return this._.getUTCSeconds();},getTime:function(){return this._.getTime();},getTimezoneOffset:function(){return 0;},valueOf:function(){return this._.valueOf();},setDate:function(){d3_time_prototype.setUTCDate.apply(this._,arguments);},setDay:function(){d3_time_prototype.setUTCDay.apply(this._,arguments);},setFullYear:function(){d3_time_prototype.setUTCFullYear.apply(this._,arguments);},setHours:function(){d3_time_prototype.setUTCHours.apply(this._,arguments);},setMilliseconds:function(){d3_time_prototype.setUTCMilliseconds.apply(this._,arguments);},setMinutes:function(){d3_time_prototype.setUTCMinutes.apply(this._,arguments);},setMonth:function(){d3_time_prototype.setUTCMonth.apply(this._,arguments);},setSeconds:function(){d3_time_prototype.setUTCSeconds.apply(this._,arguments);},setTime:function(){d3_time_prototype.setTime.apply(this._,arguments);}};var d3_time_prototype=Date.prototype;function d3_time_interval(local,step,number){function round(date){var d0=local(date),d1=offset(d0,1);return date-d0<d1-date?d0:d1;}
function ceil(date){step(date=local(new d3_date(date-1)),1);return date;}
function offset(date,k){step(date=new d3_date(+date),k);return date;}
function range(t0,t1,dt){var time=ceil(t0),times=[];if(dt>1){while(time<t1){if(!(number(time)%dt))times.push(new Date(+time));step(time,1);}}else{while(time<t1)times.push(new Date(+time)),step(time,1);}
return times;}
function range_utc(t0,t1,dt){try{d3_date=d3_date_utc;var utc=new d3_date_utc();utc._=t0;return range(utc,t1,dt);}finally{d3_date=Date;}}
local.floor=local;local.round=round;local.ceil=ceil;local.offset=offset;local.range=range;var utc=local.utc=d3_time_interval_utc(local);utc.floor=utc;utc.round=d3_time_interval_utc(round);utc.ceil=d3_time_interval_utc(ceil);utc.offset=d3_time_interval_utc(offset);utc.range=range_utc;return local;}
function d3_time_interval_utc(method){return function(date,k){try{d3_date=d3_date_utc;var utc=new d3_date_utc();utc._=date;return method(utc,k)._;}finally{d3_date=Date;}};}
d3_time.year=d3_time_interval(function(date){date=d3_time.day(date);date.setMonth(0,1);return date;},function(date,offset){date.setFullYear(date.getFullYear()+offset);},function(date){return date.getFullYear();});d3_time.years=d3_time.year.range;d3_time.years.utc=d3_time.year.utc.range;d3_time.day=d3_time_interval(function(date){var day=new d3_date(2e3,0);day.setFullYear(date.getFullYear(),date.getMonth(),date.getDate());return day;},function(date,offset){date.setDate(date.getDate()+offset);},function(date){return date.getDate()-1;});d3_time.days=d3_time.day.range;d3_time.days.utc=d3_time.day.utc.range;d3_time.dayOfYear=function(date){var year=d3_time.year(date);return Math.floor((date-year-(date.getTimezoneOffset()-year.getTimezoneOffset())*6e4)/864e5);};["sunday","monday","tuesday","wednesday","thursday","friday","saturday"].forEach(function(day,i){i=7-i;var interval=d3_time[day]=d3_time_interval(function(date){(date=d3_time.day(date)).setDate(date.getDate()-(date.getDay()+i)%7);return date;},function(date,offset){date.setDate(date.getDate()+Math.floor(offset)*7);},function(date){var day=d3_time.year(date).getDay();return Math.floor((d3_time.dayOfYear(date)+(day+i)%7)/7)-(day!==i);});d3_time[day+"s"]=interval.range;d3_time[day+"s"].utc=interval.utc.range;d3_time[day+"OfYear"]=function(date){var day=d3_time.year(date).getDay();return Math.floor((d3_time.dayOfYear(date)+(day+i)%7)/7);};});d3_time.week=d3_time.sunday;d3_time.weeks=d3_time.sunday.range;d3_time.weeks.utc=d3_time.sunday.utc.range;d3_time.weekOfYear=d3_time.sundayOfYear;function d3_locale_timeFormat(locale){var locale_dateTime=locale.dateTime,locale_date=locale.date,locale_time=locale.time,locale_periods=locale.periods,locale_days=locale.days,locale_shortDays=locale.shortDays,locale_months=locale.months,locale_shortMonths=locale.shortMonths;function d3_time_format(template){var n=template.length;function format(date){var string=[],i=-1,j=0,c,p,f;while(++i<n){if(template.charCodeAt(i)===37){string.push(template.slice(j,i));if((p=d3_time_formatPads[c=template.charAt(++i)])!=null)c=template.charAt(++i);if(f=d3_time_formats[c])c=f(date,p==null?c==="e"?" ":"0":p);string.push(c);j=i+1;}}
string.push(template.slice(j,i));return string.join("");}
format.parse=function(string){var d={y:1900,m:0,d:1,H:0,M:0,S:0,L:0,Z:null},i=d3_time_parse(d,template,string,0);if(i!=string.length)return null;if("p"in d)d.H=d.H%12+d.p*12;var localZ=d.Z!=null&&d3_date!==d3_date_utc,date=new(localZ?d3_date_utc:d3_date)();if("j"in d)date.setFullYear(d.y,0,d.j);else if("w"in d&&("W"in d||"U"in d)){date.setFullYear(d.y,0,1);date.setFullYear(d.y,0,"W"in d?(d.w+6)%7+d.W*7-(date.getDay()+5)%7:d.w+d.U*7-(date.getDay()+6)%7);}else date.setFullYear(d.y,d.m,d.d);date.setHours(d.H+(d.Z/100|0),d.M+d.Z%100,d.S,d.L);return localZ?date._:date;};format.toString=function(){return template;};return format;}
function d3_time_parse(date,template,string,j){var c,p,t,i=0,n=template.length,m=string.length;while(i<n){if(j>=m)return-1;c=template.charCodeAt(i++);if(c===37){t=template.charAt(i++);p=d3_time_parsers[t in d3_time_formatPads?template.charAt(i++):t];if(!p||(j=p(date,string,j))<0)return-1;}else if(c!=string.charCodeAt(j++)){return-1;}}
return j;}
d3_time_format.utc=function(template){var local=d3_time_format(template);function format(date){try{d3_date=d3_date_utc;var utc=new d3_date();utc._=date;return local(utc);}finally{d3_date=Date;}}
format.parse=function(string){try{d3_date=d3_date_utc;var date=local.parse(string);return date&&date._;}finally{d3_date=Date;}};format.toString=local.toString;return format;};d3_time_format.multi=d3_time_format.utc.multi=d3_time_formatMulti;var d3_time_periodLookup=d3.map(),d3_time_dayRe=d3_time_formatRe(locale_days),d3_time_dayLookup=d3_time_formatLookup(locale_days),d3_time_dayAbbrevRe=d3_time_formatRe(locale_shortDays),d3_time_dayAbbrevLookup=d3_time_formatLookup(locale_shortDays),d3_time_monthRe=d3_time_formatRe(locale_months),d3_time_monthLookup=d3_time_formatLookup(locale_months),d3_time_monthAbbrevRe=d3_time_formatRe(locale_shortMonths),d3_time_monthAbbrevLookup=d3_time_formatLookup(locale_shortMonths);locale_periods.forEach(function(p,i){d3_time_periodLookup.set(p.toLowerCase(),i);});var d3_time_formats={a:function(d){return locale_shortDays[d.getDay()];},A:function(d){return locale_days[d.getDay()];},b:function(d){return locale_shortMonths[d.getMonth()];},B:function(d){return locale_months[d.getMonth()];},c:d3_time_format(locale_dateTime),d:function(d,p){return d3_time_formatPad(d.getDate(),p,2);},e:function(d,p){return d3_time_formatPad(d.getDate(),p,2);},H:function(d,p){return d3_time_formatPad(d.getHours(),p,2);},I:function(d,p){return d3_time_formatPad(d.getHours()%12||12,p,2);},j:function(d,p){return d3_time_formatPad(1+d3_time.dayOfYear(d),p,3);},L:function(d,p){return d3_time_formatPad(d.getMilliseconds(),p,3);},m:function(d,p){return d3_time_formatPad(d.getMonth()+1,p,2);},M:function(d,p){return d3_time_formatPad(d.getMinutes(),p,2);},p:function(d){return locale_periods[+(d.getHours()>=12)];},S:function(d,p){return d3_time_formatPad(d.getSeconds(),p,2);},U:function(d,p){return d3_time_formatPad(d3_time.sundayOfYear(d),p,2);},w:function(d){return d.getDay();},W:function(d,p){return d3_time_formatPad(d3_time.mondayOfYear(d),p,2);},x:d3_time_format(locale_date),X:d3_time_format(locale_time),y:function(d,p){return d3_time_formatPad(d.getFullYear()%100,p,2);},Y:function(d,p){return d3_time_formatPad(d.getFullYear()%1e4,p,4);},Z:d3_time_zone,"%":function(){return"%";}};var d3_time_parsers={a:d3_time_parseWeekdayAbbrev,A:d3_time_parseWeekday,b:d3_time_parseMonthAbbrev,B:d3_time_parseMonth,c:d3_time_parseLocaleFull,d:d3_time_parseDay,e:d3_time_parseDay,H:d3_time_parseHour24,I:d3_time_parseHour24,j:d3_time_parseDayOfYear,L:d3_time_parseMilliseconds,m:d3_time_parseMonthNumber,M:d3_time_parseMinutes,p:d3_time_parseAmPm,S:d3_time_parseSeconds,U:d3_time_parseWeekNumberSunday,w:d3_time_parseWeekdayNumber,W:d3_time_parseWeekNumberMonday,x:d3_time_parseLocaleDate,X:d3_time_parseLocaleTime,y:d3_time_parseYear,Y:d3_time_parseFullYear,Z:d3_time_parseZone,"%":d3_time_parseLiteralPercent};function d3_time_parseWeekdayAbbrev(date,string,i){d3_time_dayAbbrevRe.lastIndex=0;var n=d3_time_dayAbbrevRe.exec(string.slice(i));return n?(date.w=d3_time_dayAbbrevLookup.get(n[0].toLowerCase()),i+n[0].length):-1;}
function d3_time_parseWeekday(date,string,i){d3_time_dayRe.lastIndex=0;var n=d3_time_dayRe.exec(string.slice(i));return n?(date.w=d3_time_dayLookup.get(n[0].toLowerCase()),i+n[0].length):-1;}
function d3_time_parseMonthAbbrev(date,string,i){d3_time_monthAbbrevRe.lastIndex=0;var n=d3_time_monthAbbrevRe.exec(string.slice(i));return n?(date.m=d3_time_monthAbbrevLookup.get(n[0].toLowerCase()),i+n[0].length):-1;}
function d3_time_parseMonth(date,string,i){d3_time_monthRe.lastIndex=0;var n=d3_time_monthRe.exec(string.slice(i));return n?(date.m=d3_time_monthLookup.get(n[0].toLowerCase()),i+n[0].length):-1;}
function d3_time_parseLocaleFull(date,string,i){return d3_time_parse(date,d3_time_formats.c.toString(),string,i);}
function d3_time_parseLocaleDate(date,string,i){return d3_time_parse(date,d3_time_formats.x.toString(),string,i);}
function d3_time_parseLocaleTime(date,string,i){return d3_time_parse(date,d3_time_formats.X.toString(),string,i);}
function d3_time_parseAmPm(date,string,i){var n=d3_time_periodLookup.get(string.slice(i,i+=2).toLowerCase());return n==null?-1:(date.p=n,i);}
return d3_time_format;}
var d3_time_formatPads={"-":"",_:" ","0":"0"},d3_time_numberRe=/^\s*\d+/,d3_time_percentRe=/^%/;function d3_time_formatPad(value,fill,width){var sign=value<0?"-":"",string=(sign?-value:value)+"",length=string.length;return sign+(length<width?new Array(width-length+1).join(fill)+string:string);}
function d3_time_formatRe(names){return new RegExp("^(?:"+names.map(d3.requote).join("|")+")","i");}
function d3_time_formatLookup(names){var map=new d3_Map(),i=-1,n=names.length;while(++i<n)map.set(names[i].toLowerCase(),i);return map;}
function d3_time_parseWeekdayNumber(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+1));return n?(date.w=+n[0],i+n[0].length):-1;}
function d3_time_parseWeekNumberSunday(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i));return n?(date.U=+n[0],i+n[0].length):-1;}
function d3_time_parseWeekNumberMonday(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i));return n?(date.W=+n[0],i+n[0].length):-1;}
function d3_time_parseFullYear(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+4));return n?(date.y=+n[0],i+n[0].length):-1;}
function d3_time_parseYear(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+2));return n?(date.y=d3_time_expandYear(+n[0]),i+n[0].length):-1;}
function d3_time_parseZone(date,string,i){return/^[+-]\d{4}$/.test(string=string.slice(i,i+5))?(date.Z=-string,i+5):-1;}
function d3_time_expandYear(d){return d+(d>68?1900:2e3);}
function d3_time_parseMonthNumber(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+2));return n?(date.m=n[0]-1,i+n[0].length):-1;}
function d3_time_parseDay(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+2));return n?(date.d=+n[0],i+n[0].length):-1;}
function d3_time_parseDayOfYear(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+3));return n?(date.j=+n[0],i+n[0].length):-1;}
function d3_time_parseHour24(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+2));return n?(date.H=+n[0],i+n[0].length):-1;}
function d3_time_parseMinutes(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+2));return n?(date.M=+n[0],i+n[0].length):-1;}
function d3_time_parseSeconds(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+2));return n?(date.S=+n[0],i+n[0].length):-1;}
function d3_time_parseMilliseconds(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+3));return n?(date.L=+n[0],i+n[0].length):-1;}
function d3_time_zone(d){var z=d.getTimezoneOffset(),zs=z>0?"-":"+",zh=abs(z)/60|0,zm=abs(z)%60;return zs+d3_time_formatPad(zh,"0",2)+d3_time_formatPad(zm,"0",2);}
function d3_time_parseLiteralPercent(date,string,i){d3_time_percentRe.lastIndex=0;var n=d3_time_percentRe.exec(string.slice(i,i+1));return n?i+n[0].length:-1;}
function d3_time_formatMulti(formats){var n=formats.length,i=-1;while(++i<n)formats[i][0]=this(formats[i][0]);return function(date){var i=0,f=formats[i];while(!f[1](date))f=formats[++i];return f[0](date);};}
d3.locale=function(locale){return{numberFormat:d3_locale_numberFormat(locale),timeFormat:d3_locale_timeFormat(locale)};};var d3_locale_enUS=d3.locale({decimal:".",thousands:",",grouping:[3],currency:["$",""],dateTime:"%a %b %e %X %Y",date:"%m/%d/%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});d3.format=d3_locale_enUS.numberFormat;d3.geo={};function d3_adder(){}
d3_adder.prototype={s:0,t:0,add:function(y){d3_adderSum(y,this.t,d3_adderTemp);d3_adderSum(d3_adderTemp.s,this.s,this);if(this.s)this.t+=d3_adderTemp.t;else this.s=d3_adderTemp.t;},reset:function(){this.s=this.t=0;},valueOf:function(){return this.s;}};var d3_adderTemp=new d3_adder();function d3_adderSum(a,b,o){var x=o.s=a+b,bv=x-a,av=x-bv;o.t=a-av+(b-bv);}
d3.geo.stream=function(object,listener){if(object&&d3_geo_streamObjectType.hasOwnProperty(object.type)){d3_geo_streamObjectType[object.type](object,listener);}else{d3_geo_streamGeometry(object,listener);}};function d3_geo_streamGeometry(geometry,listener){if(geometry&&d3_geo_streamGeometryType.hasOwnProperty(geometry.type)){d3_geo_streamGeometryType[geometry.type](geometry,listener);}}
var d3_geo_streamObjectType={Feature:function(feature,listener){d3_geo_streamGeometry(feature.geometry,listener);},FeatureCollection:function(object,listener){var features=object.features,i=-1,n=features.length;while(++i<n)d3_geo_streamGeometry(features[i].geometry,listener);}};var d3_geo_streamGeometryType={Sphere:function(object,listener){listener.sphere();},Point:function(object,listener){object=object.coordinates;listener.point(object[0],object[1],object[2]);},MultiPoint:function(object,listener){var coordinates=object.coordinates,i=-1,n=coordinates.length;while(++i<n)object=coordinates[i],listener.point(object[0],object[1],object[2]);},LineString:function(object,listener){d3_geo_streamLine(object.coordinates,listener,0);},MultiLineString:function(object,listener){var coordinates=object.coordinates,i=-1,n=coordinates.length;while(++i<n)d3_geo_streamLine(coordinates[i],listener,0);},Polygon:function(object,listener){d3_geo_streamPolygon(object.coordinates,listener);},MultiPolygon:function(object,listener){var coordinates=object.coordinates,i=-1,n=coordinates.length;while(++i<n)d3_geo_streamPolygon(coordinates[i],listener);},GeometryCollection:function(object,listener){var geometries=object.geometries,i=-1,n=geometries.length;while(++i<n)d3_geo_streamGeometry(geometries[i],listener);}};function d3_geo_streamLine(coordinates,listener,closed){var i=-1,n=coordinates.length-closed,coordinate;listener.lineStart();while(++i<n)coordinate=coordinates[i],listener.point(coordinate[0],coordinate[1],coordinate[2]);listener.lineEnd();}
function d3_geo_streamPolygon(coordinates,listener){var i=-1,n=coordinates.length;listener.polygonStart();while(++i<n)d3_geo_streamLine(coordinates[i],listener,1);listener.polygonEnd();}
d3.geo.area=function(object){d3_geo_areaSum=0;d3.geo.stream(object,d3_geo_area);return d3_geo_areaSum;};var d3_geo_areaSum,d3_geo_areaRingSum=new d3_adder();var d3_geo_area={sphere:function(){d3_geo_areaSum+=4*π;},point:d3_noop,lineStart:d3_noop,lineEnd:d3_noop,polygonStart:function(){d3_geo_areaRingSum.reset();d3_geo_area.lineStart=d3_geo_areaRingStart;},polygonEnd:function(){var area=2*d3_geo_areaRingSum;d3_geo_areaSum+=area<0?4*π+area:area;d3_geo_area.lineStart=d3_geo_area.lineEnd=d3_geo_area.point=d3_noop;}};function d3_geo_areaRingStart(){var λ00,φ00,λ0,cosφ0,sinφ0;d3_geo_area.point=function(λ,φ){d3_geo_area.point=nextPoint;λ0=(λ00=λ)*d3_radians,cosφ0=Math.cos(φ=(φ00=φ)*d3_radians/2+π/4),sinφ0=Math.sin(φ);};function nextPoint(λ,φ){λ*=d3_radians;φ=φ*d3_radians/2+π/4;var dλ=λ-λ0,sdλ=dλ>=0?1:-1,adλ=sdλ*dλ,cosφ=Math.cos(φ),sinφ=Math.sin(φ),k=sinφ0*sinφ,u=cosφ0*cosφ+k*Math.cos(adλ),v=k*sdλ*Math.sin(adλ);d3_geo_areaRingSum.add(Math.atan2(v,u));λ0=λ,cosφ0=cosφ,sinφ0=sinφ;}
d3_geo_area.lineEnd=function(){nextPoint(λ00,φ00);};}
function d3_geo_cartesian(spherical){var λ=spherical[0],φ=spherical[1],cosφ=Math.cos(φ);return[cosφ*Math.cos(λ),cosφ*Math.sin(λ),Math.sin(φ)];}
function d3_geo_cartesianDot(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2];}
function d3_geo_cartesianCross(a,b){return[a[1]*b[2]-a[2]*b[1],a[2]*b[0]-a[0]*b[2],a[0]*b[1]-a[1]*b[0]];}
function d3_geo_cartesianAdd(a,b){a[0]+=b[0];a[1]+=b[1];a[2]+=b[2];}
function d3_geo_cartesianScale(vector,k){return[vector[0]*k,vector[1]*k,vector[2]*k];}
function d3_geo_cartesianNormalize(d){var l=Math.sqrt(d[0]*d[0]+d[1]*d[1]+d[2]*d[2]);d[0]/=l;d[1]/=l;d[2]/=l;}
function d3_geo_spherical(cartesian){return[Math.atan2(cartesian[1],cartesian[0]),d3_asin(cartesian[2])];}
function d3_geo_sphericalEqual(a,b){return abs(a[0]-b[0])<ε&&abs(a[1]-b[1])<ε;}
d3.geo.bounds=function(){var λ0,φ0,λ1,φ1,λ_,λ__,φ__,p0,dλSum,ranges,range;var bound={point:point,lineStart:lineStart,lineEnd:lineEnd,polygonStart:function(){bound.point=ringPoint;bound.lineStart=ringStart;bound.lineEnd=ringEnd;dλSum=0;d3_geo_area.polygonStart();},polygonEnd:function(){d3_geo_area.polygonEnd();bound.point=point;bound.lineStart=lineStart;bound.lineEnd=lineEnd;if(d3_geo_areaRingSum<0)λ0=-(λ1=180),φ0=-(φ1=90);else if(dλSum>ε)φ1=90;else if(dλSum<-ε)φ0=-90;range[0]=λ0,range[1]=λ1;}};function point(λ,φ){ranges.push(range=[λ0=λ,λ1=λ]);if(φ<φ0)φ0=φ;if(φ>φ1)φ1=φ;}
function linePoint(λ,φ){var p=d3_geo_cartesian([λ*d3_radians,φ*d3_radians]);if(p0){var normal=d3_geo_cartesianCross(p0,p),equatorial=[normal[1],-normal[0],0],inflection=d3_geo_cartesianCross(equatorial,normal);d3_geo_cartesianNormalize(inflection);inflection=d3_geo_spherical(inflection);var dλ=λ-λ_,s=dλ>0?1:-1,λi=inflection[0]*d3_degrees*s,antimeridian=abs(dλ)>180;if(antimeridian^(s*λ_<λi&&λi<s*λ)){var φi=inflection[1]*d3_degrees;if(φi>φ1)φ1=φi;}else if(λi=(λi+360)%360-180,antimeridian^(s*λ_<λi&&λi<s*λ)){var φi=-inflection[1]*d3_degrees;if(φi<φ0)φ0=φi;}else{if(φ<φ0)φ0=φ;if(φ>φ1)φ1=φ;}
if(antimeridian){if(λ<λ_){if(angle(λ0,λ)>angle(λ0,λ1))λ1=λ;}else{if(angle(λ,λ1)>angle(λ0,λ1))λ0=λ;}}else{if(λ1>=λ0){if(λ<λ0)λ0=λ;if(λ>λ1)λ1=λ;}else{if(λ>λ_){if(angle(λ0,λ)>angle(λ0,λ1))λ1=λ;}else{if(angle(λ,λ1)>angle(λ0,λ1))λ0=λ;}}}}else{point(λ,φ);}
p0=p,λ_=λ;}
function lineStart(){bound.point=linePoint;}
function lineEnd(){range[0]=λ0,range[1]=λ1;bound.point=point;p0=null;}
function ringPoint(λ,φ){if(p0){var dλ=λ-λ_;dλSum+=abs(dλ)>180?dλ+(dλ>0?360:-360):dλ;}else λ__=λ,φ__=φ;d3_geo_area.point(λ,φ);linePoint(λ,φ);}
function ringStart(){d3_geo_area.lineStart();}
function ringEnd(){ringPoint(λ__,φ__);d3_geo_area.lineEnd();if(abs(dλSum)>ε)λ0=-(λ1=180);range[0]=λ0,range[1]=λ1;p0=null;}
function angle(λ0,λ1){return(λ1-=λ0)<0?λ1+360:λ1;}
function compareRanges(a,b){return a[0]-b[0];}
function withinRange(x,range){return range[0]<=range[1]?range[0]<=x&&x<=range[1]:x<range[0]||range[1]<x;}
return function(feature){φ1=λ1=-(λ0=φ0=Infinity);ranges=[];d3.geo.stream(feature,bound);var n=ranges.length;if(n){ranges.sort(compareRanges);for(var i=1,a=ranges[0],b,merged=[a];i<n;++i){b=ranges[i];if(withinRange(b[0],a)||withinRange(b[1],a)){if(angle(a[0],b[1])>angle(a[0],a[1]))a[1]=b[1];if(angle(b[0],a[1])>angle(a[0],a[1]))a[0]=b[0];}else{merged.push(a=b);}}
var best=-Infinity,dλ;for(var n=merged.length-1,i=0,a=merged[n],b;i<=n;a=b,++i){b=merged[i];if((dλ=angle(a[1],b[0]))>best)best=dλ,λ0=b[0],λ1=a[1];}}
ranges=range=null;return λ0===Infinity||φ0===Infinity?[[NaN,NaN],[NaN,NaN]]:[[λ0,φ0],[λ1,φ1]];};}();d3.geo.centroid=function(object){d3_geo_centroidW0=d3_geo_centroidW1=d3_geo_centroidX0=d3_geo_centroidY0=d3_geo_centroidZ0=d3_geo_centroidX1=d3_geo_centroidY1=d3_geo_centroidZ1=d3_geo_centroidX2=d3_geo_centroidY2=d3_geo_centroidZ2=0;d3.geo.stream(object,d3_geo_centroid);var x=d3_geo_centroidX2,y=d3_geo_centroidY2,z=d3_geo_centroidZ2,m=x*x+y*y+z*z;if(m<ε2){x=d3_geo_centroidX1,y=d3_geo_centroidY1,z=d3_geo_centroidZ1;if(d3_geo_centroidW1<ε)x=d3_geo_centroidX0,y=d3_geo_centroidY0,z=d3_geo_centroidZ0;m=x*x+y*y+z*z;if(m<ε2)return[NaN,NaN];}
return[Math.atan2(y,x)*d3_degrees,d3_asin(z/Math.sqrt(m))*d3_degrees];};var d3_geo_centroidW0,d3_geo_centroidW1,d3_geo_centroidX0,d3_geo_centroidY0,d3_geo_centroidZ0,d3_geo_centroidX1,d3_geo_centroidY1,d3_geo_centroidZ1,d3_geo_centroidX2,d3_geo_centroidY2,d3_geo_centroidZ2;var d3_geo_centroid={sphere:d3_noop,point:d3_geo_centroidPoint,lineStart:d3_geo_centroidLineStart,lineEnd:d3_geo_centroidLineEnd,polygonStart:function(){d3_geo_centroid.lineStart=d3_geo_centroidRingStart;},polygonEnd:function(){d3_geo_centroid.lineStart=d3_geo_centroidLineStart;}};function d3_geo_centroidPoint(λ,φ){λ*=d3_radians;var cosφ=Math.cos(φ*=d3_radians);d3_geo_centroidPointXYZ(cosφ*Math.cos(λ),cosφ*Math.sin(λ),Math.sin(φ));}
function d3_geo_centroidPointXYZ(x,y,z){++d3_geo_centroidW0;d3_geo_centroidX0+=(x-d3_geo_centroidX0)/d3_geo_centroidW0;d3_geo_centroidY0+=(y-d3_geo_centroidY0)/d3_geo_centroidW0;d3_geo_centroidZ0+=(z-d3_geo_centroidZ0)/d3_geo_centroidW0;}
function d3_geo_centroidLineStart(){var x0,y0,z0;d3_geo_centroid.point=function(λ,φ){λ*=d3_radians;var cosφ=Math.cos(φ*=d3_radians);x0=cosφ*Math.cos(λ);y0=cosφ*Math.sin(λ);z0=Math.sin(φ);d3_geo_centroid.point=nextPoint;d3_geo_centroidPointXYZ(x0,y0,z0);};function nextPoint(λ,φ){λ*=d3_radians;var cosφ=Math.cos(φ*=d3_radians),x=cosφ*Math.cos(λ),y=cosφ*Math.sin(λ),z=Math.sin(φ),w=Math.atan2(Math.sqrt((w=y0*z-z0*y)*w+(w=z0*x-x0*z)*w+(w=x0*y-y0*x)*w),x0*x+y0*y+z0*z);d3_geo_centroidW1+=w;d3_geo_centroidX1+=w*(x0+(x0=x));d3_geo_centroidY1+=w*(y0+(y0=y));d3_geo_centroidZ1+=w*(z0+(z0=z));d3_geo_centroidPointXYZ(x0,y0,z0);}}
function d3_geo_centroidLineEnd(){d3_geo_centroid.point=d3_geo_centroidPoint;}
function d3_geo_centroidRingStart(){var λ00,φ00,x0,y0,z0;d3_geo_centroid.point=function(λ,φ){λ00=λ,φ00=φ;d3_geo_centroid.point=nextPoint;λ*=d3_radians;var cosφ=Math.cos(φ*=d3_radians);x0=cosφ*Math.cos(λ);y0=cosφ*Math.sin(λ);z0=Math.sin(φ);d3_geo_centroidPointXYZ(x0,y0,z0);};d3_geo_centroid.lineEnd=function(){nextPoint(λ00,φ00);d3_geo_centroid.lineEnd=d3_geo_centroidLineEnd;d3_geo_centroid.point=d3_geo_centroidPoint;};function nextPoint(λ,φ){λ*=d3_radians;var cosφ=Math.cos(φ*=d3_radians),x=cosφ*Math.cos(λ),y=cosφ*Math.sin(λ),z=Math.sin(φ),cx=y0*z-z0*y,cy=z0*x-x0*z,cz=x0*y-y0*x,m=Math.sqrt(cx*cx+cy*cy+cz*cz),u=x0*x+y0*y+z0*z,v=m&&-d3_acos(u)/m,w=Math.atan2(m,u);d3_geo_centroidX2+=v*cx;d3_geo_centroidY2+=v*cy;d3_geo_centroidZ2+=v*cz;d3_geo_centroidW1+=w;d3_geo_centroidX1+=w*(x0+(x0=x));d3_geo_centroidY1+=w*(y0+(y0=y));d3_geo_centroidZ1+=w*(z0+(z0=z));d3_geo_centroidPointXYZ(x0,y0,z0);}}
function d3_geo_compose(a,b){function compose(x,y){return x=a(x,y),b(x[0],x[1]);}
if(a.invert&&b.invert)compose.invert=function(x,y){return x=b.invert(x,y),x&&a.invert(x[0],x[1]);};return compose;}
function d3_true(){return true;}
function d3_geo_clipPolygon(segments,compare,clipStartInside,interpolate,listener){var subject=[],clip=[];segments.forEach(function(segment){if((n=segment.length-1)<=0)return;var n,p0=segment[0],p1=segment[n];if(d3_geo_sphericalEqual(p0,p1)){listener.lineStart();for(var i=0;i<n;++i)listener.point((p0=segment[i])[0],p0[1]);listener.lineEnd();return;}
var a=new d3_geo_clipPolygonIntersection(p0,segment,null,true),b=new d3_geo_clipPolygonIntersection(p0,null,a,false);a.o=b;subject.push(a);clip.push(b);a=new d3_geo_clipPolygonIntersection(p1,segment,null,false);b=new d3_geo_clipPolygonIntersection(p1,null,a,true);a.o=b;subject.push(a);clip.push(b);});clip.sort(compare);d3_geo_clipPolygonLinkCircular(subject);d3_geo_clipPolygonLinkCircular(clip);if(!subject.length)return;for(var i=0,entry=clipStartInside,n=clip.length;i<n;++i){clip[i].e=entry=!entry;}
var start=subject[0],points,point;while(1){var current=start,isSubject=true;while(current.v)if((current=current.n)===start)return;points=current.z;listener.lineStart();do{current.v=current.o.v=true;if(current.e){if(isSubject){for(var i=0,n=points.length;i<n;++i)listener.point((point=points[i])[0],point[1]);}else{interpolate(current.x,current.n.x,1,listener);}
current=current.n;}else{if(isSubject){points=current.p.z;for(var i=points.length-1;i>=0;--i)listener.point((point=points[i])[0],point[1]);}else{interpolate(current.x,current.p.x,-1,listener);}
current=current.p;}
current=current.o;points=current.z;isSubject=!isSubject;}while(!current.v);listener.lineEnd();}}
function d3_geo_clipPolygonLinkCircular(array){if(!(n=array.length))return;var n,i=0,a=array[0],b;while(++i<n){a.n=b=array[i];b.p=a;a=b;}
a.n=b=array[0];b.p=a;}
function d3_geo_clipPolygonIntersection(point,points,other,entry){this.x=point;this.z=points;this.o=other;this.e=entry;this.v=false;this.n=this.p=null;}
function d3_geo_clip(pointVisible,clipLine,interpolate,clipStart){return function(rotate,listener){var line=clipLine(listener),rotatedClipStart=rotate.invert(clipStart[0],clipStart[1]);var clip={point:point,lineStart:lineStart,lineEnd:lineEnd,polygonStart:function(){clip.point=pointRing;clip.lineStart=ringStart;clip.lineEnd=ringEnd;segments=[];polygon=[];},polygonEnd:function(){clip.point=point;clip.lineStart=lineStart;clip.lineEnd=lineEnd;segments=d3.merge(segments);var clipStartInside=d3_geo_pointInPolygon(rotatedClipStart,polygon);if(segments.length){if(!polygonStarted)listener.polygonStart(),polygonStarted=true;d3_geo_clipPolygon(segments,d3_geo_clipSort,clipStartInside,interpolate,listener);}else if(clipStartInside){if(!polygonStarted)listener.polygonStart(),polygonStarted=true;listener.lineStart();interpolate(null,null,1,listener);listener.lineEnd();}
if(polygonStarted)listener.polygonEnd(),polygonStarted=false;segments=polygon=null;},sphere:function(){listener.polygonStart();listener.lineStart();interpolate(null,null,1,listener);listener.lineEnd();listener.polygonEnd();}};function point(λ,φ){var point=rotate(λ,φ);if(pointVisible(λ=point[0],φ=point[1]))listener.point(λ,φ);}
function pointLine(λ,φ){var point=rotate(λ,φ);line.point(point[0],point[1]);}
function lineStart(){clip.point=pointLine;line.lineStart();}
function lineEnd(){clip.point=point;line.lineEnd();}
var segments;var buffer=d3_geo_clipBufferListener(),ringListener=clipLine(buffer),polygonStarted=false,polygon,ring;function pointRing(λ,φ){ring.push([λ,φ]);var point=rotate(λ,φ);ringListener.point(point[0],point[1]);}
function ringStart(){ringListener.lineStart();ring=[];}
function ringEnd(){pointRing(ring[0][0],ring[0][1]);ringListener.lineEnd();var clean=ringListener.clean(),ringSegments=buffer.buffer(),segment,n=ringSegments.length;ring.pop();polygon.push(ring);ring=null;if(!n)return;if(clean&1){segment=ringSegments[0];var n=segment.length-1,i=-1,point;if(n>0){if(!polygonStarted)listener.polygonStart(),polygonStarted=true;listener.lineStart();while(++i<n)listener.point((point=segment[i])[0],point[1]);listener.lineEnd();}
return;}
if(n>1&&clean&2)ringSegments.push(ringSegments.pop().concat(ringSegments.shift()));segments.push(ringSegments.filter(d3_geo_clipSegmentLength1));}
return clip;};}
function d3_geo_clipSegmentLength1(segment){return segment.length>1;}
function d3_geo_clipBufferListener(){var lines=[],line;return{lineStart:function(){lines.push(line=[]);},point:function(λ,φ){line.push([λ,φ]);},lineEnd:d3_noop,buffer:function(){var buffer=lines;lines=[];line=null;return buffer;},rejoin:function(){if(lines.length>1)lines.push(lines.pop().concat(lines.shift()));}};}
function d3_geo_clipSort(a,b){return((a=a.x)[0]<0?a[1]-halfπ-ε:halfπ-a[1])-((b=b.x)[0]<0?b[1]-halfπ-ε:halfπ-b[1]);}
var d3_geo_clipAntimeridian=d3_geo_clip(d3_true,d3_geo_clipAntimeridianLine,d3_geo_clipAntimeridianInterpolate,[-π,-π/2]);function d3_geo_clipAntimeridianLine(listener){var λ0=NaN,φ0=NaN,sλ0=NaN,clean;return{lineStart:function(){listener.lineStart();clean=1;},point:function(λ1,φ1){var sλ1=λ1>0?π:-π,dλ=abs(λ1-λ0);if(abs(dλ-π)<ε){listener.point(λ0,φ0=(φ0+φ1)/2>0?halfπ:-halfπ);listener.point(sλ0,φ0);listener.lineEnd();listener.lineStart();listener.point(sλ1,φ0);listener.point(λ1,φ0);clean=0;}else if(sλ0!==sλ1&&dλ>=π){if(abs(λ0-sλ0)<ε)λ0-=sλ0*ε;if(abs(λ1-sλ1)<ε)λ1-=sλ1*ε;φ0=d3_geo_clipAntimeridianIntersect(λ0,φ0,λ1,φ1);listener.point(sλ0,φ0);listener.lineEnd();listener.lineStart();listener.point(sλ1,φ0);clean=0;}
listener.point(λ0=λ1,φ0=φ1);sλ0=sλ1;},lineEnd:function(){listener.lineEnd();λ0=φ0=NaN;},clean:function(){return 2-clean;}};}
function d3_geo_clipAntimeridianIntersect(λ0,φ0,λ1,φ1){var cosφ0,cosφ1,sinλ0_λ1=Math.sin(λ0-λ1);return abs(sinλ0_λ1)>ε?Math.atan((Math.sin(φ0)*(cosφ1=Math.cos(φ1))*Math.sin(λ1)-Math.sin(φ1)*(cosφ0=Math.cos(φ0))*Math.sin(λ0))/(cosφ0*cosφ1*sinλ0_λ1)):(φ0+φ1)/2;}
function d3_geo_clipAntimeridianInterpolate(from,to,direction,listener){var φ;if(from==null){φ=direction*halfπ;listener.point(-π,φ);listener.point(0,φ);listener.point(π,φ);listener.point(π,0);listener.point(π,-φ);listener.point(0,-φ);listener.point(-π,-φ);listener.point(-π,0);listener.point(-π,φ);}else if(abs(from[0]-to[0])>ε){var s=from[0]<to[0]?π:-π;φ=direction*s/2;listener.point(-s,φ);listener.point(0,φ);listener.point(s,φ);}else{listener.point(to[0],to[1]);}}
function d3_geo_pointInPolygon(point,polygon){var meridian=point[0],parallel=point[1],meridianNormal=[Math.sin(meridian),-Math.cos(meridian),0],polarAngle=0,winding=0;d3_geo_areaRingSum.reset();for(var i=0,n=polygon.length;i<n;++i){var ring=polygon[i],m=ring.length;if(!m)continue;var point0=ring[0],λ0=point0[0],φ0=point0[1]/2+π/4,sinφ0=Math.sin(φ0),cosφ0=Math.cos(φ0),j=1;while(true){if(j===m)j=0;point=ring[j];var λ=point[0],φ=point[1]/2+π/4,sinφ=Math.sin(φ),cosφ=Math.cos(φ),dλ=λ-λ0,sdλ=dλ>=0?1:-1,adλ=sdλ*dλ,antimeridian=adλ>π,k=sinφ0*sinφ;d3_geo_areaRingSum.add(Math.atan2(k*sdλ*Math.sin(adλ),cosφ0*cosφ+k*Math.cos(adλ)));polarAngle+=antimeridian?dλ+sdλ*τ:dλ;if(antimeridian^λ0>=meridian^λ>=meridian){var arc=d3_geo_cartesianCross(d3_geo_cartesian(point0),d3_geo_cartesian(point));d3_geo_cartesianNormalize(arc);var intersection=d3_geo_cartesianCross(meridianNormal,arc);d3_geo_cartesianNormalize(intersection);var φarc=(antimeridian^dλ>=0?-1:1)*d3_asin(intersection[2]);if(parallel>φarc||parallel===φarc&&(arc[0]||arc[1])){winding+=antimeridian^dλ>=0?1:-1;}}
if(!j++)break;λ0=λ,sinφ0=sinφ,cosφ0=cosφ,point0=point;}}
return(polarAngle<-ε||polarAngle<ε&&d3_geo_areaRingSum<0)^winding&1;}
function d3_geo_clipCircle(radius){var cr=Math.cos(radius),smallRadius=cr>0,notHemisphere=abs(cr)>ε,interpolate=d3_geo_circleInterpolate(radius,6*d3_radians);return d3_geo_clip(visible,clipLine,interpolate,smallRadius?[0,-radius]:[-π,radius-π]);function visible(λ,φ){return Math.cos(λ)*Math.cos(φ)>cr;}
function clipLine(listener){var point0,c0,v0,v00,clean;return{lineStart:function(){v00=v0=false;clean=1;},point:function(λ,φ){var point1=[λ,φ],point2,v=visible(λ,φ),c=smallRadius?v?0:code(λ,φ):v?code(λ+(λ<0?π:-π),φ):0;if(!point0&&(v00=v0=v))listener.lineStart();if(v!==v0){point2=intersect(point0,point1);if(d3_geo_sphericalEqual(point0,point2)||d3_geo_sphericalEqual(point1,point2)){point1[0]+=ε;point1[1]+=ε;v=visible(point1[0],point1[1]);}}
if(v!==v0){clean=0;if(v){listener.lineStart();point2=intersect(point1,point0);listener.point(point2[0],point2[1]);}else{point2=intersect(point0,point1);listener.point(point2[0],point2[1]);listener.lineEnd();}
point0=point2;}else if(notHemisphere&&point0&&smallRadius^v){var t;if(!(c&c0)&&(t=intersect(point1,point0,true))){clean=0;if(smallRadius){listener.lineStart();listener.point(t[0][0],t[0][1]);listener.point(t[1][0],t[1][1]);listener.lineEnd();}else{listener.point(t[1][0],t[1][1]);listener.lineEnd();listener.lineStart();listener.point(t[0][0],t[0][1]);}}}
if(v&&(!point0||!d3_geo_sphericalEqual(point0,point1))){listener.point(point1[0],point1[1]);}
point0=point1,v0=v,c0=c;},lineEnd:function(){if(v0)listener.lineEnd();point0=null;},clean:function(){return clean|(v00&&v0)<<1;}};}
function intersect(a,b,two){var pa=d3_geo_cartesian(a),pb=d3_geo_cartesian(b);var n1=[1,0,0],n2=d3_geo_cartesianCross(pa,pb),n2n2=d3_geo_cartesianDot(n2,n2),n1n2=n2[0],determinant=n2n2-n1n2*n1n2;if(!determinant)return!two&&a;var c1=cr*n2n2/determinant,c2=-cr*n1n2/determinant,n1xn2=d3_geo_cartesianCross(n1,n2),A=d3_geo_cartesianScale(n1,c1),B=d3_geo_cartesianScale(n2,c2);d3_geo_cartesianAdd(A,B);var u=n1xn2,w=d3_geo_cartesianDot(A,u),uu=d3_geo_cartesianDot(u,u),t2=w*w-uu*(d3_geo_cartesianDot(A,A)-1);if(t2<0)return;var t=Math.sqrt(t2),q=d3_geo_cartesianScale(u,(-w-t)/uu);d3_geo_cartesianAdd(q,A);q=d3_geo_spherical(q);if(!two)return q;var λ0=a[0],λ1=b[0],φ0=a[1],φ1=b[1],z;if(λ1<λ0)z=λ0,λ0=λ1,λ1=z;var δλ=λ1-λ0,polar=abs(δλ-π)<ε,meridian=polar||δλ<ε;if(!polar&&φ1<φ0)z=φ0,φ0=φ1,φ1=z;if(meridian?polar?φ0+φ1>0^q[1]<(abs(q[0]-λ0)<ε?φ0:φ1):φ0<=q[1]&&q[1]<=φ1:δλ>π^(λ0<=q[0]&&q[0]<=λ1)){var q1=d3_geo_cartesianScale(u,(-w+t)/uu);d3_geo_cartesianAdd(q1,A);return[q,d3_geo_spherical(q1)];}}
function code(λ,φ){var r=smallRadius?radius:π-radius,code=0;if(λ<-r)code|=1;else if(λ>r)code|=2;if(φ<-r)code|=4;else if(φ>r)code|=8;return code;}}
function d3_geom_clipLine(x0,y0,x1,y1){return function(line){var a=line.a,b=line.b,ax=a.x,ay=a.y,bx=b.x,by=b.y,t0=0,t1=1,dx=bx-ax,dy=by-ay,r;r=x0-ax;if(!dx&&r>0)return;r/=dx;if(dx<0){if(r<t0)return;if(r<t1)t1=r;}else if(dx>0){if(r>t1)return;if(r>t0)t0=r;}
r=x1-ax;if(!dx&&r<0)return;r/=dx;if(dx<0){if(r>t1)return;if(r>t0)t0=r;}else if(dx>0){if(r<t0)return;if(r<t1)t1=r;}
r=y0-ay;if(!dy&&r>0)return;r/=dy;if(dy<0){if(r<t0)return;if(r<t1)t1=r;}else if(dy>0){if(r>t1)return;if(r>t0)t0=r;}
r=y1-ay;if(!dy&&r<0)return;r/=dy;if(dy<0){if(r>t1)return;if(r>t0)t0=r;}else if(dy>0){if(r<t0)return;if(r<t1)t1=r;}
if(t0>0)line.a={x:ax+t0*dx,y:ay+t0*dy};if(t1<1)line.b={x:ax+t1*dx,y:ay+t1*dy};return line;};}
var d3_geo_clipExtentMAX=1e9;d3.geo.clipExtent=function(){var x0,y0,x1,y1,stream,clip,clipExtent={stream:function(output){if(stream)stream.valid=false;stream=clip(output);stream.valid=true;return stream;},extent:function(_){if(!arguments.length)return[[x0,y0],[x1,y1]];clip=d3_geo_clipExtent(x0=+_[0][0],y0=+_[0][1],x1=+_[1][0],y1=+_[1][1]);if(stream)stream.valid=false,stream=null;return clipExtent;}};return clipExtent.extent([[0,0],[960,500]]);};function d3_geo_clipExtent(x0,y0,x1,y1){return function(listener){var listener_=listener,bufferListener=d3_geo_clipBufferListener(),clipLine=d3_geom_clipLine(x0,y0,x1,y1),segments,polygon,ring;var clip={point:point,lineStart:lineStart,lineEnd:lineEnd,polygonStart:function(){listener=bufferListener;segments=[];polygon=[];clean=true;},polygonEnd:function(){listener=listener_;segments=d3.merge(segments);var clipStartInside=insidePolygon([x0,y1]),inside=clean&&clipStartInside,visible=segments.length;if(inside||visible){listener.polygonStart();if(inside){listener.lineStart();interpolate(null,null,1,listener);listener.lineEnd();}
if(visible){d3_geo_clipPolygon(segments,compare,clipStartInside,interpolate,listener);}
listener.polygonEnd();}
segments=polygon=ring=null;}};function insidePolygon(p){var wn=0,n=polygon.length,y=p[1];for(var i=0;i<n;++i){for(var j=1,v=polygon[i],m=v.length,a=v[0],b;j<m;++j){b=v[j];if(a[1]<=y){if(b[1]>y&&d3_cross2d(a,b,p)>0)++wn;}else{if(b[1]<=y&&d3_cross2d(a,b,p)<0)--wn;}
a=b;}}
return wn!==0;}
function interpolate(from,to,direction,listener){var a=0,a1=0;if(from==null||(a=corner(from,direction))!==(a1=corner(to,direction))||comparePoints(from,to)<0^direction>0){do{listener.point(a===0||a===3?x0:x1,a>1?y1:y0);}while((a=(a+direction+4)%4)!==a1);}else{listener.point(to[0],to[1]);}}
function pointVisible(x,y){return x0<=x&&x<=x1&&y0<=y&&y<=y1;}
function point(x,y){if(pointVisible(x,y))listener.point(x,y);}
var x__,y__,v__,x_,y_,v_,first,clean;function lineStart(){clip.point=linePoint;if(polygon)polygon.push(ring=[]);first=true;v_=false;x_=y_=NaN;}
function lineEnd(){if(segments){linePoint(x__,y__);if(v__&&v_)bufferListener.rejoin();segments.push(bufferListener.buffer());}
clip.point=point;if(v_)listener.lineEnd();}
function linePoint(x,y){x=Math.max(-d3_geo_clipExtentMAX,Math.min(d3_geo_clipExtentMAX,x));y=Math.max(-d3_geo_clipExtentMAX,Math.min(d3_geo_clipExtentMAX,y));var v=pointVisible(x,y);if(polygon)ring.push([x,y]);if(first){x__=x,y__=y,v__=v;first=false;if(v){listener.lineStart();listener.point(x,y);}}else{if(v&&v_)listener.point(x,y);else{var l={a:{x:x_,y:y_},b:{x:x,y:y}};if(clipLine(l)){if(!v_){listener.lineStart();listener.point(l.a.x,l.a.y);}
listener.point(l.b.x,l.b.y);if(!v)listener.lineEnd();clean=false;}else if(v){listener.lineStart();listener.point(x,y);clean=false;}}}
x_=x,y_=y,v_=v;}
return clip;};function corner(p,direction){return abs(p[0]-x0)<ε?direction>0?0:3:abs(p[0]-x1)<ε?direction>0?2:1:abs(p[1]-y0)<ε?direction>0?1:0:direction>0?3:2;}
function compare(a,b){return comparePoints(a.x,b.x);}
function comparePoints(a,b){var ca=corner(a,1),cb=corner(b,1);return ca!==cb?ca-cb:ca===0?b[1]-a[1]:ca===1?a[0]-b[0]:ca===2?a[1]-b[1]:b[0]-a[0];}}
function d3_geo_conic(projectAt){var φ0=0,φ1=π/3,m=d3_geo_projectionMutator(projectAt),p=m(φ0,φ1);p.parallels=function(_){if(!arguments.length)return[φ0/π*180,φ1/π*180];return m(φ0=_[0]*π/180,φ1=_[1]*π/180);};return p;}
function d3_geo_conicEqualArea(φ0,φ1){var sinφ0=Math.sin(φ0),n=(sinφ0+Math.sin(φ1))/2,C=1+sinφ0*(2*n-sinφ0),ρ0=Math.sqrt(C)/n;function forward(λ,φ){var ρ=Math.sqrt(C-2*n*Math.sin(φ))/n;return[ρ*Math.sin(λ*=n),ρ0-ρ*Math.cos(λ)];}
forward.invert=function(x,y){var ρ0_y=ρ0-y;return[Math.atan2(x,ρ0_y)/n,d3_asin((C-(x*x+ρ0_y*ρ0_y)*n*n)/(2*n))];};return forward;}
(d3.geo.conicEqualArea=function(){return d3_geo_conic(d3_geo_conicEqualArea);}).raw=d3_geo_conicEqualArea;d3.geo.albers=function(){return d3.geo.conicEqualArea().rotate([96,0]).center([-.6,38.7]).parallels([29.5,45.5]).scale(1070);};d3.geo.albersUsa=function(){var lower48=d3.geo.albers();var alaska=d3.geo.conicEqualArea().rotate([154,0]).center([-2,58.5]).parallels([55,65]);var hawaii=d3.geo.conicEqualArea().rotate([157,0]).center([-3,19.9]).parallels([8,18]);var point,pointStream={point:function(x,y){point=[x,y];}},lower48Point,alaskaPoint,hawaiiPoint;function albersUsa(coordinates){var x=coordinates[0],y=coordinates[1];point=null;(lower48Point(x,y),point)||(alaskaPoint(x,y),point)||hawaiiPoint(x,y);return point;}
albersUsa.invert=function(coordinates){var k=lower48.scale(),t=lower48.translate(),x=(coordinates[0]-t[0])/k,y=(coordinates[1]-t[1])/k;return(y>=.12&&y<.234&&x>=-.425&&x<-.214?alaska:y>=.166&&y<.234&&x>=-.214&&x<-.115?hawaii:lower48).invert(coordinates);};albersUsa.stream=function(stream){var lower48Stream=lower48.stream(stream),alaskaStream=alaska.stream(stream),hawaiiStream=hawaii.stream(stream);return{point:function(x,y){lower48Stream.point(x,y);alaskaStream.point(x,y);hawaiiStream.point(x,y);},sphere:function(){lower48Stream.sphere();alaskaStream.sphere();hawaiiStream.sphere();},lineStart:function(){lower48Stream.lineStart();alaskaStream.lineStart();hawaiiStream.lineStart();},lineEnd:function(){lower48Stream.lineEnd();alaskaStream.lineEnd();hawaiiStream.lineEnd();},polygonStart:function(){lower48Stream.polygonStart();alaskaStream.polygonStart();hawaiiStream.polygonStart();},polygonEnd:function(){lower48Stream.polygonEnd();alaskaStream.polygonEnd();hawaiiStream.polygonEnd();}};};albersUsa.precision=function(_){if(!arguments.length)return lower48.precision();lower48.precision(_);alaska.precision(_);hawaii.precision(_);return albersUsa;};albersUsa.scale=function(_){if(!arguments.length)return lower48.scale();lower48.scale(_);alaska.scale(_*.35);hawaii.scale(_);return albersUsa.translate(lower48.translate());};albersUsa.translate=function(_){if(!arguments.length)return lower48.translate();var k=lower48.scale(),x=+_[0],y=+_[1];lower48Point=lower48.translate(_).clipExtent([[x-.455*k,y-.238*k],[x+.455*k,y+.238*k]]).stream(pointStream).point;alaskaPoint=alaska.translate([x-.307*k,y+.201*k]).clipExtent([[x-.425*k+ε,y+.12*k+ε],[x-.214*k-ε,y+.234*k-ε]]).stream(pointStream).point;hawaiiPoint=hawaii.translate([x-.205*k,y+.212*k]).clipExtent([[x-.214*k+ε,y+.166*k+ε],[x-.115*k-ε,y+.234*k-ε]]).stream(pointStream).point;return albersUsa;};return albersUsa.scale(1070);};var d3_geo_pathAreaSum,d3_geo_pathAreaPolygon,d3_geo_pathArea={point:d3_noop,lineStart:d3_noop,lineEnd:d3_noop,polygonStart:function(){d3_geo_pathAreaPolygon=0;d3_geo_pathArea.lineStart=d3_geo_pathAreaRingStart;},polygonEnd:function(){d3_geo_pathArea.lineStart=d3_geo_pathArea.lineEnd=d3_geo_pathArea.point=d3_noop;d3_geo_pathAreaSum+=abs(d3_geo_pathAreaPolygon/2);}};function d3_geo_pathAreaRingStart(){var x00,y00,x0,y0;d3_geo_pathArea.point=function(x,y){d3_geo_pathArea.point=nextPoint;x00=x0=x,y00=y0=y;};function nextPoint(x,y){d3_geo_pathAreaPolygon+=y0*x-x0*y;x0=x,y0=y;}
d3_geo_pathArea.lineEnd=function(){nextPoint(x00,y00);};}
var d3_geo_pathBoundsX0,d3_geo_pathBoundsY0,d3_geo_pathBoundsX1,d3_geo_pathBoundsY1;var d3_geo_pathBounds={point:d3_geo_pathBoundsPoint,lineStart:d3_noop,lineEnd:d3_noop,polygonStart:d3_noop,polygonEnd:d3_noop};function d3_geo_pathBoundsPoint(x,y){if(x<d3_geo_pathBoundsX0)d3_geo_pathBoundsX0=x;if(x>d3_geo_pathBoundsX1)d3_geo_pathBoundsX1=x;if(y<d3_geo_pathBoundsY0)d3_geo_pathBoundsY0=y;if(y>d3_geo_pathBoundsY1)d3_geo_pathBoundsY1=y;}
function d3_geo_pathBuffer(){var pointCircle=d3_geo_pathBufferCircle(4.5),buffer=[];var stream={point:point,lineStart:function(){stream.point=pointLineStart;},lineEnd:lineEnd,polygonStart:function(){stream.lineEnd=lineEndPolygon;},polygonEnd:function(){stream.lineEnd=lineEnd;stream.point=point;},pointRadius:function(_){pointCircle=d3_geo_pathBufferCircle(_);return stream;},result:function(){if(buffer.length){var result=buffer.join("");buffer=[];return result;}}};function point(x,y){buffer.push("M",x,",",y,pointCircle);}
function pointLineStart(x,y){buffer.push("M",x,",",y);stream.point=pointLine;}
function pointLine(x,y){buffer.push("L",x,",",y);}
function lineEnd(){stream.point=point;}
function lineEndPolygon(){buffer.push("Z");}
return stream;}
function d3_geo_pathBufferCircle(radius){return"m0,"+radius+"a"+radius+","+radius+" 0 1,1 0,"+-2*radius+"a"+radius+","+radius+" 0 1,1 0,"+2*radius+"z";}
var d3_geo_pathCentroid={point:d3_geo_pathCentroidPoint,lineStart:d3_geo_pathCentroidLineStart,lineEnd:d3_geo_pathCentroidLineEnd,polygonStart:function(){d3_geo_pathCentroid.lineStart=d3_geo_pathCentroidRingStart;},polygonEnd:function(){d3_geo_pathCentroid.point=d3_geo_pathCentroidPoint;d3_geo_pathCentroid.lineStart=d3_geo_pathCentroidLineStart;d3_geo_pathCentroid.lineEnd=d3_geo_pathCentroidLineEnd;}};function d3_geo_pathCentroidPoint(x,y){d3_geo_centroidX0+=x;d3_geo_centroidY0+=y;++d3_geo_centroidZ0;}
function d3_geo_pathCentroidLineStart(){var x0,y0;d3_geo_pathCentroid.point=function(x,y){d3_geo_pathCentroid.point=nextPoint;d3_geo_pathCentroidPoint(x0=x,y0=y);};function nextPoint(x,y){var dx=x-x0,dy=y-y0,z=Math.sqrt(dx*dx+dy*dy);d3_geo_centroidX1+=z*(x0+x)/2;d3_geo_centroidY1+=z*(y0+y)/2;d3_geo_centroidZ1+=z;d3_geo_pathCentroidPoint(x0=x,y0=y);}}
function d3_geo_pathCentroidLineEnd(){d3_geo_pathCentroid.point=d3_geo_pathCentroidPoint;}
function d3_geo_pathCentroidRingStart(){var x00,y00,x0,y0;d3_geo_pathCentroid.point=function(x,y){d3_geo_pathCentroid.point=nextPoint;d3_geo_pathCentroidPoint(x00=x0=x,y00=y0=y);};function nextPoint(x,y){var dx=x-x0,dy=y-y0,z=Math.sqrt(dx*dx+dy*dy);d3_geo_centroidX1+=z*(x0+x)/2;d3_geo_centroidY1+=z*(y0+y)/2;d3_geo_centroidZ1+=z;z=y0*x-x0*y;d3_geo_centroidX2+=z*(x0+x);d3_geo_centroidY2+=z*(y0+y);d3_geo_centroidZ2+=z*3;d3_geo_pathCentroidPoint(x0=x,y0=y);}
d3_geo_pathCentroid.lineEnd=function(){nextPoint(x00,y00);};}
function d3_geo_pathContext(context){var pointRadius=4.5;var stream={point:point,lineStart:function(){stream.point=pointLineStart;},lineEnd:lineEnd,polygonStart:function(){stream.lineEnd=lineEndPolygon;},polygonEnd:function(){stream.lineEnd=lineEnd;stream.point=point;},pointRadius:function(_){pointRadius=_;return stream;},result:d3_noop};function point(x,y){context.moveTo(x+pointRadius,y);context.arc(x,y,pointRadius,0,τ);}
function pointLineStart(x,y){context.moveTo(x,y);stream.point=pointLine;}
function pointLine(x,y){context.lineTo(x,y);}
function lineEnd(){stream.point=point;}
function lineEndPolygon(){context.closePath();}
return stream;}
function d3_geo_resample(project){var δ2=.5,cosMinDistance=Math.cos(30*d3_radians),maxDepth=16;function resample(stream){return(maxDepth?resampleRecursive:resampleNone)(stream);}
function resampleNone(stream){return d3_geo_transformPoint(stream,function(x,y){x=project(x,y);stream.point(x[0],x[1]);});}
function resampleRecursive(stream){var λ00,φ00,x00,y00,a00,b00,c00,λ0,x0,y0,a0,b0,c0;var resample={point:point,lineStart:lineStart,lineEnd:lineEnd,polygonStart:function(){stream.polygonStart();resample.lineStart=ringStart;},polygonEnd:function(){stream.polygonEnd();resample.lineStart=lineStart;}};function point(x,y){x=project(x,y);stream.point(x[0],x[1]);}
function lineStart(){x0=NaN;resample.point=linePoint;stream.lineStart();}
function linePoint(λ,φ){var c=d3_geo_cartesian([λ,φ]),p=project(λ,φ);resampleLineTo(x0,y0,λ0,a0,b0,c0,x0=p[0],y0=p[1],λ0=λ,a0=c[0],b0=c[1],c0=c[2],maxDepth,stream);stream.point(x0,y0);}
function lineEnd(){resample.point=point;stream.lineEnd();}
function ringStart(){lineStart();resample.point=ringPoint;resample.lineEnd=ringEnd;}
function ringPoint(λ,φ){linePoint(λ00=λ,φ00=φ),x00=x0,y00=y0,a00=a0,b00=b0,c00=c0;resample.point=linePoint;}
function ringEnd(){resampleLineTo(x0,y0,λ0,a0,b0,c0,x00,y00,λ00,a00,b00,c00,maxDepth,stream);resample.lineEnd=lineEnd;lineEnd();}
return resample;}
function resampleLineTo(x0,y0,λ0,a0,b0,c0,x1,y1,λ1,a1,b1,c1,depth,stream){var dx=x1-x0,dy=y1-y0,d2=dx*dx+dy*dy;if(d2>4*δ2&&depth--){var a=a0+a1,b=b0+b1,c=c0+c1,m=Math.sqrt(a*a+b*b+c*c),φ2=Math.asin(c/=m),λ2=abs(abs(c)-1)<ε||abs(λ0-λ1)<ε?(λ0+λ1)/2:Math.atan2(b,a),p=project(λ2,φ2),x2=p[0],y2=p[1],dx2=x2-x0,dy2=y2-y0,dz=dy*dx2-dx*dy2;if(dz*dz/d2>δ2||abs((dx*dx2+dy*dy2)/d2-.5)>.3||a0*a1+b0*b1+c0*c1<cosMinDistance){resampleLineTo(x0,y0,λ0,a0,b0,c0,x2,y2,λ2,a/=m,b/=m,c,depth,stream);stream.point(x2,y2);resampleLineTo(x2,y2,λ2,a,b,c,x1,y1,λ1,a1,b1,c1,depth,stream);}}}
resample.precision=function(_){if(!arguments.length)return Math.sqrt(δ2);maxDepth=(δ2=_*_)>0&&16;return resample;};return resample;}
d3.geo.path=function(){var pointRadius=4.5,projection,context,projectStream,contextStream,cacheStream;function path(object){if(object){if(typeof pointRadius==="function")contextStream.pointRadius(+pointRadius.apply(this,arguments));if(!cacheStream||!cacheStream.valid)cacheStream=projectStream(contextStream);d3.geo.stream(object,cacheStream);}
return contextStream.result();}
path.area=function(object){d3_geo_pathAreaSum=0;d3.geo.stream(object,projectStream(d3_geo_pathArea));return d3_geo_pathAreaSum;};path.centroid=function(object){d3_geo_centroidX0=d3_geo_centroidY0=d3_geo_centroidZ0=d3_geo_centroidX1=d3_geo_centroidY1=d3_geo_centroidZ1=d3_geo_centroidX2=d3_geo_centroidY2=d3_geo_centroidZ2=0;d3.geo.stream(object,projectStream(d3_geo_pathCentroid));return d3_geo_centroidZ2?[d3_geo_centroidX2/d3_geo_centroidZ2,d3_geo_centroidY2/d3_geo_centroidZ2]:d3_geo_centroidZ1?[d3_geo_centroidX1/d3_geo_centroidZ1,d3_geo_centroidY1/d3_geo_centroidZ1]:d3_geo_centroidZ0?[d3_geo_centroidX0/d3_geo_centroidZ0,d3_geo_centroidY0/d3_geo_centroidZ0]:[NaN,NaN];};path.bounds=function(object){d3_geo_pathBoundsX1=d3_geo_pathBoundsY1=-(d3_geo_pathBoundsX0=d3_geo_pathBoundsY0=Infinity);d3.geo.stream(object,projectStream(d3_geo_pathBounds));return[[d3_geo_pathBoundsX0,d3_geo_pathBoundsY0],[d3_geo_pathBoundsX1,d3_geo_pathBoundsY1]];};path.projection=function(_){if(!arguments.length)return projection;projectStream=(projection=_)?_.stream||d3_geo_pathProjectStream(_):d3_identity;return reset();};path.context=function(_){if(!arguments.length)return context;contextStream=(context=_)==null?new d3_geo_pathBuffer():new d3_geo_pathContext(_);if(typeof pointRadius!=="function")contextStream.pointRadius(pointRadius);return reset();};path.pointRadius=function(_){if(!arguments.length)return pointRadius;pointRadius=typeof _==="function"?_:(contextStream.pointRadius(+_),+_);return path;};function reset(){cacheStream=null;return path;}
return path.projection(d3.geo.albersUsa()).context(null);};function d3_geo_pathProjectStream(project){var resample=d3_geo_resample(function(x,y){return project([x*d3_degrees,y*d3_degrees]);});return function(stream){return d3_geo_projectionRadians(resample(stream));};}
d3.geo.transform=function(methods){return{stream:function(stream){var transform=new d3_geo_transform(stream);for(var k in methods)transform[k]=methods[k];return transform;}};};function d3_geo_transform(stream){this.stream=stream;}
d3_geo_transform.prototype={point:function(x,y){this.stream.point(x,y);},sphere:function(){this.stream.sphere();},lineStart:function(){this.stream.lineStart();},lineEnd:function(){this.stream.lineEnd();},polygonStart:function(){this.stream.polygonStart();},polygonEnd:function(){this.stream.polygonEnd();}};function d3_geo_transformPoint(stream,point){return{point:point,sphere:function(){stream.sphere();},lineStart:function(){stream.lineStart();},lineEnd:function(){stream.lineEnd();},polygonStart:function(){stream.polygonStart();},polygonEnd:function(){stream.polygonEnd();}};}
d3.geo.projection=d3_geo_projection;d3.geo.projectionMutator=d3_geo_projectionMutator;function d3_geo_projection(project){return d3_geo_projectionMutator(function(){return project;})();}
function d3_geo_projectionMutator(projectAt){var project,rotate,projectRotate,projectResample=d3_geo_resample(function(x,y){x=project(x,y);return[x[0]*k+δx,δy-x[1]*k];}),k=150,x=480,y=250,λ=0,φ=0,δλ=0,δφ=0,δγ=0,δx,δy,preclip=d3_geo_clipAntimeridian,postclip=d3_identity,clipAngle=null,clipExtent=null,stream;function projection(point){point=projectRotate(point[0]*d3_radians,point[1]*d3_radians);return[point[0]*k+δx,δy-point[1]*k];}
function invert(point){point=projectRotate.invert((point[0]-δx)/k,(δy-point[1])/k);return point&&[point[0]*d3_degrees,point[1]*d3_degrees];}
projection.stream=function(output){if(stream)stream.valid=false;stream=d3_geo_projectionRadians(preclip(rotate,projectResample(postclip(output))));stream.valid=true;return stream;};projection.clipAngle=function(_){if(!arguments.length)return clipAngle;preclip=_==null?(clipAngle=_,d3_geo_clipAntimeridian):d3_geo_clipCircle((clipAngle=+_)*d3_radians);return invalidate();};projection.clipExtent=function(_){if(!arguments.length)return clipExtent;clipExtent=_;postclip=_?d3_geo_clipExtent(_[0][0],_[0][1],_[1][0],_[1][1]):d3_identity;return invalidate();};projection.scale=function(_){if(!arguments.length)return k;k=+_;return reset();};projection.translate=function(_){if(!arguments.length)return[x,y];x=+_[0];y=+_[1];return reset();};projection.center=function(_){if(!arguments.length)return[λ*d3_degrees,φ*d3_degrees];λ=_[0]%360*d3_radians;φ=_[1]%360*d3_radians;return reset();};projection.rotate=function(_){if(!arguments.length)return[δλ*d3_degrees,δφ*d3_degrees,δγ*d3_degrees];δλ=_[0]%360*d3_radians;δφ=_[1]%360*d3_radians;δγ=_.length>2?_[2]%360*d3_radians:0;return reset();};d3.rebind(projection,projectResample,"precision");function reset(){projectRotate=d3_geo_compose(rotate=d3_geo_rotation(δλ,δφ,δγ),project);var center=project(λ,φ);δx=x-center[0]*k;δy=y+center[1]*k;return invalidate();}
function invalidate(){if(stream)stream.valid=false,stream=null;return projection;}
return function(){project=projectAt.apply(this,arguments);projection.invert=project.invert&&invert;return reset();};}
function d3_geo_projectionRadians(stream){return d3_geo_transformPoint(stream,function(x,y){stream.point(x*d3_radians,y*d3_radians);});}
function d3_geo_equirectangular(λ,φ){return[λ,φ];}
(d3.geo.equirectangular=function(){return d3_geo_projection(d3_geo_equirectangular);}).raw=d3_geo_equirectangular.invert=d3_geo_equirectangular;d3.geo.rotation=function(rotate){rotate=d3_geo_rotation(rotate[0]%360*d3_radians,rotate[1]*d3_radians,rotate.length>2?rotate[2]*d3_radians:0);function forward(coordinates){coordinates=rotate(coordinates[0]*d3_radians,coordinates[1]*d3_radians);return coordinates[0]*=d3_degrees,coordinates[1]*=d3_degrees,coordinates;}
forward.invert=function(coordinates){coordinates=rotate.invert(coordinates[0]*d3_radians,coordinates[1]*d3_radians);return coordinates[0]*=d3_degrees,coordinates[1]*=d3_degrees,coordinates;};return forward;};function d3_geo_identityRotation(λ,φ){return[λ>π?λ-τ:λ<-π?λ+τ:λ,φ];}
d3_geo_identityRotation.invert=d3_geo_equirectangular;function d3_geo_rotation(δλ,δφ,δγ){return δλ?δφ||δγ?d3_geo_compose(d3_geo_rotationλ(δλ),d3_geo_rotationφγ(δφ,δγ)):d3_geo_rotationλ(δλ):δφ||δγ?d3_geo_rotationφγ(δφ,δγ):d3_geo_identityRotation;}
function d3_geo_forwardRotationλ(δλ){return function(λ,φ){return λ+=δλ,[λ>π?λ-τ:λ<-π?λ+τ:λ,φ];};}
function d3_geo_rotationλ(δλ){var rotation=d3_geo_forwardRotationλ(δλ);rotation.invert=d3_geo_forwardRotationλ(-δλ);return rotation;}
function d3_geo_rotationφγ(δφ,δγ){var cosδφ=Math.cos(δφ),sinδφ=Math.sin(δφ),cosδγ=Math.cos(δγ),sinδγ=Math.sin(δγ);function rotation(λ,φ){var cosφ=Math.cos(φ),x=Math.cos(λ)*cosφ,y=Math.sin(λ)*cosφ,z=Math.sin(φ),k=z*cosδφ+x*sinδφ;return[Math.atan2(y*cosδγ-k*sinδγ,x*cosδφ-z*sinδφ),d3_asin(k*cosδγ+y*sinδγ)];}
rotation.invert=function(λ,φ){var cosφ=Math.cos(φ),x=Math.cos(λ)*cosφ,y=Math.sin(λ)*cosφ,z=Math.sin(φ),k=z*cosδγ-y*sinδγ;return[Math.atan2(y*cosδγ+z*sinδγ,x*cosδφ+k*sinδφ),d3_asin(k*cosδφ-x*sinδφ)];};return rotation;}
d3.geo.circle=function(){var origin=[0,0],angle,precision=6,interpolate;function circle(){var center=typeof origin==="function"?origin.apply(this,arguments):origin,rotate=d3_geo_rotation(-center[0]*d3_radians,-center[1]*d3_radians,0).invert,ring=[];interpolate(null,null,1,{point:function(x,y){ring.push(x=rotate(x,y));x[0]*=d3_degrees,x[1]*=d3_degrees;}});return{type:"Polygon",coordinates:[ring]};}
circle.origin=function(x){if(!arguments.length)return origin;origin=x;return circle;};circle.angle=function(x){if(!arguments.length)return angle;interpolate=d3_geo_circleInterpolate((angle=+x)*d3_radians,precision*d3_radians);return circle;};circle.precision=function(_){if(!arguments.length)return precision;interpolate=d3_geo_circleInterpolate(angle*d3_radians,(precision=+_)*d3_radians);return circle;};return circle.angle(90);};function d3_geo_circleInterpolate(radius,precision){var cr=Math.cos(radius),sr=Math.sin(radius);return function(from,to,direction,listener){var step=direction*precision;if(from!=null){from=d3_geo_circleAngle(cr,from);to=d3_geo_circleAngle(cr,to);if(direction>0?from<to:from>to)from+=direction*τ;}else{from=radius+direction*τ;to=radius-.5*step;}
for(var point,t=from;direction>0?t>to:t<to;t-=step){listener.point((point=d3_geo_spherical([cr,-sr*Math.cos(t),-sr*Math.sin(t)]))[0],point[1]);}};}
function d3_geo_circleAngle(cr,point){var a=d3_geo_cartesian(point);a[0]-=cr;d3_geo_cartesianNormalize(a);var angle=d3_acos(-a[1]);return((-a[2]<0?-angle:angle)+2*Math.PI-ε)%(2*Math.PI);}
d3.geo.distance=function(a,b){var Δλ=(b[0]-a[0])*d3_radians,φ0=a[1]*d3_radians,φ1=b[1]*d3_radians,sinΔλ=Math.sin(Δλ),cosΔλ=Math.cos(Δλ),sinφ0=Math.sin(φ0),cosφ0=Math.cos(φ0),sinφ1=Math.sin(φ1),cosφ1=Math.cos(φ1),t;return Math.atan2(Math.sqrt((t=cosφ1*sinΔλ)*t+(t=cosφ0*sinφ1-sinφ0*cosφ1*cosΔλ)*t),sinφ0*sinφ1+cosφ0*cosφ1*cosΔλ);};d3.geo.graticule=function(){var x1,x0,X1,X0,y1,y0,Y1,Y0,dx=10,dy=dx,DX=90,DY=360,x,y,X,Y,precision=2.5;function graticule(){return{type:"MultiLineString",coordinates:lines()};}
function lines(){return d3.range(Math.ceil(X0/DX)*DX,X1,DX).map(X).concat(d3.range(Math.ceil(Y0/DY)*DY,Y1,DY).map(Y)).concat(d3.range(Math.ceil(x0/dx)*dx,x1,dx).filter(function(x){return abs(x%DX)>ε;}).map(x)).concat(d3.range(Math.ceil(y0/dy)*dy,y1,dy).filter(function(y){return abs(y%DY)>ε;}).map(y));}
graticule.lines=function(){return lines().map(function(coordinates){return{type:"LineString",coordinates:coordinates};});};graticule.outline=function(){return{type:"Polygon",coordinates:[X(X0).concat(Y(Y1).slice(1),X(X1).reverse().slice(1),Y(Y0).reverse().slice(1))]};};graticule.extent=function(_){if(!arguments.length)return graticule.minorExtent();return graticule.majorExtent(_).minorExtent(_);};graticule.majorExtent=function(_){if(!arguments.length)return[[X0,Y0],[X1,Y1]];X0=+_[0][0],X1=+_[1][0];Y0=+_[0][1],Y1=+_[1][1];if(X0>X1)_=X0,X0=X1,X1=_;if(Y0>Y1)_=Y0,Y0=Y1,Y1=_;return graticule.precision(precision);};graticule.minorExtent=function(_){if(!arguments.length)return[[x0,y0],[x1,y1]];x0=+_[0][0],x1=+_[1][0];y0=+_[0][1],y1=+_[1][1];if(x0>x1)_=x0,x0=x1,x1=_;if(y0>y1)_=y0,y0=y1,y1=_;return graticule.precision(precision);};graticule.step=function(_){if(!arguments.length)return graticule.minorStep();return graticule.majorStep(_).minorStep(_);};graticule.majorStep=function(_){if(!arguments.length)return[DX,DY];DX=+_[0],DY=+_[1];return graticule;};graticule.minorStep=function(_){if(!arguments.length)return[dx,dy];dx=+_[0],dy=+_[1];return graticule;};graticule.precision=function(_){if(!arguments.length)return precision;precision=+_;x=d3_geo_graticuleX(y0,y1,90);y=d3_geo_graticuleY(x0,x1,precision);X=d3_geo_graticuleX(Y0,Y1,90);Y=d3_geo_graticuleY(X0,X1,precision);return graticule;};return graticule.majorExtent([[-180,-90+ε],[180,90-ε]]).minorExtent([[-180,-80-ε],[180,80+ε]]);};function d3_geo_graticuleX(y0,y1,dy){var y=d3.range(y0,y1-ε,dy).concat(y1);return function(x){return y.map(function(y){return[x,y];});};}
function d3_geo_graticuleY(x0,x1,dx){var x=d3.range(x0,x1-ε,dx).concat(x1);return function(y){return x.map(function(x){return[x,y];});};}
function d3_source(d){return d.source;}
function d3_target(d){return d.target;}
d3.geo.greatArc=function(){var source=d3_source,source_,target=d3_target,target_;function greatArc(){return{type:"LineString",coordinates:[source_||source.apply(this,arguments),target_||target.apply(this,arguments)]};}
greatArc.distance=function(){return d3.geo.distance(source_||source.apply(this,arguments),target_||target.apply(this,arguments));};greatArc.source=function(_){if(!arguments.length)return source;source=_,source_=typeof _==="function"?null:_;return greatArc;};greatArc.target=function(_){if(!arguments.length)return target;target=_,target_=typeof _==="function"?null:_;return greatArc;};greatArc.precision=function(){return arguments.length?greatArc:0;};return greatArc;};d3.geo.interpolate=function(source,target){return d3_geo_interpolate(source[0]*d3_radians,source[1]*d3_radians,target[0]*d3_radians,target[1]*d3_radians);};function d3_geo_interpolate(x0,y0,x1,y1){var cy0=Math.cos(y0),sy0=Math.sin(y0),cy1=Math.cos(y1),sy1=Math.sin(y1),kx0=cy0*Math.cos(x0),ky0=cy0*Math.sin(x0),kx1=cy1*Math.cos(x1),ky1=cy1*Math.sin(x1),d=2*Math.asin(Math.sqrt(d3_haversin(y1-y0)+cy0*cy1*d3_haversin(x1-x0))),k=1/Math.sin(d);var interpolate=d?function(t){var B=Math.sin(t*=d)*k,A=Math.sin(d-t)*k,x=A*kx0+B*kx1,y=A*ky0+B*ky1,z=A*sy0+B*sy1;return[Math.atan2(y,x)*d3_degrees,Math.atan2(z,Math.sqrt(x*x+y*y))*d3_degrees];}:function(){return[x0*d3_degrees,y0*d3_degrees];};interpolate.distance=d;return interpolate;}
d3.geo.length=function(object){d3_geo_lengthSum=0;d3.geo.stream(object,d3_geo_length);return d3_geo_lengthSum;};var d3_geo_lengthSum;var d3_geo_length={sphere:d3_noop,point:d3_noop,lineStart:d3_geo_lengthLineStart,lineEnd:d3_noop,polygonStart:d3_noop,polygonEnd:d3_noop};function d3_geo_lengthLineStart(){var λ0,sinφ0,cosφ0;d3_geo_length.point=function(λ,φ){λ0=λ*d3_radians,sinφ0=Math.sin(φ*=d3_radians),cosφ0=Math.cos(φ);d3_geo_length.point=nextPoint;};d3_geo_length.lineEnd=function(){d3_geo_length.point=d3_geo_length.lineEnd=d3_noop;};function nextPoint(λ,φ){var sinφ=Math.sin(φ*=d3_radians),cosφ=Math.cos(φ),t=abs((λ*=d3_radians)-λ0),cosΔλ=Math.cos(t);d3_geo_lengthSum+=Math.atan2(Math.sqrt((t=cosφ*Math.sin(t))*t+(t=cosφ0*sinφ-sinφ0*cosφ*cosΔλ)*t),sinφ0*sinφ+cosφ0*cosφ*cosΔλ);λ0=λ,sinφ0=sinφ,cosφ0=cosφ;}}
function d3_geo_azimuthal(scale,angle){function azimuthal(λ,φ){var cosλ=Math.cos(λ),cosφ=Math.cos(φ),k=scale(cosλ*cosφ);return[k*cosφ*Math.sin(λ),k*Math.sin(φ)];}
azimuthal.invert=function(x,y){var ρ=Math.sqrt(x*x+y*y),c=angle(ρ),sinc=Math.sin(c),cosc=Math.cos(c);return[Math.atan2(x*sinc,ρ*cosc),Math.asin(ρ&&y*sinc/ρ)];};return azimuthal;}
var d3_geo_azimuthalEqualArea=d3_geo_azimuthal(function(cosλcosφ){return Math.sqrt(2/(1+cosλcosφ));},function(ρ){return 2*Math.asin(ρ/2);});(d3.geo.azimuthalEqualArea=function(){return d3_geo_projection(d3_geo_azimuthalEqualArea);}).raw=d3_geo_azimuthalEqualArea;var d3_geo_azimuthalEquidistant=d3_geo_azimuthal(function(cosλcosφ){var c=Math.acos(cosλcosφ);return c&&c/Math.sin(c);},d3_identity);(d3.geo.azimuthalEquidistant=function(){return d3_geo_projection(d3_geo_azimuthalEquidistant);}).raw=d3_geo_azimuthalEquidistant;function d3_geo_conicConformal(φ0,φ1){var cosφ0=Math.cos(φ0),t=function(φ){return Math.tan(π/4+φ/2);},n=φ0===φ1?Math.sin(φ0):Math.log(cosφ0/Math.cos(φ1))/Math.log(t(φ1)/t(φ0)),F=cosφ0*Math.pow(t(φ0),n)/n;if(!n)return d3_geo_mercator;function forward(λ,φ){if(F>0){if(φ<-halfπ+ε)φ=-halfπ+ε;}else{if(φ>halfπ-ε)φ=halfπ-ε;}
var ρ=F/Math.pow(t(φ),n);return[ρ*Math.sin(n*λ),F-ρ*Math.cos(n*λ)];}
forward.invert=function(x,y){var ρ0_y=F-y,ρ=d3_sgn(n)*Math.sqrt(x*x+ρ0_y*ρ0_y);return[Math.atan2(x,ρ0_y)/n,2*Math.atan(Math.pow(F/ρ,1/n))-halfπ];};return forward;}
(d3.geo.conicConformal=function(){return d3_geo_conic(d3_geo_conicConformal);}).raw=d3_geo_conicConformal;function d3_geo_conicEquidistant(φ0,φ1){var cosφ0=Math.cos(φ0),n=φ0===φ1?Math.sin(φ0):(cosφ0-Math.cos(φ1))/(φ1-φ0),G=cosφ0/n+φ0;if(abs(n)<ε)return d3_geo_equirectangular;function forward(λ,φ){var ρ=G-φ;return[ρ*Math.sin(n*λ),G-ρ*Math.cos(n*λ)];}
forward.invert=function(x,y){var ρ0_y=G-y;return[Math.atan2(x,ρ0_y)/n,G-d3_sgn(n)*Math.sqrt(x*x+ρ0_y*ρ0_y)];};return forward;}
(d3.geo.conicEquidistant=function(){return d3_geo_conic(d3_geo_conicEquidistant);}).raw=d3_geo_conicEquidistant;var d3_geo_gnomonic=d3_geo_azimuthal(function(cosλcosφ){return 1/cosλcosφ;},Math.atan);(d3.geo.gnomonic=function(){return d3_geo_projection(d3_geo_gnomonic);}).raw=d3_geo_gnomonic;function d3_geo_mercator(λ,φ){return[λ,Math.log(Math.tan(π/4+φ/2))];}
d3_geo_mercator.invert=function(x,y){return[x,2*Math.atan(Math.exp(y))-halfπ];};function d3_geo_mercatorProjection(project){var m=d3_geo_projection(project),scale=m.scale,translate=m.translate,clipExtent=m.clipExtent,clipAuto;m.scale=function(){var v=scale.apply(m,arguments);return v===m?clipAuto?m.clipExtent(null):m:v;};m.translate=function(){var v=translate.apply(m,arguments);return v===m?clipAuto?m.clipExtent(null):m:v;};m.clipExtent=function(_){var v=clipExtent.apply(m,arguments);if(v===m){if(clipAuto=_==null){var k=π*scale(),t=translate();clipExtent([[t[0]-k,t[1]-k],[t[0]+k,t[1]+k]]);}}else if(clipAuto){v=null;}
return v;};return m.clipExtent(null);}
(d3.geo.mercator=function(){return d3_geo_mercatorProjection(d3_geo_mercator);}).raw=d3_geo_mercator;var d3_geo_orthographic=d3_geo_azimuthal(function(){return 1;},Math.asin);(d3.geo.orthographic=function(){return d3_geo_projection(d3_geo_orthographic);}).raw=d3_geo_orthographic;var d3_geo_stereographic=d3_geo_azimuthal(function(cosλcosφ){return 1/(1+cosλcosφ);},function(ρ){return 2*Math.atan(ρ);});(d3.geo.stereographic=function(){return d3_geo_projection(d3_geo_stereographic);}).raw=d3_geo_stereographic;function d3_geo_transverseMercator(λ,φ){return[Math.log(Math.tan(π/4+φ/2)),-λ];}
d3_geo_transverseMercator.invert=function(x,y){return[-y,2*Math.atan(Math.exp(x))-halfπ];};(d3.geo.transverseMercator=function(){var projection=d3_geo_mercatorProjection(d3_geo_transverseMercator),center=projection.center,rotate=projection.rotate;projection.center=function(_){return _?center([-_[1],_[0]]):(_=center(),[_[1],-_[0]]);};projection.rotate=function(_){return _?rotate([_[0],_[1],_.length>2?_[2]+90:90]):(_=rotate(),[_[0],_[1],_[2]-90]);};return rotate([0,0,90]);}).raw=d3_geo_transverseMercator;d3.geom={};function d3_geom_pointX(d){return d[0];}
function d3_geom_pointY(d){return d[1];}
d3.geom.hull=function(vertices){var x=d3_geom_pointX,y=d3_geom_pointY;if(arguments.length)return hull(vertices);function hull(data){if(data.length<3)return[];var fx=d3_functor(x),fy=d3_functor(y),i,n=data.length,points=[],flippedPoints=[];for(i=0;i<n;i++){points.push([+fx.call(this,data[i],i),+fy.call(this,data[i],i),i]);}
points.sort(d3_geom_hullOrder);for(i=0;i<n;i++)flippedPoints.push([points[i][0],-points[i][1]]);var upper=d3_geom_hullUpper(points),lower=d3_geom_hullUpper(flippedPoints);var skipLeft=lower[0]===upper[0],skipRight=lower[lower.length-1]===upper[upper.length-1],polygon=[];for(i=upper.length-1;i>=0;--i)polygon.push(data[points[upper[i]][2]]);for(i=+skipLeft;i<lower.length-skipRight;++i)polygon.push(data[points[lower[i]][2]]);return polygon;}
hull.x=function(_){return arguments.length?(x=_,hull):x;};hull.y=function(_){return arguments.length?(y=_,hull):y;};return hull;};function d3_geom_hullUpper(points){var n=points.length,hull=[0,1],hs=2;for(var i=2;i<n;i++){while(hs>1&&d3_cross2d(points[hull[hs-2]],points[hull[hs-1]],points[i])<=0)--hs;hull[hs++]=i;}
return hull.slice(0,hs);}
function d3_geom_hullOrder(a,b){return a[0]-b[0]||a[1]-b[1];}
d3.geom.polygon=function(coordinates){d3_subclass(coordinates,d3_geom_polygonPrototype);return coordinates;};var d3_geom_polygonPrototype=d3.geom.polygon.prototype=[];d3_geom_polygonPrototype.area=function(){var i=-1,n=this.length,a,b=this[n-1],area=0;while(++i<n){a=b;b=this[i];area+=a[1]*b[0]-a[0]*b[1];}
return area*.5;};d3_geom_polygonPrototype.centroid=function(k){var i=-1,n=this.length,x=0,y=0,a,b=this[n-1],c;if(!arguments.length)k=-1/(6*this.area());while(++i<n){a=b;b=this[i];c=a[0]*b[1]-b[0]*a[1];x+=(a[0]+b[0])*c;y+=(a[1]+b[1])*c;}
return[x*k,y*k];};d3_geom_polygonPrototype.clip=function(subject){var input,closed=d3_geom_polygonClosed(subject),i=-1,n=this.length-d3_geom_polygonClosed(this),j,m,a=this[n-1],b,c,d;while(++i<n){input=subject.slice();subject.length=0;b=this[i];c=input[(m=input.length-closed)-1];j=-1;while(++j<m){d=input[j];if(d3_geom_polygonInside(d,a,b)){if(!d3_geom_polygonInside(c,a,b)){subject.push(d3_geom_polygonIntersect(c,d,a,b));}
subject.push(d);}else if(d3_geom_polygonInside(c,a,b)){subject.push(d3_geom_polygonIntersect(c,d,a,b));}
c=d;}
if(closed)subject.push(subject[0]);a=b;}
return subject;};function d3_geom_polygonInside(p,a,b){return(b[0]-a[0])*(p[1]-a[1])<(b[1]-a[1])*(p[0]-a[0]);}
function d3_geom_polygonIntersect(c,d,a,b){var x1=c[0],x3=a[0],x21=d[0]-x1,x43=b[0]-x3,y1=c[1],y3=a[1],y21=d[1]-y1,y43=b[1]-y3,ua=(x43*(y1-y3)-y43*(x1-x3))/(y43*x21-x43*y21);return[x1+ua*x21,y1+ua*y21];}
function d3_geom_polygonClosed(coordinates){var a=coordinates[0],b=coordinates[coordinates.length-1];return!(a[0]-b[0]||a[1]-b[1]);}
var d3_geom_voronoiEdges,d3_geom_voronoiCells,d3_geom_voronoiBeaches,d3_geom_voronoiBeachPool=[],d3_geom_voronoiFirstCircle,d3_geom_voronoiCircles,d3_geom_voronoiCirclePool=[];function d3_geom_voronoiBeach(){d3_geom_voronoiRedBlackNode(this);this.edge=this.site=this.circle=null;}
function d3_geom_voronoiCreateBeach(site){var beach=d3_geom_voronoiBeachPool.pop()||new d3_geom_voronoiBeach();beach.site=site;return beach;}
function d3_geom_voronoiDetachBeach(beach){d3_geom_voronoiDetachCircle(beach);d3_geom_voronoiBeaches.remove(beach);d3_geom_voronoiBeachPool.push(beach);d3_geom_voronoiRedBlackNode(beach);}
function d3_geom_voronoiRemoveBeach(beach){var circle=beach.circle,x=circle.x,y=circle.cy,vertex={x:x,y:y},previous=beach.P,next=beach.N,disappearing=[beach];d3_geom_voronoiDetachBeach(beach);var lArc=previous;while(lArc.circle&&abs(x-lArc.circle.x)<ε&&abs(y-lArc.circle.cy)<ε){previous=lArc.P;disappearing.unshift(lArc);d3_geom_voronoiDetachBeach(lArc);lArc=previous;}
disappearing.unshift(lArc);d3_geom_voronoiDetachCircle(lArc);var rArc=next;while(rArc.circle&&abs(x-rArc.circle.x)<ε&&abs(y-rArc.circle.cy)<ε){next=rArc.N;disappearing.push(rArc);d3_geom_voronoiDetachBeach(rArc);rArc=next;}
disappearing.push(rArc);d3_geom_voronoiDetachCircle(rArc);var nArcs=disappearing.length,iArc;for(iArc=1;iArc<nArcs;++iArc){rArc=disappearing[iArc];lArc=disappearing[iArc-1];d3_geom_voronoiSetEdgeEnd(rArc.edge,lArc.site,rArc.site,vertex);}
lArc=disappearing[0];rArc=disappearing[nArcs-1];rArc.edge=d3_geom_voronoiCreateEdge(lArc.site,rArc.site,null,vertex);d3_geom_voronoiAttachCircle(lArc);d3_geom_voronoiAttachCircle(rArc);}
function d3_geom_voronoiAddBeach(site){var x=site.x,directrix=site.y,lArc,rArc,dxl,dxr,node=d3_geom_voronoiBeaches._;while(node){dxl=d3_geom_voronoiLeftBreakPoint(node,directrix)-x;if(dxl>ε)node=node.L;else{dxr=x-d3_geom_voronoiRightBreakPoint(node,directrix);if(dxr>ε){if(!node.R){lArc=node;break;}
node=node.R;}else{if(dxl>-ε){lArc=node.P;rArc=node;}else if(dxr>-ε){lArc=node;rArc=node.N;}else{lArc=rArc=node;}
break;}}}
var newArc=d3_geom_voronoiCreateBeach(site);d3_geom_voronoiBeaches.insert(lArc,newArc);if(!lArc&&!rArc)return;if(lArc===rArc){d3_geom_voronoiDetachCircle(lArc);rArc=d3_geom_voronoiCreateBeach(lArc.site);d3_geom_voronoiBeaches.insert(newArc,rArc);newArc.edge=rArc.edge=d3_geom_voronoiCreateEdge(lArc.site,newArc.site);d3_geom_voronoiAttachCircle(lArc);d3_geom_voronoiAttachCircle(rArc);return;}
if(!rArc){newArc.edge=d3_geom_voronoiCreateEdge(lArc.site,newArc.site);return;}
d3_geom_voronoiDetachCircle(lArc);d3_geom_voronoiDetachCircle(rArc);var lSite=lArc.site,ax=lSite.x,ay=lSite.y,bx=site.x-ax,by=site.y-ay,rSite=rArc.site,cx=rSite.x-ax,cy=rSite.y-ay,d=2*(bx*cy-by*cx),hb=bx*bx+by*by,hc=cx*cx+cy*cy,vertex={x:(cy*hb-by*hc)/d+ax,y:(bx*hc-cx*hb)/d+ay};d3_geom_voronoiSetEdgeEnd(rArc.edge,lSite,rSite,vertex);newArc.edge=d3_geom_voronoiCreateEdge(lSite,site,null,vertex);rArc.edge=d3_geom_voronoiCreateEdge(site,rSite,null,vertex);d3_geom_voronoiAttachCircle(lArc);d3_geom_voronoiAttachCircle(rArc);}
function d3_geom_voronoiLeftBreakPoint(arc,directrix){var site=arc.site,rfocx=site.x,rfocy=site.y,pby2=rfocy-directrix;if(!pby2)return rfocx;var lArc=arc.P;if(!lArc)return-Infinity;site=lArc.site;var lfocx=site.x,lfocy=site.y,plby2=lfocy-directrix;if(!plby2)return lfocx;var hl=lfocx-rfocx,aby2=1/pby2-1/plby2,b=hl/plby2;if(aby2)return(-b+Math.sqrt(b*b-2*aby2*(hl*hl/(-2*plby2)-lfocy+plby2/2+rfocy-pby2/2)))/aby2+rfocx;return(rfocx+lfocx)/2;}
function d3_geom_voronoiRightBreakPoint(arc,directrix){var rArc=arc.N;if(rArc)return d3_geom_voronoiLeftBreakPoint(rArc,directrix);var site=arc.site;return site.y===directrix?site.x:Infinity;}
function d3_geom_voronoiCell(site){this.site=site;this.edges=[];}
d3_geom_voronoiCell.prototype.prepare=function(){var halfEdges=this.edges,iHalfEdge=halfEdges.length,edge;while(iHalfEdge--){edge=halfEdges[iHalfEdge].edge;if(!edge.b||!edge.a)halfEdges.splice(iHalfEdge,1);}
halfEdges.sort(d3_geom_voronoiHalfEdgeOrder);return halfEdges.length;};function d3_geom_voronoiCloseCells(extent){var x0=extent[0][0],x1=extent[1][0],y0=extent[0][1],y1=extent[1][1],x2,y2,x3,y3,cells=d3_geom_voronoiCells,iCell=cells.length,cell,iHalfEdge,halfEdges,nHalfEdges,start,end;while(iCell--){cell=cells[iCell];if(!cell||!cell.prepare())continue;halfEdges=cell.edges;nHalfEdges=halfEdges.length;iHalfEdge=0;while(iHalfEdge<nHalfEdges){end=halfEdges[iHalfEdge].end(),x3=end.x,y3=end.y;start=halfEdges[++iHalfEdge%nHalfEdges].start(),x2=start.x,y2=start.y;if(abs(x3-x2)>ε||abs(y3-y2)>ε){halfEdges.splice(iHalfEdge,0,new d3_geom_voronoiHalfEdge(d3_geom_voronoiCreateBorderEdge(cell.site,end,abs(x3-x0)<ε&&y1-y3>ε?{x:x0,y:abs(x2-x0)<ε?y2:y1}:abs(y3-y1)<ε&&x1-x3>ε?{x:abs(y2-y1)<ε?x2:x1,y:y1}:abs(x3-x1)<ε&&y3-y0>ε?{x:x1,y:abs(x2-x1)<ε?y2:y0}:abs(y3-y0)<ε&&x3-x0>ε?{x:abs(y2-y0)<ε?x2:x0,y:y0}:null),cell.site,null));++nHalfEdges;}}}}
function d3_geom_voronoiHalfEdgeOrder(a,b){return b.angle-a.angle;}
function d3_geom_voronoiCircle(){d3_geom_voronoiRedBlackNode(this);this.x=this.y=this.arc=this.site=this.cy=null;}
function d3_geom_voronoiAttachCircle(arc){var lArc=arc.P,rArc=arc.N;if(!lArc||!rArc)return;var lSite=lArc.site,cSite=arc.site,rSite=rArc.site;if(lSite===rSite)return;var bx=cSite.x,by=cSite.y,ax=lSite.x-bx,ay=lSite.y-by,cx=rSite.x-bx,cy=rSite.y-by;var d=2*(ax*cy-ay*cx);if(d>=-ε2)return;var ha=ax*ax+ay*ay,hc=cx*cx+cy*cy,x=(cy*ha-ay*hc)/d,y=(ax*hc-cx*ha)/d,cy=y+by;var circle=d3_geom_voronoiCirclePool.pop()||new d3_geom_voronoiCircle();circle.arc=arc;circle.site=cSite;circle.x=x+bx;circle.y=cy+Math.sqrt(x*x+y*y);circle.cy=cy;arc.circle=circle;var before=null,node=d3_geom_voronoiCircles._;while(node){if(circle.y<node.y||circle.y===node.y&&circle.x<=node.x){if(node.L)node=node.L;else{before=node.P;break;}}else{if(node.R)node=node.R;else{before=node;break;}}}
d3_geom_voronoiCircles.insert(before,circle);if(!before)d3_geom_voronoiFirstCircle=circle;}
function d3_geom_voronoiDetachCircle(arc){var circle=arc.circle;if(circle){if(!circle.P)d3_geom_voronoiFirstCircle=circle.N;d3_geom_voronoiCircles.remove(circle);d3_geom_voronoiCirclePool.push(circle);d3_geom_voronoiRedBlackNode(circle);arc.circle=null;}}
function d3_geom_voronoiClipEdges(extent){var edges=d3_geom_voronoiEdges,clip=d3_geom_clipLine(extent[0][0],extent[0][1],extent[1][0],extent[1][1]),i=edges.length,e;while(i--){e=edges[i];if(!d3_geom_voronoiConnectEdge(e,extent)||!clip(e)||abs(e.a.x-e.b.x)<ε&&abs(e.a.y-e.b.y)<ε){e.a=e.b=null;edges.splice(i,1);}}}
function d3_geom_voronoiConnectEdge(edge,extent){var vb=edge.b;if(vb)return true;var va=edge.a,x0=extent[0][0],x1=extent[1][0],y0=extent[0][1],y1=extent[1][1],lSite=edge.l,rSite=edge.r,lx=lSite.x,ly=lSite.y,rx=rSite.x,ry=rSite.y,fx=(lx+rx)/2,fy=(ly+ry)/2,fm,fb;if(ry===ly){if(fx<x0||fx>=x1)return;if(lx>rx){if(!va)va={x:fx,y:y0};else if(va.y>=y1)return;vb={x:fx,y:y1};}else{if(!va)va={x:fx,y:y1};else if(va.y<y0)return;vb={x:fx,y:y0};}}else{fm=(lx-rx)/(ry-ly);fb=fy-fm*fx;if(fm<-1||fm>1){if(lx>rx){if(!va)va={x:(y0-fb)/fm,y:y0};else if(va.y>=y1)return;vb={x:(y1-fb)/fm,y:y1};}else{if(!va)va={x:(y1-fb)/fm,y:y1};else if(va.y<y0)return;vb={x:(y0-fb)/fm,y:y0};}}else{if(ly<ry){if(!va)va={x:x0,y:fm*x0+fb};else if(va.x>=x1)return;vb={x:x1,y:fm*x1+fb};}else{if(!va)va={x:x1,y:fm*x1+fb};else if(va.x<x0)return;vb={x:x0,y:fm*x0+fb};}}}
edge.a=va;edge.b=vb;return true;}
function d3_geom_voronoiEdge(lSite,rSite){this.l=lSite;this.r=rSite;this.a=this.b=null;}
function d3_geom_voronoiCreateEdge(lSite,rSite,va,vb){var edge=new d3_geom_voronoiEdge(lSite,rSite);d3_geom_voronoiEdges.push(edge);if(va)d3_geom_voronoiSetEdgeEnd(edge,lSite,rSite,va);if(vb)d3_geom_voronoiSetEdgeEnd(edge,rSite,lSite,vb);d3_geom_voronoiCells[lSite.i].edges.push(new d3_geom_voronoiHalfEdge(edge,lSite,rSite));d3_geom_voronoiCells[rSite.i].edges.push(new d3_geom_voronoiHalfEdge(edge,rSite,lSite));return edge;}
function d3_geom_voronoiCreateBorderEdge(lSite,va,vb){var edge=new d3_geom_voronoiEdge(lSite,null);edge.a=va;edge.b=vb;d3_geom_voronoiEdges.push(edge);return edge;}
function d3_geom_voronoiSetEdgeEnd(edge,lSite,rSite,vertex){if(!edge.a&&!edge.b){edge.a=vertex;edge.l=lSite;edge.r=rSite;}else if(edge.l===rSite){edge.b=vertex;}else{edge.a=vertex;}}
function d3_geom_voronoiHalfEdge(edge,lSite,rSite){var va=edge.a,vb=edge.b;this.edge=edge;this.site=lSite;this.angle=rSite?Math.atan2(rSite.y-lSite.y,rSite.x-lSite.x):edge.l===lSite?Math.atan2(vb.x-va.x,va.y-vb.y):Math.atan2(va.x-vb.x,vb.y-va.y);}
d3_geom_voronoiHalfEdge.prototype={start:function(){return this.edge.l===this.site?this.edge.a:this.edge.b;},end:function(){return this.edge.l===this.site?this.edge.b:this.edge.a;}};function d3_geom_voronoiRedBlackTree(){this._=null;}
function d3_geom_voronoiRedBlackNode(node){node.U=node.C=node.L=node.R=node.P=node.N=null;}
d3_geom_voronoiRedBlackTree.prototype={insert:function(after,node){var parent,grandpa,uncle;if(after){node.P=after;node.N=after.N;if(after.N)after.N.P=node;after.N=node;if(after.R){after=after.R;while(after.L)after=after.L;after.L=node;}else{after.R=node;}
parent=after;}else if(this._){after=d3_geom_voronoiRedBlackFirst(this._);node.P=null;node.N=after;after.P=after.L=node;parent=after;}else{node.P=node.N=null;this._=node;parent=null;}
node.L=node.R=null;node.U=parent;node.C=true;after=node;while(parent&&parent.C){grandpa=parent.U;if(parent===grandpa.L){uncle=grandpa.R;if(uncle&&uncle.C){parent.C=uncle.C=false;grandpa.C=true;after=grandpa;}else{if(after===parent.R){d3_geom_voronoiRedBlackRotateLeft(this,parent);after=parent;parent=after.U;}
parent.C=false;grandpa.C=true;d3_geom_voronoiRedBlackRotateRight(this,grandpa);}}else{uncle=grandpa.L;if(uncle&&uncle.C){parent.C=uncle.C=false;grandpa.C=true;after=grandpa;}else{if(after===parent.L){d3_geom_voronoiRedBlackRotateRight(this,parent);after=parent;parent=after.U;}
parent.C=false;grandpa.C=true;d3_geom_voronoiRedBlackRotateLeft(this,grandpa);}}
parent=after.U;}
this._.C=false;},remove:function(node){if(node.N)node.N.P=node.P;if(node.P)node.P.N=node.N;node.N=node.P=null;var parent=node.U,sibling,left=node.L,right=node.R,next,red;if(!left)next=right;else if(!right)next=left;else next=d3_geom_voronoiRedBlackFirst(right);if(parent){if(parent.L===node)parent.L=next;else parent.R=next;}else{this._=next;}
if(left&&right){red=next.C;next.C=node.C;next.L=left;left.U=next;if(next!==right){parent=next.U;next.U=node.U;node=next.R;parent.L=node;next.R=right;right.U=next;}else{next.U=parent;parent=next;node=next.R;}}else{red=node.C;node=next;}
if(node)node.U=parent;if(red)return;if(node&&node.C){node.C=false;return;}
do{if(node===this._)break;if(node===parent.L){sibling=parent.R;if(sibling.C){sibling.C=false;parent.C=true;d3_geom_voronoiRedBlackRotateLeft(this,parent);sibling=parent.R;}
if(sibling.L&&sibling.L.C||sibling.R&&sibling.R.C){if(!sibling.R||!sibling.R.C){sibling.L.C=false;sibling.C=true;d3_geom_voronoiRedBlackRotateRight(this,sibling);sibling=parent.R;}
sibling.C=parent.C;parent.C=sibling.R.C=false;d3_geom_voronoiRedBlackRotateLeft(this,parent);node=this._;break;}}else{sibling=parent.L;if(sibling.C){sibling.C=false;parent.C=true;d3_geom_voronoiRedBlackRotateRight(this,parent);sibling=parent.L;}
if(sibling.L&&sibling.L.C||sibling.R&&sibling.R.C){if(!sibling.L||!sibling.L.C){sibling.R.C=false;sibling.C=true;d3_geom_voronoiRedBlackRotateLeft(this,sibling);sibling=parent.L;}
sibling.C=parent.C;parent.C=sibling.L.C=false;d3_geom_voronoiRedBlackRotateRight(this,parent);node=this._;break;}}
sibling.C=true;node=parent;parent=parent.U;}while(!node.C);if(node)node.C=false;}};function d3_geom_voronoiRedBlackRotateLeft(tree,node){var p=node,q=node.R,parent=p.U;if(parent){if(parent.L===p)parent.L=q;else parent.R=q;}else{tree._=q;}
q.U=parent;p.U=q;p.R=q.L;if(p.R)p.R.U=p;q.L=p;}
function d3_geom_voronoiRedBlackRotateRight(tree,node){var p=node,q=node.L,parent=p.U;if(parent){if(parent.L===p)parent.L=q;else parent.R=q;}else{tree._=q;}
q.U=parent;p.U=q;p.L=q.R;if(p.L)p.L.U=p;q.R=p;}
function d3_geom_voronoiRedBlackFirst(node){while(node.L)node=node.L;return node;}
function d3_geom_voronoi(sites,bbox){var site=sites.sort(d3_geom_voronoiVertexOrder).pop(),x0,y0,circle;d3_geom_voronoiEdges=[];d3_geom_voronoiCells=new Array(sites.length);d3_geom_voronoiBeaches=new d3_geom_voronoiRedBlackTree();d3_geom_voronoiCircles=new d3_geom_voronoiRedBlackTree();while(true){circle=d3_geom_voronoiFirstCircle;if(site&&(!circle||site.y<circle.y||site.y===circle.y&&site.x<circle.x)){if(site.x!==x0||site.y!==y0){d3_geom_voronoiCells[site.i]=new d3_geom_voronoiCell(site);d3_geom_voronoiAddBeach(site);x0=site.x,y0=site.y;}
site=sites.pop();}else if(circle){d3_geom_voronoiRemoveBeach(circle.arc);}else{break;}}
if(bbox)d3_geom_voronoiClipEdges(bbox),d3_geom_voronoiCloseCells(bbox);var diagram={cells:d3_geom_voronoiCells,edges:d3_geom_voronoiEdges};d3_geom_voronoiBeaches=d3_geom_voronoiCircles=d3_geom_voronoiEdges=d3_geom_voronoiCells=null;return diagram;}
function d3_geom_voronoiVertexOrder(a,b){return b.y-a.y||b.x-a.x;}
d3.geom.voronoi=function(points){var x=d3_geom_pointX,y=d3_geom_pointY,fx=x,fy=y,clipExtent=d3_geom_voronoiClipExtent;if(points)return voronoi(points);function voronoi(data){var polygons=new Array(data.length),x0=clipExtent[0][0],y0=clipExtent[0][1],x1=clipExtent[1][0],y1=clipExtent[1][1];d3_geom_voronoi(sites(data),clipExtent).cells.forEach(function(cell,i){var edges=cell.edges,site=cell.site,polygon=polygons[i]=edges.length?edges.map(function(e){var s=e.start();return[s.x,s.y];}):site.x>=x0&&site.x<=x1&&site.y>=y0&&site.y<=y1?[[x0,y1],[x1,y1],[x1,y0],[x0,y0]]:[];polygon.point=data[i];});return polygons;}
function sites(data){return data.map(function(d,i){return{x:Math.round(fx(d,i)/ε)*ε,y:Math.round(fy(d,i)/ε)*ε,i:i};});}
voronoi.links=function(data){return d3_geom_voronoi(sites(data)).edges.filter(function(edge){return edge.l&&edge.r;}).map(function(edge){return{source:data[edge.l.i],target:data[edge.r.i]};});};voronoi.triangles=function(data){var triangles=[];d3_geom_voronoi(sites(data)).cells.forEach(function(cell,i){var site=cell.site,edges=cell.edges.sort(d3_geom_voronoiHalfEdgeOrder),j=-1,m=edges.length,e0,s0,e1=edges[m-1].edge,s1=e1.l===site?e1.r:e1.l;while(++j<m){e0=e1;s0=s1;e1=edges[j].edge;s1=e1.l===site?e1.r:e1.l;if(i<s0.i&&i<s1.i&&d3_geom_voronoiTriangleArea(site,s0,s1)<0){triangles.push([data[i],data[s0.i],data[s1.i]]);}}});return triangles;};voronoi.x=function(_){return arguments.length?(fx=d3_functor(x=_),voronoi):x;};voronoi.y=function(_){return arguments.length?(fy=d3_functor(y=_),voronoi):y;};voronoi.clipExtent=function(_){if(!arguments.length)return clipExtent===d3_geom_voronoiClipExtent?null:clipExtent;clipExtent=_==null?d3_geom_voronoiClipExtent:_;return voronoi;};voronoi.size=function(_){if(!arguments.length)return clipExtent===d3_geom_voronoiClipExtent?null:clipExtent&&clipExtent[1];return voronoi.clipExtent(_&&[[0,0],_]);};return voronoi;};var d3_geom_voronoiClipExtent=[[-1e6,-1e6],[1e6,1e6]];function d3_geom_voronoiTriangleArea(a,b,c){return(a.x-c.x)*(b.y-a.y)-(a.x-b.x)*(c.y-a.y);}
d3.geom.delaunay=function(vertices){return d3.geom.voronoi().triangles(vertices);};d3.geom.quadtree=function(points,x1,y1,x2,y2){var x=d3_geom_pointX,y=d3_geom_pointY,compat;if(compat=arguments.length){x=d3_geom_quadtreeCompatX;y=d3_geom_quadtreeCompatY;if(compat===3){y2=y1;x2=x1;y1=x1=0;}
return quadtree(points);}
function quadtree(data){var d,fx=d3_functor(x),fy=d3_functor(y),xs,ys,i,n,x1_,y1_,x2_,y2_;if(x1!=null){x1_=x1,y1_=y1,x2_=x2,y2_=y2;}else{x2_=y2_=-(x1_=y1_=Infinity);xs=[],ys=[];n=data.length;if(compat)for(i=0;i<n;++i){d=data[i];if(d.x<x1_)x1_=d.x;if(d.y<y1_)y1_=d.y;if(d.x>x2_)x2_=d.x;if(d.y>y2_)y2_=d.y;xs.push(d.x);ys.push(d.y);}else for(i=0;i<n;++i){var x_=+fx(d=data[i],i),y_=+fy(d,i);if(x_<x1_)x1_=x_;if(y_<y1_)y1_=y_;if(x_>x2_)x2_=x_;if(y_>y2_)y2_=y_;xs.push(x_);ys.push(y_);}}
var dx=x2_-x1_,dy=y2_-y1_;if(dx>dy)y2_=y1_+dx;else x2_=x1_+dy;function insert(n,d,x,y,x1,y1,x2,y2){if(isNaN(x)||isNaN(y))return;if(n.leaf){var nx=n.x,ny=n.y;if(nx!=null){if(abs(nx-x)+abs(ny-y)<.01){insertChild(n,d,x,y,x1,y1,x2,y2);}else{var nPoint=n.point;n.x=n.y=n.point=null;insertChild(n,nPoint,nx,ny,x1,y1,x2,y2);insertChild(n,d,x,y,x1,y1,x2,y2);}}else{n.x=x,n.y=y,n.point=d;}}else{insertChild(n,d,x,y,x1,y1,x2,y2);}}
function insertChild(n,d,x,y,x1,y1,x2,y2){var xm=(x1+x2)*.5,ym=(y1+y2)*.5,right=x>=xm,below=y>=ym,i=below<<1|right;n.leaf=false;n=n.nodes[i]||(n.nodes[i]=d3_geom_quadtreeNode());if(right)x1=xm;else x2=xm;if(below)y1=ym;else y2=ym;insert(n,d,x,y,x1,y1,x2,y2);}
var root=d3_geom_quadtreeNode();root.add=function(d){insert(root,d,+fx(d,++i),+fy(d,i),x1_,y1_,x2_,y2_);};root.visit=function(f){d3_geom_quadtreeVisit(f,root,x1_,y1_,x2_,y2_);};root.find=function(point){return d3_geom_quadtreeFind(root,point[0],point[1],x1_,y1_,x2_,y2_);};i=-1;if(x1==null){while(++i<n){insert(root,data[i],xs[i],ys[i],x1_,y1_,x2_,y2_);}
--i;}else data.forEach(root.add);xs=ys=data=d=null;return root;}
quadtree.x=function(_){return arguments.length?(x=_,quadtree):x;};quadtree.y=function(_){return arguments.length?(y=_,quadtree):y;};quadtree.extent=function(_){if(!arguments.length)return x1==null?null:[[x1,y1],[x2,y2]];if(_==null)x1=y1=x2=y2=null;else x1=+_[0][0],y1=+_[0][1],x2=+_[1][0],y2=+_[1][1];return quadtree;};quadtree.size=function(_){if(!arguments.length)return x1==null?null:[x2-x1,y2-y1];if(_==null)x1=y1=x2=y2=null;else x1=y1=0,x2=+_[0],y2=+_[1];return quadtree;};return quadtree;};function d3_geom_quadtreeCompatX(d){return d.x;}
function d3_geom_quadtreeCompatY(d){return d.y;}
function d3_geom_quadtreeNode(){return{leaf:true,nodes:[],point:null,x:null,y:null};}
function d3_geom_quadtreeVisit(f,node,x1,y1,x2,y2){if(!f(node,x1,y1,x2,y2)){var sx=(x1+x2)*.5,sy=(y1+y2)*.5,children=node.nodes;if(children[0])d3_geom_quadtreeVisit(f,children[0],x1,y1,sx,sy);if(children[1])d3_geom_quadtreeVisit(f,children[1],sx,y1,x2,sy);if(children[2])d3_geom_quadtreeVisit(f,children[2],x1,sy,sx,y2);if(children[3])d3_geom_quadtreeVisit(f,children[3],sx,sy,x2,y2);}}
function d3_geom_quadtreeFind(root,x,y,x0,y0,x3,y3){var minDistance2=Infinity,closestPoint;(function find(node,x1,y1,x2,y2){if(x1>x3||y1>y3||x2<x0||y2<y0)return;if(point=node.point){var point,dx=x-node.x,dy=y-node.y,distance2=dx*dx+dy*dy;if(distance2<minDistance2){var distance=Math.sqrt(minDistance2=distance2);x0=x-distance,y0=y-distance;x3=x+distance,y3=y+distance;closestPoint=point;}}
var children=node.nodes,xm=(x1+x2)*.5,ym=(y1+y2)*.5,right=x>=xm,below=y>=ym;for(var i=below<<1|right,j=i+4;i<j;++i){if(node=children[i&3])switch(i&3){case 0:find(node,x1,y1,xm,ym);break;case 1:find(node,xm,y1,x2,ym);break;case 2:find(node,x1,ym,xm,y2);break;case 3:find(node,xm,ym,x2,y2);break;}}})(root,x0,y0,x3,y3);return closestPoint;}
d3.interpolateRgb=d3_interpolateRgb;function d3_interpolateRgb(a,b){a=d3.rgb(a);b=d3.rgb(b);var ar=a.r,ag=a.g,ab=a.b,br=b.r-ar,bg=b.g-ag,bb=b.b-ab;return function(t){return"#"+d3_rgb_hex(Math.round(ar+br*t))+d3_rgb_hex(Math.round(ag+bg*t))+d3_rgb_hex(Math.round(ab+bb*t));};}
d3.interpolateObject=d3_interpolateObject;function d3_interpolateObject(a,b){var i={},c={},k;for(k in a){if(k in b){i[k]=d3_interpolate(a[k],b[k]);}else{c[k]=a[k];}}
for(k in b){if(!(k in a)){c[k]=b[k];}}
return function(t){for(k in i)c[k]=i[k](t);return c;};}
d3.interpolateNumber=d3_interpolateNumber;function d3_interpolateNumber(a,b){a=+a,b=+b;return function(t){return a*(1-t)+b*t;};}
d3.interpolateString=d3_interpolateString;function d3_interpolateString(a,b){var bi=d3_interpolate_numberA.lastIndex=d3_interpolate_numberB.lastIndex=0,am,bm,bs,i=-1,s=[],q=[];a=a+"",b=b+"";while((am=d3_interpolate_numberA.exec(a))&&(bm=d3_interpolate_numberB.exec(b))){if((bs=bm.index)>bi){bs=b.slice(bi,bs);if(s[i])s[i]+=bs;else s[++i]=bs;}
if((am=am[0])===(bm=bm[0])){if(s[i])s[i]+=bm;else s[++i]=bm;}else{s[++i]=null;q.push({i:i,x:d3_interpolateNumber(am,bm)});}
bi=d3_interpolate_numberB.lastIndex;}
if(bi<b.length){bs=b.slice(bi);if(s[i])s[i]+=bs;else s[++i]=bs;}
return s.length<2?q[0]?(b=q[0].x,function(t){return b(t)+"";}):function(){return b;}:(b=q.length,function(t){for(var i=0,o;i<b;++i)s[(o=q[i]).i]=o.x(t);return s.join("");});}
var d3_interpolate_numberA=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,d3_interpolate_numberB=new RegExp(d3_interpolate_numberA.source,"g");d3.interpolate=d3_interpolate;function d3_interpolate(a,b){var i=d3.interpolators.length,f;while(--i>=0&&!(f=d3.interpolators[i](a,b)));return f;}
d3.interpolators=[function(a,b){var t=typeof b;return(t==="string"?d3_rgb_names.has(b.toLowerCase())||/^(#|rgb\(|hsl\()/i.test(b)?d3_interpolateRgb:d3_interpolateString:b instanceof d3_color?d3_interpolateRgb:Array.isArray(b)?d3_interpolateArray:t==="object"&&isNaN(b)?d3_interpolateObject:d3_interpolateNumber)(a,b);}];d3.interpolateArray=d3_interpolateArray;function d3_interpolateArray(a,b){var x=[],c=[],na=a.length,nb=b.length,n0=Math.min(a.length,b.length),i;for(i=0;i<n0;++i)x.push(d3_interpolate(a[i],b[i]));for(;i<na;++i)c[i]=a[i];for(;i<nb;++i)c[i]=b[i];return function(t){for(i=0;i<n0;++i)c[i]=x[i](t);return c;};}
var d3_ease_default=function(){return d3_identity;};var d3_ease=d3.map({linear:d3_ease_default,poly:d3_ease_poly,quad:function(){return d3_ease_quad;},cubic:function(){return d3_ease_cubic;},sin:function(){return d3_ease_sin;},exp:function(){return d3_ease_exp;},circle:function(){return d3_ease_circle;},elastic:d3_ease_elastic,back:d3_ease_back,bounce:function(){return d3_ease_bounce;}});var d3_ease_mode=d3.map({"in":d3_identity,out:d3_ease_reverse,"in-out":d3_ease_reflect,"out-in":function(f){return d3_ease_reflect(d3_ease_reverse(f));}});d3.ease=function(name){var i=name.indexOf("-"),t=i>=0?name.slice(0,i):name,m=i>=0?name.slice(i+1):"in";t=d3_ease.get(t)||d3_ease_default;m=d3_ease_mode.get(m)||d3_identity;return d3_ease_clamp(m(t.apply(null,d3_arraySlice.call(arguments,1))));};function d3_ease_clamp(f){return function(t){return t<=0?0:t>=1?1:f(t);};}
function d3_ease_reverse(f){return function(t){return 1-f(1-t);};}
function d3_ease_reflect(f){return function(t){return.5*(t<.5?f(2*t):2-f(2-2*t));};}
function d3_ease_quad(t){return t*t;}
function d3_ease_cubic(t){return t*t*t;}
function d3_ease_cubicInOut(t){if(t<=0)return 0;if(t>=1)return 1;var t2=t*t,t3=t2*t;return 4*(t<.5?t3:3*(t-t2)+t3-.75);}
function d3_ease_poly(e){return function(t){return Math.pow(t,e);};}
function d3_ease_sin(t){return 1-Math.cos(t*halfπ);}
function d3_ease_exp(t){return Math.pow(2,10*(t-1));}
function d3_ease_circle(t){return 1-Math.sqrt(1-t*t);}
function d3_ease_elastic(a,p){var s;if(arguments.length<2)p=.45;if(arguments.length)s=p/τ*Math.asin(1/a);else a=1,s=p/4;return function(t){return 1+a*Math.pow(2,-10*t)*Math.sin((t-s)*τ/p);};}
function d3_ease_back(s){if(!s)s=1.70158;return function(t){return t*t*((s+1)*t-s);};}
function d3_ease_bounce(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375;}
d3.interpolateHcl=d3_interpolateHcl;function d3_interpolateHcl(a,b){a=d3.hcl(a);b=d3.hcl(b);var ah=a.h,ac=a.c,al=a.l,bh=b.h-ah,bc=b.c-ac,bl=b.l-al;if(isNaN(bc))bc=0,ac=isNaN(ac)?b.c:ac;if(isNaN(bh))bh=0,ah=isNaN(ah)?b.h:ah;else if(bh>180)bh-=360;else if(bh<-180)bh+=360;return function(t){return d3_hcl_lab(ah+bh*t,ac+bc*t,al+bl*t)+"";};}
d3.interpolateHsl=d3_interpolateHsl;function d3_interpolateHsl(a,b){a=d3.hsl(a);b=d3.hsl(b);var ah=a.h,as=a.s,al=a.l,bh=b.h-ah,bs=b.s-as,bl=b.l-al;if(isNaN(bs))bs=0,as=isNaN(as)?b.s:as;if(isNaN(bh))bh=0,ah=isNaN(ah)?b.h:ah;else if(bh>180)bh-=360;else if(bh<-180)bh+=360;return function(t){return d3_hsl_rgb(ah+bh*t,as+bs*t,al+bl*t)+"";};}
d3.interpolateLab=d3_interpolateLab;function d3_interpolateLab(a,b){a=d3.lab(a);b=d3.lab(b);var al=a.l,aa=a.a,ab=a.b,bl=b.l-al,ba=b.a-aa,bb=b.b-ab;return function(t){return d3_lab_rgb(al+bl*t,aa+ba*t,ab+bb*t)+"";};}
d3.interpolateRound=d3_interpolateRound;function d3_interpolateRound(a,b){b-=a;return function(t){return Math.round(a+b*t);};}
d3.transform=function(string){var g=d3_document.createElementNS(d3.ns.prefix.svg,"g");return(d3.transform=function(string){if(string!=null){g.setAttribute("transform",string);var t=g.transform.baseVal.consolidate();}
return new d3_transform(t?t.matrix:d3_transformIdentity);})(string);};function d3_transform(m){var r0=[m.a,m.b],r1=[m.c,m.d],kx=d3_transformNormalize(r0),kz=d3_transformDot(r0,r1),ky=d3_transformNormalize(d3_transformCombine(r1,r0,-kz))||0;if(r0[0]*r1[1]<r1[0]*r0[1]){r0[0]*=-1;r0[1]*=-1;kx*=-1;kz*=-1;}
this.rotate=(kx?Math.atan2(r0[1],r0[0]):Math.atan2(-r1[0],r1[1]))*d3_degrees;this.translate=[m.e,m.f];this.scale=[kx,ky];this.skew=ky?Math.atan2(kz,ky)*d3_degrees:0;}
d3_transform.prototype.toString=function(){return"translate("+this.translate+")rotate("+this.rotate+")skewX("+this.skew+")scale("+this.scale+")";};function d3_transformDot(a,b){return a[0]*b[0]+a[1]*b[1];}
function d3_transformNormalize(a){var k=Math.sqrt(d3_transformDot(a,a));if(k){a[0]/=k;a[1]/=k;}
return k;}
function d3_transformCombine(a,b,k){a[0]+=k*b[0];a[1]+=k*b[1];return a;}
var d3_transformIdentity={a:1,b:0,c:0,d:1,e:0,f:0};d3.interpolateTransform=d3_interpolateTransform;function d3_interpolateTransform(a,b){var s=[],q=[],n,A=d3.transform(a),B=d3.transform(b),ta=A.translate,tb=B.translate,ra=A.rotate,rb=B.rotate,wa=A.skew,wb=B.skew,ka=A.scale,kb=B.scale;if(ta[0]!=tb[0]||ta[1]!=tb[1]){s.push("translate(",null,",",null,")");q.push({i:1,x:d3_interpolateNumber(ta[0],tb[0])},{i:3,x:d3_interpolateNumber(ta[1],tb[1])});}else if(tb[0]||tb[1]){s.push("translate("+tb+")");}else{s.push("");}
if(ra!=rb){if(ra-rb>180)rb+=360;else if(rb-ra>180)ra+=360;q.push({i:s.push(s.pop()+"rotate(",null,")")-2,x:d3_interpolateNumber(ra,rb)});}else if(rb){s.push(s.pop()+"rotate("+rb+")");}
if(wa!=wb){q.push({i:s.push(s.pop()+"skewX(",null,")")-2,x:d3_interpolateNumber(wa,wb)});}else if(wb){s.push(s.pop()+"skewX("+wb+")");}
if(ka[0]!=kb[0]||ka[1]!=kb[1]){n=s.push(s.pop()+"scale(",null,",",null,")");q.push({i:n-4,x:d3_interpolateNumber(ka[0],kb[0])},{i:n-2,x:d3_interpolateNumber(ka[1],kb[1])});}else if(kb[0]!=1||kb[1]!=1){s.push(s.pop()+"scale("+kb+")");}
n=q.length;return function(t){var i=-1,o;while(++i<n)s[(o=q[i]).i]=o.x(t);return s.join("");};}
function d3_uninterpolateNumber(a,b){b=(b-=a=+a)||1/b;return function(x){return(x-a)/b;};}
function d3_uninterpolateClamp(a,b){b=(b-=a=+a)||1/b;return function(x){return Math.max(0,Math.min(1,(x-a)/b));};}
d3.layout={};d3.layout.bundle=function(){return function(links){var paths=[],i=-1,n=links.length;while(++i<n)paths.push(d3_layout_bundlePath(links[i]));return paths;};};function d3_layout_bundlePath(link){var start=link.source,end=link.target,lca=d3_layout_bundleLeastCommonAncestor(start,end),points=[start];while(start!==lca){start=start.parent;points.push(start);}
var k=points.length;while(end!==lca){points.splice(k,0,end);end=end.parent;}
return points;}
function d3_layout_bundleAncestors(node){var ancestors=[],parent=node.parent;while(parent!=null){ancestors.push(node);node=parent;parent=parent.parent;}
ancestors.push(node);return ancestors;}
function d3_layout_bundleLeastCommonAncestor(a,b){if(a===b)return a;var aNodes=d3_layout_bundleAncestors(a),bNodes=d3_layout_bundleAncestors(b),aNode=aNodes.pop(),bNode=bNodes.pop(),sharedNode=null;while(aNode===bNode){sharedNode=aNode;aNode=aNodes.pop();bNode=bNodes.pop();}
return sharedNode;}
d3.layout.chord=function(){var chord={},chords,groups,matrix,n,padding=0,sortGroups,sortSubgroups,sortChords;function relayout(){var subgroups={},groupSums=[],groupIndex=d3.range(n),subgroupIndex=[],k,x,x0,i,j;chords=[];groups=[];k=0,i=-1;while(++i<n){x=0,j=-1;while(++j<n){x+=matrix[i][j];}
groupSums.push(x);subgroupIndex.push(d3.range(n));k+=x;}
if(sortGroups){groupIndex.sort(function(a,b){return sortGroups(groupSums[a],groupSums[b]);});}
if(sortSubgroups){subgroupIndex.forEach(function(d,i){d.sort(function(a,b){return sortSubgroups(matrix[i][a],matrix[i][b]);});});}
k=(τ-padding*n)/k;x=0,i=-1;while(++i<n){x0=x,j=-1;while(++j<n){var di=groupIndex[i],dj=subgroupIndex[di][j],v=matrix[di][dj],a0=x,a1=x+=v*k;subgroups[di+"-"+dj]={index:di,subindex:dj,startAngle:a0,endAngle:a1,value:v};}
groups[di]={index:di,startAngle:x0,endAngle:x,value:(x-x0)/k};x+=padding;}
i=-1;while(++i<n){j=i-1;while(++j<n){var source=subgroups[i+"-"+j],target=subgroups[j+"-"+i];if(source.value||target.value){chords.push(source.value<target.value?{source:target,target:source}:{source:source,target:target});}}}
if(sortChords)resort();}
function resort(){chords.sort(function(a,b){return sortChords((a.source.value+a.target.value)/2,(b.source.value+b.target.value)/2);});}
chord.matrix=function(x){if(!arguments.length)return matrix;n=(matrix=x)&&matrix.length;chords=groups=null;return chord;};chord.padding=function(x){if(!arguments.length)return padding;padding=x;chords=groups=null;return chord;};chord.sortGroups=function(x){if(!arguments.length)return sortGroups;sortGroups=x;chords=groups=null;return chord;};chord.sortSubgroups=function(x){if(!arguments.length)return sortSubgroups;sortSubgroups=x;chords=null;return chord;};chord.sortChords=function(x){if(!arguments.length)return sortChords;sortChords=x;if(chords)resort();return chord;};chord.chords=function(){if(!chords)relayout();return chords;};chord.groups=function(){if(!groups)relayout();return groups;};return chord;};d3.layout.force=function(){var force={},event=d3.dispatch("start","tick","end"),size=[1,1],drag,alpha,friction=.9,linkDistance=d3_layout_forceLinkDistance,linkStrength=d3_layout_forceLinkStrength,charge=-30,chargeDistance2=d3_layout_forceChargeDistance2,gravity=.1,theta2=.64,nodes=[],links=[],distances,strengths,charges;function repulse(node){return function(quad,x1,_,x2){if(quad.point!==node){var dx=quad.cx-node.x,dy=quad.cy-node.y,dw=x2-x1,dn=dx*dx+dy*dy;if(dw*dw/theta2<dn){if(dn<chargeDistance2){var k=quad.charge/dn;node.px-=dx*k;node.py-=dy*k;}
return true;}
if(quad.point&&dn&&dn<chargeDistance2){var k=quad.pointCharge/dn;node.px-=dx*k;node.py-=dy*k;}}
return!quad.charge;};}
force.tick=function(){if((alpha*=.99)<.005){event.end({type:"end",alpha:alpha=0});return true;}
var n=nodes.length,m=links.length,q,i,o,s,t,l,k,x,y;for(i=0;i<m;++i){o=links[i];s=o.source;t=o.target;x=t.x-s.x;y=t.y-s.y;if(l=x*x+y*y){l=alpha*strengths[i]*((l=Math.sqrt(l))-distances[i])/l;x*=l;y*=l;t.x-=x*(k=s.weight/(t.weight+s.weight));t.y-=y*k;s.x+=x*(k=1-k);s.y+=y*k;}}
if(k=alpha*gravity){x=size[0]/2;y=size[1]/2;i=-1;if(k)while(++i<n){o=nodes[i];o.x+=(x-o.x)*k;o.y+=(y-o.y)*k;}}
if(charge){d3_layout_forceAccumulate(q=d3.geom.quadtree(nodes),alpha,charges);i=-1;while(++i<n){if(!(o=nodes[i]).fixed){q.visit(repulse(o));}}}
i=-1;while(++i<n){o=nodes[i];if(o.fixed){o.x=o.px;o.y=o.py;}else{o.x-=(o.px-(o.px=o.x))*friction;o.y-=(o.py-(o.py=o.y))*friction;}}
event.tick({type:"tick",alpha:alpha});};force.nodes=function(x){if(!arguments.length)return nodes;nodes=x;return force;};force.links=function(x){if(!arguments.length)return links;links=x;return force;};force.size=function(x){if(!arguments.length)return size;size=x;return force;};force.linkDistance=function(x){if(!arguments.length)return linkDistance;linkDistance=typeof x==="function"?x:+x;return force;};force.distance=force.linkDistance;force.linkStrength=function(x){if(!arguments.length)return linkStrength;linkStrength=typeof x==="function"?x:+x;return force;};force.friction=function(x){if(!arguments.length)return friction;friction=+x;return force;};force.charge=function(x){if(!arguments.length)return charge;charge=typeof x==="function"?x:+x;return force;};force.chargeDistance=function(x){if(!arguments.length)return Math.sqrt(chargeDistance2);chargeDistance2=x*x;return force;};force.gravity=function(x){if(!arguments.length)return gravity;gravity=+x;return force;};force.theta=function(x){if(!arguments.length)return Math.sqrt(theta2);theta2=x*x;return force;};force.alpha=function(x){if(!arguments.length)return alpha;x=+x;if(alpha){if(x>0)alpha=x;else alpha=0;}else if(x>0){event.start({type:"start",alpha:alpha=x});d3.timer(force.tick);}
return force;};force.start=function(){var i,n=nodes.length,m=links.length,w=size[0],h=size[1],neighbors,o;for(i=0;i<n;++i){(o=nodes[i]).index=i;o.weight=0;}
for(i=0;i<m;++i){o=links[i];if(typeof o.source=="number")o.source=nodes[o.source];if(typeof o.target=="number")o.target=nodes[o.target];++o.source.weight;++o.target.weight;}
for(i=0;i<n;++i){o=nodes[i];if(isNaN(o.x))o.x=position("x",w);if(isNaN(o.y))o.y=position("y",h);if(isNaN(o.px))o.px=o.x;if(isNaN(o.py))o.py=o.y;}
distances=[];if(typeof linkDistance==="function")for(i=0;i<m;++i)distances[i]=+linkDistance.call(this,links[i],i);else for(i=0;i<m;++i)distances[i]=linkDistance;strengths=[];if(typeof linkStrength==="function")for(i=0;i<m;++i)strengths[i]=+linkStrength.call(this,links[i],i);else for(i=0;i<m;++i)strengths[i]=linkStrength;charges=[];if(typeof charge==="function")for(i=0;i<n;++i)charges[i]=+charge.call(this,nodes[i],i);else for(i=0;i<n;++i)charges[i]=charge;function position(dimension,size){if(!neighbors){neighbors=new Array(n);for(j=0;j<n;++j){neighbors[j]=[];}
for(j=0;j<m;++j){var o=links[j];neighbors[o.source.index].push(o.target);neighbors[o.target.index].push(o.source);}}
var candidates=neighbors[i],j=-1,l=candidates.length,x;while(++j<l)if(!isNaN(x=candidates[j][dimension]))return x;return Math.random()*size;}
return force.resume();};force.resume=function(){return force.alpha(.1);};force.stop=function(){return force.alpha(0);};force.drag=function(){if(!drag)drag=d3.behavior.drag().origin(d3_identity).on("dragstart.force",d3_layout_forceDragstart).on("drag.force",dragmove).on("dragend.force",d3_layout_forceDragend);if(!arguments.length)return drag;this.on("mouseover.force",d3_layout_forceMouseover).on("mouseout.force",d3_layout_forceMouseout).call(drag);};function dragmove(d){d.px=d3.event.x,d.py=d3.event.y;force.resume();}
return d3.rebind(force,event,"on");};function d3_layout_forceDragstart(d){d.fixed|=2;}
function d3_layout_forceDragend(d){d.fixed&=~6;}
function d3_layout_forceMouseover(d){d.fixed|=4;d.px=d.x,d.py=d.y;}
function d3_layout_forceMouseout(d){d.fixed&=~4;}
function d3_layout_forceAccumulate(quad,alpha,charges){var cx=0,cy=0;quad.charge=0;if(!quad.leaf){var nodes=quad.nodes,n=nodes.length,i=-1,c;while(++i<n){c=nodes[i];if(c==null)continue;d3_layout_forceAccumulate(c,alpha,charges);quad.charge+=c.charge;cx+=c.charge*c.cx;cy+=c.charge*c.cy;}}
if(quad.point){if(!quad.leaf){quad.point.x+=Math.random()-.5;quad.point.y+=Math.random()-.5;}
var k=alpha*charges[quad.point.index];quad.charge+=quad.pointCharge=k;cx+=k*quad.point.x;cy+=k*quad.point.y;}
quad.cx=cx/quad.charge;quad.cy=cy/quad.charge;}
var d3_layout_forceLinkDistance=20,d3_layout_forceLinkStrength=1,d3_layout_forceChargeDistance2=Infinity;d3.layout.hierarchy=function(){var sort=d3_layout_hierarchySort,children=d3_layout_hierarchyChildren,value=d3_layout_hierarchyValue;function hierarchy(root){var stack=[root],nodes=[],node;root.depth=0;while((node=stack.pop())!=null){nodes.push(node);if((childs=children.call(hierarchy,node,node.depth))&&(n=childs.length)){var n,childs,child;while(--n>=0){stack.push(child=childs[n]);child.parent=node;child.depth=node.depth+1;}
if(value)node.value=0;node.children=childs;}else{if(value)node.value=+value.call(hierarchy,node,node.depth)||0;delete node.children;}}
d3_layout_hierarchyVisitAfter(root,function(node){var childs,parent;if(sort&&(childs=node.children))childs.sort(sort);if(value&&(parent=node.parent))parent.value+=node.value;});return nodes;}
hierarchy.sort=function(x){if(!arguments.length)return sort;sort=x;return hierarchy;};hierarchy.children=function(x){if(!arguments.length)return children;children=x;return hierarchy;};hierarchy.value=function(x){if(!arguments.length)return value;value=x;return hierarchy;};hierarchy.revalue=function(root){if(value){d3_layout_hierarchyVisitBefore(root,function(node){if(node.children)node.value=0;});d3_layout_hierarchyVisitAfter(root,function(node){var parent;if(!node.children)node.value=+value.call(hierarchy,node,node.depth)||0;if(parent=node.parent)parent.value+=node.value;});}
return root;};return hierarchy;};function d3_layout_hierarchyRebind(object,hierarchy){d3.rebind(object,hierarchy,"sort","children","value");object.nodes=object;object.links=d3_layout_hierarchyLinks;return object;}
function d3_layout_hierarchyVisitBefore(node,callback){var nodes=[node];while((node=nodes.pop())!=null){callback(node);if((children=node.children)&&(n=children.length)){var n,children;while(--n>=0)nodes.push(children[n]);}}}
function d3_layout_hierarchyVisitAfter(node,callback){var nodes=[node],nodes2=[];while((node=nodes.pop())!=null){nodes2.push(node);if((children=node.children)&&(n=children.length)){var i=-1,n,children;while(++i<n)nodes.push(children[i]);}}
while((node=nodes2.pop())!=null){callback(node);}}
function d3_layout_hierarchyChildren(d){return d.children;}
function d3_layout_hierarchyValue(d){return d.value;}
function d3_layout_hierarchySort(a,b){return b.value-a.value;}
function d3_layout_hierarchyLinks(nodes){return d3.merge(nodes.map(function(parent){return(parent.children||[]).map(function(child){return{source:parent,target:child};});}));}
d3.layout.partition=function(){var hierarchy=d3.layout.hierarchy(),size=[1,1];function position(node,x,dx,dy){var children=node.children;node.x=x;node.y=node.depth*dy;node.dx=dx;node.dy=dy;if(children&&(n=children.length)){var i=-1,n,c,d;dx=node.value?dx/node.value:0;while(++i<n){position(c=children[i],x,d=c.value*dx,dy);x+=d;}}}
function depth(node){var children=node.children,d=0;if(children&&(n=children.length)){var i=-1,n;while(++i<n)d=Math.max(d,depth(children[i]));}
return 1+d;}
function partition(d,i){var nodes=hierarchy.call(this,d,i);position(nodes[0],0,size[0],size[1]/depth(nodes[0]));return nodes;}
partition.size=function(x){if(!arguments.length)return size;size=x;return partition;};return d3_layout_hierarchyRebind(partition,hierarchy);};d3.layout.pie=function(){var value=Number,sort=d3_layout_pieSortByValue,startAngle=0,endAngle=τ,padAngle=0;function pie(data){var n=data.length,values=data.map(function(d,i){return+value.call(pie,d,i);}),a=+(typeof startAngle==="function"?startAngle.apply(this,arguments):startAngle),da=(typeof endAngle==="function"?endAngle.apply(this,arguments):endAngle)-a,p=Math.min(Math.abs(da)/n,+(typeof padAngle==="function"?padAngle.apply(this,arguments):padAngle)),pa=p*(da<0?-1:1),k=(da-n*pa)/d3.sum(values),index=d3.range(n),arcs=[],v;if(sort!=null)index.sort(sort===d3_layout_pieSortByValue?function(i,j){return values[j]-values[i];}:function(i,j){return sort(data[i],data[j]);});index.forEach(function(i){arcs[i]={data:data[i],value:v=values[i],startAngle:a,endAngle:a+=v*k+pa,padAngle:p};});return arcs;}
pie.value=function(_){if(!arguments.length)return value;value=_;return pie;};pie.sort=function(_){if(!arguments.length)return sort;sort=_;return pie;};pie.startAngle=function(_){if(!arguments.length)return startAngle;startAngle=_;return pie;};pie.endAngle=function(_){if(!arguments.length)return endAngle;endAngle=_;return pie;};pie.padAngle=function(_){if(!arguments.length)return padAngle;padAngle=_;return pie;};return pie;};var d3_layout_pieSortByValue={};d3.layout.stack=function(){var values=d3_identity,order=d3_layout_stackOrderDefault,offset=d3_layout_stackOffsetZero,out=d3_layout_stackOut,x=d3_layout_stackX,y=d3_layout_stackY;function stack(data,index){if(!(n=data.length))return data;var series=data.map(function(d,i){return values.call(stack,d,i);});var points=series.map(function(d){return d.map(function(v,i){return[x.call(stack,v,i),y.call(stack,v,i)];});});var orders=order.call(stack,points,index);series=d3.permute(series,orders);points=d3.permute(points,orders);var offsets=offset.call(stack,points,index);var m=series[0].length,n,i,j,o;for(j=0;j<m;++j){out.call(stack,series[0][j],o=offsets[j],points[0][j][1]);for(i=1;i<n;++i){out.call(stack,series[i][j],o+=points[i-1][j][1],points[i][j][1]);}}
return data;}
stack.values=function(x){if(!arguments.length)return values;values=x;return stack;};stack.order=function(x){if(!arguments.length)return order;order=typeof x==="function"?x:d3_layout_stackOrders.get(x)||d3_layout_stackOrderDefault;return stack;};stack.offset=function(x){if(!arguments.length)return offset;offset=typeof x==="function"?x:d3_layout_stackOffsets.get(x)||d3_layout_stackOffsetZero;return stack;};stack.x=function(z){if(!arguments.length)return x;x=z;return stack;};stack.y=function(z){if(!arguments.length)return y;y=z;return stack;};stack.out=function(z){if(!arguments.length)return out;out=z;return stack;};return stack;};function d3_layout_stackX(d){return d.x;}
function d3_layout_stackY(d){return d.y;}
function d3_layout_stackOut(d,y0,y){d.y0=y0;d.y=y;}
var d3_layout_stackOrders=d3.map({"inside-out":function(data){var n=data.length,i,j,max=data.map(d3_layout_stackMaxIndex),sums=data.map(d3_layout_stackReduceSum),index=d3.range(n).sort(function(a,b){return max[a]-max[b];}),top=0,bottom=0,tops=[],bottoms=[];for(i=0;i<n;++i){j=index[i];if(top<bottom){top+=sums[j];tops.push(j);}else{bottom+=sums[j];bottoms.push(j);}}
return bottoms.reverse().concat(tops);},reverse:function(data){return d3.range(data.length).reverse();},"default":d3_layout_stackOrderDefault});var d3_layout_stackOffsets=d3.map({silhouette:function(data){var n=data.length,m=data[0].length,sums=[],max=0,i,j,o,y0=[];for(j=0;j<m;++j){for(i=0,o=0;i<n;i++)o+=data[i][j][1];if(o>max)max=o;sums.push(o);}
for(j=0;j<m;++j){y0[j]=(max-sums[j])/2;}
return y0;},wiggle:function(data){var n=data.length,x=data[0],m=x.length,i,j,k,s1,s2,s3,dx,o,o0,y0=[];y0[0]=o=o0=0;for(j=1;j<m;++j){for(i=0,s1=0;i<n;++i)s1+=data[i][j][1];for(i=0,s2=0,dx=x[j][0]-x[j-1][0];i<n;++i){for(k=0,s3=(data[i][j][1]-data[i][j-1][1])/(2*dx);k<i;++k){s3+=(data[k][j][1]-data[k][j-1][1])/dx;}
s2+=s3*data[i][j][1];}
y0[j]=o-=s1?s2/s1*dx:0;if(o<o0)o0=o;}
for(j=0;j<m;++j)y0[j]-=o0;return y0;},expand:function(data){var n=data.length,m=data[0].length,k=1/n,i,j,o,y0=[];for(j=0;j<m;++j){for(i=0,o=0;i<n;i++)o+=data[i][j][1];if(o)for(i=0;i<n;i++)data[i][j][1]/=o;else for(i=0;i<n;i++)data[i][j][1]=k;}
for(j=0;j<m;++j)y0[j]=0;return y0;},zero:d3_layout_stackOffsetZero});function d3_layout_stackOrderDefault(data){return d3.range(data.length);}
function d3_layout_stackOffsetZero(data){var j=-1,m=data[0].length,y0=[];while(++j<m)y0[j]=0;return y0;}
function d3_layout_stackMaxIndex(array){var i=1,j=0,v=array[0][1],k,n=array.length;for(;i<n;++i){if((k=array[i][1])>v){j=i;v=k;}}
return j;}
function d3_layout_stackReduceSum(d){return d.reduce(d3_layout_stackSum,0);}
function d3_layout_stackSum(p,d){return p+d[1];}
d3.layout.histogram=function(){var frequency=true,valuer=Number,ranger=d3_layout_histogramRange,binner=d3_layout_histogramBinSturges;function histogram(data,i){var bins=[],values=data.map(valuer,this),range=ranger.call(this,values,i),thresholds=binner.call(this,range,values,i),bin,i=-1,n=values.length,m=thresholds.length-1,k=frequency?1:1/n,x;while(++i<m){bin=bins[i]=[];bin.dx=thresholds[i+1]-(bin.x=thresholds[i]);bin.y=0;}
if(m>0){i=-1;while(++i<n){x=values[i];if(x>=range[0]&&x<=range[1]){bin=bins[d3.bisect(thresholds,x,1,m)-1];bin.y+=k;bin.push(data[i]);}}}
return bins;}
histogram.value=function(x){if(!arguments.length)return valuer;valuer=x;return histogram;};histogram.range=function(x){if(!arguments.length)return ranger;ranger=d3_functor(x);return histogram;};histogram.bins=function(x){if(!arguments.length)return binner;binner=typeof x==="number"?function(range){return d3_layout_histogramBinFixed(range,x);}:d3_functor(x);return histogram;};histogram.frequency=function(x){if(!arguments.length)return frequency;frequency=!!x;return histogram;};return histogram;};function d3_layout_histogramBinSturges(range,values){return d3_layout_histogramBinFixed(range,Math.ceil(Math.log(values.length)/Math.LN2+1));}
function d3_layout_histogramBinFixed(range,n){var x=-1,b=+range[0],m=(range[1]-b)/n,f=[];while(++x<=n)f[x]=m*x+b;return f;}
function d3_layout_histogramRange(values){return[d3.min(values),d3.max(values)];}
d3.layout.pack=function(){var hierarchy=d3.layout.hierarchy().sort(d3_layout_packSort),padding=0,size=[1,1],radius;function pack(d,i){var nodes=hierarchy.call(this,d,i),root=nodes[0],w=size[0],h=size[1],r=radius==null?Math.sqrt:typeof radius==="function"?radius:function(){return radius;};root.x=root.y=0;d3_layout_hierarchyVisitAfter(root,function(d){d.r=+r(d.value);});d3_layout_hierarchyVisitAfter(root,d3_layout_packSiblings);if(padding){var dr=padding*(radius?1:Math.max(2*root.r/w,2*root.r/h))/2;d3_layout_hierarchyVisitAfter(root,function(d){d.r+=dr;});d3_layout_hierarchyVisitAfter(root,d3_layout_packSiblings);d3_layout_hierarchyVisitAfter(root,function(d){d.r-=dr;});}
d3_layout_packTransform(root,w/2,h/2,radius?1:1/Math.max(2*root.r/w,2*root.r/h));return nodes;}
pack.size=function(_){if(!arguments.length)return size;size=_;return pack;};pack.radius=function(_){if(!arguments.length)return radius;radius=_==null||typeof _==="function"?_:+_;return pack;};pack.padding=function(_){if(!arguments.length)return padding;padding=+_;return pack;};return d3_layout_hierarchyRebind(pack,hierarchy);};function d3_layout_packSort(a,b){return a.value-b.value;}
function d3_layout_packInsert(a,b){var c=a._pack_next;a._pack_next=b;b._pack_prev=a;b._pack_next=c;c._pack_prev=b;}
function d3_layout_packSplice(a,b){a._pack_next=b;b._pack_prev=a;}
function d3_layout_packIntersects(a,b){var dx=b.x-a.x,dy=b.y-a.y,dr=a.r+b.r;return.999*dr*dr>dx*dx+dy*dy;}
function d3_layout_packSiblings(node){if(!(nodes=node.children)||!(n=nodes.length))return;var nodes,xMin=Infinity,xMax=-Infinity,yMin=Infinity,yMax=-Infinity,a,b,c,i,j,k,n;function bound(node){xMin=Math.min(node.x-node.r,xMin);xMax=Math.max(node.x+node.r,xMax);yMin=Math.min(node.y-node.r,yMin);yMax=Math.max(node.y+node.r,yMax);}
nodes.forEach(d3_layout_packLink);a=nodes[0];a.x=-a.r;a.y=0;bound(a);if(n>1){b=nodes[1];b.x=b.r;b.y=0;bound(b);if(n>2){c=nodes[2];d3_layout_packPlace(a,b,c);bound(c);d3_layout_packInsert(a,c);a._pack_prev=c;d3_layout_packInsert(c,b);b=a._pack_next;for(i=3;i<n;i++){d3_layout_packPlace(a,b,c=nodes[i]);var isect=0,s1=1,s2=1;for(j=b._pack_next;j!==b;j=j._pack_next,s1++){if(d3_layout_packIntersects(j,c)){isect=1;break;}}
if(isect==1){for(k=a._pack_prev;k!==j._pack_prev;k=k._pack_prev,s2++){if(d3_layout_packIntersects(k,c)){break;}}}
if(isect){if(s1<s2||s1==s2&&b.r<a.r)d3_layout_packSplice(a,b=j);else d3_layout_packSplice(a=k,b);i--;}else{d3_layout_packInsert(a,c);b=c;bound(c);}}}}
var cx=(xMin+xMax)/2,cy=(yMin+yMax)/2,cr=0;for(i=0;i<n;i++){c=nodes[i];c.x-=cx;c.y-=cy;cr=Math.max(cr,c.r+Math.sqrt(c.x*c.x+c.y*c.y));}
node.r=cr;nodes.forEach(d3_layout_packUnlink);}
function d3_layout_packLink(node){node._pack_next=node._pack_prev=node;}
function d3_layout_packUnlink(node){delete node._pack_next;delete node._pack_prev;}
function d3_layout_packTransform(node,x,y,k){var children=node.children;node.x=x+=k*node.x;node.y=y+=k*node.y;node.r*=k;if(children){var i=-1,n=children.length;while(++i<n)d3_layout_packTransform(children[i],x,y,k);}}
function d3_layout_packPlace(a,b,c){var db=a.r+c.r,dx=b.x-a.x,dy=b.y-a.y;if(db&&(dx||dy)){var da=b.r+c.r,dc=dx*dx+dy*dy;da*=da;db*=db;var x=.5+(db-da)/(2*dc),y=Math.sqrt(Math.max(0,2*da*(db+dc)-(db-=dc)*db-da*da))/(2*dc);c.x=a.x+x*dx+y*dy;c.y=a.y+x*dy-y*dx;}else{c.x=a.x+db;c.y=a.y;}}
d3.layout.tree=function(){var hierarchy=d3.layout.hierarchy().sort(null).value(null),separation=d3_layout_treeSeparation,size=[1,1],nodeSize=null;function tree(d,i){var nodes=hierarchy.call(this,d,i),root0=nodes[0],root1=wrapTree(root0);d3_layout_hierarchyVisitAfter(root1,firstWalk),root1.parent.m=-root1.z;d3_layout_hierarchyVisitBefore(root1,secondWalk);if(nodeSize)d3_layout_hierarchyVisitBefore(root0,sizeNode);else{var left=root0,right=root0,bottom=root0;d3_layout_hierarchyVisitBefore(root0,function(node){if(node.x<left.x)left=node;if(node.x>right.x)right=node;if(node.depth>bottom.depth)bottom=node;});var tx=separation(left,right)/2-left.x,kx=size[0]/(right.x+separation(right,left)/2+tx),ky=size[1]/(bottom.depth||1);d3_layout_hierarchyVisitBefore(root0,function(node){node.x=(node.x+tx)*kx;node.y=node.depth*ky;});}
return nodes;}
function wrapTree(root0){var root1={A:null,children:[root0]},queue=[root1],node1;while((node1=queue.pop())!=null){for(var children=node1.children,child,i=0,n=children.length;i<n;++i){queue.push((children[i]=child={_:children[i],parent:node1,children:(child=children[i].children)&&child.slice()||[],A:null,a:null,z:0,m:0,c:0,s:0,t:null,i:i}).a=child);}}
return root1.children[0];}
function firstWalk(v){var children=v.children,siblings=v.parent.children,w=v.i?siblings[v.i-1]:null;if(children.length){d3_layout_treeShift(v);var midpoint=(children[0].z+children[children.length-1].z)/2;if(w){v.z=w.z+separation(v._,w._);v.m=v.z-midpoint;}else{v.z=midpoint;}}else if(w){v.z=w.z+separation(v._,w._);}
v.parent.A=apportion(v,w,v.parent.A||siblings[0]);}
function secondWalk(v){v._.x=v.z+v.parent.m;v.m+=v.parent.m;}
function apportion(v,w,ancestor){if(w){var vip=v,vop=v,vim=w,vom=vip.parent.children[0],sip=vip.m,sop=vop.m,sim=vim.m,som=vom.m,shift;while(vim=d3_layout_treeRight(vim),vip=d3_layout_treeLeft(vip),vim&&vip){vom=d3_layout_treeLeft(vom);vop=d3_layout_treeRight(vop);vop.a=v;shift=vim.z+sim-vip.z-sip+separation(vim._,vip._);if(shift>0){d3_layout_treeMove(d3_layout_treeAncestor(vim,v,ancestor),v,shift);sip+=shift;sop+=shift;}
sim+=vim.m;sip+=vip.m;som+=vom.m;sop+=vop.m;}
if(vim&&!d3_layout_treeRight(vop)){vop.t=vim;vop.m+=sim-sop;}
if(vip&&!d3_layout_treeLeft(vom)){vom.t=vip;vom.m+=sip-som;ancestor=v;}}
return ancestor;}
function sizeNode(node){node.x*=size[0];node.y=node.depth*size[1];}
tree.separation=function(x){if(!arguments.length)return separation;separation=x;return tree;};tree.size=function(x){if(!arguments.length)return nodeSize?null:size;nodeSize=(size=x)==null?sizeNode:null;return tree;};tree.nodeSize=function(x){if(!arguments.length)return nodeSize?size:null;nodeSize=(size=x)==null?null:sizeNode;return tree;};return d3_layout_hierarchyRebind(tree,hierarchy);};function d3_layout_treeSeparation(a,b){return a.parent==b.parent?1:2;}
function d3_layout_treeLeft(v){var children=v.children;return children.length?children[0]:v.t;}
function d3_layout_treeRight(v){var children=v.children,n;return(n=children.length)?children[n-1]:v.t;}
function d3_layout_treeMove(wm,wp,shift){var change=shift/(wp.i-wm.i);wp.c-=change;wp.s+=shift;wm.c+=change;wp.z+=shift;wp.m+=shift;}
function d3_layout_treeShift(v){var shift=0,change=0,children=v.children,i=children.length,w;while(--i>=0){w=children[i];w.z+=shift;w.m+=shift;shift+=w.s+(change+=w.c);}}
function d3_layout_treeAncestor(vim,v,ancestor){return vim.a.parent===v.parent?vim.a:ancestor;}
d3.layout.cluster=function(){var hierarchy=d3.layout.hierarchy().sort(null).value(null),separation=d3_layout_treeSeparation,size=[1,1],nodeSize=false;function cluster(d,i){var nodes=hierarchy.call(this,d,i),root=nodes[0],previousNode,x=0;d3_layout_hierarchyVisitAfter(root,function(node){var children=node.children;if(children&&children.length){node.x=d3_layout_clusterX(children);node.y=d3_layout_clusterY(children);}else{node.x=previousNode?x+=separation(node,previousNode):0;node.y=0;previousNode=node;}});var left=d3_layout_clusterLeft(root),right=d3_layout_clusterRight(root),x0=left.x-separation(left,right)/2,x1=right.x+separation(right,left)/2;d3_layout_hierarchyVisitAfter(root,nodeSize?function(node){node.x=(node.x-root.x)*size[0];node.y=(root.y-node.y)*size[1];}:function(node){node.x=(node.x-x0)/(x1-x0)*size[0];node.y=(1-(root.y?node.y/root.y:1))*size[1];});return nodes;}
cluster.separation=function(x){if(!arguments.length)return separation;separation=x;return cluster;};cluster.size=function(x){if(!arguments.length)return nodeSize?null:size;nodeSize=(size=x)==null;return cluster;};cluster.nodeSize=function(x){if(!arguments.length)return nodeSize?size:null;nodeSize=(size=x)!=null;return cluster;};return d3_layout_hierarchyRebind(cluster,hierarchy);};function d3_layout_clusterY(children){return 1+d3.max(children,function(child){return child.y;});}
function d3_layout_clusterX(children){return children.reduce(function(x,child){return x+child.x;},0)/children.length;}
function d3_layout_clusterLeft(node){var children=node.children;return children&&children.length?d3_layout_clusterLeft(children[0]):node;}
function d3_layout_clusterRight(node){var children=node.children,n;return children&&(n=children.length)?d3_layout_clusterRight(children[n-1]):node;}
d3.layout.treemap=function(){var hierarchy=d3.layout.hierarchy(),round=Math.round,size=[1,1],padding=null,pad=d3_layout_treemapPadNull,sticky=false,stickies,mode="squarify",ratio=.5*(1+Math.sqrt(5));function scale(children,k){var i=-1,n=children.length,child,area;while(++i<n){area=(child=children[i]).value*(k<0?0:k);child.area=isNaN(area)||area<=0?0:area;}}
function squarify(node){var children=node.children;if(children&&children.length){var rect=pad(node),row=[],remaining=children.slice(),child,best=Infinity,score,u=mode==="slice"?rect.dx:mode==="dice"?rect.dy:mode==="slice-dice"?node.depth&1?rect.dy:rect.dx:Math.min(rect.dx,rect.dy),n;scale(remaining,rect.dx*rect.dy/node.value);row.area=0;while((n=remaining.length)>0){row.push(child=remaining[n-1]);row.area+=child.area;if(mode!=="squarify"||(score=worst(row,u))<=best){remaining.pop();best=score;}else{row.area-=row.pop().area;position(row,u,rect,false);u=Math.min(rect.dx,rect.dy);row.length=row.area=0;best=Infinity;}}
if(row.length){position(row,u,rect,true);row.length=row.area=0;}
children.forEach(squarify);}}
function stickify(node){var children=node.children;if(children&&children.length){var rect=pad(node),remaining=children.slice(),child,row=[];scale(remaining,rect.dx*rect.dy/node.value);row.area=0;while(child=remaining.pop()){row.push(child);row.area+=child.area;if(child.z!=null){position(row,child.z?rect.dx:rect.dy,rect,!remaining.length);row.length=row.area=0;}}
children.forEach(stickify);}}
function worst(row,u){var s=row.area,r,rmax=0,rmin=Infinity,i=-1,n=row.length;while(++i<n){if(!(r=row[i].area))continue;if(r<rmin)rmin=r;if(r>rmax)rmax=r;}
s*=s;u*=u;return s?Math.max(u*rmax*ratio/s,s/(u*rmin*ratio)):Infinity;}
function position(row,u,rect,flush){var i=-1,n=row.length,x=rect.x,y=rect.y,v=u?round(row.area/u):0,o;if(u==rect.dx){if(flush||v>rect.dy)v=rect.dy;while(++i<n){o=row[i];o.x=x;o.y=y;o.dy=v;x+=o.dx=Math.min(rect.x+rect.dx-x,v?round(o.area/v):0);}
o.z=true;o.dx+=rect.x+rect.dx-x;rect.y+=v;rect.dy-=v;}else{if(flush||v>rect.dx)v=rect.dx;while(++i<n){o=row[i];o.x=x;o.y=y;o.dx=v;y+=o.dy=Math.min(rect.y+rect.dy-y,v?round(o.area/v):0);}
o.z=false;o.dy+=rect.y+rect.dy-y;rect.x+=v;rect.dx-=v;}}
function treemap(d){var nodes=stickies||hierarchy(d),root=nodes[0];root.x=0;root.y=0;root.dx=size[0];root.dy=size[1];if(stickies)hierarchy.revalue(root);scale([root],root.dx*root.dy/root.value);(stickies?stickify:squarify)(root);if(sticky)stickies=nodes;return nodes;}
treemap.size=function(x){if(!arguments.length)return size;size=x;return treemap;};treemap.padding=function(x){if(!arguments.length)return padding;function padFunction(node){var p=x.call(treemap,node,node.depth);return p==null?d3_layout_treemapPadNull(node):d3_layout_treemapPad(node,typeof p==="number"?[p,p,p,p]:p);}
function padConstant(node){return d3_layout_treemapPad(node,x);}
var type;pad=(padding=x)==null?d3_layout_treemapPadNull:(type=typeof x)==="function"?padFunction:type==="number"?(x=[x,x,x,x],padConstant):padConstant;return treemap;};treemap.round=function(x){if(!arguments.length)return round!=Number;round=x?Math.round:Number;return treemap;};treemap.sticky=function(x){if(!arguments.length)return sticky;sticky=x;stickies=null;return treemap;};treemap.ratio=function(x){if(!arguments.length)return ratio;ratio=x;return treemap;};treemap.mode=function(x){if(!arguments.length)return mode;mode=x+"";return treemap;};return d3_layout_hierarchyRebind(treemap,hierarchy);};function d3_layout_treemapPadNull(node){return{x:node.x,y:node.y,dx:node.dx,dy:node.dy};}
function d3_layout_treemapPad(node,padding){var x=node.x+padding[3],y=node.y+padding[0],dx=node.dx-padding[1]-padding[3],dy=node.dy-padding[0]-padding[2];if(dx<0){x+=dx/2;dx=0;}
if(dy<0){y+=dy/2;dy=0;}
return{x:x,y:y,dx:dx,dy:dy};}
d3.random={normal:function(µ,σ){var n=arguments.length;if(n<2)σ=1;if(n<1)µ=0;return function(){var x,y,r;do{x=Math.random()*2-1;y=Math.random()*2-1;r=x*x+y*y;}while(!r||r>1);return µ+σ*x*Math.sqrt(-2*Math.log(r)/r);};},logNormal:function(){var random=d3.random.normal.apply(d3,arguments);return function(){return Math.exp(random());};},bates:function(m){var random=d3.random.irwinHall(m);return function(){return random()/m;};},irwinHall:function(m){return function(){for(var s=0,j=0;j<m;j++)s+=Math.random();return s;};}};d3.scale={};function d3_scaleExtent(domain){var start=domain[0],stop=domain[domain.length-1];return start<stop?[start,stop]:[stop,start];}
function d3_scaleRange(scale){return scale.rangeExtent?scale.rangeExtent():d3_scaleExtent(scale.range());}
function d3_scale_bilinear(domain,range,uninterpolate,interpolate){var u=uninterpolate(domain[0],domain[1]),i=interpolate(range[0],range[1]);return function(x){return i(u(x));};}
function d3_scale_nice(domain,nice){var i0=0,i1=domain.length-1,x0=domain[i0],x1=domain[i1],dx;if(x1<x0){dx=i0,i0=i1,i1=dx;dx=x0,x0=x1,x1=dx;}
domain[i0]=nice.floor(x0);domain[i1]=nice.ceil(x1);return domain;}
function d3_scale_niceStep(step){return step?{floor:function(x){return Math.floor(x/step)*step;},ceil:function(x){return Math.ceil(x/step)*step;}}:d3_scale_niceIdentity;}
var d3_scale_niceIdentity={floor:d3_identity,ceil:d3_identity};function d3_scale_polylinear(domain,range,uninterpolate,interpolate){var u=[],i=[],j=0,k=Math.min(domain.length,range.length)-1;if(domain[k]<domain[0]){domain=domain.slice().reverse();range=range.slice().reverse();}
while(++j<=k){u.push(uninterpolate(domain[j-1],domain[j]));i.push(interpolate(range[j-1],range[j]));}
return function(x){var j=d3.bisect(domain,x,1,k)-1;return i[j](u[j](x));};}
d3.scale.linear=function(){return d3_scale_linear([0,1],[0,1],d3_interpolate,false);};function d3_scale_linear(domain,range,interpolate,clamp){var output,input;function rescale(){var linear=Math.min(domain.length,range.length)>2?d3_scale_polylinear:d3_scale_bilinear,uninterpolate=clamp?d3_uninterpolateClamp:d3_uninterpolateNumber;output=linear(domain,range,uninterpolate,interpolate);input=linear(range,domain,uninterpolate,d3_interpolate);return scale;}
function scale(x){return output(x);}
scale.invert=function(y){return input(y);};scale.domain=function(x){if(!arguments.length)return domain;domain=x.map(Number);return rescale();};scale.range=function(x){if(!arguments.length)return range;range=x;return rescale();};scale.rangeRound=function(x){return scale.range(x).interpolate(d3_interpolateRound);};scale.clamp=function(x){if(!arguments.length)return clamp;clamp=x;return rescale();};scale.interpolate=function(x){if(!arguments.length)return interpolate;interpolate=x;return rescale();};scale.ticks=function(m){return d3_scale_linearTicks(domain,m);};scale.tickFormat=function(m,format){return d3_scale_linearTickFormat(domain,m,format);};scale.nice=function(m){d3_scale_linearNice(domain,m);return rescale();};scale.copy=function(){return d3_scale_linear(domain,range,interpolate,clamp);};return rescale();}
function d3_scale_linearRebind(scale,linear){return d3.rebind(scale,linear,"range","rangeRound","interpolate","clamp");}
function d3_scale_linearNice(domain,m){return d3_scale_nice(domain,d3_scale_niceStep(d3_scale_linearTickRange(domain,m)[2]));}
function d3_scale_linearTickRange(domain,m){if(m==null)m=10;var extent=d3_scaleExtent(domain),span=extent[1]-extent[0],step=Math.pow(10,Math.floor(Math.log(span/m)/Math.LN10)),err=m/span*step;if(err<=.15)step*=10;else if(err<=.35)step*=5;else if(err<=.75)step*=2;extent[0]=Math.ceil(extent[0]/step)*step;extent[1]=Math.floor(extent[1]/step)*step+step*.5;extent[2]=step;return extent;}
function d3_scale_linearTicks(domain,m){return d3.range.apply(d3,d3_scale_linearTickRange(domain,m));}
function d3_scale_linearTickFormat(domain,m,format){var range=d3_scale_linearTickRange(domain,m);if(format){var match=d3_format_re.exec(format);match.shift();if(match[8]==="s"){var prefix=d3.formatPrefix(Math.max(abs(range[0]),abs(range[1])));if(!match[7])match[7]="."+d3_scale_linearPrecision(prefix.scale(range[2]));match[8]="f";format=d3.format(match.join(""));return function(d){return format(prefix.scale(d))+prefix.symbol;};}
if(!match[7])match[7]="."+d3_scale_linearFormatPrecision(match[8],range);format=match.join("");}else{format=",."+d3_scale_linearPrecision(range[2])+"f";}
return d3.format(format);}
var d3_scale_linearFormatSignificant={s:1,g:1,p:1,r:1,e:1};function d3_scale_linearPrecision(value){return-Math.floor(Math.log(value)/Math.LN10+.01);}
function d3_scale_linearFormatPrecision(type,range){var p=d3_scale_linearPrecision(range[2]);return type in d3_scale_linearFormatSignificant?Math.abs(p-d3_scale_linearPrecision(Math.max(abs(range[0]),abs(range[1]))))+ +(type!=="e"):p-(type==="%")*2;}
d3.scale.log=function(){return d3_scale_log(d3.scale.linear().domain([0,1]),10,true,[1,10]);};function d3_scale_log(linear,base,positive,domain){function log(x){return(positive?Math.log(x<0?0:x):-Math.log(x>0?0:-x))/Math.log(base);}
function pow(x){return positive?Math.pow(base,x):-Math.pow(base,-x);}
function scale(x){return linear(log(x));}
scale.invert=function(x){return pow(linear.invert(x));};scale.domain=function(x){if(!arguments.length)return domain;positive=x[0]>=0;linear.domain((domain=x.map(Number)).map(log));return scale;};scale.base=function(_){if(!arguments.length)return base;base=+_;linear.domain(domain.map(log));return scale;};scale.nice=function(){var niced=d3_scale_nice(domain.map(log),positive?Math:d3_scale_logNiceNegative);linear.domain(niced);domain=niced.map(pow);return scale;};scale.ticks=function(){var extent=d3_scaleExtent(domain),ticks=[],u=extent[0],v=extent[1],i=Math.floor(log(u)),j=Math.ceil(log(v)),n=base%1?2:base;if(isFinite(j-i)){if(positive){for(;i<j;i++)for(var k=1;k<n;k++)ticks.push(pow(i)*k);ticks.push(pow(i));}else{ticks.push(pow(i));for(;i++<j;)for(var k=n-1;k>0;k--)ticks.push(pow(i)*k);}
for(i=0;ticks[i]<u;i++){}
for(j=ticks.length;ticks[j-1]>v;j--){}
ticks=ticks.slice(i,j);}
return ticks;};scale.tickFormat=function(n,format){if(!arguments.length)return d3_scale_logFormat;if(arguments.length<2)format=d3_scale_logFormat;else if(typeof format!=="function")format=d3.format(format);var k=Math.max(.1,n/scale.ticks().length),f=positive?(e=1e-12,Math.ceil):(e=-1e-12,Math.floor),e;return function(d){return d/pow(f(log(d)+e))<=k?format(d):"";};};scale.copy=function(){return d3_scale_log(linear.copy(),base,positive,domain);};return d3_scale_linearRebind(scale,linear);}
var d3_scale_logFormat=d3.format(".0e"),d3_scale_logNiceNegative={floor:function(x){return-Math.ceil(-x);},ceil:function(x){return-Math.floor(-x);}};d3.scale.pow=function(){return d3_scale_pow(d3.scale.linear(),1,[0,1]);};function d3_scale_pow(linear,exponent,domain){var powp=d3_scale_powPow(exponent),powb=d3_scale_powPow(1/exponent);function scale(x){return linear(powp(x));}
scale.invert=function(x){return powb(linear.invert(x));};scale.domain=function(x){if(!arguments.length)return domain;linear.domain((domain=x.map(Number)).map(powp));return scale;};scale.ticks=function(m){return d3_scale_linearTicks(domain,m);};scale.tickFormat=function(m,format){return d3_scale_linearTickFormat(domain,m,format);};scale.nice=function(m){return scale.domain(d3_scale_linearNice(domain,m));};scale.exponent=function(x){if(!arguments.length)return exponent;powp=d3_scale_powPow(exponent=x);powb=d3_scale_powPow(1/exponent);linear.domain(domain.map(powp));return scale;};scale.copy=function(){return d3_scale_pow(linear.copy(),exponent,domain);};return d3_scale_linearRebind(scale,linear);}
function d3_scale_powPow(e){return function(x){return x<0?-Math.pow(-x,e):Math.pow(x,e);};}
d3.scale.sqrt=function(){return d3.scale.pow().exponent(.5);};d3.scale.ordinal=function(){return d3_scale_ordinal([],{t:"range",a:[[]]});};function d3_scale_ordinal(domain,ranger){var index,range,rangeBand;function scale(x){return range[((index.get(x)||(ranger.t==="range"?index.set(x,domain.push(x)):NaN))-1)%range.length];}
function steps(start,step){return d3.range(domain.length).map(function(i){return start+step*i;});}
scale.domain=function(x){if(!arguments.length)return domain;domain=[];index=new d3_Map();var i=-1,n=x.length,xi;while(++i<n)if(!index.has(xi=x[i]))index.set(xi,domain.push(xi));return scale[ranger.t].apply(scale,ranger.a);};scale.range=function(x){if(!arguments.length)return range;range=x;rangeBand=0;ranger={t:"range",a:arguments};return scale;};scale.rangePoints=function(x,padding){if(arguments.length<2)padding=0;var start=x[0],stop=x[1],step=domain.length<2?(start=(start+stop)/2,0):(stop-start)/(domain.length-1+padding);range=steps(start+step*padding/2,step);rangeBand=0;ranger={t:"rangePoints",a:arguments};return scale;};scale.rangeRoundPoints=function(x,padding){if(arguments.length<2)padding=0;var start=x[0],stop=x[1],step=domain.length<2?(start=stop=Math.round((start+stop)/2),0):(stop-start)/(domain.length-1+padding)|0;range=steps(start+Math.round(step*padding/2+(stop-start-(domain.length-1+padding)*step)/2),step);rangeBand=0;ranger={t:"rangeRoundPoints",a:arguments};return scale;};scale.rangeBands=function(x,padding,outerPadding){if(arguments.length<2)padding=0;if(arguments.length<3)outerPadding=padding;var reverse=x[1]<x[0],start=x[reverse-0],stop=x[1-reverse],step=(stop-start)/(domain.length-padding+2*outerPadding);range=steps(start+step*outerPadding,step);if(reverse)range.reverse();rangeBand=step*(1-padding);ranger={t:"rangeBands",a:arguments};return scale;};scale.rangeRoundBands=function(x,padding,outerPadding){if(arguments.length<2)padding=0;if(arguments.length<3)outerPadding=padding;var reverse=x[1]<x[0],start=x[reverse-0],stop=x[1-reverse],step=Math.floor((stop-start)/(domain.length-padding+2*outerPadding));range=steps(start+Math.round((stop-start-(domain.length-padding)*step)/2),step);if(reverse)range.reverse();rangeBand=Math.round(step*(1-padding));ranger={t:"rangeRoundBands",a:arguments};return scale;};scale.rangeBand=function(){return rangeBand;};scale.rangeExtent=function(){return d3_scaleExtent(ranger.a[0]);};scale.copy=function(){return d3_scale_ordinal(domain,ranger);};return scale.domain(domain);}
d3.scale.category10=function(){return d3.scale.ordinal().range(d3_category10);};d3.scale.category20=function(){return d3.scale.ordinal().range(d3_category20);};d3.scale.category20b=function(){return d3.scale.ordinal().range(d3_category20b);};d3.scale.category20c=function(){return d3.scale.ordinal().range(d3_category20c);};var d3_category10=[2062260,16744206,2924588,14034728,9725885,9197131,14907330,8355711,12369186,1556175].map(d3_rgbString);var d3_category20=[2062260,11454440,16744206,16759672,2924588,10018698,14034728,16750742,9725885,12955861,9197131,12885140,14907330,16234194,8355711,13092807,12369186,14408589,1556175,10410725].map(d3_rgbString);var d3_category20b=[3750777,5395619,7040719,10264286,6519097,9216594,11915115,13556636,9202993,12426809,15186514,15190932,8666169,11356490,14049643,15177372,8077683,10834324,13528509,14589654].map(d3_rgbString);var d3_category20c=[3244733,7057110,10406625,13032431,15095053,16616764,16625259,16634018,3253076,7652470,10607003,13101504,7695281,10394312,12369372,14342891,6513507,9868950,12434877,14277081].map(d3_rgbString);d3.scale.quantile=function(){return d3_scale_quantile([],[]);};function d3_scale_quantile(domain,range){var thresholds;function rescale(){var k=0,q=range.length;thresholds=[];while(++k<q)thresholds[k-1]=d3.quantile(domain,k/q);return scale;}
function scale(x){if(!isNaN(x=+x))return range[d3.bisect(thresholds,x)];}
scale.domain=function(x){if(!arguments.length)return domain;domain=x.map(d3_number).filter(d3_numeric).sort(d3_ascending);return rescale();};scale.range=function(x){if(!arguments.length)return range;range=x;return rescale();};scale.quantiles=function(){return thresholds;};scale.invertExtent=function(y){y=range.indexOf(y);return y<0?[NaN,NaN]:[y>0?thresholds[y-1]:domain[0],y<thresholds.length?thresholds[y]:domain[domain.length-1]];};scale.copy=function(){return d3_scale_quantile(domain,range);};return rescale();}
d3.scale.quantize=function(){return d3_scale_quantize(0,1,[0,1]);};function d3_scale_quantize(x0,x1,range){var kx,i;function scale(x){return range[Math.max(0,Math.min(i,Math.floor(kx*(x-x0))))];}
function rescale(){kx=range.length/(x1-x0);i=range.length-1;return scale;}
scale.domain=function(x){if(!arguments.length)return[x0,x1];x0=+x[0];x1=+x[x.length-1];return rescale();};scale.range=function(x){if(!arguments.length)return range;range=x;return rescale();};scale.invertExtent=function(y){y=range.indexOf(y);y=y<0?NaN:y/kx+x0;return[y,y+1/kx];};scale.copy=function(){return d3_scale_quantize(x0,x1,range);};return rescale();}
d3.scale.threshold=function(){return d3_scale_threshold([.5],[0,1]);};function d3_scale_threshold(domain,range){function scale(x){if(x<=x)return range[d3.bisect(domain,x)];}
scale.domain=function(_){if(!arguments.length)return domain;domain=_;return scale;};scale.range=function(_){if(!arguments.length)return range;range=_;return scale;};scale.invertExtent=function(y){y=range.indexOf(y);return[domain[y-1],domain[y]];};scale.copy=function(){return d3_scale_threshold(domain,range);};return scale;}
d3.scale.identity=function(){return d3_scale_identity([0,1]);};function d3_scale_identity(domain){function identity(x){return+x;}
identity.invert=identity;identity.domain=identity.range=function(x){if(!arguments.length)return domain;domain=x.map(identity);return identity;};identity.ticks=function(m){return d3_scale_linearTicks(domain,m);};identity.tickFormat=function(m,format){return d3_scale_linearTickFormat(domain,m,format);};identity.copy=function(){return d3_scale_identity(domain);};return identity;}
d3.svg={};function d3_zero(){return 0;}
d3.svg.arc=function(){var innerRadius=d3_svg_arcInnerRadius,outerRadius=d3_svg_arcOuterRadius,cornerRadius=d3_zero,padRadius=d3_svg_arcAuto,startAngle=d3_svg_arcStartAngle,endAngle=d3_svg_arcEndAngle,padAngle=d3_svg_arcPadAngle;function arc(){var r0=Math.max(0,+innerRadius.apply(this,arguments)),r1=Math.max(0,+outerRadius.apply(this,arguments)),a0=startAngle.apply(this,arguments)-halfπ,a1=endAngle.apply(this,arguments)-halfπ,da=Math.abs(a1-a0),cw=a0>a1?0:1;if(r1<r0)rc=r1,r1=r0,r0=rc;if(da>=τε)return circleSegment(r1,cw)+(r0?circleSegment(r0,1-cw):"")+"Z";var rc,cr,rp,ap,p0=0,p1=0,x0,y0,x1,y1,x2,y2,x3,y3,path=[];if(ap=(+padAngle.apply(this,arguments)||0)/2){rp=padRadius===d3_svg_arcAuto?Math.sqrt(r0*r0+r1*r1):+padRadius.apply(this,arguments);if(!cw)p1*=-1;if(r1)p1=d3_asin(rp/r1*Math.sin(ap));if(r0)p0=d3_asin(rp/r0*Math.sin(ap));}
if(r1){x0=r1*Math.cos(a0+p1);y0=r1*Math.sin(a0+p1);x1=r1*Math.cos(a1-p1);y1=r1*Math.sin(a1-p1);var l1=Math.abs(a1-a0-2*p1)<=π?0:1;if(p1&&d3_svg_arcSweep(x0,y0,x1,y1)===cw^l1){var h1=(a0+a1)/2;x0=r1*Math.cos(h1);y0=r1*Math.sin(h1);x1=y1=null;}}else{x0=y0=0;}
if(r0){x2=r0*Math.cos(a1-p0);y2=r0*Math.sin(a1-p0);x3=r0*Math.cos(a0+p0);y3=r0*Math.sin(a0+p0);var l0=Math.abs(a0-a1+2*p0)<=π?0:1;if(p0&&d3_svg_arcSweep(x2,y2,x3,y3)===1-cw^l0){var h0=(a0+a1)/2;x2=r0*Math.cos(h0);y2=r0*Math.sin(h0);x3=y3=null;}}else{x2=y2=0;}
if((rc=Math.min(Math.abs(r1-r0)/2,+cornerRadius.apply(this,arguments)))>.001){cr=r0<r1^cw?0:1;var oc=x3==null?[x2,y2]:x1==null?[x0,y0]:d3_geom_polygonIntersect([x0,y0],[x3,y3],[x1,y1],[x2,y2]),ax=x0-oc[0],ay=y0-oc[1],bx=x1-oc[0],by=y1-oc[1],kc=1/Math.sin(Math.acos((ax*bx+ay*by)/(Math.sqrt(ax*ax+ay*ay)*Math.sqrt(bx*bx+by*by)))/2),lc=Math.sqrt(oc[0]*oc[0]+oc[1]*oc[1]);if(x1!=null){var rc1=Math.min(rc,(r1-lc)/(kc+1)),t30=d3_svg_arcCornerTangents(x3==null?[x2,y2]:[x3,y3],[x0,y0],r1,rc1,cw),t12=d3_svg_arcCornerTangents([x1,y1],[x2,y2],r1,rc1,cw);if(rc===rc1){path.push("M",t30[0],"A",rc1,",",rc1," 0 0,",cr," ",t30[1],"A",r1,",",r1," 0 ",1-cw^d3_svg_arcSweep(t30[1][0],t30[1][1],t12[1][0],t12[1][1]),",",cw," ",t12[1],"A",rc1,",",rc1," 0 0,",cr," ",t12[0]);}else{path.push("M",t30[0],"A",rc1,",",rc1," 0 1,",cr," ",t12[0]);}}else{path.push("M",x0,",",y0);}
if(x3!=null){var rc0=Math.min(rc,(r0-lc)/(kc-1)),t03=d3_svg_arcCornerTangents([x0,y0],[x3,y3],r0,-rc0,cw),t21=d3_svg_arcCornerTangents([x2,y2],x1==null?[x0,y0]:[x1,y1],r0,-rc0,cw);if(rc===rc0){path.push("L",t21[0],"A",rc0,",",rc0," 0 0,",cr," ",t21[1],"A",r0,",",r0," 0 ",cw^d3_svg_arcSweep(t21[1][0],t21[1][1],t03[1][0],t03[1][1]),",",1-cw," ",t03[1],"A",rc0,",",rc0," 0 0,",cr," ",t03[0]);}else{path.push("L",t21[0],"A",rc0,",",rc0," 0 0,",cr," ",t03[0]);}}else{path.push("L",x2,",",y2);}}else{path.push("M",x0,",",y0);if(x1!=null)path.push("A",r1,",",r1," 0 ",l1,",",cw," ",x1,",",y1);path.push("L",x2,",",y2);if(x3!=null)path.push("A",r0,",",r0," 0 ",l0,",",1-cw," ",x3,",",y3);}
path.push("Z");return path.join("");}
function circleSegment(r1,cw){return"M0,"+r1+"A"+r1+","+r1+" 0 1,"+cw+" 0,"+-r1+"A"+r1+","+r1+" 0 1,"+cw+" 0,"+r1;}
arc.innerRadius=function(v){if(!arguments.length)return innerRadius;innerRadius=d3_functor(v);return arc;};arc.outerRadius=function(v){if(!arguments.length)return outerRadius;outerRadius=d3_functor(v);return arc;};arc.cornerRadius=function(v){if(!arguments.length)return cornerRadius;cornerRadius=d3_functor(v);return arc;};arc.padRadius=function(v){if(!arguments.length)return padRadius;padRadius=v==d3_svg_arcAuto?d3_svg_arcAuto:d3_functor(v);return arc;};arc.startAngle=function(v){if(!arguments.length)return startAngle;startAngle=d3_functor(v);return arc;};arc.endAngle=function(v){if(!arguments.length)return endAngle;endAngle=d3_functor(v);return arc;};arc.padAngle=function(v){if(!arguments.length)return padAngle;padAngle=d3_functor(v);return arc;};arc.centroid=function(){var r=(+innerRadius.apply(this,arguments)+ +outerRadius.apply(this,arguments))/2,a=(+startAngle.apply(this,arguments)+ +endAngle.apply(this,arguments))/2-halfπ;return[Math.cos(a)*r,Math.sin(a)*r];};return arc;};var d3_svg_arcAuto="auto";function d3_svg_arcInnerRadius(d){return d.innerRadius;}
function d3_svg_arcOuterRadius(d){return d.outerRadius;}
function d3_svg_arcStartAngle(d){return d.startAngle;}
function d3_svg_arcEndAngle(d){return d.endAngle;}
function d3_svg_arcPadAngle(d){return d&&d.padAngle;}
function d3_svg_arcSweep(x0,y0,x1,y1){return(x0-x1)*y0-(y0-y1)*x0>0?0:1;}
function d3_svg_arcCornerTangents(p0,p1,r1,rc,cw){var x01=p0[0]-p1[0],y01=p0[1]-p1[1],lo=(cw?rc:-rc)/Math.sqrt(x01*x01+y01*y01),ox=lo*y01,oy=-lo*x01,x1=p0[0]+ox,y1=p0[1]+oy,x2=p1[0]+ox,y2=p1[1]+oy,x3=(x1+x2)/2,y3=(y1+y2)/2,dx=x2-x1,dy=y2-y1,d2=dx*dx+dy*dy,r=r1-rc,D=x1*y2-x2*y1,d=(dy<0?-1:1)*Math.sqrt(r*r*d2-D*D),cx0=(D*dy-dx*d)/d2,cy0=(-D*dx-dy*d)/d2,cx1=(D*dy+dx*d)/d2,cy1=(-D*dx+dy*d)/d2,dx0=cx0-x3,dy0=cy0-y3,dx1=cx1-x3,dy1=cy1-y3;if(dx0*dx0+dy0*dy0>dx1*dx1+dy1*dy1)cx0=cx1,cy0=cy1;return[[cx0-ox,cy0-oy],[cx0*r1/r,cy0*r1/r]];}
function d3_svg_line(projection){var x=d3_geom_pointX,y=d3_geom_pointY,defined=d3_true,interpolate=d3_svg_lineLinear,interpolateKey=interpolate.key,tension=.7;function line(data){var segments=[],points=[],i=-1,n=data.length,d,fx=d3_functor(x),fy=d3_functor(y);function segment(){segments.push("M",interpolate(projection(points),tension));}
while(++i<n){if(defined.call(this,d=data[i],i)){points.push([+fx.call(this,d,i),+fy.call(this,d,i)]);}else if(points.length){segment();points=[];}}
if(points.length)segment();return segments.length?segments.join(""):null;}
line.x=function(_){if(!arguments.length)return x;x=_;return line;};line.y=function(_){if(!arguments.length)return y;y=_;return line;};line.defined=function(_){if(!arguments.length)return defined;defined=_;return line;};line.interpolate=function(_){if(!arguments.length)return interpolateKey;if(typeof _==="function")interpolateKey=interpolate=_;else interpolateKey=(interpolate=d3_svg_lineInterpolators.get(_)||d3_svg_lineLinear).key;return line;};line.tension=function(_){if(!arguments.length)return tension;tension=_;return line;};return line;}
d3.svg.line=function(){return d3_svg_line(d3_identity);};var d3_svg_lineInterpolators=d3.map({linear:d3_svg_lineLinear,"linear-closed":d3_svg_lineLinearClosed,step:d3_svg_lineStep,"step-before":d3_svg_lineStepBefore,"step-after":d3_svg_lineStepAfter,basis:d3_svg_lineBasis,"basis-open":d3_svg_lineBasisOpen,"basis-closed":d3_svg_lineBasisClosed,bundle:d3_svg_lineBundle,cardinal:d3_svg_lineCardinal,"cardinal-open":d3_svg_lineCardinalOpen,"cardinal-closed":d3_svg_lineCardinalClosed,monotone:d3_svg_lineMonotone});d3_svg_lineInterpolators.forEach(function(key,value){value.key=key;value.closed=/-closed$/.test(key);});function d3_svg_lineLinear(points){return points.join("L");}
function d3_svg_lineLinearClosed(points){return d3_svg_lineLinear(points)+"Z";}
function d3_svg_lineStep(points){var i=0,n=points.length,p=points[0],path=[p[0],",",p[1]];while(++i<n)path.push("H",(p[0]+(p=points[i])[0])/2,"V",p[1]);if(n>1)path.push("H",p[0]);return path.join("");}
function d3_svg_lineStepBefore(points){var i=0,n=points.length,p=points[0],path=[p[0],",",p[1]];while(++i<n)path.push("V",(p=points[i])[1],"H",p[0]);return path.join("");}
function d3_svg_lineStepAfter(points){var i=0,n=points.length,p=points[0],path=[p[0],",",p[1]];while(++i<n)path.push("H",(p=points[i])[0],"V",p[1]);return path.join("");}
function d3_svg_lineCardinalOpen(points,tension){return points.length<4?d3_svg_lineLinear(points):points[1]+d3_svg_lineHermite(points.slice(1,-1),d3_svg_lineCardinalTangents(points,tension));}
function d3_svg_lineCardinalClosed(points,tension){return points.length<3?d3_svg_lineLinear(points):points[0]+d3_svg_lineHermite((points.push(points[0]),points),d3_svg_lineCardinalTangents([points[points.length-2]].concat(points,[points[1]]),tension));}
function d3_svg_lineCardinal(points,tension){return points.length<3?d3_svg_lineLinear(points):points[0]+d3_svg_lineHermite(points,d3_svg_lineCardinalTangents(points,tension));}
function d3_svg_lineHermite(points,tangents){if(tangents.length<1||points.length!=tangents.length&&points.length!=tangents.length+2){return d3_svg_lineLinear(points);}
var quad=points.length!=tangents.length,path="",p0=points[0],p=points[1],t0=tangents[0],t=t0,pi=1;if(quad){path+="Q"+(p[0]-t0[0]*2/3)+","+(p[1]-t0[1]*2/3)+","+p[0]+","+p[1];p0=points[1];pi=2;}
if(tangents.length>1){t=tangents[1];p=points[pi];pi++;path+="C"+(p0[0]+t0[0])+","+(p0[1]+t0[1])+","+(p[0]-t[0])+","+(p[1]-t[1])+","+p[0]+","+p[1];for(var i=2;i<tangents.length;i++,pi++){p=points[pi];t=tangents[i];path+="S"+(p[0]-t[0])+","+(p[1]-t[1])+","+p[0]+","+p[1];}}
if(quad){var lp=points[pi];path+="Q"+(p[0]+t[0]*2/3)+","+(p[1]+t[1]*2/3)+","+lp[0]+","+lp[1];}
return path;}
function d3_svg_lineCardinalTangents(points,tension){var tangents=[],a=(1-tension)/2,p0,p1=points[0],p2=points[1],i=1,n=points.length;while(++i<n){p0=p1;p1=p2;p2=points[i];tangents.push([a*(p2[0]-p0[0]),a*(p2[1]-p0[1])]);}
return tangents;}
function d3_svg_lineBasis(points){if(points.length<3)return d3_svg_lineLinear(points);var i=1,n=points.length,pi=points[0],x0=pi[0],y0=pi[1],px=[x0,x0,x0,(pi=points[1])[0]],py=[y0,y0,y0,pi[1]],path=[x0,",",y0,"L",d3_svg_lineDot4(d3_svg_lineBasisBezier3,px),",",d3_svg_lineDot4(d3_svg_lineBasisBezier3,py)];points.push(points[n-1]);while(++i<=n){pi=points[i];px.shift();px.push(pi[0]);py.shift();py.push(pi[1]);d3_svg_lineBasisBezier(path,px,py);}
points.pop();path.push("L",pi);return path.join("");}
function d3_svg_lineBasisOpen(points){if(points.length<4)return d3_svg_lineLinear(points);var path=[],i=-1,n=points.length,pi,px=[0],py=[0];while(++i<3){pi=points[i];px.push(pi[0]);py.push(pi[1]);}
path.push(d3_svg_lineDot4(d3_svg_lineBasisBezier3,px)+","+d3_svg_lineDot4(d3_svg_lineBasisBezier3,py));--i;while(++i<n){pi=points[i];px.shift();px.push(pi[0]);py.shift();py.push(pi[1]);d3_svg_lineBasisBezier(path,px,py);}
return path.join("");}
function d3_svg_lineBasisClosed(points){var path,i=-1,n=points.length,m=n+4,pi,px=[],py=[];while(++i<4){pi=points[i%n];px.push(pi[0]);py.push(pi[1]);}
path=[d3_svg_lineDot4(d3_svg_lineBasisBezier3,px),",",d3_svg_lineDot4(d3_svg_lineBasisBezier3,py)];--i;while(++i<m){pi=points[i%n];px.shift();px.push(pi[0]);py.shift();py.push(pi[1]);d3_svg_lineBasisBezier(path,px,py);}
return path.join("");}
function d3_svg_lineBundle(points,tension){var n=points.length-1;if(n){var x0=points[0][0],y0=points[0][1],dx=points[n][0]-x0,dy=points[n][1]-y0,i=-1,p,t;while(++i<=n){p=points[i];t=i/n;p[0]=tension*p[0]+(1-tension)*(x0+t*dx);p[1]=tension*p[1]+(1-tension)*(y0+t*dy);}}
return d3_svg_lineBasis(points);}
function d3_svg_lineDot4(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3];}
var d3_svg_lineBasisBezier1=[0,2/3,1/3,0],d3_svg_lineBasisBezier2=[0,1/3,2/3,0],d3_svg_lineBasisBezier3=[0,1/6,2/3,1/6];function d3_svg_lineBasisBezier(path,x,y){path.push("C",d3_svg_lineDot4(d3_svg_lineBasisBezier1,x),",",d3_svg_lineDot4(d3_svg_lineBasisBezier1,y),",",d3_svg_lineDot4(d3_svg_lineBasisBezier2,x),",",d3_svg_lineDot4(d3_svg_lineBasisBezier2,y),",",d3_svg_lineDot4(d3_svg_lineBasisBezier3,x),",",d3_svg_lineDot4(d3_svg_lineBasisBezier3,y));}
function d3_svg_lineSlope(p0,p1){return(p1[1]-p0[1])/(p1[0]-p0[0]);}
function d3_svg_lineFiniteDifferences(points){var i=0,j=points.length-1,m=[],p0=points[0],p1=points[1],d=m[0]=d3_svg_lineSlope(p0,p1);while(++i<j){m[i]=(d+(d=d3_svg_lineSlope(p0=p1,p1=points[i+1])))/2;}
m[i]=d;return m;}
function d3_svg_lineMonotoneTangents(points){var tangents=[],d,a,b,s,m=d3_svg_lineFiniteDifferences(points),i=-1,j=points.length-1;while(++i<j){d=d3_svg_lineSlope(points[i],points[i+1]);if(abs(d)<ε){m[i]=m[i+1]=0;}else{a=m[i]/d;b=m[i+1]/d;s=a*a+b*b;if(s>9){s=d*3/Math.sqrt(s);m[i]=s*a;m[i+1]=s*b;}}}
i=-1;while(++i<=j){s=(points[Math.min(j,i+1)][0]-points[Math.max(0,i-1)][0])/(6*(1+m[i]*m[i]));tangents.push([s||0,m[i]*s||0]);}
return tangents;}
function d3_svg_lineMonotone(points){return points.length<3?d3_svg_lineLinear(points):points[0]+d3_svg_lineHermite(points,d3_svg_lineMonotoneTangents(points));}
d3.svg.line.radial=function(){var line=d3_svg_line(d3_svg_lineRadial);line.radius=line.x,delete line.x;line.angle=line.y,delete line.y;return line;};function d3_svg_lineRadial(points){var point,i=-1,n=points.length,r,a;while(++i<n){point=points[i];r=point[0];a=point[1]-halfπ;point[0]=r*Math.cos(a);point[1]=r*Math.sin(a);}
return points;}
function d3_svg_area(projection){var x0=d3_geom_pointX,x1=d3_geom_pointX,y0=0,y1=d3_geom_pointY,defined=d3_true,interpolate=d3_svg_lineLinear,interpolateKey=interpolate.key,interpolateReverse=interpolate,L="L",tension=.7;function area(data){var segments=[],points0=[],points1=[],i=-1,n=data.length,d,fx0=d3_functor(x0),fy0=d3_functor(y0),fx1=x0===x1?function(){return x;}:d3_functor(x1),fy1=y0===y1?function(){return y;}:d3_functor(y1),x,y;function segment(){segments.push("M",interpolate(projection(points1),tension),L,interpolateReverse(projection(points0.reverse()),tension),"Z");}
while(++i<n){if(defined.call(this,d=data[i],i)){points0.push([x=+fx0.call(this,d,i),y=+fy0.call(this,d,i)]);points1.push([+fx1.call(this,d,i),+fy1.call(this,d,i)]);}else if(points0.length){segment();points0=[];points1=[];}}
if(points0.length)segment();return segments.length?segments.join(""):null;}
area.x=function(_){if(!arguments.length)return x1;x0=x1=_;return area;};area.x0=function(_){if(!arguments.length)return x0;x0=_;return area;};area.x1=function(_){if(!arguments.length)return x1;x1=_;return area;};area.y=function(_){if(!arguments.length)return y1;y0=y1=_;return area;};area.y0=function(_){if(!arguments.length)return y0;y0=_;return area;};area.y1=function(_){if(!arguments.length)return y1;y1=_;return area;};area.defined=function(_){if(!arguments.length)return defined;defined=_;return area;};area.interpolate=function(_){if(!arguments.length)return interpolateKey;if(typeof _==="function")interpolateKey=interpolate=_;else interpolateKey=(interpolate=d3_svg_lineInterpolators.get(_)||d3_svg_lineLinear).key;interpolateReverse=interpolate.reverse||interpolate;L=interpolate.closed?"M":"L";return area;};area.tension=function(_){if(!arguments.length)return tension;tension=_;return area;};return area;}
d3_svg_lineStepBefore.reverse=d3_svg_lineStepAfter;d3_svg_lineStepAfter.reverse=d3_svg_lineStepBefore;d3.svg.area=function(){return d3_svg_area(d3_identity);};d3.svg.area.radial=function(){var area=d3_svg_area(d3_svg_lineRadial);area.radius=area.x,delete area.x;area.innerRadius=area.x0,delete area.x0;area.outerRadius=area.x1,delete area.x1;area.angle=area.y,delete area.y;area.startAngle=area.y0,delete area.y0;area.endAngle=area.y1,delete area.y1;return area;};d3.svg.chord=function(){var source=d3_source,target=d3_target,radius=d3_svg_chordRadius,startAngle=d3_svg_arcStartAngle,endAngle=d3_svg_arcEndAngle;function chord(d,i){var s=subgroup(this,source,d,i),t=subgroup(this,target,d,i);return"M"+s.p0+arc(s.r,s.p1,s.a1-s.a0)+(equals(s,t)?curve(s.r,s.p1,s.r,s.p0):curve(s.r,s.p1,t.r,t.p0)+arc(t.r,t.p1,t.a1-t.a0)+curve(t.r,t.p1,s.r,s.p0))+"Z";}
function subgroup(self,f,d,i){var subgroup=f.call(self,d,i),r=radius.call(self,subgroup,i),a0=startAngle.call(self,subgroup,i)-halfπ,a1=endAngle.call(self,subgroup,i)-halfπ;return{r:r,a0:a0,a1:a1,p0:[r*Math.cos(a0),r*Math.sin(a0)],p1:[r*Math.cos(a1),r*Math.sin(a1)]};}
function equals(a,b){return a.a0==b.a0&&a.a1==b.a1;}
function arc(r,p,a){return"A"+r+","+r+" 0 "+ +(a>π)+",1 "+p;}
function curve(r0,p0,r1,p1){return"Q 0,0 "+p1;}
chord.radius=function(v){if(!arguments.length)return radius;radius=d3_functor(v);return chord;};chord.source=function(v){if(!arguments.length)return source;source=d3_functor(v);return chord;};chord.target=function(v){if(!arguments.length)return target;target=d3_functor(v);return chord;};chord.startAngle=function(v){if(!arguments.length)return startAngle;startAngle=d3_functor(v);return chord;};chord.endAngle=function(v){if(!arguments.length)return endAngle;endAngle=d3_functor(v);return chord;};return chord;};function d3_svg_chordRadius(d){return d.radius;}
d3.svg.diagonal=function(){var source=d3_source,target=d3_target,projection=d3_svg_diagonalProjection;function diagonal(d,i){var p0=source.call(this,d,i),p3=target.call(this,d,i),m=(p0.y+p3.y)/2,p=[p0,{x:p0.x,y:m},{x:p3.x,y:m},p3];p=p.map(projection);return"M"+p[0]+"C"+p[1]+" "+p[2]+" "+p[3];}
diagonal.source=function(x){if(!arguments.length)return source;source=d3_functor(x);return diagonal;};diagonal.target=function(x){if(!arguments.length)return target;target=d3_functor(x);return diagonal;};diagonal.projection=function(x){if(!arguments.length)return projection;projection=x;return diagonal;};return diagonal;};function d3_svg_diagonalProjection(d){return[d.x,d.y];}
d3.svg.diagonal.radial=function(){var diagonal=d3.svg.diagonal(),projection=d3_svg_diagonalProjection,projection_=diagonal.projection;diagonal.projection=function(x){return arguments.length?projection_(d3_svg_diagonalRadialProjection(projection=x)):projection;};return diagonal;};function d3_svg_diagonalRadialProjection(projection){return function(){var d=projection.apply(this,arguments),r=d[0],a=d[1]-halfπ;return[r*Math.cos(a),r*Math.sin(a)];};}
d3.svg.symbol=function(){var type=d3_svg_symbolType,size=d3_svg_symbolSize;function symbol(d,i){return(d3_svg_symbols.get(type.call(this,d,i))||d3_svg_symbolCircle)(size.call(this,d,i));}
symbol.type=function(x){if(!arguments.length)return type;type=d3_functor(x);return symbol;};symbol.size=function(x){if(!arguments.length)return size;size=d3_functor(x);return symbol;};return symbol;};function d3_svg_symbolSize(){return 64;}
function d3_svg_symbolType(){return"circle";}
function d3_svg_symbolCircle(size){var r=Math.sqrt(size/π);return"M0,"+r+"A"+r+","+r+" 0 1,1 0,"+-r+"A"+r+","+r+" 0 1,1 0,"+r+"Z";}
var d3_svg_symbols=d3.map({circle:d3_svg_symbolCircle,cross:function(size){var r=Math.sqrt(size/5)/2;return"M"+-3*r+","+-r+"H"+-r+"V"+-3*r+"H"+r+"V"+-r+"H"+3*r+"V"+r+"H"+r+"V"+3*r+"H"+-r+"V"+r+"H"+-3*r+"Z";},diamond:function(size){var ry=Math.sqrt(size/(2*d3_svg_symbolTan30)),rx=ry*d3_svg_symbolTan30;return"M0,"+-ry+"L"+rx+",0"+" 0,"+ry+" "+-rx+",0"+"Z";},square:function(size){var r=Math.sqrt(size)/2;return"M"+-r+","+-r+"L"+r+","+-r+" "+r+","+r+" "+-r+","+r+"Z";},"triangle-down":function(size){var rx=Math.sqrt(size/d3_svg_symbolSqrt3),ry=rx*d3_svg_symbolSqrt3/2;return"M0,"+ry+"L"+rx+","+-ry+" "+-rx+","+-ry+"Z";},"triangle-up":function(size){var rx=Math.sqrt(size/d3_svg_symbolSqrt3),ry=rx*d3_svg_symbolSqrt3/2;return"M0,"+-ry+"L"+rx+","+ry+" "+-rx+","+ry+"Z";}});d3.svg.symbolTypes=d3_svg_symbols.keys();var d3_svg_symbolSqrt3=Math.sqrt(3),d3_svg_symbolTan30=Math.tan(30*d3_radians);d3_selectionPrototype.transition=function(name){var id=d3_transitionInheritId||++d3_transitionId,ns=d3_transitionNamespace(name),subgroups=[],subgroup,node,transition=d3_transitionInherit||{time:Date.now(),ease:d3_ease_cubicInOut,delay:0,duration:250};for(var j=-1,m=this.length;++j<m;){subgroups.push(subgroup=[]);for(var group=this[j],i=-1,n=group.length;++i<n;){if(node=group[i])d3_transitionNode(node,i,ns,id,transition);subgroup.push(node);}}
return d3_transition(subgroups,ns,id);};d3_selectionPrototype.interrupt=function(name){return this.each(name==null?d3_selection_interrupt:d3_selection_interruptNS(d3_transitionNamespace(name)));};var d3_selection_interrupt=d3_selection_interruptNS(d3_transitionNamespace());function d3_selection_interruptNS(ns){return function(){var lock,active;if((lock=this[ns])&&(active=lock[lock.active])){if(--lock.count)delete lock[lock.active];else delete this[ns];lock.active+=.5;active.event&&active.event.interrupt.call(this,this.__data__,active.index);}};}
function d3_transition(groups,ns,id){d3_subclass(groups,d3_transitionPrototype);groups.namespace=ns;groups.id=id;return groups;}
var d3_transitionPrototype=[],d3_transitionId=0,d3_transitionInheritId,d3_transitionInherit;d3_transitionPrototype.call=d3_selectionPrototype.call;d3_transitionPrototype.empty=d3_selectionPrototype.empty;d3_transitionPrototype.node=d3_selectionPrototype.node;d3_transitionPrototype.size=d3_selectionPrototype.size;d3.transition=function(selection,name){return selection&&selection.transition?d3_transitionInheritId?selection.transition(name):selection:d3.selection().transition(selection);};d3.transition.prototype=d3_transitionPrototype;d3_transitionPrototype.select=function(selector){var id=this.id,ns=this.namespace,subgroups=[],subgroup,subnode,node;selector=d3_selection_selector(selector);for(var j=-1,m=this.length;++j<m;){subgroups.push(subgroup=[]);for(var group=this[j],i=-1,n=group.length;++i<n;){if((node=group[i])&&(subnode=selector.call(node,node.__data__,i,j))){if("__data__"in node)subnode.__data__=node.__data__;d3_transitionNode(subnode,i,ns,id,node[ns][id]);subgroup.push(subnode);}else{subgroup.push(null);}}}
return d3_transition(subgroups,ns,id);};d3_transitionPrototype.selectAll=function(selector){var id=this.id,ns=this.namespace,subgroups=[],subgroup,subnodes,node,subnode,transition;selector=d3_selection_selectorAll(selector);for(var j=-1,m=this.length;++j<m;){for(var group=this[j],i=-1,n=group.length;++i<n;){if(node=group[i]){transition=node[ns][id];subnodes=selector.call(node,node.__data__,i,j);subgroups.push(subgroup=[]);for(var k=-1,o=subnodes.length;++k<o;){if(subnode=subnodes[k])d3_transitionNode(subnode,k,ns,id,transition);subgroup.push(subnode);}}}}
return d3_transition(subgroups,ns,id);};d3_transitionPrototype.filter=function(filter){var subgroups=[],subgroup,group,node;if(typeof filter!=="function")filter=d3_selection_filter(filter);for(var j=0,m=this.length;j<m;j++){subgroups.push(subgroup=[]);for(var group=this[j],i=0,n=group.length;i<n;i++){if((node=group[i])&&filter.call(node,node.__data__,i,j)){subgroup.push(node);}}}
return d3_transition(subgroups,this.namespace,this.id);};d3_transitionPrototype.tween=function(name,tween){var id=this.id,ns=this.namespace;if(arguments.length<2)return this.node()[ns][id].tween.get(name);return d3_selection_each(this,tween==null?function(node){node[ns][id].tween.remove(name);}:function(node){node[ns][id].tween.set(name,tween);});};function d3_transition_tween(groups,name,value,tween){var id=groups.id,ns=groups.namespace;return d3_selection_each(groups,typeof value==="function"?function(node,i,j){node[ns][id].tween.set(name,tween(value.call(node,node.__data__,i,j)));}:(value=tween(value),function(node){node[ns][id].tween.set(name,value);}));}
d3_transitionPrototype.attr=function(nameNS,value){if(arguments.length<2){for(value in nameNS)this.attr(value,nameNS[value]);return this;}
var interpolate=nameNS=="transform"?d3_interpolateTransform:d3_interpolate,name=d3.ns.qualify(nameNS);function attrNull(){this.removeAttribute(name);}
function attrNullNS(){this.removeAttributeNS(name.space,name.local);}
function attrTween(b){return b==null?attrNull:(b+="",function(){var a=this.getAttribute(name),i;return a!==b&&(i=interpolate(a,b),function(t){this.setAttribute(name,i(t));});});}
function attrTweenNS(b){return b==null?attrNullNS:(b+="",function(){var a=this.getAttributeNS(name.space,name.local),i;return a!==b&&(i=interpolate(a,b),function(t){this.setAttributeNS(name.space,name.local,i(t));});});}
return d3_transition_tween(this,"attr."+nameNS,value,name.local?attrTweenNS:attrTween);};d3_transitionPrototype.attrTween=function(nameNS,tween){var name=d3.ns.qualify(nameNS);function attrTween(d,i){var f=tween.call(this,d,i,this.getAttribute(name));return f&&function(t){this.setAttribute(name,f(t));};}
function attrTweenNS(d,i){var f=tween.call(this,d,i,this.getAttributeNS(name.space,name.local));return f&&function(t){this.setAttributeNS(name.space,name.local,f(t));};}
return this.tween("attr."+nameNS,name.local?attrTweenNS:attrTween);};d3_transitionPrototype.style=function(name,value,priority){var n=arguments.length;if(n<3){if(typeof name!=="string"){if(n<2)value="";for(priority in name)this.style(priority,name[priority],value);return this;}
priority="";}
function styleNull(){this.style.removeProperty(name);}
function styleString(b){return b==null?styleNull:(b+="",function(){var a=d3_window(this).getComputedStyle(this,null).getPropertyValue(name),i;return a!==b&&(i=d3_interpolate(a,b),function(t){this.style.setProperty(name,i(t),priority);});});}
return d3_transition_tween(this,"style."+name,value,styleString);};d3_transitionPrototype.styleTween=function(name,tween,priority){if(arguments.length<3)priority="";function styleTween(d,i){var f=tween.call(this,d,i,d3_window(this).getComputedStyle(this,null).getPropertyValue(name));return f&&function(t){this.style.setProperty(name,f(t),priority);};}
return this.tween("style."+name,styleTween);};d3_transitionPrototype.text=function(value){return d3_transition_tween(this,"text",value,d3_transition_text);};function d3_transition_text(b){if(b==null)b="";return function(){this.textContent=b;};}
d3_transitionPrototype.remove=function(){var ns=this.namespace;return this.each("end.transition",function(){var p;if(this[ns].count<2&&(p=this.parentNode))p.removeChild(this);});};d3_transitionPrototype.ease=function(value){var id=this.id,ns=this.namespace;if(arguments.length<1)return this.node()[ns][id].ease;if(typeof value!=="function")value=d3.ease.apply(d3,arguments);return d3_selection_each(this,function(node){node[ns][id].ease=value;});};d3_transitionPrototype.delay=function(value){var id=this.id,ns=this.namespace;if(arguments.length<1)return this.node()[ns][id].delay;return d3_selection_each(this,typeof value==="function"?function(node,i,j){node[ns][id].delay=+value.call(node,node.__data__,i,j);}:(value=+value,function(node){node[ns][id].delay=value;}));};d3_transitionPrototype.duration=function(value){var id=this.id,ns=this.namespace;if(arguments.length<1)return this.node()[ns][id].duration;return d3_selection_each(this,typeof value==="function"?function(node,i,j){node[ns][id].duration=Math.max(1,value.call(node,node.__data__,i,j));}:(value=Math.max(1,value),function(node){node[ns][id].duration=value;}));};d3_transitionPrototype.each=function(type,listener){var id=this.id,ns=this.namespace;if(arguments.length<2){var inherit=d3_transitionInherit,inheritId=d3_transitionInheritId;try{d3_transitionInheritId=id;d3_selection_each(this,function(node,i,j){d3_transitionInherit=node[ns][id];type.call(node,node.__data__,i,j);});}finally{d3_transitionInherit=inherit;d3_transitionInheritId=inheritId;}}else{d3_selection_each(this,function(node){var transition=node[ns][id];(transition.event||(transition.event=d3.dispatch("start","end","interrupt"))).on(type,listener);});}
return this;};d3_transitionPrototype.transition=function(){var id0=this.id,id1=++d3_transitionId,ns=this.namespace,subgroups=[],subgroup,group,node,transition;for(var j=0,m=this.length;j<m;j++){subgroups.push(subgroup=[]);for(var group=this[j],i=0,n=group.length;i<n;i++){if(node=group[i]){transition=node[ns][id0];d3_transitionNode(node,i,ns,id1,{time:transition.time,ease:transition.ease,delay:transition.delay+transition.duration,duration:transition.duration});}
subgroup.push(node);}}
return d3_transition(subgroups,ns,id1);};function d3_transitionNamespace(name){return name==null?"__transition__":"__transition_"+name+"__";}
function d3_transitionNode(node,i,ns,id,inherit){var lock=node[ns]||(node[ns]={active:0,count:0}),transition=lock[id];if(!transition){var time=inherit.time;transition=lock[id]={tween:new d3_Map(),time:time,delay:inherit.delay,duration:inherit.duration,ease:inherit.ease,index:i};inherit=null;++lock.count;d3.timer(function(elapsed){var delay=transition.delay,duration,ease,timer=d3_timer_active,tweened=[];timer.t=delay+time;if(delay<=elapsed)return start(elapsed-delay);timer.c=start;function start(elapsed){if(lock.active>id)return stop();var active=lock[lock.active];if(active){--lock.count;delete lock[lock.active];active.event&&active.event.interrupt.call(node,node.__data__,active.index);}
lock.active=id;transition.event&&transition.event.start.call(node,node.__data__,i);transition.tween.forEach(function(key,value){if(value=value.call(node,node.__data__,i)){tweened.push(value);}});ease=transition.ease;duration=transition.duration;d3.timer(function(){timer.c=tick(elapsed||1)?d3_true:tick;return 1;},0,time);}
function tick(elapsed){if(lock.active!==id)return 1;var t=elapsed/duration,e=ease(t),n=tweened.length;while(n>0){tweened[--n].call(node,e);}
if(t>=1){transition.event&&transition.event.end.call(node,node.__data__,i);return stop();}}
function stop(){if(--lock.count)delete lock[id];else delete node[ns];return 1;}},0,time);}}
d3.svg.axis=function(){var scale=d3.scale.linear(),orient=d3_svg_axisDefaultOrient,innerTickSize=6,outerTickSize=6,tickPadding=3,tickArguments_=[10],tickValues=null,tickFormat_;function axis(g){g.each(function(){var g=d3.select(this);var scale0=this.__chart__||scale,scale1=this.__chart__=scale.copy();var ticks=tickValues==null?scale1.ticks?scale1.ticks.apply(scale1,tickArguments_):scale1.domain():tickValues,tickFormat=tickFormat_==null?scale1.tickFormat?scale1.tickFormat.apply(scale1,tickArguments_):d3_identity:tickFormat_,tick=g.selectAll(".tick").data(ticks,scale1),tickEnter=tick.enter().insert("g",".domain").attr("class","tick").style("opacity",ε),tickExit=d3.transition(tick.exit()).style("opacity",ε).remove(),tickUpdate=d3.transition(tick.order()).style("opacity",1),tickSpacing=Math.max(innerTickSize,0)+tickPadding,tickTransform;var range=d3_scaleRange(scale1),path=g.selectAll(".domain").data([0]),pathUpdate=(path.enter().append("path").attr("class","domain"),d3.transition(path));tickEnter.append("line");tickEnter.append("text");var lineEnter=tickEnter.select("line"),lineUpdate=tickUpdate.select("line"),text=tick.select("text").text(tickFormat),textEnter=tickEnter.select("text"),textUpdate=tickUpdate.select("text"),sign=orient==="top"||orient==="left"?-1:1,x1,x2,y1,y2;if(orient==="bottom"||orient==="top"){tickTransform=d3_svg_axisX,x1="x",y1="y",x2="x2",y2="y2";text.attr("dy",sign<0?"0em":".71em").style("text-anchor","middle");pathUpdate.attr("d","M"+range[0]+","+sign*outerTickSize+"V0H"+range[1]+"V"+sign*outerTickSize);}else{tickTransform=d3_svg_axisY,x1="y",y1="x",x2="y2",y2="x2";text.attr("dy",".32em").style("text-anchor",sign<0?"end":"start");pathUpdate.attr("d","M"+sign*outerTickSize+","+range[0]+"H0V"+range[1]+"H"+sign*outerTickSize);}
lineEnter.attr(y2,sign*innerTickSize);textEnter.attr(y1,sign*tickSpacing);lineUpdate.attr(x2,0).attr(y2,sign*innerTickSize);textUpdate.attr(x1,0).attr(y1,sign*tickSpacing);if(scale1.rangeBand){var x=scale1,dx=x.rangeBand()/2;scale0=scale1=function(d){return x(d)+dx;};}else if(scale0.rangeBand){scale0=scale1;}else{tickExit.call(tickTransform,scale1,scale0);}
tickEnter.call(tickTransform,scale0,scale1);tickUpdate.call(tickTransform,scale1,scale1);});}
axis.scale=function(x){if(!arguments.length)return scale;scale=x;return axis;};axis.orient=function(x){if(!arguments.length)return orient;orient=x in d3_svg_axisOrients?x+"":d3_svg_axisDefaultOrient;return axis;};axis.ticks=function(){if(!arguments.length)return tickArguments_;tickArguments_=arguments;return axis;};axis.tickValues=function(x){if(!arguments.length)return tickValues;tickValues=x;return axis;};axis.tickFormat=function(x){if(!arguments.length)return tickFormat_;tickFormat_=x;return axis;};axis.tickSize=function(x){var n=arguments.length;if(!n)return innerTickSize;innerTickSize=+x;outerTickSize=+arguments[n-1];return axis;};axis.innerTickSize=function(x){if(!arguments.length)return innerTickSize;innerTickSize=+x;return axis;};axis.outerTickSize=function(x){if(!arguments.length)return outerTickSize;outerTickSize=+x;return axis;};axis.tickPadding=function(x){if(!arguments.length)return tickPadding;tickPadding=+x;return axis;};axis.tickSubdivide=function(){return arguments.length&&axis;};return axis;};var d3_svg_axisDefaultOrient="bottom",d3_svg_axisOrients={top:1,right:1,bottom:1,left:1};function d3_svg_axisX(selection,x0,x1){selection.attr("transform",function(d){var v0=x0(d);return"translate("+(isFinite(v0)?v0:x1(d))+",0)";});}
function d3_svg_axisY(selection,y0,y1){selection.attr("transform",function(d){var v0=y0(d);return"translate(0,"+(isFinite(v0)?v0:y1(d))+")";});}
d3.svg.brush=function(){var event=d3_eventDispatch(brush,"brushstart","brush","brushend"),x=null,y=null,xExtent=[0,0],yExtent=[0,0],xExtentDomain,yExtentDomain,xClamp=true,yClamp=true,resizes=d3_svg_brushResizes[0];function brush(g){g.each(function(){var g=d3.select(this).style("pointer-events","all").style("-webkit-tap-highlight-color","rgba(0,0,0,0)").on("mousedown.brush",brushstart).on("touchstart.brush",brushstart);var background=g.selectAll(".background").data([0]);background.enter().append("rect").attr("class","background").style("visibility","hidden").style("cursor","crosshair");g.selectAll(".extent").data([0]).enter().append("rect").attr("class","extent").style("cursor","move");var resize=g.selectAll(".resize").data(resizes,d3_identity);resize.exit().remove();resize.enter().append("g").attr("class",function(d){return"resize "+d;}).style("cursor",function(d){return d3_svg_brushCursor[d];}).append("rect").attr("x",function(d){return/[ew]$/.test(d)?-3:null;}).attr("y",function(d){return/^[ns]/.test(d)?-3:null;}).attr("width",6).attr("height",6).style("visibility","hidden");resize.style("display",brush.empty()?"none":null);var gUpdate=d3.transition(g),backgroundUpdate=d3.transition(background),range;if(x){range=d3_scaleRange(x);backgroundUpdate.attr("x",range[0]).attr("width",range[1]-range[0]);redrawX(gUpdate);}
if(y){range=d3_scaleRange(y);backgroundUpdate.attr("y",range[0]).attr("height",range[1]-range[0]);redrawY(gUpdate);}
redraw(gUpdate);});}
brush.event=function(g){g.each(function(){var event_=event.of(this,arguments),extent1={x:xExtent,y:yExtent,i:xExtentDomain,j:yExtentDomain},extent0=this.__chart__||extent1;this.__chart__=extent1;if(d3_transitionInheritId){d3.select(this).transition().each("start.brush",function(){xExtentDomain=extent0.i;yExtentDomain=extent0.j;xExtent=extent0.x;yExtent=extent0.y;event_({type:"brushstart"});}).tween("brush:brush",function(){var xi=d3_interpolateArray(xExtent,extent1.x),yi=d3_interpolateArray(yExtent,extent1.y);xExtentDomain=yExtentDomain=null;return function(t){xExtent=extent1.x=xi(t);yExtent=extent1.y=yi(t);event_({type:"brush",mode:"resize"});};}).each("end.brush",function(){xExtentDomain=extent1.i;yExtentDomain=extent1.j;event_({type:"brush",mode:"resize"});event_({type:"brushend"});});}else{event_({type:"brushstart"});event_({type:"brush",mode:"resize"});event_({type:"brushend"});}});};function redraw(g){g.selectAll(".resize").attr("transform",function(d){return"translate("+xExtent[+/e$/.test(d)]+","+yExtent[+/^s/.test(d)]+")";});}
function redrawX(g){g.select(".extent").attr("x",xExtent[0]);g.selectAll(".extent,.n>rect,.s>rect").attr("width",xExtent[1]-xExtent[0]);}
function redrawY(g){g.select(".extent").attr("y",yExtent[0]);g.selectAll(".extent,.e>rect,.w>rect").attr("height",yExtent[1]-yExtent[0]);}
function brushstart(){var target=this,eventTarget=d3.select(d3.event.target),event_=event.of(target,arguments),g=d3.select(target),resizing=eventTarget.datum(),resizingX=!/^(n|s)$/.test(resizing)&&x,resizingY=!/^(e|w)$/.test(resizing)&&y,dragging=eventTarget.classed("extent"),dragRestore=d3_event_dragSuppress(target),center,origin=d3.mouse(target),offset;var w=d3.select(d3_window(target)).on("keydown.brush",keydown).on("keyup.brush",keyup);if(d3.event.changedTouches){w.on("touchmove.brush",brushmove).on("touchend.brush",brushend);}else{w.on("mousemove.brush",brushmove).on("mouseup.brush",brushend);}
g.interrupt().selectAll("*").interrupt();if(dragging){origin[0]=xExtent[0]-origin[0];origin[1]=yExtent[0]-origin[1];}else if(resizing){var ex=+/w$/.test(resizing),ey=+/^n/.test(resizing);offset=[xExtent[1-ex]-origin[0],yExtent[1-ey]-origin[1]];origin[0]=xExtent[ex];origin[1]=yExtent[ey];}else if(d3.event.altKey)center=origin.slice();g.style("pointer-events","none").selectAll(".resize").style("display",null);d3.select("body").style("cursor",eventTarget.style("cursor"));event_({type:"brushstart"});brushmove();function keydown(){if(d3.event.keyCode==32){if(!dragging){center=null;origin[0]-=xExtent[1];origin[1]-=yExtent[1];dragging=2;}
d3_eventPreventDefault();}}
function keyup(){if(d3.event.keyCode==32&&dragging==2){origin[0]+=xExtent[1];origin[1]+=yExtent[1];dragging=0;d3_eventPreventDefault();}}
function brushmove(){var point=d3.mouse(target),moved=false;if(offset){point[0]+=offset[0];point[1]+=offset[1];}
if(!dragging){if(d3.event.altKey){if(!center)center=[(xExtent[0]+xExtent[1])/2,(yExtent[0]+yExtent[1])/2];origin[0]=xExtent[+(point[0]<center[0])];origin[1]=yExtent[+(point[1]<center[1])];}else center=null;}
if(resizingX&&move1(point,x,0)){redrawX(g);moved=true;}
if(resizingY&&move1(point,y,1)){redrawY(g);moved=true;}
if(moved){redraw(g);event_({type:"brush",mode:dragging?"move":"resize"});}}
function move1(point,scale,i){var range=d3_scaleRange(scale),r0=range[0],r1=range[1],position=origin[i],extent=i?yExtent:xExtent,size=extent[1]-extent[0],min,max;if(dragging){r0-=position;r1-=size+position;}
min=(i?yClamp:xClamp)?Math.max(r0,Math.min(r1,point[i])):point[i];if(dragging){max=(min+=position)+size;}else{if(center)position=Math.max(r0,Math.min(r1,2*center[i]-min));if(position<min){max=min;min=position;}else{max=position;}}
if(extent[0]!=min||extent[1]!=max){if(i)yExtentDomain=null;else xExtentDomain=null;extent[0]=min;extent[1]=max;return true;}}
function brushend(){brushmove();g.style("pointer-events","all").selectAll(".resize").style("display",brush.empty()?"none":null);d3.select("body").style("cursor",null);w.on("mousemove.brush",null).on("mouseup.brush",null).on("touchmove.brush",null).on("touchend.brush",null).on("keydown.brush",null).on("keyup.brush",null);dragRestore();event_({type:"brushend"});}}
brush.x=function(z){if(!arguments.length)return x;x=z;resizes=d3_svg_brushResizes[!x<<1|!y];return brush;};brush.y=function(z){if(!arguments.length)return y;y=z;resizes=d3_svg_brushResizes[!x<<1|!y];return brush;};brush.clamp=function(z){if(!arguments.length)return x&&y?[xClamp,yClamp]:x?xClamp:y?yClamp:null;if(x&&y)xClamp=!!z[0],yClamp=!!z[1];else if(x)xClamp=!!z;else if(y)yClamp=!!z;return brush;};brush.extent=function(z){var x0,x1,y0,y1,t;if(!arguments.length){if(x){if(xExtentDomain){x0=xExtentDomain[0],x1=xExtentDomain[1];}else{x0=xExtent[0],x1=xExtent[1];if(x.invert)x0=x.invert(x0),x1=x.invert(x1);if(x1<x0)t=x0,x0=x1,x1=t;}}
if(y){if(yExtentDomain){y0=yExtentDomain[0],y1=yExtentDomain[1];}else{y0=yExtent[0],y1=yExtent[1];if(y.invert)y0=y.invert(y0),y1=y.invert(y1);if(y1<y0)t=y0,y0=y1,y1=t;}}
return x&&y?[[x0,y0],[x1,y1]]:x?[x0,x1]:y&&[y0,y1];}
if(x){x0=z[0],x1=z[1];if(y)x0=x0[0],x1=x1[0];xExtentDomain=[x0,x1];if(x.invert)x0=x(x0),x1=x(x1);if(x1<x0)t=x0,x0=x1,x1=t;if(x0!=xExtent[0]||x1!=xExtent[1])xExtent=[x0,x1];}
if(y){y0=z[0],y1=z[1];if(x)y0=y0[1],y1=y1[1];yExtentDomain=[y0,y1];if(y.invert)y0=y(y0),y1=y(y1);if(y1<y0)t=y0,y0=y1,y1=t;if(y0!=yExtent[0]||y1!=yExtent[1])yExtent=[y0,y1];}
return brush;};brush.clear=function(){if(!brush.empty()){xExtent=[0,0],yExtent=[0,0];xExtentDomain=yExtentDomain=null;}
return brush;};brush.empty=function(){return!!x&&xExtent[0]==xExtent[1]||!!y&&yExtent[0]==yExtent[1];};return d3.rebind(brush,event,"on");};var d3_svg_brushCursor={n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"};var d3_svg_brushResizes=[["n","e","s","w","nw","ne","se","sw"],["e","w"],["n","s"],[]];var d3_time_format=d3_time.format=d3_locale_enUS.timeFormat;var d3_time_formatUtc=d3_time_format.utc;var d3_time_formatIso=d3_time_formatUtc("%Y-%m-%dT%H:%M:%S.%LZ");d3_time_format.iso=Date.prototype.toISOString&&+new Date("2000-01-01T00:00:00.000Z")?d3_time_formatIsoNative:d3_time_formatIso;function d3_time_formatIsoNative(date){return date.toISOString();}
d3_time_formatIsoNative.parse=function(string){var date=new Date(string);return isNaN(date)?null:date;};d3_time_formatIsoNative.toString=d3_time_formatIso.toString;d3_time.second=d3_time_interval(function(date){return new d3_date(Math.floor(date/1e3)*1e3);},function(date,offset){date.setTime(date.getTime()+Math.floor(offset)*1e3);},function(date){return date.getSeconds();});d3_time.seconds=d3_time.second.range;d3_time.seconds.utc=d3_time.second.utc.range;d3_time.minute=d3_time_interval(function(date){return new d3_date(Math.floor(date/6e4)*6e4);},function(date,offset){date.setTime(date.getTime()+Math.floor(offset)*6e4);},function(date){return date.getMinutes();});d3_time.minutes=d3_time.minute.range;d3_time.minutes.utc=d3_time.minute.utc.range;d3_time.hour=d3_time_interval(function(date){var timezone=date.getTimezoneOffset()/60;return new d3_date((Math.floor(date/36e5-timezone)+timezone)*36e5);},function(date,offset){date.setTime(date.getTime()+Math.floor(offset)*36e5);},function(date){return date.getHours();});d3_time.hours=d3_time.hour.range;d3_time.hours.utc=d3_time.hour.utc.range;d3_time.month=d3_time_interval(function(date){date=d3_time.day(date);date.setDate(1);return date;},function(date,offset){date.setMonth(date.getMonth()+offset);},function(date){return date.getMonth();});d3_time.months=d3_time.month.range;d3_time.months.utc=d3_time.month.utc.range;function d3_time_scale(linear,methods,format){function scale(x){return linear(x);}
scale.invert=function(x){return d3_time_scaleDate(linear.invert(x));};scale.domain=function(x){if(!arguments.length)return linear.domain().map(d3_time_scaleDate);linear.domain(x);return scale;};function tickMethod(extent,count){var span=extent[1]-extent[0],target=span/count,i=d3.bisect(d3_time_scaleSteps,target);return i==d3_time_scaleSteps.length?[methods.year,d3_scale_linearTickRange(extent.map(function(d){return d/31536e6;}),count)[2]]:!i?[d3_time_scaleMilliseconds,d3_scale_linearTickRange(extent,count)[2]]:methods[target/d3_time_scaleSteps[i-1]<d3_time_scaleSteps[i]/target?i-1:i];}
scale.nice=function(interval,skip){var domain=scale.domain(),extent=d3_scaleExtent(domain),method=interval==null?tickMethod(extent,10):typeof interval==="number"&&tickMethod(extent,interval);if(method)interval=method[0],skip=method[1];function skipped(date){return!isNaN(date)&&!interval.range(date,d3_time_scaleDate(+date+1),skip).length;}
return scale.domain(d3_scale_nice(domain,skip>1?{floor:function(date){while(skipped(date=interval.floor(date)))date=d3_time_scaleDate(date-1);return date;},ceil:function(date){while(skipped(date=interval.ceil(date)))date=d3_time_scaleDate(+date+1);return date;}}:interval));};scale.ticks=function(interval,skip){var extent=d3_scaleExtent(scale.domain()),method=interval==null?tickMethod(extent,10):typeof interval==="number"?tickMethod(extent,interval):!interval.range&&[{range:interval},skip];if(method)interval=method[0],skip=method[1];return interval.range(extent[0],d3_time_scaleDate(+extent[1]+1),skip<1?1:skip);};scale.tickFormat=function(){return format;};scale.copy=function(){return d3_time_scale(linear.copy(),methods,format);};return d3_scale_linearRebind(scale,linear);}
function d3_time_scaleDate(t){return new Date(t);}
var d3_time_scaleSteps=[1e3,5e3,15e3,3e4,6e4,3e5,9e5,18e5,36e5,108e5,216e5,432e5,864e5,1728e5,6048e5,2592e6,7776e6,31536e6];var d3_time_scaleLocalMethods=[[d3_time.second,1],[d3_time.second,5],[d3_time.second,15],[d3_time.second,30],[d3_time.minute,1],[d3_time.minute,5],[d3_time.minute,15],[d3_time.minute,30],[d3_time.hour,1],[d3_time.hour,3],[d3_time.hour,6],[d3_time.hour,12],[d3_time.day,1],[d3_time.day,2],[d3_time.week,1],[d3_time.month,1],[d3_time.month,3],[d3_time.year,1]];var d3_time_scaleLocalFormat=d3_time_format.multi([[".%L",function(d){return d.getMilliseconds();}],[":%S",function(d){return d.getSeconds();}],["%I:%M",function(d){return d.getMinutes();}],["%I %p",function(d){return d.getHours();}],["%a %d",function(d){return d.getDay()&&d.getDate()!=1;}],["%b %d",function(d){return d.getDate()!=1;}],["%B",function(d){return d.getMonth();}],["%Y",d3_true]]);var d3_time_scaleMilliseconds={range:function(start,stop,step){return d3.range(Math.ceil(start/step)*step,+stop,step).map(d3_time_scaleDate);},floor:d3_identity,ceil:d3_identity};d3_time_scaleLocalMethods.year=d3_time.year;d3_time.scale=function(){return d3_time_scale(d3.scale.linear(),d3_time_scaleLocalMethods,d3_time_scaleLocalFormat);};var d3_time_scaleUtcMethods=d3_time_scaleLocalMethods.map(function(m){return[m[0].utc,m[1]];});var d3_time_scaleUtcFormat=d3_time_formatUtc.multi([[".%L",function(d){return d.getUTCMilliseconds();}],[":%S",function(d){return d.getUTCSeconds();}],["%I:%M",function(d){return d.getUTCMinutes();}],["%I %p",function(d){return d.getUTCHours();}],["%a %d",function(d){return d.getUTCDay()&&d.getUTCDate()!=1;}],["%b %d",function(d){return d.getUTCDate()!=1;}],["%B",function(d){return d.getUTCMonth();}],["%Y",d3_true]]);d3_time_scaleUtcMethods.year=d3_time.year.utc;d3_time.scale.utc=function(){return d3_time_scale(d3.scale.linear(),d3_time_scaleUtcMethods,d3_time_scaleUtcFormat);};d3.text=d3_xhrType(function(request){return request.responseText;});d3.json=function(url,callback){return d3_xhr(url,"application/json",d3_json,callback);};function d3_json(request){return JSON.parse(request.responseText);}
d3.html=function(url,callback){return d3_xhr(url,"text/html",d3_html,callback);};function d3_html(request){var range=d3_document.createRange();range.selectNode(d3_document.body);return range.createContextualFragment(request.responseText);}
d3.xml=d3_xhrType(function(request){return request.responseXML;});if(typeof define==="function"&&define.amd)define(d3);else if(typeof module==="object"&&module.exports)module.exports=d3;this.d3=d3;}();;

/* /web/static/lib/nvd3/nv.d3.js defined in bundle 'web.assets_backend' */
(function(){var nv={};nv.dev=false;nv.tooltip=nv.tooltip||{};nv.utils=nv.utils||{};nv.models=nv.models||{};nv.charts={};nv.logs={};nv.dom={};nv.dispatch=d3.dispatch('render_start','render_end');if(!Function.prototype.bind){Function.prototype.bind=function(oThis){if(typeof this!=="function"){throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");}
var aArgs=Array.prototype.slice.call(arguments,1),fToBind=this,fNOP=function(){},fBound=function(){return fToBind.apply(this instanceof fNOP&&oThis?this:oThis,aArgs.concat(Array.prototype.slice.call(arguments)));};fNOP.prototype=this.prototype;fBound.prototype=new fNOP();return fBound;};}
if(nv.dev){nv.dispatch.on('render_start',function(e){nv.logs.startTime=+new Date();});nv.dispatch.on('render_end',function(e){nv.logs.endTime=+new Date();nv.logs.totalTime=nv.logs.endTime-nv.logs.startTime;nv.log('total',nv.logs.totalTime);});}
nv.log=function(){if(nv.dev&&window.console&&console.log&&console.log.apply)
console.log.apply(console,arguments);else if(nv.dev&&window.console&&typeof console.log=="function"&&Function.prototype.bind){var log=Function.prototype.bind.call(console.log,console);log.apply(console,arguments);}
return arguments[arguments.length-1];};nv.deprecated=function(name,info){if(console&&console.warn){console.warn('nvd3 warning: `'+name+'` has been deprecated. ',info||'');}};nv.render=function render(step){step=step||1;nv.render.active=true;nv.dispatch.render_start();var renderLoop=function(){var chart,graph;for(var i=0;i<step&&(graph=nv.render.queue[i]);i++){chart=graph.generate();if(typeof graph.callback==typeof(Function))graph.callback(chart);}
nv.render.queue.splice(0,i);if(nv.render.queue.length){setTimeout(renderLoop);}
else{nv.dispatch.render_end();nv.render.active=false;}};setTimeout(renderLoop);};nv.render.active=false;nv.render.queue=[];nv.addGraph=function(obj){if(typeof arguments[0]===typeof(Function)){obj={generate:arguments[0],callback:arguments[1]};}
nv.render.queue.push(obj);if(!nv.render.active){nv.render();}};if(typeof(module)!=='undefined'&&typeof(exports)!=='undefined'){module.exports=nv;}
if(typeof(window)!=='undefined'){window.nv=nv;}
nv.dom.write=function(callback){if(window.fastdom!==undefined){return fastdom.write(callback);}
return callback();};nv.dom.read=function(callback){if(window.fastdom!==undefined){return fastdom.read(callback);}
return callback();};nv.interactiveGuideline=function(){"use strict";var margin={left:0,top:0},width=null,height=null,xScale=d3.scale.linear(),dispatch=d3.dispatch('elementMousemove','elementMouseout','elementClick','elementDblclick','elementMouseDown','elementMouseUp'),showGuideLine=true,svgContainer=null,tooltip=nv.models.tooltip(),isMSIE="ActiveXObject"in window;tooltip.duration(0).hideDelay(0).hidden(false);function layer(selection){selection.each(function(data){var container=d3.select(this);var availableWidth=(width||960),availableHeight=(height||400);var wrap=container.selectAll("g.nv-wrap.nv-interactiveLineLayer").data([data]);var wrapEnter=wrap.enter().append("g").attr("class"," nv-wrap nv-interactiveLineLayer");wrapEnter.append("g").attr("class","nv-interactiveGuideLine");if(!svgContainer){return;}
function mouseHandler(){var d3mouse=d3.mouse(this);var mouseX=d3mouse[0];var mouseY=d3mouse[1];var subtractMargin=true;var mouseOutAnyReason=false;if(isMSIE){mouseX=d3.event.offsetX;mouseY=d3.event.offsetY;if(d3.event.target.tagName!=="svg"){subtractMargin=false;}
if(d3.event.target.className.baseVal.match("nv-legend")){mouseOutAnyReason=true;}}
if(subtractMargin){mouseX-=margin.left;mouseY-=margin.top;}
if(mouseX<0||mouseY<0||mouseX>availableWidth||mouseY>availableHeight||(d3.event.relatedTarget&&d3.event.relatedTarget.ownerSVGElement===undefined)||mouseOutAnyReason){if(isMSIE){if(d3.event.relatedTarget&&d3.event.relatedTarget.ownerSVGElement===undefined&&(d3.event.relatedTarget.className===undefined||d3.event.relatedTarget.className.match(tooltip.nvPointerEventsClass))){return;}}
dispatch.elementMouseout({mouseX:mouseX,mouseY:mouseY});layer.renderGuideLine(null);tooltip.hidden(true);return;}else{tooltip.hidden(false);}
var pointXValue=xScale.invert(mouseX);dispatch.elementMousemove({mouseX:mouseX,mouseY:mouseY,pointXValue:pointXValue});if(d3.event.type==="dblclick"){dispatch.elementDblclick({mouseX:mouseX,mouseY:mouseY,pointXValue:pointXValue});}
if(d3.event.type==='click'){dispatch.elementClick({mouseX:mouseX,mouseY:mouseY,pointXValue:pointXValue});}
if(d3.event.type==='mousedown'){dispatch.elementMouseDown({mouseX:mouseX,mouseY:mouseY,pointXValue:pointXValue});}
if(d3.event.type==='mouseup'){dispatch.elementMouseUp({mouseX:mouseX,mouseY:mouseY,pointXValue:pointXValue});}}
svgContainer.on("touchmove",mouseHandler).on("mousemove",mouseHandler,true).on("mouseout",mouseHandler,true).on("mousedown",mouseHandler,true).on("mouseup",mouseHandler,true).on("dblclick",mouseHandler).on("click",mouseHandler);layer.guideLine=null;layer.renderGuideLine=function(x){if(!showGuideLine)return;if(layer.guideLine&&layer.guideLine.attr("x1")===x)return;nv.dom.write(function(){var line=wrap.select(".nv-interactiveGuideLine").selectAll("line").data((x!=null)?[nv.utils.NaNtoZero(x)]:[],String);line.enter().append("line").attr("class","nv-guideline").attr("x1",function(d){return d;}).attr("x2",function(d){return d;}).attr("y1",availableHeight).attr("y2",0);line.exit().remove();});}});}
layer.dispatch=dispatch;layer.tooltip=tooltip;layer.margin=function(_){if(!arguments.length)return margin;margin.top=typeof _.top!='undefined'?_.top:margin.top;margin.left=typeof _.left!='undefined'?_.left:margin.left;return layer;};layer.width=function(_){if(!arguments.length)return width;width=_;return layer;};layer.height=function(_){if(!arguments.length)return height;height=_;return layer;};layer.xScale=function(_){if(!arguments.length)return xScale;xScale=_;return layer;};layer.showGuideLine=function(_){if(!arguments.length)return showGuideLine;showGuideLine=_;return layer;};layer.svgContainer=function(_){if(!arguments.length)return svgContainer;svgContainer=_;return layer;};return layer;};nv.interactiveBisect=function(values,searchVal,xAccessor){"use strict";if(!(values instanceof Array)){return null;}
var _xAccessor;if(typeof xAccessor!=='function'){_xAccessor=function(d){return d.x;}}else{_xAccessor=xAccessor;}
var _cmp=function(d,v){return _xAccessor(d)-v;};var bisect=d3.bisector(_cmp).left;var index=d3.max([0,bisect(values,searchVal)-1]);var currentValue=_xAccessor(values[index]);if(typeof currentValue==='undefined'){currentValue=index;}
if(currentValue===searchVal){return index;}
var nextIndex=d3.min([index+1,values.length-1]);var nextValue=_xAccessor(values[nextIndex]);if(typeof nextValue==='undefined'){nextValue=nextIndex;}
if(Math.abs(nextValue-searchVal)>=Math.abs(currentValue-searchVal)){return index;}else{return nextIndex}};nv.nearestValueIndex=function(values,searchVal,threshold){"use strict";var yDistMax=Infinity,indexToHighlight=null;values.forEach(function(d,i){var delta=Math.abs(searchVal-d);if(d!=null&&delta<=yDistMax&&delta<threshold){yDistMax=delta;indexToHighlight=i;}});return indexToHighlight;};nv.models.tooltip=function(){"use strict";var id="nvtooltip-"+Math.floor(Math.random()*100000),data=null,gravity='w',distance=25,snapDistance=0,fixedTop=null,classes=null,chartContainer=null,hidden=true,hideDelay=200,tooltip=null,lastPosition={left:null,top:null},enabled=true,duration=100,headerEnabled=true,nvPointerEventsClass="nv-pointer-events-none";var position=function(){return{left:d3.event.clientX,top:d3.event.clientY};};var valueFormatter=function(d,i){return d;};var headerFormatter=function(d){return d;};var keyFormatter=function(d,i){return d;};var contentGenerator=function(d){if(d===null){return'';}
var table=d3.select(document.createElement("table"));if(headerEnabled){var theadEnter=table.selectAll("thead").data([d]).enter().append("thead");theadEnter.append("tr").append("td").attr("colspan",3).append("strong").classed("x-value",true).html(headerFormatter(d.value));}
var tbodyEnter=table.selectAll("tbody").data([d]).enter().append("tbody");var trowEnter=tbodyEnter.selectAll("tr").data(function(p){return p.series}).enter().append("tr").classed("highlight",function(p){return p.highlight});trowEnter.append("td").classed("legend-color-guide",true).append("div").style("background-color",function(p){return p.color});trowEnter.append("td").classed("key",true).classed("total",function(p){return!!p.total}).html(function(p,i){return keyFormatter(p.key,i)});trowEnter.append("td").classed("value",true).html(function(p,i){return valueFormatter(p.value,i)});trowEnter.selectAll("td").each(function(p){if(p.highlight){var opacityScale=d3.scale.linear().domain([0,1]).range(["#fff",p.color]);var opacity=0.6;d3.select(this).style("border-bottom-color",opacityScale(opacity)).style("border-top-color",opacityScale(opacity));}});var html=table.node().outerHTML;if(d.footer!==undefined)
html+="<div class='footer'>"+d.footer+"</div>";return html;};var dataSeriesExists=function(d){if(d&&d.series){if(d.series instanceof Array){return!!d.series.length;}
if(d.series instanceof Object){d.series=[d.series];return true;}}
return false;};var calcGravityOffset=function(pos){var height=tooltip.node().offsetHeight,width=tooltip.node().offsetWidth,clientWidth=document.documentElement.clientWidth,clientHeight=document.documentElement.clientHeight,left,top,tmp;switch(gravity){case'e':left=-width-distance;top=-(height/2);if(pos.left+left<0)left=distance;if((tmp=pos.top+top)<0)top-=tmp;if((tmp=pos.top+top+height)>clientHeight)top-=tmp-clientHeight;break;case'w':left=distance;top=-(height/2);if(pos.left+left+width>clientWidth)left=-width-distance;if((tmp=pos.top+top)<0)top-=tmp;if((tmp=pos.top+top+height)>clientHeight)top-=tmp-clientHeight;break;case'n':left=-(width/2)-5;top=distance;if(pos.top+top+height>clientHeight)top=-height-distance;if((tmp=pos.left+left)<0)left-=tmp;if((tmp=pos.left+left+width)>clientWidth)left-=tmp-clientWidth;break;case's':left=-(width/2);top=-height-distance;if(pos.top+top<0)top=distance;if((tmp=pos.left+left)<0)left-=tmp;if((tmp=pos.left+left+width)>clientWidth)left-=tmp-clientWidth;break;case'center':left=-(width/2);top=-(height/2);break;default:left=0;top=0;break;}
return{'left':left,'top':top};};var positionTooltip=function(){nv.dom.read(function(){var pos=position(),gravityOffset=calcGravityOffset(pos),left=pos.left+gravityOffset.left,top=pos.top+gravityOffset.top;if(hidden){tooltip.interrupt().transition().delay(hideDelay).duration(0).style('opacity',0);}else{var old_translate='translate('+lastPosition.left+'px, '+lastPosition.top+'px)';var new_translate='translate('+left+'px, '+top+'px)';var translateInterpolator=d3.interpolateString(old_translate,new_translate);var is_hidden=tooltip.style('opacity')<0.1;tooltip.interrupt().transition().duration(is_hidden?0:duration).styleTween('transform',function(d){return translateInterpolator;},'important').styleTween('-webkit-transform',function(d){return translateInterpolator;}).style('-ms-transform',new_translate).style('opacity',1);}
lastPosition.left=left;lastPosition.top=top;});};function initTooltip(){if(!tooltip){var container=chartContainer?chartContainer:document.body;tooltip=d3.select(container).append("div").attr("class","nvtooltip "+(classes?classes:"xy-tooltip")).attr("id",id);tooltip.style("top",0).style("left",0);tooltip.style('opacity',0);tooltip.style('position','fixed');tooltip.selectAll("div, table, td, tr").classed(nvPointerEventsClass,true);tooltip.classed(nvPointerEventsClass,true);}}
function nvtooltip(){if(!enabled)return;if(!dataSeriesExists(data))return;nv.dom.write(function(){initTooltip();var newContent=contentGenerator(data);if(newContent){tooltip.node().innerHTML=newContent;}
positionTooltip();});return nvtooltip;}
nvtooltip.nvPointerEventsClass=nvPointerEventsClass;nvtooltip.options=nv.utils.optionsFunc.bind(nvtooltip);nvtooltip._options=Object.create({},{duration:{get:function(){return duration;},set:function(_){duration=_;}},gravity:{get:function(){return gravity;},set:function(_){gravity=_;}},distance:{get:function(){return distance;},set:function(_){distance=_;}},snapDistance:{get:function(){return snapDistance;},set:function(_){snapDistance=_;}},classes:{get:function(){return classes;},set:function(_){classes=_;}},chartContainer:{get:function(){return chartContainer;},set:function(_){chartContainer=_;}},enabled:{get:function(){return enabled;},set:function(_){enabled=_;}},hideDelay:{get:function(){return hideDelay;},set:function(_){hideDelay=_;}},contentGenerator:{get:function(){return contentGenerator;},set:function(_){contentGenerator=_;}},valueFormatter:{get:function(){return valueFormatter;},set:function(_){valueFormatter=_;}},headerFormatter:{get:function(){return headerFormatter;},set:function(_){headerFormatter=_;}},keyFormatter:{get:function(){return keyFormatter;},set:function(_){keyFormatter=_;}},headerEnabled:{get:function(){return headerEnabled;},set:function(_){headerEnabled=_;}},position:{get:function(){return position;},set:function(_){position=_;}},hidden:{get:function(){return hidden;},set:function(_){if(hidden!=_){hidden=!!_;nvtooltip();}}},data:{get:function(){return data;},set:function(_){if(_.point){_.value=_.point.x;_.series=_.series||{};_.series.value=_.point.y;_.series.color=_.point.color||_.series.color;}
data=_;}},node:{get:function(){return tooltip.node();},set:function(_){}},id:{get:function(){return id;},set:function(_){}}});nv.utils.initOptions(nvtooltip);return nvtooltip;};nv.utils.windowSize=function(){var size={width:640,height:480};if(window.innerWidth&&window.innerHeight){size.width=window.innerWidth;size.height=window.innerHeight;return(size);}
if(document.compatMode=='CSS1Compat'&&document.documentElement&&document.documentElement.offsetWidth){size.width=document.documentElement.offsetWidth;size.height=document.documentElement.offsetHeight;return(size);}
if(document.body&&document.body.offsetWidth){size.width=document.body.offsetWidth;size.height=document.body.offsetHeight;return(size);}
return(size);};nv.utils.windowResize=function(handler){if(window.addEventListener){window.addEventListener('resize',handler);}else{nv.log("ERROR: Failed to bind to window.resize with: ",handler);}
return{callback:handler,clear:function(){window.removeEventListener('resize',handler);}}};nv.utils.getColor=function(color){if(color===undefined){return nv.utils.defaultColor();}else if(Array.isArray(color)){var color_scale=d3.scale.ordinal().range(color);return function(d,i){var key=i===undefined?d:i;return d.color||color_scale(key);};}else{return color;}};nv.utils.defaultColor=function(){return nv.utils.getColor(d3.scale.category20().range());};nv.utils.customTheme=function(dictionary,getKey,defaultColors){getKey=getKey||function(series){return series.key};defaultColors=defaultColors||d3.scale.category20().range();var defIndex=defaultColors.length;return function(series,index){var key=getKey(series);if(typeof dictionary[key]==='function'){return dictionary[key]();}else if(dictionary[key]!==undefined){return dictionary[key];}else{if(!defIndex){defIndex=defaultColors.length;}
defIndex=defIndex-1;return defaultColors[defIndex];}};};nv.utils.pjax=function(links,content){var load=function(href){d3.html(href,function(fragment){var target=d3.select(content).node();target.parentNode.replaceChild(d3.select(fragment).select(content).node(),target);nv.utils.pjax(links,content);});};d3.selectAll(links).on("click",function(){history.pushState(this.href,this.textContent,this.href);load(this.href);d3.event.preventDefault();});d3.select(window).on("popstate",function(){if(d3.event.state){load(d3.event.state);}});};nv.utils.calcApproxTextWidth=function(svgTextElem){if(typeof svgTextElem.style==='function'&&typeof svgTextElem.text==='function'){var fontSize=parseInt(svgTextElem.style("font-size").replace("px",""),10);var textLength=svgTextElem.text().length;return textLength*fontSize*0.5;}
return 0;};nv.utils.NaNtoZero=function(n){if(typeof n!=='number'||isNaN(n)||n===null||n===Infinity||n===-Infinity){return 0;}
return n;};d3.selection.prototype.watchTransition=function(renderWatch){var args=[this].concat([].slice.call(arguments,1));return renderWatch.transition.apply(renderWatch,args);};nv.utils.renderWatch=function(dispatch,duration){if(!(this instanceof nv.utils.renderWatch)){return new nv.utils.renderWatch(dispatch,duration);}
var _duration=duration!==undefined?duration:250;var renderStack=[];var self=this;this.models=function(models){models=[].slice.call(arguments,0);models.forEach(function(model){model.__rendered=false;(function(m){m.dispatch.on('renderEnd',function(arg){m.__rendered=true;self.renderEnd('model');});})(model);if(renderStack.indexOf(model)<0){renderStack.push(model);}});return this;};this.reset=function(duration){if(duration!==undefined){_duration=duration;}
renderStack=[];};this.transition=function(selection,args,duration){args=arguments.length>1?[].slice.call(arguments,1):[];if(args.length>1){duration=args.pop();}else{duration=_duration!==undefined?_duration:250;}
selection.__rendered=false;if(renderStack.indexOf(selection)<0){renderStack.push(selection);}
if(duration===0){selection.__rendered=true;selection.delay=function(){return this;};selection.duration=function(){return this;};return selection;}else{if(selection.length===0){selection.__rendered=true;}else if(selection.every(function(d){return!d.length;})){selection.__rendered=true;}else{selection.__rendered=false;}
var n=0;return selection.transition().duration(duration).each(function(){++n;}).each('end',function(d,i){if(--n===0){selection.__rendered=true;self.renderEnd.apply(this,args);}});}};this.renderEnd=function(){if(renderStack.every(function(d){return d.__rendered;})){renderStack.forEach(function(d){d.__rendered=false;});dispatch.renderEnd.apply(this,arguments);}}};nv.utils.deepExtend=function(dst){var sources=arguments.length>1?[].slice.call(arguments,1):[];sources.forEach(function(source){for(var key in source){var isArray=dst[key]instanceof Array;var isObject=typeof dst[key]==='object';var srcObj=typeof source[key]==='object';if(isObject&&!isArray&&srcObj){nv.utils.deepExtend(dst[key],source[key]);}else{dst[key]=source[key];}}});};nv.utils.state=function(){if(!(this instanceof nv.utils.state)){return new nv.utils.state();}
var state={};var _self=this;var _setState=function(){};var _getState=function(){return{};};var init=null;var changed=null;this.dispatch=d3.dispatch('change','set');this.dispatch.on('set',function(state){_setState(state,true);});this.getter=function(fn){_getState=fn;return this;};this.setter=function(fn,callback){if(!callback){callback=function(){};}
_setState=function(state,update){fn(state);if(update){callback();}};return this;};this.init=function(state){init=init||{};nv.utils.deepExtend(init,state);};var _set=function(){var settings=_getState();if(JSON.stringify(settings)===JSON.stringify(state)){return false;}
for(var key in settings){if(state[key]===undefined){state[key]={};}
state[key]=settings[key];changed=true;}
return true;};this.update=function(){if(init){_setState(init,false);init=null;}
if(_set.call(this)){this.dispatch.change(state);}};};nv.utils.optionsFunc=function(args){if(args){d3.map(args).forEach((function(key,value){if(typeof this[key]==="function"){this[key](value);}}).bind(this));}
return this;};nv.utils.calcTicksX=function(numTicks,data){var numValues=1;var i=0;for(i;i<data.length;i+=1){var stream_len=data[i]&&data[i].values?data[i].values.length:0;numValues=stream_len>numValues?stream_len:numValues;}
nv.log("Requested number of ticks: ",numTicks);nv.log("Calculated max values to be: ",numValues);numTicks=numTicks>numValues?numTicks=numValues-1:numTicks;numTicks=numTicks<1?1:numTicks;numTicks=Math.floor(numTicks);nv.log("Calculating tick count as: ",numTicks);return numTicks;};nv.utils.calcTicksY=function(numTicks,data){return nv.utils.calcTicksX(numTicks,data);};nv.utils.initOption=function(chart,name){if(chart._calls&&chart._calls[name]){chart[name]=chart._calls[name];}else{chart[name]=function(_){if(!arguments.length)return chart._options[name];chart._overrides[name]=true;chart._options[name]=_;return chart;};chart['_'+name]=function(_){if(!arguments.length)return chart._options[name];if(!chart._overrides[name]){chart._options[name]=_;}
return chart;}}};nv.utils.initOptions=function(chart){chart._overrides=chart._overrides||{};var ops=Object.getOwnPropertyNames(chart._options||{});var calls=Object.getOwnPropertyNames(chart._calls||{});ops=ops.concat(calls);for(var i in ops){nv.utils.initOption(chart,ops[i]);}};nv.utils.inheritOptionsD3=function(target,d3_source,oplist){target._d3options=oplist.concat(target._d3options||[]);oplist.unshift(d3_source);oplist.unshift(target);d3.rebind.apply(this,oplist);};nv.utils.arrayUnique=function(a){return a.sort().filter(function(item,pos){return!pos||item!=a[pos-1];});};nv.utils.symbolMap=d3.map();nv.utils.symbol=function(){var type,size=64;function symbol(d,i){var t=type.call(this,d,i);var s=size.call(this,d,i);if(d3.svg.symbolTypes.indexOf(t)!==-1){return d3.svg.symbol().type(t).size(s)();}else{return nv.utils.symbolMap.get(t)(s);}}
symbol.type=function(_){if(!arguments.length)return type;type=d3.functor(_);return symbol;};symbol.size=function(_){if(!arguments.length)return size;size=d3.functor(_);return symbol;};return symbol;};nv.utils.inheritOptions=function(target,source){var ops=Object.getOwnPropertyNames(source._options||{});var calls=Object.getOwnPropertyNames(source._calls||{});var inherited=source._inherited||[];var d3ops=source._d3options||[];var args=ops.concat(calls).concat(inherited).concat(d3ops);args.unshift(source);args.unshift(target);d3.rebind.apply(this,args);target._inherited=nv.utils.arrayUnique(ops.concat(calls).concat(inherited).concat(ops).concat(target._inherited||[]));target._d3options=nv.utils.arrayUnique(d3ops.concat(target._d3options||[]));};nv.utils.initSVG=function(svg){svg.classed({'nvd3-svg':true});};nv.utils.sanitizeHeight=function(height,container){return(height||parseInt(container.style('height'),10)||400);};nv.utils.sanitizeWidth=function(width,container){return(width||parseInt(container.style('width'),10)||960);};nv.utils.availableHeight=function(height,container,margin){return nv.utils.sanitizeHeight(height,container)-margin.top-margin.bottom;};nv.utils.availableWidth=function(width,container,margin){return nv.utils.sanitizeWidth(width,container)-margin.left-margin.right;};nv.utils.noData=function(chart,container){var opt=chart.options(),margin=opt.margin(),noData=opt.noData(),data=(noData==null)?["No Data Available."]:[noData],height=nv.utils.availableHeight(null,container,margin),width=nv.utils.availableWidth(null,container,margin),x=margin.left+width/2,y=margin.top+height/2;container.selectAll('g').remove();var noDataText=container.selectAll('.nv-noData').data(data);noDataText.enter().append('text').attr('class','nvd3 nv-noData').attr('dy','-.7em').style('text-anchor','middle');noDataText.attr('x',x).attr('y',y).text(function(t){return t;});};nv.utils.wrapTicks=function(text,width){text.each(function(){var text=d3.select(this),words=text.text().split(/\s+/).reverse(),word,line=[],lineNumber=0,lineHeight=1.1,y=text.attr("y"),dy=parseFloat(text.attr("dy")),tspan=text.text(null).append("tspan").attr("x",0).attr("y",y).attr("dy",dy+"em");while(word=words.pop()){line.push(word);tspan.text(line.join(" "));if(tspan.node().getComputedTextLength()>width){line.pop();tspan.text(line.join(" "));line=[word];tspan=text.append("tspan").attr("x",0).attr("y",y).attr("dy",++lineNumber*lineHeight+dy+"em").text(word);}}});};nv.models.axis=function(){"use strict";var axis=d3.svg.axis();var scale=d3.scale.linear();var margin={top:0,right:0,bottom:0,left:0},width=75,height=60,axisLabelText=null,showMaxMin=true,rotateLabels=0,rotateYLabel=true,staggerLabels=false,isOrdinal=false,ticks=null,axisLabelDistance=0,duration=250,dispatch=d3.dispatch('renderEnd');axis.scale(scale).orient('bottom').tickFormat(function(d){return d});var scale0;var renderWatch=nv.utils.renderWatch(dispatch,duration);function chart(selection){renderWatch.reset();selection.each(function(data){var container=d3.select(this);nv.utils.initSVG(container);var wrap=container.selectAll('g.nv-wrap.nv-axis').data([data]);var wrapEnter=wrap.enter().append('g').attr('class','nvd3 nv-wrap nv-axis');var gEnter=wrapEnter.append('g');var g=wrap.select('g');if(ticks!==null)
axis.ticks(ticks);else if(axis.orient()=='top'||axis.orient()=='bottom')
axis.ticks(Math.abs(scale.range()[1]-scale.range()[0])/100);g.watchTransition(renderWatch,'axis').call(axis);scale0=scale0||axis.scale();var fmt=axis.tickFormat();if(fmt==null){fmt=scale0.tickFormat();}
var axisLabel=g.selectAll('text.nv-axislabel').data([axisLabelText||null]);axisLabel.exit().remove();var xLabelMargin;var axisMaxMin;var w;switch(axis.orient()){case'top':axisLabel.enter().append('text').attr('class','nv-axislabel');w=0;if(scale.range().length===1){w=isOrdinal?scale.range()[0]*2+scale.rangeBand():0;}else if(scale.range().length===2){w=isOrdinal?scale.range()[0]+scale.range()[1]+scale.rangeBand():scale.range()[1];}else if(scale.range().length>2){w=scale.range()[scale.range().length-1]+(scale.range()[1]-scale.range()[0]);};axisLabel.attr('text-anchor','middle').attr('y',0).attr('x',w/2);if(showMaxMin){axisMaxMin=wrap.selectAll('g.nv-axisMaxMin').data(scale.domain());axisMaxMin.enter().append('g').attr('class',function(d,i){return['nv-axisMaxMin','nv-axisMaxMin-x',(i==0?'nv-axisMin-x':'nv-axisMax-x')].join(' ')}).append('text');axisMaxMin.exit().remove();axisMaxMin.attr('transform',function(d,i){return'translate('+nv.utils.NaNtoZero(scale(d))+',0)'}).select('text').attr('dy','-0.5em').attr('y',-axis.tickPadding()).attr('text-anchor','middle').text(function(d,i){var v=fmt(d);return(''+v).match('NaN')?'':v;});axisMaxMin.watchTransition(renderWatch,'min-max top').attr('transform',function(d,i){return'translate('+nv.utils.NaNtoZero(scale.range()[i])+',0)'});}
break;case'bottom':xLabelMargin=axisLabelDistance+36;var maxTextWidth=30;var textHeight=0;var xTicks=g.selectAll('g').select("text");var rotateLabelsRule='';if(rotateLabels%360){xTicks.each(function(d,i){var box=this.getBoundingClientRect();var width=box.width;textHeight=box.height;if(width>maxTextWidth)maxTextWidth=width;});rotateLabelsRule='rotate('+rotateLabels+' 0,'+(textHeight/2+axis.tickPadding())+')';var sin=Math.abs(Math.sin(rotateLabels*Math.PI/180));xLabelMargin=(sin?sin*maxTextWidth:maxTextWidth)+30;xTicks.attr('transform',rotateLabelsRule).style('text-anchor',rotateLabels%360>0?'start':'end');}
axisLabel.enter().append('text').attr('class','nv-axislabel');w=0;if(scale.range().length===1){w=isOrdinal?scale.range()[0]*2+scale.rangeBand():0;}else if(scale.range().length===2){w=isOrdinal?scale.range()[0]+scale.range()[1]+scale.rangeBand():scale.range()[1];}else if(scale.range().length>2){w=scale.range()[scale.range().length-1]+(scale.range()[1]-scale.range()[0]);};axisLabel.attr('text-anchor','middle').attr('y',xLabelMargin).attr('x',w/2);if(showMaxMin){axisMaxMin=wrap.selectAll('g.nv-axisMaxMin').data([scale.domain()[0],scale.domain()[scale.domain().length-1]]);axisMaxMin.enter().append('g').attr('class',function(d,i){return['nv-axisMaxMin','nv-axisMaxMin-x',(i==0?'nv-axisMin-x':'nv-axisMax-x')].join(' ')}).append('text');axisMaxMin.exit().remove();axisMaxMin.attr('transform',function(d,i){return'translate('+nv.utils.NaNtoZero((scale(d)+(isOrdinal?scale.rangeBand()/2:0)))+',0)'}).select('text').attr('dy','.71em').attr('y',axis.tickPadding()).attr('transform',rotateLabelsRule).style('text-anchor',rotateLabels?(rotateLabels%360>0?'start':'end'):'middle').text(function(d,i){var v=fmt(d);return(''+v).match('NaN')?'':v;});axisMaxMin.watchTransition(renderWatch,'min-max bottom').attr('transform',function(d,i){return'translate('+nv.utils.NaNtoZero((scale(d)+(isOrdinal?scale.rangeBand()/2:0)))+',0)'});}
if(staggerLabels)
xTicks.attr('transform',function(d,i){return'translate(0,'+(i%2==0?'0':'12')+')'});break;case'right':axisLabel.enter().append('text').attr('class','nv-axislabel');axisLabel.style('text-anchor',rotateYLabel?'middle':'begin').attr('transform',rotateYLabel?'rotate(90)':'').attr('y',rotateYLabel?(-Math.max(margin.right,width)+12):-10).attr('x',rotateYLabel?(d3.max(scale.range())/2):axis.tickPadding());if(showMaxMin){axisMaxMin=wrap.selectAll('g.nv-axisMaxMin').data(scale.domain());axisMaxMin.enter().append('g').attr('class',function(d,i){return['nv-axisMaxMin','nv-axisMaxMin-y',(i==0?'nv-axisMin-y':'nv-axisMax-y')].join(' ')}).append('text').style('opacity',0);axisMaxMin.exit().remove();axisMaxMin.attr('transform',function(d,i){return'translate(0,'+nv.utils.NaNtoZero(scale(d))+')'}).select('text').attr('dy','.32em').attr('y',0).attr('x',axis.tickPadding()).style('text-anchor','start').text(function(d,i){var v=fmt(d);return(''+v).match('NaN')?'':v;});axisMaxMin.watchTransition(renderWatch,'min-max right').attr('transform',function(d,i){return'translate(0,'+nv.utils.NaNtoZero(scale.range()[i])+')'}).select('text').style('opacity',1);}
break;case'left':axisLabel.enter().append('text').attr('class','nv-axislabel');axisLabel.style('text-anchor',rotateYLabel?'middle':'end').attr('transform',rotateYLabel?'rotate(-90)':'').attr('y',rotateYLabel?(-Math.max(margin.left,width)+25-(axisLabelDistance||0)):-10).attr('x',rotateYLabel?(-d3.max(scale.range())/2):-axis.tickPadding());if(showMaxMin){axisMaxMin=wrap.selectAll('g.nv-axisMaxMin').data(scale.domain());axisMaxMin.enter().append('g').attr('class',function(d,i){return['nv-axisMaxMin','nv-axisMaxMin-y',(i==0?'nv-axisMin-y':'nv-axisMax-y')].join(' ')}).append('text').style('opacity',0);axisMaxMin.exit().remove();axisMaxMin.attr('transform',function(d,i){return'translate(0,'+nv.utils.NaNtoZero(scale0(d))+')'}).select('text').attr('dy','.32em').attr('y',0).attr('x',-axis.tickPadding()).attr('text-anchor','end').text(function(d,i){var v=fmt(d);return(''+v).match('NaN')?'':v;});axisMaxMin.watchTransition(renderWatch,'min-max right').attr('transform',function(d,i){return'translate(0,'+nv.utils.NaNtoZero(scale.range()[i])+')'}).select('text').style('opacity',1);}
break;}
axisLabel.text(function(d){return d});if(showMaxMin&&(axis.orient()==='left'||axis.orient()==='right')){g.selectAll('g').each(function(d,i){d3.select(this).select('text').attr('opacity',1);if(scale(d)<scale.range()[1]+10||scale(d)>scale.range()[0]-10){if(d>1e-10||d<-1e-10)
d3.select(this).attr('opacity',0);d3.select(this).select('text').attr('opacity',0);}});if(scale.domain()[0]==scale.domain()[1]&&scale.domain()[0]==0){wrap.selectAll('g.nv-axisMaxMin').style('opacity',function(d,i){return!i?1:0});}}
if(showMaxMin&&(axis.orient()==='top'||axis.orient()==='bottom')){var maxMinRange=[];wrap.selectAll('g.nv-axisMaxMin').each(function(d,i){try{if(i)
maxMinRange.push(scale(d)-this.getBoundingClientRect().width-4);else
maxMinRange.push(scale(d)+this.getBoundingClientRect().width+4)}catch(err){if(i)
maxMinRange.push(scale(d)-4);else
maxMinRange.push(scale(d)+4);}});g.selectAll('g').each(function(d,i){if(scale(d)<maxMinRange[0]||scale(d)>maxMinRange[1]){if(d>1e-10||d<-1e-10)
d3.select(this).remove();else
d3.select(this).select('text').remove();}});}
g.selectAll('.tick').filter(function(d){return!parseFloat(Math.round(d*100000)/1000000)&&(d!==undefined)}).classed('zero',true);scale0=scale.copy();});renderWatch.renderEnd('axis immediate');return chart;}
chart.axis=axis;chart.dispatch=dispatch;chart.options=nv.utils.optionsFunc.bind(chart);chart._options=Object.create({},{axisLabelDistance:{get:function(){return axisLabelDistance;},set:function(_){axisLabelDistance=_;}},staggerLabels:{get:function(){return staggerLabels;},set:function(_){staggerLabels=_;}},rotateLabels:{get:function(){return rotateLabels;},set:function(_){rotateLabels=_;}},rotateYLabel:{get:function(){return rotateYLabel;},set:function(_){rotateYLabel=_;}},showMaxMin:{get:function(){return showMaxMin;},set:function(_){showMaxMin=_;}},axisLabel:{get:function(){return axisLabelText;},set:function(_){axisLabelText=_;}},height:{get:function(){return height;},set:function(_){height=_;}},ticks:{get:function(){return ticks;},set:function(_){ticks=_;}},width:{get:function(){return width;},set:function(_){width=_;}},margin:{get:function(){return margin;},set:function(_){margin.top=_.top!==undefined?_.top:margin.top;margin.right=_.right!==undefined?_.right:margin.right;margin.bottom=_.bottom!==undefined?_.bottom:margin.bottom;margin.left=_.left!==undefined?_.left:margin.left;}},duration:{get:function(){return duration;},set:function(_){duration=_;renderWatch.reset(duration);}},scale:{get:function(){return scale;},set:function(_){scale=_;axis.scale(scale);isOrdinal=typeof scale.rangeBands==='function';nv.utils.inheritOptionsD3(chart,scale,['domain','range','rangeBand','rangeBands']);}}});nv.utils.initOptions(chart);nv.utils.inheritOptionsD3(chart,axis,['orient','tickValues','tickSubdivide','tickSize','tickPadding','tickFormat']);nv.utils.inheritOptionsD3(chart,scale,['domain','range','rangeBand','rangeBands']);return chart;};nv.models.boxPlot=function(){"use strict";var margin={top:0,right:0,bottom:0,left:0},width=960,height=500,id=Math.floor(Math.random()*10000),x=d3.scale.ordinal(),y=d3.scale.linear(),getX=function(d){return d.x},getY=function(d){return d.y},color=nv.utils.defaultColor(),container=null,xDomain,yDomain,xRange,yRange,dispatch=d3.dispatch('elementMouseover','elementMouseout','elementMousemove','renderEnd'),duration=250,maxBoxWidth=null;var x0,y0;var renderWatch=nv.utils.renderWatch(dispatch,duration);function chart(selection){renderWatch.reset();selection.each(function(data){var availableWidth=width-margin.left-margin.right,availableHeight=height-margin.top-margin.bottom;container=d3.select(this);nv.utils.initSVG(container);x.domain(xDomain||data.map(function(d,i){return getX(d,i);})).rangeBands(xRange||[0,availableWidth],.1);var yData=[]
if(!yDomain){var yMin=d3.min(data.map(function(d){var min_arr=[];min_arr.push(d.values.Q1);if(d.values.hasOwnProperty('whisker_low')&&d.values.whisker_low!==null){min_arr.push(d.values.whisker_low);}
if(d.values.hasOwnProperty('outliers')&&d.values.outliers!==null){min_arr=min_arr.concat(d.values.outliers);}
return d3.min(min_arr);}));var yMax=d3.max(data.map(function(d){var max_arr=[];max_arr.push(d.values.Q3);if(d.values.hasOwnProperty('whisker_high')&&d.values.whisker_high!==null){max_arr.push(d.values.whisker_high);}
if(d.values.hasOwnProperty('outliers')&&d.values.outliers!==null){max_arr=max_arr.concat(d.values.outliers);}
return d3.max(max_arr);}));yData=[yMin,yMax];}
y.domain(yDomain||yData);y.range(yRange||[availableHeight,0]);x0=x0||x;y0=y0||y.copy().range([y(0),y(0)]);var wrap=container.selectAll('g.nv-wrap').data([data]);var wrapEnter=wrap.enter().append('g').attr('class','nvd3 nv-wrap');wrap.attr('transform','translate('+margin.left+','+margin.top+')');var boxplots=wrap.selectAll('.nv-boxplot').data(function(d){return d});var boxEnter=boxplots.enter().append('g').style('stroke-opacity',1e-6).style('fill-opacity',1e-6);boxplots.attr('class','nv-boxplot').attr('transform',function(d,i,j){return'translate('+(x(getX(d,i))+x.rangeBand()*.05)+', 0)';}).classed('hover',function(d){return d.hover});boxplots.watchTransition(renderWatch,'nv-boxplot: boxplots').style('stroke-opacity',1).style('fill-opacity',.75).delay(function(d,i){return i*duration/data.length}).attr('transform',function(d,i){return'translate('+(x(getX(d,i))+x.rangeBand()*.05)+', 0)';});boxplots.exit().remove();boxEnter.each(function(d,i){var box=d3.select(this);['low','high'].forEach(function(key){if(d.values.hasOwnProperty('whisker_'+key)&&d.values['whisker_'+key]!==null){box.append('line').style('stroke',(d.color)?d.color:color(d,i)).attr('class','nv-boxplot-whisker nv-boxplot-'+key);box.append('line').style('stroke',(d.color)?d.color:color(d,i)).attr('class','nv-boxplot-tick nv-boxplot-'+key);}});});var outliers=boxplots.selectAll('.nv-boxplot-outlier').data(function(d){if(d.values.hasOwnProperty('outliers')&&d.values.outliers!==null){return d.values.outliers;}
else{return[];}});outliers.enter().append('circle').style('fill',function(d,i,j){return color(d,j)}).style('stroke',function(d,i,j){return color(d,j)}).on('mouseover',function(d,i,j){d3.select(this).classed('hover',true);dispatch.elementMouseover({series:{key:d,color:color(d,j)},e:d3.event});}).on('mouseout',function(d,i,j){d3.select(this).classed('hover',false);dispatch.elementMouseout({series:{key:d,color:color(d,j)},e:d3.event});}).on('mousemove',function(d,i){dispatch.elementMousemove({e:d3.event});});outliers.attr('class','nv-boxplot-outlier');outliers.watchTransition(renderWatch,'nv-boxplot: nv-boxplot-outlier').attr('cx',x.rangeBand()*.45).attr('cy',function(d,i,j){return y(d);}).attr('r','3');outliers.exit().remove();var box_width=function(){return(maxBoxWidth===null?x.rangeBand()*.9:Math.min(75,x.rangeBand()*.9));};var box_left=function(){return x.rangeBand()*.45-box_width()/2;};var box_right=function(){return x.rangeBand()*.45+box_width()/2;};['low','high'].forEach(function(key){var endpoint=(key==='low')?'Q1':'Q3';boxplots.select('line.nv-boxplot-whisker.nv-boxplot-'+key).watchTransition(renderWatch,'nv-boxplot: boxplots').attr('x1',x.rangeBand()*.45).attr('y1',function(d,i){return y(d.values['whisker_'+key]);}).attr('x2',x.rangeBand()*.45).attr('y2',function(d,i){return y(d.values[endpoint]);});boxplots.select('line.nv-boxplot-tick.nv-boxplot-'+key).watchTransition(renderWatch,'nv-boxplot: boxplots').attr('x1',box_left).attr('y1',function(d,i){return y(d.values['whisker_'+key]);}).attr('x2',box_right).attr('y2',function(d,i){return y(d.values['whisker_'+key]);});});['low','high'].forEach(function(key){boxEnter.selectAll('.nv-boxplot-'+key).on('mouseover',function(d,i,j){d3.select(this).classed('hover',true);dispatch.elementMouseover({series:{key:d.values['whisker_'+key],color:color(d,j)},e:d3.event});}).on('mouseout',function(d,i,j){d3.select(this).classed('hover',false);dispatch.elementMouseout({series:{key:d.values['whisker_'+key],color:color(d,j)},e:d3.event});}).on('mousemove',function(d,i){dispatch.elementMousemove({e:d3.event});});});boxEnter.append('rect').attr('class','nv-boxplot-box').on('mouseover',function(d,i){d3.select(this).classed('hover',true);dispatch.elementMouseover({key:d.label,value:d.label,series:[{key:'Q3',value:d.values.Q3,color:d.color||color(d,i)},{key:'Q2',value:d.values.Q2,color:d.color||color(d,i)},{key:'Q1',value:d.values.Q1,color:d.color||color(d,i)}],data:d,index:i,e:d3.event});}).on('mouseout',function(d,i){d3.select(this).classed('hover',false);dispatch.elementMouseout({key:d.label,value:d.label,series:[{key:'Q3',value:d.values.Q3,color:d.color||color(d,i)},{key:'Q2',value:d.values.Q2,color:d.color||color(d,i)},{key:'Q1',value:d.values.Q1,color:d.color||color(d,i)}],data:d,index:i,e:d3.event});}).on('mousemove',function(d,i){dispatch.elementMousemove({e:d3.event});});boxplots.select('rect.nv-boxplot-box').watchTransition(renderWatch,'nv-boxplot: boxes').attr('y',function(d,i){return y(d.values.Q3);}).attr('width',box_width).attr('x',box_left).attr('height',function(d,i){return Math.abs(y(d.values.Q3)-y(d.values.Q1))||1}).style('fill',function(d,i){return d.color||color(d,i)}).style('stroke',function(d,i){return d.color||color(d,i)});boxEnter.append('line').attr('class','nv-boxplot-median');boxplots.select('line.nv-boxplot-median').watchTransition(renderWatch,'nv-boxplot: boxplots line').attr('x1',box_left).attr('y1',function(d,i){return y(d.values.Q2);}).attr('x2',box_right).attr('y2',function(d,i){return y(d.values.Q2);});x0=x.copy();y0=y.copy();});renderWatch.renderEnd('nv-boxplot immediate');return chart;}
chart.dispatch=dispatch;chart.options=nv.utils.optionsFunc.bind(chart);chart._options=Object.create({},{width:{get:function(){return width;},set:function(_){width=_;}},height:{get:function(){return height;},set:function(_){height=_;}},maxBoxWidth:{get:function(){return maxBoxWidth;},set:function(_){maxBoxWidth=_;}},x:{get:function(){return getX;},set:function(_){getX=_;}},y:{get:function(){return getY;},set:function(_){getY=_;}},xScale:{get:function(){return x;},set:function(_){x=_;}},yScale:{get:function(){return y;},set:function(_){y=_;}},xDomain:{get:function(){return xDomain;},set:function(_){xDomain=_;}},yDomain:{get:function(){return yDomain;},set:function(_){yDomain=_;}},xRange:{get:function(){return xRange;},set:function(_){xRange=_;}},yRange:{get:function(){return yRange;},set:function(_){yRange=_;}},id:{get:function(){return id;},set:function(_){id=_;}},margin:{get:function(){return margin;},set:function(_){margin.top=_.top!==undefined?_.top:margin.top;margin.right=_.right!==undefined?_.right:margin.right;margin.bottom=_.bottom!==undefined?_.bottom:margin.bottom;margin.left=_.left!==undefined?_.left:margin.left;}},color:{get:function(){return color;},set:function(_){color=nv.utils.getColor(_);}},duration:{get:function(){return duration;},set:function(_){duration=_;renderWatch.reset(duration);}}});nv.utils.initOptions(chart);return chart;};nv.models.boxPlotChart=function(){"use strict";var boxplot=nv.models.boxPlot(),xAxis=nv.models.axis(),yAxis=nv.models.axis();var margin={top:15,right:10,bottom:50,left:60},width=null,height=null,color=nv.utils.getColor(),showXAxis=true,showYAxis=true,rightAlignYAxis=false,staggerLabels=false,tooltip=nv.models.tooltip(),x,y,noData="No Data Available.",dispatch=d3.dispatch('beforeUpdate','renderEnd'),duration=250;xAxis.orient('bottom').showMaxMin(false).tickFormat(function(d){return d});yAxis.orient((rightAlignYAxis)?'right':'left').tickFormat(d3.format(',.1f'));tooltip.duration(0);var renderWatch=nv.utils.renderWatch(dispatch,duration);function chart(selection){renderWatch.reset();renderWatch.models(boxplot);if(showXAxis)renderWatch.models(xAxis);if(showYAxis)renderWatch.models(yAxis);selection.each(function(data){var container=d3.select(this),that=this;nv.utils.initSVG(container);var availableWidth=(width||parseInt(container.style('width'))||960)
-margin.left-margin.right,availableHeight=(height||parseInt(container.style('height'))||400)
-margin.top-margin.bottom;chart.update=function(){dispatch.beforeUpdate();container.transition().duration(duration).call(chart);};chart.container=this;if(!data||!data.length||!data.filter(function(d){return d.values.hasOwnProperty("Q1")&&d.values.hasOwnProperty("Q2")&&d.values.hasOwnProperty("Q3");}).length){var noDataText=container.selectAll('.nv-noData').data([noData]);noDataText.enter().append('text').attr('class','nvd3 nv-noData').attr('dy','-.7em').style('text-anchor','middle');noDataText.attr('x',margin.left+availableWidth/2).attr('y',margin.top+availableHeight/2).text(function(d){return d});return chart;}else{container.selectAll('.nv-noData').remove();}
x=boxplot.xScale();y=boxplot.yScale().clamp(true);var wrap=container.selectAll('g.nv-wrap.nv-boxPlotWithAxes').data([data]);var gEnter=wrap.enter().append('g').attr('class','nvd3 nv-wrap nv-boxPlotWithAxes').append('g');var defsEnter=gEnter.append('defs');var g=wrap.select('g');gEnter.append('g').attr('class','nv-x nv-axis');gEnter.append('g').attr('class','nv-y nv-axis').append('g').attr('class','nv-zeroLine').append('line');gEnter.append('g').attr('class','nv-barsWrap');g.attr('transform','translate('+margin.left+','+margin.top+')');if(rightAlignYAxis){g.select(".nv-y.nv-axis").attr("transform","translate("+availableWidth+",0)");}
boxplot.width(availableWidth).height(availableHeight);var barsWrap=g.select('.nv-barsWrap').datum(data.filter(function(d){return!d.disabled}))
barsWrap.transition().call(boxplot);defsEnter.append('clipPath').attr('id','nv-x-label-clip-'+boxplot.id()).append('rect');g.select('#nv-x-label-clip-'+boxplot.id()+' rect').attr('width',x.rangeBand()*(staggerLabels?2:1)).attr('height',16).attr('x',-x.rangeBand()/(staggerLabels?1:2));if(showXAxis){xAxis.scale(x).ticks(nv.utils.calcTicksX(availableWidth/100,data)).tickSize(-availableHeight,0);g.select('.nv-x.nv-axis').attr('transform','translate(0,'+y.range()[0]+')');g.select('.nv-x.nv-axis').call(xAxis);var xTicks=g.select('.nv-x.nv-axis').selectAll('g');if(staggerLabels){xTicks.selectAll('text').attr('transform',function(d,i,j){return'translate(0,'+(j%2==0?'5':'17')+')'})}}
if(showYAxis){yAxis.scale(y).ticks(Math.floor(availableHeight/36)).tickSize(-availableWidth,0);g.select('.nv-y.nv-axis').call(yAxis);}
g.select(".nv-zeroLine line").attr("x1",0).attr("x2",availableWidth).attr("y1",y(0)).attr("y2",y(0));});renderWatch.renderEnd('nv-boxplot chart immediate');return chart;}
boxplot.dispatch.on('elementMouseover.tooltip',function(evt){tooltip.data(evt).hidden(false);});boxplot.dispatch.on('elementMouseout.tooltip',function(evt){tooltip.data(evt).hidden(true);});boxplot.dispatch.on('elementMousemove.tooltip',function(evt){tooltip();});chart.dispatch=dispatch;chart.boxplot=boxplot;chart.xAxis=xAxis;chart.yAxis=yAxis;chart.tooltip=tooltip;chart.options=nv.utils.optionsFunc.bind(chart);chart._options=Object.create({},{width:{get:function(){return width;},set:function(_){width=_;}},height:{get:function(){return height;},set:function(_){height=_;}},staggerLabels:{get:function(){return staggerLabels;},set:function(_){staggerLabels=_;}},showXAxis:{get:function(){return showXAxis;},set:function(_){showXAxis=_;}},showYAxis:{get:function(){return showYAxis;},set:function(_){showYAxis=_;}},tooltipContent:{get:function(){return tooltip;},set:function(_){tooltip=_;}},noData:{get:function(){return noData;},set:function(_){noData=_;}},margin:{get:function(){return margin;},set:function(_){margin.top=_.top!==undefined?_.top:margin.top;margin.right=_.right!==undefined?_.right:margin.right;margin.bottom=_.bottom!==undefined?_.bottom:margin.bottom;margin.left=_.left!==undefined?_.left:margin.left;}},duration:{get:function(){return duration;},set:function(_){duration=_;renderWatch.reset(duration);boxplot.duration(duration);xAxis.duration(duration);yAxis.duration(duration);}},color:{get:function(){return color;},set:function(_){color=nv.utils.getColor(_);boxplot.color(color);}},rightAlignYAxis:{get:function(){return rightAlignYAxis;},set:function(_){rightAlignYAxis=_;yAxis.orient((_)?'right':'left');}}});nv.utils.inheritOptions(chart,boxplot);nv.utils.initOptions(chart);return chart;}
nv.models.bullet=function(){"use strict";var margin={top:0,right:0,bottom:0,left:0},orient='left',reverse=false,ranges=function(d){return d.ranges},markers=function(d){return d.markers?d.markers:[0]},measures=function(d){return d.measures},rangeLabels=function(d){return d.rangeLabels?d.rangeLabels:[]},markerLabels=function(d){return d.markerLabels?d.markerLabels:[]},measureLabels=function(d){return d.measureLabels?d.measureLabels:[]},forceX=[0],width=380,height=30,container=null,tickFormat=null,color=nv.utils.getColor(['#1f77b4']),dispatch=d3.dispatch('elementMouseover','elementMouseout','elementMousemove');function chart(selection){selection.each(function(d,i){var availableWidth=width-margin.left-margin.right,availableHeight=height-margin.top-margin.bottom;container=d3.select(this);nv.utils.initSVG(container);var rangez=ranges.call(this,d,i).slice().sort(d3.descending),markerz=markers.call(this,d,i).slice().sort(d3.descending),measurez=measures.call(this,d,i).slice().sort(d3.descending),rangeLabelz=rangeLabels.call(this,d,i).slice(),markerLabelz=markerLabels.call(this,d,i).slice(),measureLabelz=measureLabels.call(this,d,i).slice();var x1=d3.scale.linear().domain(d3.extent(d3.merge([forceX,rangez]))).range(reverse?[availableWidth,0]:[0,availableWidth]);var x0=this.__chart__||d3.scale.linear().domain([0,Infinity]).range(x1.range());this.__chart__=x1;var rangeMin=d3.min(rangez),rangeMax=d3.max(rangez),rangeAvg=rangez[1];var wrap=container.selectAll('g.nv-wrap.nv-bullet').data([d]);var wrapEnter=wrap.enter().append('g').attr('class','nvd3 nv-wrap nv-bullet');var gEnter=wrapEnter.append('g');var g=wrap.select('g');gEnter.append('rect').attr('class','nv-range nv-rangeMax');gEnter.append('rect').attr('class','nv-range nv-rangeAvg');gEnter.append('rect').attr('class','nv-range nv-rangeMin');gEnter.append('rect').attr('class','nv-measure');wrap.attr('transform','translate('+margin.left+','+margin.top+')');var w0=function(d){return Math.abs(x0(d)-x0(0))},w1=function(d){return Math.abs(x1(d)-x1(0))};var xp0=function(d){return d<0?x0(d):x0(0)},xp1=function(d){return d<0?x1(d):x1(0)};g.select('rect.nv-rangeMax').attr('height',availableHeight).attr('width',w1(rangeMax>0?rangeMax:rangeMin)).attr('x',xp1(rangeMax>0?rangeMax:rangeMin)).datum(rangeMax>0?rangeMax:rangeMin)
g.select('rect.nv-rangeAvg').attr('height',availableHeight).attr('width',w1(rangeAvg)).attr('x',xp1(rangeAvg)).datum(rangeAvg)
g.select('rect.nv-rangeMin').attr('height',availableHeight).attr('width',w1(rangeMax)).attr('x',xp1(rangeMax)).attr('width',w1(rangeMax>0?rangeMin:rangeMax)).attr('x',xp1(rangeMax>0?rangeMin:rangeMax)).datum(rangeMax>0?rangeMin:rangeMax)
g.select('rect.nv-measure').style('fill',color).attr('height',availableHeight/3).attr('y',availableHeight/3).attr('width',measurez<0?x1(0)-x1(measurez[0]):x1(measurez[0])-x1(0)).attr('x',xp1(measurez)).on('mouseover',function(){dispatch.elementMouseover({value:measurez[0],label:measureLabelz[0]||'Current',color:d3.select(this).style("fill")})}).on('mousemove',function(){dispatch.elementMousemove({value:measurez[0],label:measureLabelz[0]||'Current',color:d3.select(this).style("fill")})}).on('mouseout',function(){dispatch.elementMouseout({value:measurez[0],label:measureLabelz[0]||'Current',color:d3.select(this).style("fill")})});var h3=availableHeight/6;var markerData=markerz.map(function(marker,index){return{value:marker,label:markerLabelz[index]}});gEnter.selectAll("path.nv-markerTriangle").data(markerData).enter().append('path').attr('class','nv-markerTriangle').attr('transform',function(d){return'translate('+x1(d.value)+','+(availableHeight/2)+')'}).attr('d','M0,'+h3+'L'+h3+','+(-h3)+' '+(-h3)+','+(-h3)+'Z').on('mouseover',function(d){dispatch.elementMouseover({value:d.value,label:d.label||'Previous',color:d3.select(this).style("fill"),pos:[x1(d.value),availableHeight/2]})}).on('mousemove',function(d){dispatch.elementMousemove({value:d.value,label:d.label||'Previous',color:d3.select(this).style("fill")})}).on('mouseout',function(d,i){dispatch.elementMouseout({value:d.value,label:d.label||'Previous',color:d3.select(this).style("fill")})});wrap.selectAll('.nv-range').on('mouseover',function(d,i){var label=rangeLabelz[i]||(!i?"Maximum":i==1?"Mean":"Minimum");dispatch.elementMouseover({value:d,label:label,color:d3.select(this).style("fill")})}).on('mousemove',function(){dispatch.elementMousemove({value:measurez[0],label:measureLabelz[0]||'Previous',color:d3.select(this).style("fill")})}).on('mouseout',function(d,i){var label=rangeLabelz[i]||(!i?"Maximum":i==1?"Mean":"Minimum");dispatch.elementMouseout({value:d,label:label,color:d3.select(this).style("fill")})});});return chart;}
chart.dispatch=dispatch;chart.options=nv.utils.optionsFunc.bind(chart);chart._options=Object.create({},{ranges:{get:function(){return ranges;},set:function(_){ranges=_;}},markers:{get:function(){return markers;},set:function(_){markers=_;}},measures:{get:function(){return measures;},set:function(_){measures=_;}},forceX:{get:function(){return forceX;},set:function(_){forceX=_;}},width:{get:function(){return width;},set:function(_){width=_;}},height:{get:function(){return height;},set:function(_){height=_;}},tickFormat:{get:function(){return tickFormat;},set:function(_){tickFormat=_;}},margin:{get:function(){return margin;},set:function(_){margin.top=_.top!==undefined?_.top:margin.top;margin.right=_.right!==undefined?_.right:margin.right;margin.bottom=_.bottom!==undefined?_.bottom:margin.bottom;margin.left=_.left!==undefined?_.left:margin.left;}},orient:{get:function(){return orient;},set:function(_){orient=_;reverse=orient=='right'||orient=='bottom';}},color:{get:function(){return color;},set:function(_){color=nv.utils.getColor(_);}}});nv.utils.initOptions(chart);return chart;};nv.models.bulletChart=function(){"use strict";var bullet=nv.models.bullet();var tooltip=nv.models.tooltip();var orient='left',reverse=false,margin={top:5,right:40,bottom:20,left:120},ranges=function(d){return d.ranges},markers=function(d){return d.markers?d.markers:[0]},measures=function(d){return d.measures},width=null,height=55,tickFormat=null,ticks=null,noData=null,dispatch=d3.dispatch();tooltip.duration(0).headerEnabled(false);function chart(selection){selection.each(function(d,i){var container=d3.select(this);nv.utils.initSVG(container);var availableWidth=nv.utils.availableWidth(width,container,margin),availableHeight=height-margin.top-margin.bottom,that=this;chart.update=function(){chart(selection)};chart.container=this;if(!d||!ranges.call(this,d,i)){nv.utils.noData(chart,container)
return chart;}else{container.selectAll('.nv-noData').remove();}
var rangez=ranges.call(this,d,i).slice().sort(d3.descending),markerz=markers.call(this,d,i).slice().sort(d3.descending),measurez=measures.call(this,d,i).slice().sort(d3.descending);var wrap=container.selectAll('g.nv-wrap.nv-bulletChart').data([d]);var wrapEnter=wrap.enter().append('g').attr('class','nvd3 nv-wrap nv-bulletChart');var gEnter=wrapEnter.append('g');var g=wrap.select('g');gEnter.append('g').attr('class','nv-bulletWrap');gEnter.append('g').attr('class','nv-titles');wrap.attr('transform','translate('+margin.left+','+margin.top+')');var x1=d3.scale.linear().domain([0,Math.max(rangez[0],markerz[0],measurez[0])]).range(reverse?[availableWidth,0]:[0,availableWidth]);var x0=this.__chart__||d3.scale.linear().domain([0,Infinity]).range(x1.range());this.__chart__=x1;var w0=function(d){return Math.abs(x0(d)-x0(0))},w1=function(d){return Math.abs(x1(d)-x1(0))};var title=gEnter.select('.nv-titles').append('g').attr('text-anchor','end').attr('transform','translate(-6,'+(height-margin.top-margin.bottom)/2+')');title.append('text').attr('class','nv-title').text(function(d){return d.title;});title.append('text').attr('class','nv-subtitle').attr('dy','1em').text(function(d){return d.subtitle;});bullet.width(availableWidth).height(availableHeight)
var bulletWrap=g.select('.nv-bulletWrap');d3.transition(bulletWrap).call(bullet);var format=tickFormat||x1.tickFormat(availableWidth/100);var tick=g.selectAll('g.nv-tick').data(x1.ticks(ticks?ticks:(availableWidth/50)),function(d){return this.textContent||format(d);});var tickEnter=tick.enter().append('g').attr('class','nv-tick').attr('transform',function(d){return'translate('+x0(d)+',0)'}).style('opacity',1e-6);tickEnter.append('line').attr('y1',availableHeight).attr('y2',availableHeight*7/6);tickEnter.append('text').attr('text-anchor','middle').attr('dy','1em').attr('y',availableHeight*7/6).text(format);var tickUpdate=d3.transition(tick).attr('transform',function(d){return'translate('+x1(d)+',0)'}).style('opacity',1);tickUpdate.select('line').attr('y1',availableHeight).attr('y2',availableHeight*7/6);tickUpdate.select('text').attr('y',availableHeight*7/6);d3.transition(tick.exit()).attr('transform',function(d){return'translate('+x1(d)+',0)'}).style('opacity',1e-6).remove();});d3.timer.flush();return chart;}
bullet.dispatch.on('elementMouseover.tooltip',function(evt){evt['series']={key:evt.label,value:evt.value,color:evt.color};tooltip.data(evt).hidden(false);});bullet.dispatch.on('elementMouseout.tooltip',function(evt){tooltip.hidden(true);});bullet.dispatch.on('elementMousemove.tooltip',function(evt){tooltip();});chart.bullet=bullet;chart.dispatch=dispatch;chart.tooltip=tooltip;chart.options=nv.utils.optionsFunc.bind(chart);chart._options=Object.create({},{ranges:{get:function(){return ranges;},set:function(_){ranges=_;}},markers:{get:function(){return markers;},set:function(_){markers=_;}},measures:{get:function(){return measures;},set:function(_){measures=_;}},width:{get:function(){return width;},set:function(_){width=_;}},height:{get:function(){return height;},set:function(_){height=_;}},tickFormat:{get:function(){return tickFormat;},set:function(_){tickFormat=_;}},ticks:{get:function(){return ticks;},set:function(_){ticks=_;}},noData:{get:function(){return noData;},set:function(_){noData=_;}},margin:{get:function(){return margin;},set:function(_){margin.top=_.top!==undefined?_.top:margin.top;margin.right=_.right!==undefined?_.right:margin.right;margin.bottom=_.bottom!==undefined?_.bottom:margin.bottom;margin.left=_.left!==undefined?_.left:margin.left;}},orient:{get:function(){return orient;},set:function(_){orient=_;reverse=orient=='right'||orient=='bottom';}}});nv.utils.inheritOptions(chart,bullet);nv.utils.initOptions(chart);return chart;};nv.models.candlestickBar=function(){"use strict";var margin={top:0,right:0,bottom:0,left:0},width=null,height=null,id=Math.floor(Math.random()*10000),container,x=d3.scale.linear(),y=d3.scale.linear(),getX=function(d){return d.x},getY=function(d){return d.y},getOpen=function(d){return d.open},getClose=function(d){return d.close},getHigh=function(d){return d.high},getLow=function(d){return d.low},forceX=[],forceY=[],padData=false,clipEdge=true,color=nv.utils.defaultColor(),interactive=false,xDomain,yDomain,xRange,yRange,dispatch=d3.dispatch('stateChange','changeState','renderEnd','chartClick','elementClick','elementDblClick','elementMouseover','elementMouseout','elementMousemove');function chart(selection){selection.each(function(data){container=d3.select(this);var availableWidth=nv.utils.availableWidth(width,container,margin),availableHeight=nv.utils.availableHeight(height,container,margin);nv.utils.initSVG(container);var barWidth=(availableWidth/data[0].values.length)*.45;x.domain(xDomain||d3.extent(data[0].values.map(getX).concat(forceX)));if(padData)
x.range(xRange||[availableWidth*.5/data[0].values.length,availableWidth*(data[0].values.length-.5)/data[0].values.length]);else
x.range(xRange||[5+barWidth/2,availableWidth-barWidth/2-5]);y.domain(yDomain||[d3.min(data[0].values.map(getLow).concat(forceY)),d3.max(data[0].values.map(getHigh).concat(forceY))]).range(yRange||[availableHeight,0]);if(x.domain()[0]===x.domain()[1])
x.domain()[0]?x.domain([x.domain()[0]-x.domain()[0]*0.01,x.domain()[1]+x.domain()[1]*0.01]):x.domain([-1,1]);if(y.domain()[0]===y.domain()[1])
y.domain()[0]?y.domain([y.domain()[0]+y.domain()[0]*0.01,y.domain()[1]-y.domain()[1]*0.01]):y.domain([-1,1]);var wrap=d3.select(this).selectAll('g.nv-wrap.nv-candlestickBar').data([data[0].values]);var wrapEnter=wrap.enter().append('g').attr('class','nvd3 nv-wrap nv-candlestickBar');var defsEnter=wrapEnter.append('defs');var gEnter=wrapEnter.append('g');var g=wrap.select('g');gEnter.append('g').attr('class','nv-ticks');wrap.attr('transform','translate('+margin.left+','+margin.top+')');container.on('click',function(d,i){dispatch.chartClick({data:d,index:i,pos:d3.event,id:id});});defsEnter.append('clipPath').attr('id','nv-chart-clip-path-'+id).append('rect');wrap.select('#nv-chart-clip-path-'+id+' rect').attr('width',availableWidth).attr('height',availableHeight);g.attr('clip-path',clipEdge?'url(#nv-chart-clip-path-'+id+')':'');var ticks=wrap.select('.nv-ticks').selectAll('.nv-tick').data(function(d){return d});ticks.exit().remove();var tickGroups=ticks.enter().append('g');ticks.attr('class',function(d,i,j){return(getOpen(d,i)>getClose(d,i)?'nv-tick negative':'nv-tick positive')+' nv-tick-'+j+'-'+i});var lines=tickGroups.append('line').attr('class','nv-candlestick-lines').attr('transform',function(d,i){return'translate('+x(getX(d,i))+',0)';}).attr('x1',0).attr('y1',function(d,i){return y(getHigh(d,i));}).attr('x2',0).attr('y2',function(d,i){return y(getLow(d,i));});var rects=tickGroups.append('rect').attr('class','nv-candlestick-rects nv-bars').attr('transform',function(d,i){return'translate('+(x(getX(d,i))-barWidth/2)+','
+(y(getY(d,i))-(getOpen(d,i)>getClose(d,i)?(y(getClose(d,i))-y(getOpen(d,i))):0))
+')';}).attr('x',0).attr('y',0).attr('width',barWidth).attr('height',function(d,i){var open=getOpen(d,i);var close=getClose(d,i);return open>close?y(close)-y(open):y(open)-y(close);});ticks.select('.nv-candlestick-lines').transition().attr('transform',function(d,i){return'translate('+x(getX(d,i))+',0)';}).attr('x1',0).attr('y1',function(d,i){return y(getHigh(d,i));}).attr('x2',0).attr('y2',function(d,i){return y(getLow(d,i));});ticks.select('.nv-candlestick-rects').transition().attr('transform',function(d,i){return'translate('+(x(getX(d,i))-barWidth/2)+','
+(y(getY(d,i))-(getOpen(d,i)>getClose(d,i)?(y(getClose(d,i))-y(getOpen(d,i))):0))
+')';}).attr('x',0).attr('y',0).attr('width',barWidth).attr('height',function(d,i){var open=getOpen(d,i);var close=getClose(d,i);return open>close?y(close)-y(open):y(open)-y(close);});});return chart;}
chart.highlightPoint=function(pointIndex,isHoverOver){chart.clearHighlights();container.select(".nv-candlestickBar .nv-tick-0-"+pointIndex).classed("hover",isHoverOver);};chart.clearHighlights=function(){container.select(".nv-candlestickBar .nv-tick.hover").classed("hover",false);};chart.dispatch=dispatch;chart.options=nv.utils.optionsFunc.bind(chart);chart._options=Object.create({},{width:{get:function(){return width;},set:function(_){width=_;}},height:{get:function(){return height;},set:function(_){height=_;}},xScale:{get:function(){return x;},set:function(_){x=_;}},yScale:{get:function(){return y;},set:function(_){y=_;}},xDomain:{get:function(){return xDomain;},set:function(_){xDomain=_;}},yDomain:{get:function(){return yDomain;},set:function(_){yDomain=_;}},xRange:{get:function(){return xRange;},set:function(_){xRange=_;}},yRange:{get:function(){return yRange;},set:function(_){yRange=_;}},forceX:{get:function(){return forceX;},set:function(_){forceX=_;}},forceY:{get:function(){return forceY;},set:function(_){forceY=_;}},padData:{get:function(){return padData;},set:function(_){padData=_;}},clipEdge:{get:function(){return clipEdge;},set:function(_){clipEdge=_;}},id:{get:function(){return id;},set:function(_){id=_;}},interactive:{get:function(){return interactive;},set:function(_){interactive=_;}},x:{get:function(){return getX;},set:function(_){getX=_;}},y:{get:function(){return getY;},set:function(_){getY=_;}},open:{get:function(){return getOpen();},set:function(_){getOpen=_;}},close:{get:function(){return getClose();},set:function(_){getClose=_;}},high:{get:function(){return getHigh;},set:function(_){getHigh=_;}},low:{get:function(){return getLow;},set:function(_){getLow=_;}},margin:{get:function(){return margin;},set:function(_){margin.top=_.top!=undefined?_.top:margin.top;margin.right=_.right!=undefined?_.right:margin.right;margin.bottom=_.bottom!=undefined?_.bottom:margin.bottom;margin.left=_.left!=undefined?_.left:margin.left;}},color:{get:function(){return color;},set:function(_){color=nv.utils.getColor(_);}}});nv.utils.initOptions(chart);return chart;};nv.models.cumulativeLineChart=function(){"use strict";var lines=nv.models.line(),xAxis=nv.models.axis(),yAxis=nv.models.axis(),legend=nv.models.legend(),controls=nv.models.legend(),interactiveLayer=nv.interactiveGuideline(),tooltip=nv.models.tooltip();var margin={top:30,right:30,bottom:50,left:60},color=nv.utils.defaultColor(),width=null,height=null,showLegend=true,showXAxis=true,showYAxis=true,rightAlignYAxis=false,showControls=true,useInteractiveGuideline=false,rescaleY=true,x,y,id=lines.id(),state=nv.utils.state(),defaultState=null,noData=null,average=function(d){return d.average},dispatch=d3.dispatch('stateChange','changeState','renderEnd'),transitionDuration=250,duration=250,noErrorCheck=false;state.index=0;state.rescaleY=rescaleY;xAxis.orient('bottom').tickPadding(7);yAxis.orient((rightAlignYAxis)?'right':'left');tooltip.valueFormatter(function(d,i){return yAxis.tickFormat()(d,i);}).headerFormatter(function(d,i){return xAxis.tickFormat()(d,i);});controls.updateState(false);var dx=d3.scale.linear(),index={i:0,x:0},renderWatch=nv.utils.renderWatch(dispatch,duration);var stateGetter=function(data){return function(){return{active:data.map(function(d){return!d.disabled}),index:index.i,rescaleY:rescaleY};}};var stateSetter=function(data){return function(state){if(state.index!==undefined)
index.i=state.index;if(state.rescaleY!==undefined)
rescaleY=state.rescaleY;if(state.active!==undefined)
data.forEach(function(series,i){series.disabled=!state.active[i];});}};function chart(selection){renderWatch.reset();renderWatch.models(lines);if(showXAxis)renderWatch.models(xAxis);if(showYAxis)renderWatch.models(yAxis);selection.each(function(data){var container=d3.select(this);nv.utils.initSVG(container);container.classed('nv-chart-'+id,true);var that=this;var availableWidth=nv.utils.availableWidth(width,container,margin),availableHeight=nv.utils.availableHeight(height,container,margin);chart.update=function(){if(duration===0)
container.call(chart);else
container.transition().duration(duration).call(chart)};chart.container=this;state.setter(stateSetter(data),chart.update).getter(stateGetter(data)).update();state.disabled=data.map(function(d){return!!d.disabled});if(!defaultState){var key;defaultState={};for(key in state){if(state[key]instanceof Array)
defaultState[key]=state[key].slice(0);else
defaultState[key]=state[key];}}
var indexDrag=d3.behavior.drag().on('dragstart',dragStart).on('drag',dragMove).on('dragend',dragEnd);function dragStart(d,i){d3.select(chart.container).style('cursor','ew-resize');}
function dragMove(d,i){index.x=d3.event.x;index.i=Math.round(dx.invert(index.x));updateZero();}
function dragEnd(d,i){d3.select(chart.container).style('cursor','auto');state.index=index.i;dispatch.stateChange(state);}
if(!data||!data.length||!data.filter(function(d){return d.values.length}).length){nv.utils.noData(chart,container)
return chart;}else{container.selectAll('.nv-noData').remove();}
x=lines.xScale();y=lines.yScale();if(!rescaleY){var seriesDomains=data.filter(function(series){return!series.disabled}).map(function(series,i){var initialDomain=d3.extent(series.values,lines.y());if(initialDomain[0]<-.95)initialDomain[0]=-.95;return[(initialDomain[0]-initialDomain[1])/(1+initialDomain[1]),(initialDomain[1]-initialDomain[0])/(1+initialDomain[0])];});var completeDomain=[d3.min(seriesDomains,function(d){return d[0]}),d3.max(seriesDomains,function(d){return d[1]})];lines.yDomain(completeDomain);}else{lines.yDomain(null);}
dx.domain([0,data[0].values.length-1]).range([0,availableWidth]).clamp(true);var data=indexify(index.i,data);var interactivePointerEvents=(useInteractiveGuideline)?"none":"all";var wrap=container.selectAll('g.nv-wrap.nv-cumulativeLine').data([data]);var gEnter=wrap.enter().append('g').attr('class','nvd3 nv-wrap nv-cumulativeLine').append('g');var g=wrap.select('g');gEnter.append('g').attr('class','nv-interactive');gEnter.append('g').attr('class','nv-x nv-axis').style("pointer-events","none");gEnter.append('g').attr('class','nv-y nv-axis');gEnter.append('g').attr('class','nv-background');gEnter.append('g').attr('class','nv-linesWrap').style("pointer-events",interactivePointerEvents);gEnter.append('g').attr('class','nv-avgLinesWrap').style("pointer-events","none");gEnter.append('g').attr('class','nv-legendWrap');gEnter.append('g').attr('class','nv-controlsWrap');if(showLegend){legend.width(availableWidth);g.select('.nv-legendWrap').datum(data).call(legend);if(margin.top!=legend.height()){margin.top=legend.height();availableHeight=nv.utils.availableHeight(height,container,margin);}
g.select('.nv-legendWrap').attr('transform','translate(0,'+(-margin.top)+')')}
if(showControls){var controlsData=[{key:'Re-scale y-axis',disabled:!rescaleY}];controls.width(140).color(['#444','#444','#444']).rightAlign(false).margin({top:5,right:0,bottom:5,left:20});g.select('.nv-controlsWrap').datum(controlsData).attr('transform','translate(0,'+(-margin.top)+')').call(controls);}
wrap.attr('transform','translate('+margin.left+','+margin.top+')');if(rightAlignYAxis){g.select(".nv-y.nv-axis").attr("transform","translate("+availableWidth+",0)");}
var tempDisabled=data.filter(function(d){return d.tempDisabled});wrap.select('.tempDisabled').remove();if(tempDisabled.length){wrap.append('text').attr('class','tempDisabled').attr('x',availableWidth/2).attr('y','-.71em').style('text-anchor','end').text(tempDisabled.map(function(d){return d.key}).join(', ')+' values cannot be calculated for this time period.');}
if(useInteractiveGuideline){interactiveLayer.width(availableWidth).height(availableHeight).margin({left:margin.left,top:margin.top}).svgContainer(container).xScale(x);wrap.select(".nv-interactive").call(interactiveLayer);}
gEnter.select('.nv-background').append('rect');g.select('.nv-background rect').attr('width',availableWidth).attr('height',availableHeight);lines.y(function(d){return d.display.y}).width(availableWidth).height(availableHeight).color(data.map(function(d,i){return d.color||color(d,i);}).filter(function(d,i){return!data[i].disabled&&!data[i].tempDisabled;}));var linesWrap=g.select('.nv-linesWrap').datum(data.filter(function(d){return!d.disabled&&!d.tempDisabled}));linesWrap.call(lines);data.forEach(function(d,i){d.seriesIndex=i;});var avgLineData=data.filter(function(d){return!d.disabled&&!!average(d);});var avgLines=g.select(".nv-avgLinesWrap").selectAll("line").data(avgLineData,function(d){return d.key;});var getAvgLineY=function(d){var yVal=y(average(d));if(yVal<0)return 0;if(yVal>availableHeight)return availableHeight;return yVal;};avgLines.enter().append('line').style('stroke-width',2).style('stroke-dasharray','10,10').style('stroke',function(d,i){return lines.color()(d,d.seriesIndex);}).attr('x1',0).attr('x2',availableWidth).attr('y1',getAvgLineY).attr('y2',getAvgLineY);avgLines.style('stroke-opacity',function(d){var yVal=y(average(d));if(yVal<0||yVal>availableHeight)return 0;return 1;}).attr('x1',0).attr('x2',availableWidth).attr('y1',getAvgLineY).attr('y2',getAvgLineY);avgLines.exit().remove();var indexLine=linesWrap.selectAll('.nv-indexLine').data([index]);indexLine.enter().append('rect').attr('class','nv-indexLine').attr('width',3).attr('x',-2).attr('fill','red').attr('fill-opacity',.5).style("pointer-events","all").call(indexDrag);indexLine.attr('transform',function(d){return'translate('+dx(d.i)+',0)'}).attr('height',availableHeight);if(showXAxis){xAxis.scale(x)._ticks(nv.utils.calcTicksX(availableWidth/70,data)).tickSize(-availableHeight,0);g.select('.nv-x.nv-axis').attr('transform','translate(0,'+y.range()[0]+')');g.select('.nv-x.nv-axis').call(xAxis);}
if(showYAxis){yAxis.scale(y)._ticks(nv.utils.calcTicksY(availableHeight/36,data)).tickSize(-availableWidth,0);g.select('.nv-y.nv-axis').call(yAxis);}
function updateZero(){indexLine.data([index]);var oldDuration=chart.duration();chart.duration(0);chart.update();chart.duration(oldDuration);}
g.select('.nv-background rect').on('click',function(){index.x=d3.mouse(this)[0];index.i=Math.round(dx.invert(index.x));state.index=index.i;dispatch.stateChange(state);updateZero();});lines.dispatch.on('elementClick',function(e){index.i=e.pointIndex;index.x=dx(index.i);state.index=index.i;dispatch.stateChange(state);updateZero();});controls.dispatch.on('legendClick',function(d,i){d.disabled=!d.disabled;rescaleY=!d.disabled;state.rescaleY=rescaleY;dispatch.stateChange(state);chart.update();});legend.dispatch.on('stateChange',function(newState){for(var key in newState)
state[key]=newState[key];dispatch.stateChange(state);chart.update();});interactiveLayer.dispatch.on('elementMousemove',function(e){lines.clearHighlights();var singlePoint,pointIndex,pointXLocation,allData=[];data.filter(function(series,i){series.seriesIndex=i;return!series.disabled;}).forEach(function(series,i){pointIndex=nv.interactiveBisect(series.values,e.pointXValue,chart.x());lines.highlightPoint(i,pointIndex,true);var point=series.values[pointIndex];if(typeof point==='undefined')return;if(typeof singlePoint==='undefined')singlePoint=point;if(typeof pointXLocation==='undefined')pointXLocation=chart.xScale()(chart.x()(point,pointIndex));allData.push({key:series.key,value:chart.y()(point,pointIndex),color:color(series,series.seriesIndex)});});if(allData.length>2){var yValue=chart.yScale().invert(e.mouseY);var domainExtent=Math.abs(chart.yScale().domain()[0]-chart.yScale().domain()[1]);var threshold=0.03*domainExtent;var indexToHighlight=nv.nearestValueIndex(allData.map(function(d){return d.value}),yValue,threshold);if(indexToHighlight!==null)
allData[indexToHighlight].highlight=true;}
var xValue=xAxis.tickFormat()(chart.x()(singlePoint,pointIndex),pointIndex);interactiveLayer.tooltip.chartContainer(that.parentNode).valueFormatter(function(d,i){return yAxis.tickFormat()(d);}).data({value:xValue,series:allData})();interactiveLayer.renderGuideLine(pointXLocation);});interactiveLayer.dispatch.on("elementMouseout",function(e){lines.clearHighlights();});dispatch.on('changeState',function(e){if(typeof e.disabled!=='undefined'){data.forEach(function(series,i){series.disabled=e.disabled[i];});state.disabled=e.disabled;}
if(typeof e.index!=='undefined'){index.i=e.index;index.x=dx(index.i);state.index=e.index;indexLine.data([index]);}
if(typeof e.rescaleY!=='undefined'){rescaleY=e.rescaleY;}
chart.update();});});renderWatch.renderEnd('cumulativeLineChart immediate');return chart;}
lines.dispatch.on('elementMouseover.tooltip',function(evt){var point={x:chart.x()(evt.point),y:chart.y()(evt.point),color:evt.point.color};evt.point=point;tooltip.data(evt).hidden(false);});lines.dispatch.on('elementMouseout.tooltip',function(evt){tooltip.hidden(true)});var indexifyYGetter=null;function indexify(idx,data){if(!indexifyYGetter)indexifyYGetter=lines.y();return data.map(function(line,i){if(!line.values){return line;}
var indexValue=line.values[idx];if(indexValue==null){return line;}
var v=indexifyYGetter(indexValue,idx);if(v<-.95&&!noErrorCheck){line.tempDisabled=true;return line;}
line.tempDisabled=false;line.values=line.values.map(function(point,pointIndex){point.display={'y':(indexifyYGetter(point,pointIndex)-v)/(1+v)};return point;});return line;})}
chart.dispatch=dispatch;chart.lines=lines;chart.legend=legend;chart.controls=controls;chart.xAxis=xAxis;chart.yAxis=yAxis;chart.interactiveLayer=interactiveLayer;chart.state=state;chart.tooltip=tooltip;chart.options=nv.utils.optionsFunc.bind(chart);chart._options=Object.create({},{width:{get:function(){return width;},set:function(_){width=_;}},height:{get:function(){return height;},set:function(_){height=_;}},rescaleY:{get:function(){return rescaleY;},set:function(_){rescaleY=_;}},showControls:{get:function(){return showControls;},set:function(_){showControls=_;}},showLegend:{get:function(){return showLegend;},set:function(_){showLegend=_;}},average:{get:function(){return average;},set:function(_){average=_;}},defaultState:{get:function(){return defaultState;},set:function(_){defaultState=_;}},noData:{get:function(){return noData;},set:function(_){noData=_;}},showXAxis:{get:function(){return showXAxis;},set:function(_){showXAxis=_;}},showYAxis:{get:function(){return showYAxis;},set:function(_){showYAxis=_;}},noErrorCheck:{get:function(){return noErrorCheck;},set:function(_){noErrorCheck=_;}},margin:{get:function(){return margin;},set:function(_){margin.top=_.top!==undefined?_.top:margin.top;margin.right=_.right!==undefined?_.right:margin.right;margin.bottom=_.bottom!==undefined?_.bottom:margin.bottom;margin.left=_.left!==undefined?_.left:margin.left;}},color:{get:function(){return color;},set:function(_){color=nv.utils.getColor(_);legend.color(color);}},useInteractiveGuideline:{get:function(){return useInteractiveGuideline;},set:function(_){useInteractiveGuideline=_;if(_===true){chart.interactive(false);chart.useVoronoi(false);}}},rightAlignYAxis:{get:function(){return rightAlignYAxis;},set:function(_){rightAlignYAxis=_;yAxis.orient((_)?'right':'left');}},duration:{get:function(){return duration;},set:function(_){duration=_;lines.duration(duration);xAxis.duration(duration);yAxis.duration(duration);renderWatch.reset(duration);}}});nv.utils.inheritOptions(chart,lines);nv.utils.initOptions(chart);return chart;};nv.models.discreteBar=function(){"use strict";var margin={top:0,right:0,bottom:0,left:0},width=960,height=500,id=Math.floor(Math.random()*10000),container,x=d3.scale.ordinal(),y=d3.scale.linear(),getX=function(d){return d.x},getY=function(d){return d.y},forceY=[0],color=nv.utils.defaultColor(),showValues=false,valueFormat=d3.format(',.2f'),xDomain,yDomain,xRange,yRange,dispatch=d3.dispatch('chartClick','elementClick','elementDblClick','elementMouseover','elementMouseout','elementMousemove','renderEnd'),rectClass='discreteBar',duration=250;var x0,y0;var renderWatch=nv.utils.renderWatch(dispatch,duration);function chart(selection){renderWatch.reset();selection.each(function(data){var availableWidth=width-margin.left-margin.right,availableHeight=height-margin.top-margin.bottom;container=d3.select(this);nv.utils.initSVG(container);data.forEach(function(series,i){series.values.forEach(function(point){point.series=i;});});var seriesData=(xDomain&&yDomain)?[]:data.map(function(d){return d.values.map(function(d,i){return{x:getX(d,i),y:getY(d,i),y0:d.y0}})});x.domain(xDomain||d3.merge(seriesData).map(function(d){return d.x})).rangeBands(xRange||[0,availableWidth],.1);y.domain(yDomain||d3.extent(d3.merge(seriesData).map(function(d){return d.y}).concat(forceY)));if(showValues)y.range(yRange||[availableHeight-(y.domain()[0]<0?12:0),y.domain()[1]>0?12:0]);else y.range(yRange||[availableHeight,0]);x0=x0||x;y0=y0||y.copy().range([y(0),y(0)]);var wrap=container.selectAll('g.nv-wrap.nv-discretebar').data([data]);var wrapEnter=wrap.enter().append('g').attr('class','nvd3 nv-wrap nv-discretebar');var gEnter=wrapEnter.append('g');var g=wrap.select('g');gEnter.append('g').attr('class','nv-groups');wrap.attr('transform','translate('+margin.left+','+margin.top+')');var groups=wrap.select('.nv-groups').selectAll('.nv-group').data(function(d){return d},function(d){return d.key});groups.enter().append('g').style('stroke-opacity',1e-6).style('fill-opacity',1e-6);groups.exit().watchTransition(renderWatch,'discreteBar: exit groups').style('stroke-opacity',1e-6).style('fill-opacity',1e-6).remove();groups.attr('class',function(d,i){return'nv-group nv-series-'+i}).classed('hover',function(d){return d.hover});groups.watchTransition(renderWatch,'discreteBar: groups').style('stroke-opacity',1).style('fill-opacity',.75);var bars=groups.selectAll('g.nv-bar').data(function(d){return d.values});bars.exit().remove();var barsEnter=bars.enter().append('g').attr('transform',function(d,i,j){return'translate('+(x(getX(d,i))+x.rangeBand()*.05)+', '+y(0)+')'}).on('mouseover',function(d,i){d3.select(this).classed('hover',true);dispatch.elementMouseover({data:d,index:i,color:d3.select(this).style("fill")});}).on('mouseout',function(d,i){d3.select(this).classed('hover',false);dispatch.elementMouseout({data:d,index:i,color:d3.select(this).style("fill")});}).on('mousemove',function(d,i){dispatch.elementMousemove({data:d,index:i,color:d3.select(this).style("fill")});}).on('click',function(d,i){dispatch.elementClick({data:d,index:i,color:d3.select(this).style("fill")});d3.event.stopPropagation();}).on('dblclick',function(d,i){dispatch.elementDblClick({data:d,index:i,color:d3.select(this).style("fill")});d3.event.stopPropagation();});barsEnter.append('rect').attr('height',0).attr('width',x.rangeBand()*.9/data.length)
if(showValues){barsEnter.append('text').attr('text-anchor','middle');bars.select('text').text(function(d,i){return valueFormat(getY(d,i))}).watchTransition(renderWatch,'discreteBar: bars text').attr('x',x.rangeBand()*.9/2).attr('y',function(d,i){return getY(d,i)<0?y(getY(d,i))-y(0)+12:-4});}else{bars.selectAll('text').remove();}
bars.attr('class',function(d,i){return getY(d,i)<0?'nv-bar negative':'nv-bar positive'}).style('fill',function(d,i){return d.color||color(d,i)}).style('stroke',function(d,i){return d.color||color(d,i)}).select('rect').attr('class',rectClass).watchTransition(renderWatch,'discreteBar: bars rect').attr('width',x.rangeBand()*.9/data.length);bars.watchTransition(renderWatch,'discreteBar: bars').attr('transform',function(d,i){var left=x(getX(d,i))+x.rangeBand()*.05,top=getY(d,i)<0?y(0):y(0)-y(getY(d,i))<1?y(0)-1:y(getY(d,i));return'translate('+left+', '+top+')'}).select('rect').attr('height',function(d,i){return Math.max(Math.abs(y(getY(d,i))-y((yDomain&&yDomain[0])||0))||1)});x0=x.copy();y0=y.copy();});renderWatch.renderEnd('discreteBar immediate');return chart;}
chart.dispatch=dispatch;chart.options=nv.utils.optionsFunc.bind(chart);chart._options=Object.create({},{width:{get:function(){return width;},set:function(_){width=_;}},height:{get:function(){return height;},set:function(_){height=_;}},forceY:{get:function(){return forceY;},set:function(_){forceY=_;}},showValues:{get:function(){return showValues;},set:function(_){showValues=_;}},x:{get:function(){return getX;},set:function(_){getX=_;}},y:{get:function(){return getY;},set:function(_){getY=_;}},xScale:{get:function(){return x;},set:function(_){x=_;}},yScale:{get:function(){return y;},set:function(_){y=_;}},xDomain:{get:function(){return xDomain;},set:function(_){xDomain=_;}},yDomain:{get:function(){return yDomain;},set:function(_){yDomain=_;}},xRange:{get:function(){return xRange;},set:function(_){xRange=_;}},yRange:{get:function(){return yRange;},set:function(_){yRange=_;}},valueFormat:{get:function(){return valueFormat;},set:function(_){valueFormat=_;}},id:{get:function(){return id;},set:function(_){id=_;}},rectClass:{get:function(){return rectClass;},set:function(_){rectClass=_;}},margin:{get:function(){return margin;},set:function(_){margin.top=_.top!==undefined?_.top:margin.top;margin.right=_.right!==undefined?_.right:margin.right;margin.bottom=_.bottom!==undefined?_.bottom:margin.bottom;margin.left=_.left!==undefined?_.left:margin.left;}},color:{get:function(){return color;},set:function(_){color=nv.utils.getColor(_);}},duration:{get:function(){return duration;},set:function(_){duration=_;renderWatch.reset(duration);}}});nv.utils.initOptions(chart);return chart;};nv.models.discreteBarChart=function(){"use strict";var discretebar=nv.models.discreteBar(),xAxis=nv.models.axis(),yAxis=nv.models.axis(),tooltip=nv.models.tooltip();var margin={top:15,right:10,bottom:50,left:60},width=null,height=null,color=nv.utils.getColor(),showXAxis=true,showYAxis=true,rightAlignYAxis=false,staggerLabels=false,wrapLabels=false,rotateLabels=0,x,y,noData=null,dispatch=d3.dispatch('beforeUpdate','renderEnd'),duration=250;xAxis.orient('bottom').showMaxMin(false).tickFormat(function(d){return d});yAxis.orient((rightAlignYAxis)?'right':'left').tickFormat(d3.format(',.1f'));tooltip.duration(0).headerEnabled(false).valueFormatter(function(d,i){return yAxis.tickFormat()(d,i);}).keyFormatter(function(d,i){return xAxis.tickFormat()(d,i);});var renderWatch=nv.utils.renderWatch(dispatch,duration);function chart(selection){renderWatch.reset();renderWatch.models(discretebar);if(showXAxis)renderWatch.models(xAxis);if(showYAxis)renderWatch.models(yAxis);selection.each(function(data){var container=d3.select(this),that=this;nv.utils.initSVG(container);var availableWidth=nv.utils.availableWidth(width,container,margin),availableHeight=nv.utils.availableHeight(height,container,margin);chart.update=function(){dispatch.beforeUpdate();container.transition().duration(duration).call(chart);};chart.container=this;if(!data||!data.length||!data.filter(function(d){return d.values.length}).length){nv.utils.noData(chart,container);return chart;}else{container.selectAll('.nv-noData').remove();}
x=discretebar.xScale();y=discretebar.yScale().clamp(true);var wrap=container.selectAll('g.nv-wrap.nv-discreteBarWithAxes').data([data]);var gEnter=wrap.enter().append('g').attr('class','nvd3 nv-wrap nv-discreteBarWithAxes').append('g');var defsEnter=gEnter.append('defs');var g=wrap.select('g');gEnter.append('g').attr('class','nv-x nv-axis');gEnter.append('g').attr('class','nv-y nv-axis').append('g').attr('class','nv-zeroLine').append('line');gEnter.append('g').attr('class','nv-barsWrap');g.attr('transform','translate('+margin.left+','+margin.top+')');if(rightAlignYAxis){g.select(".nv-y.nv-axis").attr("transform","translate("+availableWidth+",0)");}
discretebar.width(availableWidth).height(availableHeight);var barsWrap=g.select('.nv-barsWrap').datum(data.filter(function(d){return!d.disabled}));barsWrap.transition().call(discretebar);defsEnter.append('clipPath').attr('id','nv-x-label-clip-'+discretebar.id()).append('rect');g.select('#nv-x-label-clip-'+discretebar.id()+' rect').attr('width',x.rangeBand()*(staggerLabels?2:1)).attr('height',16).attr('x',-x.rangeBand()/(staggerLabels?1:2));if(showXAxis){xAxis.scale(x)._ticks(nv.utils.calcTicksX(availableWidth/100,data)).tickSize(-availableHeight,0);g.select('.nv-x.nv-axis').attr('transform','translate(0,'+(y.range()[0]+((discretebar.showValues()&&y.domain()[0]<0)?16:0))+')');g.select('.nv-x.nv-axis').call(xAxis);var xTicks=g.select('.nv-x.nv-axis').selectAll('g');if(staggerLabels){xTicks.selectAll('text').attr('transform',function(d,i,j){return'translate(0,'+(j%2==0?'5':'17')+')'})}
if(rotateLabels){xTicks.selectAll('.tick text').attr('transform','rotate('+rotateLabels+' 0,0)').style('text-anchor',rotateLabels>0?'start':'end');}
if(wrapLabels){g.selectAll('.tick text').call(nv.utils.wrapTicks,chart.xAxis.rangeBand())}}
if(showYAxis){yAxis.scale(y)._ticks(nv.utils.calcTicksY(availableHeight/36,data)).tickSize(-availableWidth,0);g.select('.nv-y.nv-axis').call(yAxis);}
g.select(".nv-zeroLine line").attr("x1",0).attr("x2",availableWidth).attr("y1",y(0)).attr("y2",y(0));});renderWatch.renderEnd('discreteBar chart immediate');return chart;}
discretebar.dispatch.on('elementMouseover.tooltip',function(evt){evt['series']={key:chart.x()(evt.data),value:chart.y()(evt.data),color:evt.color};tooltip.data(evt).hidden(false);});discretebar.dispatch.on('elementMouseout.tooltip',function(evt){tooltip.hidden(true);});discretebar.dispatch.on('elementMousemove.tooltip',function(evt){tooltip();});chart.dispatch=dispatch;chart.discretebar=discretebar;chart.xAxis=xAxis;chart.yAxis=yAxis;chart.tooltip=tooltip;chart.options=nv.utils.optionsFunc.bind(chart);chart._options=Object.create({},{width:{get:function(){return width;},set:function(_){width=_;}},height:{get:function(){return height;},set:function(_){height=_;}},staggerLabels:{get:function(){return staggerLabels;},set:function(_){staggerLabels=_;}},rotateLabels:{get:function(){return rotateLabels;},set:function(_){rotateLabels=_;}},wrapLabels:{get:function(){return wrapLabels;},set:function(_){wrapLabels=!!_;}},showXAxis:{get:function(){return showXAxis;},set:function(_){showXAxis=_;}},showYAxis:{get:function(){return showYAxis;},set:function(_){showYAxis=_;}},noData:{get:function(){return noData;},set:function(_){noData=_;}},margin:{get:function(){return margin;},set:function(_){margin.top=_.top!==undefined?_.top:margin.top;margin.right=_.right!==undefined?_.right:margin.right;margin.bottom=_.bottom!==undefined?_.bottom:margin.bottom;margin.left=_.left!==undefined?_.left:margin.left;}},duration:{get:function(){return duration;},set:function(_){duration=_;renderWatch.reset(duration);discretebar.duration(duration);xAxis.duration(duration);yAxis.duration(duration);}},color:{get:function(){return color;},set:function(_){color=nv.utils.getColor(_);discretebar.color(color);}},rightAlignYAxis:{get:function(){return rightAlignYAxis;},set:function(_){rightAlignYAxis=_;yAxis.orient((_)?'right':'left');}}});nv.utils.inheritOptions(chart,discretebar);nv.utils.initOptions(chart);return chart;}
nv.models.distribution=function(){"use strict";var margin={top:0,right:0,bottom:0,left:0},width=400,size=8,axis='x',getData=function(d){return d[axis]},color=nv.utils.defaultColor(),scale=d3.scale.linear(),domain,duration=250,dispatch=d3.dispatch('renderEnd');var scale0;var renderWatch=nv.utils.renderWatch(dispatch,duration);function chart(selection){renderWatch.reset();selection.each(function(data){var availableLength=width-(axis==='x'?margin.left+margin.right:margin.top+margin.bottom),naxis=axis=='x'?'y':'x',container=d3.select(this);nv.utils.initSVG(container);scale0=scale0||scale;var wrap=container.selectAll('g.nv-distribution').data([data]);var wrapEnter=wrap.enter().append('g').attr('class','nvd3 nv-distribution');var gEnter=wrapEnter.append('g');var g=wrap.select('g');wrap.attr('transform','translate('+margin.left+','+margin.top+')')
var distWrap=g.selectAll('g.nv-dist').data(function(d){return d},function(d){return d.key});distWrap.enter().append('g');distWrap.attr('class',function(d,i){return'nv-dist nv-series-'+i}).style('stroke',function(d,i){return color(d,i)});var dist=distWrap.selectAll('line.nv-dist'+axis).data(function(d){return d.values})
dist.enter().append('line').attr(axis+'1',function(d,i){return scale0(getData(d,i))}).attr(axis+'2',function(d,i){return scale0(getData(d,i))})
renderWatch.transition(distWrap.exit().selectAll('line.nv-dist'+axis),'dist exit').attr(axis+'1',function(d,i){return scale(getData(d,i))}).attr(axis+'2',function(d,i){return scale(getData(d,i))}).style('stroke-opacity',0).remove();dist.attr('class',function(d,i){return'nv-dist'+axis+' nv-dist'+axis+'-'+i}).attr(naxis+'1',0).attr(naxis+'2',size);renderWatch.transition(dist,'dist').attr(axis+'1',function(d,i){return scale(getData(d,i))}).attr(axis+'2',function(d,i){return scale(getData(d,i))})
scale0=scale.copy();});renderWatch.renderEnd('distribution immediate');return chart;}
chart.options=nv.utils.optionsFunc.bind(chart);chart.dispatch=dispatch;chart.margin=function(_){if(!arguments.length)return margin;margin.top=typeof _.top!='undefined'?_.top:margin.top;margin.right=typeof _.right!='undefined'?_.right:margin.right;margin.bottom=typeof _.bottom!='undefined'?_.bottom:margin.bottom;margin.left=typeof _.left!='undefined'?_.left:margin.left;return chart;};chart.width=function(_){if(!arguments.length)return width;width=_;return chart;};chart.axis=function(_){if(!arguments.length)return axis;axis=_;return chart;};chart.size=function(_){if(!arguments.length)return size;size=_;return chart;};chart.getData=function(_){if(!arguments.length)return getData;getData=d3.functor(_);return chart;};chart.scale=function(_){if(!arguments.length)return scale;scale=_;return chart;};chart.color=function(_){if(!arguments.length)return color;color=nv.utils.getColor(_);return chart;};chart.duration=function(_){if(!arguments.length)return duration;duration=_;renderWatch.reset(duration);return chart;};return chart;}
nv.models.furiousLegend=function(){"use strict";var margin={top:5,right:0,bottom:5,left:0},width=400,height=20,getKey=function(d){return d.key},color=nv.utils.getColor(),maxKeyLength=20,align=true,padding=28,rightAlign=true,updateState=true,radioButtonMode=false,expanded=false,dispatch=d3.dispatch('legendClick','legendDblclick','legendMouseover','legendMouseout','stateChange'),vers='classic';function chart(selection){selection.each(function(data){var availableWidth=width-margin.left-margin.right,container=d3.select(this);nv.utils.initSVG(container);var wrap=container.selectAll('g.nv-legend').data([data]);var gEnter=wrap.enter().append('g').attr('class','nvd3 nv-legend').append('g');var g=wrap.select('g');wrap.attr('transform','translate('+margin.left+','+margin.top+')');var series=g.selectAll('.nv-series').data(function(d){if(vers!='furious')return d;return d.filter(function(n){return expanded?true:!n.disengaged;});});var seriesEnter=series.enter().append('g').attr('class','nv-series')
var seriesShape;if(vers=='classic'){seriesEnter.append('circle').style('stroke-width',2).attr('class','nv-legend-symbol').attr('r',5);seriesShape=series.select('circle');}else if(vers=='furious'){seriesEnter.append('rect').style('stroke-width',2).attr('class','nv-legend-symbol').attr('rx',3).attr('ry',3);seriesShape=series.select('rect');seriesEnter.append('g').attr('class','nv-check-box').property('innerHTML','<path d="M0.5,5 L22.5,5 L22.5,26.5 L0.5,26.5 L0.5,5 Z" class="nv-box"></path><path d="M5.5,12.8618467 L11.9185089,19.2803556 L31,0.198864511" class="nv-check"></path>').attr('transform','translate(-10,-8)scale(0.5)');var seriesCheckbox=series.select('.nv-check-box');seriesCheckbox.each(function(d,i){d3.select(this).selectAll('path').attr('stroke',setTextColor(d,i));});}
seriesEnter.append('text').attr('text-anchor','start').attr('class','nv-legend-text').attr('dy','.32em').attr('dx','8');var seriesText=series.select('text.nv-legend-text');series.on('mouseover',function(d,i){dispatch.legendMouseover(d,i);}).on('mouseout',function(d,i){dispatch.legendMouseout(d,i);}).on('click',function(d,i){dispatch.legendClick(d,i);var data=series.data();if(updateState){if(vers=='classic'){if(radioButtonMode){data.forEach(function(series){series.disabled=true});d.disabled=false;}
else{d.disabled=!d.disabled;if(data.every(function(series){return series.disabled})){data.forEach(function(series){series.disabled=false});}}}else if(vers=='furious'){if(expanded){d.disengaged=!d.disengaged;d.userDisabled=d.userDisabled==undefined?!!d.disabled:d.userDisabled;d.disabled=d.disengaged||d.userDisabled;}else if(!expanded){d.disabled=!d.disabled;d.userDisabled=d.disabled;var engaged=data.filter(function(d){return!d.disengaged;});if(engaged.every(function(series){return series.userDisabled})){data.forEach(function(series){series.disabled=series.userDisabled=false;});}}}
dispatch.stateChange({disabled:data.map(function(d){return!!d.disabled}),disengaged:data.map(function(d){return!!d.disengaged})});}}).on('dblclick',function(d,i){if(vers=='furious'&&expanded)return;dispatch.legendDblclick(d,i);if(updateState){var data=series.data();data.forEach(function(series){series.disabled=true;if(vers=='furious')series.userDisabled=series.disabled;});d.disabled=false;if(vers=='furious')d.userDisabled=d.disabled;dispatch.stateChange({disabled:data.map(function(d){return!!d.disabled})});}});series.classed('nv-disabled',function(d){return d.userDisabled});series.exit().remove();seriesText.attr('fill',setTextColor).text(getKey);var versPadding;switch(vers){case'furious':versPadding=23;break;case'classic':versPadding=20;}
if(align){var seriesWidths=[];series.each(function(d,i){var legendText;if(getKey(d).length>maxKeyLength){var trimmedKey=getKey(d).substring(0,maxKeyLength);legendText=d3.select(this).select('text').text(trimmedKey+"...");d3.select(this).append("svg:title").text(getKey(d));}else{legendText=d3.select(this).select('text');}
var nodeTextLength;try{nodeTextLength=legendText.node().getComputedTextLength();if(nodeTextLength<=0)throw Error();}
catch(e){nodeTextLength=nv.utils.calcApproxTextWidth(legendText);}
seriesWidths.push(nodeTextLength+padding);});var seriesPerRow=0;var legendWidth=0;var columnWidths=[];while(legendWidth<availableWidth&&seriesPerRow<seriesWidths.length){columnWidths[seriesPerRow]=seriesWidths[seriesPerRow];legendWidth+=seriesWidths[seriesPerRow++];}
if(seriesPerRow===0)seriesPerRow=1;while(legendWidth>availableWidth&&seriesPerRow>1){columnWidths=[];seriesPerRow--;for(var k=0;k<seriesWidths.length;k++){if(seriesWidths[k]>(columnWidths[k%seriesPerRow]||0))
columnWidths[k%seriesPerRow]=seriesWidths[k];}
legendWidth=columnWidths.reduce(function(prev,cur,index,array){return prev+cur;});}
var xPositions=[];for(var i=0,curX=0;i<seriesPerRow;i++){xPositions[i]=curX;curX+=columnWidths[i];}
series.attr('transform',function(d,i){return'translate('+xPositions[i%seriesPerRow]+','+(5+Math.floor(i/seriesPerRow)*versPadding)+')';});if(rightAlign){g.attr('transform','translate('+(width-margin.right-legendWidth)+','+margin.top+')');}
else{g.attr('transform','translate(0'+','+margin.top+')');}
height=margin.top+margin.bottom+(Math.ceil(seriesWidths.length/seriesPerRow)*versPadding);}else{var ypos=5,newxpos=5,maxwidth=0,xpos;series.attr('transform',function(d,i){var length=d3.select(this).select('text').node().getComputedTextLength()+padding;xpos=newxpos;if(width<margin.left+margin.right+xpos+length){newxpos=xpos=5;ypos+=versPadding;}
newxpos+=length;if(newxpos>maxwidth)maxwidth=newxpos;return'translate('+xpos+','+ypos+')';});g.attr('transform','translate('+(width-margin.right-maxwidth)+','+margin.top+')');height=margin.top+margin.bottom+ypos+15;}
if(vers=='furious'){seriesShape.attr('width',function(d,i){return seriesText[0][i].getComputedTextLength()+27;}).attr('height',18).attr('y',-9).attr('x',-15)}
seriesShape.style('fill',setBGColor).style('stroke',function(d,i){return d.color||color(d,i)});});function setTextColor(d,i){if(vers!='furious')return'#000';if(expanded){return d.disengaged?color(d,i):'#fff';}else if(!expanded){return!!d.disabled?color(d,i):'#fff';}}
function setBGColor(d,i){if(expanded&&vers=='furious'){return d.disengaged?'#fff':color(d,i);}else{return!!d.disabled?'#fff':color(d,i);}}
return chart;}
chart.dispatch=dispatch;chart.options=nv.utils.optionsFunc.bind(chart);chart._options=Object.create({},{width:{get:function(){return width;},set:function(_){width=_;}},height:{get:function(){return height;},set:function(_){height=_;}},key:{get:function(){return getKey;},set:function(_){getKey=_;}},align:{get:function(){return align;},set:function(_){align=_;}},rightAlign:{get:function(){return rightAlign;},set:function(_){rightAlign=_;}},maxKeyLength:{get:function(){return maxKeyLength;},set:function(_){maxKeyLength=_;}},padding:{get:function(){return padding;},set:function(_){padding=_;}},updateState:{get:function(){return updateState;},set:function(_){updateState=_;}},radioButtonMode:{get:function(){return radioButtonMode;},set:function(_){radioButtonMode=_;}},expanded:{get:function(){return expanded;},set:function(_){expanded=_;}},vers:{get:function(){return vers;},set:function(_){vers=_;}},margin:{get:function(){return margin;},set:function(_){margin.top=_.top!==undefined?_.top:margin.top;margin.right=_.right!==undefined?_.right:margin.right;margin.bottom=_.bottom!==undefined?_.bottom:margin.bottom;margin.left=_.left!==undefined?_.left:margin.left;}},color:{get:function(){return color;},set:function(_){color=nv.utils.getColor(_);}}});nv.utils.initOptions(chart);return chart;};nv.models.historicalBar=function(){"use strict";var margin={top:0,right:0,bottom:0,left:0},width=null,height=null,id=Math.floor(Math.random()*10000),container=null,x=d3.scale.linear(),y=d3.scale.linear(),getX=function(d){return d.x},getY=function(d){return d.y},forceX=[],forceY=[0],padData=false,clipEdge=true,color=nv.utils.defaultColor(),xDomain,yDomain,xRange,yRange,dispatch=d3.dispatch('chartClick','elementClick','elementDblClick','elementMouseover','elementMouseout','elementMousemove','renderEnd'),interactive=true;var renderWatch=nv.utils.renderWatch(dispatch,0);function chart(selection){selection.each(function(data){renderWatch.reset();container=d3.select(this);var availableWidth=nv.utils.availableWidth(width,container,margin),availableHeight=nv.utils.availableHeight(height,container,margin);nv.utils.initSVG(container);x.domain(xDomain||d3.extent(data[0].values.map(getX).concat(forceX)));if(padData)
x.range(xRange||[availableWidth*.5/data[0].values.length,availableWidth*(data[0].values.length-.5)/data[0].values.length]);else
x.range(xRange||[0,availableWidth]);y.domain(yDomain||d3.extent(data[0].values.map(getY).concat(forceY))).range(yRange||[availableHeight,0]);if(x.domain()[0]===x.domain()[1])
x.domain()[0]?x.domain([x.domain()[0]-x.domain()[0]*0.01,x.domain()[1]+x.domain()[1]*0.01]):x.domain([-1,1]);if(y.domain()[0]===y.domain()[1])
y.domain()[0]?y.domain([y.domain()[0]+y.domain()[0]*0.01,y.domain()[1]-y.domain()[1]*0.01]):y.domain([-1,1]);var wrap=container.selectAll('g.nv-wrap.nv-historicalBar-'+id).data([data[0].values]);var wrapEnter=wrap.enter().append('g').attr('class','nvd3 nv-wrap nv-historicalBar-'+id);var defsEnter=wrapEnter.append('defs');var gEnter=wrapEnter.append('g');var g=wrap.select('g');gEnter.append('g').attr('class','nv-bars');wrap.attr('transform','translate('+margin.left+','+margin.top+')');container.on('click',function(d,i){dispatch.chartClick({data:d,index:i,pos:d3.event,id:id});});defsEnter.append('clipPath').attr('id','nv-chart-clip-path-'+id).append('rect');wrap.select('#nv-chart-clip-path-'+id+' rect').attr('width',availableWidth).attr('height',availableHeight);g.attr('clip-path',clipEdge?'url(#nv-chart-clip-path-'+id+')':'');var bars=wrap.select('.nv-bars').selectAll('.nv-bar').data(function(d){return d},function(d,i){return getX(d,i)});bars.exit().remove();bars.enter().append('rect').attr('x',0).attr('y',function(d,i){return nv.utils.NaNtoZero(y(Math.max(0,getY(d,i))))}).attr('height',function(d,i){return nv.utils.NaNtoZero(Math.abs(y(getY(d,i))-y(0)))}).attr('transform',function(d,i){return'translate('+(x(getX(d,i))-availableWidth/data[0].values.length*.45)+',0)';}).on('mouseover',function(d,i){if(!interactive)return;d3.select(this).classed('hover',true);dispatch.elementMouseover({data:d,index:i,color:d3.select(this).style("fill")});}).on('mouseout',function(d,i){if(!interactive)return;d3.select(this).classed('hover',false);dispatch.elementMouseout({data:d,index:i,color:d3.select(this).style("fill")});}).on('mousemove',function(d,i){if(!interactive)return;dispatch.elementMousemove({data:d,index:i,color:d3.select(this).style("fill")});}).on('click',function(d,i){if(!interactive)return;dispatch.elementClick({data:d,index:i,color:d3.select(this).style("fill")});d3.event.stopPropagation();}).on('dblclick',function(d,i){if(!interactive)return;dispatch.elementDblClick({data:d,index:i,color:d3.select(this).style("fill")});d3.event.stopPropagation();});bars.attr('fill',function(d,i){return color(d,i);}).attr('class',function(d,i,j){return(getY(d,i)<0?'nv-bar negative':'nv-bar positive')+' nv-bar-'+j+'-'+i}).watchTransition(renderWatch,'bars').attr('transform',function(d,i){return'translate('+(x(getX(d,i))-availableWidth/data[0].values.length*.45)+',0)';}).attr('width',(availableWidth/data[0].values.length)*.9);bars.watchTransition(renderWatch,'bars').attr('y',function(d,i){var rval=getY(d,i)<0?y(0):y(0)-y(getY(d,i))<1?y(0)-1:y(getY(d,i));return nv.utils.NaNtoZero(rval);}).attr('height',function(d,i){return nv.utils.NaNtoZero(Math.max(Math.abs(y(getY(d,i))-y(0)),1))});});renderWatch.renderEnd('historicalBar immediate');return chart;}
chart.highlightPoint=function(pointIndex,isHoverOver){container.select(".nv-bars .nv-bar-0-"+pointIndex).classed("hover",isHoverOver);};chart.clearHighlights=function(){container.select(".nv-bars .nv-bar.hover").classed("hover",false);};chart.dispatch=dispatch;chart.options=nv.utils.optionsFunc.bind(chart);chart._options=Object.create({},{width:{get:function(){return width;},set:function(_){width=_;}},height:{get:function(){return height;},set:function(_){height=_;}},forceX:{get:function(){return forceX;},set:function(_){forceX=_;}},forceY:{get:function(){return forceY;},set:function(_){forceY=_;}},padData:{get:function(){return padData;},set:function(_){padData=_;}},x:{get:function(){return getX;},set:function(_){getX=_;}},y:{get:function(){return getY;},set:function(_){getY=_;}},xScale:{get:function(){return x;},set:function(_){x=_;}},yScale:{get:function(){return y;},set:function(_){y=_;}},xDomain:{get:function(){return xDomain;},set:function(_){xDomain=_;}},yDomain:{get:function(){return yDomain;},set:function(_){yDomain=_;}},xRange:{get:function(){return xRange;},set:function(_){xRange=_;}},yRange:{get:function(){return yRange;},set:function(_){yRange=_;}},clipEdge:{get:function(){return clipEdge;},set:function(_){clipEdge=_;}},id:{get:function(){return id;},set:function(_){id=_;}},interactive:{get:function(){return interactive;},set:function(_){interactive=_;}},margin:{get:function(){return margin;},set:function(_){margin.top=_.top!==undefined?_.top:margin.top;margin.right=_.right!==undefined?_.right:margin.right;margin.bottom=_.bottom!==undefined?_.bottom:margin.bottom;margin.left=_.left!==undefined?_.left:margin.left;}},color:{get:function(){return color;},set:function(_){color=nv.utils.getColor(_);}}});nv.utils.initOptions(chart);return chart;};nv.models.historicalBarChart=function(bar_model){"use strict";var bars=bar_model||nv.models.historicalBar(),xAxis=nv.models.axis(),yAxis=nv.models.axis(),legend=nv.models.legend(),interactiveLayer=nv.interactiveGuideline(),tooltip=nv.models.tooltip();var margin={top:30,right:90,bottom:50,left:90},color=nv.utils.defaultColor(),width=null,height=null,showLegend=false,showXAxis=true,showYAxis=true,rightAlignYAxis=false,useInteractiveGuideline=false,x,y,state={},defaultState=null,noData=null,dispatch=d3.dispatch('tooltipHide','stateChange','changeState','renderEnd'),transitionDuration=250;xAxis.orient('bottom').tickPadding(7);yAxis.orient((rightAlignYAxis)?'right':'left');tooltip.duration(0).headerEnabled(false).valueFormatter(function(d,i){return yAxis.tickFormat()(d,i);}).headerFormatter(function(d,i){return xAxis.tickFormat()(d,i);});var renderWatch=nv.utils.renderWatch(dispatch,0);function chart(selection){selection.each(function(data){renderWatch.reset();renderWatch.models(bars);if(showXAxis)renderWatch.models(xAxis);if(showYAxis)renderWatch.models(yAxis);var container=d3.select(this),that=this;nv.utils.initSVG(container);var availableWidth=nv.utils.availableWidth(width,container,margin),availableHeight=nv.utils.availableHeight(height,container,margin);chart.update=function(){container.transition().duration(transitionDuration).call(chart)};chart.container=this;state.disabled=data.map(function(d){return!!d.disabled});if(!defaultState){var key;defaultState={};for(key in state){if(state[key]instanceof Array)
defaultState[key]=state[key].slice(0);else
defaultState[key]=state[key];}}
if(!data||!data.length||!data.filter(function(d){return d.values.length}).length){nv.utils.noData(chart,container)
return chart;}else{container.selectAll('.nv-noData').remove();}
x=bars.xScale();y=bars.yScale();var wrap=container.selectAll('g.nv-wrap.nv-historicalBarChart').data([data]);var gEnter=wrap.enter().append('g').attr('class','nvd3 nv-wrap nv-historicalBarChart').append('g');var g=wrap.select('g');gEnter.append('g').attr('class','nv-x nv-axis');gEnter.append('g').attr('class','nv-y nv-axis');gEnter.append('g').attr('class','nv-barsWrap');gEnter.append('g').attr('class','nv-legendWrap');gEnter.append('g').attr('class','nv-interactive');if(showLegend){legend.width(availableWidth);g.select('.nv-legendWrap').datum(data).call(legend);if(margin.top!=legend.height()){margin.top=legend.height();availableHeight=nv.utils.availableHeight(height,container,margin);}
wrap.select('.nv-legendWrap').attr('transform','translate(0,'+(-margin.top)+')')}
wrap.attr('transform','translate('+margin.left+','+margin.top+')');if(rightAlignYAxis){g.select(".nv-y.nv-axis").attr("transform","translate("+availableWidth+",0)");}
if(useInteractiveGuideline){interactiveLayer.width(availableWidth).height(availableHeight).margin({left:margin.left,top:margin.top}).svgContainer(container).xScale(x);wrap.select(".nv-interactive").call(interactiveLayer);}
bars.width(availableWidth).height(availableHeight).color(data.map(function(d,i){return d.color||color(d,i);}).filter(function(d,i){return!data[i].disabled}));var barsWrap=g.select('.nv-barsWrap').datum(data.filter(function(d){return!d.disabled}));barsWrap.transition().call(bars);if(showXAxis){xAxis.scale(x)._ticks(nv.utils.calcTicksX(availableWidth/100,data)).tickSize(-availableHeight,0);g.select('.nv-x.nv-axis').attr('transform','translate(0,'+y.range()[0]+')');g.select('.nv-x.nv-axis').transition().call(xAxis);}
if(showYAxis){yAxis.scale(y)._ticks(nv.utils.calcTicksY(availableHeight/36,data)).tickSize(-availableWidth,0);g.select('.nv-y.nv-axis').transition().call(yAxis);}
interactiveLayer.dispatch.on('elementMousemove',function(e){bars.clearHighlights();var singlePoint,pointIndex,pointXLocation,allData=[];data.filter(function(series,i){series.seriesIndex=i;return!series.disabled;}).forEach(function(series,i){pointIndex=nv.interactiveBisect(series.values,e.pointXValue,chart.x());bars.highlightPoint(pointIndex,true);var point=series.values[pointIndex];if(point===undefined)return;if(singlePoint===undefined)singlePoint=point;if(pointXLocation===undefined)pointXLocation=chart.xScale()(chart.x()(point,pointIndex));allData.push({key:series.key,value:chart.y()(point,pointIndex),color:color(series,series.seriesIndex),data:series.values[pointIndex]});});var xValue=xAxis.tickFormat()(chart.x()(singlePoint,pointIndex));interactiveLayer.tooltip.chartContainer(that.parentNode).valueFormatter(function(d,i){return yAxis.tickFormat()(d);}).data({value:xValue,index:pointIndex,series:allData})();interactiveLayer.renderGuideLine(pointXLocation);});interactiveLayer.dispatch.on("elementMouseout",function(e){dispatch.tooltipHide();bars.clearHighlights();});legend.dispatch.on('legendClick',function(d,i){d.disabled=!d.disabled;if(!data.filter(function(d){return!d.disabled}).length){data.map(function(d){d.disabled=false;wrap.selectAll('.nv-series').classed('disabled',false);return d;});}
state.disabled=data.map(function(d){return!!d.disabled});dispatch.stateChange(state);selection.transition().call(chart);});legend.dispatch.on('legendDblclick',function(d){data.forEach(function(d){d.disabled=true;});d.disabled=false;state.disabled=data.map(function(d){return!!d.disabled});dispatch.stateChange(state);chart.update();});dispatch.on('changeState',function(e){if(typeof e.disabled!=='undefined'){data.forEach(function(series,i){series.disabled=e.disabled[i];});state.disabled=e.disabled;}
chart.update();});});renderWatch.renderEnd('historicalBarChart immediate');return chart;}
bars.dispatch.on('elementMouseover.tooltip',function(evt){evt['series']={key:chart.x()(evt.data),value:chart.y()(evt.data),color:evt.color};tooltip.data(evt).hidden(false);});bars.dispatch.on('elementMouseout.tooltip',function(evt){tooltip.hidden(true);});bars.dispatch.on('elementMousemove.tooltip',function(evt){tooltip();});chart.dispatch=dispatch;chart.bars=bars;chart.legend=legend;chart.xAxis=xAxis;chart.yAxis=yAxis;chart.interactiveLayer=interactiveLayer;chart.tooltip=tooltip;chart.options=nv.utils.optionsFunc.bind(chart);chart._options=Object.create({},{width:{get:function(){return width;},set:function(_){width=_;}},height:{get:function(){return height;},set:function(_){height=_;}},showLegend:{get:function(){return showLegend;},set:function(_){showLegend=_;}},showXAxis:{get:function(){return showXAxis;},set:function(_){showXAxis=_;}},showYAxis:{get:function(){return showYAxis;},set:function(_){showYAxis=_;}},defaultState:{get:function(){return defaultState;},set:function(_){defaultState=_;}},noData:{get:function(){return noData;},set:function(_){noData=_;}},margin:{get:function(){return margin;},set:function(_){margin.top=_.top!==undefined?_.top:margin.top;margin.right=_.right!==undefined?_.right:margin.right;margin.bottom=_.bottom!==undefined?_.bottom:margin.bottom;margin.left=_.left!==undefined?_.left:margin.left;}},color:{get:function(){return color;},set:function(_){color=nv.utils.getColor(_);legend.color(color);bars.color(color);}},duration:{get:function(){return transitionDuration;},set:function(_){transitionDuration=_;renderWatch.reset(transitionDuration);yAxis.duration(transitionDuration);xAxis.duration(transitionDuration);}},rightAlignYAxis:{get:function(){return rightAlignYAxis;},set:function(_){rightAlignYAxis=_;yAxis.orient((_)?'right':'left');}},useInteractiveGuideline:{get:function(){return useInteractiveGuideline;},set:function(_){useInteractiveGuideline=_;if(_===true){chart.interactive(false);}}}});nv.utils.inheritOptions(chart,bars);nv.utils.initOptions(chart);return chart;};nv.models.ohlcBarChart=function(){var chart=nv.models.historicalBarChart(nv.models.ohlcBar());chart.useInteractiveGuideline(true);chart.interactiveLayer.tooltip.contentGenerator(function(data){var d=data.series[0].data;var color=d.open<d.close?"2ca02c":"d62728";return''+'<h3 style="color: #'+color+'">'+data.value+'</h3>'+'<table>'+'<tr><td>open:</td><td>'+chart.yAxis.tickFormat()(d.open)+'</td></tr>'+'<tr><td>close:</td><td>'+chart.yAxis.tickFormat()(d.close)+'</td></tr>'+'<tr><td>high</td><td>'+chart.yAxis.tickFormat()(d.high)+'</td></tr>'+'<tr><td>low:</td><td>'+chart.yAxis.tickFormat()(d.low)+'</td></tr>'+'</table>';});return chart;};nv.models.candlestickBarChart=function(){var chart=nv.models.historicalBarChart(nv.models.candlestickBar());chart.useInteractiveGuideline(true);chart.interactiveLayer.tooltip.contentGenerator(function(data){var d=data.series[0].data;var color=d.open<d.close?"2ca02c":"d62728";return''+'<h3 style="color: #'+color+'">'+data.value+'</h3>'+'<table>'+'<tr><td>open:</td><td>'+chart.yAxis.tickFormat()(d.open)+'</td></tr>'+'<tr><td>close:</td><td>'+chart.yAxis.tickFormat()(d.close)+'</td></tr>'+'<tr><td>high</td><td>'+chart.yAxis.tickFormat()(d.high)+'</td></tr>'+'<tr><td>low:</td><td>'+chart.yAxis.tickFormat()(d.low)+'</td></tr>'+'</table>';});return chart;};nv.models.legend=function(){"use strict";var margin={top:5,right:0,bottom:5,left:0},width=400,height=20,getKey=function(d){return d.key},color=nv.utils.getColor(),maxKeyLength=20,align=true,padding=32,rightAlign=true,updateState=true,radioButtonMode=false,expanded=false,dispatch=d3.dispatch('legendClick','legendDblclick','legendMouseover','legendMouseout','stateChange'),vers='classic';function chart(selection){selection.each(function(data){var availableWidth=width-margin.left-margin.right,container=d3.select(this);nv.utils.initSVG(container);var wrap=container.selectAll('g.nv-legend').data([data]);var gEnter=wrap.enter().append('g').attr('class','nvd3 nv-legend').append('g');var g=wrap.select('g');wrap.attr('transform','translate('+margin.left+','+margin.top+')');var series=g.selectAll('.nv-series').data(function(d){if(vers!='furious')return d;return d.filter(function(n){return expanded?true:!n.disengaged;});});var seriesEnter=series.enter().append('g').attr('class','nv-series');var seriesShape;var versPadding;switch(vers){case'furious':versPadding=23;break;case'classic':versPadding=20;}
if(vers=='classic'){seriesEnter.append('circle').style('stroke-width',2).attr('class','nv-legend-symbol').attr('r',5);seriesShape=series.select('circle');}else if(vers=='furious'){seriesEnter.append('rect').style('stroke-width',2).attr('class','nv-legend-symbol').attr('rx',3).attr('ry',3);seriesShape=series.select('.nv-legend-symbol');seriesEnter.append('g').attr('class','nv-check-box').property('innerHTML','<path d="M0.5,5 L22.5,5 L22.5,26.5 L0.5,26.5 L0.5,5 Z" class="nv-box"></path><path d="M5.5,12.8618467 L11.9185089,19.2803556 L31,0.198864511" class="nv-check"></path>').attr('transform','translate(-10,-8)scale(0.5)');var seriesCheckbox=series.select('.nv-check-box');seriesCheckbox.each(function(d,i){d3.select(this).selectAll('path').attr('stroke',setTextColor(d,i));});}
seriesEnter.append('text').attr('text-anchor','start').attr('class','nv-legend-text').attr('dy','.32em').attr('dx','8');var seriesText=series.select('text.nv-legend-text');series.on('mouseover',function(d,i){dispatch.legendMouseover(d,i);}).on('mouseout',function(d,i){dispatch.legendMouseout(d,i);}).on('click',function(d,i){dispatch.legendClick(d,i);var data=series.data();if(updateState){if(vers=='classic'){if(radioButtonMode){data.forEach(function(series){series.disabled=true});d.disabled=false;}
else{d.disabled=!d.disabled;if(data.every(function(series){return series.disabled})){data.forEach(function(series){series.disabled=false});}}}else if(vers=='furious'){if(expanded){d.disengaged=!d.disengaged;d.userDisabled=d.userDisabled==undefined?!!d.disabled:d.userDisabled;d.disabled=d.disengaged||d.userDisabled;}else if(!expanded){d.disabled=!d.disabled;d.userDisabled=d.disabled;var engaged=data.filter(function(d){return!d.disengaged;});if(engaged.every(function(series){return series.userDisabled})){data.forEach(function(series){series.disabled=series.userDisabled=false;});}}}
dispatch.stateChange({disabled:data.map(function(d){return!!d.disabled}),disengaged:data.map(function(d){return!!d.disengaged})});}}).on('dblclick',function(d,i){if(vers=='furious'&&expanded)return;dispatch.legendDblclick(d,i);if(updateState){var data=series.data();data.forEach(function(series){series.disabled=true;if(vers=='furious')series.userDisabled=series.disabled;});d.disabled=false;if(vers=='furious')d.userDisabled=d.disabled;dispatch.stateChange({disabled:data.map(function(d){return!!d.disabled})});}});series.classed('nv-disabled',function(d){return d.userDisabled});series.exit().remove();seriesText.attr('fill',setTextColor).text(getKey);var legendWidth=0;if(align){var seriesWidths=[];series.each(function(d,i){var legendText;if(getKey(d).length>maxKeyLength){var trimmedKey=getKey(d).substring(0,maxKeyLength);legendText=d3.select(this).select('text').text(trimmedKey+"...");d3.select(this).append("svg:title").text(getKey(d));}else{legendText=d3.select(this).select('text');}
var nodeTextLength;try{nodeTextLength=legendText.node().getComputedTextLength();if(nodeTextLength<=0)throw Error();}
catch(e){nodeTextLength=nv.utils.calcApproxTextWidth(legendText);}
seriesWidths.push(nodeTextLength+padding);});var seriesPerRow=0;var columnWidths=[];legendWidth=0;while(legendWidth<availableWidth&&seriesPerRow<seriesWidths.length){columnWidths[seriesPerRow]=seriesWidths[seriesPerRow];legendWidth+=seriesWidths[seriesPerRow++];}
if(seriesPerRow===0)seriesPerRow=1;while(legendWidth>availableWidth&&seriesPerRow>1){columnWidths=[];seriesPerRow--;for(var k=0;k<seriesWidths.length;k++){if(seriesWidths[k]>(columnWidths[k%seriesPerRow]||0))
columnWidths[k%seriesPerRow]=seriesWidths[k];}
legendWidth=columnWidths.reduce(function(prev,cur,index,array){return prev+cur;});}
var xPositions=[];for(var i=0,curX=0;i<seriesPerRow;i++){xPositions[i]=curX;curX+=columnWidths[i];}
series.attr('transform',function(d,i){return'translate('+xPositions[i%seriesPerRow]+','+(5+Math.floor(i/seriesPerRow)*versPadding)+')';});if(rightAlign){g.attr('transform','translate('+(width-margin.right-legendWidth)+','+margin.top+')');}
else{g.attr('transform','translate(0'+','+margin.top+')');}
height=margin.top+margin.bottom+(Math.ceil(seriesWidths.length/seriesPerRow)*versPadding);}else{var ypos=5,newxpos=5,maxwidth=0,xpos;series.attr('transform',function(d,i){var length=d3.select(this).select('text').node().getComputedTextLength()+padding;xpos=newxpos;if(width<margin.left+margin.right+xpos+length){newxpos=xpos=5;ypos+=versPadding;}
newxpos+=length;if(newxpos>maxwidth)maxwidth=newxpos;if(legendWidth<xpos+maxwidth){legendWidth=xpos+maxwidth;}
return'translate('+xpos+','+ypos+')';});g.attr('transform','translate('+(width-margin.right-maxwidth)+','+margin.top+')');height=margin.top+margin.bottom+ypos+15;}
if(vers=='furious'){seriesShape.attr('width',function(d,i){return seriesText[0][i].getComputedTextLength()+27;}).attr('height',18).attr('y',-9).attr('x',-15);gEnter.insert('rect',':first-child').attr('class','nv-legend-bg').attr('fill','#eee').attr('opacity',0);var seriesBG=g.select('.nv-legend-bg');seriesBG.transition().duration(300).attr('x',-versPadding).attr('width',legendWidth+versPadding-12).attr('height',height+10).attr('y',-margin.top-10).attr('opacity',expanded?1:0);}
seriesShape.style('fill',setBGColor).style('fill-opacity',setBGOpacity).style('stroke',setBGColor);});function setTextColor(d,i){if(vers!='furious')return'#000';if(expanded){return d.disengaged?'#000':'#fff';}else if(!expanded){if(!d.color)d.color=color(d,i);return!!d.disabled?d.color:'#fff';}}
function setBGColor(d,i){if(expanded&&vers=='furious'){return d.disengaged?'#eee':d.color||color(d,i);}else{return d.color||color(d,i);}}
function setBGOpacity(d,i){if(expanded&&vers=='furious'){return 1;}else{return!!d.disabled?0:1;}}
return chart;}
chart.dispatch=dispatch;chart.options=nv.utils.optionsFunc.bind(chart);chart._options=Object.create({},{width:{get:function(){return width;},set:function(_){width=_;}},height:{get:function(){return height;},set:function(_){height=_;}},key:{get:function(){return getKey;},set:function(_){getKey=_;}},align:{get:function(){return align;},set:function(_){align=_;}},maxKeyLength:{get:function(){return maxKeyLength;},set:function(_){maxKeyLength=_;}},rightAlign:{get:function(){return rightAlign;},set:function(_){rightAlign=_;}},padding:{get:function(){return padding;},set:function(_){padding=_;}},updateState:{get:function(){return updateState;},set:function(_){updateState=_;}},radioButtonMode:{get:function(){return radioButtonMode;},set:function(_){radioButtonMode=_;}},expanded:{get:function(){return expanded;},set:function(_){expanded=_;}},vers:{get:function(){return vers;},set:function(_){vers=_;}},margin:{get:function(){return margin;},set:function(_){margin.top=_.top!==undefined?_.top:margin.top;margin.right=_.right!==undefined?_.right:margin.right;margin.bottom=_.bottom!==undefined?_.bottom:margin.bottom;margin.left=_.left!==undefined?_.left:margin.left;}},color:{get:function(){return color;},set:function(_){color=nv.utils.getColor(_);}}});nv.utils.initOptions(chart);return chart;};nv.models.line=function(){"use strict";var scatter=nv.models.scatter();var margin={top:0,right:0,bottom:0,left:0},width=960,height=500,container=null,strokeWidth=1.5,color=nv.utils.defaultColor(),getX=function(d){return d.x},getY=function(d){return d.y},defined=function(d,i){return!isNaN(getY(d,i))&&getY(d,i)!==null},isArea=function(d){return d.area},clipEdge=false,x,y,interpolate="linear",duration=250,dispatch=d3.dispatch('elementClick','elementMouseover','elementMouseout','renderEnd');scatter.pointSize(16).pointDomain([16,256]);var x0,y0,renderWatch=nv.utils.renderWatch(dispatch,duration);function chart(selection){renderWatch.reset();renderWatch.models(scatter);selection.each(function(data){container=d3.select(this);var availableWidth=nv.utils.availableWidth(width,container,margin),availableHeight=nv.utils.availableHeight(height,container,margin);nv.utils.initSVG(container);x=scatter.xScale();y=scatter.yScale();x0=x0||x;y0=y0||y;var wrap=container.selectAll('g.nv-wrap.nv-line').data([data]);var wrapEnter=wrap.enter().append('g').attr('class','nvd3 nv-wrap nv-line');var defsEnter=wrapEnter.append('defs');var gEnter=wrapEnter.append('g');var g=wrap.select('g');gEnter.append('g').attr('class','nv-groups');gEnter.append('g').attr('class','nv-scatterWrap');wrap.attr('transform','translate('+margin.left+','+margin.top+')');scatter.width(availableWidth).height(availableHeight);var scatterWrap=wrap.select('.nv-scatterWrap');scatterWrap.call(scatter);defsEnter.append('clipPath').attr('id','nv-edge-clip-'+scatter.id()).append('rect');wrap.select('#nv-edge-clip-'+scatter.id()+' rect').attr('width',availableWidth).attr('height',(availableHeight>0)?availableHeight:0);g.attr('clip-path',clipEdge?'url(#nv-edge-clip-'+scatter.id()+')':'');scatterWrap.attr('clip-path',clipEdge?'url(#nv-edge-clip-'+scatter.id()+')':'');var groups=wrap.select('.nv-groups').selectAll('.nv-group').data(function(d){return d},function(d){return d.key});groups.enter().append('g').style('stroke-opacity',1e-6).style('stroke-width',function(d){return d.strokeWidth||strokeWidth}).style('fill-opacity',1e-6);groups.exit().remove();groups.attr('class',function(d,i){return(d.classed||'')+' nv-group nv-series-'+i;}).classed('hover',function(d){return d.hover}).style('fill',function(d,i){return color(d,i)}).style('stroke',function(d,i){return color(d,i)});groups.watchTransition(renderWatch,'line: groups').style('stroke-opacity',1).style('fill-opacity',function(d){return d.fillOpacity||.5});var areaPaths=groups.selectAll('path.nv-area').data(function(d){return isArea(d)?[d]:[]});areaPaths.enter().append('path').attr('class','nv-area').attr('d',function(d){return d3.svg.area().interpolate(interpolate).defined(defined).x(function(d,i){return nv.utils.NaNtoZero(x0(getX(d,i)))}).y0(function(d,i){return nv.utils.NaNtoZero(y0(getY(d,i)))}).y1(function(d,i){return y0(y.domain()[0]<=0?y.domain()[1]>=0?0:y.domain()[1]:y.domain()[0])}).apply(this,[d.values])});groups.exit().selectAll('path.nv-area').remove();areaPaths.watchTransition(renderWatch,'line: areaPaths').attr('d',function(d){return d3.svg.area().interpolate(interpolate).defined(defined).x(function(d,i){return nv.utils.NaNtoZero(x(getX(d,i)))}).y0(function(d,i){return nv.utils.NaNtoZero(y(getY(d,i)))}).y1(function(d,i){return y(y.domain()[0]<=0?y.domain()[1]>=0?0:y.domain()[1]:y.domain()[0])}).apply(this,[d.values])});var linePaths=groups.selectAll('path.nv-line').data(function(d){return[d.values]});linePaths.enter().append('path').attr('class','nv-line').attr('d',d3.svg.line().interpolate(interpolate).defined(defined).x(function(d,i){return nv.utils.NaNtoZero(x0(getX(d,i)))}).y(function(d,i){return nv.utils.NaNtoZero(y0(getY(d,i)))}));linePaths.watchTransition(renderWatch,'line: linePaths').attr('d',d3.svg.line().interpolate(interpolate).defined(defined).x(function(d,i){return nv.utils.NaNtoZero(x(getX(d,i)))}).y(function(d,i){return nv.utils.NaNtoZero(y(getY(d,i)))}));x0=x.copy();y0=y.copy();});renderWatch.renderEnd('line immediate');return chart;}
chart.dispatch=dispatch;chart.scatter=scatter;scatter.dispatch.on('elementClick',function(){dispatch.elementClick.apply(this,arguments);});scatter.dispatch.on('elementMouseover',function(){dispatch.elementMouseover.apply(this,arguments);});scatter.dispatch.on('elementMouseout',function(){dispatch.elementMouseout.apply(this,arguments);});chart.options=nv.utils.optionsFunc.bind(chart);chart._options=Object.create({},{width:{get:function(){return width;},set:function(_){width=_;}},height:{get:function(){return height;},set:function(_){height=_;}},defined:{get:function(){return defined;},set:function(_){defined=_;}},interpolate:{get:function(){return interpolate;},set:function(_){interpolate=_;}},clipEdge:{get:function(){return clipEdge;},set:function(_){clipEdge=_;}},margin:{get:function(){return margin;},set:function(_){margin.top=_.top!==undefined?_.top:margin.top;margin.right=_.right!==undefined?_.right:margin.right;margin.bottom=_.bottom!==undefined?_.bottom:margin.bottom;margin.left=_.left!==undefined?_.left:margin.left;}},duration:{get:function(){return duration;},set:function(_){duration=_;renderWatch.reset(duration);scatter.duration(duration);}},isArea:{get:function(){return isArea;},set:function(_){isArea=d3.functor(_);}},x:{get:function(){return getX;},set:function(_){getX=_;scatter.x(_);}},y:{get:function(){return getY;},set:function(_){getY=_;scatter.y(_);}},color:{get:function(){return color;},set:function(_){color=nv.utils.getColor(_);scatter.color(color);}}});nv.utils.inheritOptions(chart,scatter);nv.utils.initOptions(chart);return chart;};nv.models.lineChart=function(){"use strict";var lines=nv.models.line(),xAxis=nv.models.axis(),yAxis=nv.models.axis(),legend=nv.models.legend(),interactiveLayer=nv.interactiveGuideline(),tooltip=nv.models.tooltip();var margin={top:30,right:20,bottom:50,left:60},color=nv.utils.defaultColor(),width=null,height=null,showLegend=true,showXAxis=true,showYAxis=true,rightAlignYAxis=false,useInteractiveGuideline=false,x,y,state=nv.utils.state(),defaultState=null,noData=null,dispatch=d3.dispatch('tooltipShow','tooltipHide','stateChange','changeState','renderEnd'),duration=250;xAxis.orient('bottom').tickPadding(7);yAxis.orient(rightAlignYAxis?'right':'left');tooltip.valueFormatter(function(d,i){return yAxis.tickFormat()(d,i);}).headerFormatter(function(d,i){return xAxis.tickFormat()(d,i);});var renderWatch=nv.utils.renderWatch(dispatch,duration);var stateGetter=function(data){return function(){return{active:data.map(function(d){return!d.disabled})};}};var stateSetter=function(data){return function(state){if(state.active!==undefined)
data.forEach(function(series,i){series.disabled=!state.active[i];});}};function chart(selection){renderWatch.reset();renderWatch.models(lines);if(showXAxis)renderWatch.models(xAxis);if(showYAxis)renderWatch.models(yAxis);selection.each(function(data){var container=d3.select(this),that=this;nv.utils.initSVG(container);var availableWidth=nv.utils.availableWidth(width,container,margin),availableHeight=nv.utils.availableHeight(height,container,margin);chart.update=function(){if(duration===0)
container.call(chart);else
container.transition().duration(duration).call(chart)};chart.container=this;state.setter(stateSetter(data),chart.update).getter(stateGetter(data)).update();state.disabled=data.map(function(d){return!!d.disabled});if(!defaultState){var key;defaultState={};for(key in state){if(state[key]instanceof Array)
defaultState[key]=state[key].slice(0);else
defaultState[key]=state[key];}}
if(!data||!data.length||!data.filter(function(d){return d.values.length}).length){nv.utils.noData(chart,container)
return chart;}else{container.selectAll('.nv-noData').remove();}
x=lines.xScale();y=lines.yScale();var wrap=container.selectAll('g.nv-wrap.nv-lineChart').data([data]);var gEnter=wrap.enter().append('g').attr('class','nvd3 nv-wrap nv-lineChart').append('g');var g=wrap.select('g');gEnter.append("rect").style("opacity",0);gEnter.append('g').attr('class','nv-x nv-axis');gEnter.append('g').attr('class','nv-y nv-axis');gEnter.append('g').attr('class','nv-linesWrap');gEnter.append('g').attr('class','nv-legendWrap');gEnter.append('g').attr('class','nv-interactive');g.select("rect").attr("width",availableWidth).attr("height",(availableHeight>0)?availableHeight:0);if(showLegend){legend.width(availableWidth);g.select('.nv-legendWrap').datum(data).call(legend);if(margin.top!=legend.height()){margin.top=legend.height();availableHeight=nv.utils.availableHeight(height,container,margin);}
wrap.select('.nv-legendWrap').attr('transform','translate(0,'+(-margin.top)+')')}
wrap.attr('transform','translate('+margin.left+','+margin.top+')');if(rightAlignYAxis){g.select(".nv-y.nv-axis").attr("transform","translate("+availableWidth+",0)");}
if(useInteractiveGuideline){interactiveLayer.width(availableWidth).height(availableHeight).margin({left:margin.left,top:margin.top}).svgContainer(container).xScale(x);wrap.select(".nv-interactive").call(interactiveLayer);}
lines.width(availableWidth).height(availableHeight).color(data.map(function(d,i){return d.color||color(d,i);}).filter(function(d,i){return!data[i].disabled}));var linesWrap=g.select('.nv-linesWrap').datum(data.filter(function(d){return!d.disabled}));linesWrap.call(lines);if(showXAxis){xAxis.scale(x)._ticks(nv.utils.calcTicksX(availableWidth/100,data)).tickSize(-availableHeight,0);g.select('.nv-x.nv-axis').attr('transform','translate(0,'+y.range()[0]+')');g.select('.nv-x.nv-axis').call(xAxis);}
if(showYAxis){yAxis.scale(y)._ticks(nv.utils.calcTicksY(availableHeight/36,data)).tickSize(-availableWidth,0);g.select('.nv-y.nv-axis').call(yAxis);}
legend.dispatch.on('stateChange',function(newState){for(var key in newState)
state[key]=newState[key];dispatch.stateChange(state);chart.update();});interactiveLayer.dispatch.on('elementMousemove',function(e){lines.clearHighlights();var singlePoint,pointIndex,pointXLocation,allData=[];data.filter(function(series,i){series.seriesIndex=i;return!series.disabled;}).forEach(function(series,i){pointIndex=nv.interactiveBisect(series.values,e.pointXValue,chart.x());var point=series.values[pointIndex];var pointYValue=chart.y()(point,pointIndex);if(pointYValue!=null){lines.highlightPoint(i,pointIndex,true);}
if(point===undefined)return;if(singlePoint===undefined)singlePoint=point;if(pointXLocation===undefined)pointXLocation=chart.xScale()(chart.x()(point,pointIndex));allData.push({key:series.key,value:pointYValue,color:color(series,series.seriesIndex)});});if(allData.length>2){var yValue=chart.yScale().invert(e.mouseY);var domainExtent=Math.abs(chart.yScale().domain()[0]-chart.yScale().domain()[1]);var threshold=0.03*domainExtent;var indexToHighlight=nv.nearestValueIndex(allData.map(function(d){return d.value}),yValue,threshold);if(indexToHighlight!==null)
allData[indexToHighlight].highlight=true;}
var xValue=xAxis.tickFormat()(chart.x()(singlePoint,pointIndex));interactiveLayer.tooltip.chartContainer(that.parentNode).valueFormatter(function(d,i){return d==null?"N/A":yAxis.tickFormat()(d);}).data({value:xValue,index:pointIndex,series:allData})();interactiveLayer.renderGuideLine(pointXLocation);});interactiveLayer.dispatch.on('elementClick',function(e){var pointXLocation,allData=[];data.filter(function(series,i){series.seriesIndex=i;return!series.disabled;}).forEach(function(series){var pointIndex=nv.interactiveBisect(series.values,e.pointXValue,chart.x());var point=series.values[pointIndex];if(typeof point==='undefined')return;if(typeof pointXLocation==='undefined')pointXLocation=chart.xScale()(chart.x()(point,pointIndex));var yPos=chart.yScale()(chart.y()(point,pointIndex));allData.push({point:point,pointIndex:pointIndex,pos:[pointXLocation,yPos],seriesIndex:series.seriesIndex,series:series});});lines.dispatch.elementClick(allData);});interactiveLayer.dispatch.on("elementMouseout",function(e){lines.clearHighlights();});dispatch.on('changeState',function(e){if(typeof e.disabled!=='undefined'&&data.length===e.disabled.length){data.forEach(function(series,i){series.disabled=e.disabled[i];});state.disabled=e.disabled;}
chart.update();});});renderWatch.renderEnd('lineChart immediate');return chart;}
lines.dispatch.on('elementMouseover.tooltip',function(evt){tooltip.data(evt).hidden(false);});lines.dispatch.on('elementMouseout.tooltip',function(evt){tooltip.hidden(true);});chart.dispatch=dispatch;chart.lines=lines;chart.legend=legend;chart.xAxis=xAxis;chart.yAxis=yAxis;chart.interactiveLayer=interactiveLayer;chart.tooltip=tooltip;chart.dispatch=dispatch;chart.options=nv.utils.optionsFunc.bind(chart);chart._options=Object.create({},{width:{get:function(){return width;},set:function(_){width=_;}},height:{get:function(){return height;},set:function(_){height=_;}},showLegend:{get:function(){return showLegend;},set:function(_){showLegend=_;}},showXAxis:{get:function(){return showXAxis;},set:function(_){showXAxis=_;}},showYAxis:{get:function(){return showYAxis;},set:function(_){showYAxis=_;}},defaultState:{get:function(){return defaultState;},set:function(_){defaultState=_;}},noData:{get:function(){return noData;},set:function(_){noData=_;}},margin:{get:function(){return margin;},set:function(_){margin.top=_.top!==undefined?_.top:margin.top;margin.right=_.right!==undefined?_.right:margin.right;margin.bottom=_.bottom!==undefined?_.bottom:margin.bottom;margin.left=_.left!==undefined?_.left:margin.left;}},duration:{get:function(){return duration;},set:function(_){duration=_;renderWatch.reset(duration);lines.duration(duration);xAxis.duration(duration);yAxis.duration(duration);}},color:{get:function(){return color;},set:function(_){color=nv.utils.getColor(_);legend.color(color);lines.color(color);}},rightAlignYAxis:{get:function(){return rightAlignYAxis;},set:function(_){rightAlignYAxis=_;yAxis.orient(rightAlignYAxis?'right':'left');}},useInteractiveGuideline:{get:function(){return useInteractiveGuideline;},set:function(_){useInteractiveGuideline=_;if(useInteractiveGuideline){lines.interactive(false);lines.useVoronoi(false);}}}});nv.utils.inheritOptions(chart,lines);nv.utils.initOptions(chart);return chart;};nv.models.linePlusBarChart=function(){"use strict";var lines=nv.models.line(),lines2=nv.models.line(),bars=nv.models.historicalBar(),bars2=nv.models.historicalBar(),xAxis=nv.models.axis(),x2Axis=nv.models.axis(),y1Axis=nv.models.axis(),y2Axis=nv.models.axis(),y3Axis=nv.models.axis(),y4Axis=nv.models.axis(),legend=nv.models.legend(),brush=d3.svg.brush(),tooltip=nv.models.tooltip();var margin={top:30,right:30,bottom:30,left:60},margin2={top:0,right:30,bottom:20,left:60},width=null,height=null,getX=function(d){return d.x},getY=function(d){return d.y},color=nv.utils.defaultColor(),showLegend=true,focusEnable=true,focusShowAxisY=false,focusShowAxisX=true,focusHeight=50,extent,brushExtent=null,x,x2,y1,y2,y3,y4,noData=null,dispatch=d3.dispatch('brush','stateChange','changeState'),transitionDuration=0,state=nv.utils.state(),defaultState=null,legendLeftAxisHint=' (left axis)',legendRightAxisHint=' (right axis)';lines.clipEdge(true);lines2.interactive(false);lines2.pointActive(function(d){return false});xAxis.orient('bottom').tickPadding(5);y1Axis.orient('left');y2Axis.orient('right');x2Axis.orient('bottom').tickPadding(5);y3Axis.orient('left');y4Axis.orient('right');tooltip.headerEnabled(true).headerFormatter(function(d,i){return xAxis.tickFormat()(d,i);});var stateGetter=function(data){return function(){return{active:data.map(function(d){return!d.disabled})};}};var stateSetter=function(data){return function(state){if(state.active!==undefined)
data.forEach(function(series,i){series.disabled=!state.active[i];});}};var allDisabled=function(data){return data.every(function(series){return series.disabled;});}
function chart(selection){selection.each(function(data){var container=d3.select(this),that=this;nv.utils.initSVG(container);var availableWidth=nv.utils.availableWidth(width,container,margin),availableHeight1=nv.utils.availableHeight(height,container,margin)
-(focusEnable?focusHeight:0),availableHeight2=focusHeight-margin2.top-margin2.bottom;chart.update=function(){container.transition().duration(transitionDuration).call(chart);};chart.container=this;state.setter(stateSetter(data),chart.update).getter(stateGetter(data)).update();state.disabled=data.map(function(d){return!!d.disabled});if(!defaultState){var key;defaultState={};for(key in state){if(state[key]instanceof Array)
defaultState[key]=state[key].slice(0);else
defaultState[key]=state[key];}}
if(!data||!data.length||!data.filter(function(d){return d.values.length}).length){nv.utils.noData(chart,container)
return chart;}else{container.selectAll('.nv-noData').remove();}
var dataBars=data.filter(function(d){return!d.disabled&&d.bar});var dataLines=data.filter(function(d){return!d.bar});x=bars.xScale();x2=x2Axis.scale();y1=bars.yScale();y2=lines.yScale();y3=bars2.yScale();y4=lines2.yScale();var series1=data.filter(function(d){return!d.disabled&&d.bar}).map(function(d){return d.values.map(function(d,i){return{x:getX(d,i),y:getY(d,i)}})});var series2=data.filter(function(d){return!d.disabled&&!d.bar}).map(function(d){return d.values.map(function(d,i){return{x:getX(d,i),y:getY(d,i)}})});x.range([0,availableWidth]);x2.domain(d3.extent(d3.merge(series1.concat(series2)),function(d){return d.x})).range([0,availableWidth]);var wrap=container.selectAll('g.nv-wrap.nv-linePlusBar').data([data]);var gEnter=wrap.enter().append('g').attr('class','nvd3 nv-wrap nv-linePlusBar').append('g');var g=wrap.select('g');gEnter.append('g').attr('class','nv-legendWrap');var focusEnter=gEnter.append('g').attr('class','nv-focus');focusEnter.append('g').attr('class','nv-x nv-axis');focusEnter.append('g').attr('class','nv-y1 nv-axis');focusEnter.append('g').attr('class','nv-y2 nv-axis');focusEnter.append('g').attr('class','nv-barsWrap');focusEnter.append('g').attr('class','nv-linesWrap');var contextEnter=gEnter.append('g').attr('class','nv-context');contextEnter.append('g').attr('class','nv-x nv-axis');contextEnter.append('g').attr('class','nv-y1 nv-axis');contextEnter.append('g').attr('class','nv-y2 nv-axis');contextEnter.append('g').attr('class','nv-barsWrap');contextEnter.append('g').attr('class','nv-linesWrap');contextEnter.append('g').attr('class','nv-brushBackground');contextEnter.append('g').attr('class','nv-x nv-brush');if(showLegend){var legendWidth=legend.align()?availableWidth/2:availableWidth;var legendXPosition=legend.align()?legendWidth:0;legend.width(legendWidth);g.select('.nv-legendWrap').datum(data.map(function(series){series.originalKey=series.originalKey===undefined?series.key:series.originalKey;series.key=series.originalKey+(series.bar?legendLeftAxisHint:legendRightAxisHint);return series;})).call(legend);if(margin.top!=legend.height()){margin.top=legend.height();availableHeight1=nv.utils.availableHeight(height,container,margin)-focusHeight;}
g.select('.nv-legendWrap').attr('transform','translate('+legendXPosition+','+(-margin.top)+')');}
wrap.attr('transform','translate('+margin.left+','+margin.top+')');g.select('.nv-context').style('display',focusEnable?'initial':'none');bars2.width(availableWidth).height(availableHeight2).color(data.map(function(d,i){return d.color||color(d,i);}).filter(function(d,i){return!data[i].disabled&&data[i].bar}));lines2.width(availableWidth).height(availableHeight2).color(data.map(function(d,i){return d.color||color(d,i);}).filter(function(d,i){return!data[i].disabled&&!data[i].bar}));var bars2Wrap=g.select('.nv-context .nv-barsWrap').datum(dataBars.length?dataBars:[{values:[]}]);var lines2Wrap=g.select('.nv-context .nv-linesWrap').datum(allDisabled(dataLines)?[{values:[]}]:dataLines.filter(function(dataLine){return!dataLine.disabled;}));g.select('.nv-context').attr('transform','translate(0,'+(availableHeight1+margin.bottom+margin2.top)+')');bars2Wrap.transition().call(bars2);lines2Wrap.transition().call(lines2);if(focusShowAxisX){x2Axis._ticks(nv.utils.calcTicksX(availableWidth/100,data)).tickSize(-availableHeight2,0);g.select('.nv-context .nv-x.nv-axis').attr('transform','translate(0,'+y3.range()[0]+')');g.select('.nv-context .nv-x.nv-axis').transition().call(x2Axis);}
if(focusShowAxisY){y3Axis.scale(y3)._ticks(availableHeight2/36).tickSize(-availableWidth,0);y4Axis.scale(y4)._ticks(availableHeight2/36).tickSize(dataBars.length?0:-availableWidth,0);g.select('.nv-context .nv-y3.nv-axis').style('opacity',dataBars.length?1:0).attr('transform','translate(0,'+x2.range()[0]+')');g.select('.nv-context .nv-y2.nv-axis').style('opacity',dataLines.length?1:0).attr('transform','translate('+x2.range()[1]+',0)');g.select('.nv-context .nv-y1.nv-axis').transition().call(y3Axis);g.select('.nv-context .nv-y2.nv-axis').transition().call(y4Axis);}
brush.x(x2).on('brush',onBrush);if(brushExtent)brush.extent(brushExtent);var brushBG=g.select('.nv-brushBackground').selectAll('g').data([brushExtent||brush.extent()]);var brushBGenter=brushBG.enter().append('g');brushBGenter.append('rect').attr('class','left').attr('x',0).attr('y',0).attr('height',availableHeight2);brushBGenter.append('rect').attr('class','right').attr('x',0).attr('y',0).attr('height',availableHeight2);var gBrush=g.select('.nv-x.nv-brush').call(brush);gBrush.selectAll('rect').attr('height',availableHeight2);gBrush.selectAll('.resize').append('path').attr('d',resizePath);legend.dispatch.on('stateChange',function(newState){for(var key in newState)
state[key]=newState[key];dispatch.stateChange(state);chart.update();});dispatch.on('changeState',function(e){if(typeof e.disabled!=='undefined'){data.forEach(function(series,i){series.disabled=e.disabled[i];});state.disabled=e.disabled;}
chart.update();});function resizePath(d){var e=+(d=='e'),x=e?1:-1,y=availableHeight2/3;return'M'+(.5*x)+','+y
+'A6,6 0 0 '+e+' '+(6.5*x)+','+(y+6)
+'V'+(2*y-6)
+'A6,6 0 0 '+e+' '+(.5*x)+','+(2*y)
+'Z'
+'M'+(2.5*x)+','+(y+8)
+'V'+(2*y-8)
+'M'+(4.5*x)+','+(y+8)
+'V'+(2*y-8);}
function updateBrushBG(){if(!brush.empty())brush.extent(brushExtent);brushBG.data([brush.empty()?x2.domain():brushExtent]).each(function(d,i){var leftWidth=x2(d[0])-x2.range()[0],rightWidth=x2.range()[1]-x2(d[1]);d3.select(this).select('.left').attr('width',leftWidth<0?0:leftWidth);d3.select(this).select('.right').attr('x',x2(d[1])).attr('width',rightWidth<0?0:rightWidth);});}
function onBrush(){brushExtent=brush.empty()?null:brush.extent();extent=brush.empty()?x2.domain():brush.extent();dispatch.brush({extent:extent,brush:brush});updateBrushBG();bars.width(availableWidth).height(availableHeight1).color(data.map(function(d,i){return d.color||color(d,i);}).filter(function(d,i){return!data[i].disabled&&data[i].bar}));lines.width(availableWidth).height(availableHeight1).color(data.map(function(d,i){return d.color||color(d,i);}).filter(function(d,i){return!data[i].disabled&&!data[i].bar}));var focusBarsWrap=g.select('.nv-focus .nv-barsWrap').datum(!dataBars.length?[{values:[]}]:dataBars.map(function(d,i){return{key:d.key,values:d.values.filter(function(d,i){return bars.x()(d,i)>=extent[0]&&bars.x()(d,i)<=extent[1];})}}));var focusLinesWrap=g.select('.nv-focus .nv-linesWrap').datum(allDisabled(dataLines)?[{values:[]}]:dataLines.filter(function(dataLine){return!dataLine.disabled;}).map(function(d,i){return{area:d.area,fillOpacity:d.fillOpacity,key:d.key,values:d.values.filter(function(d,i){return lines.x()(d,i)>=extent[0]&&lines.x()(d,i)<=extent[1];})}}));if(dataBars.length){x=bars.xScale();}else{x=lines.xScale();}
xAxis.scale(x)._ticks(nv.utils.calcTicksX(availableWidth/100,data)).tickSize(-availableHeight1,0);xAxis.domain([Math.ceil(extent[0]),Math.floor(extent[1])]);g.select('.nv-x.nv-axis').transition().duration(transitionDuration).call(xAxis);focusBarsWrap.transition().duration(transitionDuration).call(bars);focusLinesWrap.transition().duration(transitionDuration).call(lines);g.select('.nv-focus .nv-x.nv-axis').attr('transform','translate(0,'+y1.range()[0]+')');y1Axis.scale(y1)._ticks(nv.utils.calcTicksY(availableHeight1/36,data)).tickSize(-availableWidth,0);y2Axis.scale(y2)._ticks(nv.utils.calcTicksY(availableHeight1/36,data)).tickSize(dataBars.length?0:-availableWidth,0);g.select('.nv-focus .nv-y1.nv-axis').style('opacity',dataBars.length?1:0);g.select('.nv-focus .nv-y2.nv-axis').style('opacity',dataLines.length&&!allDisabled(dataLines)?1:0).attr('transform','translate('+x.range()[1]+',0)');g.select('.nv-focus .nv-y1.nv-axis').transition().duration(transitionDuration).call(y1Axis);g.select('.nv-focus .nv-y2.nv-axis').transition().duration(transitionDuration).call(y2Axis);}
onBrush();});return chart;}
lines.dispatch.on('elementMouseover.tooltip',function(evt){tooltip.duration(100).valueFormatter(function(d,i){return y2Axis.tickFormat()(d,i);}).data(evt).hidden(false);});lines.dispatch.on('elementMouseout.tooltip',function(evt){tooltip.hidden(true)});bars.dispatch.on('elementMouseover.tooltip',function(evt){evt.value=chart.x()(evt.data);evt['series']={value:chart.y()(evt.data),color:evt.color};tooltip.duration(0).valueFormatter(function(d,i){return y1Axis.tickFormat()(d,i);}).data(evt).hidden(false);});bars.dispatch.on('elementMouseout.tooltip',function(evt){tooltip.hidden(true);});bars.dispatch.on('elementMousemove.tooltip',function(evt){tooltip();});chart.dispatch=dispatch;chart.legend=legend;chart.lines=lines;chart.lines2=lines2;chart.bars=bars;chart.bars2=bars2;chart.xAxis=xAxis;chart.x2Axis=x2Axis;chart.y1Axis=y1Axis;chart.y2Axis=y2Axis;chart.y3Axis=y3Axis;chart.y4Axis=y4Axis;chart.tooltip=tooltip;chart.options=nv.utils.optionsFunc.bind(chart);chart._options=Object.create({},{width:{get:function(){return width;},set:function(_){width=_;}},height:{get:function(){return height;},set:function(_){height=_;}},showLegend:{get:function(){return showLegend;},set:function(_){showLegend=_;}},brushExtent:{get:function(){return brushExtent;},set:function(_){brushExtent=_;}},noData:{get:function(){return noData;},set:function(_){noData=_;}},focusEnable:{get:function(){return focusEnable;},set:function(_){focusEnable=_;}},focusHeight:{get:function(){return focusHeight;},set:function(_){focusHeight=_;}},focusShowAxisX:{get:function(){return focusShowAxisX;},set:function(_){focusShowAxisX=_;}},focusShowAxisY:{get:function(){return focusShowAxisY;},set:function(_){focusShowAxisY=_;}},legendLeftAxisHint:{get:function(){return legendLeftAxisHint;},set:function(_){legendLeftAxisHint=_;}},legendRightAxisHint:{get:function(){return legendRightAxisHint;},set:function(_){legendRightAxisHint=_;}},margin:{get:function(){return margin;},set:function(_){margin.top=_.top!==undefined?_.top:margin.top;margin.right=_.right!==undefined?_.right:margin.right;margin.bottom=_.bottom!==undefined?_.bottom:margin.bottom;margin.left=_.left!==undefined?_.left:margin.left;}},focusMargin:{get:function(){return margin2;},set:function(_){margin2.top=_.top!==undefined?_.top:margin2.top;margin2.right=_.right!==undefined?_.right:margin2.right;margin2.bottom=_.bottom!==undefined?_.bottom:margin2.bottom;margin2.left=_.left!==undefined?_.left:margin2.left;}},duration:{get:function(){return transitionDuration;},set:function(_){transitionDuration=_;}},color:{get:function(){return color;},set:function(_){color=nv.utils.getColor(_);legend.color(color);}},x:{get:function(){return getX;},set:function(_){getX=_;lines.x(_);lines2.x(_);bars.x(_);bars2.x(_);}},y:{get:function(){return getY;},set:function(_){getY=_;lines.y(_);lines2.y(_);bars.y(_);bars2.y(_);}}});nv.utils.inheritOptions(chart,lines);nv.utils.initOptions(chart);return chart;};nv.models.lineWithFocusChart=function(){"use strict";var lines=nv.models.line(),lines2=nv.models.line(),xAxis=nv.models.axis(),yAxis=nv.models.axis(),x2Axis=nv.models.axis(),y2Axis=nv.models.axis(),legend=nv.models.legend(),brush=d3.svg.brush(),tooltip=nv.models.tooltip(),interactiveLayer=nv.interactiveGuideline();var margin={top:30,right:30,bottom:30,left:60},margin2={top:0,right:30,bottom:20,left:60},color=nv.utils.defaultColor(),width=null,height=null,height2=50,useInteractiveGuideline=false,x,y,x2,y2,showLegend=true,brushExtent=null,noData=null,dispatch=d3.dispatch('brush','stateChange','changeState'),transitionDuration=250,state=nv.utils.state(),defaultState=null;lines.clipEdge(true).duration(0);lines2.interactive(false);lines2.pointActive(function(d){return false});xAxis.orient('bottom').tickPadding(5);yAxis.orient('left');x2Axis.orient('bottom').tickPadding(5);y2Axis.orient('left');tooltip.valueFormatter(function(d,i){return yAxis.tickFormat()(d,i);}).headerFormatter(function(d,i){return xAxis.tickFormat()(d,i);});var stateGetter=function(data){return function(){return{active:data.map(function(d){return!d.disabled})};}};var stateSetter=function(data){return function(state){if(state.active!==undefined)
data.forEach(function(series,i){series.disabled=!state.active[i];});}};function chart(selection){selection.each(function(data){var container=d3.select(this),that=this;nv.utils.initSVG(container);var availableWidth=nv.utils.availableWidth(width,container,margin),availableHeight1=nv.utils.availableHeight(height,container,margin)-height2,availableHeight2=height2-margin2.top-margin2.bottom;chart.update=function(){container.transition().duration(transitionDuration).call(chart)};chart.container=this;state.setter(stateSetter(data),chart.update).getter(stateGetter(data)).update();state.disabled=data.map(function(d){return!!d.disabled});if(!defaultState){var key;defaultState={};for(key in state){if(state[key]instanceof Array)
defaultState[key]=state[key].slice(0);else
defaultState[key]=state[key];}}
if(!data||!data.length||!data.filter(function(d){return d.values.length}).length){nv.utils.noData(chart,container)
return chart;}else{container.selectAll('.nv-noData').remove();}
x=lines.xScale();y=lines.yScale();x2=lines2.xScale();y2=lines2.yScale();var wrap=container.selectAll('g.nv-wrap.nv-lineWithFocusChart').data([data]);var gEnter=wrap.enter().append('g').attr('class','nvd3 nv-wrap nv-lineWithFocusChart').append('g');var g=wrap.select('g');gEnter.append('g').attr('class','nv-legendWrap');var focusEnter=gEnter.append('g').attr('class','nv-focus');focusEnter.append('g').attr('class','nv-x nv-axis');focusEnter.append('g').attr('class','nv-y nv-axis');focusEnter.append('g').attr('class','nv-linesWrap');focusEnter.append('g').attr('class','nv-interactive');var contextEnter=gEnter.append('g').attr('class','nv-context');contextEnter.append('g').attr('class','nv-x nv-axis');contextEnter.append('g').attr('class','nv-y nv-axis');contextEnter.append('g').attr('class','nv-linesWrap');contextEnter.append('g').attr('class','nv-brushBackground');contextEnter.append('g').attr('class','nv-x nv-brush');if(showLegend){legend.width(availableWidth);g.select('.nv-legendWrap').datum(data).call(legend);if(margin.top!=legend.height()){margin.top=legend.height();availableHeight1=nv.utils.availableHeight(height,container,margin)-height2;}
g.select('.nv-legendWrap').attr('transform','translate(0,'+(-margin.top)+')')}
wrap.attr('transform','translate('+margin.left+','+margin.top+')');if(useInteractiveGuideline){interactiveLayer.width(availableWidth).height(availableHeight1).margin({left:margin.left,top:margin.top}).svgContainer(container).xScale(x);wrap.select(".nv-interactive").call(interactiveLayer);}
lines.width(availableWidth).height(availableHeight1).color(data.map(function(d,i){return d.color||color(d,i);}).filter(function(d,i){return!data[i].disabled;}));lines2.defined(lines.defined()).width(availableWidth).height(availableHeight2).color(data.map(function(d,i){return d.color||color(d,i);}).filter(function(d,i){return!data[i].disabled;}));g.select('.nv-context').attr('transform','translate(0,'+(availableHeight1+margin.bottom+margin2.top)+')')
var contextLinesWrap=g.select('.nv-context .nv-linesWrap').datum(data.filter(function(d){return!d.disabled}))
d3.transition(contextLinesWrap).call(lines2);xAxis.scale(x)._ticks(nv.utils.calcTicksX(availableWidth/100,data)).tickSize(-availableHeight1,0);yAxis.scale(y)._ticks(nv.utils.calcTicksY(availableHeight1/36,data)).tickSize(-availableWidth,0);g.select('.nv-focus .nv-x.nv-axis').attr('transform','translate(0,'+availableHeight1+')');brush.x(x2).on('brush',function(){onBrush();});if(brushExtent)brush.extent(brushExtent);var brushBG=g.select('.nv-brushBackground').selectAll('g').data([brushExtent||brush.extent()])
var brushBGenter=brushBG.enter().append('g');brushBGenter.append('rect').attr('class','left').attr('x',0).attr('y',0).attr('height',availableHeight2);brushBGenter.append('rect').attr('class','right').attr('x',0).attr('y',0).attr('height',availableHeight2);var gBrush=g.select('.nv-x.nv-brush').call(brush);gBrush.selectAll('rect').attr('height',availableHeight2);gBrush.selectAll('.resize').append('path').attr('d',resizePath);onBrush();x2Axis.scale(x2)._ticks(nv.utils.calcTicksX(availableWidth/100,data)).tickSize(-availableHeight2,0);g.select('.nv-context .nv-x.nv-axis').attr('transform','translate(0,'+y2.range()[0]+')');d3.transition(g.select('.nv-context .nv-x.nv-axis')).call(x2Axis);y2Axis.scale(y2)._ticks(nv.utils.calcTicksY(availableHeight2/36,data)).tickSize(-availableWidth,0);d3.transition(g.select('.nv-context .nv-y.nv-axis')).call(y2Axis);g.select('.nv-context .nv-x.nv-axis').attr('transform','translate(0,'+y2.range()[0]+')');legend.dispatch.on('stateChange',function(newState){for(var key in newState)
state[key]=newState[key];dispatch.stateChange(state);chart.update();});interactiveLayer.dispatch.on('elementMousemove',function(e){lines.clearHighlights();var singlePoint,pointIndex,pointXLocation,allData=[];data.filter(function(series,i){series.seriesIndex=i;return!series.disabled;}).forEach(function(series,i){var extent=brush.empty()?x2.domain():brush.extent();var currentValues=series.values.filter(function(d,i){return lines.x()(d,i)>=extent[0]&&lines.x()(d,i)<=extent[1];});pointIndex=nv.interactiveBisect(currentValues,e.pointXValue,lines.x());var point=currentValues[pointIndex];var pointYValue=chart.y()(point,pointIndex);if(pointYValue!=null){lines.highlightPoint(i,pointIndex,true);}
if(point===undefined)return;if(singlePoint===undefined)singlePoint=point;if(pointXLocation===undefined)pointXLocation=chart.xScale()(chart.x()(point,pointIndex));allData.push({key:series.key,value:chart.y()(point,pointIndex),color:color(series,series.seriesIndex)});});if(allData.length>2){var yValue=chart.yScale().invert(e.mouseY);var domainExtent=Math.abs(chart.yScale().domain()[0]-chart.yScale().domain()[1]);var threshold=0.03*domainExtent;var indexToHighlight=nv.nearestValueIndex(allData.map(function(d){return d.value}),yValue,threshold);if(indexToHighlight!==null)
allData[indexToHighlight].highlight=true;}
var xValue=xAxis.tickFormat()(chart.x()(singlePoint,pointIndex));interactiveLayer.tooltip.chartContainer(that.parentNode).valueFormatter(function(d,i){return d==null?"N/A":yAxis.tickFormat()(d);}).data({value:xValue,index:pointIndex,series:allData})();interactiveLayer.renderGuideLine(pointXLocation);});interactiveLayer.dispatch.on("elementMouseout",function(e){lines.clearHighlights();});dispatch.on('changeState',function(e){if(typeof e.disabled!=='undefined'){data.forEach(function(series,i){series.disabled=e.disabled[i];});}
chart.update();});function resizePath(d){var e=+(d=='e'),x=e?1:-1,y=availableHeight2/3;return'M'+(.5*x)+','+y
+'A6,6 0 0 '+e+' '+(6.5*x)+','+(y+6)
+'V'+(2*y-6)
+'A6,6 0 0 '+e+' '+(.5*x)+','+(2*y)
+'Z'
+'M'+(2.5*x)+','+(y+8)
+'V'+(2*y-8)
+'M'+(4.5*x)+','+(y+8)
+'V'+(2*y-8);}
function updateBrushBG(){if(!brush.empty())brush.extent(brushExtent);brushBG.data([brush.empty()?x2.domain():brushExtent]).each(function(d,i){var leftWidth=x2(d[0])-x.range()[0],rightWidth=availableWidth-x2(d[1]);d3.select(this).select('.left').attr('width',leftWidth<0?0:leftWidth);d3.select(this).select('.right').attr('x',x2(d[1])).attr('width',rightWidth<0?0:rightWidth);});}
function onBrush(){brushExtent=brush.empty()?null:brush.extent();var extent=brush.empty()?x2.domain():brush.extent();if(Math.abs(extent[0]-extent[1])<=1){return;}
dispatch.brush({extent:extent,brush:brush});updateBrushBG();var focusLinesWrap=g.select('.nv-focus .nv-linesWrap').datum(data.filter(function(d){return!d.disabled}).map(function(d,i){return{key:d.key,area:d.area,classed:d.classed,values:d.values.filter(function(d,i){return lines.x()(d,i)>=extent[0]&&lines.x()(d,i)<=extent[1];})}}));focusLinesWrap.transition().duration(transitionDuration).call(lines);g.select('.nv-focus .nv-x.nv-axis').transition().duration(transitionDuration).call(xAxis);g.select('.nv-focus .nv-y.nv-axis').transition().duration(transitionDuration).call(yAxis);}});return chart;}
lines.dispatch.on('elementMouseover.tooltip',function(evt){tooltip.data(evt).hidden(false);});lines.dispatch.on('elementMouseout.tooltip',function(evt){tooltip.hidden(true)});chart.dispatch=dispatch;chart.legend=legend;chart.lines=lines;chart.lines2=lines2;chart.xAxis=xAxis;chart.yAxis=yAxis;chart.x2Axis=x2Axis;chart.y2Axis=y2Axis;chart.interactiveLayer=interactiveLayer;chart.tooltip=tooltip;chart.options=nv.utils.optionsFunc.bind(chart);chart._options=Object.create({},{width:{get:function(){return width;},set:function(_){width=_;}},height:{get:function(){return height;},set:function(_){height=_;}},focusHeight:{get:function(){return height2;},set:function(_){height2=_;}},showLegend:{get:function(){return showLegend;},set:function(_){showLegend=_;}},brushExtent:{get:function(){return brushExtent;},set:function(_){brushExtent=_;}},defaultState:{get:function(){return defaultState;},set:function(_){defaultState=_;}},noData:{get:function(){return noData;},set:function(_){noData=_;}},margin:{get:function(){return margin;},set:function(_){margin.top=_.top!==undefined?_.top:margin.top;margin.right=_.right!==undefined?_.right:margin.right;margin.bottom=_.bottom!==undefined?_.bottom:margin.bottom;margin.left=_.left!==undefined?_.left:margin.left;}},focusMargin:{get:function(){return margin2;},set:function(_){margin2.top=_.top!==undefined?_.top:margin2.top;margin2.right=_.right!==undefined?_.right:margin2.right;margin2.bottom=_.bottom!==undefined?_.bottom:margin2.bottom;margin2.left=_.left!==undefined?_.left:margin2.left;}},color:{get:function(){return color;},set:function(_){color=nv.utils.getColor(_);legend.color(color);}},interpolate:{get:function(){return lines.interpolate();},set:function(_){lines.interpolate(_);lines2.interpolate(_);}},xTickFormat:{get:function(){return xAxis.tickFormat();},set:function(_){xAxis.tickFormat(_);x2Axis.tickFormat(_);}},yTickFormat:{get:function(){return yAxis.tickFormat();},set:function(_){yAxis.tickFormat(_);y2Axis.tickFormat(_);}},duration:{get:function(){return transitionDuration;},set:function(_){transitionDuration=_;yAxis.duration(transitionDuration);y2Axis.duration(transitionDuration);xAxis.duration(transitionDuration);x2Axis.duration(transitionDuration);}},x:{get:function(){return lines.x();},set:function(_){lines.x(_);lines2.x(_);}},y:{get:function(){return lines.y();},set:function(_){lines.y(_);lines2.y(_);}},useInteractiveGuideline:{get:function(){return useInteractiveGuideline;},set:function(_){useInteractiveGuideline=_;if(useInteractiveGuideline){lines.interactive(false);lines.useVoronoi(false);}}}});nv.utils.inheritOptions(chart,lines);nv.utils.initOptions(chart);return chart;};nv.models.multiBar=function(){"use strict";var margin={top:0,right:0,bottom:0,left:0},width=960,height=500,x=d3.scale.ordinal(),y=d3.scale.linear(),id=Math.floor(Math.random()*10000),container=null,getX=function(d){return d.x},getY=function(d){return d.y},forceY=[0],clipEdge=true,stacked=false,stackOffset='zero',color=nv.utils.defaultColor(),hideable=false,barColor=null,disabled,duration=500,xDomain,yDomain,xRange,yRange,groupSpacing=0.1,dispatch=d3.dispatch('chartClick','elementClick','elementDblClick','elementMouseover','elementMouseout','elementMousemove','renderEnd');var x0,y0,renderWatch=nv.utils.renderWatch(dispatch,duration);var last_datalength=0;function chart(selection){renderWatch.reset();selection.each(function(data){var availableWidth=width-margin.left-margin.right,availableHeight=height-margin.top-margin.bottom;container=d3.select(this);nv.utils.initSVG(container);var nonStackableCount=0;var endFn=function(d,i){if(d.series===data.length-1&&i===data[0].values.length-1)
return true;return false;};if(hideable&&data.length)hideable=[{values:data[0].values.map(function(d){return{x:d.x,y:0,series:d.series,size:0.01};})}];if(stacked){var parsed=d3.layout.stack().offset(stackOffset).values(function(d){return d.values}).y(getY)
(!data.length&&hideable?hideable:data);parsed.forEach(function(series,i){if(series.nonStackable){data[i].nonStackableSeries=nonStackableCount++;parsed[i]=data[i];}else{if(i>0&&parsed[i-1].nonStackable){parsed[i].values.map(function(d,j){d.y0-=parsed[i-1].values[j].y;d.y1=d.y0+d.y;});}}});data=parsed;}
data.forEach(function(series,i){series.values.forEach(function(point){point.series=i;point.key=series.key;});});if(stacked){data[0].values.map(function(d,i){var posBase=0,negBase=0;data.map(function(d,idx){if(!data[idx].nonStackable){var f=d.values[i]
f.size=Math.abs(f.y);if(f.y<0){f.y1=negBase;negBase=negBase-f.size;}else
{f.y1=f.size+posBase;posBase=posBase+f.size;}}});});}
var seriesData=(xDomain&&yDomain)?[]:data.map(function(d,idx){return d.values.map(function(d,i){return{x:getX(d,i),y:getY(d,i),y0:d.y0,y1:d.y1,idx:idx}})});x.domain(xDomain||d3.merge(seriesData).map(function(d){return d.x})).rangeBands(xRange||[0,availableWidth],groupSpacing);y.domain(yDomain||d3.extent(d3.merge(seriesData).map(function(d){var domain=d.y;if(stacked&&!data[d.idx].nonStackable){if(d.y>0){domain=d.y1}else{domain=d.y1+d.y}}
return domain;}).concat(forceY))).range(yRange||[availableHeight,0]);if(x.domain()[0]===x.domain()[1])
x.domain()[0]?x.domain([x.domain()[0]-x.domain()[0]*0.01,x.domain()[1]+x.domain()[1]*0.01]):x.domain([-1,1]);if(y.domain()[0]===y.domain()[1])
y.domain()[0]?y.domain([y.domain()[0]+y.domain()[0]*0.01,y.domain()[1]-y.domain()[1]*0.01]):y.domain([-1,1]);x0=x0||x;y0=y0||y;var wrap=container.selectAll('g.nv-wrap.nv-multibar').data([data]);var wrapEnter=wrap.enter().append('g').attr('class','nvd3 nv-wrap nv-multibar');var defsEnter=wrapEnter.append('defs');var gEnter=wrapEnter.append('g');var g=wrap.select('g');gEnter.append('g').attr('class','nv-groups');wrap.attr('transform','translate('+margin.left+','+margin.top+')');defsEnter.append('clipPath').attr('id','nv-edge-clip-'+id).append('rect');wrap.select('#nv-edge-clip-'+id+' rect').attr('width',availableWidth).attr('height',availableHeight);g.attr('clip-path',clipEdge?'url(#nv-edge-clip-'+id+')':'');var groups=wrap.select('.nv-groups').selectAll('.nv-group').data(function(d){return d},function(d,i){return i});groups.enter().append('g').style('stroke-opacity',1e-6).style('fill-opacity',1e-6);var exitTransition=renderWatch.transition(groups.exit().selectAll('rect.nv-bar'),'multibarExit',Math.min(100,duration)).attr('y',function(d,i,j){var yVal=y0(0)||0;if(stacked){if(data[d.series]&&!data[d.series].nonStackable){yVal=y0(d.y0);}}
return yVal;}).attr('height',0).remove();if(exitTransition.delay)
exitTransition.delay(function(d,i){var delay=i*(duration/(last_datalength+1))-i;return delay;});groups.attr('class',function(d,i){return'nv-group nv-series-'+i}).classed('hover',function(d){return d.hover}).style('fill',function(d,i){return color(d,i)}).style('stroke',function(d,i){return color(d,i)});groups.style('stroke-opacity',1).style('fill-opacity',0.75);var bars=groups.selectAll('rect.nv-bar').data(function(d){return(hideable&&!data.length)?hideable.values:d.values});bars.exit().remove();var barsEnter=bars.enter().append('rect').attr('class',function(d,i){return getY(d,i)<0?'nv-bar negative':'nv-bar positive'}).attr('x',function(d,i,j){return stacked&&!data[j].nonStackable?0:(j*x.rangeBand()/data.length)}).attr('y',function(d,i,j){return y0(stacked&&!data[j].nonStackable?d.y0:0)||0}).attr('height',0).attr('width',function(d,i,j){return x.rangeBand()/(stacked&&!data[j].nonStackable?1:data.length)}).attr('transform',function(d,i){return'translate('+x(getX(d,i))+',0)';});bars.style('fill',function(d,i,j){return color(d,j,i);}).style('stroke',function(d,i,j){return color(d,j,i);}).on('mouseover',function(d,i){d3.select(this).classed('hover',true);dispatch.elementMouseover({data:d,index:i,color:d3.select(this).style("fill")});}).on('mouseout',function(d,i){d3.select(this).classed('hover',false);dispatch.elementMouseout({data:d,index:i,color:d3.select(this).style("fill")});}).on('mousemove',function(d,i){dispatch.elementMousemove({data:d,index:i,color:d3.select(this).style("fill")});}).on('click',function(d,i){dispatch.elementClick({data:d,index:i,color:d3.select(this).style("fill")});d3.event.stopPropagation();}).on('dblclick',function(d,i){dispatch.elementDblClick({data:d,index:i,color:d3.select(this).style("fill")});d3.event.stopPropagation();});bars.attr('class',function(d,i){return getY(d,i)<0?'nv-bar negative':'nv-bar positive'}).attr('transform',function(d,i){return'translate('+x(getX(d,i))+',0)';})
if(barColor){if(!disabled)disabled=data.map(function(){return true});bars.style('fill',function(d,i,j){return d3.rgb(barColor(d,i)).darker(disabled.map(function(d,i){return i}).filter(function(d,i){return!disabled[i]})[j]).toString();}).style('stroke',function(d,i,j){return d3.rgb(barColor(d,i)).darker(disabled.map(function(d,i){return i}).filter(function(d,i){return!disabled[i]})[j]).toString();});}
var barSelection=bars.watchTransition(renderWatch,'multibar',Math.min(250,duration)).delay(function(d,i){return i*duration/data[0].values.length;});if(stacked){barSelection.attr('y',function(d,i,j){var yVal=0;if(!data[j].nonStackable){yVal=y(d.y1);}else{if(getY(d,i)<0){yVal=y(0);}else{if(y(0)-y(getY(d,i))<-1){yVal=y(0)-1;}else{yVal=y(getY(d,i))||0;}}}
return yVal;}).attr('height',function(d,i,j){if(!data[j].nonStackable){return Math.max(Math.abs(y(d.y+d.y0)-y(d.y0)),0);}else{return Math.max(Math.abs(y(getY(d,i))-y(0)),0)||0;}}).attr('x',function(d,i,j){var width=0;if(data[j].nonStackable){width=d.series*x.rangeBand()/data.length;if(data.length!==nonStackableCount){width=data[j].nonStackableSeries*x.rangeBand()/(nonStackableCount*2);}}
return width;}).attr('width',function(d,i,j){if(!data[j].nonStackable){return x.rangeBand();}else{var width=(x.rangeBand()/nonStackableCount);if(data.length!==nonStackableCount){width=x.rangeBand()/(nonStackableCount*2);}
return width;}});}
else{barSelection.attr('x',function(d,i){return d.series*x.rangeBand()/data.length;}).attr('width',x.rangeBand()/data.length).attr('y',function(d,i){return getY(d,i)<0?y(0):y(0)-y(getY(d,i))<1?y(0)-1:y(getY(d,i))||0;}).attr('height',function(d,i){return Math.max(Math.abs(y(getY(d,i))-y(0)),1)||0;});}
x0=x.copy();y0=y.copy();if(data[0]&&data[0].values){last_datalength=data[0].values.length;}});renderWatch.renderEnd('multibar immediate');return chart;}
chart.dispatch=dispatch;chart.options=nv.utils.optionsFunc.bind(chart);chart._options=Object.create({},{width:{get:function(){return width;},set:function(_){width=_;}},height:{get:function(){return height;},set:function(_){height=_;}},x:{get:function(){return getX;},set:function(_){getX=_;}},y:{get:function(){return getY;},set:function(_){getY=_;}},xScale:{get:function(){return x;},set:function(_){x=_;}},yScale:{get:function(){return y;},set:function(_){y=_;}},xDomain:{get:function(){return xDomain;},set:function(_){xDomain=_;}},yDomain:{get:function(){return yDomain;},set:function(_){yDomain=_;}},xRange:{get:function(){return xRange;},set:function(_){xRange=_;}},yRange:{get:function(){return yRange;},set:function(_){yRange=_;}},forceY:{get:function(){return forceY;},set:function(_){forceY=_;}},stacked:{get:function(){return stacked;},set:function(_){stacked=_;}},stackOffset:{get:function(){return stackOffset;},set:function(_){stackOffset=_;}},clipEdge:{get:function(){return clipEdge;},set:function(_){clipEdge=_;}},disabled:{get:function(){return disabled;},set:function(_){disabled=_;}},id:{get:function(){return id;},set:function(_){id=_;}},hideable:{get:function(){return hideable;},set:function(_){hideable=_;}},groupSpacing:{get:function(){return groupSpacing;},set:function(_){groupSpacing=_;}},margin:{get:function(){return margin;},set:function(_){margin.top=_.top!==undefined?_.top:margin.top;margin.right=_.right!==undefined?_.right:margin.right;margin.bottom=_.bottom!==undefined?_.bottom:margin.bottom;margin.left=_.left!==undefined?_.left:margin.left;}},duration:{get:function(){return duration;},set:function(_){duration=_;renderWatch.reset(duration);}},color:{get:function(){return color;},set:function(_){color=nv.utils.getColor(_);}},barColor:{get:function(){return barColor;},set:function(_){barColor=_?nv.utils.getColor(_):null;}}});nv.utils.initOptions(chart);return chart;};nv.models.multiBarChart=function(){"use strict";var multibar=nv.models.multiBar(),xAxis=nv.models.axis(),yAxis=nv.models.axis(),legend=nv.models.legend(),controls=nv.models.legend(),tooltip=nv.models.tooltip();var margin={top:30,right:20,bottom:50,left:60},width=null,height=null,color=nv.utils.defaultColor(),showControls=true,controlLabels={},showLegend=true,showXAxis=true,showYAxis=true,rightAlignYAxis=false,reduceXTicks=true,staggerLabels=false,wrapLabels=false,rotateLabels=0,x,y,state=nv.utils.state(),defaultState=null,noData=null,dispatch=d3.dispatch('stateChange','changeState','renderEnd'),controlWidth=function(){return showControls?180:0},duration=250;state.stacked=false
multibar.stacked(false);xAxis.orient('bottom').tickPadding(7).showMaxMin(false).tickFormat(function(d){return d});yAxis.orient((rightAlignYAxis)?'right':'left').tickFormat(d3.format(',.1f'));tooltip.duration(0).valueFormatter(function(d,i){return yAxis.tickFormat()(d,i);}).headerFormatter(function(d,i){return xAxis.tickFormat()(d,i);});controls.updateState(false);var renderWatch=nv.utils.renderWatch(dispatch);var stacked=false;var stateGetter=function(data){return function(){return{active:data.map(function(d){return!d.disabled}),stacked:stacked};}};var stateSetter=function(data){return function(state){if(state.stacked!==undefined)
stacked=state.stacked;if(state.active!==undefined)
data.forEach(function(series,i){series.disabled=!state.active[i];});}};function chart(selection){renderWatch.reset();renderWatch.models(multibar);if(showXAxis)renderWatch.models(xAxis);if(showYAxis)renderWatch.models(yAxis);selection.each(function(data){var container=d3.select(this),that=this;nv.utils.initSVG(container);var availableWidth=nv.utils.availableWidth(width,container,margin),availableHeight=nv.utils.availableHeight(height,container,margin);chart.update=function(){if(duration===0)
container.call(chart);else
container.transition().duration(duration).call(chart);};chart.container=this;state.setter(stateSetter(data),chart.update).getter(stateGetter(data)).update();state.disabled=data.map(function(d){return!!d.disabled});if(!defaultState){var key;defaultState={};for(key in state){if(state[key]instanceof Array)
defaultState[key]=state[key].slice(0);else
defaultState[key]=state[key];}}
if(!data||!data.length||!data.filter(function(d){return d.values.length}).length){nv.utils.noData(chart,container)
return chart;}else{container.selectAll('.nv-noData').remove();}
x=multibar.xScale();y=multibar.yScale();var wrap=container.selectAll('g.nv-wrap.nv-multiBarWithLegend').data([data]);var gEnter=wrap.enter().append('g').attr('class','nvd3 nv-wrap nv-multiBarWithLegend').append('g');var g=wrap.select('g');gEnter.append('g').attr('class','nv-x nv-axis');gEnter.append('g').attr('class','nv-y nv-axis');gEnter.append('g').attr('class','nv-barsWrap');gEnter.append('g').attr('class','nv-legendWrap');gEnter.append('g').attr('class','nv-controlsWrap');if(showLegend){legend.width(availableWidth-controlWidth());g.select('.nv-legendWrap').datum(data).call(legend);if(margin.top!=legend.height()){margin.top=legend.height();availableHeight=nv.utils.availableHeight(height,container,margin);}
g.select('.nv-legendWrap').attr('transform','translate('+controlWidth()+','+(-margin.top)+')');}
if(showControls){var controlsData=[{key:controlLabels.grouped||'Grouped',disabled:multibar.stacked()},{key:controlLabels.stacked||'Stacked',disabled:!multibar.stacked()}];controls.width(controlWidth()).color(['#444','#444','#444']);g.select('.nv-controlsWrap').datum(controlsData).attr('transform','translate(0,'+(-margin.top)+')').call(controls);}
wrap.attr('transform','translate('+margin.left+','+margin.top+')');if(rightAlignYAxis){g.select(".nv-y.nv-axis").attr("transform","translate("+availableWidth+",0)");}
multibar.disabled(data.map(function(series){return series.disabled})).width(availableWidth).height(availableHeight).color(data.map(function(d,i){return d.color||color(d,i);}).filter(function(d,i){return!data[i].disabled}));var barsWrap=g.select('.nv-barsWrap').datum(data.filter(function(d){return!d.disabled}));barsWrap.call(multibar);if(showXAxis){xAxis.scale(x)._ticks(nv.utils.calcTicksX(availableWidth/100,data)).tickSize(-availableHeight,0);g.select('.nv-x.nv-axis').attr('transform','translate(0,'+y.range()[0]+')');g.select('.nv-x.nv-axis').call(xAxis);var xTicks=g.select('.nv-x.nv-axis > g').selectAll('g');xTicks.selectAll('line, text').style('opacity',1)
if(staggerLabels){var getTranslate=function(x,y){return"translate("+x+","+y+")";};var staggerUp=5,staggerDown=17;xTicks.selectAll("text").attr('transform',function(d,i,j){return getTranslate(0,(j%2==0?staggerUp:staggerDown));});var totalInBetweenTicks=d3.selectAll(".nv-x.nv-axis .nv-wrap g g text")[0].length;g.selectAll(".nv-x.nv-axis .nv-axisMaxMin text").attr("transform",function(d,i){return getTranslate(0,(i===0||totalInBetweenTicks%2!==0)?staggerDown:staggerUp);});}
if(wrapLabels){g.selectAll('.tick text').call(nv.utils.wrapTicks,chart.xAxis.rangeBand())}
if(reduceXTicks)
xTicks.filter(function(d,i){return i%Math.ceil(data[0].values.length/(availableWidth/100))!==0;}).selectAll('text, line').style('opacity',0);if(rotateLabels)
xTicks.selectAll('.tick text').attr('transform','rotate('+rotateLabels+' 0,0)').style('text-anchor',rotateLabels>0?'start':'end');g.select('.nv-x.nv-axis').selectAll('g.nv-axisMaxMin text').style('opacity',1);}
if(showYAxis){yAxis.scale(y)._ticks(nv.utils.calcTicksY(availableHeight/36,data)).tickSize(-availableWidth,0);g.select('.nv-y.nv-axis').call(yAxis);}
legend.dispatch.on('stateChange',function(newState){for(var key in newState)
state[key]=newState[key];dispatch.stateChange(state);chart.update();});controls.dispatch.on('legendClick',function(d,i){if(!d.disabled)return;controlsData=controlsData.map(function(s){s.disabled=true;return s;});d.disabled=false;switch(d.key){case'Grouped':case controlLabels.grouped:multibar.stacked(false);break;case'Stacked':case controlLabels.stacked:multibar.stacked(true);break;}
state.stacked=multibar.stacked();dispatch.stateChange(state);chart.update();});dispatch.on('changeState',function(e){if(typeof e.disabled!=='undefined'){data.forEach(function(series,i){series.disabled=e.disabled[i];});state.disabled=e.disabled;}
if(typeof e.stacked!=='undefined'){multibar.stacked(e.stacked);state.stacked=e.stacked;stacked=e.stacked;}
chart.update();});});renderWatch.renderEnd('multibarchart immediate');return chart;}
multibar.dispatch.on('elementMouseover.tooltip',function(evt){evt.value=chart.x()(evt.data);evt['series']={key:evt.data.key,value:chart.y()(evt.data),color:evt.color};tooltip.data(evt).hidden(false);});multibar.dispatch.on('elementMouseout.tooltip',function(evt){tooltip.hidden(true);});multibar.dispatch.on('elementMousemove.tooltip',function(evt){tooltip();});chart.dispatch=dispatch;chart.multibar=multibar;chart.legend=legend;chart.controls=controls;chart.xAxis=xAxis;chart.yAxis=yAxis;chart.state=state;chart.tooltip=tooltip;chart.options=nv.utils.optionsFunc.bind(chart);chart._options=Object.create({},{width:{get:function(){return width;},set:function(_){width=_;}},height:{get:function(){return height;},set:function(_){height=_;}},showLegend:{get:function(){return showLegend;},set:function(_){showLegend=_;}},showControls:{get:function(){return showControls;},set:function(_){showControls=_;}},controlLabels:{get:function(){return controlLabels;},set:function(_){controlLabels=_;}},showXAxis:{get:function(){return showXAxis;},set:function(_){showXAxis=_;}},showYAxis:{get:function(){return showYAxis;},set:function(_){showYAxis=_;}},defaultState:{get:function(){return defaultState;},set:function(_){defaultState=_;}},noData:{get:function(){return noData;},set:function(_){noData=_;}},reduceXTicks:{get:function(){return reduceXTicks;},set:function(_){reduceXTicks=_;}},rotateLabels:{get:function(){return rotateLabels;},set:function(_){rotateLabels=_;}},staggerLabels:{get:function(){return staggerLabels;},set:function(_){staggerLabels=_;}},wrapLabels:{get:function(){return wrapLabels;},set:function(_){wrapLabels=!!_;}},margin:{get:function(){return margin;},set:function(_){margin.top=_.top!==undefined?_.top:margin.top;margin.right=_.right!==undefined?_.right:margin.right;margin.bottom=_.bottom!==undefined?_.bottom:margin.bottom;margin.left=_.left!==undefined?_.left:margin.left;}},duration:{get:function(){return duration;},set:function(_){duration=_;multibar.duration(duration);xAxis.duration(duration);yAxis.duration(duration);renderWatch.reset(duration);}},color:{get:function(){return color;},set:function(_){color=nv.utils.getColor(_);legend.color(color);}},rightAlignYAxis:{get:function(){return rightAlignYAxis;},set:function(_){rightAlignYAxis=_;yAxis.orient(rightAlignYAxis?'right':'left');}},barColor:{get:function(){return multibar.barColor;},set:function(_){multibar.barColor(_);legend.color(function(d,i){return d3.rgb('#ccc').darker(i*1.5).toString();})}}});nv.utils.inheritOptions(chart,multibar);nv.utils.initOptions(chart);return chart;};nv.models.multiBarHorizontal=function(){"use strict";var margin={top:0,right:0,bottom:0,left:0},width=960,height=500,id=Math.floor(Math.random()*10000),container=null,x=d3.scale.ordinal(),y=d3.scale.linear(),getX=function(d){return d.x},getY=function(d){return d.y},getYerr=function(d){return d.yErr},forceY=[0],color=nv.utils.defaultColor(),barColor=null,disabled,stacked=false,showValues=false,showBarLabels=false,valuePadding=60,groupSpacing=0.1,valueFormat=d3.format(',.2f'),delay=1200,xDomain,yDomain,xRange,yRange,duration=250,dispatch=d3.dispatch('chartClick','elementClick','elementDblClick','elementMouseover','elementMouseout','elementMousemove','renderEnd');var x0,y0;var renderWatch=nv.utils.renderWatch(dispatch,duration);function chart(selection){renderWatch.reset();selection.each(function(data){var availableWidth=width-margin.left-margin.right,availableHeight=height-margin.top-margin.bottom;container=d3.select(this);nv.utils.initSVG(container);if(stacked)
data=d3.layout.stack().offset('zero').values(function(d){return d.values}).y(getY)
(data);data.forEach(function(series,i){series.values.forEach(function(point){point.series=i;point.key=series.key;});});if(stacked)
data[0].values.map(function(d,i){var posBase=0,negBase=0;data.map(function(d){var f=d.values[i]
f.size=Math.abs(f.y);if(f.y<0){f.y1=negBase-f.size;negBase=negBase-f.size;}else
{f.y1=posBase;posBase=posBase+f.size;}});});var seriesData=(xDomain&&yDomain)?[]:data.map(function(d){return d.values.map(function(d,i){return{x:getX(d,i),y:getY(d,i),y0:d.y0,y1:d.y1}})});x.domain(xDomain||d3.merge(seriesData).map(function(d){return d.x})).rangeBands(xRange||[0,availableHeight],groupSpacing);y.domain(yDomain||d3.extent(d3.merge(seriesData).map(function(d){return stacked?(d.y>0?d.y1+d.y:d.y1):d.y}).concat(forceY)))
if(showValues&&!stacked)
y.range(yRange||[(y.domain()[0]<0?valuePadding:0),availableWidth-(y.domain()[1]>0?valuePadding:0)]);else
y.range(yRange||[0,availableWidth]);x0=x0||x;y0=y0||d3.scale.linear().domain(y.domain()).range([y(0),y(0)]);var wrap=d3.select(this).selectAll('g.nv-wrap.nv-multibarHorizontal').data([data]);var wrapEnter=wrap.enter().append('g').attr('class','nvd3 nv-wrap nv-multibarHorizontal');var defsEnter=wrapEnter.append('defs');var gEnter=wrapEnter.append('g');var g=wrap.select('g');gEnter.append('g').attr('class','nv-groups');wrap.attr('transform','translate('+margin.left+','+margin.top+')');var groups=wrap.select('.nv-groups').selectAll('.nv-group').data(function(d){return d},function(d,i){return i});groups.enter().append('g').style('stroke-opacity',1e-6).style('fill-opacity',1e-6);groups.exit().watchTransition(renderWatch,'multibarhorizontal: exit groups').style('stroke-opacity',1e-6).style('fill-opacity',1e-6).remove();groups.attr('class',function(d,i){return'nv-group nv-series-'+i}).classed('hover',function(d){return d.hover}).style('fill',function(d,i){return color(d,i)}).style('stroke',function(d,i){return color(d,i)});groups.watchTransition(renderWatch,'multibarhorizontal: groups').style('stroke-opacity',1).style('fill-opacity',.75);var bars=groups.selectAll('g.nv-bar').data(function(d){return d.values});bars.exit().remove();var barsEnter=bars.enter().append('g').attr('transform',function(d,i,j){return'translate('+y0(stacked?d.y0:0)+','+(stacked?0:(j*x.rangeBand()/data.length)+x(getX(d,i)))+')'});barsEnter.append('rect').attr('width',0).attr('height',x.rangeBand()/(stacked?1:data.length))
bars.on('mouseover',function(d,i){d3.select(this).classed('hover',true);dispatch.elementMouseover({data:d,index:i,color:d3.select(this).style("fill")});}).on('mouseout',function(d,i){d3.select(this).classed('hover',false);dispatch.elementMouseout({data:d,index:i,color:d3.select(this).style("fill")});}).on('mouseout',function(d,i){dispatch.elementMouseout({data:d,index:i,color:d3.select(this).style("fill")});}).on('mousemove',function(d,i){dispatch.elementMousemove({data:d,index:i,color:d3.select(this).style("fill")});}).on('click',function(d,i){dispatch.elementClick({data:d,index:i,color:d3.select(this).style("fill")});d3.event.stopPropagation();}).on('dblclick',function(d,i){dispatch.elementDblClick({data:d,index:i,color:d3.select(this).style("fill")});d3.event.stopPropagation();});if(getYerr(data[0],0)){barsEnter.append('polyline');bars.select('polyline').attr('fill','none').attr('points',function(d,i){var xerr=getYerr(d,i),mid=0.8*x.rangeBand()/((stacked?1:data.length)*2);xerr=xerr.length?xerr:[-Math.abs(xerr),Math.abs(xerr)];xerr=xerr.map(function(e){return y(e)-y(0);});var a=[[xerr[0],-mid],[xerr[0],mid],[xerr[0],0],[xerr[1],0],[xerr[1],-mid],[xerr[1],mid]];return a.map(function(path){return path.join(',')}).join(' ');}).attr('transform',function(d,i){var mid=x.rangeBand()/((stacked?1:data.length)*2);return'translate('+(getY(d,i)<0?0:y(getY(d,i))-y(0))+', '+mid+')'});}
barsEnter.append('text');if(showValues&&!stacked){bars.select('text').attr('text-anchor',function(d,i){return getY(d,i)<0?'end':'start'}).attr('y',x.rangeBand()/(data.length*2)).attr('dy','.32em').text(function(d,i){var t=valueFormat(getY(d,i)),yerr=getYerr(d,i);if(yerr===undefined)
return t;if(!yerr.length)
return t+'±'+valueFormat(Math.abs(yerr));return t+'+'+valueFormat(Math.abs(yerr[1]))+'-'+valueFormat(Math.abs(yerr[0]));});bars.watchTransition(renderWatch,'multibarhorizontal: bars').select('text').attr('x',function(d,i){return getY(d,i)<0?-4:y(getY(d,i))-y(0)+4})}else{bars.selectAll('text').text('');}
if(showBarLabels&&!stacked){barsEnter.append('text').classed('nv-bar-label',true);bars.select('text.nv-bar-label').attr('text-anchor',function(d,i){return getY(d,i)<0?'start':'end'}).attr('y',x.rangeBand()/(data.length*2)).attr('dy','.32em').text(function(d,i){return getX(d,i)});bars.watchTransition(renderWatch,'multibarhorizontal: bars').select('text.nv-bar-label').attr('x',function(d,i){return getY(d,i)<0?y(0)-y(getY(d,i))+4:-4});}
else{bars.selectAll('text.nv-bar-label').text('');}
bars.attr('class',function(d,i){return getY(d,i)<0?'nv-bar negative':'nv-bar positive'})
if(barColor){if(!disabled)disabled=data.map(function(){return true});bars.style('fill',function(d,i,j){return d3.rgb(barColor(d,i)).darker(disabled.map(function(d,i){return i}).filter(function(d,i){return!disabled[i]})[j]).toString();}).style('stroke',function(d,i,j){return d3.rgb(barColor(d,i)).darker(disabled.map(function(d,i){return i}).filter(function(d,i){return!disabled[i]})[j]).toString();});}
if(stacked)
bars.watchTransition(renderWatch,'multibarhorizontal: bars').attr('transform',function(d,i){return'translate('+y(d.y1)+','+x(getX(d,i))+')'}).select('rect').attr('width',function(d,i){return Math.abs(y(getY(d,i)+d.y0)-y(d.y0))||0}).attr('height',x.rangeBand());else
bars.watchTransition(renderWatch,'multibarhorizontal: bars').attr('transform',function(d,i){return'translate('+
(getY(d,i)<0?y(getY(d,i)):y(0))
+','+
(d.series*x.rangeBand()/data.length
+
x(getX(d,i)))
+')'}).select('rect').attr('height',x.rangeBand()/data.length).attr('width',function(d,i){return Math.max(Math.abs(y(getY(d,i))-y(0)),1)||0});x0=x.copy();y0=y.copy();});renderWatch.renderEnd('multibarHorizontal immediate');return chart;}
chart.dispatch=dispatch;chart.options=nv.utils.optionsFunc.bind(chart);chart._options=Object.create({},{width:{get:function(){return width;},set:function(_){width=_;}},height:{get:function(){return height;},set:function(_){height=_;}},x:{get:function(){return getX;},set:function(_){getX=_;}},y:{get:function(){return getY;},set:function(_){getY=_;}},yErr:{get:function(){return getYerr;},set:function(_){getYerr=_;}},xScale:{get:function(){return x;},set:function(_){x=_;}},yScale:{get:function(){return y;},set:function(_){y=_;}},xDomain:{get:function(){return xDomain;},set:function(_){xDomain=_;}},yDomain:{get:function(){return yDomain;},set:function(_){yDomain=_;}},xRange:{get:function(){return xRange;},set:function(_){xRange=_;}},yRange:{get:function(){return yRange;},set:function(_){yRange=_;}},forceY:{get:function(){return forceY;},set:function(_){forceY=_;}},stacked:{get:function(){return stacked;},set:function(_){stacked=_;}},showValues:{get:function(){return showValues;},set:function(_){showValues=_;}},disabled:{get:function(){return disabled;},set:function(_){disabled=_;}},id:{get:function(){return id;},set:function(_){id=_;}},valueFormat:{get:function(){return valueFormat;},set:function(_){valueFormat=_;}},valuePadding:{get:function(){return valuePadding;},set:function(_){valuePadding=_;}},groupSpacing:{get:function(){return groupSpacing;},set:function(_){groupSpacing=_;}},margin:{get:function(){return margin;},set:function(_){margin.top=_.top!==undefined?_.top:margin.top;margin.right=_.right!==undefined?_.right:margin.right;margin.bottom=_.bottom!==undefined?_.bottom:margin.bottom;margin.left=_.left!==undefined?_.left:margin.left;}},duration:{get:function(){return duration;},set:function(_){duration=_;renderWatch.reset(duration);}},color:{get:function(){return color;},set:function(_){color=nv.utils.getColor(_);}},barColor:{get:function(){return barColor;},set:function(_){barColor=_?nv.utils.getColor(_):null;}}});nv.utils.initOptions(chart);return chart;};nv.models.multiBarHorizontalChart=function(){"use strict";var multibar=nv.models.multiBarHorizontal(),xAxis=nv.models.axis(),yAxis=nv.models.axis(),legend=nv.models.legend().height(30),controls=nv.models.legend().height(30),tooltip=nv.models.tooltip();var margin={top:30,right:20,bottom:50,left:60},width=null,height=null,color=nv.utils.defaultColor(),showControls=true,controlLabels={},showLegend=true,showXAxis=true,showYAxis=true,stacked=false,x,y,state=nv.utils.state(),defaultState=null,noData=null,dispatch=d3.dispatch('stateChange','changeState','renderEnd'),controlWidth=function(){return showControls?180:0},duration=250;state.stacked=false;multibar.stacked(stacked);xAxis.orient('left').tickPadding(5).showMaxMin(false).tickFormat(function(d){return d});yAxis.orient('bottom').tickFormat(d3.format(',.1f'));tooltip.duration(0).valueFormatter(function(d,i){return yAxis.tickFormat()(d,i);}).headerFormatter(function(d,i){return xAxis.tickFormat()(d,i);});controls.updateState(false);var stateGetter=function(data){return function(){return{active:data.map(function(d){return!d.disabled}),stacked:stacked};}};var stateSetter=function(data){return function(state){if(state.stacked!==undefined)
stacked=state.stacked;if(state.active!==undefined)
data.forEach(function(series,i){series.disabled=!state.active[i];});}};var renderWatch=nv.utils.renderWatch(dispatch,duration);function chart(selection){renderWatch.reset();renderWatch.models(multibar);if(showXAxis)renderWatch.models(xAxis);if(showYAxis)renderWatch.models(yAxis);selection.each(function(data){var container=d3.select(this),that=this;nv.utils.initSVG(container);var availableWidth=nv.utils.availableWidth(width,container,margin),availableHeight=nv.utils.availableHeight(height,container,margin);chart.update=function(){container.transition().duration(duration).call(chart)};chart.container=this;stacked=multibar.stacked();state.setter(stateSetter(data),chart.update).getter(stateGetter(data)).update();state.disabled=data.map(function(d){return!!d.disabled});if(!defaultState){var key;defaultState={};for(key in state){if(state[key]instanceof Array)
defaultState[key]=state[key].slice(0);else
defaultState[key]=state[key];}}
if(!data||!data.length||!data.filter(function(d){return d.values.length}).length){nv.utils.noData(chart,container)
return chart;}else{container.selectAll('.nv-noData').remove();}
x=multibar.xScale();y=multibar.yScale();var wrap=container.selectAll('g.nv-wrap.nv-multiBarHorizontalChart').data([data]);var gEnter=wrap.enter().append('g').attr('class','nvd3 nv-wrap nv-multiBarHorizontalChart').append('g');var g=wrap.select('g');gEnter.append('g').attr('class','nv-x nv-axis');gEnter.append('g').attr('class','nv-y nv-axis').append('g').attr('class','nv-zeroLine').append('line');gEnter.append('g').attr('class','nv-barsWrap');gEnter.append('g').attr('class','nv-legendWrap');gEnter.append('g').attr('class','nv-controlsWrap');if(showLegend){legend.width(availableWidth-controlWidth());g.select('.nv-legendWrap').datum(data).call(legend);if(margin.top!=legend.height()){margin.top=legend.height();availableHeight=nv.utils.availableHeight(height,container,margin);}
g.select('.nv-legendWrap').attr('transform','translate('+controlWidth()+','+(-margin.top)+')');}
if(showControls){var controlsData=[{key:controlLabels.grouped||'Grouped',disabled:multibar.stacked()},{key:controlLabels.stacked||'Stacked',disabled:!multibar.stacked()}];controls.width(controlWidth()).color(['#444','#444','#444']);g.select('.nv-controlsWrap').datum(controlsData).attr('transform','translate(0,'+(-margin.top)+')').call(controls);}
wrap.attr('transform','translate('+margin.left+','+margin.top+')');multibar.disabled(data.map(function(series){return series.disabled})).width(availableWidth).height(availableHeight).color(data.map(function(d,i){return d.color||color(d,i);}).filter(function(d,i){return!data[i].disabled}));var barsWrap=g.select('.nv-barsWrap').datum(data.filter(function(d){return!d.disabled}));barsWrap.transition().call(multibar);if(showXAxis){xAxis.scale(x)._ticks(nv.utils.calcTicksY(availableHeight/24,data)).tickSize(-availableWidth,0);g.select('.nv-x.nv-axis').call(xAxis);var xTicks=g.select('.nv-x.nv-axis').selectAll('g');xTicks.selectAll('line, text');}
if(showYAxis){yAxis.scale(y)._ticks(nv.utils.calcTicksX(availableWidth/100,data)).tickSize(-availableHeight,0);g.select('.nv-y.nv-axis').attr('transform','translate(0,'+availableHeight+')');g.select('.nv-y.nv-axis').call(yAxis);}
g.select(".nv-zeroLine line").attr("x1",y(0)).attr("x2",y(0)).attr("y1",0).attr("y2",-availableHeight);legend.dispatch.on('stateChange',function(newState){for(var key in newState)
state[key]=newState[key];dispatch.stateChange(state);chart.update();});controls.dispatch.on('legendClick',function(d,i){if(!d.disabled)return;controlsData=controlsData.map(function(s){s.disabled=true;return s;});d.disabled=false;switch(d.key){case'Grouped':multibar.stacked(false);break;case'Stacked':multibar.stacked(true);break;}
state.stacked=multibar.stacked();dispatch.stateChange(state);stacked=multibar.stacked();chart.update();});dispatch.on('changeState',function(e){if(typeof e.disabled!=='undefined'){data.forEach(function(series,i){series.disabled=e.disabled[i];});state.disabled=e.disabled;}
if(typeof e.stacked!=='undefined'){multibar.stacked(e.stacked);state.stacked=e.stacked;stacked=e.stacked;}
chart.update();});});renderWatch.renderEnd('multibar horizontal chart immediate');return chart;}
multibar.dispatch.on('elementMouseover.tooltip',function(evt){evt.value=chart.x()(evt.data);evt['series']={key:evt.data.key,value:chart.y()(evt.data),color:evt.color};tooltip.data(evt).hidden(false);});multibar.dispatch.on('elementMouseout.tooltip',function(evt){tooltip.hidden(true);});multibar.dispatch.on('elementMousemove.tooltip',function(evt){tooltip();});chart.dispatch=dispatch;chart.multibar=multibar;chart.legend=legend;chart.controls=controls;chart.xAxis=xAxis;chart.yAxis=yAxis;chart.state=state;chart.tooltip=tooltip;chart.options=nv.utils.optionsFunc.bind(chart);chart._options=Object.create({},{width:{get:function(){return width;},set:function(_){width=_;}},height:{get:function(){return height;},set:function(_){height=_;}},showLegend:{get:function(){return showLegend;},set:function(_){showLegend=_;}},showControls:{get:function(){return showControls;},set:function(_){showControls=_;}},controlLabels:{get:function(){return controlLabels;},set:function(_){controlLabels=_;}},showXAxis:{get:function(){return showXAxis;},set:function(_){showXAxis=_;}},showYAxis:{get:function(){return showYAxis;},set:function(_){showYAxis=_;}},defaultState:{get:function(){return defaultState;},set:function(_){defaultState=_;}},noData:{get:function(){return noData;},set:function(_){noData=_;}},margin:{get:function(){return margin;},set:function(_){margin.top=_.top!==undefined?_.top:margin.top;margin.right=_.right!==undefined?_.right:margin.right;margin.bottom=_.bottom!==undefined?_.bottom:margin.bottom;margin.left=_.left!==undefined?_.left:margin.left;}},duration:{get:function(){return duration;},set:function(_){duration=_;renderWatch.reset(duration);multibar.duration(duration);xAxis.duration(duration);yAxis.duration(duration);}},color:{get:function(){return color;},set:function(_){color=nv.utils.getColor(_);legend.color(color);}},barColor:{get:function(){return multibar.barColor;},set:function(_){multibar.barColor(_);legend.color(function(d,i){return d3.rgb('#ccc').darker(i*1.5).toString();})}}});nv.utils.inheritOptions(chart,multibar);nv.utils.initOptions(chart);return chart;};nv.models.multiChart=function(){"use strict";var margin={top:30,right:20,bottom:50,left:60},color=nv.utils.defaultColor(),width=null,height=null,showLegend=true,noData=null,yDomain1,yDomain2,getX=function(d){return d.x},getY=function(d){return d.y},interpolate='monotone',useVoronoi=true;var x=d3.scale.linear(),yScale1=d3.scale.linear(),yScale2=d3.scale.linear(),lines1=nv.models.line().yScale(yScale1),lines2=nv.models.line().yScale(yScale2),scatters1=nv.models.scatter().yScale(yScale1),scatters2=nv.models.scatter().yScale(yScale2),bars1=nv.models.multiBar().stacked(false).yScale(yScale1),bars2=nv.models.multiBar().stacked(false).yScale(yScale2),stack1=nv.models.stackedArea().yScale(yScale1),stack2=nv.models.stackedArea().yScale(yScale2),xAxis=nv.models.axis().scale(x).orient('bottom').tickPadding(5),yAxis1=nv.models.axis().scale(yScale1).orient('left'),yAxis2=nv.models.axis().scale(yScale2).orient('right'),legend=nv.models.legend().height(30),tooltip=nv.models.tooltip(),dispatch=d3.dispatch();function chart(selection){selection.each(function(data){var container=d3.select(this),that=this;nv.utils.initSVG(container);chart.update=function(){container.transition().call(chart);};chart.container=this;var availableWidth=nv.utils.availableWidth(width,container,margin),availableHeight=nv.utils.availableHeight(height,container,margin);var dataLines1=data.filter(function(d){return d.type=='line'&&d.yAxis==1});var dataLines2=data.filter(function(d){return d.type=='line'&&d.yAxis==2});var dataScatters1=data.filter(function(d){return d.type=='scatter'&&d.yAxis==1});var dataScatters2=data.filter(function(d){return d.type=='scatter'&&d.yAxis==2});var dataBars1=data.filter(function(d){return d.type=='bar'&&d.yAxis==1});var dataBars2=data.filter(function(d){return d.type=='bar'&&d.yAxis==2});var dataStack1=data.filter(function(d){return d.type=='area'&&d.yAxis==1});var dataStack2=data.filter(function(d){return d.type=='area'&&d.yAxis==2});if(!data||!data.length||!data.filter(function(d){return d.values.length}).length){nv.utils.noData(chart,container);return chart;}else{container.selectAll('.nv-noData').remove();}
var series1=data.filter(function(d){return!d.disabled&&d.yAxis==1}).map(function(d){return d.values.map(function(d,i){return{x:getX(d),y:getY(d)}})});var series2=data.filter(function(d){return!d.disabled&&d.yAxis==2}).map(function(d){return d.values.map(function(d,i){return{x:getX(d),y:getY(d)}})});x.domain(d3.extent(d3.merge(series1.concat(series2)),function(d){return getX(d)})).range([0,availableWidth]);var wrap=container.selectAll('g.wrap.multiChart').data([data]);var gEnter=wrap.enter().append('g').attr('class','wrap nvd3 multiChart').append('g');gEnter.append('g').attr('class','nv-x nv-axis');gEnter.append('g').attr('class','nv-y1 nv-axis');gEnter.append('g').attr('class','nv-y2 nv-axis');gEnter.append('g').attr('class','lines1Wrap');gEnter.append('g').attr('class','lines2Wrap');gEnter.append('g').attr('class','scatters1Wrap');gEnter.append('g').attr('class','scatters2Wrap');gEnter.append('g').attr('class','bars1Wrap');gEnter.append('g').attr('class','bars2Wrap');gEnter.append('g').attr('class','stack1Wrap');gEnter.append('g').attr('class','stack2Wrap');gEnter.append('g').attr('class','legendWrap');var g=wrap.select('g');var color_array=data.map(function(d,i){return data[i].color||color(d,i);});if(showLegend){var legendWidth=legend.align()?availableWidth/2:availableWidth;var legendXPosition=legend.align()?legendWidth:0;legend.width(legendWidth);legend.color(color_array);g.select('.legendWrap').datum(data.map(function(series){series.originalKey=series.originalKey===undefined?series.key:series.originalKey;series.key=series.originalKey+(series.yAxis==1?'':' (right axis)');return series;})).call(legend);if(margin.top!=legend.height()){margin.top=legend.height();availableHeight=nv.utils.availableHeight(height,container,margin);}
g.select('.legendWrap').attr('transform','translate('+legendXPosition+','+(-margin.top)+')');}
lines1.width(availableWidth).height(availableHeight).interpolate(interpolate).color(color_array.filter(function(d,i){return!data[i].disabled&&data[i].yAxis==1&&data[i].type=='line'}));lines2.width(availableWidth).height(availableHeight).interpolate(interpolate).color(color_array.filter(function(d,i){return!data[i].disabled&&data[i].yAxis==2&&data[i].type=='line'}));scatters1.width(availableWidth).height(availableHeight).color(color_array.filter(function(d,i){return!data[i].disabled&&data[i].yAxis==1&&data[i].type=='scatter'}));scatters2.width(availableWidth).height(availableHeight).color(color_array.filter(function(d,i){return!data[i].disabled&&data[i].yAxis==2&&data[i].type=='scatter'}));bars1.width(availableWidth).height(availableHeight).color(color_array.filter(function(d,i){return!data[i].disabled&&data[i].yAxis==1&&data[i].type=='bar'}));bars2.width(availableWidth).height(availableHeight).color(color_array.filter(function(d,i){return!data[i].disabled&&data[i].yAxis==2&&data[i].type=='bar'}));stack1.width(availableWidth).height(availableHeight).color(color_array.filter(function(d,i){return!data[i].disabled&&data[i].yAxis==1&&data[i].type=='area'}));stack2.width(availableWidth).height(availableHeight).color(color_array.filter(function(d,i){return!data[i].disabled&&data[i].yAxis==2&&data[i].type=='area'}));g.attr('transform','translate('+margin.left+','+margin.top+')');var lines1Wrap=g.select('.lines1Wrap').datum(dataLines1.filter(function(d){return!d.disabled}));var scatters1Wrap=g.select('.scatters1Wrap').datum(dataScatters1.filter(function(d){return!d.disabled}));var bars1Wrap=g.select('.bars1Wrap').datum(dataBars1.filter(function(d){return!d.disabled}));var stack1Wrap=g.select('.stack1Wrap').datum(dataStack1.filter(function(d){return!d.disabled}));var lines2Wrap=g.select('.lines2Wrap').datum(dataLines2.filter(function(d){return!d.disabled}));var scatters2Wrap=g.select('.scatters2Wrap').datum(dataScatters2.filter(function(d){return!d.disabled}));var bars2Wrap=g.select('.bars2Wrap').datum(dataBars2.filter(function(d){return!d.disabled}));var stack2Wrap=g.select('.stack2Wrap').datum(dataStack2.filter(function(d){return!d.disabled}));var extraValue1=dataStack1.length?dataStack1.map(function(a){return a.values}).reduce(function(a,b){return a.map(function(aVal,i){return{x:aVal.x,y:aVal.y+b[i].y}})}).concat([{x:0,y:0}]):[];var extraValue2=dataStack2.length?dataStack2.map(function(a){return a.values}).reduce(function(a,b){return a.map(function(aVal,i){return{x:aVal.x,y:aVal.y+b[i].y}})}).concat([{x:0,y:0}]):[];yScale1.domain(yDomain1||d3.extent(d3.merge(series1).concat(extraValue1),function(d){return d.y})).range([0,availableHeight]);yScale2.domain(yDomain2||d3.extent(d3.merge(series2).concat(extraValue2),function(d){return d.y})).range([0,availableHeight]);lines1.yDomain(yScale1.domain());scatters1.yDomain(yScale1.domain());bars1.yDomain(yScale1.domain());stack1.yDomain(yScale1.domain());lines2.yDomain(yScale2.domain());scatters2.yDomain(yScale2.domain());bars2.yDomain(yScale2.domain());stack2.yDomain(yScale2.domain());if(dataStack1.length){d3.transition(stack1Wrap).call(stack1);}
if(dataStack2.length){d3.transition(stack2Wrap).call(stack2);}
if(dataBars1.length){d3.transition(bars1Wrap).call(bars1);}
if(dataBars2.length){d3.transition(bars2Wrap).call(bars2);}
if(dataLines1.length){d3.transition(lines1Wrap).call(lines1);}
if(dataLines2.length){d3.transition(lines2Wrap).call(lines2);}
if(dataScatters1.length){d3.transition(scatters1Wrap).call(scatters1);}
if(dataScatters2.length){d3.transition(scatters2Wrap).call(scatters2);}
xAxis._ticks(nv.utils.calcTicksX(availableWidth/100,data)).tickSize(-availableHeight,0);g.select('.nv-x.nv-axis').attr('transform','translate(0,'+availableHeight+')');d3.transition(g.select('.nv-x.nv-axis')).call(xAxis);yAxis1._ticks(nv.utils.calcTicksY(availableHeight/36,data)).tickSize(-availableWidth,0);d3.transition(g.select('.nv-y1.nv-axis')).call(yAxis1);yAxis2._ticks(nv.utils.calcTicksY(availableHeight/36,data)).tickSize(-availableWidth,0);d3.transition(g.select('.nv-y2.nv-axis')).call(yAxis2);g.select('.nv-y1.nv-axis').classed('nv-disabled',series1.length?false:true).attr('transform','translate('+x.range()[0]+',0)');g.select('.nv-y2.nv-axis').classed('nv-disabled',series2.length?false:true).attr('transform','translate('+x.range()[1]+',0)');legend.dispatch.on('stateChange',function(newState){chart.update();});function mouseover_line(evt){var yaxis=data[evt.seriesIndex].yAxis===2?yAxis2:yAxis1;evt.value=evt.point.x;evt.series={value:evt.point.y,color:evt.point.color,key:evt.series.key};tooltip.duration(0).valueFormatter(function(d,i){return yaxis.tickFormat()(d,i);}).data(evt).hidden(false);}
function mouseover_scatter(evt){var yaxis=data[evt.seriesIndex].yAxis===2?yAxis2:yAxis1;evt.value=evt.point.x;evt.series={value:evt.point.y,color:evt.point.color,key:evt.series.key};tooltip.duration(100).valueFormatter(function(d,i){return yaxis.tickFormat()(d,i);}).data(evt).hidden(false);}
function mouseover_stack(evt){var yaxis=data[evt.seriesIndex].yAxis===2?yAxis2:yAxis1;evt.point['x']=stack1.x()(evt.point);evt.point['y']=stack1.y()(evt.point);tooltip.duration(0).valueFormatter(function(d,i){return yaxis.tickFormat()(d,i);}).data(evt).hidden(false);}
function mouseover_bar(evt){var yaxis=data[evt.data.series].yAxis===2?yAxis2:yAxis1;evt.value=bars1.x()(evt.data);evt['series']={value:bars1.y()(evt.data),color:evt.color,key:evt.data.key};tooltip.duration(0).valueFormatter(function(d,i){return yaxis.tickFormat()(d,i);}).data(evt).hidden(false);}
lines1.dispatch.on('elementMouseover.tooltip',mouseover_line);lines2.dispatch.on('elementMouseover.tooltip',mouseover_line);lines1.dispatch.on('elementMouseout.tooltip',function(evt){tooltip.hidden(true)});lines2.dispatch.on('elementMouseout.tooltip',function(evt){tooltip.hidden(true)});scatters1.dispatch.on('elementMouseover.tooltip',mouseover_scatter);scatters2.dispatch.on('elementMouseover.tooltip',mouseover_scatter);scatters1.dispatch.on('elementMouseout.tooltip',function(evt){tooltip.hidden(true)});scatters2.dispatch.on('elementMouseout.tooltip',function(evt){tooltip.hidden(true)});stack1.dispatch.on('elementMouseover.tooltip',mouseover_stack);stack2.dispatch.on('elementMouseover.tooltip',mouseover_stack);stack1.dispatch.on('elementMouseout.tooltip',function(evt){tooltip.hidden(true)});stack2.dispatch.on('elementMouseout.tooltip',function(evt){tooltip.hidden(true)});bars1.dispatch.on('elementMouseover.tooltip',mouseover_bar);bars2.dispatch.on('elementMouseover.tooltip',mouseover_bar);bars1.dispatch.on('elementMouseout.tooltip',function(evt){tooltip.hidden(true);});bars2.dispatch.on('elementMouseout.tooltip',function(evt){tooltip.hidden(true);});bars1.dispatch.on('elementMousemove.tooltip',function(evt){tooltip();});bars2.dispatch.on('elementMousemove.tooltip',function(evt){tooltip();});});return chart;}
chart.dispatch=dispatch;chart.legend=legend;chart.lines1=lines1;chart.lines2=lines2;chart.scatters1=scatters1;chart.scatters2=scatters2;chart.bars1=bars1;chart.bars2=bars2;chart.stack1=stack1;chart.stack2=stack2;chart.xAxis=xAxis;chart.yAxis1=yAxis1;chart.yAxis2=yAxis2;chart.tooltip=tooltip;chart.options=nv.utils.optionsFunc.bind(chart);chart._options=Object.create({},{width:{get:function(){return width;},set:function(_){width=_;}},height:{get:function(){return height;},set:function(_){height=_;}},showLegend:{get:function(){return showLegend;},set:function(_){showLegend=_;}},yDomain1:{get:function(){return yDomain1;},set:function(_){yDomain1=_;}},yDomain2:{get:function(){return yDomain2;},set:function(_){yDomain2=_;}},noData:{get:function(){return noData;},set:function(_){noData=_;}},interpolate:{get:function(){return interpolate;},set:function(_){interpolate=_;}},margin:{get:function(){return margin;},set:function(_){margin.top=_.top!==undefined?_.top:margin.top;margin.right=_.right!==undefined?_.right:margin.right;margin.bottom=_.bottom!==undefined?_.bottom:margin.bottom;margin.left=_.left!==undefined?_.left:margin.left;}},color:{get:function(){return color;},set:function(_){color=nv.utils.getColor(_);}},x:{get:function(){return getX;},set:function(_){getX=_;lines1.x(_);lines2.x(_);scatters1.x(_);scatters2.x(_);bars1.x(_);bars2.x(_);stack1.x(_);stack2.x(_);}},y:{get:function(){return getY;},set:function(_){getY=_;lines1.y(_);lines2.y(_);scatters1.y(_);scatters2.y(_);stack1.y(_);stack2.y(_);bars1.y(_);bars2.y(_);}},useVoronoi:{get:function(){return useVoronoi;},set:function(_){useVoronoi=_;lines1.useVoronoi(_);lines2.useVoronoi(_);stack1.useVoronoi(_);stack2.useVoronoi(_);}}});nv.utils.initOptions(chart);return chart;};nv.models.ohlcBar=function(){"use strict";var margin={top:0,right:0,bottom:0,left:0},width=null,height=null,id=Math.floor(Math.random()*10000),container=null,x=d3.scale.linear(),y=d3.scale.linear(),getX=function(d){return d.x},getY=function(d){return d.y},getOpen=function(d){return d.open},getClose=function(d){return d.close},getHigh=function(d){return d.high},getLow=function(d){return d.low},forceX=[],forceY=[],padData=false,clipEdge=true,color=nv.utils.defaultColor(),interactive=false,xDomain,yDomain,xRange,yRange,dispatch=d3.dispatch('stateChange','changeState','renderEnd','chartClick','elementClick','elementDblClick','elementMouseover','elementMouseout','elementMousemove');function chart(selection){selection.each(function(data){container=d3.select(this);var availableWidth=nv.utils.availableWidth(width,container,margin),availableHeight=nv.utils.availableHeight(height,container,margin);nv.utils.initSVG(container);var w=(availableWidth/data[0].values.length)*.9;x.domain(xDomain||d3.extent(data[0].values.map(getX).concat(forceX)));if(padData)
x.range(xRange||[availableWidth*.5/data[0].values.length,availableWidth*(data[0].values.length-.5)/data[0].values.length]);else
x.range(xRange||[5+w/2,availableWidth-w/2-5]);y.domain(yDomain||[d3.min(data[0].values.map(getLow).concat(forceY)),d3.max(data[0].values.map(getHigh).concat(forceY))]).range(yRange||[availableHeight,0]);if(x.domain()[0]===x.domain()[1])
x.domain()[0]?x.domain([x.domain()[0]-x.domain()[0]*0.01,x.domain()[1]+x.domain()[1]*0.01]):x.domain([-1,1]);if(y.domain()[0]===y.domain()[1])
y.domain()[0]?y.domain([y.domain()[0]+y.domain()[0]*0.01,y.domain()[1]-y.domain()[1]*0.01]):y.domain([-1,1]);var wrap=d3.select(this).selectAll('g.nv-wrap.nv-ohlcBar').data([data[0].values]);var wrapEnter=wrap.enter().append('g').attr('class','nvd3 nv-wrap nv-ohlcBar');var defsEnter=wrapEnter.append('defs');var gEnter=wrapEnter.append('g');var g=wrap.select('g');gEnter.append('g').attr('class','nv-ticks');wrap.attr('transform','translate('+margin.left+','+margin.top+')');container.on('click',function(d,i){dispatch.chartClick({data:d,index:i,pos:d3.event,id:id});});defsEnter.append('clipPath').attr('id','nv-chart-clip-path-'+id).append('rect');wrap.select('#nv-chart-clip-path-'+id+' rect').attr('width',availableWidth).attr('height',availableHeight);g.attr('clip-path',clipEdge?'url(#nv-chart-clip-path-'+id+')':'');var ticks=wrap.select('.nv-ticks').selectAll('.nv-tick').data(function(d){return d});ticks.exit().remove();ticks.enter().append('path').attr('class',function(d,i,j){return(getOpen(d,i)>getClose(d,i)?'nv-tick negative':'nv-tick positive')+' nv-tick-'+j+'-'+i}).attr('d',function(d,i){return'm0,0l0,'
+(y(getOpen(d,i))
-y(getHigh(d,i)))
+'l'
+(-w/2)
+',0l'
+(w/2)
+',0l0,'
+(y(getLow(d,i))-y(getOpen(d,i)))
+'l0,'
+(y(getClose(d,i))
-y(getLow(d,i)))
+'l'
+(w/2)
+',0l'
+(-w/2)
+',0z';}).attr('transform',function(d,i){return'translate('+x(getX(d,i))+','+y(getHigh(d,i))+')';}).attr('fill',function(d,i){return color[0];}).attr('stroke',function(d,i){return color[0];}).attr('x',0).attr('y',function(d,i){return y(Math.max(0,getY(d,i)))}).attr('height',function(d,i){return Math.abs(y(getY(d,i))-y(0))});ticks.attr('class',function(d,i,j){return(getOpen(d,i)>getClose(d,i)?'nv-tick negative':'nv-tick positive')+' nv-tick-'+j+'-'+i;});d3.transition(ticks).attr('transform',function(d,i){return'translate('+x(getX(d,i))+','+y(getHigh(d,i))+')';}).attr('d',function(d,i){var w=(availableWidth/data[0].values.length)*.9;return'm0,0l0,'
+(y(getOpen(d,i))
-y(getHigh(d,i)))
+'l'
+(-w/2)
+',0l'
+(w/2)
+',0l0,'
+(y(getLow(d,i))
-y(getOpen(d,i)))
+'l0,'
+(y(getClose(d,i))
-y(getLow(d,i)))
+'l'
+(w/2)
+',0l'
+(-w/2)
+',0z';});});return chart;}
chart.highlightPoint=function(pointIndex,isHoverOver){chart.clearHighlights();container.select(".nv-ohlcBar .nv-tick-0-"+pointIndex).classed("hover",isHoverOver);};chart.clearHighlights=function(){container.select(".nv-ohlcBar .nv-tick.hover").classed("hover",false);};chart.dispatch=dispatch;chart.options=nv.utils.optionsFunc.bind(chart);chart._options=Object.create({},{width:{get:function(){return width;},set:function(_){width=_;}},height:{get:function(){return height;},set:function(_){height=_;}},xScale:{get:function(){return x;},set:function(_){x=_;}},yScale:{get:function(){return y;},set:function(_){y=_;}},xDomain:{get:function(){return xDomain;},set:function(_){xDomain=_;}},yDomain:{get:function(){return yDomain;},set:function(_){yDomain=_;}},xRange:{get:function(){return xRange;},set:function(_){xRange=_;}},yRange:{get:function(){return yRange;},set:function(_){yRange=_;}},forceX:{get:function(){return forceX;},set:function(_){forceX=_;}},forceY:{get:function(){return forceY;},set:function(_){forceY=_;}},padData:{get:function(){return padData;},set:function(_){padData=_;}},clipEdge:{get:function(){return clipEdge;},set:function(_){clipEdge=_;}},id:{get:function(){return id;},set:function(_){id=_;}},interactive:{get:function(){return interactive;},set:function(_){interactive=_;}},x:{get:function(){return getX;},set:function(_){getX=_;}},y:{get:function(){return getY;},set:function(_){getY=_;}},open:{get:function(){return getOpen();},set:function(_){getOpen=_;}},close:{get:function(){return getClose();},set:function(_){getClose=_;}},high:{get:function(){return getHigh;},set:function(_){getHigh=_;}},low:{get:function(){return getLow;},set:function(_){getLow=_;}},margin:{get:function(){return margin;},set:function(_){margin.top=_.top!=undefined?_.top:margin.top;margin.right=_.right!=undefined?_.right:margin.right;margin.bottom=_.bottom!=undefined?_.bottom:margin.bottom;margin.left=_.left!=undefined?_.left:margin.left;}},color:{get:function(){return color;},set:function(_){color=nv.utils.getColor(_);}}});nv.utils.initOptions(chart);return chart;};nv.models.parallelCoordinates=function(){"use strict";var margin={top:30,right:0,bottom:10,left:0},width=null,height=null,x=d3.scale.ordinal(),y={},dimensionNames=[],dimensionFormats=[],color=nv.utils.defaultColor(),filters=[],active=[],dragging=[],lineTension=1,dispatch=d3.dispatch('brush','elementMouseover','elementMouseout');function chart(selection){selection.each(function(data){var container=d3.select(this);var availableWidth=nv.utils.availableWidth(width,container,margin),availableHeight=nv.utils.availableHeight(height,container,margin);nv.utils.initSVG(container);active=data;x.rangePoints([0,availableWidth],1).domain(dimensionNames);var onlyNanValues={};dimensionNames.forEach(function(d){var extent=d3.extent(data,function(p){return+p[d];});onlyNanValues[d]=false;if(extent[0]===undefined){onlyNanValues[d]=true;extent[0]=0;extent[1]=0;}
if(extent[0]===extent[1]){extent[0]=extent[0]-1;extent[1]=extent[1]+1;}
y[d]=d3.scale.linear().domain(extent).range([(availableHeight-12)*0.9,0]);y[d].brush=d3.svg.brush().y(y[d]).on('brush',brush);return d!='name';});var wrap=container.selectAll('g.nv-wrap.nv-parallelCoordinates').data([data]);var wrapEnter=wrap.enter().append('g').attr('class','nvd3 nv-wrap nv-parallelCoordinates');var gEnter=wrapEnter.append('g');var g=wrap.select('g');gEnter.append('g').attr('class','nv-parallelCoordinates background');gEnter.append('g').attr('class','nv-parallelCoordinates foreground');gEnter.append('g').attr('class','nv-parallelCoordinates missingValuesline');wrap.attr('transform','translate('+margin.left+','+margin.top+')');var line=d3.svg.line().interpolate('cardinal').tension(lineTension),axis=d3.svg.axis().orient('left'),axisDrag=d3.behavior.drag().on('dragstart',dragStart).on('drag',dragMove).on('dragend',dragEnd);var missingValuesline,missingValueslineText;var step=x.range()[1]-x.range()[0];var axisWithMissingValues=[];var lineData=[0+step/2,availableHeight-12,availableWidth-step/2,availableHeight-12];missingValuesline=wrap.select('.missingValuesline').selectAll('line').data([lineData]);missingValuesline.enter().append('line');missingValuesline.exit().remove();missingValuesline.attr("x1",function(d){return d[0];}).attr("y1",function(d){return d[1];}).attr("x2",function(d){return d[2];}).attr("y2",function(d){return d[3];});missingValueslineText=wrap.select('.missingValuesline').selectAll('text').data(["undefined values"]);missingValueslineText.append('text').data(["undefined values"]);missingValueslineText.enter().append('text');missingValueslineText.exit().remove();missingValueslineText.attr("y",availableHeight).attr("x",availableWidth-92-step/2).text(function(d){return d;});var background=wrap.select('.background').selectAll('path').data(data);background.enter().append('path');background.exit().remove();background.attr('d',path);var foreground=wrap.select('.foreground').selectAll('path').data(data);foreground.enter().append('path')
foreground.exit().remove();foreground.attr('d',path).attr('stroke',color);foreground.on("mouseover",function(d,i){d3.select(this).classed('hover',true);dispatch.elementMouseover({label:d.name,data:d.data,index:i,pos:[d3.mouse(this.parentNode)[0],d3.mouse(this.parentNode)[1]]});});foreground.on("mouseout",function(d,i){d3.select(this).classed('hover',false);dispatch.elementMouseout({label:d.name,data:d.data,index:i});});var dimensions=g.selectAll('.dimension').data(dimensionNames);var dimensionsEnter=dimensions.enter().append('g').attr('class','nv-parallelCoordinates dimension');dimensionsEnter.append('g').attr('class','nv-parallelCoordinates nv-axis');dimensionsEnter.append('g').attr('class','nv-parallelCoordinates-brush');dimensionsEnter.append('text').attr('class','nv-parallelCoordinates nv-label');dimensions.attr('transform',function(d){return'translate('+x(d)+',0)';});dimensions.exit().remove();dimensions.select('.nv-label').style("cursor","move").attr('dy','-1em').attr('text-anchor','middle').text(String).on("mouseover",function(d,i){dispatch.elementMouseover({dim:d,pos:[d3.mouse(this.parentNode.parentNode)[0],d3.mouse(this.parentNode.parentNode)[1]]});}).on("mouseout",function(d,i){dispatch.elementMouseout({dim:d});}).call(axisDrag);dimensions.select('.nv-axis').each(function(d,i){d3.select(this).call(axis.scale(y[d]).tickFormat(d3.format(dimensionFormats[i])));});dimensions.select('.nv-parallelCoordinates-brush').each(function(d){d3.select(this).call(y[d].brush);}).selectAll('rect').attr('x',-8).attr('width',16);function path(d){return line(dimensionNames.map(function(p){if(isNaN(d[p])||isNaN(parseFloat(d[p]))){var domain=y[p].domain();var range=y[p].range();var min=domain[0]-(domain[1]-domain[0])/9;if(axisWithMissingValues.indexOf(p)<0){var newscale=d3.scale.linear().domain([min,domain[1]]).range([availableHeight-12,range[1]]);y[p].brush.y(newscale);axisWithMissingValues.push(p);}
return[x(p),y[p](min)];}
if(axisWithMissingValues.length>0){missingValuesline.style("display","inline");missingValueslineText.style("display","inline");}else{missingValuesline.style("display","none");missingValueslineText.style("display","none");}
return[x(p),y[p](d[p])];}));}
function brush(){var actives=dimensionNames.filter(function(p){return!y[p].brush.empty();}),extents=actives.map(function(p){return y[p].brush.extent();});filters=[];actives.forEach(function(d,i){filters[i]={dimension:d,extent:extents[i]}});active=[];foreground.style('display',function(d){var isActive=actives.every(function(p,i){if(isNaN(d[p])&&extents[i][0]==y[p].brush.y().domain()[0])return true;return extents[i][0]<=d[p]&&d[p]<=extents[i][1];});if(isActive)active.push(d);return isActive?null:'none';});dispatch.brush({filters:filters,active:active});}
function dragStart(d,i){dragging[d]=this.parentNode.__origin__=x(d);background.attr("visibility","hidden");}
function dragMove(d,i){dragging[d]=Math.min(availableWidth,Math.max(0,this.parentNode.__origin__+=d3.event.x));foreground.attr("d",path);dimensionNames.sort(function(a,b){return position(a)-position(b);});x.domain(dimensionNames);dimensions.attr("transform",function(d){return"translate("+position(d)+")";});}
function dragEnd(d,i){delete this.parentNode.__origin__;delete dragging[d];d3.select(this.parentNode).attr("transform","translate("+x(d)+")");foreground.attr("d",path);background.attr("d",path).attr("visibility",null);}
function position(d){var v=dragging[d];return v==null?x(d):v;}});return chart;}
chart.dispatch=dispatch;chart.options=nv.utils.optionsFunc.bind(chart);chart._options=Object.create({},{width:{get:function(){return width;},set:function(_){width=_;}},height:{get:function(){return height;},set:function(_){height=_;}},dimensionNames:{get:function(){return dimensionNames;},set:function(_){dimensionNames=_;}},dimensionFormats:{get:function(){return dimensionFormats;},set:function(_){dimensionFormats=_;}},lineTension:{get:function(){return lineTension;},set:function(_){lineTension=_;}},dimensions:{get:function(){return dimensionNames;},set:function(_){nv.deprecated('dimensions','use dimensionNames instead');dimensionNames=_;}},margin:{get:function(){return margin;},set:function(_){margin.top=_.top!==undefined?_.top:margin.top;margin.right=_.right!==undefined?_.right:margin.right;margin.bottom=_.bottom!==undefined?_.bottom:margin.bottom;margin.left=_.left!==undefined?_.left:margin.left;}},color:{get:function(){return color;},set:function(_){color=nv.utils.getColor(_);}}});nv.utils.initOptions(chart);return chart;};nv.models.pie=function(){"use strict";var margin={top:0,right:0,bottom:0,left:0},width=500,height=500,getX=function(d){return d.x},getY=function(d){return d.y},id=Math.floor(Math.random()*10000),container=null,color=nv.utils.defaultColor(),valueFormat=d3.format(',.2f'),showLabels=true,labelsOutside=false,labelType="key",labelThreshold=.02,donut=false,title=false,growOnHover=true,titleOffset=0,labelSunbeamLayout=false,startAngle=false,padAngle=false,endAngle=false,cornerRadius=0,donutRatio=0.5,arcsRadius=[],dispatch=d3.dispatch('chartClick','elementClick','elementDblClick','elementMouseover','elementMouseout','elementMousemove','renderEnd');var arcs=[];var arcsOver=[];var renderWatch=nv.utils.renderWatch(dispatch);function chart(selection){renderWatch.reset();selection.each(function(data){var availableWidth=width-margin.left-margin.right,availableHeight=height-margin.top-margin.bottom,radius=Math.min(availableWidth,availableHeight)/2,arcsRadiusOuter=[],arcsRadiusInner=[];container=d3.select(this)
if(arcsRadius.length===0){var outer=radius-radius/5;var inner=donutRatio*radius;for(var i=0;i<data[0].length;i++){arcsRadiusOuter.push(outer);arcsRadiusInner.push(inner);}}else{arcsRadiusOuter=arcsRadius.map(function(d){return(d.outer-d.outer/5)*radius;});arcsRadiusInner=arcsRadius.map(function(d){return(d.inner-d.inner/5)*radius;});donutRatio=d3.min(arcsRadius.map(function(d){return(d.inner-d.inner/5);}));}
nv.utils.initSVG(container);var wrap=container.selectAll('.nv-wrap.nv-pie').data(data);var wrapEnter=wrap.enter().append('g').attr('class','nvd3 nv-wrap nv-pie nv-chart-'+id);var gEnter=wrapEnter.append('g');var g=wrap.select('g');var g_pie=gEnter.append('g').attr('class','nv-pie');gEnter.append('g').attr('class','nv-pieLabels');wrap.attr('transform','translate('+margin.left+','+margin.top+')');g.select('.nv-pie').attr('transform','translate('+availableWidth/2+','+availableHeight/2+')');g.select('.nv-pieLabels').attr('transform','translate('+availableWidth/2+','+availableHeight/2+')');container.on('click',function(d,i){dispatch.chartClick({data:d,index:i,pos:d3.event,id:id});});arcs=[];arcsOver=[];for(var i=0;i<data[0].length;i++){var arc=d3.svg.arc().outerRadius(arcsRadiusOuter[i]);var arcOver=d3.svg.arc().outerRadius(arcsRadiusOuter[i]+5);if(startAngle!==false){arc.startAngle(startAngle);arcOver.startAngle(startAngle);}
if(endAngle!==false){arc.endAngle(endAngle);arcOver.endAngle(endAngle);}
if(donut){arc.innerRadius(arcsRadiusInner[i]);arcOver.innerRadius(arcsRadiusInner[i]);}
if(arc.cornerRadius&&cornerRadius){arc.cornerRadius(cornerRadius);arcOver.cornerRadius(cornerRadius);}
arcs.push(arc);arcsOver.push(arcOver);}
var pie=d3.layout.pie().sort(null).value(function(d){return d.disabled?0:getY(d)});if(pie.padAngle&&padAngle){pie.padAngle(padAngle);}
if(donut&&title){g_pie.append("text").attr('class','nv-pie-title');wrap.select('.nv-pie-title').style("text-anchor","middle").text(function(d){return title;}).style("font-size",(Math.min(availableWidth,availableHeight))*donutRatio*2/(title.length+2)+"px").attr("dy","0.35em").attr('transform',function(d,i){return'translate(0, '+titleOffset+')';});}
var slices=wrap.select('.nv-pie').selectAll('.nv-slice').data(pie);var pieLabels=wrap.select('.nv-pieLabels').selectAll('.nv-label').data(pie);slices.exit().remove();pieLabels.exit().remove();var ae=slices.enter().append('g');ae.attr('class','nv-slice');ae.on('mouseover',function(d,i){d3.select(this).classed('hover',true);if(growOnHover){d3.select(this).select("path").transition().duration(70).attr("d",arcsOver[i]);}
dispatch.elementMouseover({data:d.data,index:i,color:d3.select(this).style("fill")});});ae.on('mouseout',function(d,i){d3.select(this).classed('hover',false);if(growOnHover){d3.select(this).select("path").transition().duration(50).attr("d",arcs[i]);}
dispatch.elementMouseout({data:d.data,index:i});});ae.on('mousemove',function(d,i){dispatch.elementMousemove({data:d.data,index:i});});ae.on('click',function(d,i){dispatch.elementClick({data:d.data,index:i,color:d3.select(this).style("fill")});});ae.on('dblclick',function(d,i){dispatch.elementDblClick({data:d.data,index:i,color:d3.select(this).style("fill")});});slices.attr('fill',function(d,i){return color(d.data,i);});slices.attr('stroke',function(d,i){return color(d.data,i);});var paths=ae.append('path').each(function(d){this._current=d;});slices.select('path').transition().attr('d',function(d,i){return arcs[i](d);}).attrTween('d',arcTween);if(showLabels){var labelsArc=[];for(var i=0;i<data[0].length;i++){labelsArc.push(arcs[i]);if(labelsOutside){if(donut){labelsArc[i]=d3.svg.arc().outerRadius(arcs[i].outerRadius());if(startAngle!==false)labelsArc[i].startAngle(startAngle);if(endAngle!==false)labelsArc[i].endAngle(endAngle);}}else if(!donut){labelsArc[i].innerRadius(0);}}
pieLabels.enter().append("g").classed("nv-label",true).each(function(d,i){var group=d3.select(this);group.attr('transform',function(d,i){if(labelSunbeamLayout){d.outerRadius=arcsRadiusOuter[i]+10;d.innerRadius=arcsRadiusOuter[i]+15;var rotateAngle=(d.startAngle+d.endAngle)/2*(180/Math.PI);if((d.startAngle+d.endAngle)/2<Math.PI){rotateAngle-=90;}else{rotateAngle+=90;}
return'translate('+labelsArc[i].centroid(d)+') rotate('+rotateAngle+')';}else{d.outerRadius=radius+10;d.innerRadius=radius+15;return'translate('+labelsArc[i].centroid(d)+')'}});group.append('rect').style('stroke','#fff').style('fill','#fff').attr("rx",3).attr("ry",3);group.append('text').style('text-anchor',labelSunbeamLayout?((d.startAngle+d.endAngle)/2<Math.PI?'start':'end'):'middle').style('fill','#000')});var labelLocationHash={};var avgHeight=14;var avgWidth=140;var createHashKey=function(coordinates){return Math.floor(coordinates[0]/avgWidth)*avgWidth+','+Math.floor(coordinates[1]/avgHeight)*avgHeight;};pieLabels.watchTransition(renderWatch,'pie labels').attr('transform',function(d,i){if(labelSunbeamLayout){d.outerRadius=arcsRadiusOuter[i]+10;d.innerRadius=arcsRadiusOuter[i]+15;var rotateAngle=(d.startAngle+d.endAngle)/2*(180/Math.PI);if((d.startAngle+d.endAngle)/2<Math.PI){rotateAngle-=90;}else{rotateAngle+=90;}
return'translate('+labelsArc[i].centroid(d)+') rotate('+rotateAngle+')';}else{d.outerRadius=radius+10;d.innerRadius=radius+15;var center=labelsArc[i].centroid(d);if(d.value){var hashKey=createHashKey(center);if(labelLocationHash[hashKey]){center[1]-=avgHeight;}
labelLocationHash[createHashKey(center)]=true;}
return'translate('+center+')'}});pieLabels.select(".nv-label text").style('text-anchor',function(d,i){return labelSunbeamLayout?((d.startAngle+d.endAngle)/2<Math.PI?'start':'end'):'middle';}).text(function(d,i){var percent=(d.endAngle-d.startAngle)/(2*Math.PI);var label='';if(!d.value||percent<labelThreshold)return'';if(typeof labelType==='function'){label=labelType(d,i,{'key':getX(d.data),'value':getY(d.data),'percent':valueFormat(percent)});}else{switch(labelType){case'key':label=getX(d.data);break;case'value':label=valueFormat(getY(d.data));break;case'percent':label=d3.format('%')(percent);break;}}
return label;});}
function angle(d){var a=(d.startAngle+d.endAngle)*90/Math.PI-90;return a>90?a-180:a;}
function arcTween(a,idx){a.endAngle=isNaN(a.endAngle)?0:a.endAngle;a.startAngle=isNaN(a.startAngle)?0:a.startAngle;if(!donut)a.innerRadius=0;var i=d3.interpolate(this._current,a);this._current=i(0);return function(t){return arcs[idx](i(t));};}});renderWatch.renderEnd('pie immediate');return chart;}
chart.dispatch=dispatch;chart.options=nv.utils.optionsFunc.bind(chart);chart._options=Object.create({},{arcsRadius:{get:function(){return arcsRadius;},set:function(_){arcsRadius=_;}},width:{get:function(){return width;},set:function(_){width=_;}},height:{get:function(){return height;},set:function(_){height=_;}},showLabels:{get:function(){return showLabels;},set:function(_){showLabels=_;}},title:{get:function(){return title;},set:function(_){title=_;}},titleOffset:{get:function(){return titleOffset;},set:function(_){titleOffset=_;}},labelThreshold:{get:function(){return labelThreshold;},set:function(_){labelThreshold=_;}},valueFormat:{get:function(){return valueFormat;},set:function(_){valueFormat=_;}},x:{get:function(){return getX;},set:function(_){getX=_;}},id:{get:function(){return id;},set:function(_){id=_;}},endAngle:{get:function(){return endAngle;},set:function(_){endAngle=_;}},startAngle:{get:function(){return startAngle;},set:function(_){startAngle=_;}},padAngle:{get:function(){return padAngle;},set:function(_){padAngle=_;}},cornerRadius:{get:function(){return cornerRadius;},set:function(_){cornerRadius=_;}},donutRatio:{get:function(){return donutRatio;},set:function(_){donutRatio=_;}},labelsOutside:{get:function(){return labelsOutside;},set:function(_){labelsOutside=_;}},labelSunbeamLayout:{get:function(){return labelSunbeamLayout;},set:function(_){labelSunbeamLayout=_;}},donut:{get:function(){return donut;},set:function(_){donut=_;}},growOnHover:{get:function(){return growOnHover;},set:function(_){growOnHover=_;}},pieLabelsOutside:{get:function(){return labelsOutside;},set:function(_){labelsOutside=_;nv.deprecated('pieLabelsOutside','use labelsOutside instead');}},donutLabelsOutside:{get:function(){return labelsOutside;},set:function(_){labelsOutside=_;nv.deprecated('donutLabelsOutside','use labelsOutside instead');}},labelFormat:{get:function(){return valueFormat;},set:function(_){valueFormat=_;nv.deprecated('labelFormat','use valueFormat instead');}},margin:{get:function(){return margin;},set:function(_){margin.top=typeof _.top!='undefined'?_.top:margin.top;margin.right=typeof _.right!='undefined'?_.right:margin.right;margin.bottom=typeof _.bottom!='undefined'?_.bottom:margin.bottom;margin.left=typeof _.left!='undefined'?_.left:margin.left;}},y:{get:function(){return getY;},set:function(_){getY=d3.functor(_);}},color:{get:function(){return color;},set:function(_){color=nv.utils.getColor(_);}},labelType:{get:function(){return labelType;},set:function(_){labelType=_||'key';}}});nv.utils.initOptions(chart);return chart;};nv.models.pieChart=function(){"use strict";var pie=nv.models.pie();var legend=nv.models.legend();var tooltip=nv.models.tooltip();var margin={top:30,right:20,bottom:20,left:20},width=null,height=null,showLegend=true,legendPosition="top",color=nv.utils.defaultColor(),state=nv.utils.state(),defaultState=null,noData=null,duration=250,dispatch=d3.dispatch('stateChange','changeState','renderEnd');tooltip.duration(0).headerEnabled(false).valueFormatter(function(d,i){return pie.valueFormat()(d,i);});var renderWatch=nv.utils.renderWatch(dispatch);var stateGetter=function(data){return function(){return{active:data.map(function(d){return!d.disabled})};}};var stateSetter=function(data){return function(state){if(state.active!==undefined){data.forEach(function(series,i){series.disabled=!state.active[i];});}}};function chart(selection){renderWatch.reset();renderWatch.models(pie);selection.each(function(data){var container=d3.select(this);nv.utils.initSVG(container);var that=this;var availableWidth=nv.utils.availableWidth(width,container,margin),availableHeight=nv.utils.availableHeight(height,container,margin);chart.update=function(){container.transition().call(chart);};chart.container=this;state.setter(stateSetter(data),chart.update).getter(stateGetter(data)).update();state.disabled=data.map(function(d){return!!d.disabled});if(!defaultState){var key;defaultState={};for(key in state){if(state[key]instanceof Array)
defaultState[key]=state[key].slice(0);else
defaultState[key]=state[key];}}
if(!data||!data.length){nv.utils.noData(chart,container);return chart;}else{container.selectAll('.nv-noData').remove();}
var wrap=container.selectAll('g.nv-wrap.nv-pieChart').data([data]);var gEnter=wrap.enter().append('g').attr('class','nvd3 nv-wrap nv-pieChart').append('g');var g=wrap.select('g');gEnter.append('g').attr('class','nv-pieWrap');gEnter.append('g').attr('class','nv-legendWrap');if(showLegend){if(legendPosition==="top"){legend.width(availableWidth).key(pie.x());wrap.select('.nv-legendWrap').datum(data).call(legend);if(margin.top!=legend.height()){margin.top=legend.height();availableHeight=nv.utils.availableHeight(height,container,margin);}
wrap.select('.nv-legendWrap').attr('transform','translate(0,'+(-margin.top)+')');}else if(legendPosition==="right"){var legendWidth=nv.models.legend().width();if(availableWidth/2<legendWidth){legendWidth=(availableWidth/2)}
legend.height(availableHeight).key(pie.x());legend.width(legendWidth);availableWidth-=legend.width();wrap.select('.nv-legendWrap').datum(data).call(legend).attr('transform','translate('+(availableWidth)+',0)');}}
wrap.attr('transform','translate('+margin.left+','+margin.top+')');pie.width(availableWidth).height(availableHeight);var pieWrap=g.select('.nv-pieWrap').datum([data]);d3.transition(pieWrap).call(pie);legend.dispatch.on('stateChange',function(newState){for(var key in newState){state[key]=newState[key];}
dispatch.stateChange(state);chart.update();});dispatch.on('changeState',function(e){if(typeof e.disabled!=='undefined'){data.forEach(function(series,i){series.disabled=e.disabled[i];});state.disabled=e.disabled;}
chart.update();});});renderWatch.renderEnd('pieChart immediate');return chart;}
pie.dispatch.on('elementMouseover.tooltip',function(evt){evt['series']={key:chart.x()(evt.data),value:chart.y()(evt.data),color:evt.color};tooltip.data(evt).hidden(false);});pie.dispatch.on('elementMouseout.tooltip',function(evt){tooltip.hidden(true);});pie.dispatch.on('elementMousemove.tooltip',function(evt){tooltip();});chart.legend=legend;chart.dispatch=dispatch;chart.pie=pie;chart.tooltip=tooltip;chart.options=nv.utils.optionsFunc.bind(chart);chart._options=Object.create({},{noData:{get:function(){return noData;},set:function(_){noData=_;}},showLegend:{get:function(){return showLegend;},set:function(_){showLegend=_;}},legendPosition:{get:function(){return legendPosition;},set:function(_){legendPosition=_;}},defaultState:{get:function(){return defaultState;},set:function(_){defaultState=_;}},color:{get:function(){return color;},set:function(_){color=_;legend.color(color);pie.color(color);}},duration:{get:function(){return duration;},set:function(_){duration=_;renderWatch.reset(duration);}},margin:{get:function(){return margin;},set:function(_){margin.top=_.top!==undefined?_.top:margin.top;margin.right=_.right!==undefined?_.right:margin.right;margin.bottom=_.bottom!==undefined?_.bottom:margin.bottom;margin.left=_.left!==undefined?_.left:margin.left;}}});nv.utils.inheritOptions(chart,pie);nv.utils.initOptions(chart);return chart;};nv.models.scatter=function(){"use strict";var margin={top:0,right:0,bottom:0,left:0},width=null,height=null,color=nv.utils.defaultColor(),id=Math.floor(Math.random()*100000),container=null,x=d3.scale.linear(),y=d3.scale.linear(),z=d3.scale.linear(),getX=function(d){return d.x},getY=function(d){return d.y},getSize=function(d){return d.size||1},getShape=function(d){return d.shape||'circle'},forceX=[],forceY=[],forceSize=[],interactive=true,pointActive=function(d){return!d.notActive},padData=false,padDataOuter=.1,clipEdge=false,clipVoronoi=true,showVoronoi=false,clipRadius=function(){return 25},xDomain=null,yDomain=null,xRange=null,yRange=null,sizeDomain=null,sizeRange=null,singlePoint=false,dispatch=d3.dispatch('elementClick','elementDblClick','elementMouseover','elementMouseout','renderEnd'),useVoronoi=true,duration=250;var x0,y0,z0,timeoutID,needsUpdate=false,renderWatch=nv.utils.renderWatch(dispatch,duration),_sizeRange_def=[16,256];function chart(selection){renderWatch.reset();selection.each(function(data){container=d3.select(this);var availableWidth=nv.utils.availableWidth(width,container,margin),availableHeight=nv.utils.availableHeight(height,container,margin);nv.utils.initSVG(container);data.forEach(function(series,i){series.values.forEach(function(point){point.series=i;});});var seriesData=(xDomain&&yDomain&&sizeDomain)?[]:d3.merge(data.map(function(d){return d.values.map(function(d,i){return{x:getX(d,i),y:getY(d,i),size:getSize(d,i)}})}));x.domain(xDomain||d3.extent(seriesData.map(function(d){return d.x;}).concat(forceX)))
if(padData&&data[0])
x.range(xRange||[(availableWidth*padDataOuter+availableWidth)/(2*data[0].values.length),availableWidth-availableWidth*(1+padDataOuter)/(2*data[0].values.length)]);else
x.range(xRange||[0,availableWidth]);y.domain(yDomain||d3.extent(seriesData.map(function(d){return d.y}).concat(forceY))).range(yRange||[availableHeight,0]);z.domain(sizeDomain||d3.extent(seriesData.map(function(d){return d.size}).concat(forceSize))).range(sizeRange||_sizeRange_def);singlePoint=x.domain()[0]===x.domain()[1]||y.domain()[0]===y.domain()[1];if(x.domain()[0]===x.domain()[1])
x.domain()[0]?x.domain([x.domain()[0]-x.domain()[0]*0.01,x.domain()[1]+x.domain()[1]*0.01]):x.domain([-1,1]);if(y.domain()[0]===y.domain()[1])
y.domain()[0]?y.domain([y.domain()[0]-y.domain()[0]*0.01,y.domain()[1]+y.domain()[1]*0.01]):y.domain([-1,1]);if(isNaN(x.domain()[0])){x.domain([-1,1]);}
if(isNaN(y.domain()[0])){y.domain([-1,1]);}
x0=x0||x;y0=y0||y;z0=z0||z;var wrap=container.selectAll('g.nv-wrap.nv-scatter').data([data]);var wrapEnter=wrap.enter().append('g').attr('class','nvd3 nv-wrap nv-scatter nv-chart-'+id);var defsEnter=wrapEnter.append('defs');var gEnter=wrapEnter.append('g');var g=wrap.select('g');wrap.classed('nv-single-point',singlePoint);gEnter.append('g').attr('class','nv-groups');gEnter.append('g').attr('class','nv-point-paths');wrapEnter.append('g').attr('class','nv-point-clips');wrap.attr('transform','translate('+margin.left+','+margin.top+')');defsEnter.append('clipPath').attr('id','nv-edge-clip-'+id).append('rect');wrap.select('#nv-edge-clip-'+id+' rect').attr('width',availableWidth).attr('height',(availableHeight>0)?availableHeight:0);g.attr('clip-path',clipEdge?'url(#nv-edge-clip-'+id+')':'');function updateInteractiveLayer(){needsUpdate=false;if(!interactive)return false;if(useVoronoi===true){var vertices=d3.merge(data.map(function(group,groupIndex){return group.values.map(function(point,pointIndex){var pX=getX(point,pointIndex);var pY=getY(point,pointIndex);return[x(pX)+Math.random()*1e-4,y(pY)+Math.random()*1e-4,groupIndex,pointIndex,point];}).filter(function(pointArray,pointIndex){return pointActive(pointArray[4],pointIndex);})}));if(vertices.length==0)return false;if(vertices.length<3){vertices.push([x.range()[0]-20,y.range()[0]-20,null,null]);vertices.push([x.range()[1]+20,y.range()[1]+20,null,null]);vertices.push([x.range()[0]-20,y.range()[0]+20,null,null]);vertices.push([x.range()[1]+20,y.range()[1]-20,null,null]);}
var bounds=d3.geom.polygon([[-10,-10],[-10,height+10],[width+10,height+10],[width+10,-10]]);var voronoi=d3.geom.voronoi(vertices).map(function(d,i){return{'data':bounds.clip(d),'series':vertices[i][2],'point':vertices[i][3]}});wrap.select('.nv-point-paths').selectAll('path').remove();var pointPaths=wrap.select('.nv-point-paths').selectAll('path').data(voronoi);var vPointPaths=pointPaths.enter().append("svg:path").attr("d",function(d){if(!d||!d.data||d.data.length===0)
return'M 0 0';else
return"M"+d.data.join(",")+"Z";}).attr("id",function(d,i){return"nv-path-"+i;}).attr("clip-path",function(d,i){return"url(#nv-clip-"+id+"-"+i+")";});if(showVoronoi){vPointPaths.style("fill",d3.rgb(230,230,230)).style('fill-opacity',0.4).style('stroke-opacity',1).style("stroke",d3.rgb(200,200,200));}
if(clipVoronoi){wrap.select('.nv-point-clips').selectAll('*').remove();var pointClips=wrap.select('.nv-point-clips').selectAll('clipPath').data(vertices);var vPointClips=pointClips.enter().append("svg:clipPath").attr("id",function(d,i){return"nv-clip-"+id+"-"+i;}).append("svg:circle").attr('cx',function(d){return d[0];}).attr('cy',function(d){return d[1];}).attr('r',clipRadius);}
var mouseEventCallback=function(d,mDispatch){if(needsUpdate)return 0;var series=data[d.series];if(series===undefined)return;var point=series.values[d.point];point['color']=color(series,d.series);point['x']=getX(point);point['y']=getY(point);var box=container.node().getBoundingClientRect();var scrollTop=window.pageYOffset||document.documentElement.scrollTop;var scrollLeft=window.pageXOffset||document.documentElement.scrollLeft;var pos={left:x(getX(point,d.point))+box.left+scrollLeft+margin.left+10,top:y(getY(point,d.point))+box.top+scrollTop+margin.top+10};mDispatch({point:point,series:series,pos:pos,relativePos:[x(getX(point,d.point))+margin.left,y(getY(point,d.point))+margin.top],seriesIndex:d.series,pointIndex:d.point});};pointPaths.on('click',function(d){mouseEventCallback(d,dispatch.elementClick);}).on('dblclick',function(d){mouseEventCallback(d,dispatch.elementDblClick);}).on('mouseover',function(d){mouseEventCallback(d,dispatch.elementMouseover);}).on('mouseout',function(d,i){mouseEventCallback(d,dispatch.elementMouseout);});}else{wrap.select('.nv-groups').selectAll('.nv-group').selectAll('.nv-point').on('click',function(d,i){if(needsUpdate||!data[d.series])return 0;var series=data[d.series],point=series.values[i];dispatch.elementClick({point:point,series:series,pos:[x(getX(point,i))+margin.left,y(getY(point,i))+margin.top],relativePos:[x(getX(point,i))+margin.left,y(getY(point,i))+margin.top],seriesIndex:d.series,pointIndex:i});}).on('dblclick',function(d,i){if(needsUpdate||!data[d.series])return 0;var series=data[d.series],point=series.values[i];dispatch.elementDblClick({point:point,series:series,pos:[x(getX(point,i))+margin.left,y(getY(point,i))+margin.top],relativePos:[x(getX(point,i))+margin.left,y(getY(point,i))+margin.top],seriesIndex:d.series,pointIndex:i});}).on('mouseover',function(d,i){if(needsUpdate||!data[d.series])return 0;var series=data[d.series],point=series.values[i];dispatch.elementMouseover({point:point,series:series,pos:[x(getX(point,i))+margin.left,y(getY(point,i))+margin.top],relativePos:[x(getX(point,i))+margin.left,y(getY(point,i))+margin.top],seriesIndex:d.series,pointIndex:i,color:color(d,i)});}).on('mouseout',function(d,i){if(needsUpdate||!data[d.series])return 0;var series=data[d.series],point=series.values[i];dispatch.elementMouseout({point:point,series:series,pos:[x(getX(point,i))+margin.left,y(getY(point,i))+margin.top],relativePos:[x(getX(point,i))+margin.left,y(getY(point,i))+margin.top],seriesIndex:d.series,pointIndex:i,color:color(d,i)});});}}
needsUpdate=true;var groups=wrap.select('.nv-groups').selectAll('.nv-group').data(function(d){return d},function(d){return d.key});groups.enter().append('g').style('stroke-opacity',1e-6).style('fill-opacity',1e-6);groups.exit().remove();groups.attr('class',function(d,i){return'nv-group nv-series-'+i}).classed('hover',function(d){return d.hover});groups.watchTransition(renderWatch,'scatter: groups').style('fill',function(d,i){return color(d,i)}).style('stroke',function(d,i){return color(d,i)}).style('stroke-opacity',1).style('fill-opacity',.5);var points=groups.selectAll('path.nv-point').data(function(d){return d.values.map(function(point,pointIndex){return[point,pointIndex]}).filter(function(pointArray,pointIndex){return pointActive(pointArray[0],pointIndex)})});points.enter().append('path').style('fill',function(d){return d.color}).style('stroke',function(d){return d.color}).attr('transform',function(d){return'translate('+x0(getX(d[0],d[1]))+','+y0(getY(d[0],d[1]))+')'}).attr('d',nv.utils.symbol().type(function(d){return getShape(d[0]);}).size(function(d){return z(getSize(d[0],d[1]))}));points.exit().remove();groups.exit().selectAll('path.nv-point').watchTransition(renderWatch,'scatter exit').attr('transform',function(d){return'translate('+x(getX(d[0],d[1]))+','+y(getY(d[0],d[1]))+')'}).remove();points.each(function(d){d3.select(this).classed('nv-point',true).classed('nv-point-'+d[1],true).classed('nv-noninteractive',!interactive).classed('hover',false);});points.watchTransition(renderWatch,'scatter points').attr('transform',function(d){return'translate('+x(getX(d[0],d[1]))+','+y(getY(d[0],d[1]))+')'}).attr('d',nv.utils.symbol().type(function(d){return getShape(d[0]);}).size(function(d){return z(getSize(d[0],d[1]))}));clearTimeout(timeoutID);timeoutID=setTimeout(updateInteractiveLayer,300);x0=x.copy();y0=y.copy();z0=z.copy();});renderWatch.renderEnd('scatter immediate');return chart;}
chart.dispatch=dispatch;chart.options=nv.utils.optionsFunc.bind(chart);chart._calls=new function(){this.clearHighlights=function(){nv.dom.write(function(){container.selectAll(".nv-point.hover").classed("hover",false);});return null;};this.highlightPoint=function(seriesIndex,pointIndex,isHoverOver){nv.dom.write(function(){container.select('.nv-groups').selectAll(".nv-series-"+seriesIndex).selectAll(".nv-point-"+pointIndex).classed("hover",isHoverOver);});};};dispatch.on('elementMouseover.point',function(d){if(interactive)chart._calls.highlightPoint(d.seriesIndex,d.pointIndex,true);});dispatch.on('elementMouseout.point',function(d){if(interactive)chart._calls.highlightPoint(d.seriesIndex,d.pointIndex,false);});chart._options=Object.create({},{width:{get:function(){return width;},set:function(_){width=_;}},height:{get:function(){return height;},set:function(_){height=_;}},xScale:{get:function(){return x;},set:function(_){x=_;}},yScale:{get:function(){return y;},set:function(_){y=_;}},pointScale:{get:function(){return z;},set:function(_){z=_;}},xDomain:{get:function(){return xDomain;},set:function(_){xDomain=_;}},yDomain:{get:function(){return yDomain;},set:function(_){yDomain=_;}},pointDomain:{get:function(){return sizeDomain;},set:function(_){sizeDomain=_;}},xRange:{get:function(){return xRange;},set:function(_){xRange=_;}},yRange:{get:function(){return yRange;},set:function(_){yRange=_;}},pointRange:{get:function(){return sizeRange;},set:function(_){sizeRange=_;}},forceX:{get:function(){return forceX;},set:function(_){forceX=_;}},forceY:{get:function(){return forceY;},set:function(_){forceY=_;}},forcePoint:{get:function(){return forceSize;},set:function(_){forceSize=_;}},interactive:{get:function(){return interactive;},set:function(_){interactive=_;}},pointActive:{get:function(){return pointActive;},set:function(_){pointActive=_;}},padDataOuter:{get:function(){return padDataOuter;},set:function(_){padDataOuter=_;}},padData:{get:function(){return padData;},set:function(_){padData=_;}},clipEdge:{get:function(){return clipEdge;},set:function(_){clipEdge=_;}},clipVoronoi:{get:function(){return clipVoronoi;},set:function(_){clipVoronoi=_;}},clipRadius:{get:function(){return clipRadius;},set:function(_){clipRadius=_;}},showVoronoi:{get:function(){return showVoronoi;},set:function(_){showVoronoi=_;}},id:{get:function(){return id;},set:function(_){id=_;}},x:{get:function(){return getX;},set:function(_){getX=d3.functor(_);}},y:{get:function(){return getY;},set:function(_){getY=d3.functor(_);}},pointSize:{get:function(){return getSize;},set:function(_){getSize=d3.functor(_);}},pointShape:{get:function(){return getShape;},set:function(_){getShape=d3.functor(_);}},margin:{get:function(){return margin;},set:function(_){margin.top=_.top!==undefined?_.top:margin.top;margin.right=_.right!==undefined?_.right:margin.right;margin.bottom=_.bottom!==undefined?_.bottom:margin.bottom;margin.left=_.left!==undefined?_.left:margin.left;}},duration:{get:function(){return duration;},set:function(_){duration=_;renderWatch.reset(duration);}},color:{get:function(){return color;},set:function(_){color=nv.utils.getColor(_);}},useVoronoi:{get:function(){return useVoronoi;},set:function(_){useVoronoi=_;if(useVoronoi===false){clipVoronoi=false;}}}});nv.utils.initOptions(chart);return chart;};nv.models.scatterChart=function(){"use strict";var scatter=nv.models.scatter(),xAxis=nv.models.axis(),yAxis=nv.models.axis(),legend=nv.models.legend(),distX=nv.models.distribution(),distY=nv.models.distribution(),tooltip=nv.models.tooltip();var margin={top:30,right:20,bottom:50,left:75},width=null,height=null,container=null,color=nv.utils.defaultColor(),x=scatter.xScale(),y=scatter.yScale(),showDistX=false,showDistY=false,showLegend=true,showXAxis=true,showYAxis=true,rightAlignYAxis=false,state=nv.utils.state(),defaultState=null,dispatch=d3.dispatch('stateChange','changeState','renderEnd'),noData=null,duration=250;scatter.xScale(x).yScale(y);xAxis.orient('bottom').tickPadding(10);yAxis.orient((rightAlignYAxis)?'right':'left').tickPadding(10);distX.axis('x');distY.axis('y');tooltip.headerFormatter(function(d,i){return xAxis.tickFormat()(d,i);}).valueFormatter(function(d,i){return yAxis.tickFormat()(d,i);});var x0,y0,renderWatch=nv.utils.renderWatch(dispatch,duration);var stateGetter=function(data){return function(){return{active:data.map(function(d){return!d.disabled})};}};var stateSetter=function(data){return function(state){if(state.active!==undefined)
data.forEach(function(series,i){series.disabled=!state.active[i];});}};function chart(selection){renderWatch.reset();renderWatch.models(scatter);if(showXAxis)renderWatch.models(xAxis);if(showYAxis)renderWatch.models(yAxis);if(showDistX)renderWatch.models(distX);if(showDistY)renderWatch.models(distY);selection.each(function(data){var that=this;container=d3.select(this);nv.utils.initSVG(container);var availableWidth=nv.utils.availableWidth(width,container,margin),availableHeight=nv.utils.availableHeight(height,container,margin);chart.update=function(){if(duration===0)
container.call(chart);else
container.transition().duration(duration).call(chart);};chart.container=this;state.setter(stateSetter(data),chart.update).getter(stateGetter(data)).update();state.disabled=data.map(function(d){return!!d.disabled});if(!defaultState){var key;defaultState={};for(key in state){if(state[key]instanceof Array)
defaultState[key]=state[key].slice(0);else
defaultState[key]=state[key];}}
if(!data||!data.length||!data.filter(function(d){return d.values.length}).length){nv.utils.noData(chart,container);renderWatch.renderEnd('scatter immediate');return chart;}else{container.selectAll('.nv-noData').remove();}
x=scatter.xScale();y=scatter.yScale();var wrap=container.selectAll('g.nv-wrap.nv-scatterChart').data([data]);var wrapEnter=wrap.enter().append('g').attr('class','nvd3 nv-wrap nv-scatterChart nv-chart-'+scatter.id());var gEnter=wrapEnter.append('g');var g=wrap.select('g');gEnter.append('rect').attr('class','nvd3 nv-background').style("pointer-events","none");gEnter.append('g').attr('class','nv-x nv-axis');gEnter.append('g').attr('class','nv-y nv-axis');gEnter.append('g').attr('class','nv-scatterWrap');gEnter.append('g').attr('class','nv-regressionLinesWrap');gEnter.append('g').attr('class','nv-distWrap');gEnter.append('g').attr('class','nv-legendWrap');if(rightAlignYAxis){g.select(".nv-y.nv-axis").attr("transform","translate("+availableWidth+",0)");}
if(showLegend){var legendWidth=availableWidth;legend.width(legendWidth);wrap.select('.nv-legendWrap').datum(data).call(legend);if(margin.top!=legend.height()){margin.top=legend.height();availableHeight=nv.utils.availableHeight(height,container,margin);}
wrap.select('.nv-legendWrap').attr('transform','translate(0'+','+(-margin.top)+')');}
wrap.attr('transform','translate('+margin.left+','+margin.top+')');scatter.width(availableWidth).height(availableHeight).color(data.map(function(d,i){d.color=d.color||color(d,i);return d.color;}).filter(function(d,i){return!data[i].disabled}));wrap.select('.nv-scatterWrap').datum(data.filter(function(d){return!d.disabled})).call(scatter);wrap.select('.nv-regressionLinesWrap').attr('clip-path','url(#nv-edge-clip-'+scatter.id()+')');var regWrap=wrap.select('.nv-regressionLinesWrap').selectAll('.nv-regLines').data(function(d){return d;});regWrap.enter().append('g').attr('class','nv-regLines');var regLine=regWrap.selectAll('.nv-regLine').data(function(d){return[d]});regLine.enter().append('line').attr('class','nv-regLine').style('stroke-opacity',0);regLine.filter(function(d){return d.intercept&&d.slope;}).watchTransition(renderWatch,'scatterPlusLineChart: regline').attr('x1',x.range()[0]).attr('x2',x.range()[1]).attr('y1',function(d,i){return y(x.domain()[0]*d.slope+d.intercept)}).attr('y2',function(d,i){return y(x.domain()[1]*d.slope+d.intercept)}).style('stroke',function(d,i,j){return color(d,j)}).style('stroke-opacity',function(d,i){return(d.disabled||typeof d.slope==='undefined'||typeof d.intercept==='undefined')?0:1});if(showXAxis){xAxis.scale(x)._ticks(nv.utils.calcTicksX(availableWidth/100,data)).tickSize(-availableHeight,0);g.select('.nv-x.nv-axis').attr('transform','translate(0,'+y.range()[0]+')').call(xAxis);}
if(showYAxis){yAxis.scale(y)._ticks(nv.utils.calcTicksY(availableHeight/36,data)).tickSize(-availableWidth,0);g.select('.nv-y.nv-axis').call(yAxis);}
if(showDistX){distX.getData(scatter.x()).scale(x).width(availableWidth).color(data.map(function(d,i){return d.color||color(d,i);}).filter(function(d,i){return!data[i].disabled}));gEnter.select('.nv-distWrap').append('g').attr('class','nv-distributionX');g.select('.nv-distributionX').attr('transform','translate(0,'+y.range()[0]+')').datum(data.filter(function(d){return!d.disabled})).call(distX);}
if(showDistY){distY.getData(scatter.y()).scale(y).width(availableHeight).color(data.map(function(d,i){return d.color||color(d,i);}).filter(function(d,i){return!data[i].disabled}));gEnter.select('.nv-distWrap').append('g').attr('class','nv-distributionY');g.select('.nv-distributionY').attr('transform','translate('+(rightAlignYAxis?availableWidth:-distY.size())+',0)').datum(data.filter(function(d){return!d.disabled})).call(distY);}
legend.dispatch.on('stateChange',function(newState){for(var key in newState)
state[key]=newState[key];dispatch.stateChange(state);chart.update();});dispatch.on('changeState',function(e){if(typeof e.disabled!=='undefined'){data.forEach(function(series,i){series.disabled=e.disabled[i];});state.disabled=e.disabled;}
chart.update();});scatter.dispatch.on('elementMouseout.tooltip',function(evt){tooltip.hidden(true);container.select('.nv-chart-'+scatter.id()+' .nv-series-'+evt.seriesIndex+' .nv-distx-'+evt.pointIndex).attr('y1',0);container.select('.nv-chart-'+scatter.id()+' .nv-series-'+evt.seriesIndex+' .nv-disty-'+evt.pointIndex).attr('x2',distY.size());});scatter.dispatch.on('elementMouseover.tooltip',function(evt){container.select('.nv-series-'+evt.seriesIndex+' .nv-distx-'+evt.pointIndex).attr('y1',evt.relativePos[1]-availableHeight);container.select('.nv-series-'+evt.seriesIndex+' .nv-disty-'+evt.pointIndex).attr('x2',evt.relativePos[0]+distX.size());tooltip.data(evt).hidden(false);});x0=x.copy();y0=y.copy();});renderWatch.renderEnd('scatter with line immediate');return chart;}
chart.dispatch=dispatch;chart.scatter=scatter;chart.legend=legend;chart.xAxis=xAxis;chart.yAxis=yAxis;chart.distX=distX;chart.distY=distY;chart.tooltip=tooltip;chart.options=nv.utils.optionsFunc.bind(chart);chart._options=Object.create({},{width:{get:function(){return width;},set:function(_){width=_;}},height:{get:function(){return height;},set:function(_){height=_;}},container:{get:function(){return container;},set:function(_){container=_;}},showDistX:{get:function(){return showDistX;},set:function(_){showDistX=_;}},showDistY:{get:function(){return showDistY;},set:function(_){showDistY=_;}},showLegend:{get:function(){return showLegend;},set:function(_){showLegend=_;}},showXAxis:{get:function(){return showXAxis;},set:function(_){showXAxis=_;}},showYAxis:{get:function(){return showYAxis;},set:function(_){showYAxis=_;}},defaultState:{get:function(){return defaultState;},set:function(_){defaultState=_;}},noData:{get:function(){return noData;},set:function(_){noData=_;}},duration:{get:function(){return duration;},set:function(_){duration=_;}},margin:{get:function(){return margin;},set:function(_){margin.top=_.top!==undefined?_.top:margin.top;margin.right=_.right!==undefined?_.right:margin.right;margin.bottom=_.bottom!==undefined?_.bottom:margin.bottom;margin.left=_.left!==undefined?_.left:margin.left;}},rightAlignYAxis:{get:function(){return rightAlignYAxis;},set:function(_){rightAlignYAxis=_;yAxis.orient((_)?'right':'left');}},color:{get:function(){return color;},set:function(_){color=nv.utils.getColor(_);legend.color(color);distX.color(color);distY.color(color);}}});nv.utils.inheritOptions(chart,scatter);nv.utils.initOptions(chart);return chart;};nv.models.sparkline=function(){"use strict";var margin={top:2,right:0,bottom:2,left:0},width=400,height=32,container=null,animate=true,x=d3.scale.linear(),y=d3.scale.linear(),getX=function(d){return d.x},getY=function(d){return d.y},color=nv.utils.getColor(['#000']),xDomain,yDomain,xRange,yRange;function chart(selection){selection.each(function(data){var availableWidth=width-margin.left-margin.right,availableHeight=height-margin.top-margin.bottom;container=d3.select(this);nv.utils.initSVG(container);x.domain(xDomain||d3.extent(data,getX)).range(xRange||[0,availableWidth]);y.domain(yDomain||d3.extent(data,getY)).range(yRange||[availableHeight,0]);var wrap=container.selectAll('g.nv-wrap.nv-sparkline').data([data]);var wrapEnter=wrap.enter().append('g').attr('class','nvd3 nv-wrap nv-sparkline');var gEnter=wrapEnter.append('g');var g=wrap.select('g');wrap.attr('transform','translate('+margin.left+','+margin.top+')')
var paths=wrap.selectAll('path').data(function(d){return[d]});paths.enter().append('path');paths.exit().remove();paths.style('stroke',function(d,i){return d.color||color(d,i)}).attr('d',d3.svg.line().x(function(d,i){return x(getX(d,i))}).y(function(d,i){return y(getY(d,i))}));var points=wrap.selectAll('circle.nv-point').data(function(data){var yValues=data.map(function(d,i){return getY(d,i);});function pointIndex(index){if(index!=-1){var result=data[index];result.pointIndex=index;return result;}else{return null;}}
var maxPoint=pointIndex(yValues.lastIndexOf(y.domain()[1])),minPoint=pointIndex(yValues.indexOf(y.domain()[0])),currentPoint=pointIndex(yValues.length-1);return[minPoint,maxPoint,currentPoint].filter(function(d){return d!=null;});});points.enter().append('circle');points.exit().remove();points.attr('cx',function(d,i){return x(getX(d,d.pointIndex))}).attr('cy',function(d,i){return y(getY(d,d.pointIndex))}).attr('r',2).attr('class',function(d,i){return getX(d,d.pointIndex)==x.domain()[1]?'nv-point nv-currentValue':getY(d,d.pointIndex)==y.domain()[0]?'nv-point nv-minValue':'nv-point nv-maxValue'});});return chart;}
chart.options=nv.utils.optionsFunc.bind(chart);chart._options=Object.create({},{width:{get:function(){return width;},set:function(_){width=_;}},height:{get:function(){return height;},set:function(_){height=_;}},xDomain:{get:function(){return xDomain;},set:function(_){xDomain=_;}},yDomain:{get:function(){return yDomain;},set:function(_){yDomain=_;}},xRange:{get:function(){return xRange;},set:function(_){xRange=_;}},yRange:{get:function(){return yRange;},set:function(_){yRange=_;}},xScale:{get:function(){return x;},set:function(_){x=_;}},yScale:{get:function(){return y;},set:function(_){y=_;}},animate:{get:function(){return animate;},set:function(_){animate=_;}},x:{get:function(){return getX;},set:function(_){getX=d3.functor(_);}},y:{get:function(){return getY;},set:function(_){getY=d3.functor(_);}},margin:{get:function(){return margin;},set:function(_){margin.top=_.top!==undefined?_.top:margin.top;margin.right=_.right!==undefined?_.right:margin.right;margin.bottom=_.bottom!==undefined?_.bottom:margin.bottom;margin.left=_.left!==undefined?_.left:margin.left;}},color:{get:function(){return color;},set:function(_){color=nv.utils.getColor(_);}}});nv.utils.initOptions(chart);return chart;};nv.models.sparklinePlus=function(){"use strict";var sparkline=nv.models.sparkline();var margin={top:15,right:100,bottom:10,left:50},width=null,height=null,x,y,index=[],paused=false,xTickFormat=d3.format(',r'),yTickFormat=d3.format(',.2f'),showLastValue=true,alignValue=true,rightAlignValue=false,noData=null;function chart(selection){selection.each(function(data){var container=d3.select(this);nv.utils.initSVG(container);var availableWidth=nv.utils.availableWidth(width,container,margin),availableHeight=nv.utils.availableHeight(height,container,margin);chart.update=function(){container.call(chart);};chart.container=this;if(!data||!data.length){nv.utils.noData(chart,container)
return chart;}else{container.selectAll('.nv-noData').remove();}
var currentValue=sparkline.y()(data[data.length-1],data.length-1);x=sparkline.xScale();y=sparkline.yScale();var wrap=container.selectAll('g.nv-wrap.nv-sparklineplus').data([data]);var wrapEnter=wrap.enter().append('g').attr('class','nvd3 nv-wrap nv-sparklineplus');var gEnter=wrapEnter.append('g');var g=wrap.select('g');gEnter.append('g').attr('class','nv-sparklineWrap');gEnter.append('g').attr('class','nv-valueWrap');gEnter.append('g').attr('class','nv-hoverArea');wrap.attr('transform','translate('+margin.left+','+margin.top+')');var sparklineWrap=g.select('.nv-sparklineWrap');sparkline.width(availableWidth).height(availableHeight);sparklineWrap.call(sparkline);if(showLastValue){var valueWrap=g.select('.nv-valueWrap');var value=valueWrap.selectAll('.nv-currentValue').data([currentValue]);value.enter().append('text').attr('class','nv-currentValue').attr('dx',rightAlignValue?-8:8).attr('dy','.9em').style('text-anchor',rightAlignValue?'end':'start');value.attr('x',availableWidth+(rightAlignValue?margin.right:0)).attr('y',alignValue?function(d){return y(d)}:0).style('fill',sparkline.color()(data[data.length-1],data.length-1)).text(yTickFormat(currentValue));}
gEnter.select('.nv-hoverArea').append('rect').on('mousemove',sparklineHover).on('click',function(){paused=!paused}).on('mouseout',function(){index=[];updateValueLine();});g.select('.nv-hoverArea rect').attr('transform',function(d){return'translate('+-margin.left+','+-margin.top+')'}).attr('width',availableWidth+margin.left+margin.right).attr('height',availableHeight+margin.top);function updateValueLine(){if(paused)return;var hoverValue=g.selectAll('.nv-hoverValue').data(index);var hoverEnter=hoverValue.enter().append('g').attr('class','nv-hoverValue').style('stroke-opacity',0).style('fill-opacity',0);hoverValue.exit().transition().duration(250).style('stroke-opacity',0).style('fill-opacity',0).remove();hoverValue.attr('transform',function(d){return'translate('+x(sparkline.x()(data[d],d))+',0)'}).transition().duration(250).style('stroke-opacity',1).style('fill-opacity',1);if(!index.length)return;hoverEnter.append('line').attr('x1',0).attr('y1',-margin.top).attr('x2',0).attr('y2',availableHeight);hoverEnter.append('text').attr('class','nv-xValue').attr('x',-6).attr('y',-margin.top).attr('text-anchor','end').attr('dy','.9em');g.select('.nv-hoverValue .nv-xValue').text(xTickFormat(sparkline.x()(data[index[0]],index[0])));hoverEnter.append('text').attr('class','nv-yValue').attr('x',6).attr('y',-margin.top).attr('text-anchor','start').attr('dy','.9em');g.select('.nv-hoverValue .nv-yValue').text(yTickFormat(sparkline.y()(data[index[0]],index[0])));}
function sparklineHover(){if(paused)return;var pos=d3.mouse(this)[0]-margin.left;function getClosestIndex(data,x){var distance=Math.abs(sparkline.x()(data[0],0)-x);var closestIndex=0;for(var i=0;i<data.length;i++){if(Math.abs(sparkline.x()(data[i],i)-x)<distance){distance=Math.abs(sparkline.x()(data[i],i)-x);closestIndex=i;}}
return closestIndex;}
index=[getClosestIndex(data,Math.round(x.invert(pos)))];updateValueLine();}});return chart;}
chart.sparkline=sparkline;chart.options=nv.utils.optionsFunc.bind(chart);chart._options=Object.create({},{width:{get:function(){return width;},set:function(_){width=_;}},height:{get:function(){return height;},set:function(_){height=_;}},xTickFormat:{get:function(){return xTickFormat;},set:function(_){xTickFormat=_;}},yTickFormat:{get:function(){return yTickFormat;},set:function(_){yTickFormat=_;}},showLastValue:{get:function(){return showLastValue;},set:function(_){showLastValue=_;}},alignValue:{get:function(){return alignValue;},set:function(_){alignValue=_;}},rightAlignValue:{get:function(){return rightAlignValue;},set:function(_){rightAlignValue=_;}},noData:{get:function(){return noData;},set:function(_){noData=_;}},margin:{get:function(){return margin;},set:function(_){margin.top=_.top!==undefined?_.top:margin.top;margin.right=_.right!==undefined?_.right:margin.right;margin.bottom=_.bottom!==undefined?_.bottom:margin.bottom;margin.left=_.left!==undefined?_.left:margin.left;}}});nv.utils.inheritOptions(chart,sparkline);nv.utils.initOptions(chart);return chart;};nv.models.stackedArea=function(){"use strict";var margin={top:0,right:0,bottom:0,left:0},width=960,height=500,color=nv.utils.defaultColor(),id=Math.floor(Math.random()*100000),container=null,getX=function(d){return d.x},getY=function(d){return d.y},style='stack',offset='zero',order='default',interpolate='linear',clipEdge=false,x,y,scatter=nv.models.scatter(),duration=250,dispatch=d3.dispatch('areaClick','areaMouseover','areaMouseout','renderEnd','elementClick','elementMouseover','elementMouseout');scatter.pointSize(2.2).pointDomain([2.2,2.2]);var renderWatch=nv.utils.renderWatch(dispatch,duration);function chart(selection){renderWatch.reset();renderWatch.models(scatter);selection.each(function(data){var availableWidth=width-margin.left-margin.right,availableHeight=height-margin.top-margin.bottom;container=d3.select(this);nv.utils.initSVG(container);x=scatter.xScale();y=scatter.yScale();var dataRaw=data;data.forEach(function(aseries,i){aseries.seriesIndex=i;aseries.values=aseries.values.map(function(d,j){d.index=j;d.seriesIndex=i;return d;});});var dataFiltered=data.filter(function(series){return!series.disabled;});data=d3.layout.stack().order(order).offset(offset).values(function(d){return d.values}).x(getX).y(getY).out(function(d,y0,y){d.display={y:y,y0:y0};})
(dataFiltered);var wrap=container.selectAll('g.nv-wrap.nv-stackedarea').data([data]);var wrapEnter=wrap.enter().append('g').attr('class','nvd3 nv-wrap nv-stackedarea');var defsEnter=wrapEnter.append('defs');var gEnter=wrapEnter.append('g');var g=wrap.select('g');gEnter.append('g').attr('class','nv-areaWrap');gEnter.append('g').attr('class','nv-scatterWrap');wrap.attr('transform','translate('+margin.left+','+margin.top+')');if(scatter.forceY().length==0){scatter.forceY().push(0);}
scatter.width(availableWidth).height(availableHeight).x(getX).y(function(d){if(d.display!==undefined){return d.display.y+d.display.y0;}}).forceY([0]).color(data.map(function(d,i){return d.color||color(d,d.seriesIndex);}));var scatterWrap=g.select('.nv-scatterWrap').datum(data);scatterWrap.call(scatter);defsEnter.append('clipPath').attr('id','nv-edge-clip-'+id).append('rect');wrap.select('#nv-edge-clip-'+id+' rect').attr('width',availableWidth).attr('height',availableHeight);g.attr('clip-path',clipEdge?'url(#nv-edge-clip-'+id+')':'');var area=d3.svg.area().x(function(d,i){return x(getX(d,i))}).y0(function(d){return y(d.display.y0)}).y1(function(d){return y(d.display.y+d.display.y0)}).interpolate(interpolate);var zeroArea=d3.svg.area().x(function(d,i){return x(getX(d,i))}).y0(function(d){return y(d.display.y0)}).y1(function(d){return y(d.display.y0)});var path=g.select('.nv-areaWrap').selectAll('path.nv-area').data(function(d){return d});path.enter().append('path').attr('class',function(d,i){return'nv-area nv-area-'+i}).attr('d',function(d,i){return zeroArea(d.values,d.seriesIndex);}).on('mouseover',function(d,i){d3.select(this).classed('hover',true);dispatch.areaMouseover({point:d,series:d.key,pos:[d3.event.pageX,d3.event.pageY],seriesIndex:d.seriesIndex});}).on('mouseout',function(d,i){d3.select(this).classed('hover',false);dispatch.areaMouseout({point:d,series:d.key,pos:[d3.event.pageX,d3.event.pageY],seriesIndex:d.seriesIndex});}).on('click',function(d,i){d3.select(this).classed('hover',false);dispatch.areaClick({point:d,series:d.key,pos:[d3.event.pageX,d3.event.pageY],seriesIndex:d.seriesIndex});});path.exit().remove();path.style('fill',function(d,i){return d.color||color(d,d.seriesIndex)}).style('stroke',function(d,i){return d.color||color(d,d.seriesIndex)});path.watchTransition(renderWatch,'stackedArea path').attr('d',function(d,i){return area(d.values,i)});scatter.dispatch.on('elementMouseover.area',function(e){g.select('.nv-chart-'+id+' .nv-area-'+e.seriesIndex).classed('hover',true);});scatter.dispatch.on('elementMouseout.area',function(e){g.select('.nv-chart-'+id+' .nv-area-'+e.seriesIndex).classed('hover',false);});chart.d3_stackedOffset_stackPercent=function(stackData){var n=stackData.length,m=stackData[0].length,i,j,o,y0=[];for(j=0;j<m;++j){for(i=0,o=0;i<dataRaw.length;i++){o+=getY(dataRaw[i].values[j]);}
if(o)for(i=0;i<n;i++){stackData[i][j][1]/=o;}else{for(i=0;i<n;i++){stackData[i][j][1]=0;}}}
for(j=0;j<m;++j)y0[j]=0;return y0;};});renderWatch.renderEnd('stackedArea immediate');return chart;}
chart.dispatch=dispatch;chart.scatter=scatter;scatter.dispatch.on('elementClick',function(){dispatch.elementClick.apply(this,arguments);});scatter.dispatch.on('elementMouseover',function(){dispatch.elementMouseover.apply(this,arguments);});scatter.dispatch.on('elementMouseout',function(){dispatch.elementMouseout.apply(this,arguments);});chart.interpolate=function(_){if(!arguments.length)return interpolate;interpolate=_;return chart;};chart.duration=function(_){if(!arguments.length)return duration;duration=_;renderWatch.reset(duration);scatter.duration(duration);return chart;};chart.dispatch=dispatch;chart.scatter=scatter;chart.options=nv.utils.optionsFunc.bind(chart);chart._options=Object.create({},{width:{get:function(){return width;},set:function(_){width=_;}},height:{get:function(){return height;},set:function(_){height=_;}},clipEdge:{get:function(){return clipEdge;},set:function(_){clipEdge=_;}},offset:{get:function(){return offset;},set:function(_){offset=_;}},order:{get:function(){return order;},set:function(_){order=_;}},interpolate:{get:function(){return interpolate;},set:function(_){interpolate=_;}},x:{get:function(){return getX;},set:function(_){getX=d3.functor(_);}},y:{get:function(){return getY;},set:function(_){getY=d3.functor(_);}},margin:{get:function(){return margin;},set:function(_){margin.top=_.top!==undefined?_.top:margin.top;margin.right=_.right!==undefined?_.right:margin.right;margin.bottom=_.bottom!==undefined?_.bottom:margin.bottom;margin.left=_.left!==undefined?_.left:margin.left;}},color:{get:function(){return color;},set:function(_){color=nv.utils.getColor(_);}},style:{get:function(){return style;},set:function(_){style=_;switch(style){case'stack':chart.offset('zero');chart.order('default');break;case'stream':chart.offset('wiggle');chart.order('inside-out');break;case'stream-center':chart.offset('silhouette');chart.order('inside-out');break;case'expand':chart.offset('expand');chart.order('default');break;case'stack_percent':chart.offset(chart.d3_stackedOffset_stackPercent);chart.order('default');break;}}},duration:{get:function(){return duration;},set:function(_){duration=_;renderWatch.reset(duration);scatter.duration(duration);}}});nv.utils.inheritOptions(chart,scatter);nv.utils.initOptions(chart);return chart;};nv.models.stackedAreaChart=function(){"use strict";var stacked=nv.models.stackedArea(),xAxis=nv.models.axis(),yAxis=nv.models.axis(),legend=nv.models.legend(),controls=nv.models.legend(),interactiveLayer=nv.interactiveGuideline(),tooltip=nv.models.tooltip();var margin={top:30,right:25,bottom:50,left:60},width=null,height=null,color=nv.utils.defaultColor(),showControls=true,showLegend=true,showXAxis=true,showYAxis=true,rightAlignYAxis=false,useInteractiveGuideline=false,showTotalInTooltip=true,totalLabel='TOTAL',x,y,state=nv.utils.state(),defaultState=null,noData=null,dispatch=d3.dispatch('stateChange','changeState','renderEnd'),controlWidth=250,controlOptions=['Stacked','Stream','Expanded'],controlLabels={},duration=250;state.style=stacked.style();xAxis.orient('bottom').tickPadding(7);yAxis.orient((rightAlignYAxis)?'right':'left');tooltip.headerFormatter(function(d,i){return xAxis.tickFormat()(d,i);}).valueFormatter(function(d,i){return yAxis.tickFormat()(d,i);});interactiveLayer.tooltip.headerFormatter(function(d,i){return xAxis.tickFormat()(d,i);}).valueFormatter(function(d,i){return yAxis.tickFormat()(d,i);});var oldYTickFormat=null,oldValueFormatter=null;controls.updateState(false);var renderWatch=nv.utils.renderWatch(dispatch);var style=stacked.style();var stateGetter=function(data){return function(){return{active:data.map(function(d){return!d.disabled}),style:stacked.style()};}};var stateSetter=function(data){return function(state){if(state.style!==undefined)
style=state.style;if(state.active!==undefined)
data.forEach(function(series,i){series.disabled=!state.active[i];});}};var percentFormatter=d3.format('%');function chart(selection){renderWatch.reset();renderWatch.models(stacked);if(showXAxis)renderWatch.models(xAxis);if(showYAxis)renderWatch.models(yAxis);selection.each(function(data){var container=d3.select(this),that=this;nv.utils.initSVG(container);var availableWidth=nv.utils.availableWidth(width,container,margin),availableHeight=nv.utils.availableHeight(height,container,margin);chart.update=function(){container.transition().duration(duration).call(chart);};chart.container=this;state.setter(stateSetter(data),chart.update).getter(stateGetter(data)).update();state.disabled=data.map(function(d){return!!d.disabled});if(!defaultState){var key;defaultState={};for(key in state){if(state[key]instanceof Array)
defaultState[key]=state[key].slice(0);else
defaultState[key]=state[key];}}
if(!data||!data.length||!data.filter(function(d){return d.values.length}).length){nv.utils.noData(chart,container)
return chart;}else{container.selectAll('.nv-noData').remove();}
x=stacked.xScale();y=stacked.yScale();var wrap=container.selectAll('g.nv-wrap.nv-stackedAreaChart').data([data]);var gEnter=wrap.enter().append('g').attr('class','nvd3 nv-wrap nv-stackedAreaChart').append('g');var g=wrap.select('g');gEnter.append("rect").style("opacity",0);gEnter.append('g').attr('class','nv-x nv-axis');gEnter.append('g').attr('class','nv-y nv-axis');gEnter.append('g').attr('class','nv-stackedWrap');gEnter.append('g').attr('class','nv-legendWrap');gEnter.append('g').attr('class','nv-controlsWrap');gEnter.append('g').attr('class','nv-interactive');g.select("rect").attr("width",availableWidth).attr("height",availableHeight);if(showLegend){var legendWidth=(showControls)?availableWidth-controlWidth:availableWidth;legend.width(legendWidth);g.select('.nv-legendWrap').datum(data).call(legend);if(margin.top!=legend.height()){margin.top=legend.height();availableHeight=nv.utils.availableHeight(height,container,margin);}
g.select('.nv-legendWrap').attr('transform','translate('+(availableWidth-legendWidth)+','+(-margin.top)+')');}
if(showControls){var controlsData=[{key:controlLabels.stacked||'Stacked',metaKey:'Stacked',disabled:stacked.style()!='stack',style:'stack'},{key:controlLabels.stream||'Stream',metaKey:'Stream',disabled:stacked.style()!='stream',style:'stream'},{key:controlLabels.expanded||'Expanded',metaKey:'Expanded',disabled:stacked.style()!='expand',style:'expand'},{key:controlLabels.stack_percent||'Stack %',metaKey:'Stack_Percent',disabled:stacked.style()!='stack_percent',style:'stack_percent'}];controlWidth=(controlOptions.length/3)*260;controlsData=controlsData.filter(function(d){return controlOptions.indexOf(d.metaKey)!==-1;});controls.width(controlWidth).color(['#444','#444','#444']);g.select('.nv-controlsWrap').datum(controlsData).call(controls);if(margin.top!=Math.max(controls.height(),legend.height())){margin.top=Math.max(controls.height(),legend.height());availableHeight=nv.utils.availableHeight(height,container,margin);}
g.select('.nv-controlsWrap').attr('transform','translate(0,'+(-margin.top)+')');}
wrap.attr('transform','translate('+margin.left+','+margin.top+')');if(rightAlignYAxis){g.select(".nv-y.nv-axis").attr("transform","translate("+availableWidth+",0)");}
if(useInteractiveGuideline){interactiveLayer.width(availableWidth).height(availableHeight).margin({left:margin.left,top:margin.top}).svgContainer(container).xScale(x);wrap.select(".nv-interactive").call(interactiveLayer);}
stacked.width(availableWidth).height(availableHeight);var stackedWrap=g.select('.nv-stackedWrap').datum(data);stackedWrap.transition().call(stacked);if(showXAxis){xAxis.scale(x)._ticks(nv.utils.calcTicksX(availableWidth/100,data)).tickSize(-availableHeight,0);g.select('.nv-x.nv-axis').attr('transform','translate(0,'+availableHeight+')');g.select('.nv-x.nv-axis').transition().duration(0).call(xAxis);}
if(showYAxis){var ticks;if(stacked.offset()==='wiggle'){ticks=0;}
else{ticks=nv.utils.calcTicksY(availableHeight/36,data);}
yAxis.scale(y)._ticks(ticks).tickSize(-availableWidth,0);if(stacked.style()==='expand'||stacked.style()==='stack_percent'){var currentFormat=yAxis.tickFormat();if(!oldYTickFormat||currentFormat!==percentFormatter)
oldYTickFormat=currentFormat;yAxis.tickFormat(percentFormatter);}
else{if(oldYTickFormat){yAxis.tickFormat(oldYTickFormat);oldYTickFormat=null;}}
g.select('.nv-y.nv-axis').transition().duration(0).call(yAxis);}
stacked.dispatch.on('areaClick.toggle',function(e){if(data.filter(function(d){return!d.disabled}).length===1)
data.forEach(function(d){d.disabled=false;});else
data.forEach(function(d,i){d.disabled=(i!=e.seriesIndex);});state.disabled=data.map(function(d){return!!d.disabled});dispatch.stateChange(state);chart.update();});legend.dispatch.on('stateChange',function(newState){for(var key in newState)
state[key]=newState[key];dispatch.stateChange(state);chart.update();});controls.dispatch.on('legendClick',function(d,i){if(!d.disabled)return;controlsData=controlsData.map(function(s){s.disabled=true;return s;});d.disabled=false;stacked.style(d.style);state.style=stacked.style();dispatch.stateChange(state);chart.update();});interactiveLayer.dispatch.on('elementMousemove',function(e){stacked.clearHighlights();var singlePoint,pointIndex,pointXLocation,allData=[],valueSum=0;data.filter(function(series,i){series.seriesIndex=i;return!series.disabled;}).forEach(function(series,i){pointIndex=nv.interactiveBisect(series.values,e.pointXValue,chart.x());var point=series.values[pointIndex];var pointYValue=chart.y()(point,pointIndex);if(pointYValue!=null){stacked.highlightPoint(i,pointIndex,true);}
if(typeof point==='undefined')return;if(typeof singlePoint==='undefined')singlePoint=point;if(typeof pointXLocation==='undefined')pointXLocation=chart.xScale()(chart.x()(point,pointIndex));var tooltipValue=(stacked.style()=='expand')?point.display.y:chart.y()(point,pointIndex);allData.push({key:series.key,value:tooltipValue,color:color(series,series.seriesIndex),stackedValue:point.display});if(showTotalInTooltip&&stacked.style()!='expand'){valueSum+=tooltipValue;};});allData.reverse();if(allData.length>2){var yValue=chart.yScale().invert(e.mouseY);var yDistMax=Infinity,indexToHighlight=null;allData.forEach(function(series,i){yValue=Math.abs(yValue);var stackedY0=Math.abs(series.stackedValue.y0);var stackedY=Math.abs(series.stackedValue.y);if(yValue>=stackedY0&&yValue<=(stackedY+stackedY0))
{indexToHighlight=i;return;}});if(indexToHighlight!=null)
allData[indexToHighlight].highlight=true;}
if(showTotalInTooltip&&stacked.style()!='expand'&&allData.length>=2){allData.push({key:totalLabel,value:valueSum,total:true});}
var xValue=xAxis.tickFormat()(chart.x()(singlePoint,pointIndex));var valueFormatter=interactiveLayer.tooltip.valueFormatter();if(stacked.style()==='expand'||stacked.style()==='stack_percent'){if(!oldValueFormatter){oldValueFormatter=valueFormatter;}
valueFormatter=d3.format(".1%");}
else{if(oldValueFormatter){valueFormatter=oldValueFormatter;oldValueFormatter=null;}}
interactiveLayer.tooltip.chartContainer(that.parentNode).valueFormatter(valueFormatter).data({value:xValue,series:allData})();interactiveLayer.renderGuideLine(pointXLocation);});interactiveLayer.dispatch.on("elementMouseout",function(e){stacked.clearHighlights();});dispatch.on('changeState',function(e){if(typeof e.disabled!=='undefined'&&data.length===e.disabled.length){data.forEach(function(series,i){series.disabled=e.disabled[i];});state.disabled=e.disabled;}
if(typeof e.style!=='undefined'){stacked.style(e.style);style=e.style;}
chart.update();});});renderWatch.renderEnd('stacked Area chart immediate');return chart;}
stacked.dispatch.on('elementMouseover.tooltip',function(evt){evt.point['x']=stacked.x()(evt.point);evt.point['y']=stacked.y()(evt.point);tooltip.data(evt).hidden(false);});stacked.dispatch.on('elementMouseout.tooltip',function(evt){tooltip.hidden(true)});chart.dispatch=dispatch;chart.stacked=stacked;chart.legend=legend;chart.controls=controls;chart.xAxis=xAxis;chart.yAxis=yAxis;chart.interactiveLayer=interactiveLayer;chart.tooltip=tooltip;chart.dispatch=dispatch;chart.options=nv.utils.optionsFunc.bind(chart);chart._options=Object.create({},{width:{get:function(){return width;},set:function(_){width=_;}},height:{get:function(){return height;},set:function(_){height=_;}},showLegend:{get:function(){return showLegend;},set:function(_){showLegend=_;}},showXAxis:{get:function(){return showXAxis;},set:function(_){showXAxis=_;}},showYAxis:{get:function(){return showYAxis;},set:function(_){showYAxis=_;}},defaultState:{get:function(){return defaultState;},set:function(_){defaultState=_;}},noData:{get:function(){return noData;},set:function(_){noData=_;}},showControls:{get:function(){return showControls;},set:function(_){showControls=_;}},controlLabels:{get:function(){return controlLabels;},set:function(_){controlLabels=_;}},controlOptions:{get:function(){return controlOptions;},set:function(_){controlOptions=_;}},showTotalInTooltip:{get:function(){return showTotalInTooltip;},set:function(_){showTotalInTooltip=_;}},totalLabel:{get:function(){return totalLabel;},set:function(_){totalLabel=_;}},margin:{get:function(){return margin;},set:function(_){margin.top=_.top!==undefined?_.top:margin.top;margin.right=_.right!==undefined?_.right:margin.right;margin.bottom=_.bottom!==undefined?_.bottom:margin.bottom;margin.left=_.left!==undefined?_.left:margin.left;}},duration:{get:function(){return duration;},set:function(_){duration=_;renderWatch.reset(duration);stacked.duration(duration);xAxis.duration(duration);yAxis.duration(duration);}},color:{get:function(){return color;},set:function(_){color=nv.utils.getColor(_);legend.color(color);stacked.color(color);}},rightAlignYAxis:{get:function(){return rightAlignYAxis;},set:function(_){rightAlignYAxis=_;yAxis.orient(rightAlignYAxis?'right':'left');}},useInteractiveGuideline:{get:function(){return useInteractiveGuideline;},set:function(_){useInteractiveGuideline=!!_;chart.interactive(!_);chart.useVoronoi(!_);stacked.scatter.interactive(!_);}}});nv.utils.inheritOptions(chart,stacked);nv.utils.initOptions(chart);return chart;};nv.models.sunburst=function(){"use strict";var margin={top:0,right:0,bottom:0,left:0},width=null,height=null,mode="count",modes={count:function(d){return 1;},size:function(d){return d.size}},id=Math.floor(Math.random()*10000),container=null,color=nv.utils.defaultColor(),duration=500,dispatch=d3.dispatch('chartClick','elementClick','elementDblClick','elementMousemove','elementMouseover','elementMouseout','renderEnd');var x=d3.scale.linear().range([0,2*Math.PI]);var y=d3.scale.sqrt();var partition=d3.layout.partition().sort(null).value(function(d){return 1;});var arc=d3.svg.arc().startAngle(function(d){return Math.max(0,Math.min(2*Math.PI,x(d.x)));}).endAngle(function(d){return Math.max(0,Math.min(2*Math.PI,x(d.x+d.dx)));}).innerRadius(function(d){return Math.max(0,y(d.y));}).outerRadius(function(d){return Math.max(0,y(d.y+d.dy));});var node,prevNode;var rootNode;var renderWatch=nv.utils.renderWatch(dispatch);function chart(selection){renderWatch.reset();selection.each(function(data){container=d3.select(this);var availableWidth=nv.utils.availableWidth(width,container,margin);var availableHeight=nv.utils.availableHeight(height,container,margin);var radius=Math.min(availableWidth,availableHeight)/2;var path;nv.utils.initSVG(container);var wrap=container.selectAll('.nv-wrap.nv-sunburst').data(data);var wrapEnter=wrap.enter().append('g').attr('class','nvd3 nv-wrap nv-sunburst nv-chart-'+id);var g=wrapEnter.selectAll('nv-sunburst');wrap.attr('transform','translate('+availableWidth/2+','+availableHeight/2+')');container.on('click',function(d,i){dispatch.chartClick({data:d,index:i,pos:d3.event,id:id});});y.range([0,radius]);node=node||data;rootNode=data[0];partition.value(modes[mode]||modes["count"]);path=g.data(partition.nodes).enter().append("path").attr("d",arc).style("fill",function(d){return color((d.children?d:d.parent).name);}).style("stroke","#FFF").on("click",function(d){if(prevNode!==node&&node!==d)prevNode=node;node=d;path.transition().duration(duration).attrTween("d",arcTweenZoom(d));}).each(stash).on("dblclick",function(d){if(prevNode.parent==d){path.transition().duration(duration).attrTween("d",arcTweenZoom(rootNode));}}).each(stash).on('mouseover',function(d,i){d3.select(this).classed('hover',true).style('opacity',0.8);dispatch.elementMouseover({data:d,color:d3.select(this).style("fill")});}).on('mouseout',function(d,i){d3.select(this).classed('hover',false).style('opacity',1);dispatch.elementMouseout({data:d});}).on('mousemove',function(d,i){dispatch.elementMousemove({data:d});});function stash(d){d.x0=d.x;d.dx0=d.dx;}
function arcTweenData(a,i){var oi=d3.interpolate({x:a.x0,dx:a.dx0},a);function tween(t){var b=oi(t);a.x0=b.x;a.dx0=b.dx;return arc(b);}
if(i==0){var xd=d3.interpolate(x.domain(),[node.x,node.x+node.dx]);return function(t){x.domain(xd(t));return tween(t);};}else{return tween;}}
function arcTweenZoom(d){var xd=d3.interpolate(x.domain(),[d.x,d.x+d.dx]),yd=d3.interpolate(y.domain(),[d.y,1]),yr=d3.interpolate(y.range(),[d.y?20:0,radius]);return function(d,i){return i?function(t){return arc(d);}:function(t){x.domain(xd(t));y.domain(yd(t)).range(yr(t));return arc(d);};};}});renderWatch.renderEnd('sunburst immediate');return chart;}
chart.dispatch=dispatch;chart.options=nv.utils.optionsFunc.bind(chart);chart._options=Object.create({},{width:{get:function(){return width;},set:function(_){width=_;}},height:{get:function(){return height;},set:function(_){height=_;}},mode:{get:function(){return mode;},set:function(_){mode=_;}},id:{get:function(){return id;},set:function(_){id=_;}},duration:{get:function(){return duration;},set:function(_){duration=_;}},margin:{get:function(){return margin;},set:function(_){margin.top=_.top!=undefined?_.top:margin.top;margin.right=_.right!=undefined?_.right:margin.right;margin.bottom=_.bottom!=undefined?_.bottom:margin.bottom;margin.left=_.left!=undefined?_.left:margin.left;}},color:{get:function(){return color;},set:function(_){color=nv.utils.getColor(_);}}});nv.utils.initOptions(chart);return chart;};nv.models.sunburstChart=function(){"use strict";var sunburst=nv.models.sunburst();var tooltip=nv.models.tooltip();var margin={top:30,right:20,bottom:20,left:20},width=null,height=null,color=nv.utils.defaultColor(),id=Math.round(Math.random()*100000),defaultState=null,noData=null,duration=250,dispatch=d3.dispatch('stateChange','changeState','renderEnd');tooltip.duration(0);var renderWatch=nv.utils.renderWatch(dispatch);tooltip.headerEnabled(false).valueFormatter(function(d,i){return d;});function chart(selection){renderWatch.reset();renderWatch.models(sunburst);selection.each(function(data){var container=d3.select(this);nv.utils.initSVG(container);var that=this;var availableWidth=nv.utils.availableWidth(width,container,margin),availableHeight=nv.utils.availableHeight(height,container,margin);chart.update=function(){if(duration===0)
container.call(chart);else
container.transition().duration(duration).call(chart)};chart.container=this;if(!data||!data.length){nv.utils.noData(chart,container);return chart;}else{container.selectAll('.nv-noData').remove();}
var wrap=container.selectAll('g.nv-wrap.nv-sunburstChart').data(data);var gEnter=wrap.enter().append('g').attr('class','nvd3 nv-wrap nv-sunburstChart').append('g');var g=wrap.select('g');gEnter.append('g').attr('class','nv-sunburstWrap');wrap.attr('transform','translate('+margin.left+','+margin.top+')');sunburst.width(availableWidth).height(availableHeight);var sunWrap=g.select('.nv-sunburstWrap').datum(data);d3.transition(sunWrap).call(sunburst);});renderWatch.renderEnd('sunburstChart immediate');return chart;}
sunburst.dispatch.on('elementMouseover.tooltip',function(evt){evt['series']={key:evt.data.name,value:evt.data.size,color:evt.color};tooltip.data(evt).hidden(false);});sunburst.dispatch.on('elementMouseout.tooltip',function(evt){tooltip.hidden(true);});sunburst.dispatch.on('elementMousemove.tooltip',function(evt){tooltip();});chart.dispatch=dispatch;chart.sunburst=sunburst;chart.tooltip=tooltip;chart.options=nv.utils.optionsFunc.bind(chart);chart._options=Object.create({},{noData:{get:function(){return noData;},set:function(_){noData=_;}},defaultState:{get:function(){return defaultState;},set:function(_){defaultState=_;}},color:{get:function(){return color;},set:function(_){color=_;sunburst.color(color);}},duration:{get:function(){return duration;},set:function(_){duration=_;renderWatch.reset(duration);sunburst.duration(duration);}},margin:{get:function(){return margin;},set:function(_){margin.top=_.top!==undefined?_.top:margin.top;margin.right=_.right!==undefined?_.right:margin.right;margin.bottom=_.bottom!==undefined?_.bottom:margin.bottom;margin.left=_.left!==undefined?_.left:margin.left;}}});nv.utils.inheritOptions(chart,sunburst);nv.utils.initOptions(chart);return chart;};nv.version="1.8.1-dev";})();;

/* /web/static/lib/backbone/backbone.js defined in bundle 'web.assets_backend' */
(function(){var root=this;var previousBackbone=root.Backbone;var array=[];var push=array.push;var slice=array.slice;var splice=array.splice;var Backbone;if(typeof exports!=='undefined'){Backbone=exports;}else{Backbone=root.Backbone={};}
Backbone.VERSION='1.1.0';var _=root._;if(!_&&(typeof require!=='undefined'))_=require('underscore');Backbone.$=root.jQuery||root.Zepto||root.ender||root.$;Backbone.noConflict=function(){root.Backbone=previousBackbone;return this;};Backbone.emulateHTTP=false;Backbone.emulateJSON=false;var Events=Backbone.Events={on:function(name,callback,context){if(!eventsApi(this,'on',name,[callback,context])||!callback)return this;this._events||(this._events={});var events=this._events[name]||(this._events[name]=[]);events.push({callback:callback,context:context,ctx:context||this});return this;},once:function(name,callback,context){if(!eventsApi(this,'once',name,[callback,context])||!callback)return this;var self=this;var once=_.once(function(){self.off(name,once);callback.apply(this,arguments);});once._callback=callback;return this.on(name,once,context);},off:function(name,callback,context){var retain,ev,events,names,i,l,j,k;if(!this._events||!eventsApi(this,'off',name,[callback,context]))return this;if(!name&&!callback&&!context){this._events={};return this;}
names=name?[name]:_.keys(this._events);for(i=0,l=names.length;i<l;i++){name=names[i];if(events=this._events[name]){this._events[name]=retain=[];if(callback||context){for(j=0,k=events.length;j<k;j++){ev=events[j];if((callback&&callback!==ev.callback&&callback!==ev.callback._callback)||(context&&context!==ev.context)){retain.push(ev);}}}
if(!retain.length)delete this._events[name];}}
return this;},trigger:function(name){if(!this._events)return this;var args=slice.call(arguments,1);if(!eventsApi(this,'trigger',name,args))return this;var events=this._events[name];var allEvents=this._events.all;if(events)triggerEvents(events,args);if(allEvents)triggerEvents(allEvents,arguments);return this;},stopListening:function(obj,name,callback){var listeningTo=this._listeningTo;if(!listeningTo)return this;var remove=!name&&!callback;if(!callback&&typeof name==='object')callback=this;if(obj)(listeningTo={})[obj._listenId]=obj;for(var id in listeningTo){obj=listeningTo[id];obj.off(name,callback,this);if(remove||_.isEmpty(obj._events))delete this._listeningTo[id];}
return this;}};var eventSplitter=/\s+/;var eventsApi=function(obj,action,name,rest){if(!name)return true;if(typeof name==='object'){for(var key in name){obj[action].apply(obj,[key,name[key]].concat(rest));}
return false;}
if(eventSplitter.test(name)){var names=name.split(eventSplitter);for(var i=0,l=names.length;i<l;i++){obj[action].apply(obj,[names[i]].concat(rest));}
return false;}
return true;};var triggerEvents=function(events,args){var ev,i=-1,l=events.length,a1=args[0],a2=args[1],a3=args[2];switch(args.length){case 0:while(++i<l)(ev=events[i]).callback.call(ev.ctx);return;case 1:while(++i<l)(ev=events[i]).callback.call(ev.ctx,a1);return;case 2:while(++i<l)(ev=events[i]).callback.call(ev.ctx,a1,a2);return;case 3:while(++i<l)(ev=events[i]).callback.call(ev.ctx,a1,a2,a3);return;default:while(++i<l)(ev=events[i]).callback.apply(ev.ctx,args);}};var listenMethods={listenTo:'on',listenToOnce:'once'};_.each(listenMethods,function(implementation,method){Events[method]=function(obj,name,callback){var listeningTo=this._listeningTo||(this._listeningTo={});var id=obj._listenId||(obj._listenId=_.uniqueId('l'));listeningTo[id]=obj;if(!callback&&typeof name==='object')callback=this;obj[implementation](name,callback,this);return this;};});Events.bind=Events.on;Events.unbind=Events.off;_.extend(Backbone,Events);var Model=Backbone.Model=function(attributes,options){var attrs=attributes||{};options||(options={});this.cid=_.uniqueId('c');this.attributes={};if(options.collection)this.collection=options.collection;if(options.parse)attrs=this.parse(attrs,options)||{};attrs=_.defaults({},attrs,_.result(this,'defaults'));this.set(attrs,options);this.changed={};this.initialize.apply(this,arguments);};_.extend(Model.prototype,Events,{changed:null,validationError:null,idAttribute:'id',initialize:function(){},toJSON:function(options){return _.clone(this.attributes);},sync:function(){return Backbone.sync.apply(this,arguments);},get:function(attr){return this.attributes[attr];},escape:function(attr){return _.escape(this.get(attr));},has:function(attr){return this.get(attr)!=null;},set:function(key,val,options){var attr,attrs,unset,changes,silent,changing,prev,current;if(key==null)return this;if(typeof key==='object'){attrs=key;options=val;}else{(attrs={})[key]=val;}
options||(options={});if(!this._validate(attrs,options))return false;unset=options.unset;silent=options.silent;changes=[];changing=this._changing;this._changing=true;if(!changing){this._previousAttributes=_.clone(this.attributes);this.changed={};}
current=this.attributes,prev=this._previousAttributes;if(this.idAttribute in attrs)this.id=attrs[this.idAttribute];for(attr in attrs){val=attrs[attr];if(!_.isEqual(current[attr],val))changes.push(attr);if(!_.isEqual(prev[attr],val)){this.changed[attr]=val;}else{delete this.changed[attr];}
unset?delete current[attr]:current[attr]=val;}
if(!silent){if(changes.length)this._pending=true;for(var i=0,l=changes.length;i<l;i++){this.trigger('change:'+changes[i],this,current[changes[i]],options);}}
if(changing)return this;if(!silent){while(this._pending){this._pending=false;this.trigger('change',this,options);}}
this._pending=false;this._changing=false;return this;},unset:function(attr,options){return this.set(attr,void 0,_.extend({},options,{unset:true}));},clear:function(options){var attrs={};for(var key in this.attributes)attrs[key]=void 0;return this.set(attrs,_.extend({},options,{unset:true}));},hasChanged:function(attr){if(attr==null)return!_.isEmpty(this.changed);return _.has(this.changed,attr);},changedAttributes:function(diff){if(!diff)return this.hasChanged()?_.clone(this.changed):false;var val,changed=false;var old=this._changing?this._previousAttributes:this.attributes;for(var attr in diff){if(_.isEqual(old[attr],(val=diff[attr])))continue;(changed||(changed={}))[attr]=val;}
return changed;},previous:function(attr){if(attr==null||!this._previousAttributes)return null;return this._previousAttributes[attr];},previousAttributes:function(){return _.clone(this._previousAttributes);},fetch:function(options){options=options?_.clone(options):{};if(options.parse===void 0)options.parse=true;var model=this;var success=options.success;options.success=function(resp){if(!model.set(model.parse(resp,options),options))return false;if(success)success(model,resp,options);model.trigger('sync',model,resp,options);};wrapError(this,options);return this.sync('read',this,options);},save:function(key,val,options){var attrs,method,xhr,attributes=this.attributes;if(key==null||typeof key==='object'){attrs=key;options=val;}else{(attrs={})[key]=val;}
options=_.extend({validate:true},options);if(attrs&&!options.wait){if(!this.set(attrs,options))return false;}else{if(!this._validate(attrs,options))return false;}
if(attrs&&options.wait){this.attributes=_.extend({},attributes,attrs);}
if(options.parse===void 0)options.parse=true;var model=this;var success=options.success;options.success=function(resp){model.attributes=attributes;var serverAttrs=model.parse(resp,options);if(options.wait)serverAttrs=_.extend(attrs||{},serverAttrs);if(_.isObject(serverAttrs)&&!model.set(serverAttrs,options)){return false;}
if(success)success(model,resp,options);model.trigger('sync',model,resp,options);};wrapError(this,options);method=this.isNew()?'create':(options.patch?'patch':'update');if(method==='patch')options.attrs=attrs;xhr=this.sync(method,this,options);if(attrs&&options.wait)this.attributes=attributes;return xhr;},destroy:function(options){options=options?_.clone(options):{};var model=this;var success=options.success;var destroy=function(){model.trigger('destroy',model,model.collection,options);};options.success=function(resp){if(options.wait||model.isNew())destroy();if(success)success(model,resp,options);if(!model.isNew())model.trigger('sync',model,resp,options);};if(this.isNew()){options.success();return false;}
wrapError(this,options);var xhr=this.sync('delete',this,options);if(!options.wait)destroy();return xhr;},url:function(){var base=_.result(this,'urlRoot')||_.result(this.collection,'url')||urlError();if(this.isNew())return base;return base+(base.charAt(base.length-1)==='/'?'':'/')+encodeURIComponent(this.id);},parse:function(resp,options){return resp;},clone:function(){return new this.constructor(this.attributes);},isNew:function(){return this.id==null;},isValid:function(options){return this._validate({},_.extend(options||{},{validate:true}));},_validate:function(attrs,options){if(!options.validate||!this.validate)return true;attrs=_.extend({},this.attributes,attrs);var error=this.validationError=this.validate(attrs,options)||null;if(!error)return true;this.trigger('invalid',this,error,_.extend(options,{validationError:error}));return false;}});var modelMethods=['keys','values','pairs','invert','pick','omit'];_.each(modelMethods,function(method){Model.prototype[method]=function(){var args=slice.call(arguments);args.unshift(this.attributes);return _[method].apply(_,args);};});var Collection=Backbone.Collection=function(models,options){options||(options={});if(options.model)this.model=options.model;if(options.comparator!==void 0)this.comparator=options.comparator;this._reset();this.initialize.apply(this,arguments);if(models)this.reset(models,_.extend({silent:true},options));};var setOptions={add:true,remove:true,merge:true};var addOptions={add:true,remove:false};_.extend(Collection.prototype,Events,{model:Model,initialize:function(){},toJSON:function(options){return this.map(function(model){return model.toJSON(options);});},sync:function(){return Backbone.sync.apply(this,arguments);},add:function(models,options){return this.set(models,_.extend({merge:false},options,addOptions));},remove:function(models,options){var singular=!_.isArray(models);models=singular?[models]:_.clone(models);options||(options={});var i,l,index,model;for(i=0,l=models.length;i<l;i++){model=models[i]=this.get(models[i]);if(!model)continue;delete this._byId[model.id];delete this._byId[model.cid];index=this.indexOf(model);this.models.splice(index,1);this.length--;if(!options.silent){options.index=index;model.trigger('remove',model,this,options);}
this._removeReference(model);}
return singular?models[0]:models;},set:function(models,options){options=_.defaults({},options,setOptions);if(options.parse)models=this.parse(models,options);var singular=!_.isArray(models);models=singular?(models?[models]:[]):_.clone(models);var i,l,id,model,attrs,existing,sort;var at=options.at;var targetModel=this.model;var sortable=this.comparator&&(at==null)&&options.sort!==false;var sortAttr=_.isString(this.comparator)?this.comparator:null;var toAdd=[],toRemove=[],modelMap={};var add=options.add,merge=options.merge,remove=options.remove;var order=!sortable&&add&&remove?[]:false;for(i=0,l=models.length;i<l;i++){attrs=models[i];if(attrs instanceof Model){id=model=attrs;}else{id=attrs[targetModel.prototype.idAttribute];}
if(existing=this.get(id)){if(remove)modelMap[existing.cid]=true;if(merge){attrs=attrs===model?model.attributes:attrs;if(options.parse)attrs=existing.parse(attrs,options);existing.set(attrs,options);if(sortable&&!sort&&existing.hasChanged(sortAttr))sort=true;}
models[i]=existing;}else if(add){model=models[i]=this._prepareModel(attrs,options);if(!model)continue;toAdd.push(model);model.on('all',this._onModelEvent,this);this._byId[model.cid]=model;if(model.id!=null)this._byId[model.id]=model;}
if(order)order.push(existing||model);}
if(remove){for(i=0,l=this.length;i<l;++i){if(!modelMap[(model=this.models[i]).cid])toRemove.push(model);}
if(toRemove.length)this.remove(toRemove,options);}
if(toAdd.length||(order&&order.length)){if(sortable)sort=true;this.length+=toAdd.length;if(at!=null){for(i=0,l=toAdd.length;i<l;i++){this.models.splice(at+i,0,toAdd[i]);}}else{if(order)this.models.length=0;var orderedModels=order||toAdd;for(i=0,l=orderedModels.length;i<l;i++){this.models.push(orderedModels[i]);}}}
if(sort)this.sort({silent:true});if(!options.silent){for(i=0,l=toAdd.length;i<l;i++){(model=toAdd[i]).trigger('add',model,this,options);}
if(sort||(order&&order.length))this.trigger('sort',this,options);}
return singular?models[0]:models;},reset:function(models,options){options||(options={});for(var i=0,l=this.models.length;i<l;i++){this._removeReference(this.models[i]);}
options.previousModels=this.models;this._reset();models=this.add(models,_.extend({silent:true},options));if(!options.silent)this.trigger('reset',this,options);return models;},push:function(model,options){return this.add(model,_.extend({at:this.length},options));},pop:function(options){var model=this.at(this.length-1);this.remove(model,options);return model;},unshift:function(model,options){return this.add(model,_.extend({at:0},options));},shift:function(options){var model=this.at(0);this.remove(model,options);return model;},slice:function(){return slice.apply(this.models,arguments);},get:function(obj){if(obj==null)return void 0;return this._byId[obj.id]||this._byId[obj.cid]||this._byId[obj];},at:function(index){return this.models[index];},where:function(attrs,first){if(_.isEmpty(attrs))return first?void 0:[];return this[first?'find':'filter'](function(model){for(var key in attrs){if(attrs[key]!==model.get(key))return false;}
return true;});},findWhere:function(attrs){return this.where(attrs,true);},sort:function(options){if(!this.comparator)throw new Error('Cannot sort a set without a comparator');options||(options={});if(_.isString(this.comparator)||this.comparator.length===1){this.models=this.sortBy(this.comparator,this);}else{this.models.sort(_.bind(this.comparator,this));}
if(!options.silent)this.trigger('sort',this,options);return this;},pluck:function(attr){return _.invoke(this.models,'get',attr);},fetch:function(options){options=options?_.clone(options):{};if(options.parse===void 0)options.parse=true;var success=options.success;var collection=this;options.success=function(resp){var method=options.reset?'reset':'set';collection[method](resp,options);if(success)success(collection,resp,options);collection.trigger('sync',collection,resp,options);};wrapError(this,options);return this.sync('read',this,options);},create:function(model,options){options=options?_.clone(options):{};if(!(model=this._prepareModel(model,options)))return false;if(!options.wait)this.add(model,options);var collection=this;var success=options.success;options.success=function(model,resp,options){if(options.wait)collection.add(model,options);if(success)success(model,resp,options);};model.save(null,options);return model;},parse:function(resp,options){return resp;},clone:function(){return new this.constructor(this.models);},_reset:function(){this.length=0;this.models=[];this._byId={};},_prepareModel:function(attrs,options){if(attrs instanceof Model){if(!attrs.collection)attrs.collection=this;return attrs;}
options=options?_.clone(options):{};options.collection=this;var model=new this.model(attrs,options);if(!model.validationError)return model;this.trigger('invalid',this,model.validationError,options);return false;},_removeReference:function(model){if(this===model.collection)delete model.collection;model.off('all',this._onModelEvent,this);},_onModelEvent:function(event,model,collection,options){if((event==='add'||event==='remove')&&collection!==this)return;if(event==='destroy')this.remove(model,options);if(model&&event==='change:'+model.idAttribute){delete this._byId[model.previous(model.idAttribute)];if(model.id!=null)this._byId[model.id]=model;}
this.trigger.apply(this,arguments);}});var methods=['forEach','each','map','collect','reduce','foldl','inject','reduceRight','foldr','find','detect','filter','select','reject','every','all','some','any','include','contains','invoke','max','min','toArray','size','first','head','take','initial','rest','tail','drop','last','without','difference','indexOf','shuffle','lastIndexOf','isEmpty','chain'];_.each(methods,function(method){Collection.prototype[method]=function(){var args=slice.call(arguments);args.unshift(this.models);return _[method].apply(_,args);};});var attributeMethods=['groupBy','countBy','sortBy'];_.each(attributeMethods,function(method){Collection.prototype[method]=function(value,context){var iterator=_.isFunction(value)?value:function(model){return model.get(value);};return _[method](this.models,iterator,context);};});var View=Backbone.View=function(options){this.cid=_.uniqueId('view');options||(options={});_.extend(this,_.pick(options,viewOptions));this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents();};var delegateEventSplitter=/^(\S+)\s*(.*)$/;var viewOptions=['model','collection','el','id','attributes','className','tagName','events'];_.extend(View.prototype,Events,{tagName:'div',$:function(selector){return this.$el.find(selector);},initialize:function(){},render:function(){return this;},remove:function(){this.$el.remove();this.stopListening();return this;},setElement:function(element,delegate){if(this.$el)this.undelegateEvents();this.$el=element instanceof Backbone.$?element:Backbone.$(element);this.el=this.$el[0];if(delegate!==false)this.delegateEvents();return this;},delegateEvents:function(events){if(!(events||(events=_.result(this,'events'))))return this;this.undelegateEvents();for(var key in events){var method=events[key];if(!_.isFunction(method))method=this[events[key]];if(!method)continue;var match=key.match(delegateEventSplitter);var eventName=match[1],selector=match[2];method=_.bind(method,this);eventName+='.delegateEvents'+this.cid;if(selector===''){this.$el.on(eventName,method);}else{this.$el.on(eventName,selector,method);}}
return this;},undelegateEvents:function(){this.$el.off('.delegateEvents'+this.cid);return this;},_ensureElement:function(){if(!this.el){var attrs=_.extend({},_.result(this,'attributes'));if(this.id)attrs.id=_.result(this,'id');if(this.className)attrs['class']=_.result(this,'className');var $el=Backbone.$('<'+_.result(this,'tagName')+'>').attr(attrs);this.setElement($el,false);}else{this.setElement(_.result(this,'el'),false);}}});Backbone.sync=function(method,model,options){var type=methodMap[method];_.defaults(options||(options={}),{emulateHTTP:Backbone.emulateHTTP,emulateJSON:Backbone.emulateJSON});var params={type:type,dataType:'json'};if(!options.url){params.url=_.result(model,'url')||urlError();}
if(options.data==null&&model&&(method==='create'||method==='update'||method==='patch')){params.contentType='application/json';params.data=JSON.stringify(options.attrs||model.toJSON(options));}
if(options.emulateJSON){params.contentType='application/x-www-form-urlencoded';params.data=params.data?{model:params.data}:{};}
if(options.emulateHTTP&&(type==='PUT'||type==='DELETE'||type==='PATCH')){params.type='POST';if(options.emulateJSON)params.data._method=type;var beforeSend=options.beforeSend;options.beforeSend=function(xhr){xhr.setRequestHeader('X-HTTP-Method-Override',type);if(beforeSend)return beforeSend.apply(this,arguments);};}
if(params.type!=='GET'&&!options.emulateJSON){params.processData=false;}
if(params.type==='PATCH'&&noXhrPatch){params.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP");};}
var xhr=options.xhr=Backbone.ajax(_.extend(params,options));model.trigger('request',model,xhr,options);return xhr;};var noXhrPatch=typeof window!=='undefined'&&!!window.ActiveXObject&&!(window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent);var methodMap={'create':'POST','update':'PUT','patch':'PATCH','delete':'DELETE','read':'GET'};Backbone.ajax=function(){return Backbone.$.ajax.apply(Backbone.$,arguments);};var Router=Backbone.Router=function(options){options||(options={});if(options.routes)this.routes=options.routes;this._bindRoutes();this.initialize.apply(this,arguments);};var optionalParam=/\((.*?)\)/g;var namedParam=/(\(\?)?:\w+/g;var splatParam=/\*\w+/g;var escapeRegExp=/[\-{}\[\]+?.,\\\^$|#\s]/g;_.extend(Router.prototype,Events,{initialize:function(){},route:function(route,name,callback){if(!_.isRegExp(route))route=this._routeToRegExp(route);if(_.isFunction(name)){callback=name;name='';}
if(!callback)callback=this[name];var router=this;Backbone.history.route(route,function(fragment){var args=router._extractParameters(route,fragment);callback&&callback.apply(router,args);router.trigger.apply(router,['route:'+name].concat(args));router.trigger('route',name,args);Backbone.history.trigger('route',router,name,args);});return this;},navigate:function(fragment,options){Backbone.history.navigate(fragment,options);return this;},_bindRoutes:function(){if(!this.routes)return;this.routes=_.result(this,'routes');var route,routes=_.keys(this.routes);while((route=routes.pop())!=null){this.route(route,this.routes[route]);}},_routeToRegExp:function(route){route=route.replace(escapeRegExp,'\\$&').replace(optionalParam,'(?:$1)?').replace(namedParam,function(match,optional){return optional?match:'([^\/]+)';}).replace(splatParam,'(.*?)');return new RegExp('^'+route+'$');},_extractParameters:function(route,fragment){var params=route.exec(fragment).slice(1);return _.map(params,function(param){return param?decodeURIComponent(param):null;});}});var History=Backbone.History=function(){this.handlers=[];_.bindAll(this,'checkUrl');if(typeof window!=='undefined'){this.location=window.location;this.history=window.history;}};var routeStripper=/^[#\/]|\s+$/g;var rootStripper=/^\/+|\/+$/g;var isExplorer=/msie [\w.]+/;var trailingSlash=/\/$/;var pathStripper=/[?#].*$/;History.started=false;_.extend(History.prototype,Events,{interval:50,getHash:function(window){var match=(window||this).location.href.match(/#(.*)$/);return match?match[1]:'';},getFragment:function(fragment,forcePushState){if(fragment==null){if(this._hasPushState||!this._wantsHashChange||forcePushState){fragment=this.location.pathname;var root=this.root.replace(trailingSlash,'');if(!fragment.indexOf(root))fragment=fragment.slice(root.length);}else{fragment=this.getHash();}}
return fragment.replace(routeStripper,'');},start:function(options){if(History.started)throw new Error("Backbone.history has already been started");History.started=true;this.options=_.extend({root:'/'},this.options,options);this.root=this.options.root;this._wantsHashChange=this.options.hashChange!==false;this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var fragment=this.getFragment();var docMode=document.documentMode;var oldIE=(isExplorer.exec(navigator.userAgent.toLowerCase())&&(!docMode||docMode<=7));this.root=('/'+this.root+'/').replace(rootStripper,'/');if(oldIE&&this._wantsHashChange){this.iframe=Backbone.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo('body')[0].contentWindow;this.navigate(fragment);}
if(this._hasPushState){Backbone.$(window).on('popstate',this.checkUrl);}else if(this._wantsHashChange&&('onhashchange'in window)&&!oldIE){Backbone.$(window).on('hashchange',this.checkUrl);}else if(this._wantsHashChange){this._checkUrlInterval=setInterval(this.checkUrl,this.interval);}
this.fragment=fragment;var loc=this.location;var atRoot=loc.pathname.replace(/[^\/]$/,'$&/')===this.root;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!atRoot){this.fragment=this.getFragment(null,true);this.location.replace(this.root+this.location.search+'#'+this.fragment);return true;}else if(this._hasPushState&&atRoot&&loc.hash){this.fragment=this.getHash().replace(routeStripper,'');this.history.replaceState({},document.title,this.root+this.fragment+loc.search);}}
if(!this.options.silent)return this.loadUrl();},stop:function(){Backbone.$(window).off('popstate',this.checkUrl).off('hashchange',this.checkUrl);clearInterval(this._checkUrlInterval);History.started=false;},route:function(route,callback){this.handlers.unshift({route:route,callback:callback});},checkUrl:function(e){var current=this.getFragment();if(current===this.fragment&&this.iframe){current=this.getFragment(this.getHash(this.iframe));}
if(current===this.fragment)return false;if(this.iframe)this.navigate(current);this.loadUrl();},loadUrl:function(fragment){fragment=this.fragment=this.getFragment(fragment);return _.any(this.handlers,function(handler){if(handler.route.test(fragment)){handler.callback(fragment);return true;}});},navigate:function(fragment,options){if(!History.started)return false;if(!options||options===true)options={trigger:!!options};var url=this.root+(fragment=this.getFragment(fragment||''));fragment=fragment.replace(pathStripper,'');if(this.fragment===fragment)return;this.fragment=fragment;if(fragment===''&&url!=='/')url=url.slice(0,-1);if(this._hasPushState){this.history[options.replace?'replaceState':'pushState']({},document.title,url);}else if(this._wantsHashChange){this._updateHash(this.location,fragment,options.replace);if(this.iframe&&(fragment!==this.getFragment(this.getHash(this.iframe)))){if(!options.replace)this.iframe.document.open().close();this._updateHash(this.iframe.location,fragment,options.replace);}}else{return this.location.assign(url);}
if(options.trigger)return this.loadUrl(fragment);},_updateHash:function(location,fragment,replace){if(replace){var href=location.href.replace(/(javascript:|#).*$/,'');location.replace(href+'#'+fragment);}else{location.hash='#'+fragment;}}});Backbone.history=new History;var extend=function(protoProps,staticProps){var parent=this;var child;if(protoProps&&_.has(protoProps,'constructor')){child=protoProps.constructor;}else{child=function(){return parent.apply(this,arguments);};}
_.extend(child,parent,staticProps);var Surrogate=function(){this.constructor=child;};Surrogate.prototype=parent.prototype;child.prototype=new Surrogate;if(protoProps)_.extend(child.prototype,protoProps);child.__super__=parent.prototype;return child;};Model.extend=Collection.extend=Router.extend=View.extend=History.extend=extend;var urlError=function(){throw new Error('A "url" property or function must be specified');};var wrapError=function(model,options){var error=options.error;options.error=function(resp){if(error)error(model,resp,options);model.trigger('error',model,resp,options);};};}).call(this);;

/* <inline asset> defined in bundle 'web.assets_backend' */
odoo._modules=["web","web_kanban","base","web_char_trim","web_to_upper","report","web_highstock","web_tree_field_color","web_float_time_seconds","web_openprod","document","binary_attachment","base_openprod","board","account","l10n_ma","calendar","jasper_server","web_tip","web_calendar","calendar_event","web_editor","bank_reconcile","web_charts","stock","base_import","report_xls","web_kanban_gauge","web_view_editor","web_diagram","mrp","web_export_view"];;

/* /web/static/lib/py.js/lib/py.js defined in bundle 'web.assets_backend' */
var py={};(function(py){var create=function(o,props){function F(){}
F.prototype=o;var inst=new F;if(props){for(var name in props){if(!props.hasOwnProperty(name)){continue;}
inst[name]=props[name];}}
return inst;};var symbols={};var comparators={};var Base={nud:function(){throw new Error(this.id+" undefined as prefix");},led:function(led){throw new Error(this.id+" undefined as infix");},toString:function(){if(this.id==='(constant)'||this.id==='(number)'||this.id==='(name)'||this.id==='(string)'){return[this.id.slice(0,this.id.length-1),' ',this.value,')'].join('');}else if(this.id==='(end)'){return'(end)';}else if(this.id==='(comparator)'){var repr=['(comparator',this.expressions[0]];for(var i=0;i<this.operators.length;++i){repr.push(this.operators[i],this.expressions[i+1]);}
return repr.join(' ')+')';}
var out=[this.id,this.first,this.second,this.third].filter(function(r){return r}).join(' ');return'('+out+')';}};function symbol(id,bp){bp=bp||0;var s=symbols[id];if(s){if(bp>s.lbp){s.lbp=bp;}
return s;}
return symbols[id]=create(Base,{id:id,lbp:bp});}
function constant(id){var s=symbol(id);s.id='(constant)';s.value=id;s.nud=function(){return this;};}
function prefix(id,bp,nud){symbol(id).nud=nud||function(){this.first=expression(bp);return this}}
function infix(id,bp,led){symbol(id,bp).led=led||function(left){this.first=left;this.second=expression(bp);return this;}}
function infixr(id,bp){symbol(id,bp).led=function(left){this.first=left;this.second=expression(bp-1);return this;}}
function comparator(id){comparators[id]=true;var bp=60;infix(id,bp,function(left){this.id='(comparator)';this.operators=[id];this.expressions=[left,expression(bp)];while(token.id in comparators){this.operators.push(token.id);advance();this.expressions.push(expression(bp));}
return this;});}
constant('None');constant('False');constant('True');symbol('(number)').nud=function(){return this;};symbol('(name)').nud=function(){return this;};symbol('(string)').nud=function(){return this;};symbol('(end)');symbol(':');symbol(')');symbol(']');symbol('}');symbol(',');symbol('else');infix('=',10,function(left){if(left.id!=='(name)'){throw new Error("Expected keyword argument name, got "+token.id);}
this.first=left;this.second=expression();return this;});symbol('lambda',20).nud=function(){this.first=[];if(token.id!==':'){for(;;){if(token.id!=='(name)'){throw new Error('Excepted an argument name');}
this.first.push(token);advance();if(token.id!==','){break;}
advance(',');}}
advance(':');this.second=expression();return this;};infix('if',20,function(left){this.first=left;this.second=expression();advance('else');this.third=expression();return this;});infixr('or',30);infixr('and',40);prefix('not',50);comparator('in');comparator('not in');comparator('is');comparator('is not');comparator('<');comparator('<=');comparator('>');comparator('>=');comparator('<>');comparator('!=');comparator('==');infix('|',70);infix('^',80);infix('&',90);infix('<<',100);infix('>>',100);infix('+',110);infix('-',110);infix('*',120);infix('/',120);infix('//',120);infix('%',120);prefix('-',130);prefix('+',130);prefix('~',130);infixr('**',140);infix('.',150,function(left){if(token.id!=='(name)'){throw new Error('Expected attribute name, got '+token.id);}
this.first=left;this.second=token;advance();return this;});symbol('(',150).nud=function(){this.first=[];var comma=false;if(token.id!==')'){while(true){if(token.id===')'){break;}
this.first.push(expression());if(token.id!==','){break;}
comma=true;advance(',');}}
advance(')');if(!this.first.length||comma){return this;}else{return this.first[0];}};symbol('(').led=function(left){this.first=left;this.second=[];if(token.id!==")"){for(;;){this.second.push(expression());if(token.id!==','){break;}
advance(',');}}
advance(")");return this;};infix('[',150,function(left){this.first=left;this.second=expression();advance("]");return this;});symbol('[').nud=function(){this.first=[];if(token.id!==']'){for(;;){if(token.id===']'){break;}
this.first.push(expression());if(token.id!==','){break;}
advance(',');}}
advance(']');return this;};symbol('{').nud=function(){this.first=[];if(token.id!=='}'){for(;;){if(token.id==='}'){break;}
var key=expression();advance(':');var value=expression();this.first.push([key,value]);if(token.id!==','){break;}
advance(',');}}
advance('}');return this;};py.tokenize=(function(){function group(){return'('+Array.prototype.join.call(arguments,'|')+')';}
var Whitespace='[ \\f\\t]*';var Name='[a-zA-Z_]\\w*';var DecNumber='\\d+(L|l)?';var IntNumber=DecNumber;var PointFloat=group('\\d+\\.\\d*','\\.\\d+');var FloatNumber=PointFloat;var Number=group(FloatNumber,IntNumber);var Operator=group("\\*\\*=?",">>=?","<<=?","<>","!=","//=?","[+\\-*/%&|^=<>]=?","~");var Bracket='[\\[\\]\\(\\)\\{\\}]';var Special='[:;.,`@]';var Funny=group(Operator,Bracket,Special);var ContStr=group("([uU])?'([^']*)'",'([uU])?"([^"]*)"');var PseudoToken=Whitespace+group(Number,Funny,ContStr,Name);var number_pattern=new RegExp('^'+Number+'$');var string_pattern=new RegExp('^'+ContStr+'$');var name_pattern=new RegExp('^'+Name+'$');var strip=new RegExp('^'+Whitespace);return function tokenize(s){var max=s.length,tokens=[],start,end=undefined;var pseudoprog=new RegExp(PseudoToken,'g');while(pseudoprog.lastIndex<max){var pseudomatch=pseudoprog.exec(s);if(!pseudomatch){if(/^\s+$/.test(s.slice(end))){break;}
throw new Error('Failed to tokenize <<'+s
+'>> at index '+(end||0)
+'; parsed so far: '+tokens);}
start=pseudomatch.index;end=pseudoprog.lastIndex;var token=s.slice(start,end).replace(strip,'');var initial=token[0];if(number_pattern.test(token)){tokens.push(create(symbols['(number)'],{value:parseFloat(token)}));}else if(string_pattern.test(token)){var m=string_pattern.exec(token);tokens.push(create(symbols['(string)'],{unicode:!!(m[2]||m[4]),value:(m[3]!==undefined?m[3]:m[5])}));}else if(token in symbols){var symbol;if(token==='in'&&tokens.length>1&&tokens[tokens.length-1].id==='not'){symbol=symbols['not in'];tokens.pop();}else if(token==='not'&&tokens.length>1&&tokens[tokens.length-1].id==='is'){symbol=symbols['is not'];tokens.pop();}else{symbol=symbols[token];}
tokens.push(create(symbol));}else if(name_pattern.test(token)){tokens.push(create(symbols['(name)'],{value:token}));}else{throw new Error("Tokenizing failure of <<"+s+">> at index "+start
+" for token [["+token+"]]"
+"; parsed so far: "+tokens);}}
tokens.push(create(symbols['(end)']));return tokens;}})();var token,next;function expression(rbp){rbp=rbp||0;var t=token;token=next();var left=t.nud();while(rbp<token.lbp){t=token;token=next();left=t.led(left);}
return left;}
function advance(id){if(id&&token.id!==id){throw new Error('Expected "'+id+'", got "'+token.id+'"');}
token=next();}
function PY_ensurepy(val,name){switch(val){case undefined:throw new Error("NameError: name '"+name+"' is not defined");case null:return py.None;case true:return py.True;case false:return py.False;}
var fn=function(){};fn.prototype=py.object;if(py.PY_isInstance(val,py.object)||py.PY_isSubclass(val,py.object)){return val;}
switch(typeof val){case'number':return py.float.fromJSON(val);case'string':return py.str.fromJSON(val);case'function':return py.PY_def.fromJSON(val);}
switch(val.constructor){case Object:var o=py.PY_call(py.object);for(var prop in val){if(val.hasOwnProperty(prop)){o[prop]=val[prop];}}
return o;case Array:return py.list.fromJSON(val);}
throw new Error("Could not convert "+val+" to a pyval");}
var typename=function(obj){if(obj.__class__){return obj.__class__.__name__;}else if(typeof obj!=='object'){return typeof obj;}else{return obj.constructor.name;}};py.py={};py.PY_parseArgs=function PY_parseArgs(argument,format){var out={};var args=argument[0];var kwargs={};for(var k in argument[1]){if(!argument[1].hasOwnProperty(k)){continue;}
kwargs[k]=argument[1][k];}
if(typeof format==='string'){format=format.split(/\s+/);}
var name=function(spec){if(typeof spec==='string'){return spec;}else if(spec instanceof Array&&spec.length===2){return spec[0];}
throw new Error("TypeError: unknown format specification "+
JSON.stringify(spec));};var spec;for(var i=0;i<args.length;++i){spec=format[i];if(!spec||spec==='*'){throw new Error("TypeError: function takes exactly "+(i-1)+" positional arguments ("+args.length+" given")}else if(/^\*\w/.test(spec)){out[name(spec.slice(1))]=args.slice(i);break;}
out[name(spec)]=args[i];}
for(var j=i;j<format.length;++j){spec=format[j];var n=name(spec);if(n in out){throw new Error("TypeError: function got multiple values "+"for keyword argument '"+kwarg+"'");}
if(/^\*\*\w/.test(n)){out[n.slice(2)]=kwargs;kwargs={};break;}
if(n in kwargs){out[n]=kwargs[n];delete kwargs[n];}}
for(var key in kwargs){throw new Error("TypeError: function got an unexpected keyword argument '"
+key+"'");}
var kwonly=0;for(var k=0;k<format.length;++k){if(/^\*/.test(format[k])){kwonly=1;break;}}
for(var k=0;k<format.length;++k){spec=format[k];var n=name(spec);if(/^\*/.test(n)||n in out){continue;}
if(!(spec instanceof Array)){throw new Error("TypeError: function takes exactly "+(format.length-kwonly)
+" arguments");}
out[n]=spec[1];}
return out;};py.PY_hasAttr=function(o,attr_name){try{py.PY_getAttr(o,attr_name);return true;}catch(e){return false;}};py.PY_getAttr=function(o,attr_name){return PY_ensurepy(o.__getattribute__(attr_name));};py.PY_str=function(o){var v=o.__str__();if(py.PY_isInstance(v,py.str)){return v;}
throw new Error('TypeError: __str__ returned non-string (type '
+typename(v)
+')');};py.PY_isInstance=function(inst,cls){var fn=function(){};fn.prototype=cls;return inst instanceof fn;};py.PY_isSubclass=function(derived,cls){var fn=function(){};fn.prototype=cls;return derived===cls||derived instanceof fn;};py.PY_call=function(callable,args,kwargs){if(!args){args=[];}
if(typeof args==='object'&&!(args instanceof Array)){kwargs=args;args=[];}
if(!kwargs){kwargs={};}
if(callable.__is_type){var instance=callable.__new__.call(callable,args,kwargs);var typ=function(){};typ.prototype=callable;if(instance instanceof typ){instance.__init__.call(instance,args,kwargs);}
return instance}
return callable.__call__(args,kwargs);};py.PY_isTrue=function(o){var res=o.__nonzero__();if(res===py.True){return true;}
if(res===py.False){return false;}
throw new Error("TypeError: __nonzero__ should return bool, returned "
+typename(res));};py.PY_not=function(o){return!py.PY_isTrue(o);};py.PY_size=function(o){if(!o.__len__){throw new Error("TypeError: object of type '"+
typename(o)+"' has no len()");}
var v=o.__len__();if(typeof v!=='number'){throw new Error("TypeError: a number is required");}
return v;};py.PY_getItem=function(o,key){if(!('__getitem__'in o)){throw new Error("TypeError: '"+typename(o)+"' object is unsubscriptable")}
if(!py.PY_isInstance(key,py.object)){throw new Error("TypeError: '"+typename(key)+"' is not a py.js object");}
var res=o.__getitem__(key);if(!py.PY_isInstance(key,py.object)){throw new Error("TypeError: __getitem__ must return a py.js object, got "
+typename(res));}
return res;};py.PY_setItem=function(o,key,v){if(!('__setitem__'in o)){throw new Error("TypeError: '"+typename(o)+"' object does not support item assignment");}
if(!py.PY_isInstance(key,py.object)){throw new Error("TypeError: '"+typename(key)+"' is not a py.js object");}
if(!py.PY_isInstance(v,py.object)){throw new Error("TypeError: '"+typename(v)+"' is not a py.js object");}
o.__setitem__(key,v);};py.PY_add=function(o1,o2){return PY_op(o1,o2,'+');};py.PY_subtract=function(o1,o2){return PY_op(o1,o2,'-');};py.PY_multiply=function(o1,o2){return PY_op(o1,o2,'*');};py.PY_divide=function(o1,o2){return PY_op(o1,o2,'/');};py.PY_negative=function(o){if(!o.__neg__){throw new Error("TypeError: bad operand for unary -: '"
+typename(o)
+"'");}
return o.__neg__();};py.PY_positive=function(o){if(!o.__pos__){throw new Error("TypeError: bad operand for unary +: '"
+typename(o)
+"'");}
return o.__pos__();};py.type=function type(name,bases,dict){if(typeof name!=='string'){throw new Error("ValueError: a class name should be a string");}
if(!bases||bases.length===0){bases=[py.object];}else if(bases.length>1){throw new Error("ValueError: can't provide multiple bases for a "
+"new type");}
var base=bases[0];var ClassObj=create(base);if(dict){for(var k in dict){if(!dict.hasOwnProperty(k)){continue;}
ClassObj[k]=dict[k];}}
ClassObj.__class__=ClassObj;ClassObj.__name__=name;ClassObj.__bases__=bases;ClassObj.__is_type=true;return ClassObj;};py.type.__call__=function(){var args=py.PY_parseArgs(arguments,['object']);return args.object.__class__;};var hash_counter=0;py.object=py.type('object',[{}],{__new__:function(){var inst=create(this);inst.__is_type=false;return inst;},__init__:function(){},__hash__:function(){if(this._hash){return this._hash;}
return this._hash='\0\0\0'+String(hash_counter++);},__eq__:function(other){return(this===other)?py.True:py.False;},__ne__:function(other){if(py.PY_isTrue(this.__eq__(other))){return py.False;}else{return py.True;}},__lt__:function(){return py.NotImplemented;},__le__:function(){return py.NotImplemented;},__ge__:function(){return py.NotImplemented;},__gt__:function(){return py.NotImplemented;},__str__:function(){return this.__unicode__();},__unicode__:function(){return py.str.fromJSON('<'+typename(this)+' object>');},__nonzero__:function(){return py.True;},__getattribute__:function(name){if(name in this){var val=this[name];if(typeof val==='object'&&'__get__'in val){return val.__get__(this,py.PY_call(py.type,[this]));}
if(typeof val==='function'&&!this.hasOwnProperty(name)){return PY_instancemethod.fromJSON(val,this);}
return val;}
if('__getattr__'in this){return this.__getattr__(name);}
throw new Error("AttributeError: object has no attribute '"+name+"'");},__setattr__:function(name,value){if(name in this&&'__set__'in this[name]){this[name].__set__(this,value);}
this[name]=value;},toJSON:function(){throw new Error(this.constructor.name+' can not be converted to JSON');}});var NoneType=py.type('NoneType',null,{__nonzero__:function(){return py.False;},toJSON:function(){return null;}});py.None=py.PY_call(NoneType);var NotImplementedType=py.type('NotImplementedType',null,{});py.NotImplemented=py.PY_call(NotImplementedType);var booleans_initialized=false;py.bool=py.type('bool',null,{__new__:function(){if(!booleans_initialized){return py.object.__new__.apply(this);}
var ph={};var args=py.PY_parseArgs(arguments,[['value',ph]]);if(args.value===ph){return py.False;}
return py.PY_isTrue(args.value)?py.True:py.False;},__str__:function(){return py.str.fromJSON((this===py.True)?"True":"False");},__nonzero__:function(){return this;},fromJSON:function(val){return val?py.True:py.False},toJSON:function(){return this===py.True;}});py.True=py.PY_call(py.bool);py.False=py.PY_call(py.bool);booleans_initialized=true;py.float=py.type('float',null,{__init__:function(){var placeholder={};var args=py.PY_parseArgs(arguments,[['value',placeholder]]);var value=args.value;if(value===placeholder){this._value=0;return;}
if(py.PY_isInstance(value,py.float)){this._value=value._value;}
if(py.PY_isInstance(value,py.object)&&'__float__'in value){var res=value.__float__();if(py.PY_isInstance(res,py.float)){this._value=res._value;return;}
throw new Error('TypeError: __float__ returned non-float (type '+
typename(res)+')');}
throw new Error('TypeError: float() argument must be a string or a number');},__str__:function(){return py.str.fromJSON(String(this._value));},__eq__:function(other){return this._value===other._value?py.True:py.False;},__lt__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return this._value<other._value?py.True:py.False;},__le__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return this._value<=other._value?py.True:py.False;},__gt__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return this._value>other._value?py.True:py.False;},__ge__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return this._value>=other._value?py.True:py.False;},__abs__:function(){return py.float.fromJSON(Math.abs(this._value));},__add__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return py.float.fromJSON(this._value+other._value);},__neg__:function(){return py.float.fromJSON(-this._value);},__sub__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return py.float.fromJSON(this._value-other._value);},__mul__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return py.float.fromJSON(this._value*other._value);},__div__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return py.float.fromJSON(this._value/other._value);},__nonzero__:function(){return this._value?py.True:py.False;},fromJSON:function(v){if(!(typeof v==='number')){throw new Error('py.float.fromJSON can only take numbers');}
var instance=py.PY_call(py.float);instance._value=v;return instance;},toJSON:function(){return this._value;}});py.str=py.type('str',null,{__init__:function(){var placeholder={};var args=py.PY_parseArgs(arguments,[['value',placeholder]]);var s=args.value;if(s===placeholder){this._value='';return;}
this._value=py.PY_str(s)._value;},__hash__:function(){return'\1\0\1'+this._value;},__str__:function(){return this;},__eq__:function(other){if(py.PY_isInstance(other,py.str)&&this._value===other._value){return py.True;}
return py.False;},__lt__:function(other){if(py.PY_not(py.PY_call(py.isinstance,[other,py.str]))){return py.NotImplemented;}
return this._value<other._value?py.True:py.False;},__le__:function(other){if(!py.PY_isInstance(other,py.str)){return py.NotImplemented;}
return this._value<=other._value?py.True:py.False;},__gt__:function(other){if(!py.PY_isInstance(other,py.str)){return py.NotImplemented;}
return this._value>other._value?py.True:py.False;},__ge__:function(other){if(!py.PY_isInstance(other,py.str)){return py.NotImplemented;}
return this._value>=other._value?py.True:py.False;},__add__:function(other){if(!py.PY_isInstance(other,py.str)){return py.NotImplemented;}
return py.str.fromJSON(this._value+other._value);},__nonzero__:function(){return this._value.length?py.True:py.False;},__contains__:function(s){return(this._value.indexOf(s._value)!==-1)?py.True:py.False;},fromJSON:function(s){if(typeof s==='string'){var instance=py.PY_call(py.str);instance._value=s;return instance;}
throw new Error("str.fromJSON can only take strings");},toJSON:function(){return this._value;}});py.tuple=py.type('tuple',null,{__init__:function(){this._values=[];},__len__:function(){return this._values.length;},__nonzero__:function(){return py.PY_size(this)>0?py.True:py.False;},__contains__:function(value){for(var i=0,len=this._values.length;i<len;++i){if(py.PY_isTrue(this._values[i].__eq__(value))){return py.True;}}
return py.False;},__getitem__:function(index){return this._values[index.toJSON()];},toJSON:function(){var out=[];for(var i=0;i<this._values.length;++i){out.push(this._values[i].toJSON());}
return out;},fromJSON:function(ar){if(!(ar instanceof Array)){throw new Error("Can only create a py.tuple from an Array");}
var t=py.PY_call(py.tuple);for(var i=0;i<ar.length;++i){t._values.push(PY_ensurepy(ar[i]));}
return t;}});py.list=py.type('list',null,{__nonzero__:function(){return this.__len__>0?py.True:py.False;},});_.defaults(py.list,py.tuple)
py.dict=py.type('dict',null,{__init__:function(){this._store={};},__getitem__:function(key){var h=key.__hash__();if(!(h in this._store)){throw new Error("KeyError: '"+key.toJSON()+"'");}
return this._store[h][1];},__setitem__:function(key,value){this._store[key.__hash__()]=[key,value];},__len__:function(){return Object.keys(this._store).length},__nonzero__:function(){return py.PY_size(this)>0?py.True:py.False;},get:function(){var args=py.PY_parseArgs(arguments,['k',['d',py.None]]);var h=args.k.__hash__();if(!(h in this._store)){return args.d;}
return this._store[h][1];},fromJSON:function(d){var instance=py.PY_call(py.dict);for(var k in(d||{})){if(!d.hasOwnProperty(k)){continue;}
instance.__setitem__(py.str.fromJSON(k),PY_ensurepy(d[k]));}
return instance;},toJSON:function(){var out={};for(var k in this._store){var item=this._store[k];out[item[0].toJSON()]=item[1].toJSON();}
return out;}});py.PY_def=py.type('function',null,{__call__:function(){return this._func.apply(this._inst,arguments);},fromJSON:function(nativefunc){var instance=py.PY_call(py.PY_def);instance._inst=null;instance._func=nativefunc;return instance;},toJSON:function(){return this._func;}});py.classmethod=py.type('classmethod',null,{__init__:function(){var args=py.PY_parseArgs(arguments,'function');this._func=args['function'];},__get__:function(obj,type){return PY_instancemethod.fromJSON(this._func,type);},fromJSON:function(func){return py.PY_call(py.classmethod,[func]);}});var PY_instancemethod=py.type('instancemethod',[py.PY_def],{fromJSON:function(nativefunc,instance){var inst=py.PY_call(PY_instancemethod);inst._inst=instance;inst._func=nativefunc;return inst;}});py.abs=new py.PY_def.fromJSON(function abs(){var args=py.PY_parseArgs(arguments,['number']);if(!args.number.__abs__){throw new Error("TypeError: bad operand type for abs(): '"
+typename(args.number)
+"'");}
return args.number.__abs__();});py.len=new py.PY_def.fromJSON(function len(){var args=py.PY_parseArgs(arguments,['object']);return py.float.fromJSON(py.PY_size(args.object));});py.isinstance=new py.PY_def.fromJSON(function isinstance(){var args=py.PY_parseArgs(arguments,['object','class']);return py.PY_isInstance(args.object,args['class'])?py.True:py.False;});py.issubclass=new py.PY_def.fromJSON(function issubclass(){var args=py.PY_parseArgs(arguments,['C','B']);return py.PY_isSubclass(args.C,args.B)?py.True:py.False;});var PY_decode_string_literal=function(str,unicode){var out=[],code;var direct_map={'\\':'\\','"':'"',"'":"'",'a':'\x07','b':'\x08','f':'\x0c','n':'\n','r':'\r','t':'\t','v':'\v'};for(var i=0;i<str.length;++i){if(str[i]!=='\\'){out.push(str[i]);continue;}
var escape=str[i+1];if(escape in direct_map){out.push(direct_map[escape]);++i;continue;}
switch(escape){case'\n':++i;continue;case'N':if(!unicode){break;}
throw Error("SyntaxError: \\N{} escape not implemented");case'u':if(!unicode){break;}
var uni=str.slice(i+2,i+6);if(!/[0-9a-f]{4}/i.test(uni)){throw new Error(["SyntaxError: (unicode error) 'unicodeescape' codec"," can't decode bytes in position ",i,"-",i+4,": truncated \\uXXXX escape"].join(''));}
code=parseInt(uni,16);out.push(String.fromCharCode(code));i+=5;continue;case'U':if(!unicode){break;}
throw Error("SyntaxError: \\U escape not implemented");case'x':var hex=str.slice(i+2,i+4);if(!/[0-9a-f]{2}/i.test(hex)){if(!unicode){throw new Error('ValueError: invalid \\x escape');}
throw new Error(["SyntaxError: (unicode error) 'unicodeescape'"," codec can't decode bytes in position ",i,'-',i+2,": truncated \\xXX escape"].join(''))}
code=parseInt(hex,16);out.push(String.fromCharCode(code));i+=3;continue;default:if(!/[0-8]/.test(escape)){break;}
var r=/[0-8]{1,3}/g;r.lastIndex=i+1;var m=r.exec(str);var oct=m[0];code=parseInt(oct,8);out.push(String.fromCharCode(code));i+=oct.length;continue;}
out.push('\\');}
return out.join('');};var PY_operators={'==':['eq','eq',function(a,b){return a===b;}],'!=':['ne','ne',function(a,b){return a!==b;}],'<>':['ne','ne',function(a,b){return a!==b;}],'<':['lt','gt',function(a,b){return a.__class__.__name__<b.__class__.__name__;}],'<=':['le','ge',function(a,b){return a.__class__.__name__<=b.__class__.__name__;}],'>':['gt','lt',function(a,b){return a.__class__.__name__>b.__class__.__name__;}],'>=':['ge','le',function(a,b){return a.__class__.__name__>=b.__class__.__name__;}],'+':['add','radd'],'-':['sub','rsub'],'*':['mul','rmul'],'/':['div','rdiv'],'//':['floordiv','rfloordiv'],'%':['mod','rmod'],'**':['pow','rpow'],'<<':['lshift','rlshift'],'>>':['rshift','rrshift'],'&':['and','rand'],'^':['xor','rxor'],'|':['or','ror']};var PY_op=function(o1,o2,op){var r;var methods=PY_operators[op];var forward='__'+methods[0]+'__',reverse='__'+methods[1]+'__';var otherwise=methods[2];if(forward in o1&&(r=o1[forward](o2))!==py.NotImplemented){return r;}
if(reverse in o2&&(r=o2[reverse](o1))!==py.NotImplemented){return r;}
if(otherwise){return PY_ensurepy(otherwise(o1,o2));}
throw new Error("TypeError: unsupported operand type(s) for "+op+": '"
+typename(o1)+"' and '"+typename(o2)+"'");};var PY_builtins={type:py.type,None:py.None,True:py.True,False:py.False,NotImplemented:py.NotImplemented,object:py.object,bool:py.bool,float:py.float,str:py.str,unicode:py.unicode,tuple:py.tuple,list:py.list,dict:py.dict,abs:py.abs,len:py.len,isinstance:py.isinstance,issubclass:py.issubclass,classmethod:py.classmethod,};py.parse=function(toks){var index=0;token=toks[0];next=function(){return toks[++index];};return expression();};var evaluate_operator=function(operator,a,b){switch(operator){case'is':return a===b?py.True:py.False;case'is not':return a!==b?py.True:py.False;case'in':return b.__contains__(a);case'not in':return py.PY_isTrue(b.__contains__(a))?py.False:py.True;case'==':case'!=':case'<>':case'<':case'<=':case'>':case'>=':return PY_op(a,b,operator);}
throw new Error('SyntaxError: unknown comparator [['+operator+']]');};py.evaluate=function(expr,context){context=context||{};switch(expr.id){case'(name)':var val=context[expr.value];if(val===undefined&&expr.value in PY_builtins){return PY_builtins[expr.value];}
return PY_ensurepy(val,expr.value);case'(string)':return py.str.fromJSON(PY_decode_string_literal(expr.value,expr.unicode));case'(number)':return py.float.fromJSON(expr.value);case'(constant)':switch(expr.value){case'None':return py.None;case'False':return py.False;case'True':return py.True;}
throw new Error("SyntaxError: unknown constant '"+expr.value+"'");case'(comparator)':var result,left=py.evaluate(expr.expressions[0],context);for(var i=0;i<expr.operators.length;++i){result=evaluate_operator(expr.operators[i],left,left=py.evaluate(expr.expressions[i+1],context));if(py.PY_not(result)){return py.False;}}
return py.True;case'not':return py.PY_isTrue(py.evaluate(expr.first,context))?py.False:py.True;case'and':var and_first=py.evaluate(expr.first,context);if(py.PY_isTrue(and_first.__nonzero__())){return py.evaluate(expr.second,context);}
return and_first;case'or':var or_first=py.evaluate(expr.first,context);if(py.PY_isTrue(or_first.__nonzero__())){return or_first}
return py.evaluate(expr.second,context);case'(':if(expr.second){var callable=py.evaluate(expr.first,context);var args=[],kwargs={};for(var jj=0;jj<expr.second.length;++jj){var arg=expr.second[jj];if(arg.id!=='='){args.push(py.evaluate(arg,context));}else{kwargs[arg.first.value]=py.evaluate(arg.second,context);}}
return py.PY_call(callable,args,kwargs);}
var tuple_exprs=expr.first,tuple_values=[];for(var j=0,len=tuple_exprs.length;j<len;++j){tuple_values.push(py.evaluate(tuple_exprs[j],context));}
return py.tuple.fromJSON(tuple_values);case'[':if(expr.second){return py.PY_getItem(py.evaluate(expr.first,context),py.evaluate(expr.second,context));}
var list_exprs=expr.first,list_values=[];for(var k=0;k<list_exprs.length;++k){list_values.push(py.evaluate(list_exprs[k],context));}
return py.list.fromJSON(list_values);case'{':var dict_exprs=expr.first,dict=py.PY_call(py.dict);for(var l=0;l<dict_exprs.length;++l){py.PY_setItem(dict,py.evaluate(dict_exprs[l][0],context),py.evaluate(dict_exprs[l][1],context));}
return dict;case'.':if(expr.second.id!=='(name)'){throw new Error('SyntaxError: '+expr);}
return py.PY_getAttr(py.evaluate(expr.first,context),expr.second.value);case'~':return(py.evaluate(expr.first,context)).__invert__();case'+':if(!expr.second){return py.PY_positive(py.evaluate(expr.first,context));}
case'-':if(!expr.second){return py.PY_negative(py.evaluate(expr.first,context));}
case'*':case'/':case'//':case'%':case'**':case'<<':case'>>':case'&':case'^':case'|':return PY_op(py.evaluate(expr.first,context),py.evaluate(expr.second,context),expr.id);default:throw new Error('SyntaxError: Unknown node [['+expr.id+']]');}};py.eval=function(str,context){return py.evaluate(py.parse(py.tokenize(str)),context).toJSON();}})(typeof exports==='undefined'?py:exports);;

/* /web/static/lib/jquery.ba-bbq/jquery.ba-bbq.js defined in bundle 'web.assets_backend' */
(function($,window){'$:nomunge';var undefined,aps=Array.prototype.slice,decode=decodeURIComponent,jq_param=$.param,jq_param_sorted,jq_param_fragment,jq_deparam,jq_deparam_fragment,jq_bbq=$.bbq=$.bbq||{},jq_bbq_pushState,jq_bbq_getState,jq_elemUrlAttr,special=$.event.special,str_hashchange='hashchange',str_querystring='querystring',str_fragment='fragment',str_elemUrlAttr='elemUrlAttr',str_href='href',str_src='src',re_params_querystring=/^.*\?|#.*$/g,re_params_fragment,re_fragment,re_no_escape,ajax_crawlable,fragment_prefix,elemUrlAttr_cache={};function is_string(arg){return typeof arg==='string';};function curry(func){var args=aps.call(arguments,1);return function(){return func.apply(this,args.concat(aps.call(arguments)));};};function get_fragment(url){return url.replace(re_fragment,'$2');};function get_querystring(url){return url.replace(/(?:^[^?#]*\?([^#]*).*$)?.*/,'$1');};function jq_param_sub(is_fragment,get_func,url,params,merge_mode){var result,qs,matches,url_params,hash;if(params!==undefined){matches=url.match(is_fragment?re_fragment:/^([^#?]*)\??([^#]*)(#?.*)/);hash=matches[3]||'';if(merge_mode===2&&is_string(params)){qs=params.replace(is_fragment?re_params_fragment:re_params_querystring,'');}else{url_params=jq_deparam(matches[2]);params=is_string(params)?jq_deparam[is_fragment?str_fragment:str_querystring](params):params;qs=merge_mode===2?params:merge_mode===1?$.extend({},params,url_params):$.extend({},url_params,params);qs=jq_param_sorted(qs);if(is_fragment){qs=qs.replace(re_no_escape,decode);}}
result=matches[1]+(is_fragment?fragment_prefix:qs||!matches[1]?'?':'')+qs+hash;}else{result=get_func(url!==undefined?url:location.href);}
return result;};jq_param[str_querystring]=curry(jq_param_sub,0,get_querystring);jq_param[str_fragment]=jq_param_fragment=curry(jq_param_sub,1,get_fragment);jq_param.sorted=jq_param_sorted=function(a,traditional){var arr=[],obj={};$.each(jq_param(a,traditional).split('&'),function(i,v){var key=v.replace(/(?:%5B|=).*$/,''),key_obj=obj[key];if(!key_obj){key_obj=obj[key]=[];arr.push(key);}
key_obj.push(v);});return $.map(arr.sort(),function(v){return obj[v];}).join('&');};jq_param_fragment.noEscape=function(chars){chars=chars||'';var arr=$.map(chars.split(''),encodeURIComponent);re_no_escape=new RegExp(arr.join('|'),'g');};jq_param_fragment.noEscape(',/');jq_param_fragment.ajaxCrawlable=function(state){if(state!==undefined){if(state){re_params_fragment=/^.*(?:#!|#)/;re_fragment=/^([^#]*)(?:#!|#)?(.*)$/;fragment_prefix='#!';}else{re_params_fragment=/^.*#/;re_fragment=/^([^#]*)#?(.*)$/;fragment_prefix='#';}
ajax_crawlable=!!state;}
return ajax_crawlable;};jq_param_fragment.ajaxCrawlable(0);$.deparam=jq_deparam=function(params,coerce){var obj={},coerce_types={'true':!0,'false':!1,'null':null};$.each(params.replace(/\+/g,' ').split('&'),function(j,v){var param=v.split('='),key=decode(param[0]),val,cur=obj,i=0,keys=key.split(']['),keys_last=keys.length-1;if(/\[/.test(keys[0])&&/\]$/.test(keys[keys_last])){keys[keys_last]=keys[keys_last].replace(/\]$/,'');keys=keys.shift().split('[').concat(keys);keys_last=keys.length-1;}else{keys_last=0;}
if(param.length===2){val=decode(param[1]);if(coerce){val=val&&!isNaN(val)?+val:val==='undefined'?undefined:coerce_types[val]!==undefined?coerce_types[val]:val;}
if(keys_last){for(;i<=keys_last;i++){key=keys[i]===''?cur.length:keys[i];cur=cur[key]=i<keys_last?cur[key]||(keys[i+1]&&isNaN(keys[i+1])?{}:[]):val;}}else{if($.isArray(obj[key])){obj[key].push(val);}else if(obj[key]!==undefined){obj[key]=[obj[key],val];}else{obj[key]=val;}}}else if(key){obj[key]=coerce?undefined:'';}});return obj;};function jq_deparam_sub(is_fragment,url_or_params,coerce){if(url_or_params===undefined||typeof url_or_params==='boolean'){coerce=url_or_params;url_or_params=jq_param[is_fragment?str_fragment:str_querystring]();}else{url_or_params=is_string(url_or_params)?url_or_params.replace(is_fragment?re_params_fragment:re_params_querystring,''):url_or_params;}
return jq_deparam(url_or_params,coerce);};jq_deparam[str_querystring]=curry(jq_deparam_sub,0);jq_deparam[str_fragment]=jq_deparam_fragment=curry(jq_deparam_sub,1);$[str_elemUrlAttr]||($[str_elemUrlAttr]=function(obj){return $.extend(elemUrlAttr_cache,obj);})({a:str_href,base:str_href,iframe:str_src,img:str_src,input:str_src,form:'action',link:str_href,script:str_src});jq_elemUrlAttr=$[str_elemUrlAttr];function jq_fn_sub(mode,force_attr,params,merge_mode){if(!is_string(params)&&typeof params!=='object'){merge_mode=params;params=force_attr;force_attr=undefined;}
return this.each(function(){var that=$(this),attr=force_attr||jq_elemUrlAttr()[(this.nodeName||'').toLowerCase()]||'',url=attr&&that.attr(attr)||'';that.attr(attr,jq_param[mode](url,params,merge_mode));});};$.fn[str_querystring]=curry(jq_fn_sub,str_querystring);$.fn[str_fragment]=curry(jq_fn_sub,str_fragment);jq_bbq.pushState=jq_bbq_pushState=function(params,merge_mode){if(is_string(params)&&/^#/.test(params)&&merge_mode===undefined){merge_mode=2;}
var has_args=params!==undefined,url=jq_param_fragment(location.href,has_args?params:{},has_args?merge_mode:2);location.href=url;};jq_bbq.getState=jq_bbq_getState=function(key,coerce){return key===undefined||typeof key==='boolean'?jq_deparam_fragment(key):jq_deparam_fragment(coerce)[key];};jq_bbq.removeState=function(arr){var state={};if(arr!==undefined){state=jq_bbq_getState();$.each($.isArray(arr)?arr:arguments,function(i,v){delete state[v];});}
jq_bbq_pushState(state,2);};special[str_hashchange]=$.extend(special[str_hashchange],{add:function(handleObj){var old_handler;function new_handler(e){var hash=e[str_fragment]=jq_param_fragment();e.getState=function(key,coerce){return key===undefined||typeof key==='boolean'?jq_deparam(hash,key):jq_deparam(hash,coerce)[key];};old_handler.apply(this,arguments);};if($.isFunction(handleObj)){old_handler=handleObj;return new_handler;}else{old_handler=handleObj.handler;handleObj.handler=new_handler;}}});})(jQuery,this);(function($,window,undefined){'$:nomunge';var str_hashchange='hashchange',doc=document,fake_onhashchange,special=$.event.special,doc_mode=doc.documentMode,supports_onhashchange='on'+str_hashchange in window&&(doc_mode===undefined||doc_mode>7);function get_fragment(url){url=url||location.href;return'#'+url.replace(/^[^#]*#?(.*)$/,'$1');};$.fn[str_hashchange]=function(fn){return fn?this.bind(str_hashchange,fn):this.trigger(str_hashchange);};$.fn[str_hashchange].delay=50;special[str_hashchange]=$.extend(special[str_hashchange],{setup:function(){if(supports_onhashchange){return false;}
$(fake_onhashchange.start);},teardown:function(){if(supports_onhashchange){return false;}
$(fake_onhashchange.stop);}});fake_onhashchange=(function(){var self={},timeout_id,last_hash=get_fragment(),fn_retval=function(val){return val;},history_set=fn_retval,history_get=fn_retval;self.start=function(){timeout_id||poll();};self.stop=function(){timeout_id&&clearTimeout(timeout_id);timeout_id=undefined;};function poll(){var hash=get_fragment(),history_hash=history_get(last_hash);if(hash!==last_hash){history_set(last_hash=hash,history_hash);$(window).trigger(str_hashchange);}else if(history_hash!==last_hash){location.href=location.href.replace(/#.*/,'')+history_hash;}
timeout_id=setTimeout(poll,$.fn[str_hashchange].delay);};$.browser.msie&&!supports_onhashchange&&(function(){var iframe,iframe_src;self.start=function(){if(!iframe){iframe_src=$.fn[str_hashchange].src;iframe_src=iframe_src&&iframe_src+get_fragment();iframe=$('<iframe tabindex="-1" title="empty"/>').hide().one('load',function(){iframe_src||history_set(get_fragment());poll();}).attr('src',iframe_src||'javascript:0').insertAfter('body')[0].contentWindow;doc.onpropertychange=function(){try{if(event.propertyName==='title'){iframe.document.title=doc.title;}}catch(e){}};}};self.stop=fn_retval;history_get=function(){return get_fragment(iframe.location.href);};history_set=function(hash,history_hash){var iframe_doc=iframe.document,domain=$.fn[str_hashchange].domain;if(hash!==history_hash){iframe_doc.title=doc.title;iframe_doc.open();domain&&iframe_doc.write('<script>document.domain="'+domain+'"</script>');iframe_doc.close();iframe.location.hash=hash;}};})();return self;})();})(jQuery,this);;

/* /web/static/src/js/framework/data_model.js defined in bundle 'web.assets_backend' */
odoo.define('web.DataModel',function(require){"use strict";var data=require('web.data');var Model=require('web.Model');var pyeval=require('web.pyeval');var session=require('web.session');Model.include({query:function(fields){return new data.Query(this,fields);},domain:function(domain){if(!domain){return this._domain;}
return new data.CompoundDomain(this._domain,domain);},context:function(context){return new data.CompoundContext(session.user_context,this._context,context||{});},call:function(method,args,kwargs,options){args=args||[];kwargs=kwargs||{};if(!_.isArray(args)){kwargs=args;args=[];}
pyeval.ensure_evaluated(args,kwargs);var call_kw='/web/dataset/call_kw/'+this.name+'/'+method;return session.rpc(call_kw,{model:this.name,method:method,args:args,kwargs:kwargs},options);},call_button:function(method,args){pyeval.ensure_evaluated(args,{});return session.rpc('/web/dataset/call_button',{model:this.name,method:method,domain_id:null,context_id:args.length-1,args:args||[]});},});return Model;});;

/* /web/static/src/js/framework/formats.js defined in bundle 'web.assets_backend' */
odoo.define('web.formats',function(require){"use strict";var core=require('web.core');var time=require('web.time');var utils=require('web.utils');var _t=core._t;function format_value(value,descriptor,value_if_empty){var l10n=_t.database.parameters;var date_format=time.strftime_to_moment_format(l10n.date_format);var time_format=time.strftime_to_moment_format(l10n.time_format);if(typeof value==='number'&&isNaN(value)){value=false;}
switch(value){case'':if(descriptor.type==='char'||descriptor.type==='text'){return'';}
console.warn('Field',descriptor,'had an empty string as value, treating as false...');return value_if_empty===undefined?'':value_if_empty;case false:case undefined:case Infinity:case-Infinity:return value_if_empty===undefined?'':value_if_empty;}
switch(descriptor.widget||descriptor.type||(descriptor.field&&descriptor.field.type)){case'id':return value.toString();case'integer':try{var noformat=descriptor.node.attrs.noformat;}catch(TypeError){}
if(descriptor.noformat||noformat){return _.str.sprintf('%d',value);}
return utils.insert_thousand_seps(_.str.sprintf('%d',value));case'monetary':case'float':var digits=descriptor.digits?descriptor.digits:[69,2];digits=typeof digits==="string"?py.eval(digits):digits;var precision=digits[1];var formatted=_.str.sprintf('%.'+precision+'f',value).split('.');formatted[0]=utils.insert_thousand_seps(formatted[0]);return formatted.join(l10n.decimal_point);case'float_time':var pattern='%02d:%02d';if(value<0){value=Math.abs(value);pattern='-'+pattern;}
var hour=Math.floor(value);var min=Math.round((value%1)*60);if(min==60){min=0;hour=hour+1;}
return _.str.sprintf(pattern,hour,min);case'many2one':return value[1]?value[1].split("\n")[0]:value[1];case'one2many':case'many2many':if(typeof value==='string'){return value;}
return _.str.sprintf(_t("(%d records)"),value.length);case'datetime':if(typeof(value)=="string")
value=moment(time.auto_str_to_date(value));else{value=moment(value);}
return value.format(date_format+' '+time_format);case'date':if(typeof(value)=="string")
value=moment(time.auto_str_to_date(value));else{value=moment(value);}
return value.format(date_format);case'time':if(typeof(value)=="string")
value=moment(time.auto_str_to_date(value));else{value=moment(value);}
return value.format(time_format);case'selection':case'statusbar':if(_.isArray(value)){return value[1];}
var result=_(descriptor.selection).detect(function(choice){return choice[0]===value;});if(result){return result[1];}
return;default:return value;}}
function parse_value(value,descriptor,value_if_empty){var date_pattern=time.strftime_to_moment_format(_t.database.parameters.date_format),time_pattern=time.strftime_to_moment_format(_t.database.parameters.time_format);var date_pattern_wo_zero=date_pattern.replace('MM','M').replace('DD','D'),time_pattern_wo_zero=time_pattern.replace('HH','H').replace('mm','m').replace('ss','s');switch(value){case false:case"":return value_if_empty===undefined?false:value_if_empty;}
var tmp;switch(descriptor.widget||descriptor.type||(descriptor.field&&descriptor.field.type)){case'integer':do{tmp=value;value=value.replace(_t.database.parameters.thousands_sep,"");}while(tmp!==value);tmp=Number(value);if(isNaN(tmp)||tmp%1)
throw new Error(_.str.sprintf(_t("'%s' is not a correct integer"),value));return tmp;case'monetary':case'float':var tmp2=value;do{tmp=tmp2;tmp2=tmp.replace(_t.database.parameters.thousands_sep,"");}while(tmp!==tmp2);var reformatted_value=tmp.replace(_t.database.parameters.decimal_point,".");var parsed=Number(reformatted_value);if(isNaN(parsed))
throw new Error(_.str.sprintf(_t("'%s' is not a correct float"),value));return parsed;case'float_time':var factor=1;if(value[0]==='-'){value=value.slice(1);factor=-1;}
var float_time_pair=value.split(":");if(float_time_pair.length!=2)
return factor*parse_value(value,{type:"float"});var hours=parse_value(float_time_pair[0],{type:"integer"});var minutes=parse_value(float_time_pair[1],{type:"integer"});return factor*(hours+(minutes/60));case'progressbar':return parse_value(value,{type:"float"});case'datetime':var datetime=moment(value,[date_pattern+' '+time_pattern,date_pattern_wo_zero+' '+time_pattern_wo_zero],true);if(datetime.isValid())
return time.datetime_to_str(datetime.toDate());throw new Error(_.str.sprintf(_t("'%s' is not a correct datetime"),value));case'date':var date=moment(value,[date_pattern,date_pattern_wo_zero],true);if(date.isValid())
return time.date_to_str(date.toDate());throw new Error(_.str.sprintf(_t("'%s' is not a correct date"),value));case'time':var _time=moment(value,[time_pattern,time_pattern_wo_zero],true);if(_time.isValid())
return time.time_to_str(_time.toDate());throw new Error(_.str.sprintf(_t("'%s' is not a correct time"),value));}
return value;}
return{format_value:format_value,parse_value:parse_value,};});;

/* /web/static/src/js/framework/view.js defined in bundle 'web.assets_backend' */
odoo.define('web.View',function(require){"use strict";var core=require('web.core');var data=require('web.data');var pyeval=require('web.pyeval');var Widget=require('web.Widget');var View=Widget.extend({events:{'click a[type=action]':function(ev){ev.preventDefault();var action_data=$(ev.target).attr('name');this.do_action(action_data);}},display_name:'',view_type:undefined,searchable:true,searchview_hidden:false,multi_record:true,icon:'fa-question',init:function(parent,dataset,view_id,options){this._super(parent);this.ViewManager=parent;this.dataset=dataset;this.view_id=view_id;this.set_default_options(options);},start:function(){return this.load_view();},load_view:function(){var self=this;var view_loaded_def;if(this.embedded_view){view_loaded_def=$.Deferred();$.async_when().done(function(){view_loaded_def.resolve(self.embedded_view);});}else{if(!this.view_type)
console.warn("view_type is not defined",this);if(this.view_type==='form'){var new_context=this.dataset.get_context();if(this.dataset.context.params){if(this.dataset.context.params.id===undefined){new_context.add({'active_id':this.dataset.ids[this.dataset.index]});}
else{new_context.add({'active_id':this.dataset.context.params.id});}}
else{new_context.add({'active_id':this.dataset.ids[this.dataset.index]});}
view_loaded_def=this.dataset._model.fields_view_get({"view_id":this.view_id,"view_type":this.view_type,"toolbar":!!this.options.sidebar,"context":new_context,});}
else{view_loaded_def=this.dataset._model.fields_view_get({"view_id":this.view_id,"view_type":this.view_type,"toolbar":!!this.options.sidebar,"context":this.dataset.get_context(),});}}
return this.alive(view_loaded_def).then(function(r){self.fields_view=r;self.$el.addClass('oe_view').toggleClass('oe_cannot_create',!self.is_action_enabled('create')).toggleClass('oe_cannot_edit',!self.is_action_enabled('edit')).toggleClass('oe_cannot_delete',!self.is_action_enabled('delete'));return $.when(self.view_loading(r)).then(function(){self.trigger('view_loaded',r);});});},view_loading:function(r){},set_default_options:function(options){this.options=options||{};_.defaults(this.options,{$sidebar:null,sidebar_id:null,action:null,action_views_ids:{}});},do_execute_action:function(action_data,dataset,record_id,on_closed){var self=this;var result_handler=function(){if(on_closed){on_closed.apply(null,arguments);}
if(self.getParent()&&self.getParent().on_action_executed){return self.getParent().on_action_executed.apply(null,arguments);}};var context=new data.CompoundContext(dataset.get_context(),action_data.context||{});var handler=function(action){if(action&&action.constructor==Object){var ncontext=new data.CompoundContext(_.object(_.reject(_.pairs(dataset.get_context().eval()),function(pair){return pair[0].match('^(?:(?:default_|search_default_|show_).+|.+_view_ref|group_by|group_by_no_leaf|active_id|active_ids)$')!==null;})));ncontext.add(action_data.context||{});ncontext.add({active_model:dataset.model});if(record_id){ncontext.add({active_id:record_id,active_ids:[record_id],});}
ncontext.add(action.context||{});action.context=ncontext;return self.do_action(action,{on_close:result_handler,});}else{self.do_action({"type":"ir.actions.act_window_close"});return result_handler();}};if(action_data.special==='cancel'){return handler({"type":"ir.actions.act_window_close"});}else if(action_data.type=="object"){var args=[[record_id]];if(action_data.args){try{var additional_args=JSON.parse(action_data.args.replace(/'/g,'"'));args=args.concat(additional_args);}catch(e){console.error("Could not JSON.parse arguments",action_data.args);}}
args.push(context);return dataset.call_button(action_data.name,args).then(handler).then(function(){core.bus.trigger('do_reload_needaction');});}else if(action_data.type=="action"){return this.rpc('/web/action/load',{action_id:action_data.name,context:_.extend(pyeval.eval('context',context),{'active_model':dataset.model,'active_ids':dataset.ids,'active_id':record_id}),do_not_eval:true}).then(handler);}else{return dataset.exec_workflow(record_id,action_data.name).then(handler);}},set_embedded_view:function(embedded_view){this.embedded_view=embedded_view;},do_show:function(){this._super();core.bus.trigger('view_shown',this);},is_active:function(){return this.ViewManager.active_view.controller===this;},guard_active:function(fn){var self=this;return function(){if(self.is_active()){fn.apply(self,arguments);}};},do_push_state:function(state){if(this.getParent()&&this.getParent().do_push_state){this.getParent().do_push_state(state);}},do_load_state:function(state,warm){},render_buttons:function($node){},render_sidebar:function($node){},render_pager:function($node){},do_switch_view:function(){this.trigger.apply(this,['switch_mode'].concat(_.toArray(arguments)));},do_search:function(domain,context,group_by){},sidebar_eval_context:function(){return $.when({});},reload:function(){return $.when();},is_action_enabled:function(action){var attrs=this.fields_view.arch.attrs;return(action in attrs)?JSON.parse(attrs[action]):true;},get_context:function(){return{};},});return View;});;

/* /web/static/src/js/framework/pyeval.js defined in bundle 'web.assets_backend' */
odoo.define('web.pyeval',function(require){"use strict";var core=require('web.core');var session=require('web.session');var utils=require('web.utils');var _t=core._t;var py=window.py;var obj=function(){};obj.prototype=py.object;var asJS=function(arg){if(arg instanceof obj){return arg.toJSON();}
return arg;};var datetime=py.PY_call(py.object);var zero=py.float.fromJSON(0);var DAYS_IN_MONTH=[null,31,28,31,30,31,30,31,31,30,31,30,31];var DAYS_BEFORE_MONTH=[null];var dbm=0;for(var i=1;i<DAYS_IN_MONTH.length;++i){DAYS_BEFORE_MONTH.push(dbm);dbm+=DAYS_IN_MONTH[i];}
function is_leap(year){return year%4===0&&(year%100!==0||year%400===0);}
function days_before_year(year){var y=year-1;return y*365+Math.floor(y/4)-Math.floor(y/100)+Math.floor(y/400);}
function days_in_month(year,month){if(month===2&&is_leap(year)){return 29;}
return DAYS_IN_MONTH[month];}
function days_before_month(year,month){var post_leap_feb=month>2&&is_leap(year);return DAYS_BEFORE_MONTH[month]+(post_leap_feb?1:0);}
function ymd2ord(year,month,day){var dim=days_in_month(year,month);if(!(1<=day&&day<=dim)){throw new Error("ValueError: day must be in 1.."+dim);}
return days_before_year(year)+
days_before_month(year,month)+
day;}
var DI400Y=days_before_year(401);var DI100Y=days_before_year(101);var DI4Y=days_before_year(5);function ord2ymd(n){--n;var n400,n100,n4,n1,n0;utils.divmod(n,DI400Y,function(_n400,n){n400=_n400;utils.divmod(n,DI100Y,function(_n100,n){n100=_n100;utils.divmod(n,DI4Y,function(_n4,n){n4=_n4;utils.divmod(n,365,function(_n1,n){n1=_n1;n0=n;});});});});n=n0;var year=n400*400+1+n100*100+n4*4+n1;if(n1==4||n100==100){utils.assert(n0===0);return{year:year-1,month:12,day:31};}
var leapyear=n1===3&&(n4!==24||n100==3);utils.assert(leapyear==is_leap(year));var month=(n+50)>>5;var preceding=DAYS_BEFORE_MONTH[month]+((month>2&&leapyear)?1:0);if(preceding>n){--month;preceding-=DAYS_IN_MONTH[month]+((month===2&&leapyear)?1:0);}
n-=preceding;return{year:year,month:month,day:n+1};}
function tmxxx(year,month,day,hour,minute,second,microsecond){hour=hour||0;minute=minute||0;second=second||0;microsecond=microsecond||0;if(microsecond<0||microsecond>999999){utils.divmod(microsecond,1000000,function(carry,ms){microsecond=ms;second+=carry;});}
if(second<0||second>59){utils.divmod(second,60,function(carry,s){second=s;minute+=carry;});}
if(minute<0||minute>59){utils.divmod(minute,60,function(carry,m){minute=m;hour+=carry;});}
if(hour<0||hour>23){utils.divmod(hour,24,function(carry,h){hour=h;day+=carry;});}
if(month<1||month>12){utils.divmod(month-1,12,function(carry,m){month=m+1;year+=carry;});}
var dim=days_in_month(year,month);if(day<1||day>dim){if(day===0){--month;if(month>0){day=days_in_month(year,month);}else{--year;month=12;day=31;}}else if(day==dim+1){++month;day=1;if(month>12){month=1;++year;}}else{var r=ord2ymd(ymd2ord(year,month,1)+(day-1));year=r.year;month=r.month;day=r.day;}}
return{year:year,month:month,day:day,hour:hour,minute:minute,second:second,microsecond:microsecond};}
datetime.timedelta=py.type('timedelta',null,{__init__:function(){var args=py.PY_parseArgs(arguments,[['days',zero],['seconds',zero],['microseconds',zero],['milliseconds',zero],['minutes',zero],['hours',zero],['weeks',zero]]);var d=0,s=0,m=0;var days=args.days.toJSON()+args.weeks.toJSON()*7;var seconds=args.seconds.toJSON()
+args.minutes.toJSON()*60
+args.hours.toJSON()*3600;var microseconds=args.microseconds.toJSON()
+args.milliseconds.toJSON()*1000;var daysecondsfrac=utils.modf(days,function(dayfrac,days){d=days;if(dayfrac){return utils.modf(dayfrac*24*3600,function(dsf,dsw){s=dsw;return dsf;});}
return 0;});var secondsfrac=utils.modf(seconds,function(sf,s){seconds=s;return sf+daysecondsfrac;});utils.divmod(seconds,24*3600,function(days,seconds){d+=days;s+=seconds;});microseconds+=secondsfrac*1e6;utils.divmod(microseconds,1000000,function(seconds,microseconds){utils.divmod(seconds,24*3600,function(days,seconds){d+=days;s+=seconds;m+=Math.round(microseconds);});});this.days=d;this.seconds=s;this.microseconds=m;},__str__:function(){var hh,mm,ss;utils.divmod(this.seconds,60,function(m,s){utils.divmod(m,60,function(h,m){hh=h;mm=m;ss=s;});});var s=_.str.sprintf("%d:%02d:%02d",hh,mm,ss);if(this.days){s=_.str.sprintf("%d day%s, %s",this.days,(this.days!=1&&this.days!=-1)?'s':'',s);}
if(this.microseconds){s=_.str.sprintf("%s.%06d",s,this.microseconds);}
return py.str.fromJSON(s);},__eq__:function(other){if(!py.PY_isInstance(other,datetime.timedelta)){return py.False;}
return(this.days===other.days&&this.seconds===other.seconds&&this.microseconds===other.microseconds)?py.True:py.False;},__add__:function(other){if(!py.PY_isInstance(other,datetime.timedelta)){return py.NotImplemented;}
return py.PY_call(datetime.timedelta,[py.float.fromJSON(this.days+other.days),py.float.fromJSON(this.seconds+other.seconds),py.float.fromJSON(this.microseconds+other.microseconds)]);},__radd__:function(other){return this.__add__(other);},__sub__:function(other){if(!py.PY_isInstance(other,datetime.timedelta)){return py.NotImplemented;}
return py.PY_call(datetime.timedelta,[py.float.fromJSON(this.days-other.days),py.float.fromJSON(this.seconds-other.seconds),py.float.fromJSON(this.microseconds-other.microseconds)]);},__rsub__:function(other){if(!py.PY_isInstance(other,datetime.timedelta)){return py.NotImplemented;}
return this.__neg__().__add__(other);},__neg__:function(){return py.PY_call(datetime.timedelta,[py.float.fromJSON(-this.days),py.float.fromJSON(-this.seconds),py.float.fromJSON(-this.microseconds)]);},__pos__:function(){return this;},__mul__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
var n=other.toJSON();return py.PY_call(datetime.timedelta,[py.float.fromJSON(this.days*n),py.float.fromJSON(this.seconds*n),py.float.fromJSON(this.microseconds*n)]);},__rmul__:function(other){return this.__mul__(other);},__div__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
var usec=((this.days*24*3600)+this.seconds)*1000000
+this.microseconds;return py.PY_call(datetime.timedelta,[zero,zero,py.float.fromJSON(usec/other.toJSON())]);},__floordiv__:function(other){return this.__div__(other);},total_seconds:function(){return py.float.fromJSON(this.days*86400
+this.seconds
+this.microseconds/1000000);},__nonzero__:function(){return(!!this.days||!!this.seconds||!!this.microseconds)?py.True:py.False;}});datetime.datetime=py.type('datetime',null,{__init__:function(){var zero=py.float.fromJSON(0);var args=py.PY_parseArgs(arguments,['year','month','day',['hour',zero],['minute',zero],['second',zero],['microsecond',zero],['tzinfo',py.None]]);for(var key in args){if(!args.hasOwnProperty(key)){continue;}
this[key]=asJS(args[key]);}},replace:function(){var args=py.PY_parseArgs(arguments,[['year',py.None],['month',py.None],['day',py.None],['hour',py.None],['minute',py.None],['second',py.None],['microsecond',py.None]]);var params={};for(var key in args){if(!args.hasOwnProperty(key)){continue;}
var arg=args[key];params[key]=(arg===py.None?this[key]:asJS(arg));}
return py.PY_call(datetime.datetime,params);},strftime:function(){var self=this;var args=py.PY_parseArgs(arguments,'format');return py.str.fromJSON(args.format.toJSON().replace(/%([A-Za-z])/g,function(m,c){switch(c){case'Y':return _.str.sprintf('%04d',self.year);case'm':return _.str.sprintf('%02d',self.month);case'd':return _.str.sprintf('%02d',self.day);case'H':return _.str.sprintf('%02d',self.hour);case'M':return _.str.sprintf('%02d',self.minute);case'S':return _.str.sprintf('%02d',self.second);}
throw new Error('ValueError: No known conversion for '+m);}));},now:py.classmethod.fromJSON(function(){var d=new Date();return py.PY_call(datetime.datetime,[d.getFullYear(),d.getMonth()+1,d.getDate(),d.getHours(),d.getMinutes(),d.getSeconds(),d.getMilliseconds()*1000]);}),today:py.classmethod.fromJSON(function(){var dt_class=py.PY_getAttr(datetime,'datetime');return py.PY_call(py.PY_getAttr(dt_class,'now'));}),utcnow:py.classmethod.fromJSON(function(){var d=new Date();return py.PY_call(datetime.datetime,[d.getUTCFullYear(),d.getUTCMonth()+1,d.getUTCDate(),d.getUTCHours(),d.getUTCMinutes(),d.getUTCSeconds(),d.getUTCMilliseconds()*1000]);}),combine:py.classmethod.fromJSON(function(){var args=py.PY_parseArgs(arguments,'date time');return py.PY_call(datetime.datetime,[py.PY_getAttr(args.date,'year'),py.PY_getAttr(args.date,'month'),py.PY_getAttr(args.date,'day'),py.PY_getAttr(args.time,'hour'),py.PY_getAttr(args.time,'minute'),py.PY_getAttr(args.time,'second')]);}),toJSON:function(){return new Date(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.microsecond/1000);},});datetime.date=py.type('date',null,{__init__:function(){var args=py.PY_parseArgs(arguments,'year month day');this.year=asJS(args.year);this.month=asJS(args.month);this.day=asJS(args.day);},strftime:function(){var self=this;var args=py.PY_parseArgs(arguments,'format');return py.str.fromJSON(args.format.toJSON().replace(/%([A-Za-z])/g,function(m,c){switch(c){case'Y':return self.year;case'm':return _.str.sprintf('%02d',self.month);case'd':return _.str.sprintf('%02d',self.day);}
throw new Error('ValueError: No known conversion for '+m);}));},__eq__:function(other){return(this.year===other.year&&this.month===other.month&&this.day===other.day)?py.True:py.False;},replace:function(){var args=py.PY_parseArgs(arguments,[['year',py.None],['month',py.None],['day',py.None]]);var params={};for(var key in args){if(!args.hasOwnProperty(key)){continue;}
var arg=args[key];params[key]=(arg===py.None?this[key]:asJS(arg));}
return py.PY_call(datetime.date,params);},__add__:function(other){if(!py.PY_isInstance(other,datetime.timedelta)){return py.NotImplemented;}
var s=tmxxx(this.year,this.month,this.day+other.days);return datetime.date.fromJSON(s.year,s.month,s.day);},__radd__:function(other){return this.__add__(other);},__sub__:function(other){if(py.PY_isInstance(other,datetime.timedelta)){return py.PY_add(this,py.PY_negative(other));}
if(py.PY_isInstance(other,datetime.date)){return py.PY_call(datetime.timedelta,[py.PY_subtract(py.PY_call(py.PY_getAttr(this,'toordinal')),py.PY_call(py.PY_getAttr(other,'toordinal')))]);}
return py.NotImplemented;},toordinal:function(){return py.float.fromJSON(ymd2ord(this.year,this.month,this.day));},weekday:function(){return py.float.fromJSON((this.toordinal().toJSON()+6)%7);},fromJSON:function(year,month,day){return py.PY_call(datetime.date,[year,month,day]);},today:py.classmethod.fromJSON(function(){var d=new Date();return py.PY_call(datetime.date,[d.getFullYear(),d.getMonth()+1,d.getDate()]);}),});function context_today(){var d=new Date();return py.PY_call(datetime.date,[d.getFullYear(),d.getMonth()+1,d.getDate()]);}
datetime.time=py.type('time',null,{__init__:function(){var zero=py.float.fromJSON(0);var args=py.PY_parseArgs(arguments,[['hour',zero],['minute',zero],['second',zero],['microsecond',zero],['tzinfo',py.None]]);for(var k in args){if(!args.hasOwnProperty(k)){continue;}
this[k]=asJS(args[k]);}}});var time=py.PY_call(py.object);time.strftime=py.PY_def.fromJSON(function(){var args=py.PY_parseArgs(arguments,'format');var dt_class=py.PY_getAttr(datetime,'datetime');var d=py.PY_call(py.PY_getAttr(dt_class,'utcnow'));return py.PY_call(py.PY_getAttr(d,'strftime'),[args.format]);});var args=_.map(('year month day '
+'years months weeks days '
+'weekday leapdays yearday nlyearday').split(' '),function(arg){switch(arg){case'years':case'months':case'days':case'leapdays':case'weeks':return[arg,zero];case'year':case'month':case'day':case'weekday':case'yearday':case'nlyearday':return[arg,null];default:throw new Error("Unknown relativedelta argument "+arg);}});args.unshift('*');var _utils={monthrange:function(year,month){if(month<1||month>12){throw new Error("Illegal month "+month);}
var day1=this.weekday(year,month,1);var ndays=this.mdays[month]+(month==this.February&&this.isleap(year));return[day1,ndays];},weekday:function(year,month,day){var date=py.PY_call(datetime.date,[year,month,day]);return py.PY_call(py.PY_getAttr(date,'weekday'));},isleap:function(year){return year%4===0&&(year%100!==0||year%400===0)},mdays:[0,31,28,31,30,31,30,31,31,30,31,30,31],January:1,February:2};var relativedelta=py.type('relativedelta',null,{__init__:function(){this.ops=py.PY_parseArgs(arguments,args);this.ops.days=py.float.fromJSON(asJS(this.ops.days)+asJS(this.ops.weeks)*7);var yday=zero;if(this.ops.nlyearday){yday=this.ops.nlyearday;}else if(this.ops.yearday){yday=this.ops.yearday;if(asJS(this.ops.yearday)>59){this.ops.leapdays=py.float.fromJS(-1);}}
if(py.PY_isTrue(yday)){var ydayidx=[31,59,90,120,151,181,212,243,273,304,334,366];for(var idx=0;idx<ydayidx.length;++idx){var ydays=ydayidx[idx];if(asJS(yday)<=ydays){this.ops.month=py.float.fromJSON(idx+1);if(!idx){this.ops.day=yday;}else{this.ops.day=py.PY_subtract(yday,py.float.fromJSON(ydayidx[idx-1]));}
break;}}
if(idx===ydayidx.length){throw new Error("Invalid year day ("+asJS(yday)+")");}}
this._fix();},_fix:function(){var months=asJS(this.ops.months);if(Math.abs(months)>11){var s=months>0?1:-1;var r=utils.divmod(months*s,12);this.ops.months=py.float.fromJSON(r.mod*s);this.ops.years=py.float.fromJSON(asJS(this.ops.years)+r.div*s);}
this._has_time=0;},__add__:function(other){if(!py.PY_isInstance(other,datetime.date)){return py.NotImplemented;}
var year=(asJS(this.ops.year)||asJS(other.year))+asJS(this.ops.years);var month=asJS(this.ops.month)||asJS(other.month);var months;if(months=asJS(this.ops.months)){if(Math.abs(months)<1||Math.abs(months)>12){throw new Error("Can only use relative months between -12 and +12");}
month+=months;if(month>12){year+=1;month-=12;}
if(month<1){year-=1;month+=12;}}
var day=Math.min(_utils.monthrange(year,month)[1],asJS(this.ops.day)||asJS(other.day));var repl={year:py.float.fromJSON(year),month:py.float.fromJSON(month),day:py.float.fromJSON(day)};var days=asJS(this.ops.days);if(py.PY_isTrue(this.ops.leapdays)&&month>2&&_utils.isleap(year)){days+=asJS(this.ops.leapdays);}
var ret=py.PY_add(py.PY_call(py.PY_getAttr(other,'replace'),repl),py.PY_call(datetime.timedelta,{days:py.float.fromJSON(days)}));if(this.ops.weekday){var weekday=asJS(this.ops.weekday),nth=1;var jumpdays=(Math.abs(nth)-1)*7;var ret_weekday=asJS(py.PY_call(py.PY_getAttr(ret,'weekday')));if(nth>0){jumpdays+=(7-ret_weekday+weekday)%7;}else{jumpdays+=(ret_weekday-weekday)%7;jumpdays*=-1;}
ret=py.PY_add(ret,py.PY_call(datetime.timedelta,{days:py.float.fromJSON(jumpdays)}));}
return ret;},__radd__:function(other){return this.__add__(other);},__rsub__:function(other){return this.__neg__().__radd__(other);},__neg__:function(){return py.PY_call(relativedelta,{years:py.PY_negative(this.ops.years),months:py.PY_negative(this.ops.months),days:py.PY_negative(this.ops.days),leapdays:this.ops.leapdays,year:this.ops.year,month:this.ops.month,day:this.ops.day,weekday:this.ops.weekday});}});function wrap(value){if(value===null){return py.None;}
switch(typeof value){case'undefined':throw new Error("No conversion for undefined");case'boolean':return py.bool.fromJSON(value);case'number':return py.float.fromJSON(value);case'string':return py.str.fromJSON(value);}
switch(value.constructor){case Object:return wrapping_dict.fromJSON(value);case Array:return wrapping_list.fromJSON(value);}
throw new Error("ValueError: unable to wrap "+value);}
var wrapping_dict=py.type('wrapping_dict',null,{__init__:function(){this._store={};},__getitem__:function(key){var k=key.toJSON();if(!(k in this._store)){throw new Error("KeyError: '"+k+"'");}
return wrap(this._store[k]);},__getattr__:function(key){return this.__getitem__(py.str.fromJSON(key));},get:function(){var args=py.PY_parseArgs(arguments,['k',['d',py.None]]);if(!(args.k.toJSON()in this._store)){return args.d;}
return this.__getitem__(args.k);},fromJSON:function(d){var instance=py.PY_call(wrapping_dict);instance._store=d;return instance;},toJSON:function(){return this._store;},});var wrapping_list=py.type('wrapping_list',null,{__init__:function(){this._store=[];},__getitem__:function(index){return wrap(this._store[index.toJSON()]);},fromJSON:function(ar){var instance=py.PY_call(wrapping_list);instance._store=ar;return instance;},toJSON:function(){return this._store;},});function wrap_context(context){for(var k in context){if(!context.hasOwnProperty(k)){continue;}
var val=context[k];if(val===null){continue;}
if(val.constructor===Array){context[k]=wrapping_list.fromJSON(val);}else if(val.constructor===Object&&!py.PY_isInstance(val,py.object)){context[k]=wrapping_dict.fromJSON(val);}}
return context;}
function eval_contexts(contexts,evaluation_context){evaluation_context=_.extend(pycontext(),evaluation_context||{});return _(contexts).reduce(function(result_context,ctx){if(_.isEmpty(ctx)){return result_context;}
if(_.isString(ctx)){ctx={__ref:'context',__debug:ctx};}
var evaluated=ctx;switch(ctx.__ref){case'context':evaluation_context.context=evaluation_context;evaluated=py.eval(ctx.__debug,wrap_context(evaluation_context));break;case'compound_context':var eval_context=eval_contexts([ctx.__eval_context]);evaluated=eval_contexts(ctx.__contexts,_.extend({},evaluation_context,eval_context));break;}
_.extend(evaluation_context,evaluated);return _.extend(result_context,evaluated);},{});}
function eval_domains(domains,evaluation_context){evaluation_context=_.extend(pycontext(),evaluation_context||{});var result_domain=[];_(domains).each(function(domain){if(_.isString(domain)){domain={__ref:'domain',__debug:domain};}
switch(domain.__ref){case'domain':evaluation_context.context=evaluation_context;result_domain.push.apply(result_domain,py.eval(domain.__debug,wrap_context(evaluation_context)));break;case'compound_domain':var eval_context=eval_contexts([domain.__eval_context]);result_domain.push.apply(result_domain,eval_domains(domain.__domains,_.extend({},evaluation_context,eval_context)));break;default:result_domain.push.apply(result_domain,domain);}});return result_domain;}
function eval_groupbys(contexts,evaluation_context){evaluation_context=_.extend(pycontext(),evaluation_context||{});var result_group=[];_(contexts).each(function(ctx){if(_.isString(ctx)){ctx={__ref:'context',__debug:ctx};}
var group;var evaluated=ctx;switch(ctx.__ref){case'context':evaluation_context.context=evaluation_context;evaluated=py.eval(ctx.__debug,wrap_context(evaluation_context));break;case'compound_context':var eval_context=eval_contexts([ctx.__eval_context]);evaluated=eval_contexts(ctx.__contexts,_.extend({},evaluation_context,eval_context));break;}
group=evaluated.group_by;if(!group){return;}
if(typeof group==='string'){result_group.push(group);}else if(group instanceof Array){result_group.push.apply(result_group,group);}else{throw new Error('Got invalid groupby {{'
+JSON.stringify(group)+'}}');}
_.extend(evaluation_context,evaluated);});return result_group;}
function pycontext(){return _.extend({datetime:datetime,context_today:context_today,time:time,relativedelta:relativedelta,current_date:py.PY_call(time.strftime,[py.str.fromJSON('%Y-%m-%d')]),},session.user_context);}
function pyeval(type,object,context,options){options=options||{};context=_.extend(pycontext(),context||{});switch(type){case'context':case'contexts':if(type==='context')
object=[object];return eval_contexts((options.no_user_context?[]:[session.user_context]).concat(object),context);case'domain':case'domains':if(type==='domain')
object=[object];return eval_domains(object,context);case'groupbys':return eval_groupbys(object,context);}
throw new Error("Unknow evaluation type "+type);}
function eval_arg(arg){if(typeof arg!=='object'||!arg.__ref){return arg;}
switch(arg.__ref){case'domain':case'compound_domain':return pyeval('domains',[arg]);case'context':case'compound_context':return pyeval('contexts',[arg]);default:throw new Error(_t("Unknown nonliteral type "+arg.__ref));}}
function ensure_evaluated(args,kwargs){for(var i=0;i<args.length;++i){args[i]=eval_arg(args[i]);}
for(var k in kwargs){if(!kwargs.hasOwnProperty(k)){continue;}
kwargs[k]=eval_arg(kwargs[k]);}}
function eval_domains_and_contexts(source){return new $.Deferred(function(d){setTimeout(function(){var result;try{result=sync_eval_domains_and_contexts(source);}
catch(e){result={error:{code:400,message:_t("Evaluation Error"),data:{type:'local_exception',debug:_.str.sprintf(_t("Local evaluation failure\n%s\n\n%s"),e.message,JSON.stringify(source))}}};}
d.resolve(result);},0);});}
function sync_eval_domains_and_contexts(source){var contexts=([session.user_context]||[]).concat(source.contexts);return{context:pyeval('contexts',contexts),domain:pyeval('domains',source.domains),group_by:pyeval('groupbys',source.group_by_seq||[])};}
function py_eval(expr,context){return py.eval(expr,_.extend({},context||{},{"true":true,"false":false,"null":null}));}
return{context:pycontext,ensure_evaluated:ensure_evaluated,eval:pyeval,eval_domains_and_contexts:eval_domains_and_contexts,sync_eval_domains_and_contexts:sync_eval_domains_and_contexts,py_eval:py_eval,};});;

/* /web/static/src/js/action_manager.js defined in bundle 'web.assets_backend' */
odoo.define('web.ActionManager',function(require){"use strict";var ControlPanel=require('web.ControlPanel');var core=require('web.core');var crash_manager=require('web.crash_manager');var data=require('web.data');var Dialog=require('web.Dialog');var framework=require('web.framework');var pyeval=require('web.pyeval');var session=require('web.session');var ViewManager=require('web.ViewManager');var Widget=require('web.Widget');var Action=core.Class.extend({init:function(action){this.action_descr=action;this.title=action.display_name||action.name;},appendTo:function(){return $.Deferred().reject();},restore:function(){if(this.on_reverse_breadcrumb){return this.on_reverse_breadcrumb();}},detach:function(){},destroy:function(){},set_on_reverse_breadcrumb:function(on_reverse_breadcrumb){this.on_reverse_breadcrumb=on_reverse_breadcrumb;},set_fragment:function($fragment){this.$fragment=$fragment;},set_is_in_DOM:function(){},get_action_descr:function(){return this.action_descr;},get_breadcrumbs:function(){return{title:this.title,action:this};},get_nb_views:function(){return 0;},get_fragment:function(){return this.$fragment;},});var WidgetAction=Action.extend({init:function(action,widget){this._super(action);this.widget=widget;if(!this.widget.get('title')){this.widget.set('title',this.title);}
this.widget.on('change:title',this,function(widget){this.title=widget.get('title');});},appendTo:function(el){this.$client_action_container=$('<div>').addClass('oe_client_action');this.$client_action_container.appendTo(el);return this.widget.appendTo(this.$client_action_container);},restore:function(){var self=this;return $.when(this._super()).then(function(){return self.widget.do_show();});},detach:function(){return this.$client_action_container.detach();},destroy:function(){this.widget.destroy();this.detach();},});var ViewManagerAction=WidgetAction.extend({appendTo:function(el){return this.widget.appendTo(el);},restore:function(view_index){var _super=this._super.bind(this);return this.widget.select_view(view_index).then(function(){return _super();});},set_is_in_DOM:function(is_in_DOM){this.widget.is_in_DOM=is_in_DOM;},detach:function(){$('body > .nvtooltip').remove();return this.widget.$el.detach();},destroy:function(){this.widget.destroy();},get_breadcrumbs:function(){var self=this;return this.widget.view_stack.map(function(view,index){return{title:view.controller.get('title')||self.title,index:index,action:self,};});},get_nb_views:function(){return this.widget.view_stack.length;},});var ActionManager=Widget.extend({template:"ActionManager",init:function(parent){this._super(parent);this.action_stack=[];this.inner_action=null;this.inner_widget=null;this.webclient=parent;this.dialog=null;this.dialog_widget=null;this.dialog_stack=[];this.dialog_widget_stack=[];this.on('history_back',this,this.proxy('history_back'));},start:function(){this._super();this.main_control_panel=new ControlPanel(this);this.main_control_panel.on("on_breadcrumb_click",this,_.debounce(function(action,index){this.select_action(action,index);},200,true));this.main_control_panel.appendTo(this.$el);},dialog_stop:function(reason){if(this.dialog_stack.length>0){var dialog=this.dialog_stack[this.dialog_stack.length-1];dialog.destroy(reason);}else if(this.dialog){this.dialog.destroy(reason);this.dialog=null;}},push_action:function(widget,action_descr,options){var self=this;var old_widget=this.inner_widget;var old_action=this.inner_action;var old_action_stack=this.action_stack;options=options||{};if(options.clear_breadcrumbs){this.action_stack=[];}
var new_action;if(widget instanceof ViewManager){new_action=new ViewManagerAction(action_descr,widget);}else if(widget instanceof Widget){new_action=new WidgetAction(action_descr,widget);}else{new_action=new Action(action_descr);}
if(old_action){old_action.set_on_reverse_breadcrumb(options.on_reverse_breadcrumb);}
this.action_stack.push(new_action);this.inner_action=new_action;this.inner_widget=widget;if(widget.need_control_panel){widget.set_cp_bus(this.main_control_panel.get_bus());}
if(old_widget){old_widget.do_hide();}
var new_widget_fragment=document.createDocumentFragment();return $.when(this.inner_action.appendTo(new_widget_fragment)).done(function(){if(old_action){old_action.set_fragment(old_action.detach());old_action.set_is_in_DOM(false);}
if(!widget.need_control_panel){self.main_control_panel.do_hide();}
framework.append(self.$el,new_widget_fragment,true);self.inner_action.set_is_in_DOM(true);if(options.clear_breadcrumbs){self.clear_action_stack(old_action_stack);}}).fail(function(){new_action.destroy();self.action_stack=old_action_stack;self.inner_action=old_action;self.inner_widget=old_widget;});},get_breadcrumbs:function(){return _.flatten(_.map(this.action_stack,function(action){return action.get_breadcrumbs();}),true);},get_title:function(){if(this.action_stack.length===1){var action=this.action_stack[0];if(action.get_breadcrumbs().length===1){return action.title;}}
var last_breadcrumb=_.last(this.get_breadcrumbs());return last_breadcrumb?last_breadcrumb.title:"";},get_action_stack:function(){return this.action_stack;},get_inner_action:function(){return this.inner_action;},get_inner_widget:function(){return this.inner_widget;},history_back:function(){var nb_views=this.inner_action.get_nb_views();if(nb_views>1){return this.select_action(this.inner_action,nb_views-2);}
if(this.action_stack.length>1){var action=this.action_stack[this.action_stack.length-2];nb_views=action.get_nb_views();return this.select_action(action,nb_views-1);}
return $.Deferred().reject();},select_action:function(action,index){var self=this;return this.webclient.clear_uncommitted_changes().then(function(){var old_action=self.inner_action;var action_index=self.action_stack.indexOf(action);var to_destroy=self.action_stack.splice(action_index+1);self.inner_action=action;self.inner_widget=action.widget;if(!self.inner_widget.need_control_panel){self.main_control_panel.do_hide();}
return $.when(action.restore(index)).done(function(){if(action!==old_action){self.clear_action_stack(to_destroy);framework.append(self.$el,action.get_fragment(),true);self.inner_action.set_is_in_DOM(true);$('header.o_statusbar_buttons').width($('header.o_statusbar_buttons').parent().width()+20);}});}).fail(function(){return $.Deferred().reject();});},clear_action_stack:function(action_stack){_.map(action_stack||this.action_stack,function(action){action.destroy();});if(!action_stack){this.action_stack=[];this.inner_action=null;this.inner_widget=null;}},do_push_state:function(state){if(!this.webclient||!this.webclient.do_push_state||this.dialog){return;}
state=state||{};if(this.inner_action){var inner_action_descr=this.inner_action.get_action_descr();if(inner_action_descr._push_me===false){return;}
state.title=this.get_title();if(inner_action_descr.type=='ir.actions.act_window'){state.model=inner_action_descr.res_model;}
if(inner_action_descr.menu_id){state.menu_id=inner_action_descr.menu_id;}
if(inner_action_descr.id){state.action=inner_action_descr.id;}else if(inner_action_descr.type=='ir.actions.client'){state.action=inner_action_descr.tag;var params={};_.each(inner_action_descr.params,function(v,k){if(_.isString(v)||_.isNumber(v)){params[k]=v;}});state=_.extend(params||{},state);}
if(inner_action_descr.context){var active_id=inner_action_descr.context.active_id;if(active_id){state.active_id=active_id;}
var active_ids=inner_action_descr.context.active_ids;if(active_ids&&!(active_ids.length===1&&active_ids[0]===active_id)){state.active_ids=inner_action_descr.context.active_ids.join(',');}}}
this.webclient.do_push_state(state);},do_load_state:function(state,warm){var self=this;var action_loaded;if(state.action){if(_.isString(state.action)&&core.action_registry.contains(state.action)){var action_client={type:"ir.actions.client",tag:state.action,params:state,_push_me:state._push_me,};if(warm){this.null_action();}
action_loaded=this.do_action(action_client);}else{var run_action=(!this.inner_widget||!this.inner_widget.action)||this.inner_widget.action.id!==state.action;if(run_action){var add_context={};if(state.active_id){add_context.active_id=state.active_id;}
if(state.active_ids){add_context.active_ids=state.active_ids.toString().split(',').map(function(id){return parseInt(id,10)||id;});}else if(state.active_id){add_context.active_ids=[state.active_id];}
add_context.params=state;if(warm){this.null_action();}
action_loaded=this.do_action(state.action,{additional_context:add_context,state:state});$.when(action_loaded||null).done(function(){self.webclient.menu.is_bound.done(function(){if(self.inner_action&&self.inner_action.get_action_descr().id){self.webclient.menu.open_action(self.inner_action.get_action_descr().id);}});});}}}else if(state.model&&state.id){if(warm){this.null_action();}
var action={res_model:state.model,res_id:state.id,type:'ir.actions.act_window',views:[[_.isNumber(state.view_id)?state.view_id:false,'form']]};action_loaded=this.do_action(action);}else if(state.sa){if(warm){this.null_action();}
action_loaded=this.rpc('/web/session/get_session_action',{key:state.sa}).then(function(action){if(action){return self.do_action(action);}});}
$.when(action_loaded||null).done(function(){if(self.inner_widget&&self.inner_widget.do_load_state){self.inner_widget.do_load_state(state,warm);}});},do_action:function(action,options){options=_.defaults(options||{},{clear_breadcrumbs:false,on_reverse_breadcrumb:function(){},hide_breadcrumb:false,on_close:function(){},action_menu_id:null,additional_context:{},});if(action===false){action={type:'ir.actions.act_window_close'};}else if(_.isString(action)&&core.action_registry.contains(action)){var action_client={type:"ir.actions.client",tag:action,params:{}};return this.do_action(action_client,options);}else if(_.isNumber(action)||_.isString(action)){var self=this;var additional_context={active_id:options.additional_context.active_id,active_ids:options.additional_context.active_ids,active_model:options.additional_context.active_model};return self.rpc("/web/action/load",{action_id:action,additional_context:additional_context}).then(function(result){return self.do_action(result,options);});}
core.bus.trigger('action',action);var ncontext=new data.CompoundContext(options.additional_context,action.context||{});action.context=pyeval.eval('context',ncontext);if(action.context.active_id||action.context.active_ids){action.context.search_disable_custom_filters=true;}
if(action.domain){action.domain=pyeval.eval('domain',action.domain,action.context||{});}
if(!action.type){console.error("No type for action",action);return $.Deferred().reject();}
var type=action.type.replace(/\./g,'_');action.menu_id=options.action_menu_id;action.context.params=_.extend({'action':action.id},action.context.params);if(!(type in this)){console.error("Action manager can't handle action of type "+action.type,action);return $.Deferred().reject();}
if(action.res_model==='board.board'&&action.view_mode==='form'){action.target='inline';_.extend(action.flags,{headless:true,views_switcher:false,display_title:false,search_view:false,pager:false,sidebar:false,action_buttons:false});}
if(action.view_mode==='simple'){_.extend(action.flags,{headless:true,views_switcher:false,display_title:false,search_view:false,pager:false,sidebar:false,action_buttons:false});}
else{var popup=action.target==='new'||action.target==='stack';var inline=action.target==='inline'||action.target==='inlineview';var form=_.str.startsWith(action.view_mode,'form');action.flags=_.defaults(action.flags||{},{views_switcher:!popup&&!inline,search_view:!(popup&&form)&&!inline,action_buttons:!popup&&!inline,sidebar:!popup&&!inline,pager:(!popup||!form)&&!inline,display_title:!popup,headless:(popup||inline)&&form,search_disable_custom_filters:action.context&&action.context.search_disable_custom_filters,});}
return this[type](action,options);},null_action:function(){this.dialog_stop();this.clear_action_stack();},ir_actions_common:function(executor,options){if(executor.action.target==='stack'){var dialog=new Dialog(this,{title:executor.action.name,dialogClass:executor.klass,buttons:[]});var self=this;dialog.on_close=function(){options.on_close.apply(null,arguments);self.dialog_stack.pop();self.dialog_widget_stack.pop();};dialog.on("closed",null,dialog.on_close);var dialog_widget=executor.widget();if(dialog_widget instanceof ViewManager){_.extend(dialog_widget.flags,{$buttons:dialog.$footer,footer_to_buttons:true,});if(dialog_widget.action.view_mode==='form'){dialog_widget.flags.headless=true;}}
if(dialog_widget.need_control_panel){dialog_widget.set_cp_bus(new core.Bus());}
dialog_widget.setParent(dialog);dialog.open()
this.dialog_stack.push(dialog);this.dialog_widget_stack.push(dialog_widget);return dialog_widget.appendTo(dialog.$el);}
if(executor.action.target==='new'){var pre_dialog=(this.dialog&&!this.dialog.isDestroyed())?this.dialog:null;if(pre_dialog){pre_dialog.off('closed',null,pre_dialog.on_close);}
if(this.dialog_widget&&!this.dialog_widget.isDestroyed()){this.dialog_widget.destroy();}
this.dialog_stop(executor.action);this.dialog=new Dialog(this,{title:executor.action.name,dialogClass:executor.klass,buttons:[],size:executor.action.context.dialog_size||'large',});this.dialog.on_close=function(){options.on_close.apply(null,arguments);if(pre_dialog&&pre_dialog.on_close){pre_dialog.on_close();}};this.dialog.on("closed",null,this.dialog.on_close);this.dialog_widget=executor.widget();if(this.dialog_widget instanceof ViewManager){_.extend(this.dialog_widget.flags,{$buttons:this.dialog.$footer,footer_to_buttons:true,});if(this.dialog_widget.action.view_mode==='form'){this.dialog_widget.flags.headless=true;}}
if(this.dialog_widget.need_control_panel){this.dialog_widget.set_cp_bus(new core.Bus());}
this.dialog_widget.setParent(this.dialog);this.dialog.open();return this.dialog_widget.appendTo(this.dialog.$el);}
var self=this;var def=(this.inner_widget&&this.webclient.clear_uncommitted_changes())||$.when();return def.then(function(){self.dialog_stop(executor.action);return self.push_action(executor.widget(),executor.action,options).then(function(){$('.home_selected').removeClass('home_selected').hide();$('.oe_application').show();});}).fail(function(){return $.Deferred().reject();});},ir_actions_act_window:function(action,options){var self=this;if(action.context.on_close_method){options.on_close=_.wrap(options.on_close,function(f){var Model=require('web.Model');var model=new Model(self.inner_action.action_descr.res_model);model.call(action.context.on_close_method,[self.inner_widget.dataset.ids[self.inner_widget.dataset.index]]);f();})}
return this.ir_actions_common({widget:function(){return new ViewManager(self,null,null,null,action,options);},action:action,klass:'o_act_window',},options);},ir_actions_client:function(action,options){var self=this;var ClientWidget=core.action_registry.get(action.tag);if(!ClientWidget){return self.do_warn("Action Error","Could not find client action '"+action.tag+"'.");}
if(!(ClientWidget.prototype instanceof Widget)){var next;if((next=ClientWidget(this,action))){return this.do_action(next,options);}
return $.when();}
return this.ir_actions_common({widget:function(){return new ClientWidget(self,action,options);},action:action,klass:'oe_act_client',},options).then(function(){if(action.tag!=='reload'){self.do_push_state({});}});},ir_actions_act_window_close:function(action,options){if(!this.dialog){options.on_close();}
this.dialog_stop();return $.when();},ir_actions_act_window_view_reload:function(action,options){this.ir_actions_act_window_close(action,options);this.inner_widget.active_view.controller.reload();},ir_actions_server:function(action,options){var self=this;this.rpc('/web/action/run',{action_id:action.id,context:action.context||{}}).done(function(action){self.do_action(action,options);});},ir_actions_report_xml:function(action,options){var self=this;framework.blockUI();action=_.clone(action);var eval_contexts=([session.user_context]||[]).concat([action.context]);action.context=pyeval.eval('contexts',eval_contexts);if(navigator.userAgent.match(/(iPod|iPhone|iPad)/)){var params={action:JSON.stringify(action),token:new Date().getTime()};var url=self.session.url('/web/report',params);framework.unblockUI();$('<a href="'+url+'" target="_blank"></a>')[0].click();return;}
var c=crash_manager;return $.Deferred(function(d){var domain=_.reduce(_.map(self.get_inner_widget().searchview.build_search_data().domains,function(domain){if(_.isString(domain)){return py.eval(domain);}else if(_.isArray(domain)){return domain;}else{return domain.eval();}}),function(memo,num){return Array.prototype.concat(memo,num);},[]);domain.concat(self.get_inner_widget().dataset.domain);self.session.get_file({url:'/web/report',data:{action:JSON.stringify(action),domain:domain,groupby:self.get_inner_widget().searchview.build_search_data().groupbys},complete:framework.unblockUI,success:function(){if(!self.dialog){options.on_close();}
self.dialog_stop();d.resolve();},error:function(){c.rpc_error.apply(c,arguments);d.reject();}});});},ir_actions_act_url:function(action){var url=action.url;if(session.debug&&url&&url.length&&url[0]==='/'){url=$.param.querystring(url,'debug');}
if(action.target==='self'){framework.redirect(url);}else{window.open(url,'_blank');}
return $.when();},});return ActionManager;});;

/* /web/static/src/js/control_panel.js defined in bundle 'web.assets_backend' */
odoo.define('web.ControlPanelMixin',function(require){"use strict";var ControlPanelMixin={need_control_panel:true,set_cp_bus:function(cp_bus){this.cp_bus=cp_bus;},update_control_panel:function(cp_status,options){this.cp_bus.trigger("update",cp_status||{},options||{});},};return ControlPanelMixin;});odoo.define('web.ControlPanel',function(require){"use strict";var core=require('web.core');var Widget=require('web.Widget');var ControlPanel=Widget.extend({template:'ControlPanel',init:function(parent,template){this._super(parent);if(template){this.template=template;}
this.bus=new core.Bus();this.bus.on("update",this,this.update);},start:function(){this.$title_col=this.$('.oe-cp-title');this.nodes={$breadcrumbs:this.$('.oe-view-title'),$buttons:this.$('.oe-cp-buttons'),$pager:this.$('.oe-cp-pager'),$searchview:this.$('.oe-cp-search-view'),$searchview_buttons:this.$('.oe-search-options'),$sidebar:this.$('.oe-cp-sidebar'),$switch_buttons:this.$('.oe-cp-switch-buttons'),};this._toggle_visibility(false);return this._super();},get_bus:function(){return this.bus;},update:function(status,options){this._toggle_visibility(!status.hidden);if(!status.hidden){options=_.defaults({},options,{clear:true,});var new_cp_content=status.cp_content||{};if(status.breadcrumbs){new_cp_content.$breadcrumbs=this._render_breadcrumbs(status.breadcrumbs);}
if(options.clear){this._detach_content(this.nodes);this.nodes.$searchview_buttons.show();}else{this._detach_content(_.pick(this.nodes,_.keys(new_cp_content)));}
this._attach_content(new_cp_content);this._update_search_view(status.searchview,status.search_view_hidden);if(status.active_view_selector){this._update_switch_buttons(status.active_view_selector);}}},_toggle_visibility:function(visible){this.do_toggle(visible);if(!visible&&!this.$content){this.$content=this.$el.contents().detach();}else if(this.$content){this.$content.appendTo(this.$el);this.$content=null;}},_detach_content:function(elements_to_detach){_.each(elements_to_detach,function($nodeset){$nodeset.contents().detach();});},_attach_content:function(content){var self=this;_.each(content,function($nodeset,$element){if($nodeset&&self.nodes[$element]){self.nodes[$element].append($nodeset);}});},_update_switch_buttons:function(active_view_selector){_.each(this.nodes.$switch_buttons.find('button'),function(button){$(button).removeClass('active');});this.$(active_view_selector).addClass('active');},_render_breadcrumbs:function(breadcrumbs){var self=this;return breadcrumbs.map(function(bc,index){return make_breadcrumb(bc,index===breadcrumbs.length-1);});function make_breadcrumb(bc,is_last){var $bc=$('<li>').append(is_last?_.escape(bc.title):$('<a>').text(bc.title)).toggleClass('active',is_last);if(!is_last){$bc.click(function(){self.trigger("on_breadcrumb_click",bc.action,bc.index);});}
return $bc;}},_update_search_view:function(searchview,is_hidden){if(searchview){searchview.$buttons=this.nodes.$searchview_buttons;searchview.toggle_visibility(!is_hidden);this.$title_col.toggleClass('col-md-6',!is_hidden).toggleClass('col-md-12',is_hidden);}},});return ControlPanel;});;

/* /web/static/src/js/view_manager.js defined in bundle 'web.assets_backend' */
odoo.define('web.ViewManager',function(require){"use strict";var ControlPanelMixin=require('web.ControlPanelMixin');var core=require('web.core');var data=require('web.data');var framework=require('web.framework');var Model=require('web.DataModel');var pyeval=require('web.pyeval');var SearchView=require('web.SearchView');var Widget=require('web.Widget');var QWeb=core.qweb;var _t=core._t;var ViewManager=Widget.extend(ControlPanelMixin,{template:"ViewManager",init:function(parent,dataset,views,flags,action,options){if(action){flags=action.flags||{};if(!('auto_search'in flags)){flags.auto_search=action.auto_search!==false;}
this.action=action;this.action_manager=parent;dataset=new data.DataSetSearch(this,action.res_model,action.context,action.domain);if(action.res_id){dataset.ids.push(action.res_id);dataset.index=0;}
views=action.views;}
var self=this;this._super(parent);this.flags=flags||{};this.dataset=dataset;this.view_order=[];this.views={};this.view_stack=[];this.active_view=null;this.registry=core.view_registry;this.title=this.action&&this.action.name;this.is_in_DOM=false;_.each(views,function(view){var view_type=view[1]||view.view_type;var View=core.view_registry.get(view_type,true);if(!View){console.error("View type","'"+view[1]+"'","is not present in the view registry.");return;}
var view_label=View.prototype.display_name;var view_descr={controller:null,options:view.options||{},view_id:view[0]||view.view_id,type:view_type,label:view_label,embedded_view:view.embedded_view,title:self.title,button_label:_.str.sprintf(_t('%(view_type)s view'),{'view_type':(view_label||view_type)}),multi_record:View.prototype.multi_record,accesskey:View.prototype.accesskey,icon:View.prototype.icon,};self.view_order.push(view_descr);self.views[view_type]=view_descr;});if(options&&options.state&&options.state.view_type){var view_type=options.state.view_type;var view_descr=this.views[view_type];this.default_view=view_descr&&view_descr.multi_record?view_type:undefined;}
this.on('switch_view',this,function(view_type){if(view_type==='form'&&this.active_view&&this.active_view.type==='form'){this._display_view(view_type);}else{this.switch_mode(view_type);}});},start:function(){var self=this;var default_view=this.get_default_view();var default_options=this.flags[default_view]&&this.flags[default_view].options;this._super();var views_ids={};_.each(this.views,function(view){views_ids[view.type]=view.view_id;view.options=_.extend({action:self.action,action_views_ids:views_ids,},self.flags,self.flags[view.type],view.options);view.$container=self.$(".oe-view-manager-view-"+view.type);});this.$el.addClass("oe_view_manager_"+((this.action&&this.action.target)||'current'));this.control_elements={};if(this.flags.search_view){this.search_view_loaded=this.setup_search_view();}
if(this.flags.views_switcher){this.render_switch_buttons();}
var main_view_loaded=this.switch_mode(default_view,null,default_options);return $.when(main_view_loaded,this.search_view_loaded);},get_default_view:function(){return this.default_view||this.flags.default_view||this.view_order[0].type;},switch_mode:function(view_type,no_store,view_options){var self=this;var view=this.views[view_type];var old_view=this.active_view;if(!view||this.currently_switching){return $.Deferred().reject();}else{this.currently_switching=true;}
if(view.multi_record){this.view_stack=[];}else if(this.view_stack.length>0&&!(_.last(this.view_stack).multi_record)){this.view_stack.pop();}
this.view_stack.push(view);this.active_view=view;if(!view.created){view.created=this.create_view.bind(this)(view,view_options);}
if(this.search_view_loaded&&this.flags.auto_search&&view.controller.searchable!==false){this.active_search=$.Deferred();$.when(this.search_view_loaded,view.created).done(function(){self.searchview.do_search();});}
if(old_view){old_view.$container.contents().not('.ui-autocomplete').detach();if(self.active_view!==old_view){if(old_view.controller)old_view.controller.do_hide();if(old_view.$container)old_view.$container.hide();}}
var switched=$.when(view.created,this.active_search).then(function(){return self._display_view(view_options,old_view).then(function(){self.trigger('switch_mode',view_type,no_store,view_options);});});switched.fail(function(e){if(!(e&&e.code===200&&e.data.exception_type)){self.do_warn(_t("Error"),view.controller.display_name+_t(" view couldn't be loaded"));}
self.active_view=old_view;self.view_stack.pop();});switched.always(function(){self.currently_switching=false;});return switched;},_display_view:function(view_options,old_view){var self=this;var view_controller=this.active_view.controller;var view_fragment=this.active_view.$fragment;var view_control_elements=this.render_view_control_elements();this.active_view.$container.show();return $.when(view_controller.do_show(view_options)).done(function(){var cp_status={active_view_selector:'.oe-cp-switch-'+self.active_view.type,breadcrumbs:self.action_manager&&self.action_manager.get_breadcrumbs(),cp_content:_.extend({},self.control_elements,view_control_elements),hidden:self.flags.headless,searchview:self.searchview,search_view_hidden:view_controller.searchable===false||view_controller.searchview_hidden,};self.update_control_panel(cp_status);if(old_view){old_view.$container.contents().not('.ui-autocomplete').detach();if(self.active_view!==old_view){if(old_view.controller)old_view.controller.do_hide();if(old_view.$container)old_view.$container.hide();}}
framework.append(self.active_view.$container,view_fragment,self.is_in_DOM);});},create_view:function(view,view_options){var self=this;var View=this.registry.get(view.type);var options=_.clone(view.options);var view_loaded=$.Deferred();if(view.type==="form"&&((this.action&&(this.action.target==='new'||this.action.target==='inline'||this.action.target==='stack'))||(view_options&&view_options.mode==='edit'))){options.initial_mode=options.initial_mode||'edit';}
var controller=new View(this,this.dataset,view.view_id,options);view.controller=controller;view.$fragment=$('<div>');if(view.embedded_view){controller.set_embedded_view(view.embedded_view);}
controller.on('switch_mode',this,this.switch_mode.bind(this));controller.on('history_back',this,function(){if(self.action_manager)self.action_manager.trigger('history_back');});controller.on("change:title",this,function(){if(self.action_manager&&!self.flags.headless){var breadcrumbs=self.action_manager.get_breadcrumbs();self.update_control_panel({breadcrumbs:breadcrumbs},{clear:false});}});controller.on('view_loaded',this,function(){view_loaded.resolve();});return $.when(controller.appendTo(view.$fragment),view_loaded).done(function(){view.$fragment=view.$fragment.contents();self.trigger("controller_inited",view.type,controller);});},select_view:function(index){var view_type=this.view_stack[index].type;return this.switch_mode(view_type);},render_switch_buttons:function(){if(this.flags.views_switcher&&this.view_order.length>1){var self=this;this.control_elements.$switch_buttons=$(QWeb.render('ViewManager.switch-buttons',{views:self.view_order}));_.each(this.views,function(view){self.control_elements.$switch_buttons.siblings('.oe-cp-switch-'+view.type).tooltip();});this.control_elements.$switch_buttons.siblings('button').click(_.debounce(function(event){var view_type=$(event.target).data('view-type');self.switch_mode(view_type);},200,true));}},render_view_control_elements:function(){if(!this.active_view.control_elements){var view_controller=this.active_view.controller;var elements={};if(!this.flags.headless){elements={$buttons:!this.flags.footer_to_buttons?$("<div>"):undefined,$sidebar:$("<div>"),$pager:$("<div>"),};}
view_controller.render_buttons(elements.$buttons);view_controller.render_sidebar(elements.$sidebar);view_controller.render_pager(elements.$pager);elements=_.mapObject(elements,function($node){return $node&&$node.contents();});this.active_view.control_elements=elements;}
return this.active_view.control_elements;},get_view_id:function(view_type){return this.views[view_type]&&this.views[view_type].view_id||false;},setup_search_view:function(){var self=this;if(this.searchview){this.searchview.destroy();}
var view_id=(this.action&&this.action.search_view_id&&this.action.search_view_id[0])||false;var search_defaults={};var context=this.action?this.action.context:[];_.each(context,function(value,key){var match=/^search_default_(.*)$/.exec(key);if(match){search_defaults[match[1]]=value;}});var options={hidden:this.flags.search_view===false,disable_custom_filters:this.flags.search_disable_custom_filters,$buttons:$("<div>"),action:this.action,};this.searchview=new SearchView(this,this.dataset,view_id,search_defaults,options);this.searchview.on('search_data',this,this.search.bind(this));return $.when(this.searchview.appendTo($("<div>"))).done(function(){self.control_elements.$searchview=self.searchview.$el;self.control_elements.$searchview_buttons=self.searchview.$buttons.contents();});},search:function(domains,contexts,groupbys){var self=this;var controller=this.active_view.controller;var action_context=this.action.context||{};var view_context=controller.get_context();pyeval.eval_domains_and_contexts({domains:[this.action.domain||[]].concat(domains||[]),contexts:[action_context,view_context].concat(contexts||[]),group_by_seq:groupbys||[]}).done(function(results){if(results.error){self.active_search.resolve();throw new Error(_.str.sprintf(_t("Failed to evaluate search criterions")+": \n%s",JSON.stringify(results.error)));}
self.dataset._model=new Model(self.dataset.model,results.context,results.domain);var groupby=results.group_by.length?results.group_by:action_context.group_by;if(_.isString(groupby)){groupby=[groupby];}
if(!controller.grouped&&!_.isEmpty(groupby)){self.dataset.set_sort([]);}
$.when(controller.do_search(results.domain,results.context,groupby||[])).then(function(){self.active_search.resolve();});});},do_push_state:function(state){if(this.action_manager){state.view_type=this.active_view.type;this.action_manager.do_push_state(state);}},do_load_state:function(state,warm){if(state.view_type&&state.view_type!==this.active_view.type){this.switch_mode(state.view_type,true);}
this.active_view.controller.do_load_state(state,warm);},});return ViewManager;});;

/* /web/static/src/js/web_client.js defined in bundle 'web.assets_backend' */
odoo.define('web.WebClient',function(require){"use strict";var ActionManager=require('web.ActionManager');var core=require('web.core');var crash_manager=require('web.crash_manager');var data=require('web.data');var framework=require('web.framework');var Loading=require('web.Loading');var Menu=require('web.Menu');var Model=require('web.DataModel');var NotificationManager=require('web.notification').NotificationManager;var session=require('web.session');var SystrayMenu=require('web.SystrayMenu');var UserMenu=require('web.UserMenu');var utils=require('web.utils');var Widget=require('web.Widget');var QWeb=core.qweb;var _t=core._t;var WebClient=Widget.extend({events:{'click .oe_logo_edit_admin':'logo_edit','click .oe_logo img':'on_logo_click','click #btn_home':'on_home_click','click .btn_home_menu':'on_home_menu_click','click .home_selected a':'on_link_home','click .edit_page':'on_edit_page',},custom_events:{'notification':function(e){if(this.notification_manager){this.notification_manager.notify(e.data.title,e.data.message,e.data.sticky);}},'warning':function(e){if(this.notification_manager){this.notification_manager.warn(e.data.title,e.data.message,e.data.sticky);}},},init:function(parent,client_options){this.client_options={};this._super(parent);this.origin=undefined;if(client_options){_.extend(this.client_options,client_options);}
this._current_state=null;this.menu_dm=new utils.DropMisordered();this.action_mutex=new utils.Mutex();this.set('title_part',{"zopenerp":"Open-prod"});},start:function(){var self=this;this.on("change:title_part",this,this._title_changed);this._title_changed();core.bus.on('web_client_toggle_bars',this,function(){this.toggle_bars.apply(this,arguments);});document.body.classList.add('o_web_client');return session.session_bind(this.origin).then(function(){self.bind_events();return self.show_common();}).then(function(){if(session.session_is_valid()){self.show_application();}
if(self.client_options.action){self.action_manager.do_action(self.client_options.action);delete(self.client_options.action);}
core.bus.trigger('web_client_ready');});},bind_events:function(){var self=this;$('.oe_systray').show();this.$el.on('mouseenter','.oe_systray > div:not([data-toggle=tooltip])',function(){$(this).attr('data-toggle','tooltip').tooltip().trigger('mouseenter');});this.$el.on('click','.oe_dropdown_toggle',function(ev){ev.preventDefault();var $toggle=$(this);var doc_width=$(document).width();var $menu=$toggle.siblings('.oe_dropdown_menu');$menu=$menu.size()>=1?$menu:$toggle.find('.oe_dropdown_menu');var state=$menu.is('.oe_opened');setTimeout(function(){$toggle.add($menu).toggleClass('oe_opened',!state);if(!state){var offset=$menu.offset();var menu_width=$menu.width();var x=doc_width-offset.left-menu_width-2;if(x<0){$menu.offset({left:offset.left+x}).width(menu_width);}}},0);});core.bus.on('click',this,function(ev){$('.tooltip').remove();if(!$(ev.target).is('input[type=file]')){self.$el.find('.oe_dropdown_menu.oe_opened, .oe_dropdown_toggle.oe_opened').removeClass('oe_opened');}});core.bus.on('set_full_screen',this,function(full_screen){this.set_content_full_screen(full_screen);});},on_logo_click:function(ev){ev.preventDefault();return this.clear_uncommitted_changes().then(function(){framework.redirect("/web"+(core.debug?"?debug":""));});},show_common:function(){var self=this;session.on('error',crash_manager,crash_manager.rpc_error);self.notification_manager=new NotificationManager(this);self.notification_manager.appendTo(self.$('.openerp'));self.loading=new Loading(self);self.loading.appendTo(self.$('.openerp_webclient_container'));self.action_manager=new ActionManager(self);self.action_manager.replace(self.$('.oe_application'));window.onerror=function(message,file,line,col,error){var traceback=error?error.stack:'';crash_manager.show_error({type:_t("Client Error"),message:message,data:{debug:file+':'+line+"\n"+_t('Traceback:')+"\n"+traceback}});};if(!session.registered_contract){self.$el.append('<h3 style="color:red; position:absolute; bottom: 0;text-align:center;width:100%">'+_t('Demonstration version, not suitable for production')+'</h1>');};},toggle_bars:function(value){this.$('tr:has(td.navbar),.oe_leftbar').toggle(value);},clear_uncommitted_changes:function(){var def=$.Deferred().resolve();core.bus.trigger('clear_uncommitted_changes',function chain_callbacks(callback){def=def.then(callback);});return def;},set_title:function(title){this.set_title_part("action",title);},set_title_part:function(part,title){var tmp=_.clone(this.get("title_part"));tmp[part]=title;this.set("title_part",tmp);},_title_changed:function(){var parts=_.sortBy(_.keys(this.get("title_part")),function(x){return x;});var tmp="";_.each(parts,function(part){var str=this.get("title_part")[part];if(str){tmp=tmp?tmp+" - "+str:str;}},this);document.title=tmp;},show_application:function(){var self=this;self.toggle_bars(true);self.update_logo();self.menu=new Menu(self);self.menu.setElement(this.$el.parents().find('.oe_application_menu_placeholder'));self.menu.on('menu_click',this,this.on_menu_action);self.user_menu=new UserMenu(self);var user_menu_loaded=self.user_menu.appendTo(this.$el.parents().find('.oe_user_menu_placeholder'));self.user_menu.on('user_logout',self,self.on_logout);self.user_menu.do_update();self.systray_menu=new SystrayMenu(self);self.systray_menu.setElement(this.$el.parents().find('.oe_systray'));var systray_menu_loaded=self.systray_menu.start();$.when(systray_menu_loaded,user_menu_loaded).done(function(){self.menu.start();});self.bind_hashchange();self.set_title();if(self.client_options.action_post_login){self.action_manager.do_action(self.client_options.action_post_login);delete(self.client_options.action_post_login);}},update_logo:function(){var company=session.company_id;var img=session.url('/web/binary/company_logo'+'?db='+session.db+(company?'&company='+company:''));this.$('.oe_logo img').attr('src','').attr('src',img);this.$('.oe_logo_edit').toggleClass('oe_logo_edit_admin',session.uid===1);},logo_edit:function(ev){var self=this;ev.preventDefault();self.alive(new Model("res.users").get_func("read")(session.uid,["company_id"])).then(function(res){self.rpc("/web/action/load",{action_id:"base.action_res_company_form"}).done(function(result){result.res_id=res.company_id[0];result.target="new";result.views=[[false,'form']];result.flags={action_buttons:true,headless:true,};self.action_manager.do_action(result);var form=self.action_manager.dialog_widget.views.form.controller;form.on("on_button_cancel",self.action_manager,self.action_manager.dialog_stop);form.on('record_saved',self,function(){self.action_manager.dialog_stop();self.update_logo();});});});return false;},do_action:function(){return this.action_manager.do_action.apply(this,arguments);},destroy_content:function(){_.each(_.clone(this.getChildren()),function(el){el.destroy();});this.$el.children().remove();},do_reload:function(){var self=this;return this.session.session_reload().then(function(){session.load_modules(true).then(self.menu.proxy('do_reload'));});},on_logout:function(){var self=this;this.clear_uncommitted_changes().then(function(){self.action_manager.do_action('logout');});},bind_hashchange:function(){var self=this;$(window).bind('hashchange',this.on_hashchange);var state=$.bbq.getState(true);if(_.isEmpty(state)||state.action=="login"){this.on_home_click();}else{$(window).trigger('hashchange');}},on_hashchange:function(event){var self=this;var stringstate=event.getState(false);if(!_.isEqual(this._current_state,stringstate)){var state=event.getState(true);if(!state.action&&state.menu_id){self.menu.is_bound.done(function(){self.menu.menu_click(state.menu_id);});}else{state._push_me=false;this.action_manager.do_load_state(state,!!this._current_state);}}
this._current_state=stringstate;},do_push_state:function(state){this.set_title(state.title);delete state.title;var url='#'+$.param(state);this._current_state=$.deparam($.param(state),false);$.bbq.pushState(url);this.trigger('state_pushed',state);},on_menu_action:function(options){var self=this;return this.menu_dm.add(this.rpc("/web/action/load",{action_id:options.action_id})).then(function(result){return self.action_mutex.exec(function(){if(options.needaction){result.context=new data.CompoundContext(result.context,{search_default_message_needaction:true,search_disable_custom_filters:true,});}
var completed=$.Deferred();$.when(self.action_manager.do_action(result,{clear_breadcrumbs:true,action_menu_id:self.menu.current_menu,})).fail(function(){self.menu.open_menu(options.previous_menu_id);}).always(function(){completed.resolve();});setTimeout(function(){completed.resolve();},2000);completed.then(function(){if(['new','stack'].indexOf(result.target)==-1){$('.home_selected').removeClass('home_selected').hide();$('.oe_application').show();}});return completed;});});},on_home_click:function(){var self=this;this.clear_uncommitted_changes().then(function(){self.$el.find('.oe_webclient').hide();self.$el.find('#homepage').show();self.$el.find('#favorites').hide();});},on_home_menu_click:function(ev){var menu_id=ev.currentTarget.dataset.menu;if(menu_id){var target_menu=$("a[data-menu="+menu_id+"]");if(target_menu.length&&target_menu.data('actionModel')=='ir.actions.act_url'){this.do_action(target_menu.data('actionId'));}
this.$el.find('.oe_webclient').show();this.$el.find('#homepage').hide();this.$el.find('#favorites').hide();this.menu.on_change_top_menu(menu_id,false);}},on_link_home:function(ev){if(ev.target.href==window.location.href){$('.home_selected').removeClass('home_selected').hide();$('.oe_application').show();}},on_edit_page:function(ev){var page_id=parseInt(ev.target.dataset.pageId);var html_to_edit=ev.target.previousElementSibling.outerHTML;var child=$('<div class="modal" style="display:none">\
    	                    <div class="modal-dialog modal-lg">\
    						  <iframe src="/web_openprod/static/editor/index.html" class="modal-content" style="width: 100%;height:100%" />\
    						</div>\
    					</div>').prependTo('body');var iframe=child.find('iframe');iframe.on('load',function(){$(iframe[0].contentDocument.body).find('#editor').html(html_to_edit);var editorValidation=$.Deferred();editorValidation.then(function(res){ev.target.previousElementSibling.outerHTML=res;(new Model('web.page')).call('write',[page_id,{inner_content:res}]);child.modal('hide');child.remove();},function(){child.modal('hide');child.remove();});iframe[0].contentWindow.editorValidation=editorValidation;iframe[0].contentWindow.Model=Model;iframe[0].contentWindow._t=core._t;iframe[0].contentWindow.session=session;iframe[0].contentWindow.page_id=page_id;var $if=iframe[0].contentWindow.jQuery;$if('#editor').gridEditor({new_row_layouts:[[12],[6,6],[9,3]],content_types:['trumbowyg'],trumbowyg:{csrf_token:core.csrf_token}});$if('#editor').on('dragstart','img',false);});child.modal();child.on('hidden.bs.modal',function(){child.remove();});},set_content_full_screen:function(fullscreen){$(document.body).css('overflow-y',fullscreen?'hidden':'scroll');this.$('.oe_webclient').toggleClass('oe_content_full_screen',fullscreen);},});return WebClient;});;

/* /web/static/src/js/framework/data.js defined in bundle 'web.assets_backend' */
odoo.define('web.data',function(require){"use strict";var core=require('web.core');var Model=require('web.Model');var session=require('web.session');var pyeval=require('web.pyeval');var utils=require('web.utils');var Class=core.Class;var mixins=core.mixins;var _t=core._t;function serialize_sort(criterion){return _.map(criterion,function(criteria){if(criteria[0]==='-'){return criteria.slice(1)+' DESC';}
return criteria+' ASC';}).join(', ');}
function deserialize_sort(criterion){return _.map(criterion,function(criteria){var split=_.without(criteria.split(' '),'');return(split[1]&&split[1].toLowerCase()==='desc'?'-':'')+split[0];});}
var Query=Class.extend({init:function(model,fields){this._model=model;this._fields=fields;this._filter=[];this._context={};this._lazy=true;this._limit=false;this._offset=0;this._order_by=[];},clone:function(to_set){to_set=to_set||{};var q=new Query(this._model,this._fields);q._context=this._context;q._filter=this._filter;q._lazy=this._lazy;q._limit=this._limit;q._offset=this._offset;q._order_by=this._order_by;for(var key in to_set){if(!to_set.hasOwnProperty(key)){continue;}
switch(key){case'filter':q._filter=new CompoundDomain(q._filter,to_set.filter);break;case'context':q._context=new CompoundContext(q._context,to_set.context);break;case'lazy':case'limit':case'offset':case'order_by':q['_'+key]=to_set[key];}}
return q;},_execute:function(options){var self=this;options=options||{};return session.rpc('/web/dataset/search_read',{model:this._model.name,fields:this._fields||false,domain:pyeval.eval('domains',[this._model.domain(this._filter)]),context:pyeval.eval('contexts',[this._model.context(this._context)]),offset:this._offset,limit:this._limit,sort:serialize_sort(this._order_by)},options).then(function(results){self._count=results.length;return results.records;},null);},first:function(options){var self=this;return this.clone({limit:1})._execute(options).then(function(records){delete self._count;if(records.length){return records[0];}
return null;});},all:function(options){return this._execute(options);},count:function(){if(this._count!==undefined){return $.when(this._count);}
return this._model.call('search_count',[this._filter],{context:this._model.context(this._context)});},group_by:function(grouping){var ctx=pyeval.eval('context',this._model.context(this._context));if(_.isUndefined(grouping)){grouping=[];}
if(!(grouping instanceof Array)){grouping=_.toArray(arguments);}
if(_.isEmpty(grouping)&&!ctx.group_by_no_leaf){return null;}
var raw_fields=_.map(grouping.concat(this._fields||[]),function(field){return field.split(':')[0];});var self=this;return this._model.call('read_group',{groupby:grouping,fields:_.uniq(raw_fields),domain:this._model.domain(this._filter),context:ctx,offset:this._offset,lazy:this._lazy,limit:this._limit,orderby:serialize_sort(this._order_by)||false}).then(function(results){return _(results).map(function(result){result.__context=result.__context||{};result.__context.group_by=result.__context.group_by||[];_.defaults(result.__context,ctx);var grouping_fields=self._lazy?[grouping[0]]:grouping;return new QueryGroup(self._model.name,grouping_fields,result);});});},context:function(context){if(!context){return this;}
return this.clone({context:context});},filter:function(domain){if(!domain){return this;}
return this.clone({filter:domain});},lazy:function(lazy){return this.clone({lazy:lazy});},limit:function(limit){return this.clone({limit:limit});},offset:function(offset){return this.clone({offset:offset});},order_by:function(fields){if(fields===undefined){return this;}
if(!(fields instanceof Array)){fields=_.toArray(arguments);}
if(_.isEmpty(fields)){return this;}
return this.clone({order_by:fields});}});var QueryGroup=Class.extend({init:function(model,grouping_fields,read_group_group){var fixed_group=_.extend({__context:{group_by:[]},__domain:[]},read_group_group);var count_key=(grouping_fields[0]&&grouping_fields[0].split(':')[0])+'_count';var aggregates={};_(fixed_group).each(function(value,key){if(key.indexOf('__')===0||_.contains(grouping_fields,key)||(key===count_key)){return;}
aggregates[key]=value||0;});this.model=new Model(model,fixed_group.__context,fixed_group.__domain);var group_size=fixed_group[count_key]||fixed_group.__count||0;var leaf_group=fixed_group.__context.group_by.length===0;var value=(grouping_fields.length===1)?fixed_group[grouping_fields[0]]:_.map(grouping_fields,function(field){return fixed_group[field];});var grouped_on=(grouping_fields.length===1)?grouping_fields[0]:grouping_fields;this.attributes={folded:!!(fixed_group.__fold),grouped_on:grouped_on,length:group_size,value:value,has_children:!(leaf_group&&fixed_group.__context.group_by_no_leaf),aggregates:aggregates};},get:function(key){return this.attributes[key];},subgroups:function(){return this.model.query().group_by(this.model.context().group_by);},query:function(){return this.model.query.apply(this.model,arguments);}});var DataSet=Class.extend(mixins.PropertiesMixin,{init:function(parent,model,context){mixins.PropertiesMixin.init.call(this);this.model=model;this.context=context||{};this.index=null;this._sort=[];this._model=new Model(model,context);},previous:function(){this.index-=1;if(!this.ids.length){this.index=null;}else if(this.index<0){this.index=this.ids.length-1;}
return this;},next:function(){this.index+=1;if(!this.ids.length){this.index=null;}else if(this.index>=this.ids.length){this.index=0;}
return this;},select_id:function(id){var idx=this.get_id_index(id);if(idx===null){return false;}else{this.index=idx;return true;}},get_id_index:function(id){for(var i=0,ii=this.ids.length;i<ii;i++){if(id==this.ids[i]){return i;}}
return null;},read_ids:function(ids,fields,options){if(_.isEmpty(ids))
return $.Deferred().resolve([]);options=options||{};var method='read';var ids_arg=ids;var context=this.get_context(options.context);if(options.check_access_rule===true){method='search_read';ids_arg=[['id','in',ids]];context=new CompoundContext(context,{active_test:false});}
return this._model.call(method,[ids_arg,fields||false],{context:context}).then(function(records){if(records.length<=1){return records;}
var indexes={};for(var i=0;i<ids.length;i++){indexes[ids[i]]=i;}
records.sort(function(a,b){return indexes[a.id]-indexes[b.id];});return records;});},read_slice:function(fields,options){var self=this;options=options||{};return this._model.query(fields).limit(options.limit||false).offset(options.offset||0).all().done(function(records){self.ids=_(records).pluck('id');});},read_index:function(fields,options){options=options||{};return this.read_ids([this.ids[this.index]],fields,options).then(function(records){if(_.isEmpty(records)){return $.Deferred().reject().promise();}
return records[0];});},default_get:function(fields,options){options=options||{};return this._model.call('default_get',[fields],{context:this.get_context(options.context)});},create:function(data,options){var self=this;return this._model.call('create',[data],{context:this.get_context()}).done(function(){self.trigger('dataset_changed',data,options);});},write:function(id,data,options){options=options||{};var self=this;return this._model.call('write',[[id],data],{context:this.get_context(options.context)}).done(function(){self.trigger('dataset_changed',id,data,options);});},unlink:function(ids){var self=this;return this._model.call('unlink',[ids],{context:this.get_context()}).done(function(){self.trigger('dataset_changed',ids);});},call:function(method,args){return this._model.call(method,args);},call_button:function(method,args){return this._model.call_button(method,args);},name_get:function(ids){return this._model.call('name_get',[ids],{context:this.get_context()});},name_search:function(name,domain,operator,limit){return this._model.call('name_search',{name:name||'',args:domain||false,operator:operator||'ilike',context:this._model.context(),limit:limit||0});},name_create:function(name,context){return this._model.call('name_create',[name],{context:this.get_context(context)});},exec_workflow:function(id,signal){return this._model.exec_workflow(id,signal);},get_context:function(request_context){return this._model.context(request_context);},sort:function(field,force_reverse){if(!field){return serialize_sort(this._sort);}
var reverse=force_reverse||(this._sort[0]===field);this._sort.splice.apply(this._sort,[0,this._sort.length].concat(_.without(this._sort,field,'-'+field)));this._sort.unshift((reverse?'-':'')+field);return undefined;},set_sort:function(fields_list){this._sort=deserialize_sort(fields_list);},size:function(){return this.ids.length;},alter_ids:function(n_ids){this.ids=n_ids;},remove_ids:function(ids){this.alter_ids(_(this.ids).difference(ids));},add_ids:function(ids,at){var args=[at,0].concat(_.difference(ids,this.ids));this.ids.splice.apply(this.ids,args);},resequence:function(ids,options){options=options||{};return session.rpc('/web/dataset/resequence',{model:this.model,ids:ids,context:pyeval.eval('context',this.get_context(options.context)),}).then(function(results){return results;});},});var DataSetStatic=DataSet.extend({init:function(parent,model,context,ids){this._super(parent,model,context);this.ids=ids||[];},read_slice:function(fields,options){options=options||{};fields=fields||{};var offset=options.offset||0,limit=options.limit||false;var end_pos=limit&&limit!==-1?offset+limit:this.ids.length;return this.read_ids(this.ids.slice(offset,end_pos),fields,options);},set_ids:function(ids){this.ids=ids;if(ids.length===0){this.index=null;}else if(this.index==null){this.index=0;}else if(this.index>=ids.length-1){this.index=ids.length-1;}},unlink:function(ids){this.set_ids(_.without.apply(null,[this.ids].concat(ids)));this.trigger('unlink',ids);return $.Deferred().resolve({result:true});},});var DataSetSearch=DataSet.extend({init:function(parent,model,context,domain){this._super(parent,model,context);this.domain=domain||[];this._length=null;this.ids=[];this._model=new Model(model,context,domain);},read_slice:function(fields,options){options=options||{};var self=this;var q=this._model.query(fields||false).filter(options.domain).context(options.context).offset(options.offset||0).limit(options.limit||false);q=q.order_by.apply(q,this._sort);return q.all().done(function(records){q.count().done(function(count){self._length=count;});self.ids=_(records).pluck('id');});},get_domain:function(other_domain){return this._model.domain(other_domain);},alter_ids:function(ids){this._super(ids);if(this.index!==null&&this.index>=this.ids.length){this.index=this.ids.length>0?this.ids.length-1:0;}},remove_ids:function(ids){var before=this.ids.length;this._super(ids);if(this._length){this._length-=(before-this.ids.length);}},unlink:function(ids,callback,error_callback){var self=this;return this._super(ids).done(function(){self.remove_ids(ids);self.trigger("dataset_changed",ids,callback,error_callback);});},size:function(){if(this._length!==null){return this._length;}
return this._super();}});var BufferedDataSet=DataSetStatic.extend({virtual_id_prefix:"one2many_v_id_",debug_mode:true,init:function(){this._super.apply(this,arguments);this.reset_ids([]);this.last_default_get={};this.running_reads=[];this.mutex=new utils.Mutex();},default_get:function(fields,options){var self=this;return this._super(fields,options).done(function(res){self.last_default_get=_.clone(res);});},get_cache:function(id){if(!this.cache[id]){this.cache[id]={'id':id,'values':{},'from_read':{},'changes':{},'readonly_fields':{},'to_create':false,'to_delete':false};}
return this.cache[id];},_update_cache:function(id,options){var cached=this.get_cache(id);if(options){_.extend(cached.from_read,options.from_read);_.extend(cached.changes,options.changes);_.extend(cached.readonly_fields,options.readonly_fields);_.each(cached.changes,function(v,k){if(cached.from_read[k]===v){delete cached.changes[k];}});if(options.to_create!==undefined)cached.to_create=options.to_create;if(options.to_delete!==undefined)cached.to_delete=options.to_delete;}
cached.values=_.extend({'id':id},cached.from_read,cached.changes,cached.readonly_fields);return cached;},create:function(data,options){var changes=_.extend({},this.last_default_get,data);var cached=this._update_cache(_.uniqueId(this.virtual_id_prefix),_.extend({'changes':changes,'to_create':true},options));this.trigger("dataset_changed",data,options);return $.Deferred().resolve(cached.id);},write:function(id,data,options){var self=this;var cached=this.get_cache(id);cached.to_delete=false;var def=$.Deferred();this.mutex.exec(function(){var dirty=false;_.each(data,function(v,k){if(!_.isEqual(v,cached.values[k])){dirty=true;if(_.isEqual(v,cached.from_read[k])){delete cached.changes[k];}else{cached.changes[k]=v;}}else{delete data[k];}});self._update_cache(id,options);if(dirty){self.trigger("dataset_changed",id,data,options);}
return def.resolve(data).promise();});return def;},unlink:function(ids,callback,error_callback){var self=this;_.each(ids,function(id){self.get_cache(id).to_delete=true;});this.set_ids(_.difference(this.ids,_.pluck(_.filter(this.cache,function(c){return c.to_delete;}),'id')));this.trigger("dataset_changed",ids,callback,error_callback);return $.async_when({result:true}).done(callback);},reset_ids:function(ids,options){var self=this;this.set_ids(ids);if(!options||!options.keep_read_data){this.cache={};}else{_.each(this.cache,function(cache){self._update_cache(cache.id,{'changes':{},'to_delete':false});});}
this.delete_all=false;},read_ids:function(ids,fields,options){var self=this;var to_get=_.filter(ids,function(id){var cache=self.get_cache(id);return!cache.to_create&&_.any(fields,function(x){return cache.from_read[x]===undefined;});});options=options||{};var return_records=function(){var records=_.map(ids,function(id){return _.clone(self.get_cache(id).values);});if(self.debug_mode){if(_.include(records,undefined)){throw"Record not correctly loaded";}}
var sort_fields=self._sort,compare=function(v1,v2){return(v1<v2)?-1:(v1>v2)?1:0;};if(sort_fields.length){records.sort(function(a,b){return _.reduce(sort_fields,function(acc,field){if(acc){return acc;}
var sign=1;if(field[0]==='-'){sign=-1;field=field.slice(1);}
if(!a[field]&&a[field]!==0){return sign;}
if(!b[field]&&b[field]!==0){return(sign==-1)?1:-1;}
if(_.isArray(a[field])&&a[field].length==2&&_.isString(a[field][1])){return sign*compare(a[field][1],b[field][1]);}
return sign*compare(a[field],b[field]);},0);});}
return $.when(records);};if(to_get.length>0){var def=$.Deferred();self.running_reads.push(def);def.always(function(){self.running_reads=_.without(self.running_reads,def);});var _super=this._super;this.mutex.exec(function(){_super.call(self,to_get,fields,options).then(function(){def.resolve.apply(def,arguments);},function(){def.reject.apply(def,arguments);});return def;});return def.then(function(records){_.each(records,function(record,index){var id=to_get[index];self._update_cache(id,_.extend(options,{'from_read':record}));});return return_records();});}else{return return_records();}},evict_record:function(id){this.get_cache(id).from_read={};this._update_cache(id);},call_button:function(method,args){this.evict_record(args[0][0]);return this._super(method,args);},exec_workflow:function(id,signal){this.evict_record(id);return this._super(id,signal);},alter_ids:function(n_ids){var dirty=!_.isEqual(this.ids,n_ids);this._super(n_ids);if(dirty){this.trigger("dataset_changed",n_ids);}},});BufferedDataSet.virtual_id_regex=/^one2many_v_id_.*$/;var ProxyDataSet=DataSetSearch.extend({init:function(){this._super.apply(this,arguments);this.create_function=null;this.write_function=null;this.read_function=null;this.default_get_function=null;this.unlink_function=null;},read_ids:function(ids,fields,options){if(this.read_function){return this.read_function(ids,fields,options,this._super);}else{return this._super.apply(this,arguments);}},default_get:function(fields,options){if(this.default_get_function){return this.default_get_function(fields,options,this._super);}else{return this._super.apply(this,arguments);}},create:function(data,options){if(this.create_function){return this.create_function(data,options,this._super);}else{return this._super.apply(this,arguments);}},write:function(id,data,options){if(this.write_function){return this.write_function(id,data,options,this._super);}else{return this._super.apply(this,arguments);}},unlink:function(ids){if(this.unlink_function){return this.unlink_function(ids,this._super);}else{return this._super.apply(this,arguments);}},});var CompoundContext=Class.extend({init:function(){this.__ref="compound_context";this.__contexts=[];this.__eval_context=null;var self=this;_.each(arguments,function(x){self.add(x);});},add:function(context){this.__contexts.push(context);return this;},set_eval_context:function(eval_context){this.__eval_context=eval_context;return this;},get_eval_context:function(){return this.__eval_context;},eval:function(){return pyeval.eval('context',this,undefined,{no_user_context:true});},});var CompoundDomain=Class.extend({init:function(){this.__ref="compound_domain";this.__domains=[];this.__eval_context=null;var self=this;_.each(arguments,function(x){self.add(x);});},add:function(domain){this.__domains.push(domain);return this;},set_eval_context:function(eval_context){this.__eval_context=eval_context;return this;},get_eval_context:function(){return this.__eval_context;},eval:function(){return pyeval.eval('domain',this);},});function compute_domain(expr,fields){if(!(expr instanceof Array))
return!!expr;var stack=[];for(var i=expr.length-1;i>=0;i--){var ex=expr[i];if(ex.length==1){var top=stack.pop();switch(ex){case'|':stack.push(stack.pop()||top);continue;case'&':stack.push(stack.pop()&&top);continue;case'!':stack.push(!top);continue;default:throw new Error(_.str.sprintf(_t("Unknown operator %s in domain %s"),ex,JSON.stringify(expr)));}}
var field=fields[ex[0]];if(!field){throw new Error(_.str.sprintf(_t("Unknown field %s in domain %s"),ex[0],JSON.stringify(expr)));}
var field_value=field.get_value?field.get_value():field.value;if(field_value instanceof Array){field_value=_.filter(field_value,function(command){if(command instanceof Array&&command.length==3&&command[0]in[2,3,5]){return false;}
return true;});}
var op=ex[1];var val=ex[2];switch(op.toLowerCase()){case'=':case'==':stack.push(_.isEqual(field_value,val));break;case'!=':case'<>':stack.push(!_.isEqual(field_value,val));break;case'<':stack.push(field_value<val);break;case'>':stack.push(field_value>val);break;case'<=':stack.push(field_value<=val);break;case'>=':stack.push(field_value>=val);break;case'in':if(!_.isArray(val))val=[val];stack.push(_(val).contains(field_value));break;case'not in':if(!_.isArray(val))val=[val];stack.push(!_(val).contains(field_value));break;default:console.warn(_t("Unsupported operator %s in domain %s"),op,JSON.stringify(expr));}}
return _.all(stack,_.identity);}
return{Query:Query,DataSet:DataSet,DataSetStatic:DataSetStatic,DataSetSearch:DataSetSearch,BufferedDataSet:BufferedDataSet,ProxyDataSet:ProxyDataSet,CompoundContext:CompoundContext,CompoundDomain:CompoundDomain,compute_domain:compute_domain,};});;

/* /web/static/src/js/compatibility.js defined in bundle 'web.assets_backend' */
odoo.define('web.compatibility',function(require){"use strict";var ActionManager=require('web.ActionManager');var core=require('web.core');var data=require('web.data');var Dialog=require('web.Dialog');var FavoriteMenu=require('web.FavoriteMenu');var form_common=require('web.form_common');var formats=require('web.formats');var FormView=require('web.FormView');var form_relational=require('web.form_relational');var form_widgets=require('web.form_widgets');var framework=require('web.framework');var ListView=require('web.ListView');var Menu=require('web.Menu');var Model=require('web.DataModel');var pyeval=require('web.pyeval');var Registry=require('web.Registry');var SearchView=require('web.SearchView');var session=require('web.session');var Sidebar=require('web.Sidebar');var SystrayMenu=require('web.SystrayMenu');var time=require('web.time');var UserMenu=require('web.UserMenu');var utils=require('web.utils');var View=require('web.View');var ViewManager=require('web.ViewManager');var WebClient=require('web.WebClient');var Widget=require('web.Widget');var client_started=$.Deferred();var OldRegistry=Registry.extend({add:function(key,path){},get_object:function(key){return get_object(this.map[key]);},});window.openerp=window.openerp||{};$.Mutex=utils.Mutex;openerp._session_id="instance0";openerp._t=core._t;openerp.get_cookie=utils.get_cookie;openerp.qweb=core.qweb;openerp.session=session;openerp.web=openerp.web||{};openerp.web._t=core._t;openerp.web._lt=core._lt;openerp.web.ActionManager=ActionManager;openerp.web.auto_str_to_date=time.auto_str_to_date;openerp.web.blockUI=framework.blockUI;openerp.web.BufferedDataSet=data.BufferedDataSet;openerp.web.bus=core.bus;openerp.web.Class=core.Class;openerp.web.client_actions=make_old_registry(core.action_registry);openerp.web.CompoundContext=data.CompoundContext;openerp.web.CompoundDomain=data.CompoundDomain;openerp.web.DataSetSearch=data.DataSetSearch;openerp.web.DataSet=data.DataSet;openerp.web.date_to_str=time.date_to_str;openerp.web.Dialog=Dialog;openerp.web.DropMisordered=utils.DropMisordered;openerp.web.form=openerp.web.form||{};openerp.web.form.AbstractField=form_common.AbstractField;openerp.web.form.compute_domain=data.compute_domain;openerp.web.form.DefaultFieldManager=form_common.DefaultFieldManager;openerp.web.form.FieldChar=core.form_widget_registry.get('char');openerp.web.form.FieldFloat=core.form_widget_registry.get('float');openerp.web.form.FieldStatus=core.form_widget_registry.get('statusbar');openerp.web.form.FieldMany2ManyTags=core.form_widget_registry.get('many2many_tags');openerp.web.form.FieldMany2One=core.form_widget_registry.get('many2one');openerp.web.form.FormWidget=form_common.FormWidget;openerp.web.form.tags=make_old_registry(core.form_tag_registry);openerp.web.form.widgets=make_old_registry(core.form_widget_registry);openerp.web.format_value=formats.format_value;openerp.web.FormView=FormView;openerp.web.json_node_to_xml=utils.json_node_to_xml;openerp.web.ListView=ListView;openerp.web.Menu=Menu;openerp.web.Model=Model;openerp.web.normalize_format=time.strftime_to_moment_format;openerp.web.py_eval=pyeval.py_eval;openerp.web.pyeval=pyeval;openerp.web.qweb=core.qweb;openerp.web.Registry=OldRegistry;openerp.web.search={};openerp.web.search.FavoriteMenu=FavoriteMenu;openerp.web.SearchView=SearchView;openerp.web.Sidebar=Sidebar;openerp.web.str_to_date=time.str_to_date;openerp.web.str_to_datetime=time.str_to_datetime;openerp.web.SystrayItems=SystrayMenu.Items;openerp.web.unblockUI=framework.unblockUI;openerp.web.UserMenu=UserMenu;openerp.web.View=View;openerp.web.ViewManager=ViewManager;openerp.web.views=make_old_registry(core.view_registry);openerp.web.WebClient=WebClient;openerp.web.Widget=Widget;openerp.Widget=openerp.web.Widget;openerp.Widget.prototype.session=session;WebClient.include({init:function(){openerp.client=this;openerp.webclient=this;start_modules();client_started.resolve();this._super.apply(this,arguments);},});function make_old_registry(registry){return{add:function(key,path){client_started.done(function(){registry.add(key,get_object(path));});},};}
function get_object(path){var object_match=openerp;path=path.split('.');for(var i=1;i<path.length;++i){object_match=object_match[path[i]];}
return object_match;}
var inited=false;function start_modules(modules){if(modules===undefined){modules=odoo._modules;}
modules=_.without(modules,"web");if(inited){throw new Error("OpenERP was already inited");}
inited=true;for(var i=0;i<modules.length;i++){var fct=openerp[modules[i]];if(typeof(fct)==="function"){openerp[modules[i]]={};for(var k in fct){openerp[modules[i]][k]=fct[k];}
fct(openerp,openerp[modules[i]]);}}
openerp._modules=['web'].concat(modules);return openerp;};ListView.include({load_list:function(data){this._super(data);if(this.fields_view.arch.attrs.colors){this.colors=_(this.fields_view.arch.attrs.colors.split(';')).chain().compact().map(function(color_pair){var pair=color_pair.split(':'),color=pair[0],expr=pair[1];return[color,py.parse(py.tokenize(expr)),expr];}).value();}
if(this.fields_view.arch.attrs.fonts){this.fonts=_(this.fields_view.arch.attrs.fonts.split(';')).chain().compact().map(function(font_pair){var pair=font_pair.split(':'),font=pair[0],expr=pair[1];return[font,py.parse(py.tokenize(expr)),expr];}).value();}},style_for:function(record){var len,style='';var context=_.extend({},record.attributes,{uid:session.uid,current_date:moment().format('YYYY-MM-DD')});var i;var pair;var expression;if(this.fonts){for(i=0,len=this.fonts.length;i<len;++i){pair=this.fonts[i];var font=pair[0];expression=pair[1];if(py.PY_isTrue(py.evaluate(expression,context))){switch(font){case'bold':style+='font-weight: bold;';break;case'italic':style+='font-style: italic;';break;case'underline':style+='text-decoration: underline;';break;}}}}
if(!this.colors){return style;}
for(i=0,len=this.colors.length;i<len;++i){pair=this.colors[i];var color=pair[0];expression=pair[1];if(py.PY_isTrue(py.evaluate(expression,context))){return style+='color: '+color+';';}}
return style;},});});;

/* /web/static/src/js/framework/misc.js defined in bundle 'web.assets_backend' */
odoo.define('web.framework',function(require){"use strict";var core=require('web.core');var crash_manager=require('web.crash_manager');var session=require('web.session');var Widget=require('web.Widget');var _t=core._t;var Spinner=window.Spinner;var messages_by_seconds=function(){return[[0,_t("Loading...")],[20,_t("Still loading...")],[60,_t("Still loading...<br />Please be patient.")],[3600,_t("Maybe you should consider reloading the application by pressing F5...")]];};var Throbber=Widget.extend({template:"Throbber",start:function(){var opts={lines:13,length:7,width:4,radius:10,rotate:0,color:'#FFF',speed:1,trail:60,shadow:false,hwaccel:false,className:'spinner',zIndex:2e9,top:'auto',left:'auto'};this.spin=new Spinner(opts).spin(this.$el[0]);this.start_time=new Date().getTime();this.act_message();},act_message:function(){var self=this;setTimeout(function(){if(self.isDestroyed())
return;var seconds=(new Date().getTime()-self.start_time)/1000;var mes;_.each(messages_by_seconds(),function(el){if(seconds>=el[0])
mes=el[1];});self.$(".oe_throbber_message").html(mes);self.act_message();},1000);},destroy:function(){if(this.spin)
this.spin.stop();this._super();},});var old_async_when=$.async_when;$.async_when=function(){if(session.synch)
return $.when.apply(this,arguments);else
return old_async_when.apply(this,arguments);};if($.blockUI){$.blockUI.defaults.baseZ=1100;$.blockUI.defaults.message='<div class="openerp oe_blockui_spin_container" style="background-color: transparent;">';$.blockUI.defaults.css.border='0';$.blockUI.defaults.css["background-color"]='';}
var throbbers=[];function blockUI(){var tmp=$.blockUI.apply($,arguments);var throbber=new Throbber();throbbers.push(throbber);throbber.appendTo($(".oe_blockui_spin_container"));$('body').addClass('o_ui_blocked');return tmp;}
function unblockUI(){_.invoke(throbbers,'destroy');throbbers=[];$('body').removeClass('o_ui_blocked');return $.unblockUI.apply($,arguments);}
function redirect(url,wait){crash_manager.disable();var load=function(){var old=""+window.location;var old_no_hash=old.split("#")[0];var url_no_hash=url.split("#")[0];location.assign(url);if(old_no_hash===url_no_hash){location.reload(true);}};var wait_server=function(){session.rpc("/web/webclient/version_info",{}).done(load).fail(function(){setTimeout(wait_server,250);});};if(wait){setTimeout(wait_server,1000);}else{load();}}
function Reload(parent,action){var params=action.params||{};var menu_id=params.menu_id||false;var l=window.location;var sobj=$.deparam(l.search.substr(1));if(params.url_search){sobj=_.extend(sobj,params.url_search);}
var search='?'+$.param(sobj);var hash=l.hash;if(menu_id){hash="#menu_id="+menu_id;}
var url=l.protocol+"//"+l.host+l.pathname+search+hash;redirect(url,params.wait);}
core.action_registry.add("reload",Reload);function Home(parent,action){var url='/'+(window.location.search||'');redirect(url,action&&action.params&&action.params.wait);}
core.action_registry.add("home",Home);function HistoryBack(parent){parent.history_back().fail(function(){Home(parent);});}
core.action_registry.add("history_back",HistoryBack);function login(){redirect('/web/login');}
core.action_registry.add("login",login);function logout(){redirect('/web/session/logout');}
core.action_registry.add("logout",logout);function ReloadContext(parent,action){session.rpc("/web/session/get_session_info",{}).then(function(){Reload(parent,action);});}
core.action_registry.add("reload_context",ReloadContext);if('nv'in window){nv.dev=false;nv.utils.onWindowResize=function(fun){if(fun===null)return;window.addEventListener('resize',fun);};nv.utils.windowResize=nv.utils.onWindowResize;nv.utils.offWindowResize=function(fun){if(fun===null)return;window.removeEventListener('resize',fun);};nv.tooltip.cleanup=function(){$('.nvtooltip').remove();};}
$.fn.tooltip.Constructor.DEFAULTS.placement='auto top';$.fn.tooltip.Constructor.DEFAULTS.html=true;$.fn.tooltip.Constructor.DEFAULTS.trigger='hover focus click';$.fn.tooltip.Constructor.DEFAULTS.container='body';$.fn.tooltip.Constructor.DEFAULTS.delay={show:1000,hide:0};var bootstrap_show_function=$.fn.tooltip.Constructor.prototype.show;$.fn.modal.Constructor.prototype.enforceFocus=function(){};$.fn.tooltip.Constructor.prototype.show=function(){$('.tooltip').remove();var e=$.Event('show.bs.'+this.type);var inDom=$.contains(document.documentElement,this.$element[0]);if(e.isDefaultPrevented()||!inDom)return;return bootstrap_show_function.call(this);};jQuery.expr[":"].Contains=jQuery.expr.createPseudo(function(arg){return function(elem){return jQuery(elem).text().toUpperCase().indexOf(arg.toUpperCase())>=0;};});$.fn.getAttributes=function(){var o={};if(this.length){for(var attr,i=0,attrs=this[0].attributes,l=attrs.length;i<l;i++){attr=attrs.item(i);o[attr.nodeName]=attr.value;}}
return o;};$.fn.openerpClass=function(additionalClass){additionalClass=additionalClass||'';if(!!$.browser.msie){additionalClass+=' openerp_ie';}
return this.each(function(){$(this).addClass('openerp '+additionalClass);});};$.fn.openerpBounce=function(){return this.each(function(){$(this).css('box-sizing','content-box').effect('bounce',{distance:18,times:5},250);});};var proto=$.ui.autocomplete.prototype,initSource=proto._initSource;function filter(array,term){var matcher=new RegExp($.ui.autocomplete.escapeRegex(term),"i");return $.grep(array,function(value_){return matcher.test($("<div>").html(value_.label||value_.value||value_).text());});}
$.extend(proto,{_initSource:function(){if(this.options.html&&$.isArray(this.options.source)){this.source=function(request,response){response(filter(this.options.source,request.term));};}else{initSource.call(this);}},_renderItem:function(ul,item){return $("<li></li>").data("item.autocomplete",item).append($("<a></a>")[this.options.html?"html":"text"](item.label)).appendTo(ul).addClass(item.classname);}});function _notify(content){core.bus.trigger('DOM_updated',content);}
function append($target,content,trigger){$target.append(content);if(trigger){_notify(content);}}
function prepend($target,content,trigger){$target.prepend(content);if(trigger){_notify(content);}}
function getPosition(e){var position={left:0,top:0};while(e){position.left+=e.offsetLeft;position.top+=e.offsetTop;e=e.offsetParent;}
return position;}
return{blockUI:blockUI,unblockUI:unblockUI,redirect:redirect,append:append,prepend:prepend,getPosition:getPosition,};});odoo.define('web.IFrameWidget',function(require){"use strict";var Widget=require('web.Widget');var IFrameWidget=Widget.extend({tagName:'iframe',init:function(parent,url){this._super(parent);this.url=url;},start:function(){this.$el.css({height:'100%',width:'100%',border:0});this.$el.attr({src:this.url});this.$el.on("load",this.bind_events.bind(this));return this._super();},bind_events:function(){this.$el.contents().click(this.iframe_clicked.bind(this));},iframe_clicked:function(e){}});return IFrameWidget;});;

/* /web/static/src/js/framework/session_instance.js defined in bundle 'web.assets_backend' */
odoo.define('web.session',function(require){var Session=require('web.Session');var modules=odoo._modules;return new Session(undefined,undefined,{modules:modules,use_cors:false});});;

/* /web/static/src/js/framework/crash_manager.js defined in bundle 'web.assets_backend' */
odoo.define('web.crash_manager',function(require){var CrashManager=require('web.CrashManager');return new CrashManager();});odoo.define('web.CrashManager',function(require){"use strict";var ajax=require('web.ajax');var core=require('web.core');var Dialog=require('web.Dialog');var session=require('web.session');var QWeb=core.qweb;var _t=core._t;var _lt=core._lt;var map_title={user_error:_lt('Warning'),warning:_lt('Warning'),access_error:_lt('Access Error'),missing_error:_lt('Missing Record'),validation_error:_lt('Validation Error'),except_orm:_lt('Global Business Error'),access_denied:_lt('Access Denied'),};var CrashManager=core.Class.extend({init:function(){this.active=true;},enable:function(){this.active=true;},disable:function(){this.active=false;},rpc_error:function(error){var self=this;if(!this.active){return;}
if(this.$indicator){return;}
if(error.code==-32098){$.blockUI({message:'',overlayCSS:{'z-index':9999,backgroundColor:'#FFFFFF',opacity:0.0,cursor:'wait'}});this.$indicator=$('<div class="oe_indicator">'+_t("Trying to reconnect... ")+'<i class="fa fa-refresh"></i></div>');this.$indicator.prependTo("body");var timeinterval=setInterval(function(){ajax.jsonRpc('/web/webclient/version_info').then(function(){clearInterval(timeinterval);self.$indicator.html(_t("You are back online"));self.$indicator.delay(2000).fadeOut('slow',function(){$(this).remove();self.$indicator.remove();});$.unblockUI();});},2000);return;}
var handler=core.crash_registry.get(error.data.name,true);if(handler){new(handler)(this,error).display();return;}
if(error.data.name==="openerp.http.SessionExpiredException"||error.data.name==="werkzeug.exceptions.Forbidden"){this.show_warning({type:"Session Expired",data:{message:_t("Your Odoo session expired. Please refresh the current web page.")}});return;}
if(_.has(map_title,error.data.exception_type)){if(error.data.exception_type=='except_orm'){if(error.data.arguments[1]){error=_.extend({},error,{data:_.extend({},error.data,{message:error.data.arguments[1],title:error.data.arguments[0]!=='Warning'?(" - "+error.data.arguments[0]):'',})});}
else{error=_.extend({},error,{data:_.extend({},error.data,{message:error.data.arguments[0],title:'',})});}}
else{error=_.extend({},error,{data:_.extend({},error.data,{message:error.data.arguments[0],title:map_title[error.data.exception_type]!=='Warning'?(" - "+map_title[error.data.exception_type]):'',})});}
this.show_warning(error);}else{this.show_error(error);}},show_warning:function(error){if(!this.active){return;}
new Dialog(this,{size:'medium',title:"Open-prod "+(_.str.capitalize(error.type)||_t("Warning")),subtitle:error.data.title,$content:$('<div>').html(QWeb.render('CrashManager.warning',{error:error}))}).open();},show_error:function(error){if(!this.active){return;}
new Dialog(this,{title:"open-Prod "+_.str.capitalize(error.type),$content:QWeb.render('CrashManager.error',{session:session,error:error})}).open();},show_message:function(exception){this.show_error({type:_t("Client Error"),message:exception,data:{debug:""}});},});var ExceptionHandler={init:function(parent,error){},display:function(){},};var RedirectWarningHandler=Dialog.extend(ExceptionHandler,{init:function(parent,error){this._super(parent);this.error=error;},display:function(){var self=this;var error=this.error;error.data.message=error.data.arguments[0];new Dialog(this,{size:'medium',title:"Open-prod "+(_.str.capitalize(error.type)||"Warning"),buttons:[{text:error.data.arguments[2],classes:"btn-primary",click:function(){window.location.href='#action='+error.data.arguments[1];self.destroy();}},{text:_t("Cancel"),click:function(){self.destroy();},close:true}],$content:QWeb.render('CrashManager.warning',{error:error})}).open();}});core.crash_registry.add('openerp.exceptions.RedirectWarning',RedirectWarningHandler);return CrashManager;});;

/* /web/static/src/js/widgets/change_password.js defined in bundle 'web.assets_backend' */
odoo.define('web.ChangePassword',function(require){"use strict";var core=require('web.core');var Dialog=require('web.Dialog');var Widget=require('web.Widget');var web_client=require('web.web_client');var _t=core._t;var ChangePassword=Widget.extend({template:"ChangePassword",start:function(){var self=this;web_client.set_title(_t("Change Password"));var $button=self.$el.find('.oe_form_button');$button.appendTo(this.getParent().$footer);$button.eq(1).click(function(){self.$el.parents('.modal').modal('hide');});$button.eq(0).click(function(){self.rpc("/web/session/change_password",{'fields':$("form[name=change_password_form]").serializeArray()}).done(function(result){if(result.error){self.display_error(result);return;}else{self.do_action('logout');}});});},display_error:function(error){return new Dialog(this,{size:'medium',title:error.title,$content:$('<div>').html(error.error)}).open();},});core.action_registry.add("change_password",ChangePassword);return ChangePassword;});;

/* /web/static/src/js/widgets/debug_manager.js defined in bundle 'web.assets_backend' */
odoo.define('web.DebugManager',function(require){"use strict";var core=require('web.core');var Dialog=require('web.Dialog');var formats=require('web.formats');var framework=require('web.framework');var Model=require('web.Model');var session=require('web.session');var SystrayMenu=require('web.SystrayMenu');var utils=require('web.utils');var ViewManager=require('web.ViewManager');var Widget=require('web.Widget');var QWeb=core.qweb;var _t=core._t;if(core.debug){var DebugManager=Widget.extend({template:"WebClient.DebugManager",events:{"click .oe_debug_button":"render_dropdown","click .js_debug_dropdown li":"on_debug_click",},start:function(){this._super();this.$dropdown=this.$(".js_debug_dropdown");},_update:function(){this.view_manager=odoo.__DEBUG__.services['web.web_client'].action_manager.get_inner_widget();if(!this.view_manager instanceof ViewManager){return;}
this.dataset=this.view_manager.dataset;this.active_view=this.view_manager.active_view;if(!this.active_view){return;}
this.view=this.active_view.controller;return true;},render_dropdown:function(){var self=this;this.$dropdown.empty();if(!this._update()){console.warn("DebugManager is not available");return;}
this.session.user_has_group('base.group_system').then(function(is_admin){var dropdown_content=QWeb.render('WebClient.DebugDropdown',{widget:self,active_view:self.active_view,view:self.view,action:self.view_manager.action,searchview:self.view_manager.searchview,is_admin:is_admin,});$(dropdown_content).appendTo(self.$dropdown);});},on_debug_click:function(evt){evt.preventDefault();var params=$(evt.target).data();var callback=params.action;if(callback&&this[callback]){this[callback](params,evt);}else{console.warn("No debug handler for ",callback);}},get_metadata:function(){var ds=this.dataset;ds.call('get_metadata',[this.view.get_selected_ids()]).done(function(result){new Dialog(this,{title:_.str.sprintf(_t("Metadata (%s)"),ds.model),size:'medium',$content:QWeb.render('WebClient.DebugViewLog',{perm:result[0],format:formats.format_value})}).open();});},toggle_layout_outline:function(){this.view.rendering_engine.toggle_layout_debugging();},set_defaults:function(){this.view.open_defaults_dialog();},perform_js_tests:function(){this.do_action({name:_t("JS Tests"),target:'new',type:'ir.actions.act_url',url:'/web/tests?mod=*'});},get_view_fields:function(){var self=this;self.dataset.call('fields_get',[false,{}]).done(function(fields){var $root=$('<dl>');_(fields).each(function(attributes,name){$root.append($('<dt>').append($('<h4>').text(name)));var $attrs=$('<dl>').appendTo($('<dd>').appendTo($root));_(attributes).each(function(def,name){if(def instanceof Object){def=JSON.stringify(def);}
$attrs.append($('<dt>').text(name)).append($('<dd style="white-space: pre-wrap;">').text(def));});});new Dialog(self,{title:_.str.sprintf(_t("Model %s fields"),self.dataset.model),$content:$root}).open();});},fvg:function(){var dialog=new Dialog(this,{title:_t("Fields View Get")}).open();$('<pre>').text(utils.json_node_to_xml(this.view.fields_view.arch,true)).appendTo(dialog.$el);},manage_filters:function(){this.do_action({res_model:'ir.filters',name:_t('Manage Filters'),views:[[false,'list'],[false,'form']],type:'ir.actions.act_window',context:{search_default_my_filters:true,search_default_model_id:this.dataset.model}});},translate:function(){new Model("ir.translation").call('get_technical_translations',[this.dataset.model]).then(this.do_action);},edit:function(params,evt){this.do_action({res_model:params.model,res_id:params.id,name:evt.target.text,type:'ir.actions.act_window',view_type:'form',view_mode:'form',views:[[false,'form']],target:'new',flags:{action_buttons:true,headless:true,}});},edit_workflow:function(){return this.do_action({res_model:'workflow',name:_t('Edit Workflow'),domain:[['osv','=',this.dataset.model]],views:[[false,'list'],[false,'form'],[false,'diagram']],type:'ir.actions.act_window',view_type:'list',view_mode:'list'});},print_workflow:function(){if(this.view.get_selected_ids&&this.view.get_selected_ids().length==1){framework.blockUI();var action={context:{active_ids:this.view.get_selected_ids()},report_name:"workflow.instance.graph",datas:{model:this.dataset.model,id:this.view.get_selected_ids()[0],nested:true,}};this.session.get_file({url:'/web/report',data:{action:JSON.stringify(action)},complete:framework.unblockUI});}else{this.do_warn("Warning","No record selected.");}},leave_debug:function(){window.location.search="?";},});SystrayMenu.Items.push(DebugManager);return DebugManager;}});;

/* /web/static/src/js/widgets/data_export.js defined in bundle 'web.assets_backend' */
odoo.define('web.DataExport',function(require){"use strict";var core=require('web.core');var crash_manager=require('web.crash_manager');var data=require('web.data');var Dialog=require('web.Dialog');var framework=require('web.framework');var QWeb=core.qweb;var _t=core._t;var DataExport=Dialog.extend({template:'ExportTreeView',events:{'click #add_field':function(){var self=this;this.$('#field-tree-structure tr.ui-selected').removeClass('ui-selected').find('a').each(function(){var id=$(this).attr('id').split('-')[1];var string=$(this).attr('string');self.add_field(id,string);});},'click #remove_field':function(){this.$('#fields_list option:selected').remove();},'click #remove_all_field':function(){this.$('#fields_list').empty();},'click #export_new_list':'on_show_save_list','click #move_up':'on_click_move_up','click #move_down':'on_click_move_down',},init:function(parent,dataset){var self=this;var options={buttons:[{text:_t("Close"),click:function(){self.$el.parents('.modal').modal('hide');}},{text:_t("Export To File"),click:function(){self.on_click_export_data();}}],close:function(){self.close();}};this._super(parent,options);this.records={};this.dataset=dataset;this.exports=new data.DataSetSearch(this,'ir.exports',this.dataset.get_context());this.set_title(_t("Export Data"));},start:function(){var self=this;this._super.apply(this,arguments);this.$el.parent('.modal-content').css('max-height','inherit');var got_fields=new $.Deferred();this.$el.find('#import_compat').change(function(){self.$el.find('#fields_list').empty();self.$el.find('#field-tree-structure').remove();var import_comp=self.$el.find("#import_compat").val();self.rpc("/web/export/get_fields",{model:self.dataset.model,import_compat:!!import_comp,}).done(function(records){got_fields.resolve();self.on_show_data(records);});}).change();var got_domain=this.getParent().get_active_domain().then(function(domain){if(domain===undefined){self.ids_to_export=self.getParent().get_selected_ids();self.domain=self.dataset.domain;}
else{self.ids_to_export=false;self.domain=domain;}
self.on_show_domain();});return $.when(got_fields,got_domain,this.rpc('/web/export/formats',{}).done(this.do_setup_export_formats),this.show_exports_list());},on_click_move_up:function(){var prev_row=this.$('#fields_list option:selected').first().prev();if(prev_row.length){var selected_rows=this.$('#fields_list option:selected').detach();prev_row.before(selected_rows);}},on_click_move_down:function(){var next_row=this.$('#fields_list option:selected').last().next();if(next_row.length){var selected_rows=this.$('#fields_list option:selected').detach();next_row.after(selected_rows);}},do_setup_export_formats:function(formats){var $fmts=this.$el.find('#export_format');_(formats).each(function(format){var opt=new Option(format.label,format.tag);if(format.error){opt.disabled=true;opt.replaceChild(document.createTextNode(_.str.sprintf("%s — %s",format.label,format.error)),opt.childNodes[0]);}
$fmts.append(opt);});},show_exports_list:function(){var self=this;if(self.$el.find('#saved_export_list').is(':hidden')){self.$el.find('#ExistsExportList').show();return $.when();}
return this.exports.read_slice(['name'],{domain:[['resource','=',this.dataset.model]]}).done(function(export_list){if(!export_list.length){return;}
var sec_rule=self.getParent().getParent().action&&self.getParent().getParent().action.security_rule;var can_delete=(sec_rule===true)||(_.isObject(sec_rule)&&sec_rule.is_admin);self.$el.find('#ExistsExportList').append(QWeb.render('Exists.ExportList',{'existing_exports':export_list,'can_delete':can_delete}));self.$el.find('#saved_export_list').change(function(){self.$el.find('#fields_list option').remove();var export_id=self.$el.find('#saved_export_list option:selected').val();if(export_id){self.rpc('/web/export/namelist',{'model':self.dataset.model,export_id:parseInt(export_id,10)}).done(self.do_load_export_field);}});self.$el.find('#delete_export_list').click(function(){var select_exp=self.$el.find('#saved_export_list option:selected');if(select_exp.val()){self.exports.unlink([parseInt(select_exp.val(),10)]);select_exp.remove();self.$el.find("#fields_list option").remove();if(self.$el.find('#saved_export_list option').length<=1){self.$el.find('#ExistsExportList').hide();}}});});},do_load_export_field:function(field_list){var export_node=this.$el.find("#fields_list");_(field_list).each(function(field){export_node.append(new Option(field.label,field.name));});},on_show_save_list:function(){var self=this;var current_node=self.$el.find("#savenewlist");if(!(current_node.find("label")).length){current_node.append(QWeb.render('ExportNewList'));current_node.find("#add_export_list").click(function(){var value=current_node.find("#savelist_name").val();if(value){self.do_save_export_list(value);}else{alert(_t("Please enter save field list name"));}});}else{if(current_node.is(':hidden')){current_node.show();current_node.find("#savelist_name").val("");}else{current_node.hide();}}},do_save_export_list:function(value){var self=this;var fields=self.get_fields();if(!fields.length){return;}
this.exports.create({name:value,resource:this.dataset.model,export_fields:_(fields).map(function(field){return[0,0,{name:field}];})}).then(function(export_list_id){if(!export_list_id){return;}
if(!self.$el.find("#saved_export_list").length||self.$el.find("#saved_export_list").is(":hidden")){self.show_exports_list();}
self.$el.find("#saved_export_list").append(new Option(value,export_list_id));});this.on_show_save_list();},on_click:function(id,record){var self=this;if(!record['children']){return;}
var model=record['params']['model'],prefix=record['params']['prefix'],name=record['params']['name'],exclude_fields=[];if(record['relation_field']){exclude_fields.push(record['relation_field']);}
if(!record.loaded){var import_comp=self.$el.find("#import_compat").val();self.rpc("/web/export/get_fields",{model:model,prefix:prefix,parent_name:name,import_compat:Boolean(import_comp),parent_field_type:record['field_type'],exclude:exclude_fields}).done(function(results){record.loaded=true;self.on_show_data(results,record.id);});}else{self.showcontent(record.id);}},on_show_domain:function(){this.$el.find('tr').first().find('td').append(QWeb.render('ExportTreeView-Domain',{'record':this}));},on_show_data:function(result,after){var self=this;if(after){var current_tr=self.$el.find("tr[id='treerow-"+after+"']");current_tr.addClass('open');current_tr.find('img').attr('src','/web/static/src/img/collapse.gif');current_tr.after(QWeb.render('ExportTreeView-Secondary.children',{'fields':result}));}else{self.$el.find('#left_field_panel').append(QWeb.render('ExportTreeView-Secondary',{'fields':result}));}
_.each(result,function(record){self.records[record.id]=record.value;if(record.required){var required_fld=self.$el.find("tr[id='treerow-"+record.id+"']").find('#tree-column');required_fld.addClass("oe_export_requiredfield");}
self.$el.find("img[id='parentimg-"+record.id+"']").click(function(){self.on_click(this.id,record);});self.$el.find("tr[id='treerow-"+record.id+"']").click(function(e){if(e.shiftKey){var frst_click,scnd_click='';if(self.row_index===0){self.row_index=this.rowIndex;frst_click=self.$el.find("tr[id^='treerow-']")[self.row_index-1];$(frst_click).addClass("ui-selected");}else{var i;if(this.rowIndex>=self.row_index){for(i=(self.row_index-1);i<this.rowIndex;i++){scnd_click=self.$el.find("tr[id^='treerow-']")[i];if(!$(scnd_click).find('#tree-column').hasClass("oe_export_readonlyfield")){$(scnd_click).addClass("ui-selected");}}}else{for(i=(self.row_index-1);i>=(this.rowIndex-1);i--){scnd_click=self.$el.find("tr[id^='treerow-']")[i];if(!$(scnd_click).find('#tree-column').hasClass("oe_export_readonlyfield")){$(scnd_click).addClass("ui-selected");}}}}}
self.row_index=this.rowIndex;self.$el.find("tr[id='treerow-"+record.id+"']").keyup(function(){self.row_index=0;});var o2m_selection=self.$el.find("tr[id='treerow-"+record.id+"']").find('#tree-column');if($(o2m_selection).hasClass("oe_export_readonlyfield")){return false;}
if(e.ctrlKey){if($(this).hasClass('ui-selected')){$(this).removeClass('ui-selected').find('a').blur();}else{$(this).addClass('ui-selected').find('a').focus();}}else if(!e.shiftKey){self.$el.find("tr.ui-selected").removeClass("ui-selected").find('a').blur();$(this).addClass("ui-selected").find('a').focus();}
return false;});self.$el.find("tr[id='treerow-"+record.id+"']").keydown(function(e){var keyCode=e.keyCode||e.which;var arrow={left:37,up:38,right:39,down:40};var elem;switch(keyCode){case arrow.left:if($(this).hasClass('open')){self.on_click(this.id,record);}
break;case arrow.right:if(!$(this).hasClass('open')){self.on_click(this.id,record);}
break;case arrow.up:elem=this;$(elem).removeClass("ui-selected");while(!$(elem).prev().is(":visible")){elem=$(elem).prev();}
if(!$(elem).prev().find('#tree-column').hasClass("oe_export_readonlyfield")){$(elem).prev().addClass("ui-selected");}
$(elem).prev().find('a').focus();break;case arrow.down:elem=this;$(elem).removeClass("ui-selected");while(!$(elem).next().is(":visible")){elem=$(elem).next();}
if(!$(elem).next().find('#tree-column').hasClass("oe_export_readonlyfield")){$(elem).next().addClass("ui-selected");}
$(elem).next().find('a').focus();break;}});self.$el.find("tr[id='treerow-"+record.id+"']").dblclick(function(){var $o2m_selection=self.$el.find("tr[id^='treerow-"+record.id+"']").find('#tree-column');if(!$o2m_selection.hasClass("oe_export_readonlyfield")){self.add_field(record.id,$(this).find("a").attr("string"));}});});self.$el.find('#fields_list').mouseover(function(event){if(event.relatedTarget){if(event.relatedTarget.attributes['id']&&event.relatedTarget.attributes['string']){var field_id=event.relatedTarget.attributes["id"]["value"];if(field_id&&field_id.split("-")[0]==='export'){if(!self.$el.find("tr[id='treerow-"+field_id.split("-")[1]+"']").find('#tree-column').hasClass("oe_export_readonlyfield")){self.add_field(field_id.split("-")[1],event.relatedTarget.attributes["string"]["value"]);}}}}});},showcontent:function(id){var $this=this.$el.find("tr[id='treerow-"+id+"']");var is_open=$this.hasClass('open');$this.toggleClass('open');var first_child=$this.find('img');if(is_open){first_child.attr('src','/web/static/src/img/expand.gif');}else{first_child.attr('src','/web/static/src/img/collapse.gif');}
var child_field=this.$el.find("tr[id^='treerow-"+id+"/']");var child_len=(id.split("/")).length+1;for(var i=0;i<child_field.length;i++){var $child=$(child_field[i]);if(is_open){$child.hide();}else if(child_len==(child_field[i].id.split("/")).length){if($child.hasClass('open')){$child.removeClass('open');$child.find('img').attr('src','/web/static/src/img/expand.gif');}
$child.show();}}},add_field:function(field_id,string){var field_list=this.$el.find('#fields_list');field_id=this.records[field_id]||field_id;if(this.$el.find("#fields_list option[value='"+field_id+"']")&&!this.$el.find("#fields_list option[value='"+field_id+"']").length){field_list.append(new Option(string,field_id));}},get_fields:function(){var export_fields=this.$("#fields_list option").map(function(){return $(this).val();}).get();if(!export_fields.length){alert(_t("Please select fields to save export list..."));}
return export_fields;},on_click_export_data:function(){var self=this;var exported_fields=this.$el.find('#fields_list option').map(function(){return{name:self.records[this.value]||this.value,label:this.textContent||this.innerText};}).get();if(_.isEmpty(exported_fields)){alert(_t("Please select fields to export..."));return;}
if(this.$el.find('#export_id').is(':checked')){exported_fields.unshift({name:'id',label:'External ID'});}
var export_format=this.$el.find("#export_format").val();framework.blockUI();this.session.get_file({url:'/web/export/'+export_format,data:{data:JSON.stringify({model:this.dataset.model,fields:exported_fields,ids:this.ids_to_export,domain:this.domain,context:this.dataset.context,import_compat:!!this.$el.find("#import_compat").val(),header_type:this.$el.find('#header_type').val(),})},complete:framework.unblockUI,error:crash_manager.rpc_error.bind(crash_manager),});},close:function(){this._super();}});return DataExport;});;

/* /web/static/src/js/widgets/date_picker.js defined in bundle 'web.assets_backend' */
odoo.define('web.datepicker',function(require){webshim.setOptions('forms-ext',{replaceUI:true,types:'date time datetime-local',"widgets":{"startView":2,"calculateWidth":false,"classes":"hide-spinbtns",}});webshim.setOptions('basePath','/web/static/lib/js-webshim/minified/shims/');webshim.polyfill('forms forms-ext');var core=require('web.core');var formats=require('web.formats');var time=require('web.time');var Widget=require('web.Widget');var _t=core._t;var DateWidget=Widget.extend({template:"web.datepicker",type_of_date:"date",events:{'dp.change':'change_datetime','dp.show':'set_datetime_default','change .o_datepicker_input':'change_datetime',},init:function(parent,options){this._super.apply(this,arguments);var l10n=_t.database.parameters;this.name=parent.name;},start:function(){this.$input=this.$('input.o_datepicker_input');this.set_readonly(false);this.$input.updatePolyfill();},set_value:function(value){this.set({'value':value});var local_val=moment.utc(value).local();var formatted_value=formats.parse_value(local_val,{widget:this.type_of_date});if(this.type_of_date=='datetime'){var moment_value=moment.utc(value).local().format("YYYY-MM-DDTHH:mm:ss");}else{var moment_value=moment.utc(value).local().format("YYYY-MM-DD");}
this.$input.val((value)?moment_value:'');},get_value:function(){return formats.parse_value(this.get('value'),{widget:this.type_of_date});},set_value_from_ui:function(){var value=this.parse_client(this.$input.val())||false;this.set({'value':value});},set_readonly:function(readonly){this.readonly=readonly;this.$input.prop('readonly',this.readonly);},is_valid:function(){var value=this.$input.val();if(value===""){return true;}else{try{this.parse_client(value);return true;}catch(e){return false;}}},parse_client:function(v){if(!v){return v;}
return moment(v).utc();},format_client:function(v){var format_spec=this.type_of_date=="datetime"?"YYYY-MM-DD HH:MM:SS":"YYYY-MM-DD";return moment(v).format(format_spec);},set_datetime_default:function(){var value=moment().second(0);if(this.$input.val().length!==0&&this.is_valid()){value=this.$input.val();}},change_datetime:function(e){if(this.is_valid()){this.set_value_from_ui();this.trigger("datetime_changed");}},commit_value:function(){this.change_datetime();},destroy:function(){this._super.apply(this,arguments);},});var DateTimeWidget=DateWidget.extend({type_of_date:"datetime"});return{DateWidget:DateWidget,DateTimeWidget:DateTimeWidget,};});;

/* /web/static/src/js/widgets/loading.js defined in bundle 'web.assets_backend' */
odoo.define('web.Loading',function(require){"use strict";var core=require('web.core');var framework=require('web.framework');var session=require('web.session');var Widget=require('web.Widget');var _t=core._t;var Loading=Widget.extend({template:_t("Loading"),init:function(parent){this._super(parent);this.count=0;this.blocked_ui=false;session.on("request",this,this.request_call);session.on("response",this,this.response_call);session.on("response_failed",this,this.response_call);},destroy:function(){this.on_rpc_event(-this.count);this._super();},request_call:function(){this.on_rpc_event(1);},response_call:function(){this.on_rpc_event(-1);},on_rpc_event:function(increment){var self=this;if(!this.count&&increment===1){this.long_running_timer=setTimeout(function(){self.blocked_ui=true;framework.blockUI();},3000);}
this.count+=increment;if(this.count>0){if(session.debug){this.$el.text(_.str.sprintf(_t("Loading (%d)"),this.count));}else{this.$el.text(_t("Loading"));}
this.$el.show();this.getParent().$el.addClass('oe_wait');}else{this.count=0;clearTimeout(this.long_running_timer);if(self.blocked_ui){this.blocked_ui=false;framework.unblockUI();}
this.$el.fadeOut();this.getParent().$el.removeClass('oe_wait');}}});return Loading;});;

/* /web/static/src/js/widgets/notification.js defined in bundle 'web.assets_backend' */
odoo.define('web.notification',function(require){"use strict";var core=require('web.core');var Widget=require('web.Widget');var _t=core._t;var Notification=Widget.extend({template:'Notification',events:{'click .o_close':function(e){e.preventDefault();this.destroy(true);}},init:function(parent,title,text,sticky){this._super.apply(this,arguments);this.title=title;this.text=text;this.sticky=!!sticky;},start:function(){this._super.apply(this,arguments);var self=this;this.$el.animate({opacity:1.0},400,"swing",function(){if(!self.sticky){setTimeout(function(){self.destroy(true);},2500);}});},destroy:function(animate){if(!animate){return this._super.apply(this,arguments);}
var self=this,superDestroy=this._super;this.$el.animate({opacity:0.0},400,"swing",function(){self.$el.animate({height:0},400,"swing",function(){superDestroy.call(self);});});},});var Warning=Notification.extend({template:'Warning',});var NotificationManager=Widget.extend({className:'o_notification_manager',display:function(notification){notification.appendTo(this.$el);return notification;},notify:function(title,text,sticky){return this.display(new Notification(this,title,text,sticky));},warn:function(title,text,sticky){return this.display(new Warning(this,title,text,sticky));},});return{Notification:Notification,Warning:Warning,NotificationManager:NotificationManager,};});;

/* /web/static/src/js/widgets/sidebar.js defined in bundle 'web.assets_backend' */
odoo.define('web.Sidebar',function(require){"use strict";var core=require('web.core');var data=require('web.data');var Dialog=require('web.Dialog');var framework=require('web.framework');var pyeval=require('web.pyeval');var session=require('web.session');var Widget=require('web.Widget');var QWeb=core.qweb;var _t=core._t;var Sidebar=Widget.extend({init:function(parent,options){var self=this;this._super(parent);this.options=_.defaults(options||{},{'editable':true});this.sections=options.sections||[{name:'print',label:_t('Print')},{name:'other',label:_t('Action')},];this.items=options.items||{print:[],other:[],};this.fileupload_id=_.uniqueId('oe_fileupload');$(window).on(this.fileupload_id,function(){var args=[].slice.call(arguments).slice(1);self.do_attachement_update(self.dataset,self.model_id,args);framework.unblockUI();});},start:function(){var self=this;this._super(this);this.redraw();this.$el.on('click','.dropdown-menu li a',function(event){var section=$(this).data('section');var index=$(this).data('index');var item=self.items[section][index];if(item.callback){item.callback.apply(self,[item]);}else if(item.action){self.on_item_action_clicked(item);}else if(item.url){return true;}
event.preventDefault();});},redraw:function(){var self=this;self.$el.html(QWeb.render('Sidebar',{widget:self}));this.$('.oe_form_dropdown_section').each(function(){$(this).toggle(!!$(this).find('li').length);});self.$("[title]").tooltip({delay:{show:500,hide:0}});},add_items:function(section_code,items){if(items){this.items[section_code].unshift.apply(this.items[section_code],items);this.redraw();}},add_toolbar:function(toolbar){var self=this;_.each(['print','action','relate'],function(type){var items=toolbar[type];if(items){for(var i=0;i<items.length;i++){items[i]={label:items[i]['name'],action:items[i],classname:'oe_sidebar_'+type};}
var sec_rule=self.getParent().getParent().action&&self.getParent().getParent().action.security_rule;var hide_reports=(sec_rule===false)||(_.isObject(sec_rule)&&sec_rule.hide_reports);if(type=='print'&&!hide_reports){self.add_items('print',items);}else{self.add_items('other',items);}}});},on_item_action_clicked:function(item){var self=this;self.getParent().sidebar_eval_context().done(function(sidebar_eval_context){var ids=self.getParent().get_selected_ids();var domain;if(self.getParent().get_active_domain){domain=self.getParent().get_active_domain();}
else{domain=$.Deferred().resolve(undefined);}
if(ids.length===0&&!(item.action.context&&py.eval(item.action.context).sidebar_without_id)){new Dialog(this,{title:_t("Warning"),size:'medium',$content:$("<div/>").html(_t("You must choose at least one record."))}).open();return false;}
var dataset=self.getParent().dataset;var active_ids_context={active_id:(ids.length&&ids[0])||null,active_ids:ids,active_model:dataset.model,};$.when(domain).done(function(domain){if(domain!==undefined){active_ids_context.active_domain=domain;}
var c=pyeval.eval('context',new data.CompoundContext(sidebar_eval_context,active_ids_context));self.rpc("/web/action/load",{action_id:item.action.id,context:new data.CompoundContext(dataset.get_context(),active_ids_context).eval()}).done(function(result){result.context=new data.CompoundContext(result.context||{},active_ids_context).set_eval_context(c);result.flags=result.flags||{};result.flags.new_window=true;self.do_action(result,{on_close:function(){if(self.getParent().reload){self.getParent().reload();}else{Array.prototype.push.apply(self.getParent().view_list.groups.datagroup.model._domain,window.new_domain);delete window.new_domain;self.getParent().view_list.reload();}},additional_context:{select_create:!!c.select_create},});});});});},do_attachement_update:function(dataset,model_id,args){this.dataset=dataset;this.model_id=model_id;if(args&&args[0].error){this.do_warn(_t('Uploading Error'),args[0].error);}
if(!model_id){this.on_attachments_loaded([]);}else{var dom=[['res_model','=',dataset.model],['res_id','=',model_id],['type','in',['binary','url']]];var ds=new data.DataSetSearch(this,'ir.attachment',dataset.get_context(),dom);ds.read_slice(['name','url','type','create_uid','create_date','write_uid','write_date'],{}).done(this.on_attachments_loaded);}},on_attachments_loaded:function(attachments){_.each(attachments,function(a){a.label=a.name;if(a.type==="binary"){a.url='/web/content/'+a.id+'?download=true';}});this.items.files=attachments;this.redraw();this.$('.oe_sidebar_add_attachment .o_form_input_file').change(this.on_attachment_changed);this.$el.find('.oe_sidebar_delete_item').click(this.on_attachment_delete);},on_attachment_changed:function(e){var $e=$(e.target);if($e.val()!==''){this.$el.find('form.o_form_binary_form').submit();$e.parent().find('input[type=file]').prop('disabled',true);$e.parent().find('button').prop('disabled',true).find('img, span').toggle();this.$('.oe_sidebar_add_attachment a').text(_t('Uploading...'));framework.blockUI();}},on_attachment_delete:function(e){e.preventDefault();e.stopPropagation();var self=this;var $e=$(e.currentTarget);if(confirm(_t("Do you really want to delete this attachment ?"))){(new data.DataSet(this,'ir.attachment')).unlink([parseInt($e.attr('data-id'),10)]).done(function(){self.do_attachement_update(self.dataset,self.model_id);});}}});return Sidebar;});;

/* /web/static/src/js/widgets/priority.js defined in bundle 'web.assets_backend' */
odoo.define('web.Priority',function(require){"use strict";var core=require('web.core');var Widget=require('web.Widget');var QWeb=core.qweb;var _t=core._t;var Priority=Widget.extend({template:"Priority",events:{'mouseover > a':function(e){clearTimeout(this.hover_timer);this.$stars.removeClass('fa-star-o').addClass('fa-star');$(e.target).nextAll().removeClass('fa-star').addClass('fa-star-o');},'mouseout > a':function(e){clearTimeout(this.hover_timer);var self=this;this.hover_timer=setTimeout(function(){self._render_value();},200);},'click > a':function(e){e.preventDefault();e.stopPropagation();var old_value=this.value;this.value=String($(e.target).data('value'));if(old_value===this.value){this.value=this.empty_value;}
this._render_value();this.trigger('update',{value:this.value});},},init:function(parent,options){this._super.apply(this,arguments);options=_.defaults(options||{},{readonly:true,value:0,values:[[0,_t("Normal")],[1,_t("Low")],[2,_t("High")],[3,_t("Very High")]],});this.readonly=options.readonly;this.value=options.value;this.values=options.values;this.empty_value=this.values[0][0];},start:function(){this._render_value();return this._super();},set_value:function(value){this.value=value;this._render_value();},_render_value:function(){var current_value=this.value;this.$stars=this.$('.o_priority_star');this.$stars.each(function(i,el){var $star=$(el);var star_value=$star.data('value');$star.toggleClass('fa-star',(star_value<=current_value)).toggleClass('fa-star-o',(star_value>current_value));});},});return Priority;});;

/* /web/static/src/js/widgets/progress_bar.js defined in bundle 'web.assets_backend' */
odoo.define('web.ProgressBar',function(require){"use strict";var core=require('web.core');var utils=require('web.utils');var Widget=require('web.Widget');var QWeb=core.qweb;var _t=core._t;var ProgressBar=Widget.extend({template:"ProgressBar",events:{'change input':'on_change_input','input input':'on_change_input','keyup input':function(e){if(e.which===$.ui.keyCode.ENTER){this.on_change_input(e);}},},init:function(parent,options){this._super(parent);options=_.defaults(options||{},{readonly:true,edit_on_click:false,value:0,max_value:100,title:'',edit_max_value:false,});this.readonly=options.readonly;this.edit_on_click=options.edit_on_click;this.value=options.value;this.max_value=options.max_value;this.title=options.title;this.edit_max_value=options.edit_max_value;},start:function(){this._render_value();if(!this.readonly){if(this.edit_on_click){var self=this;this.$el.on('click','.o_progress',function(e){var $target=$(e.currentTarget);self.value=Math.floor((e.pageX-$target.offset().left)/$target.outerWidth()*self.max_value);self._render_value();self.trigger('update',{value:self.value,max_value:self.max_value,changed_value:self.value});});}else{this.$el.on('blur','input',_.bind(this.on_change_input,this));}
this.$('.o_progressbar_value').focus().select()}
return this._super();},on_change_input:function(e){var $input=$(e.target);if(e.type==='change'&&!$input.is(':focus')){return;}
if(isNaN($input.val())){this.do_warn(_t("Wrong value entered!"),_t("Only Integer Value should be valid."));}else{if(e.type==='input'){this._render_value($input.val());if(parseFloat($input.val())===0){$input.select();}}else{if(this.edit_max_value){this.max_value=$(e.target).val();}else{this.value=$(e.target).val()||0;}
this._render_value();this.trigger('update',{value:this.value,max_value:this.max_value,changed_value:(this.edit_max_value)?this.max_value:this.value});}}},set_value:function(v){this.value=v;this._render_value();},_render_value:function(v){var value=this.value;var max_value=this.max_value;if(!isNaN(v)){if(this.edit_max_value){max_value=v;}else{value=v;}}
value=value||0;max_value=max_value||0;var widthComplete;if(value<=max_value){widthComplete=value/max_value*100;}else{widthComplete=max_value/value*100;}
this.$('.o_progress').toggleClass('o_progress_overflow',value>max_value);this.$('.o_progressbar_complete').css('width',widthComplete+'%');if(this.readonly){if(max_value!==100){this.$('.o_progressbar_value').html(utils.human_number(value)+" / "+utils.human_number(max_value));}else{this.$('.o_progressbar_value').html(utils.human_number(value)+"%");}}else if(isNaN(v)){this.$('.o_progressbar_value').val(this.edit_max_value?max_value:value);}}});return ProgressBar;});;

/* /web/static/src/js/widgets/pager.js defined in bundle 'web.assets_backend' */
odoo.define('web.Pager',function(require){"use strict";var utils=require('web.utils');var Widget=require('web.Widget');var direction={previous:-1,next:1,};var Pager=Widget.extend({template:"Pager",events:{'click .o_pager_previous':'previous','click .o_pager_next':'next','click .o_pager_value':'_edit',},init:function(parent,size,current_min,limit,options){this.state={size:size,current_min:current_min,limit:limit,};Object.defineProperty(this.state,'current_max',{get:function(){return Math.min(this.current_min+this.limit-1,this.size);}});this.options=_.defaults({},options,{can_edit:true,single_page_hidden:false,});this._super(parent);},start:function(){this.$value=this.$('.o_pager_value');this.$limit=this.$('.o_pager_limit');this._render();return this._super();},update_state:function(state){_.extend(this.state,state);this._render();},previous:function(){this._change_selection(direction.previous);},next:function(){this._change_selection(direction.next);},disable:function(){this.$('button').prop("disabled",true);},enable:function(){this.$('button').prop("disabled",false);},_edit:function(){if(this.options.can_edit){var self=this;var $input=$('<input>').val(this.$value.html());this.$value.html($input);$input.focus();$input.click(function(ev){ev.stopPropagation();});$input.blur(function(ev){self._save($(ev.target));});$input.on('keydown',function(ev){ev.stopPropagation();if(ev.which===$.ui.keyCode.ENTER){self._save($(ev.target));}else if(ev.which===$.ui.keyCode.ESCAPE){self._render();}});}},_save:function($input){var value=$input.val().split("-");var min=utils.confine(parseInt(value[0],10),1,this.state.size);var max=utils.confine(parseInt(value[1],10),1,this.state.size);if(!isNaN(min)){this.state.current_min=min;if(!isNaN(max)){this.state.limit=utils.confine(max-min+1,1,this.state.size);}else{this.state.limit=1;}
this.trigger('pager_changed',_.clone(this.state));}
this._render();},_change_selection:function(direction){var size=this.state.size;var current_min=this.state.current_min;var limit=this.state.limit;current_min=(current_min+limit*direction);if(current_min>size){current_min=1;}else if((current_min<1)&&(limit===1)){current_min=size;}else if((current_min<1)&&(limit>1)){current_min=size-((size%limit)||limit)+1;}
this.state.current_min=current_min;this.trigger('pager_changed',_.clone(this.state));this._render();},_render:function(){var size=this.state.size;var current_min=this.state.current_min;var current_max=this.state.current_max;var single_page=1===current_min&&current_max===size;if(size===0||(single_page&&this.options.single_page_hidden)){this.do_hide();}else{this.do_show();if(single_page){this.disable();}else{this.enable();}
var value=""+current_min;if(this.state.limit>1){value+="-"+current_max;}
this.$value.html(value);this.$limit.html(size);}},});return Pager;});;

/* /web/static/src/js/widgets/systray_menu.js defined in bundle 'web.assets_backend' */
odoo.define('web.SystrayMenu',function(require){"use strict";var Widget=require('web.Widget');var SystrayMenu=Widget.extend({init:function(parent){this._super(parent);this.items=[];this.load=$.Deferred();},start:function(){var self=this;self._super.apply(this,arguments);self.load_items();return $.when.apply($,self.items).done(function(){self.load.resolve();});},load_items:function(){var self=this;_.each(SystrayMenu.Items,function(widgetCls){var cur_systray_item=new widgetCls(self);self.items.push(cur_systray_item.appendTo(self.$el));});},});SystrayMenu.Items=[];return SystrayMenu;});;

/* /web/static/src/js/widgets/user_menu.js defined in bundle 'web.assets_backend' */
odoo.define('web.UserMenu',function(require){"use strict";var core=require('web.core');var Dialog=require('web.Dialog');var framework=require('web.framework');var Model=require('web.DataModel');var session=require('web.session');var Widget=require('web.Widget');var _t=core._t;var QWeb=core.qweb;var UserMenu=Widget.extend({template:"UserMenu",init:function(parent){this._super(parent);this.update_promise=$.Deferred().resolve();},start:function(){var self=this;this.$el.on('click','.dropdown-menu li a[data-menu]',function(ev){ev.preventDefault();var f=self['on_menu_'+$(this).data('menu')];if(f){f($(this));}});this.$el.parent().show();return this._super.apply(this,arguments);},do_update:function(){var self=this;var fct=function(){var $avatar=self.$el.find('.oe_topbar_avatar');$avatar.attr('src',$avatar.data('default-src'));if(!session.uid)
return;var func=new Model("res.users").get_func("read");return self.alive(func(session.uid,["name","company_id"])).then(function(res){var topbar_name=res.name;if(session.debug)
topbar_name=_.str.sprintf("%s (%s)",topbar_name,session.db);if(res.company_id[0]>1)
topbar_name=_.str.sprintf("%s (%s)",topbar_name,res.company_id[1]);self.$el.find('.oe_topbar_name').text(topbar_name);if(!session.debug){topbar_name=_.str.sprintf("%s (%s)",topbar_name,session.db);}
var avatar_src=session.url('/web/image',{model:'res.users',field:'image_small',id:session.uid});$avatar.attr('src',avatar_src);core.bus.trigger('resize');});};this.update_promise=this.update_promise.then(fct,fct);},on_menu_documentation:function(){window.open('https://www.odoo.com/documentation/user','_blank');},on_menu_support:function(){window.open('https://www.odoo.com/buy','_blank');},on_menu_about:function(){var self=this;if(odoo.db_info){menu_help_about(odoo.db_info);}else{this.rpc("/web/webclient/version_info",{}).done(menu_help_about);}
function menu_help_about(db_info){var $help=$(QWeb.render("UserMenu.about",{db_info:db_info}));$help.find('a.oe_activate_debug_mode').click(function(e){e.preventDefault();window.location=$.param.querystring(window.location.href,'debug');});new Dialog(self,{size:'medium',dialogClass:'o_act_window',title:_t("About"),$content:$help}).open();}},on_menu_settings:function(){var self=this;this.getParent().clear_uncommitted_changes().then(function(){self.rpc("/web/action/load",{action_id:"base.action_res_users_my"}).done(function(result){result.res_id=session.uid;self.getParent().action_manager.do_action(result);});});},on_menu_account:function(){this.getParent().clear_uncommitted_changes().then(function(){var P=new Model('ir.config_parameter');P.call('get_param',['database.uuid']).then(function(dbuuid){var state={'d':session.db,'u':window.location.protocol+'//'+window.location.host,};var params={response_type:'token',client_id:dbuuid||'',state:JSON.stringify(state),scope:'userinfo',};framework.redirect('https://accounts.odoo.com/oauth2/auth?'+$.param(params));}).fail(function(result,ev){ev.preventDefault();framework.redirect('https://accounts.odoo.com/account');});});},on_menu_logout:function(){this.trigger('user_logout');},});return UserMenu;});;

/* /web/static/src/js/menu.js defined in bundle 'web.assets_backend' */
odoo.define('web.Menu',function(require){"use strict";var core=require('web.core');var session=require('web.session');var Widget=require('web.Widget');var QWeb=core.qweb;var Menu=Widget.extend({init:function(){var self=this;this._super.apply(this,arguments);this.is_bound=$.Deferred();this.data={data:{children:[]}};this.on("menu_bound",this,function(){var $all_menus=self.$el.parents('body').find('.oe_webclient').find('[data-menu]');var all_menu_ids=_.map($all_menus,function(menu){return parseInt($(menu).attr('data-menu'),10);});if(!_.isEmpty(all_menu_ids)){this.do_load_needaction(all_menu_ids);}});this.hide_file_menu=true;$(function(){$('ul.dropdown-menu [data-toggle=dropdown]').on('click',function(event){event.preventDefault();event.stopPropagation();$('ul.dropdown-menu [data-toggle=dropdown]').parent().removeClass('open');$(this).parent().addClass('open');});$('li.dropdown-submenu a').hover(function(ev){if($('body').width()>768){if(ev.target.nextElementSibling&&$(ev.target.nextElementSibling).offset().left+$(ev.target.nextElementSibling).width()>$("body").innerWidth()){var top=$(ev.target.nextElementSibling).offset().left.top+25;var left=$(ev.target).parent().offset().left-$(ev.target.nextElementSibling).width();$(ev.target.nextElementSibling).offset({'left':left,'top':top});}}});});$('#btn_menu_toggle').click(function(ev){self.hide_file_menu=!self.hide_file_menu;$('.oe_leftbar').toggle();$('.menu_drop').toggle();$('.menu_normal').toggle();self.reflow(false);});core.bus.on('do_reload_needaction',this,this.do_reload_needaction);core.bus.on('change_menu_section',this,this.on_change_top_menu);},start:function(){this._super.apply(this,arguments);return this.bind_menu();},do_reload:function(){var self=this;self.bind_menu();},bind_menu:function(){var self=this;this.$secondary_menus=this.$el.parents().find('.oe_secondary_menus_container');this.$secondary_menus.on('click','a[data-menu]',this.on_menu_click);this.$el.on('click','a[data-menu]',function(event){event.preventDefault();var menu_id=$(event.currentTarget).data('menu');var needaction=$(event.target).is('div#menu_counter');if(event.target.parentNode.dataset.actionId){core.bus.trigger('change_menu_section',menu_id,needaction,event.target.parentNode.dataset.actionId);}
else if(event.target.dataset.actionId){core.bus.trigger('change_menu_section',menu_id,needaction,event.target.dataset.actionId);}
else{core.bus.trigger('change_menu_section',menu_id,needaction,false);}});this.$secondary_menus.find('.oe_menu_toggler').siblings('.oe_secondary_submenu').hide();if(self.current_menu){self.open_menu(self.current_menu);}
this.trigger('menu_bound');var lazyreflow=_.debounce(this.reflow.bind(this),200);core.bus.on('resize',this,function(){if($(window).width()<768){lazyreflow('all_outside');}else{lazyreflow();}});core.bus.trigger('resize');this.is_bound.resolve();for(var i=0;i<$('ul.nav>li.menu_drop>a').length;i++){if($('ul.nav>li.menu_drop>a')[i].innerHTML.indexOf('Favorite')!==-1){$($('ul.nav>li.menu_drop>a')[i]).html('<span class="oe_menu_text fa fa-star-o" style="color: rgb(255, 255, 255); cursor: pointer; font-size: 30px;"></span>');$($('ul.nav>li.menu_drop>a')[i]).css({'padding':'0px','margin-top':'0px'});break;}}
for(var i=0;i<$('ul.nav>li.menu_normal>a').length;i++){if($('ul.nav>li.menu_normal>a')[i].innerHTML.indexOf('Favorite')!==-1){$($('ul.nav>li.menu_normal>a')[i]).html('<span class="oe_menu_text fa fa-star-o" style="color: rgb(255, 255, 255); cursor: pointer; font-size: 30px;"></span>');$($('ul.nav>li.menu_normal>a')[i]).css({'padding':'0px','margin-top':'0px'});break;}}},do_load_needaction:function(menu_ids){var self=this;menu_ids=_.compact(menu_ids);if(_.isEmpty(menu_ids)){return $.when();}
return this.rpc("/web/menu/load_needaction",{'menu_ids':menu_ids}).done(function(r){self.on_needaction_loaded(r);});},on_needaction_loaded:function(data){var self=this;this.needaction_data=data;_.each(this.needaction_data,function(item,menu_id){var $item=self.$secondary_menus.find('a[data-menu="'+menu_id+'"]');$item.find('.badge').remove();if(item.needaction_counter&&item.needaction_counter>0){$item.append(QWeb.render("Menu.needaction_counter",{widget:item}));}});},reflow:function(behavior){var self=this;for(var i=0;i<$('header.o_statusbar_buttons').length;i++){$($('header.o_statusbar_buttons')[i]).width($($('header.o_statusbar_buttons')[i]).parent().outerWidth()+20);}
if($('body').width()<768){this.hide_file_menu=false;}
if(this.hide_file_menu){var $more_container=this.$('#menu_more_container').hide();var $more=this.$('#menu_more');var $systray=this.$el.parents().find('.oe_systray');$more.children('li').insertBefore($more_container);if(behavior==='all_outside'){self.$el.show();this.$el.find('li').show();$more_container.hide();return;}
var $toplevel_items=this.$el.find('li.menu_normal').not($more_container).not($systray.find('li')).hide();self.$el.show();self.$el.children().filter('.menu_drop').hide();$toplevel_items.each(function(){var remaining_space=self.$el.parent().width()-$more_container.outerWidth();self.$el.parent().children(':visible').each(function(){remaining_space-=$(this).outerWidth();});if($(this).width()>=remaining_space){return false;}
$(this).show();});$more.append($toplevel_items.filter(':hidden').show());$more_container.toggle(!!$more.children().length);self.$el.children("li.menu_drop:visible").hide();var $toplevel=self.$el.children("li.menu_normal:visible");if($toplevel.length===1){$toplevel.hide();}}
else{var $more_container=this.$('#menu_more_container').hide();var $more=this.$('#menu_more');var $systray=this.$el.parents().find('.oe_systray');$more.children('li').insertBefore($more_container);if(behavior==='all_outside'){for(var i=0;i<this.$el.find('li.dropdown-submenu').length;i++){$(this.$el.find('li.dropdown-submenu')[i]).addClass('dropdown');$(this.$el.find('li.dropdown-submenu')[i]).removeClass('dropdown-submenu');i--;}
self.$el.show();this.$el.find('li').show();$more_container.hide();return;}
if(this.$el.find('li.dropdown-submenu').length===0){window.location.reload();}
var $toplevel_items=this.$el.find('li.menu_drop_first').not($more_container).not($systray.find('li')).hide();for(var i=0;i<$toplevel_items.length;i++){$($toplevel_items[i]).addClass('dropdown');$($toplevel_items[i]).removeClass('dropdown-submenu');}
$('.dropdown-submenu').css('display','list-item');self.$el.show();$toplevel_items.each(function(){var remaining_space=self.$el.parent().width()-$more_container.outerWidth();self.$el.parent().children(':visible').each(function(){remaining_space-=$(this).outerWidth();});if($(this).width()>=remaining_space){return false;}
$(this).show();});for(var i=0;i<$toplevel_items.filter(':hidden').length;i++){$($toplevel_items.filter(':hidden')[i]).removeClass('dropdown');$($toplevel_items.filter(':hidden')[i]).addClass('dropdown-submenu');}
$more.append($toplevel_items.filter(':hidden').show());$more_container.toggle(!!$more.children().length);$('.menu_normal').hide();var $toplevel=self.$el.children("li:visible");if($toplevel.length===1){$toplevel.hide();}}},open_menu:function(id,action_id){this.current_menu=id;session.active_id=id;var $clicked_menu,$sub_menu,$main_menu;$clicked_menu=this.$el.add(this.$secondary_menus).find('a[data-menu='+id+']');this.trigger('open_menu',id,$clicked_menu);if(this.$secondary_menus.has($clicked_menu).length){$sub_menu=$clicked_menu.parents('.oe_secondary_menu');$main_menu=this.$el.find('a[data-menu='+$sub_menu.data('menu-parent')+']');}else{$sub_menu=this.$secondary_menus.find('.oe_secondary_menu[data-menu-parent='+$clicked_menu.attr('data-menu')+']');$main_menu=$clicked_menu;}
this.$el.find('.active').removeClass('active');$main_menu.parent().addClass('active');this.$secondary_menus.find('.oe_secondary_menu').hide();$sub_menu.show();if(this.hide_file_menu){this.$secondary_menus.parent('.oe_leftbar').toggle(!!$sub_menu.children().length);}
this.$secondary_menus.find('.active').removeClass('active');if($main_menu!==$clicked_menu){if(this.hide_file_menu){$clicked_menu.parents().show();}
if($clicked_menu.is('.oe_menu_toggler')){$clicked_menu.toggleClass('oe_menu_opened').siblings('.oe_secondary_submenu:first').toggle();}else{$clicked_menu.parent().addClass('active');}}
this.$secondary_menus.find('.oe_secondary_submenu li a span').each(function(){$(this).tooltip(this.scrollWidth>this.clientWidth?{title:$(this).text().trim(),placement:'right'}:'destroy');});if(this.hide_file_menu){$('.menu_drop').css('display','none');}
$('ul.nav > .menu_drop > ul[style="display: block;"]').parent().addClass('active');$('.menu_drop > ul').removeAttr('style');var main_menu_text=$main_menu[0].children[0].innerText.trim();$('.menu_drop').removeClass('active_menu_drop');if(main_menu_text.length===0){for(var i=0;i<$('.menu_drop').children('a').length;i++){if($('.menu_drop').children('a')[i].innerHTML.indexOf("fa-star-o")!==-1){$($('.menu_drop').children('a')[i].parentNode).addClass('active_menu_drop');}}}
else{for(var i=0;i<$('.menu_drop_first').children('a').length;i++){if($('.menu_drop_first').children('a')[i].innerHTML.indexOf(main_menu_text)!==-1){$($('.menu_drop_first').children('a')[i].parentNode).addClass('active_menu_drop');}}}
if(action_id){var $item=this.$el.find('a[data-menu='+id+']');if($('body').width()<768){$('.navbar-collapse').removeClass('in');$('.navbar-collapse')[0].setAttribute("aria-expanded",false);}
this.trigger('menu_click',{action_id:action_id,needaction:false,id:id,previous_menu_id:this.current_menu},$item);}},open_action:function(id){var $menu=this.$el.add(this.$secondary_menus).find('a[data-action-id="'+id+'"]');var menu_id=$menu.data('menu');if(menu_id){this.open_menu(menu_id);}},menu_click:function(id,needaction){if(!id){return;}
var $item=this.$el.find('a[data-menu='+id+']');if(!$item.length){$item=this.$secondary_menus.find('a[data-menu='+id+']');}
var action_id=$item.data('action-id');if(action_id){this.trigger('menu_click',{action_id:action_id,needaction:needaction,id:id,previous_menu_id:this.current_menu},$item);}else{console.log('Menu no action found web test 04 will fail');}
this.open_menu(id);},do_reload_needaction:function(){var self=this;if(self.current_menu){self.do_load_needaction([self.current_menu]).then(function(){self.trigger("need_action_reloaded");});}},on_change_top_menu:function(menu_id,needaction,action_id){var self=this;this.$el.parents().find(".oe_secondary_menus_container").scrollTop(0,0);var def=this.getParent().clear_uncommitted_changes()||$.when();def.then(function(){self.open_menu(menu_id,action_id);$('.home_selected').removeClass('home_selected').hide();$('#homepage').hide();$('.oe_webclient').show();var $application=self.getParent().$el.find('.oe_application');var $home=$('#homepage_menu_'+menu_id);$application.hide();$home.show().addClass('home_selected');})},on_menu_click:function(ev){ev.preventDefault();this.menu_click($(ev.currentTarget).data('menu'),false);},});return Menu;});;

/* /web/static/src/js/views/list_common.js defined in bundle 'web.assets_backend' */
odoo.define('web.list_common',function(require){"use strict";var core=require('web.core');var _t=core._t;var Class=core.Class;var Events={bind:function(event,handler){var calls=this['_callbacks']||(this._callbacks={});if(event in calls){calls[event].push(handler);}else{calls[event]=[handler];}
return this;},unbind:function(event,handler){var calls=this._callbacks||{};if(!(event in calls)){return this;}
if(!handler){delete calls[event];}else{var handlers=calls[event];handlers.splice(_(handlers).indexOf(handler),1);}
return this;},trigger:function(event){var calls;if(!(calls=this._callbacks)){return this;}
var callbacks=(calls[event]||[]).concat(calls[null]||[]);for(var i=0,length=callbacks.length;i<length;++i){callbacks[i].apply(this,arguments);}
return this;}};var Record=Class.extend({init:function(data){this.attributes=data||{};},get:function(key){return this.attributes[key];},set:function(key,value,options){options=options||{};var old_value=this.attributes[key];if(old_value===value){return this;}
this.attributes[key]=value;if(!options.silent){this.trigger('change:'+key,this,value,old_value);this.trigger('change',this,key,value,old_value);}
return this;},toForm:function(){var form_data={},attrs=this.attributes;for(var k in attrs){form_data[k]={value:attrs[k]};}
return{data:form_data};},toContext:function(){var output={},attrs=this.attributes;for(var k in attrs){var val=attrs[k];if(typeof val!=='object'){output[k]=val;}else if(val instanceof Array&&!k.endsWith('_ids')){output[k]=val[0];}else if(val instanceof Array&&k.endsWith('_ids')){output[k]=val;}else{throw new Error(_.str.sprintf(_t("Can't convert value %s to context"),val));}}
return output;}});Record.include(Events);var Collection=Class.extend({init:function(records,options){options=options||{};_.bindAll(this,'_onRecordEvent');this.length=0;this.records=[];this._byId={};this._proxies={};this._key=options.key;this._parent=options.parent;if(records){this.add(records);}},add:function(record,options){options=options||{};var records=record instanceof Array?record:[record];for(var i=0,length=records.length;i<length;++i){var instance_=(records[i]instanceof Record)?records[i]:new Record(records[i]);instance_.bind(null,this._onRecordEvent);this._byId[instance_.get('id')]=instance_;if(options.at===undefined||options.at===null){this.records.push(instance_);if(!options.silent){this.trigger('add',this,instance_,this.records.length-1);}}else{var insertion_index=options.at+i;this.records.splice(insertion_index,0,instance_);if(!options.silent){this.trigger('add',this,instance_,insertion_index);}}
this.length++;}
return this;},at:function(index,group){if(group){var groups=group.split('.');return this._proxies[groups[0]].at(index,groups.join('.'));}
return this.records[index];},get:function(id){if(!_(this._proxies).isEmpty()){var record=null;_(this._proxies).detect(function(proxy){record=proxy.get(id);return record;});return record;}
return this._byId[id];},proxy:function(section){this._proxies[section]=new Collection(null,{parent:this,key:section}).bind(null,this._onRecordEvent);return this._proxies[section];},reset:function(records,options){options=options||{};_(this._proxies).each(function(proxy){proxy.reset();});this._proxies={};_(this.records).invoke('unbind',null,this._onRecordEvent);this.length=0;this.records=[];this._byId={};if(records){this.add(records);}
if(!options.silent){this.trigger('reset',this);}
return this;},remove:function(record,options){var index=this.indexOf(record);if(index===-1){_(this._proxies).each(function(proxy){proxy.remove(record);});return this;}
record.unbind(null,this._onRecordEvent);this.records.splice(index,1);delete this._byId[record.get('id')];this.length--;if(!options||!options.silent){this.trigger('remove',record,this);}
return this;},_onRecordEvent:function(event){switch(event){case'reset':return;case'change:id':var record=arguments[1];var new_value=arguments[2];var old_value=arguments[3];if(this._byId[old_value]===record){delete this._byId[old_value];this._byId[new_value]=record;}
break;}
this.trigger.apply(this,arguments);},find:function(callback){var record;for(var section in this._proxies){if(!this._proxies.hasOwnProperty(section)){continue;}
if((record=this._proxies[section].find(callback))){return record;}}
for(var i=0;i<this.length;++i){record=this.records[i];if(callback(record)){return record;}}},each:function(callback){for(var section in this._proxies){if(this._proxies.hasOwnProperty(section)){this._proxies[section].each(callback);}}
for(var i=0;i<this.length;++i){callback(this.records[i]);}},map:function(callback){var results=[];this.each(function(record){results.push(callback(record));});return results;},pluck:function(fieldname){return this.map(function(record){return record.get(fieldname);});},indexOf:function(record){return _(this.records).indexOf(record);},succ:function(record,options){options=options||{wraparound:false};var result;for(var section in this._proxies){if(!this._proxies.hasOwnProperty(section)){continue;}
if((result=this._proxies[section].succ(record,options))){return result;}}
var index=this.indexOf(record);if(index===-1){return null;}
var next_index=index+1;if(options.wraparound&&(next_index===this.length)){return this.at(0);}
return this.at(next_index);},pred:function(record,options){options=options||{wraparound:false};var result;for(var section in this._proxies){if(!this._proxies.hasOwnProperty(section)){continue;}
if((result=this._proxies[section].pred(record,options))){return result;}}
var index=this.indexOf(record);if(index===-1){return null;}
var next_index=index-1;if(options.wraparound&&(next_index===-1)){return this.at(this.length-1);}
return this.at(next_index);}});Collection.include(Events);return{Events:Events,Record:Record,Collection:Collection};});;

/* /web/static/src/js/views/list_view.js defined in bundle 'web.assets_backend' */
odoo.define('web.ListView',function(require){"use strict";var core=require('web.core');var data=require('web.data');var DataExport=require('web.DataExport');var formats=require('web.formats');var common=require('web.list_common');var Model=require('web.DataModel');var pyeval=require('web.pyeval');var session=require('web.session');var Sidebar=require('web.Sidebar');var utils=require('web.utils');var View=require('web.View');var Inputs=require('web.search_inputs');var time=require('web.time');var Class=core.Class;var _t=core._t;var _lt=core._lt;var QWeb=core.qweb;var list_widget_registry=core.list_widget_registry;var row_decoration=['decoration-bf','decoration-it','decoration-danger','decoration-info','decoration-muted','decoration-primary','decoration-success','decoration-warning'];var ListView=View.extend({_template:'ListView',accesskey:'L',icon:'fa-list-ul',display_name:_lt('List'),defaults:{'selectable':true,'deletable':false,'header':true,'addable':_lt("Create"),'sortable':true,'reorderable':true,'action_buttons':true,'disable_editable_mode':false,},view_type:'tree',events:{'click thead th.oe_sortable[data-id]':'sort_by_column','change .oe_list_header_search input':'change_list_filters','change .oe_list_header_search select[type]':'change_list_filters','mouseleave .ms-drop':'mouse_leave_ms_drop'},mouse_leave_ms_drop:function(ev){return null;},init:function(parent,dataset,view_id,options){var self=this;this._super(parent);this.set_default_options(_.extend({},this.defaults,options||{}));this.dataset=dataset;this.model=dataset.model;this.view_id=view_id;this.previous_colspan=null;this.colors=null;this.fonts=null;this.columns=[];this.records=new common.Collection();this.set_groups(new(this.options.GroupsType)(this));if(this.dataset instanceof data.DataSetStatic){this.groups.datagroup=new StaticDataGroup(this.dataset);}else{this.groups.datagroup=new DataGroup(this,this.model,dataset.get_domain(),dataset.get_context());this.groups.datagroup.sort=this.dataset._sort;}
this.page=0;this.records.bind('change',function(event,record,key){if(!_(self.aggregate_columns).chain().pluck('name').contains(key).value()){return;}
self.compute_aggregates();});this.no_leaf=false;this.grouped=false;if(!this.options.$pager||!this.options.$pager.length){this.options.$pager=false;}
this._limit=(this.options.limit||this.defaults.limit||(this.getParent().action||{}).limit||80);},view_loading:function(r){return this.load_list(r);},set_default_options:function(options){this._super(options);_.defaults(this.options,{GroupsType:ListView.Groups,ListType:ListView.List});},set_groups:function(groups){var self=this;if(this.groups){$(this.groups).unbind("selected deleted action row_link");delete this.groups;}
this.groups=groups;$(this.groups).bind({'selected':function(e,ids,records,deselected){self.do_select(ids,records,deselected);},'deleted':function(e,ids){self.do_delete(ids);},'action':function(e,action_name,id,callback){self.do_button_action(action_name,id,callback);},'row_link':function(e,id,dataset,view){self.do_activate_record(dataset.index,id,dataset,view);}});},start:function(){this.$el.addClass('oe_list o_list_view');return this._super();},compute_decoration_classnames:function(record){var classnames='';var context=_.extend({},record.attributes,{uid:session.uid,current_date:moment().format('YYYY-MM-DD')});_.each(this.decoration,function(expr,decoration){if(py.PY_isTrue(py.evaluate(expr,context))){classnames+=' '+decoration.replace('decoration','text');}});return classnames;},load_list:function(data){var self=this;this.fields_view=data;this.name=""+this.fields_view.arch.attrs.string;this._limit=parseInt(this.fields_view.arch.attrs.limit,10)||this._limit;this.decoration=_.pick(this.fields_view.arch.attrs,function(value,key){return row_decoration.indexOf(key)>=0;});this.decoration=_.mapObject(this.decoration,function(value){return py.parse(py.tokenize(value));});this.setup_columns(this.fields_view.fields,this.grouped);this.$el.html(QWeb.render(this._template,this));this.$el.addClass(this.fields_view.arch.attrs['class']);if(this.$el.find(".search_bar_select").length>0){this.$el.find(".search_bar_select").multipleSelect({selectAll:false,});}
this.$el.find('.oe_list_record_selector').click(function(){self.$el.find('.oe_list_record_selector input').prop('checked',self.$el.find('.oe_list_record_selector').prop('checked')||false);var selection=self.groups.get_selection();$(self.groups).trigger('selected',[selection.ids,selection.records]);});var default_order=this.fields_view.arch.attrs.default_order,unsorted=!this.dataset._sort.length;if(unsorted&&default_order&&!this.grouped){this.dataset.set_sort(default_order.split(','));}
if(this.dataset._sort.length){if(this.dataset._sort[0].indexOf('-')==-1){this.$el.find('th[data-id='+this.dataset._sort[0]+']').addClass("sortdown");}else{this.$el.find('th[data-id='+this.dataset._sort[0].split('-')[1]+']').addClass("sortup");}}
this.trigger('list_view_loaded',data,this.grouped);},render_buttons:function($node){if(!this.$buttons){this.$buttons=$(QWeb.render("ListView.buttons",{'widget':this}));this.$buttons.find('.o_list_button_add').click(this.proxy('do_add_record'));$node=$node||this.options.$buttons;if($node){this.$buttons.appendTo($node);}else{this.$('.oe_list_buttons').replaceWith(this.$buttons);}}},render_sidebar:function($node){if(!this.sidebar&&this.options.sidebar){this.sidebar=new Sidebar(this,{editable:this.is_action_enabled('edit')});if(this.fields_view.toolbar){this.sidebar.add_toolbar(this.fields_view.toolbar);}
var sec_rule=this.getParent().action.security_rule;var can_export=(true===sec_rule)||(_.isObject(sec_rule)&&sec_rule.can_export&&sec_rule.show_export);this.sidebar.add_items('other',_.compact([can_export&&{label:_t("Export"),callback:this.on_sidebar_export},this.fields_view.fields.active&&{label:_t("Archive"),callback:this.do_archive_selected},this.fields_view.fields.active&&{label:_t("Unarchive"),callback:this.do_unarchive_selected},this.is_action_enabled('delete')&&{label:_t('Delete'),callback:this.do_delete_selected}]));$node=$node||this.options.$sidebar||this.$('.oe_list_sidebar');this.sidebar.appendTo($node);}},render_pager:function($node){if(!this.$pager&&this.options.pager){var self=this;this.$pager=$(QWeb.render("ListView.pager",{'widget':self}));this.$pager.on('click','a[data-pager-action]',function(){var $this=$(this);var max_page_index=Math.ceil(self.dataset.size()/self._limit)-1;switch($this.data('pager-action')){case'first':self.page=0;break;case'last':self.page=max_page_index;break;case'next':self.page+=1;break;case'previous':self.page-=1;break;}
if(self.page<0){self.page=max_page_index;}else if(self.page>max_page_index){self.page=0;}
self.reload_content();}).find('.oe_list_pager_state').click(function(e){e.stopPropagation();var $this=$(this);var sec_rule;var obj=self;while(obj.getParent()){if(obj.getParent().action){sec_rule=obj.getParent().action.security_rule;break;}else{obj=obj.getParent();}}
var is_admin=(true===sec_rule)||(_.isObject(sec_rule)&&sec_rule.is_admin);var $select=$('<select>').appendTo($this.empty()).click(function(e){e.stopPropagation();}).append('<option value="80">80</option>'+'<option value="200">200</option>'+'<option value="500">500</option>'+'<option value="1000">1000</option>'+
(is_admin?'<option value="2000">2000</option><option value="NaN">'+_t("Unlimited")+'</option>':'')).change(function(){var val=parseInt($select.val(),10);self._limit=(isNaN(val)?null:val);self.page=0;self.reload_content();}).blur(function(){$(this).trigger('change');}).val(self._limit||'NaN');});this.configure_pager(this.dataset);$node=$node||this.options.$pager;if($node){this.$pager.appendTo($node);}else{this.$('.oe_list_pager').replaceWith(this.$pager);}}},sort_by_column:function(e){e.stopPropagation();var $column=$(e.currentTarget);var col_name=$column.data('id');var field=this.fields_view.fields[col_name];if(field&&!field.sortable){return false;}
if(!($column.hasClass("sortdown")||$column.hasClass("sortup"))){this.dataset.sort(col_name);}
this.dataset.sort(col_name);if($column.hasClass("sortdown")||$column.hasClass("sortup")){$column.toggleClass("sortup sortdown");}else{$column.addClass("sortdown");}
$column.siblings('.oe_sortable').removeClass("sortup sortdown");this.reload_content();},configure_pager:function(dataset){this.dataset.ids=dataset.ids;if(dataset._length){this.dataset._length=dataset._length;}
if(this.$pager){if(this.grouped){this.$pager.find('.oe-pager-buttons').hide();this.$pager.find('.oe_list_pager_state').text(this._limit||'∞');}else{var total=dataset.size();var limit=this._limit||total;this.$pager.find('.oe-pager-buttons').toggle(total>limit);this.$pager.find('.oe_pager_value').toggle(total!==0);var spager='-';if(total){var range_start=this.page*limit+1;var range_stop=range_start-1+limit;if(this.records.length){range_stop=range_start-1+this.records.length;}
if(range_stop>total){range_stop=total;}
spager=_.str.sprintf(_t("%d-%d of %d"),range_start,range_stop,total);}
this.$pager.find('.oe_list_pager_state').text(spager);}}},setup_columns:function(fields,grouped){this.columns.splice(0,this.columns.length);this.columns.push.apply(this.columns,_(this.fields_view.arch.children).map(function(field){var id=field.attrs.name;return for_(id,fields[id],field);}));if(grouped){this.columns.unshift(new ListView.MetaColumn('_group',_t("Group")));}
this.visible_columns=_.filter(this.columns,function(column){return column.invisible!=='1';});this.aggregate_columns=_(this.visible_columns).invoke('to_aggregate');},select_record:function(index,view){view=view||index===null||index===undefined?'form':('qualitychart'in this.getParent().views)?'qualitychart':'form';this.dataset.index=index;_.delay(_.bind(function(){this.do_switch_view(view);},this));},do_show:function(){this._super();for(var i=0;i<$('header.o_statusbar_buttons').length;i++){$($('header.o_statusbar_buttons')[i]).width($($('header.o_statusbar_buttons')[i]).parent().outerWidth()+20);}},reload_view:function(grouped,context){return this.load_view(context);},reload_content:synchronized(function(){var self=this;self.$el.find('.oe_list_record_selector').prop('checked',false);this.records.reset();var reloaded=$.Deferred();reloaded.then(function(){self.configure_pager(self.dataset);});this.$el.find('.oe_list_content').append(this.groups.render(function(){if(self.dataset.index===null){if(self.records.length){self.dataset.index=0;}}else if(self.dataset.index>=self.records.length){self.dataset.index=self.records.length?0:null;}
self.compute_aggregates();reloaded.resolve();}));this.do_push_state({page:this.page,limit:this._limit});return reloaded.promise();}),reload:function(){return this.reload_content();},reload_record:function(record){var self=this;var fields=this.fields_view.fields;return this.dataset.read_ids([record.get('id')],_.pluck(_(this.columns).filter(function(r){return r.tag==='field';}),'name'),{check_access_rule:true}).then(function(records){var values=records[0];if(!values){self.records.remove(record);return;}
_.each(values,function(value,key){if(fields[key]&&fields[key].type==='many2many')
record.set(key+'__display',false,{silent:true});record.set(key,value,{silent:true});});record.trigger('change',record);var def=$.Deferred();setTimeout(function(){def.resolve(records);},100);return def;});},do_load_state:function(state,warm){var reload=false;if(state.page&&this.page!==state.page){this.page=state.page;reload=true;}
if(state.limit){if(_.isString(state.limit)){state.limit=null;}
if(state.limit!==this._limit){this._limit=state.limit;reload=true;}}
if(reload){this.reload_content();}},on_sidebar_export:function(){new DataExport(this,this.dataset).open();},do_search:function(domain,context,group_by){this.page=0;this.groups.datagroup=new DataGroup(this,this.model,domain,context,group_by);this.groups.datagroup.sort=this.dataset._sort;if(_.isEmpty(group_by)&&!context['group_by_no_leaf']){group_by=null;}
this.no_leaf=!!context['group_by_no_leaf'];this.grouped=!!group_by;return this.alive(this.load_view(context)).then(this.proxy('reload_content'));},do_delete:function(ids){if(!(ids.length&&confirm(_t("Do you really want to remove these records?")))){return;}
var self=this;return $.when(this.dataset.unlink(ids)).done(function(){_(ids).each(function(id){self.records.remove(self.records.get(id));});if(self.dataset.size()===0){self.no_result();}else{if(self.records.length===0&&self.dataset.size()>0){self.$pager.find('ul li:first a').trigger('click');}else if(self.dataset.size()===self._limit){self.reload();}else{self.configure_pager(self.dataset);}}
self.compute_aggregates();});},do_select:function(ids,records,deselected){if(deselected){this.$('.oe_list_record_selector').prop('checked',false);}
if(!ids.length){this.dataset.index=0;this.compute_aggregates();return;}
this.dataset.index=_(this.dataset.ids).indexOf(ids[0]);this.compute_aggregates(_(records).map(function(record){return{count:1,values:record};}));},do_button_action:function(name,id,callback){this.handle_button(name,id,callback);},handle_button:function(name,id,callback){var action=_.detect(this.columns,function(field){return field.name===name;});if(!action){return;}
if('confirm'in action&&!window.confirm(action.confirm)){return;}
var c=new data.CompoundContext();c.set_eval_context(_.extend({active_id:id,active_ids:[id],active_model:this.dataset.model},this.records.get(id).toContext()));if(action.context){c.add(action.context);}
action.context=c;return this.do_execute_action(action,this.dataset,id,_.bind(callback,null,id));},do_activate_record:function(index,id,dataset,view){this.dataset.ids=dataset.ids;this.select_record(index,view);},do_add_record:function(){this.select_record(null);},do_delete_selected:function(){var ids=this.groups.get_selection().ids;if(ids.length){this.do_delete(this.groups.get_selection().ids);}else{this.do_warn(_t("Warning"),_t("You must select at least one record."));}},do_archive_selected:function(){var records=this.groups.get_selection().records;this.do_archive(records,true);},do_unarchive_selected:function(){var records=this.groups.get_selection().records;this.do_archive(records,false);},do_archive:function(records,archive){var active_value=!archive;var record_ids=[];_.each(records,function(record){if(record.active!=active_value){record_ids.push(record.id);}});if(record_ids.length){this.dataset.call('write',[record_ids,{active:active_value}]).done(_.bind(this.reload,this));}},compute_aggregates:function(records){var columns=_(this.aggregate_columns).filter(function(column){return column['function'];});if(_.isEmpty(columns)){return;}
if(_.isEmpty(records)){records=this.groups.get_records();}
records=_(records).compact();var count=0,sums={};_(columns).each(function(column){switch(column['function']){case'max':sums[column.id]=-Infinity;break;case'min':sums[column.id]=Infinity;break;default:sums[column.id]=0;}});_(records).each(function(record){count+=record.count||1;_(columns).each(function(column){var field=column.id,value=record.values[field];switch(column['function']){case'sum':if(!isNaN(value)){sums[field]+=Number(value);}
break;case'avg':sums[field]+=record.count*value;break;case'min':if(sums[field]>value){sums[field]=value;}
break;case'max':if(sums[field]<value){sums[field]=value;}
break;}});});var aggregates={};_(columns).each(function(column){var field=column.id;switch(column['function']){case'avg':aggregates[field]={value:sums[field]/count};break;default:aggregates[field]={value:sums[field]};}});this.display_aggregates(aggregates);},display_aggregates:function(aggregation){var $footer_cells=this.$el.find('.oe_list_footer');_(this.aggregate_columns).each(function(column){if(!column['function']){return;}
$footer_cells.filter(_.str.sprintf('[data-field=%s]',column.id)).html(column.format(aggregation,{process_modifiers:false}));});},get_selected_ids:function(){var ids=this.groups.get_selection().ids;return ids;},get_active_domain:function(){var self=this;var search_view=this.getParent().searchview;var search_data=search_view.build_search_data();return pyeval.eval_domains_and_contexts({domains:search_data.domains,contexts:search_data.contexts,group_by_seq:search_data.groupbys||[]}).then(function(results){var domain=self.dataset.domain.concat(results.domain||[]);return domain;});},pad_columns:function(count,options){options=options||{};var $first_header=this.$el.find('thead tr:first th');var colspan=$first_header.attr('colspan');if(colspan){if(!this.previous_colspan){this.previous_colspan=colspan;}
$first_header.attr('colspan',parseInt(colspan,10)+count);}
var $rows=this.$el.find('.oe_list_header_columns, tr:not(thead tr)').not(options['except']);var newcols=new Array(count+1).join('<td class="oe_list_padding"></td>');if(options.position==='before'){$rows.prepend(newcols);}else{$rows.append(newcols);}},unpad_columns:function(){this.$el.find('.oe_list_padding').remove();if(this.previous_colspan){this.$el.find('thead tr:first th').attr('colspan',this.previous_colspan);this.previous_colspan=null;}},no_result:function(){this.$el.find('.oe_view_nocontent').remove();if(this.groups.group_by||!this.options.action||!this.options.action.help){return;}
this.$el.find('table:first').hide();this.$el.prepend($('<div class="oe_view_nocontent">').html(this.options.action.help));if(this.$buttons){var $buttons=this.$buttons;this.$el.find('.oe_view_nocontent').click(function(){$buttons.width($buttons.width()+1).openerpBounce();});}},facet_for:function(field,field_name,val,op,label){return{category:field.string,field:{get_context:function(){return undefined;},get_groupby:function(){return[];},get_domain:function(){return[[field_name,op,val]];}},values:[{label:label||val,value:null}]};},change_list_filters:function(ev){if(ev.target.tagName==='SELECT'&&!ev.target.outerHTML.match(/☑/)&&!ev.target.className.match(/select_search_bar/)){return null;}
if(ev.target.offsetParent.className.match(/ms-drop/)){return null;}
var val=ev.target.value;if(ev.target.type=='datetime-local'){val=time.datetime_to_str(new Date(ev.target.value));}
var field_name=ev.target.dataset.colname||ev.target.parentNode.dataset.colname||ev.target.parentNode.parentNode.dataset.colname;var op='ilike';if(ev.target.parentNode.dataset.colname||ev.target.parentNode.parentNode.dataset.colname){op=ev.target.lastElementChild&&ev.target.lastElementChild.value||ev.target.parentNode.lastElementChild.value;}
if(ev.target.tagName=='SELECT'){var label=$(ev.target).find(':selected').text();op='=';}
this.ViewManager.searchview.query.add(this.facet_for(this.fields_view.fields[field_name],field_name,val,op,label));}});core.view_registry.add('list',ListView);ListView.List=Class.extend({init:function(group,opts){var self=this;this.group=group;this.view=group.view;this.session=this.view.session;this.options=opts.options;this.columns=opts.columns;this.dataset=opts.dataset;this.records=opts.records;this.record_callbacks={'remove':function(event,record){var id=record.get('id');self.dataset.remove_ids([id]);var $row=self.$current.children('[data-id='+id+']');var index=$row.data('index');$row.remove();},'reset':function(){return self.on_records_reset();},'change':function(event,record,attribute,value,old_value){var $row;if(attribute==='id'){if(old_value){throw new Error(_.str.sprintf(_t("Setting 'id' attribute on existing record %s"),JSON.stringify(record.attributes)));}
self.dataset.add_ids([value],self.records.indexOf(record));$row=self.$current.children('[data-id=false]');}else{$row=self.$current.children('[data-id='+record.get('id')+']');}
var $newRow=$(self.render_record(record));$newRow.find('.oe_list_record_selector input').prop('checked',!!$row.find('.oe_list_record_selector input').prop('checked'));$row.replaceWith($newRow);},'add':function(ev,records,record,index){var $new_row=$(self.render_record(record));var id=record.get('id');if(id){self.dataset.add_ids([id],index);}
if(index===0){$new_row.prependTo(self.$current);}else{var previous_record=records.at(index-1),$previous_sibling=self.$current.children('[data-id='+previous_record.get('id')+']');$new_row.insertAfter($previous_sibling);}}};_(this.record_callbacks).each(function(callback,event){this.records.bind(event,callback);},this);this.$current=$('<tbody>').delegate('input[readonly=readonly]','click',function(e){e.preventDefault();}).delegate('th.oe_list_record_selector','click',function(e){e.stopPropagation();var selection=self.get_selection();var checked=$(e.currentTarget).find('input').prop('checked');$(self).trigger('selected',[selection.ids,selection.records,!checked]);}).delegate('td.oe_list_record_delete','click',function(e){e.stopPropagation();var $row=$(e.target).closest('tr');$(self).trigger('deleted',[[self.row_id($row)]]);if(document.hasFocus&&!document.hasFocus()){$('<input />').appendTo('body').focus().remove();}}).delegate('td.oe_list_field_cell button','click',function(e){e.stopPropagation();var $target=$(e.currentTarget),field=$target.closest('td').data('field'),$row=$target.closest('tr'),record_id=self.row_id($row);if($target.attr('disabled')){return;}
$target.attr('disabled','disabled');$(self).trigger('action',[field.toString(),record_id,function(id){$target.removeAttr('disabled');return self.reload_record(self.records.get(id));}]);$.async_when().then(function(){$target.removeAttr('disabled');})}).delegate('a','click',function(e){e.stopPropagation();}).delegate('tr','click',function(e){var row_id=self.row_id(e.currentTarget);if(row_id){e.stopPropagation();if(!self.dataset.select_id(row_id)){throw new Error(_t("Could not find id in dataset"));}
self.row_clicked(e);}});},row_clicked:function(e,view){$(this).trigger('row_link',[this.dataset.ids[this.dataset.index],this.dataset,view]);},render_cell:function(record,column){var value;if(column.type==='reference'){value=record.get(column.id);var ref_match;if(value&&(ref_match=/^([\w\.]+),(\d+)$/.exec(value))){var model=ref_match[1],id=parseInt(ref_match[2],10);new data.DataSet(this.view,model).name_get([id]).done(function(names){if(!names.length){return;}
record.set(column.id+'__display',names[0][1]);});}}else if(column.type==='many2one'){value=record.get(column.id);if(typeof value==='number'||value instanceof Number){new data.DataSet(this.view,column.relation).name_get([value]).done(function(names){if(!names.length){return;}
record.set(column.id,names[0]);});}}else if(column.type==='many2many'){value=record.get(column.id);if(value instanceof Array&&!_.isEmpty(value)&&!record.get(column.id+'__display')){var ids;if(value[0]instanceof Array){_.each(value,function(command){switch(command[0]){case 4:ids.push(command[1]);break;case 5:ids=[];break;case 6:ids=command[2];break;default:throw new Error(_.str.sprintf(_t("Unknown m2m command %s"),command[0]));}});}else{ids=value;}
new Model(column.relation).call('name_get',[ids,this.dataset.get_context()]).done(function(names){record.set(column.id+'__display',_(names).pluck(1).join(', '));record.set(column.id,ids);});record.set(column.id,false);}}
return column.format(record.toForm().data,{model:this.dataset.model,id:record.get('id')});},render:function(){var self=this;this.$current.html(QWeb.render('ListView.rows',_.extend({},this,{render_cell:function(){return self.render_cell.apply(self,arguments);}})));this.pad_table_to(4);},pad_table_to:function(count){if(this.records.length>=count||_(this.columns).any(function(column){return column.meta;})){return;}
var cells=[];if(this.options.selectable){cells.push('<th class="oe_list_record_selector"></td>');}
_(this.columns).each(function(column){if(column.invisible==='1'){return;}
cells.push('<td title="'+column.string+'">&nbsp;</td>');});if(this.options.deletable){cells.push('<td class="oe_list_record_delete"></td>');}
cells.unshift('<tr>');cells.push('</tr>');var row=cells.join('');this.$current.children('tr:not([data-id])').remove().end().append(new Array(count-this.records.length+1).join(row));},get_selection:function(){var result={ids:[],records:[]};if(!this.options.selectable){return result;}
var records=this.records;this.$current.find('th.oe_list_record_selector input:checked').closest('tr').each(function(){var record=records.get($(this).data('id'));result.ids.push(record.get('id'));result.records.push(record.attributes);});return result;},row_id:function(row){return $(row).data('id');},on_records_reset:function(){_(this.record_callbacks).each(function(callback,event){this.records.unbind(event,callback);},this);if(!this.$current){return;}
this.$current.remove();},get_records:function(){return this.records.map(function(record){return{count:1,values:record.attributes};});},reload_record:function(record){return this.view.reload_record(record);},render_record:function(record){var self=this;var index=this.records.indexOf(record);return QWeb.render('ListView.row',{columns:this.columns,options:this.options,record:record,row_parity:(index%2===0)?'even':'odd',view:this.view,render_cell:function(){return self.render_cell.apply(self,arguments);}});}});ListView.Groups=Class.extend({passthrough_events:'action deleted row_link',init:function(view,options){options=options||{};this.view=view;this.records=options.records||view.records;this.options=options.options||view.options;this.columns=options.columns||view.columns;this.datagroup=null;this.$row=null;this.children={};this.page=0;var self=this;this.records.bind('reset',function(){return self.on_records_reset();});},make_fragment:function(){return document.createDocumentFragment();},point_insertion:function(row){var $row=$(row);var red_letter_tboday=$row.closest('tbody')[0];var $next_siblings=$row.nextAll();if($next_siblings.length){var $root_kanal=$('<tbody>').insertAfter(red_letter_tboday);$root_kanal.append($next_siblings);this.elements.splice(_.indexOf(this.elements,red_letter_tboday),0,$root_kanal[0]);}
return red_letter_tboday;},make_paginator:function(){var self=this;var $prev=$('<button type="button" data-pager-action="previous">&lt;</button>').click(function(e){e.stopPropagation();if(self.page>0){self.page-=1;}else{self.page=self.max_page_index;}
self.$row.closest('tbody').next().replaceWith(self.render());});var $next=$('<button type="button" data-pager-action="next">&gt;</button>').click(function(e){e.stopPropagation();if(self.page<self.max_page_index){self.page+=1;}else{self.page=0;}
self.$row.closest('tbody').next().replaceWith(self.render());});this.$row.children().last().addClass('oe_list_group_pagination').append($prev).append('<span class="oe_list_pager_state"></span>').append($next);},open:function(point_insertion){this.render().insertAfter(point_insertion);var no_subgroups=_(this.datagroup.group_by).isEmpty(),records_terminated=!this.datagroup.context['group_by_no_leaf'];if(no_subgroups&&records_terminated){this.make_paginator();}},close:function(){this.$row.children().last().find('button').remove();this.$row.children().last().find('span').remove();this.records.reset();},indent:function($node,level){return $('<span>').css({'float':'left','white-space':'pre'}).text(new Array(level).join('   ')).prependTo($node);},render_groups:function(datagroups){var self=this;var placeholder=this.make_fragment();_(datagroups).each(function(group){if(self.children[group.value]){self.records.proxy(group.value).reset();delete self.children[group.value];}
var child=self.children[group.value]=new(self.view.options.GroupsType)(self.view,{records:self.records.proxy(group.value),options:self.options,columns:self.columns});self.bind_child_events(child);child.datagroup=group;var $row=child.$row=$('<tr class="oe_group_header">');if(group.openable&&group.length){$row.click(function(e){if(!$row.data('open')){$row.data('open',true).find('span.ui-icon').removeClass('ui-icon-triangle-1-e').addClass('ui-icon-triangle-1-s');child.open(self.point_insertion(e.currentTarget));}else{$row.removeData('open').find('span.ui-icon').removeClass('ui-icon-triangle-1-s').addClass('ui-icon-triangle-1-e');child.close();var selection=self.get_selection();$(self).trigger('selected',[selection.ids,this.records]);}});}
placeholder.appendChild($row[0]);var $group_column=$('<th class="oe_list_group_name">').appendTo($row);if(group.grouped_on){var row_data={};row_data[group.grouped_on]=group;var group_label=_t("Undefined");var group_column=_(self.columns).detect(function(column){return column.id===group.grouped_on;});if(group_column){try{group_label=group_column.format(row_data,{value_if_empty:_t("Undefined"),process_modifiers:false});}catch(e){group_label=_.str.escapeHTML(row_data[group_column.id].value);}}else{group_label=group.value;if(group_label instanceof Array){group_label=group_label[1];}
if(group_label===false){group_label=_t('Undefined');}
group_label=_.str.escapeHTML(group_label);}
$group_column.html(_.str.sprintf(_t("%s (%d)"),group_label,group.length));if(group.length&&group.openable){$group_column.prepend('<span class="ui-icon ui-icon-triangle-1-e" style="float: left;">');}else{$group_column.prepend('<span class="ui-icon" style="float: left; background-position: 150px 150px">');}}
self.indent($group_column,group.level);if(self.options.selectable){$row.append('<td>');}
_(self.columns).chain().filter(function(column){return column.invisible!=='1';}).each(function(column){if(column.meta){}else if(column.id in group.aggregates){var r={};r[column.id]={value:group.aggregates[column.id]};$('<td class="oe_number">').html(column.format(r,{process_modifiers:false})).appendTo($row);}else{$row.append('<td>');}});if(self.options.deletable){$row.append('<td class="oe_list_group_pagination">');}});return placeholder;},bind_child_events:function(child){var $this=$(this),self=this;$(child).bind('selected',function(e,_0,_1,deselected){var selection=self.get_selection();$this.trigger(e,[selection.ids,selection.records,deselected]);}).bind(this.passthrough_events,function(e){var args=Array.prototype.slice.call(arguments,1);$this.trigger.call($this,e,args);});},render_dataset:function(dataset){var self=this,list=new(this.view.options.ListType)(this,{options:this.options,columns:this.columns,dataset:dataset,records:this.records});this.bind_child_events(list);var view=this.view,limit=view._limit,page=this.datagroup.openable?this.page:view.page;var fields=_.pluck(_.select(this.columns,function(x){return x.tag=="field";}),'name');var options={offset:page*limit,limit:limit,context:{bin_size:true}};return $.async_when().then(function(){return dataset.read_slice(fields,options).then(function(records){if(self.records.length){self.records.reset(null,{silent:true});}
if(!self.datagroup.openable){view.configure_pager(dataset);}else{if(dataset.size()==records.length){self.$row.find('td.oe_list_group_pagination').find('button').remove();self.$row.find('td.oe_list_group_pagination').find('span').remove();}else{self.max_page_index=Math.ceil(dataset.size()/limit)-1;self.$row.find('.oe_list_pager_state').text(_.str.sprintf(_t("%(page)d/%(page_count)d"),{page:page+1,page_count:self.max_page_index+1})).end().find('button[data-pager-action=previous]').toggleClass('disabled',page===0).end().find('button[data-pager-action=next]').toggleClass('disabled',page===self.max_page_index);}}
self.records.add(records,{silent:true});list.render();if(_.isEmpty(records)){view.no_result();}
return list;});});},setup_resequence_rows:function(list,dataset){if((dataset.sort&&dataset.sort()&&dataset.sort()!=='sequence'&&dataset.sort()!=='sequence ASC')||!_(this.columns).any(function(column){return column.widget==='handle'||column.name==='sequence';})){return;}
var sequence_field=_(this.columns).find(function(c){return c.widget==='handle';});var seqname=sequence_field?sequence_field.name:'sequence';list.$current.sortable({axis:'y',items:'> tr[data-id]',helper:'clone'});if(sequence_field){list.$current.sortable('option','handle','.oe_list_field_handle');}
list.$current.sortable('option',{start:function(e,ui){ui.placeholder.height(ui.item.height());},stop:function(event,ui){var to_move=list.records.get(ui.item.data('id')),target_id=ui.item.prev().data('id'),from_index=list.records.indexOf(to_move),target=list.records.get(target_id);if(list.records.at(from_index-1)==target){return;}
list.records.remove(to_move,{silent:true});var to=target_id?list.records.indexOf(target)+1:0;list.records.add(to_move,{at:to,silent:true});var record,index=to,seq=to?list.records.at(to-1).get(seqname):0;var defs=[];var fct=function(dataset,id,seq){defs.push($.async_when().then(function(){var attrs={};attrs[seqname]=seq;return dataset.write(id,attrs,{internal_dataset_changed:true});}));};while(++seq,(record=list.records.at(index++))){fct(dataset,record.get('id'),seq);record.set(seqname,seq);}
$.when.apply($,defs).then(function(){dataset.trigger("dataset_changed");});}});},render:function(post_render){var self=this;var $el=$('<tbody>');this.elements=[$el[0]];this.datagroup.list(_(this.view.visible_columns).chain().filter(function(column){return column.tag==='field';}).pluck('name').value(),function(groups){$el[0].appendChild(self.render_groups(groups));if(post_render){post_render();}},function(dataset){self.render_dataset(dataset).then(function(list){self.children[null]=list;self.elements=[list.$current.replaceAll($el)[0]];self.setup_resequence_rows(list,dataset);}).always(function(){if(post_render){post_render();}
self.view.trigger('view_list_rendered');self.view.$el.updatePolyfill();});});return $el;},get_selection:function(){var ids=[],records=[];_(this.children).each(function(child){var selection=child.get_selection();ids.push.apply(ids,selection.ids);records.push.apply(records,selection.records);});return{ids:ids,records:records};},on_records_reset:function(){this.children={};$(this.elements).remove();},get_records:function(){if(_(this.children).isEmpty()){if(!this.datagroup.length){return;}
return{count:this.datagroup.length,values:this.datagroup.aggregates};}
return _(this.children).chain().map(function(child){return child.get_records();}).flatten().value();}});function synchronized(fn){var fn_mutex=new utils.Mutex();return function(){var obj=this;var args=_.toArray(arguments);return fn_mutex.exec(function(){if(obj.isDestroyed()){return $.when();}
return fn.apply(obj,args);});};}
var DataGroup=Class.extend({init:function(parent,model,domain,context,group_by,level){this.model=new Model(model,context,domain);this.group_by=group_by;this.context=context;this.domain=domain;this.level=level||0;},list:function(fields,ifGroups,ifRecords){var self=this;if(!_.isEmpty(this.group_by)){fields=_.unique((fields||[]).concat(this.group_by));}
var query=this.model.query(fields).order_by(this.sort).group_by(this.group_by);$.when(query).done(function(querygroups){if(!querygroups){var ds=new data.DataSetSearch(self,self.model.name,self.model.context(),self.model.domain());ds._sort=self.sort;ifRecords(ds);return;}
var child_datagroups=_(querygroups).map(function(group){var child_context=_.extend({},self.model.context(),group.model.context());var child_dg=new DataGroup(self,self.model.name,group.model.domain(),child_context,group.model._context.group_by,self.level+1);child_dg.sort=self.sort;child_dg.__context=child_context;child_dg.__domain=group.model.domain();child_dg.folded=group.get('folded');child_dg.grouped_on=group.get('grouped_on');child_dg.length=group.get('length');child_dg.value=group.get('value');child_dg.openable=group.get('has_children');child_dg.aggregates=group.get('aggregates');return child_dg;});ifGroups(child_datagroups);});}});var StaticDataGroup=DataGroup.extend({init:function(dataset){this.dataset=dataset;},list:function(fields,ifGroups,ifRecords){ifRecords(this.dataset);}});var Column=Class.extend({init:function(id,tag,attrs){_.extend(attrs,{id:id,tag:tag});this.modifiers=attrs.modifiers?JSON.parse(attrs.modifiers):{};delete attrs.modifiers;_.extend(this,attrs);if(this.modifiers['tree_invisible']){this.invisible='1';}else{delete this.invisible;}},modifiers_for:function(fields){var out={};var domain_computer=data.compute_domain;for(var attr in this.modifiers){if(!this.modifiers.hasOwnProperty(attr)){continue;}
var modifier=this.modifiers[attr];out[attr]=_.isBoolean(modifier)?modifier:domain_computer(modifier,fields);}
return out;},to_aggregate:function(){if(this.type!=='integer'&&this.type!=='float'&&this.type!=='monetary'&&this.type!=='text'){return{};}
var aggregation_func=this['group_operator']||'sum';if(!(aggregation_func in this)){return{};}
var C=function(fn,label){this['function']=fn;this.label=label;};C.prototype=this;return new C(aggregation_func,this[aggregation_func]);},format:function(row_data,options){options=options||{};var attrs={};if(options.process_modifiers!==false){attrs=this.modifiers_for(row_data);}
if(attrs.invisible){return'';}
if(!row_data[this.id]){return options.value_if_empty===undefined?'':options.value_if_empty;}
return this._format(row_data,options);},_format:function(row_data,options){return _.escape(formats.format_value(row_data[this.id].value,this,options.value_if_empty));}});var MetaColumn=Column.extend({meta:true,init:function(id,string){this._super(id,'',{string:string});}});ListView.MetaColumn=MetaColumn;var ColumnButton=Column.extend({format:function(row_data,options){options=options||{};var attrs={};if(options.process_modifiers!==false){attrs=this.modifiers_for(row_data);}
if(attrs.invisible){return'';}
var template=this.icon&&'ListView.row.button'||'ListView.row.text_button';return QWeb.render(template,{widget:this,prefix:session.prefix,disabled:attrs.readonly||isNaN(row_data.id.value)||data.BufferedDataSet.virtual_id_regex.test(row_data.id.value)});}});var ColumnBoolean=Column.extend({_format:function(row_data,options){return _.str.sprintf('<input type="checkbox" %s readonly="readonly"/>',row_data[this.id].value?'checked="checked"':'');}});var ColumnBinary=Column.extend({_format:function(row_data,options){var text=_t("Download"),filename=_t('Binary file');var value=row_data[this.id].value;if(!value){return options.value_if_empty||'';}
var download_url;if(value.substr(0,10).indexOf(' ')==-1){download_url="data:application/octet-stream;base64,"+value;}else{download_url=session.url('/web/content',{model:options.model,field:this.id,id:options.id,download:true});if(this.filename){download_url+='&filename_field='+this.filename;}}
if(this.filename&&row_data[this.filename]){text=_.str.sprintf(_t("Download \"%s\""),formats.format_value(row_data[this.filename].value,{type:'char'}));filename=row_data[this.filename].value;}
return _.template('<a download="<%-download%>" href="<%-href%>"><%-text%></a> (<%-size%>)')({text:text,href:download_url,size:utils.binary_to_binsize(value),download:filename,});}});var ColumnChar=Column.extend({replacement:'*',_format:function(row_data,options){var value=row_data[this.id].value;if(value&&this.password==='True'){return value.replace(/[\s\S]/g,_.escape(this.replacement));}
return this._super(row_data,options);}});var ColumnProgressBar=Column.extend({_format:function(row_data,options){return _.template('<progress value="<%-value%>" max="100"><%-value%>%</progress>')({value:_.str.sprintf("%.0f",row_data[this.id].value||0)});}});var ColumnHandle=Column.extend({init:function(){this._super.apply(this,arguments);this.modifiers.readonly=true;},_format:function(row_data,options){return'<i class="oe_list_handle fa fa-circle"/>';}});var ColumnMany2OneButton=Column.extend({_format:function(row_data,options){this.has_value=!!row_data[this.id].value;this.icon=this.has_value?'gtk-yes':'gtk-no';this.string=this.has_value?_t('View'):_t('Create');return QWeb.render('Many2OneButton.cell',{'widget':this,'prefix':session.prefix,});},});var ColumnMany2Many=Column.extend({_format:function(row_data,options){if(!_.isEmpty(row_data[this.id].value)){row_data[this.id]=row_data[this.id+'__display'];}
return this._super(row_data,options);}});var ColumnReference=Column.extend({_format:function(row_data,options){if(!_.isEmpty(row_data[this.id].value)){if(!!row_data[this.id+'__display']){row_data[this.id]=row_data[this.id+'__display'];}else{row_data[this.id]={'value':''};}}
return this._super(row_data,options);}});var ColumnUrl=Column.extend({PROTOCOL_REGEX:/^(?!\w+:?\/\/)/,_format:function(row_data,options){var value=row_data[this.id].value;if(value){return _.template("<a href='<%-href%>' target='_blank'><%-text%></a>")({href:value.trim().replace(this.PROTOCOL_REGEX,'//'),text:value});}
return this._super(row_data,options);}});var ColumnMonetary=Column.extend({_format:function(row_data,options){var currency_field=(this.options&&this.options.currency_field)||this.currency_field||'currency_id';var currency_id=row_data[currency_field]&&row_data[currency_field].value[0];var currency=session.get_currency(currency_id);var digits_precision=this.digits||(currency&&currency.digits);var value=formats.format_value(row_data[this.id].value||0,{type:this.type,digits:digits_precision},options.value_if_empty);if(currency){if(currency.position==="after"){value+='&nbsp;'+currency.symbol;}else{value=currency.symbol+'&nbsp;'+value;}}
return value;},});var ColumnToggleButton=Column.extend({format:function(row_data,options){this._super(row_data,options);var button_tips=JSON.parse(this.options);var fieldname=this.field_name;var has_value=row_data[fieldname]&&!!row_data[fieldname].value;this.icon=has_value?'gtk-yes':'gtk-normal';this.string=has_value?_t(button_tips?button_tips['active']:''):_t(button_tips?button_tips['inactive']:'');return QWeb.render('toggle_button',{widget:this,prefix:session.prefix,});},});list_widget_registry.add('field',Column).add('field.boolean',ColumnBoolean).add('field.binary',ColumnBinary).add('field.char',ColumnChar).add('field.progressbar',ColumnProgressBar).add('field.handle',ColumnHandle).add('button',ColumnButton).add('field.many2onebutton',ColumnMany2OneButton).add('field.reference',ColumnReference).add('field.many2many',ColumnMany2Many).add('field.url',ColumnUrl).add('button.toggle_button',ColumnToggleButton).add('field.monetary',ColumnMonetary);function for_(id,field,node){var description=_.extend({tag:node.tag},field,node.attrs);var tag=description.tag;var Type=list_widget_registry.get_any([tag+'.'+description.widget,tag+'.'+description.type,tag]);return new Type(id,node.tag,description);}
return ListView;});;

/* /web/static/src/js/views/form_view.js defined in bundle 'web.assets_backend' */
odoo.define('web.FormView',function(require){"use strict";var core=require('web.core');var crash_manager=require('web.crash_manager');var data=require('web.data');var Dialog=require('web.Dialog');var common=require('web.form_common');var Model=require('web.DataModel');var Sidebar=require('web.Sidebar');var utils=require('web.utils');var View=require('web.View');var _t=core._t;var _lt=core._lt;var QWeb=core.qweb;var Class=core.Class;var FormView=View.extend(common.FieldManagerMixin,{searchable:false,template:"FormView",display_name:_lt('Form'),view_type:"form",multi_record:false,accesskey:"F",icon:'fa-edit',init:function(parent,dataset,view_id,options){var self=this;this._super(parent);this.previous_wkf_id=-1;this.previous_model="";this.ViewManager=parent;this.set_default_options(options);this.dataset=dataset;this.model=dataset.model;this.view_id=view_id||false;this.fields_view={};this.fields={};this.fields_order=[];this.datarecord={};this._onchange_specs={};this.onchanges_mutex=new utils.Mutex();this.default_focus_field=null;this.default_focus_button=null;this.fields_registry=core.form_widget_registry;this.tags_registry=core.form_tag_registry;this.widgets_registry=core.form_custom_registry;this.has_been_loaded=$.Deferred();this.translatable_fields=[];_.defaults(this.options,{"not_interactible_on_create":false,"initial_mode":"view","disable_autofocus":false,"footer_to_buttons":false,});this.is_initialized=$.Deferred();this.mutating_mutex=new utils.Mutex();this.save_list=[];this.render_value_defs=[];this.reload_mutex=new utils.Mutex();this.__blur_timeout=null;this.rendering_engine=new FormRenderingEngine(this);self.set({actual_mode:self.options.initial_mode});this.has_been_loaded.done(function(){self._build_onchange_specs();self.check_actual_mode();self.on("change:actual_mode",self,self.check_actual_mode);self.on("change:actual_mode",self,self.toggle_buttons);self.on("change:actual_mode",self,self.toggle_sidebar);self.on("change:actual_mode",self,self.do_update_pager);});self.on("load_record",self,self.load_record);core.bus.on('clear_uncommitted_changes',this,function(chain_callbacks){var self=this;chain_callbacks(function(){var def=$.Deferred();self.can_be_discarded().then(function(){def.resolve();}).fail(function(){def.reject();});return def;});});},view_loading:function(r){return this.load_form(r);},destroy:function(){_.each(this.get_widgets(),function(w){w.off('focused blurred');w.destroy();});if(this.$el){this.$el.off('.formBlur');}
this._super();},load_form:function(data){var self=this;if(!data){throw new Error(_t("No data provided."));}
if(this.arch){throw"Form view does not support multiple calls to load_form";}
this.fields_order=[];this.fields_view=data;this.rendering_engine.set_fields_registry(this.fields_registry);this.rendering_engine.set_tags_registry(this.tags_registry);this.rendering_engine.set_widgets_registry(this.widgets_registry);this.rendering_engine.set_fields_view(data);var $dest=this.$el.hasClass("oe_form_container")?this.$el:this.$el.find('.oe_form_container');this.rendering_engine.render_to($dest);this.has_been_loaded.resolve();this.$el.find(".oe_form_group_row,.oe_form_field,label,h1,.oe_title,.oe_notebook_page, .oe_list_content").on('click',function(e){if(self.get("actual_mode")=="view"&&self.$buttons&&!$(e.target).is('[data-toggle]')){var $button=self.$buttons.find(".oe_form_button_edit");$button.openerpBounce();e.stopPropagation();core.bus.trigger('click',e);}});this.$el.find(".oe_form_field_status:not(.oe_form_status_clickable)").on('click',function(e){if((self.get("actual_mode")=="view")){var $button=self.$el.find(".oe_highlight:not(.o_form_invisible)").css({'float':'left','clear':'none'});$button.openerpBounce();e.stopPropagation();}});this.trigger('form_view_loaded',data);return $.when();},render_buttons:function($node){this.$buttons=$(QWeb.render("FormView.buttons",{'widget':this}));this.toggle_buttons();this.$buttons.on('click','.oe_form_button_create',this.guard_active(this.on_button_create));this.$buttons.on('click','.oe_form_button_edit',this.guard_active(this.on_button_edit));this.$buttons.on('click','.oe_form_button_save',this.guard_active(this.on_button_save));this.$buttons.on('click','.oe_form_button_cancel',this.guard_active(this.on_button_cancel));this.$buttons.on('click','.oe_form_button_openprod_delete',this.guard_active(this.on_button_delete));this.$buttons.on('click','.oe_form_button_openprod_duplicate',this.guard_active(this.on_button_duplicate));if(this.options.footer_to_buttons){this.$el.find('footer').appendTo(this.$buttons);}
$node=$node||this.options.$buttons;if($node){this.$buttons.appendTo($node);}else{this.$('.oe_form_buttons').replaceWith(this.$buttons);}},render_sidebar:function($node){if(!this.sidebar&&this.options.sidebar){this.sidebar=new Sidebar(this,{editable:this.is_action_enabled('edit')});if(this.fields_view.toolbar){this.sidebar.add_toolbar(this.fields_view.toolbar);}
$node=$node||this.$('.oe_form_sidebar');this.sidebar.appendTo($node);this.toggle_sidebar();}},render_pager:function($node){if(this.options.pager){var self=this;if(this.$pager){this.$pager.remove();}
if(this.get("actual_mode")==="create"){return;}
this.$pager=$(QWeb.render("FormView.pager",{'widget':self}));this.$pager.on('click','a[data-pager-action]',function(){var $el=$(this);if($el.attr("disabled")){return;}
var action=$el.data('pager-action');var def=$.when(self.execute_pager_action(action));$el.attr("disabled");def.always(function(){$el.removeAttr("disabled");});});this.do_update_pager();$node=$node||this.options.$pager;if($node){this.$pager.appendTo($node);}else{this.$('.oe_form_pager').replaceWith(this.$pager);}}},toggle_buttons:function(){var view_mode=this.get("actual_mode")==="view";if(this.$buttons){this.$buttons.find('.o_form_buttons_view').toggle(view_mode);this.$buttons.find('.o_form_buttons_edit').toggle(!view_mode);}},toggle_sidebar:function(){if(this.sidebar){this.sidebar.do_toggle(this.get("actual_mode")==="view");}},widgetFocused:function(){if(this.__blur_timeout){clearTimeout(this.__blur_timeout);this.__blur_timeout=null;}},do_load_state:function(state,warm){if(state.id&&this.datarecord.id!=state.id){if(this.dataset.get_id_index(state.id)===null){this.dataset.ids.push(state.id);}
this.dataset.select_id(state.id);this.do_show();}},do_show:function(options){var self=this;options=options||{};this._super();this.$el.css({opacity:'0',filter:'alpha(opacity = 0)'});this.$el.removeClass('oe_form_dirty');var shown=this.has_been_loaded;if(options.reload!==false){shown=shown.then(function(){if(self.dataset.index===null){return self.on_button_new();}
var fields=_.keys(self.fields_view.fields);fields.push('display_name');fields.push('__last_update');return self.dataset.read_index(fields,{context:{'bin_size':true}}).then(function(r){self.trigger('load_record',r);});});}
return $.when(shown,this._super()).then(function(){self._actualize_mode(options.mode||self.options.initial_mode);self.$el.css({opacity:'1',filter:'alpha(opacity = 100)'});core.bus.trigger('form_view_shown',self);});},load_record:function(record){if(record.wkf_id){if(record.wkf_id[0]!==this.previous_wkf_id&&this.model===this.previous_model){window.location.reload();}
this.previous_model=this.model;this.previous_wkf_id=record.wkf_id[0];}
var self=this,set_values=[];if(!record){this.set({'title':undefined});this.do_warn(_t("Form"),_t("The record could not be found in the database."),true);return $.Deferred().reject();}
this.datarecord=record;this._actualize_mode();this.set({'title':record.id?record.display_name:_t("New")});_(this.fields).each(function(field,f){field._dirty_flag=false;field._inhibit_on_change_flag=true;var result=field.set_value(self.datarecord[f]||self.datarecord[f]===0?self.datarecord[f]:false);field._inhibit_on_change_flag=false;set_values.push(result);});return $.when.apply(null,set_values).then(function(){if(!record.id){self.do_onchange(null);}
self.on_form_changed();self.rendering_engine.init_fields();self.is_initialized.resolve();self.do_update_pager(record.id===null||record.id===undefined);if(self.sidebar){self.sidebar.do_attachement_update(self.dataset,self.datarecord.id);}
if(record.id){self.do_push_state({id:record.id});}else{self.do_push_state({});}
self.$el.removeClass('oe_form_dirty');$('.home_selected').removeClass('home_selected').hide();if(self.model=='res.users'&&self.$el.find('.button_change_password')[0]){console.log(self.get_fields_values().can_change_password);if(self.get_fields_values().can_change_password===false){self.$el.find('.button_change_password')[0].style.display='none';}
else{console.log(self.$el.find('.button_change_password')[0]);self.$el.find('.button_change_password')[0].style.display='';}}
$('.oe_application').show();self.autofocus();});},load_defaults:function(){var self=this;var keys=_.keys(this.fields_view.fields);if(keys.length){return this.dataset.default_get(keys).then(function(r){self.trigger('load_record',_.clone(r));});}
return self.trigger('load_record',{});},on_form_changed:function(){this.trigger("view_content_has_changed");},do_notify_change:function(){this.$el.addClass('oe_form_dirty');},execute_pager_action:function(action){var self=this;return this.can_be_discarded().then(function(){switch(action){case'first':self.dataset.index=0;break;case'previous':self.dataset.previous();break;case'next':self.dataset.next();break;case'last':self.dataset.index=self.dataset.ids.length-1;break;}
self.trigger('pager_action_executed');return self.reload();});},do_update_pager:function(hide_index){if(this.$pager){var pager_visible=(this.get("actual_mode")!=="create")&&(this.dataset.ids.length>1);this.$pager.toggle(pager_visible);if(hide_index===true){this.$pager.find(".oe_form_pager_state").html("");}else{this.$pager.find(".oe_form_pager_state").html(_.str.sprintf(_t("%d / %d"),this.dataset.index+1,this.dataset.ids.length));}}},_build_onchange_specs:function(){var self=this;var find=function(field_name,root){var fields=[root];while(fields.length){var node=fields.pop();if(!node){continue;}
if(node.tag==='field'&&node.attrs.name===field_name){return node.attrs.on_change||"";}
fields=_.union(fields,node.children);}
return"";};self._onchange_fields=[];self._onchange_specs={};_.each(this.fields,function(field,name){self._onchange_fields.push(name);self._onchange_specs[name]=find(name,field.node);_.each(field.field.views,function(view){_.each(view.fields,function(_,subname){self._onchange_specs[name+'.'+subname]=find(subname,view.arch);});});});},_get_onchange_values:function(){var field_values=this.get_fields_values();if(field_values.id.toString().match(data.BufferedDataSet.virtual_id_regex)){delete field_values.id;}
if(this.dataset.parent_view){var parent_view=this.dataset.parent_view;var child_name=this.dataset.child_name;var parent_name=parent_view.get_field_desc(child_name).relation_field;if(parent_name){var parent_values=parent_view.get_fields_values();delete parent_values[child_name];field_values[parent_name]=parent_values;}}
return field_values;},do_onchange:function(widget){var self=this;var onchange_specs=self._onchange_specs;try{var def=$.when({});var change_spec=widget?onchange_specs[widget.name]:null;if(!widget||(!_.isEmpty(change_spec)&&change_spec!=="0")){var ids=[],trigger_field_name=widget?widget.name:self._onchange_fields,values=self._get_onchange_values(),context=new data.CompoundContext(self.dataset.get_context());if(widget&&widget.build_context()){context.add(widget.build_context());}
if(self.dataset.parent_view){var parent_name=self.dataset.parent_view.get_field_desc(self.dataset.child_name).relation_field;context.add({field_parent:parent_name});}
if(self.datarecord.id&&!data.BufferedDataSet.virtual_id_regex.test(self.datarecord.id)){ids.push(self.datarecord.id);}
def=self.alive(new Model(self.dataset.model).call("onchange",[ids,values,trigger_field_name,onchange_specs,context]));}
this.onchanges_mutex.exec(function(){return def.then(function(response){var fields={};if(widget){fields[widget.name]=widget.field;}
else{fields=self.fields_view.fields;}
var defs=[];_.each(fields,function(field,fieldname){if(field&&field.change_default){var value_;if(response.value&&(fieldname in response.value)){value_=response.value[fieldname];}else{value_=self.fields[fieldname].get_value();}
var condition=fieldname+'='+value_;if(value_){defs.push(self.alive(new Model('ir.values').call('get_defaults',[self.model,condition])).then(function(results){if(!results.length){return response;}
if(!response.value){response.value={};}
for(var i=0;i<results.length;++i){var triplet=results[i];response.value[triplet[1]]=triplet[2];}
return response;}));}}});return _.isEmpty(defs)?response:$.when.apply(null,defs);}).then(function(response){return self.on_processed_onchange(response);});});return this.onchanges_mutex.def;}catch(e){console.error(e);crash_manager.show_message(e);return $.Deferred().reject();}},on_processed_onchange:function(result){try{var fields=this.fields;_(result.domain).each(function(domain,fieldname){var field=fields[fieldname];if(!field){return;}
field.node.attrs.domain=domain;});if(!_.isEmpty(result.value)){this._internal_set_values(result.value);}
if(!_.isEmpty(result.warning)){this.warning_displayed=true;var dialog=new Dialog(this,{size:'medium',title:result.warning.title,$content:QWeb.render("CrashManager.warning",result.warning)});dialog.open();dialog.on('closed',this,function(){this.warning_displayed=false;});}
return $.Deferred().resolve();}catch(e){console.error(e);crash_manager.show_message(e);return $.Deferred().reject();}},_process_operations:function(){var self=this;return this.mutating_mutex.exec(function(){function iterate(){var mutex=new utils.Mutex();_.each(self.fields,function(field){self.onchanges_mutex.def.then(function(){mutex.exec(function(){return field.commit_value();});});});return mutex.def.then(function(){return self.onchanges_mutex.def;}).then(function(){var save_obj=self.save_list.pop();if(save_obj){return self._process_save(save_obj).then(function(){save_obj.ret=_.toArray(arguments);return iterate();},function(){save_obj.error=true;});}
return $.when();}).fail(function(){self.save_list.pop();return $.when();});}
return iterate();});},_internal_set_values:function(values){for(var f in values){if(!values.hasOwnProperty(f)){continue;}
var field=this.fields[f];if(field){var value_=values[f];if(field.get_value()!==value_){field._inhibit_on_change_flag=true;field.set_value(value_);field._inhibit_on_change_flag=false;field._dirty_flag=true;}}}
this.on_form_changed();},set_values:function(values){var self=this;return this.mutating_mutex.exec(function(){self._internal_set_values(values);});},to_view_mode:function(){this._actualize_mode("view");},to_edit_mode:function(){this.onchanges_mutex=new utils.Mutex();this._actualize_mode("edit");},_actualize_mode:function(switch_to){var mode=switch_to||this.get("actual_mode");if(!this.datarecord.id){mode="create";}else if(mode==="create"){mode="edit";}
this.render_value_defs=[];this.set({actual_mode:mode});},check_actual_mode:function(source,options){if(this.get("actual_mode")==="view"){this.$el.removeClass('oe_form_editable').addClass('oe_form_readonly');}else{this.$el.removeClass('oe_form_readonly').addClass('oe_form_editable');_.defer(_.bind(this.autofocus,this));}},autofocus:function(){if(this.get("actual_mode")!=="view"&&!this.options.disable_autofocus){var fields_order=this.fields_order.slice(0);if(this.default_focus_field){fields_order.unshift(this.default_focus_field.name);}
for(var i=0;i<fields_order.length;i+=1){var field=this.fields[fields_order[i]];if(!field.get('effective_invisible')&&!field.get('effective_readonly')&&field.$label){if(field.focus()!==false){break;}}}}},on_button_save:function(e){var self=this;$(e.target).attr("disabled",true);return this.save().done(function(result){self.trigger("save",result);self.reload().then(function(){self.to_view_mode();core.bus.trigger('do_reload_needaction');core.bus.trigger('form_view_saved',self);});}).always(function(){$(e.target).attr("disabled",false);});},on_button_cancel:function(event){var self=this;this.can_be_discarded().then(function(){if(self.get('actual_mode')==='create'){self.trigger('history_back');}else{self.to_view_mode();$.when.apply(null,self.render_value_defs).then(function(){self.trigger('load_record',self.datarecord);});}});this.trigger('on_button_cancel');return false;},on_button_new:function(){var self=this;this.to_edit_mode();return $.when(this.has_been_loaded).then(function(){return self.can_be_discarded().then(function(){return self.load_defaults();});});},on_button_edit:function(){return this.to_edit_mode();},on_button_create:function(){this.dataset.index=null;this.do_show();},on_button_duplicate:function(){var self=this;return this.has_been_loaded.then(function(){return self.dataset.call('copy',[self.datarecord.id,{},self.dataset.context]).then(function(new_id){self.record_created(new_id);self.to_edit_mode();});});},on_button_delete:function(){var self=this;var def=$.Deferred();this.has_been_loaded.done(function(){if(self.datarecord.id&&confirm(_t("Do you really want to delete this record?"))){self.dataset.unlink([self.datarecord.id]).done(function(){if(self.dataset.size()){self.execute_pager_action('next');}else{self.do_action('history_back');}
def.resolve();});}else{$.async_when().done(function(){def.reject();});}});return def.promise();},can_be_discarded:function(message){if(!this.$el.is('.oe_form_dirty')){return $.Deferred().resolve();}
message=message||_t("The record has been modified, your changes will be discarded. Are you sure you want to leave this page ?");var self=this;var def=$.Deferred();var options={title:_t("Warning"),confirm_callback:function(){self.$el.removeClass('oe_form_dirty');def.resolve();},cancel_callback:function(){def.reject();},};Dialog.confirm(this,message,options);return def;},save:function(prepend_on_create){var self=this;var save_obj={prepend_on_create:prepend_on_create,ret:null};this.save_list.push(save_obj);return self._process_operations().then(function(){if(save_obj.error)
return $.Deferred().reject();return $.when.apply($,save_obj.ret);}).done(function(result){self.$el.removeClass('oe_form_dirty');});},_process_save:function(save_obj){var self=this;var prepend_on_create=save_obj.prepend_on_create;var def_process_save=$.Deferred();try{var form_invalid=false,values={},first_invalid_field=null,readonly_values={},deferred=[];_.each(self.fields,function(f){var res=f.before_save();if(res){deferred.push(res);res.fail(function(){form_invalid=true;if(!first_invalid_field){first_invalid_field=f;}});}});$.when.apply($,deferred).always(function(){_.each(self.fields,function(f){if(!f.is_valid()){form_invalid=true;if(!first_invalid_field){first_invalid_field=f;}}else if(f.name!=='id'&&(!self.datarecord.id||f._dirty_flag)){if(!f.get("readonly")){values[f.name]=f.get_value(true);}else{readonly_values[f.name]=f.get_value(true);}}});if(!self.datarecord.id&&self.fields.sequence&&!_.has(values,'sequence')&&!_.isEmpty(self.dataset.cache)){var current=_[prepend_on_create?"min":"max"](_.map(self.dataset.cache,function(o){return o.values.sequence}));values['sequence']=prepend_on_create?current-1:current+1;}
if(form_invalid){self.set({'display_invalid_fields':true});first_invalid_field.focus();self.on_invalid();def_process_save.reject();}else{self.set({'display_invalid_fields':false});var save_deferral;if(!self.datarecord.id){save_deferral=self.dataset.create(values,{readonly_fields:readonly_values}).then(function(r){return self.record_created(r,prepend_on_create);},null);}else if(_.isEmpty(values)){save_deferral=$.Deferred().resolve({}).promise();}else{save_deferral=self.dataset.write(self.datarecord.id,values,{readonly_fields:readonly_values}).then(function(r){return self.record_saved(r);},null);}
save_deferral.then(function(result){def_process_save.resolve(result);}).fail(function(){def_process_save.reject();});}});}catch(e){console.error(e);return def_process_save.reject();}
return def_process_save;},on_invalid:function(){var warnings=_(this.fields).chain().filter(function(f){return!f.is_valid();}).map(function(f){return _.str.sprintf('<li>%s</li>',_.escape(f.string));}).value();warnings.unshift('<ul>');warnings.push('</ul>');this.do_warn(_t("The following fields are invalid:"),warnings.join(''));},record_saved:function(r){this.trigger('record_saved',r);if(!r){return $.Deferred().reject();}
return r;},record_created:function(r,prepend_on_create){var self=this;if(!r){this.trigger('record_created',r);return $.Deferred().reject();}else{this.datarecord.id=r;if(!prepend_on_create){this.dataset.alter_ids(this.dataset.ids.concat([this.datarecord.id]));this.dataset.index=this.dataset.ids.length-1;}else{this.dataset.alter_ids([this.datarecord.id].concat(this.dataset.ids));this.dataset.index=0;}
this.do_update_pager();if(this.sidebar){this.sidebar.do_attachement_update(this.dataset,this.datarecord.id);}
return $.when(this.reload()).then(function(){self.trigger('record_created',r);return _.extend(r,{created:true});});}},on_action:function(action){console.debug('Executing action',action);},reload:function(){var self=this;return this.reload_mutex.exec(function(){if(self.dataset.index===null||self.dataset.index===undefined){self.trigger("previous_view");return $.Deferred().reject().promise();}
if(self.dataset.index<0){return $.when(self.on_button_new());}else{var fields=_.keys(self.fields_view.fields);fields.push('display_name');fields.push('__last_update');return self.dataset.read_index(fields,{context:{'bin_size':true},check_access_rule:true}).then(function(r){self.trigger('load_record',r);}).fail(function(){self.do_action('history_back');});}});},get_widgets:function(){return _.filter(this.getChildren(),function(obj){return obj instanceof common.FormWidget;});},get_fields_values:function(){var values={};var ids=this.get_selected_ids();values["id"]=ids.length>0?ids[0]:false;_.each(this.fields,function(value_,key){values[key]=value_.get_value();});return values;},get_selected_ids:function(){var id=this.dataset.ids[this.dataset.index];return id?[id]:[];},recursive_save:function(){var self=this;return $.when(this.save()).then(function(res){if(self.dataset.parent_view)
return self.dataset.parent_view.recursive_save();});},recursive_reload:function(){var self=this;var pre=$.when();if(self.dataset.parent_view)
pre=self.dataset.parent_view.recursive_reload();return pre.then(function(){return self.reload();});},is_dirty:function(){return _.any(this.fields,function(value_){return value_._dirty_flag;});},is_interactible_record:function(){var id=this.datarecord.id;if(!id){if(this.options.not_interactible_on_create)
return false;}else if(typeof(id)==="string"){if(data.BufferedDataSet.virtual_id_regex.test(id))
return false;}
return true;},sidebar_eval_context:function(){return $.when(this.build_eval_context());},open_defaults_dialog:function(){var self=this;var display=function(field,value){var FieldSelection=core.form_widget_registry.get('selection');var FieldMany2One=core.form_widget_registry.get('many2one');if(!value){return value;}
if(field instanceof FieldSelection){return _(field.get('values')).find(function(option){return option[0]===value;})[1];}else if(field instanceof FieldMany2One){return field.get_displayed();}
return value;};var fields=_.chain(this.fields).map(function(field){var value=field.get_value();if(!value||field.get('invisible')||field.get("readonly")||field.field.type==='one2many'||field.field.type==='many2many'||field.field.type==='binary'||field.password){return false;}
return{name:field.name,string:field.string,value:value,displayed:display(field,value),};}).compact().sortBy(function(field){return field.string;}).value();var conditions=_.chain(self.fields).filter(function(field){return field.field.change_default;}).map(function(field){var value=field.get_value();return{name:field.name,string:field.string,value:value,displayed:display(field,value),};}).value();var d=new Dialog(this,{title:_t("Set Default"),buttons:[{text:_t("Close"),close:true},{text:_t("Save default"),click:function(){var $defaults=d.$el.find('#formview_default_fields');var field_to_set=$defaults.val();if(!field_to_set){$defaults.parent().addClass('oe_form_invalid');return;}
var condition=d.$el.find('#formview_default_conditions').val(),all_users=d.$el.find('#formview_default_all').is(':checked');new data.DataSet(self,'ir.values').call('set_default',[self.dataset.model,field_to_set,self.fields[field_to_set].get_value(),all_users,true,condition||false]).done(function(){d.close();});}}]});d.args={fields:fields,conditions:conditions};d.template='FormView.set_default';d.open();},register_field:function(field,name){this.fields[name]=field;this.fields_order.push(name);if(JSON.parse(field.node.attrs.default_focus||"0")){this.default_focus_field=field;}
field.on('focused',null,this.proxy('widgetFocused'));if(this.get_field_desc(name).translate){this.translatable_fields.push(field);}
field.on('changed_value',this,function(){if(field.is_syntax_valid()){this.trigger('field_changed:'+name);}
if(field._inhibit_on_change_flag){return;}
field._dirty_flag=true;if(field.is_syntax_valid()){this.do_onchange(field);this.on_form_changed(true);this.do_notify_change();}});},get_field_desc:function(field_name){return this.fields_view.fields[field_name];},get_field_value:function(field_name){return this.fields[field_name].get_value();},compute_domain:function(expression){return data.compute_domain(expression,this.fields);},_build_view_fields_values:function(){var a_dataset=this.dataset;var fields_values=this.get_fields_values();var active_id=a_dataset.ids[a_dataset.index];_.extend(fields_values,{active_id:active_id||false,active_ids:active_id?[active_id]:[],active_model:a_dataset.model,parent:{}});if(a_dataset.parent_view){fields_values.parent=a_dataset.parent_view.get_fields_values();}
return fields_values;},build_eval_context:function(){var a_dataset=this.dataset;return new data.CompoundContext(a_dataset.get_context(),this._build_view_fields_values());},});var FormRenderingEngineInterface=Class.extend({set_fields_view:function(fields_view){},set_fields_registry:function(fields_registry){},render_to:function($el){},});var FormRenderingEngine=FormRenderingEngineInterface.extend({init:function(view){this.view=view;},set_fields_view:function(fvg){this.fvg=fvg;this.version=parseFloat(this.fvg.arch.attrs.version);if(isNaN(this.version)){this.version=7.0;}},set_tags_registry:function(tags_registry){this.tags_registry=tags_registry;},set_fields_registry:function(fields_registry){this.fields_registry=fields_registry;},set_widgets_registry:function(widgets_registry){this.widgets_registry=widgets_registry;},process_version:function(){if(this.version<7.0){this.$form.find('form:first').wrapInner('<group col="4"/>');this.$form.find('page').each(function(){if(!$(this).parents('field').length){$(this).wrapInner('<group col="4"/>');}});}},get_arch_fragment:function(){var doc=$.parseXML(utils.json_node_to_xml(this.fvg.arch)).documentElement;$('button',doc).each(function(){$(this).attr('data-button-type',$(this).attr('type')).attr('type','button');});$('board',doc).each(function(){$(this).attr('layout',$(this).attr('style'));});return $('<div class="oe_form"/>').append(utils.xml_to_str(doc));},render_to:function($target){var self=this;this.$target=$target;this.$form=this.get_arch_fragment();this.process_version();this.fields_to_init=[];this.tags_to_init=[];this.widgets_to_init=[];this.labels={};this.process(this.$form);if(this.$form[0].children[0].children[0].nodeName=='HEADER'){var spaceDiv=document.createElement("div");spaceDiv.style.height='17px';this.$form[0].children[0].children[1].parentNode.insertBefore(spaceDiv,this.$form[0].children[0].children[1]);}
this.$form.appendTo(this.$target);this.to_replace=[];_.each(this.fields_to_init,function($elem){var name=$elem.attr("name");if(!self.fvg.fields[name]){throw new Error(_.str.sprintf(_t("Field '%s' specified in view could not be found."),name));}
var obj=self.fields_registry.get_any([$elem.attr('widget'),self.fvg.fields[name].type]);if(!obj){throw new Error(_.str.sprintf(_t("Widget type '%s' is not implemented"),$elem.attr('widget')||self.fvg.fields[name].type));}
var w=new(obj)(self.view,utils.xml_to_json($elem[0]));var $label=self.labels[$elem.attr("name")];if($label){w.set_input_id($label.attr("for"));}
self.alter_field(w);self.view.register_field(w,$elem.attr("name"));self.to_replace.push([w,$elem]);});_.each(this.tags_to_init,function($elem){var tag_name=$elem[0].tagName.toLowerCase();var obj=self.tags_registry.get(tag_name);var w=new(obj)(self.view,utils.xml_to_json($elem[0]));self.to_replace.push([w,$elem]);});_.each(this.widgets_to_init,function($elem){var widget_type=$elem.attr("type");var obj=self.widgets_registry.get(widget_type);var w=new(obj)(self.view,utils.xml_to_json($elem[0]));self.to_replace.push([w,$elem]);});},init_fields:function(){var defs=[];_.each(this.to_replace,function(el){defs.push(el[0].replace(el[1]));if(el[1].children().length){el[0].$el.append(el[1].children());}});this.to_replace=[];return $.when.apply($,defs);},render_element:function(template){var dicts=[].slice.call(arguments).slice(1);var dict=_.extend.apply(_,dicts);dict['classnames']=dict['class']||'';return $(QWeb.render(template,dict));},alter_field:function(field){},toggle_layout_debugging:function(){if(!this.$target.has('.oe_layout_debug_cell:first').length){this.$target.find('[title]').removeAttr('title');this.$target.find('.oe_form_group_cell').each(function(){var text='W:'+($(this).attr('width')||'')+' - C:'+$(this).attr('colspan');$(this).attr('title',text);});}
this.$target.toggleClass('oe_layout_debugging');},process:function($tag){var self=this;var tagname=$tag[0].nodeName.toLowerCase();if(this.tags_registry.contains(tagname)){this.tags_to_init.push($tag);return(tagname==='button')?this.process_button($tag):$tag;}
var fn=self['process_'+tagname];if(fn){var args=[].slice.call(arguments);args[0]=$tag;return fn.apply(self,args);}else{if(tagname==='header'){$tag.addClass('o_statusbar_buttons');}
$tag.children().each(function(){self.process($(this));});self.handle_common_properties($tag,$tag);$tag.removeAttr("modifiers");return $tag;}},process_button:function($button){var self=this;$button.children().each(function(){self.process($(this));});return $button;},process_widget:function($widget){this.widgets_to_init.push($widget);return $widget;},process_sheet:function($sheet){var $new_sheet=this.render_element('FormRenderingSheet',$sheet.getAttributes());this.handle_common_properties($new_sheet,$sheet);var $dst=$new_sheet.find('.oe_form_sheet');$sheet.contents().appendTo($dst);$sheet.before($new_sheet).remove();this.process($new_sheet);},process_form:function($form){if($form.find('> sheet').length===0){$form.addClass('oe_form_nosheet');}
if($form.attr('readonly')){$form.children().each(function(i,el){var $el=$(el);var mod=JSON.parse($el.attr('modifiers'));mod.readonly=1;$el.attr('modifiers',JSON.stringify(mod));})}
if($form.attr('modifiers')){var attrs=$form.attr('modifiers');var readonly=JSON.parse(attrs);if(readonly){$form.children().each(function(i,child){var child_attrs=($(child).attr('modifiers')&&JSON.parse($(child).attr('modifiers')))||false;if(!child_attrs){child_attrs={}
child_attrs.readonly=readonly;}else{if(child_attrs.readonly){child_attrs.readonly=child_attrs.readonly;}else{child_attrs.readonly=readonly.readonly;}}
$(child).attr('modifiers',JSON.stringify(child_attrs));})}}
var $new_form=this.render_element('FormRenderingForm',$form.getAttributes());this.handle_common_properties($new_form,$form);$form.contents().appendTo($new_form);if($form[0]===this.$form[0]){this.$form=$new_form;}else{$form.before($new_form).remove();}
this.process($new_form);},preprocess_field:function($field){var self=this;var name=$field.attr('name'),field_colspan=parseInt($field.attr('colspan'),10),field_modifiers=JSON.parse($field.attr('modifiers')||'{}');if($field.attr('nolabel')==='1')
return;$field.attr('nolabel','1');var found=false;this.$form.find('label[for="'+name+'"]').each(function(i,el){$(el).parents().each(function(unused,tag){var name=tag.tagName.toLowerCase();if(name==="field"||name in self.tags_registry.map)
found=true;});});if(found)
return;var $label=$('<label/>').attr({'for':name,"modifiers":JSON.stringify({invisible:field_modifiers.invisible}),"string":$field.attr('string'),"help":$field.attr('help'),"class":$field.attr('class'),});$label.insertBefore($field);if(field_colspan>1){$field.attr('colspan',field_colspan-1);}
return $label;},process_field:function($field){if($field.parent().is('group')){var $label=this.preprocess_field($field);if($label){this.process($label);}}
this.fields_to_init.push($field);return $field;},process_group:function($group){var self=this;if($group.attr('readonly')){$group.children().each(function(i,el){var $el=$(el);var mod=JSON.parse($el.attr('modifiers'));mod.readonly=1;$el.attr('modifiers',JSON.stringify(mod));})}
if($group.attr('modifiers')){var attrs=$group.attr('modifiers');var readonly=JSON.parse(attrs);if(readonly){$group.children().each(function(i,child){var child_attrs=($(child).attr('modifiers')&&JSON.parse($(child).attr('modifiers')))||false;if(!child_attrs){child_attrs={};child_attrs.readonly=readonly.readonly;}else{if(child_attrs.readonly){child_attrs.readonly=child_attrs.readonly;}else{child_attrs.readonly=readonly.readonly;}}
$(child).attr('modifiers',JSON.stringify(child_attrs));})}}
$group.children('field').each(function(){self.preprocess_field($(this));});var $new_group=this.render_element('FormRenderingGroup',$group.getAttributes());var $table;if($new_group.first().is('table.oe_form_group')){$table=$new_group;}else if($new_group.filter('table.oe_form_group').length){$table=$new_group.filter('table.oe_form_group').first();}else{$table=$new_group.find('table.oe_form_group').first();}
var $tr,$td,cols=parseInt($group.attr('col')||2,10),row_cols=cols;var children=[];$group.children().each(function(){var $child=$(this);var colspan=parseInt($child.attr('colspan')||1,10);var tagName=$child[0].tagName.toLowerCase();var $td=$('<td/>').addClass('oe_form_group_cell').attr('colspan',colspan);var newline=tagName==='newline';if($tr&&row_cols>0&&(newline||row_cols<colspan)){$tr.addClass('oe_form_group_row_incomplete');if(newline){$tr.addClass('oe_form_group_row_newline');}}
if(newline){$tr=null;return;}
if(!$tr||row_cols<colspan){$tr=$('<tr/>').addClass('oe_form_group_row').appendTo($table);row_cols=cols;}else if(tagName==='group'){$td.addClass('oe_group_right');}
row_cols-=colspan;var field_modifiers=JSON.parse($child.attr('modifiers')||'{}');var invisible=field_modifiers.invisible;self.handle_common_properties($td,$("<dummy>").attr("modifiers",JSON.stringify({invisible:invisible})));$tr.append($td.append($child));children.push($child[0]);});if(row_cols&&$td){$td.attr('colspan',parseInt($td.attr('colspan'),10)+row_cols);}
$group.before($new_group).remove();$table.find('> tbody > tr').each(function(){var to_compute=[],row_cols=cols,total=100;$(this).children().each(function(){var $td=$(this),$child=$td.children(':first');if($child.attr('cell-class')){$td.addClass($child.attr('cell-class'));}
switch($child[0].tagName.toLowerCase()){case'separator':break;case'label':if($child.attr('for')){$td.attr('width','1%').addClass('oe_form_group_cell_label');row_cols-=$td.attr('colspan')||1;total--;}
break;default:var width=_.str.trim($child.attr('width')||''),iwidth=parseInt(width,10);if(iwidth){if(width.substr(-1)==='%'){total-=iwidth;width=iwidth+'%';}else{$td.css('min-width',width+'px');}
$td.attr('width',width);$child.removeAttr('width');row_cols-=$td.attr('colspan')||1;}else{to_compute.push($td);}}});if(row_cols){var unit=Math.floor(total/row_cols);if(!$(this).is('.oe_form_group_row_incomplete')){_.each(to_compute,function($td){var width=parseInt($td.attr('colspan'),10)*unit;$td.attr('width',width+'%');total-=width;});}}});_.each(children,function(el){self.process($(el));});this.handle_common_properties($new_group,$group);return $new_group;},process_notebook:function($notebook){var self=this;var pages=[];var notebook_readonly=$notebook.attr('modifiers')&&JSON.parse($notebook.attr('modifiers')).readonly;$notebook.find('> page').each(function(){var $page=$(this);var page_attrs=$page.getAttributes();var page_modifiers=page_attrs.modifiers&&JSON.parse(page_attrs.modifiers);if(notebook_readonly){if(!page_attrs.modifiers){page_modifiers={};page_modifiers.readonly=notebook_readonly;}else{if(page_modifiers.readonly){page_modifiers.readonly=page_modifiers.readonly;}else{page_modifiers.readonly=notebook_readonly;}}
$page.attr('modifiers',JSON.stringify(page_modifiers));page_attrs=$page.getAttributes();}
if('readonly'in page_attrs){$page.children().each(function(i,el){var $el=$(el);var mod=($el.attr('modifiers')&&JSON.parse($el.attr('modifiers')))||{};mod.readonly=1;$el.attr('modifiers',JSON.stringify(mod));})}
if('modifiers'in page_attrs){var readonly=page_attrs.modifiers;if(readonly){readonly=JSON.parse(readonly);$page.children().each(function(i,child){var child_attrs=($(child).attr('modifiers')&&JSON.parse($(child).attr('modifiers')))||false;if(!child_attrs){child_attrs={};child_attrs.readonly=readonly.readonly;}else{if(child_attrs.readonly){child_attrs.readonly=child_attrs.readonly;}else{child_attrs.readonly=readonly.readonly;}}
$(child).attr('modifiers',JSON.stringify(child_attrs));})}}
page_attrs.id=_.uniqueId('notebook_page_');page_attrs.contents=$page.html();page_attrs.ref=$page;pages.push(page_attrs);});var $new_notebook=self.render_element('FormRenderingNotebook',{'pages':pages});$notebook.before($new_notebook).remove();var pageid_to_display;_.each(pages,function(page){var $tab=$new_notebook.find('a[href=#'+page.id+']').parent();var $content=$new_notebook.find('#'+page.id);self.attach_node_attr($tab,page.ref,'autofocus');self.attach_node_attr($content,page.ref,'autofocus');if(!pageid_to_display&&page.autofocus=='autofocus'){pageid_to_display=page.id;}
self.handle_common_properties($tab,page.ref,common.NotebookInvisibilityChanger);self.handle_common_properties($content,page.ref,common.NotebookInvisibilityChanger);});if(!pageid_to_display){pageid_to_display=$new_notebook.find('div[role="tabpanel"]:not(.o_form_invisible):first').attr('id');}
$new_notebook.find('a[href=#'+pageid_to_display+']').parent().addClass('active');$new_notebook.find('#'+pageid_to_display).addClass('active');self.process($new_notebook.children());self.handle_common_properties($new_notebook,$notebook);return $new_notebook;},process_separator:function($separator){var $new_separator=this.render_element('FormRenderingSeparator',$separator.getAttributes());$separator.before($new_separator).remove();this.handle_common_properties($new_separator,$separator);return $new_separator;},process_label:function($label){var name=$label.attr("for"),field_orm=this.fvg.fields[name];var dict={string:$label.attr('string')||(field_orm||{}).string||'',help:$label.attr('help')||(field_orm||{}).help||'',_for:name?_.uniqueId('oe-field-input-'):undefined,field_name:name,};var align=parseFloat(dict.align);if(isNaN(align)||align===1){align='right';}else if(align===0){align='left';}else{align='center';}
dict.align=align;var $new_label=this.render_element('FormRenderingLabel',dict);$label.before($new_label).remove();this.handle_common_properties($new_label,$label);if(name){this.labels[name]=$new_label;}
return $new_label;},handle_common_properties:function($new_element,$node,InvisibilityChanger){var str_modifiers=$node.attr("modifiers")||"{}";var modifiers=JSON.parse(str_modifiers);var ic=null;if(modifiers.invisible!==undefined){var InvisibilityChangerCls=InvisibilityChanger||common.InvisibilityChanger;ic=new InvisibilityChangerCls(this.view,this.view,modifiers.invisible,$new_element);}
$new_element.addClass($node.attr("class")||"");$new_element.attr('style',$node.attr('style'));return{invisibility_changer:ic,};},attach_node_attr:function($new_element,$node,attr){$new_element.data(attr,$node.attr(attr));}});core.view_registry.add('form',FormView);return FormView;});;

/* /web/static/src/js/views/form_common.js defined in bundle 'web.assets_backend' */
odoo.define('web.form_common',function(require){"use strict";var core=require('web.core');var data=require('web.data');var Dialog=require('web.Dialog');var ListView=require('web.ListView');var pyeval=require('web.pyeval');var SearchView=require('web.SearchView');var session=require('web.session');var utils=require('web.utils');var Widget=require('web.Widget');var Sidebar=require('web.Sidebar');var QWeb=core.qweb;var _t=core._t;var FieldManagerMixin={get_field_desc:function(field_name){},get_field_value:function(field_name){},set_values:function(values){},compute_domain:function(expression){},build_eval_context:function(){},};var DefaultFieldManager=Widget.extend({init:function(parent,eval_context){this._super(parent);this.field_descs={};this.eval_context=eval_context||{};this.set({display_invalid_fields:false,actual_mode:'create',});},get_field_desc:function(field_name){if(this.field_descs[field_name]===undefined){this.field_descs[field_name]={string:field_name,};}
return this.field_descs[field_name];},extend_field_desc:function(fields){var self=this;_.each(fields,function(v,k){_.extend(self.get_field_desc(k),v);});},get_field_value:function(field_name){return false;},set_values:function(values){},compute_domain:function(expression){return data.compute_domain(expression,{});},build_eval_context:function(){return new data.CompoundContext(this.eval_context);},});var ReinitializeWidgetMixin={start:function(){this.initialize_field();this._super();},initialize_field:function(){this.on("change:effective_readonly",this,this.reinitialize);this.initialize_content();},reinitialize:function(){this.destroy_content();this.renderElement();this.initialize_content();},destroy_content:function(){},initialize_content:function(){},};var ReinitializeFieldMixin=_.extend({},ReinitializeWidgetMixin,{reinitialize:function(){ReinitializeWidgetMixin.reinitialize.call(this);if(!this.no_rerender){var res=this.render_value();if(this.view&&this.view.render_value_defs){this.view.render_value_defs.push(res);}}},});var CompletionFieldMixin={init:function(){this.limit=7;this.orderer=new utils.DropMisordered();this.can_create=this.node.attrs.can_create||true;this.can_write=this.node.attrs.can_write||true;},get_search_result:function(search_val){var self=this;var dataset=new data.DataSet(this,this.field.relation,self.build_context());this.last_query=search_val;var exclusion_domain=[],ids_blacklist=this.get_search_blacklist();if(!_(ids_blacklist).isEmpty()){exclusion_domain.push(['id','not in',ids_blacklist]);}
return this.orderer.add(dataset.name_search(search_val,new data.CompoundDomain(self.build_domain(),exclusion_domain),'ilike',this.limit+1,self.build_context())).then(function(data){self.last_search=data;var values=_.map(data,function(x){x[1]=x[1].split("\n")[0];return{label:_.str.escapeHTML(x[1]),value:x[1],name:x[1],id:x[0],};});if(values.length>self.limit){values=values.slice(0,self.limit);values.push({label:_t("Search More..."),action:function(){dataset.name_search(search_val,self.build_domain(),'ilike',160).done(function(data){self._search_create_popup("search",data);});},classname:'oe_m2o_dropdown_option'});}
var raw_result=_(data.result).map(function(x){return x[1];});if(search_val.length>0&&!_.include(raw_result,search_val)&&!(self.options&&(self.options.no_create||!self.options.force_quick_create))){self.can_create&&values.push({label:_.str.sprintf(_t('Create "<strong>%s</strong>"'),$('<span />').text(search_val).html()),action:function(){self._quick_create(search_val);},classname:'oe_m2o_dropdown_option'});}
if(!(self.options&&(self.options.no_create||self.options.no_create_edit))&&self.can_create){values.push({label:_t("Create and Edit..."),action:function(){self._search_create_popup("form",undefined,self._create_context(search_val));},classname:'oe_m2o_dropdown_option'});}
else if(values.length===0){values.push({label:_t("No results to show..."),action:function(){},classname:'oe_m2o_dropdown_option'});}
return values;});},get_search_blacklist:function(){return[];},_quick_create:function(name){var self=this;var slow_create=function(){self._search_create_popup("form",undefined,self._create_context(name));};if(self.options.quick_create===undefined||self.options.quick_create){new data.DataSet(this,this.field.relation,self.build_context()).name_create(name).done(function(data){if(!self.get('effective_readonly'))
self.add_id(data[0]);}).fail(function(error,event){event.preventDefault();slow_create();});}else
slow_create();},_search_create_popup:function(view,ids,context){var self=this;new SelectCreateDialog(this,{res_model:self.field.relation,domain:self.build_domain(),context:new data.CompoundContext(self.build_context(),context||{}),title:(view==='search'?_t("Search: "):_t("Create: "))+this.string,initial_ids:ids?_.map(ids,function(x){return x[0];}):undefined,initial_view:view,disable_multiple_selection:true,on_selected:function(element_ids){self.add_id(element_ids[0]);self.focus();}}).open();},add_id:function(id){},_create_context:function(name){var tmp={};var field=(this.options||{}).create_name_field;if(field===undefined)
field="name";if(field!==false&&name&&(this.options||{}).quick_create!==false)
tmp["default_"+field]=name;return tmp;},};var InvisibilityChangerMixin={init:function(field_manager,invisible_domain){var self=this;this._ic_field_manager=field_manager;this._ic_invisible_modifier=invisible_domain;this._ic_field_manager.on("view_content_has_changed",this,function(){var result=self._ic_invisible_modifier===undefined?false:self._ic_field_manager.compute_domain(self._ic_invisible_modifier);self.set({"invisible":result});});this.set({invisible:this._ic_invisible_modifier===true,force_invisible:false});var check=function(){if(self.get("invisible")||self.get('force_invisible')){self.set({"effective_invisible":true});}else{self.set({"effective_invisible":false});}};this.on('change:invisible',this,check);this.on('change:force_invisible',this,check);check.call(this);},start:function(){this.on("change:effective_invisible",this,this._check_visibility);this._check_visibility();},_check_visibility:function(){this.$el.toggleClass('o_form_invisible',this.get("effective_invisible"));},};var InvisibilityChanger=core.Class.extend(core.mixins.PropertiesMixin,InvisibilityChangerMixin,{init:function(parent,field_manager,invisible_domain,$el){this.setParent(parent);core.mixins.PropertiesMixin.init.call(this);InvisibilityChangerMixin.init.call(this,field_manager,invisible_domain);this.$el=$el;this.start();},});var NotebookInvisibilityChanger=InvisibilityChanger.extend({start:function(){this.on("change:effective_invisible",this,this._check_visibility);},_check_visibility:function(){this._super();if(this.get("effective_invisible")===true){if(this.$el.hasClass('active')){this.$el.removeClass('active');var visible_siblings=this.$el.siblings(':not(.o_form_invisible)');if(visible_siblings.length){$(visible_siblings[0]).addClass('active');}}}else{var visible_active_sibling=this.$el.siblings(':not(.o_form_invisible).active');if(!(visible_active_sibling.length)){this.$el.addClass('active');}else if(!$(visible_active_sibling[0]).data('autofocus')&&this._ic_field_manager.get('actual_mode')==="edit"){this.$el.addClass('active');$(visible_active_sibling[0]).removeClass('active');}}},});var FormWidget=Widget.extend(InvisibilityChangerMixin,{init:function(field_manager,node){this._super(field_manager);this.field_manager=field_manager;this.view=this.field_manager;this.node=node;this.session=session;this.modifiers=JSON.parse(this.node.attrs.modifiers||'{}');InvisibilityChangerMixin.init.call(this,this.field_manager,this.modifiers.invisible);this.field_manager.on("view_content_has_changed",this,this.process_modifiers);this.set({required:false,readonly:false,});var self=this;var test_effective_readonly=function(){self.set({"effective_readonly":self.get("readonly")||self.field_manager.get("actual_mode")==="view"});};this.on("change:readonly",this,test_effective_readonly);this.field_manager.on("change:actual_mode",this,test_effective_readonly);test_effective_readonly.call(this);},renderElement:function(){this.process_modifiers();this._super();this.$el.addClass(this.node.attrs["class"]||"");},destroy:function(){$.fn.tooltip('destroy');this._super.apply(this,arguments);},setupFocus:function($e){var self=this;$e.on({focus:function(){self.trigger('focused');},blur:function(){self.trigger('blurred');}});},process_modifiers:function(){var to_set={};for(var a in this.modifiers){if(!this.modifiers.hasOwnProperty(a)){continue;}
if(!_.include(["invisible"],a)){var val=this.field_manager.compute_domain(this.modifiers[a]);to_set[a]=val;}}
this.set(to_set);},do_attach_tooltip:function(widget,trigger,options){widget=widget||this;trigger=trigger||this.$el;options=_.extend({delay:{show:1000,hide:0},title:function(){var template=widget.template+'.tooltip';if(!QWeb.has_template(template)){template='WidgetLabel.tooltip';}
return QWeb.render(template,{debug:session.debug,widget:widget});},},options||{});if(session.debug||widget.node.attrs.help||(widget.field&&widget.field.help)){$(trigger).tooltip(options);}},build_context:function(){var v_context=this.node.attrs.context;if(!v_context){v_context=(this.field||{}).context||{};}
if(v_context.__ref||true){var fields_values=this.field_manager.build_eval_context();v_context=new data.CompoundContext(v_context).set_eval_context(fields_values);}
return v_context;},build_domain:function(){var f_domain=this.field.domain||[];var n_domain=this.node.attrs.domain||null;var final_domain=n_domain!==null?n_domain:f_domain;if(!(final_domain instanceof Array)||true){var fields_values=this.field_manager.build_eval_context();final_domain=new data.CompoundDomain(final_domain).set_eval_context(fields_values);}
return final_domain;}});var commands={CREATE:0,'create':function(values){return[commands.CREATE,false,values];},UPDATE:1,'update':function(id,values){return[commands.UPDATE,id,values];},DELETE:2,'delete':function(id){return[commands.DELETE,id,false];},FORGET:3,'forget':function(id){return[commands.FORGET,id,false];},LINK_TO:4,'link_to':function(id){return[commands.LINK_TO,id,false];},DELETE_ALL:5,'delete_all':function(){return[5,false,false];},REPLACE_WITH:6,'replace_with':function(ids){return[6,false,ids];}};var FieldInterface={init:function(field_manager,node){},set_value:function(value_){},get_value:function(){},set_input_id:function(id){},is_valid:function(){},is_syntax_valid:function(){},focus:function(){},on_translate:function(){},commit_value:function(){},before_save:function(){},};var AbstractField=FormWidget.extend(FieldInterface,{init:function(field_manager,node){this._super(field_manager,node);this.name=this.node.attrs.name;this.field=this.field_manager.get_field_desc(this.name);this.widget=this.node.attrs.widget;this.string=this.node.attrs.string||this.field.string||this.name;this.options=pyeval.py_eval(this.node.attrs.options||'{}');this.set({'value':false});this.on("change:value",this,function(){this.trigger('changed_value');this._check_css_flags();});this.$translate=$();},renderElement:function(){var self=this;this._super();if(this.field.translate&&this.view){this.$el.addClass('oe_form_field_translatable');this.$el.find('.oe_field_translate').click(this.on_translate);}
this.$label=this.view?this.view.$el.find('label[for='+this.id_for_label+']'):$();this.do_attach_tooltip(this,this.$label[0]||this.$el);if(session.debug){this.$label.off('dblclick').on('dblclick',function(){console.log("Field '%s' of type '%s' in View: %o",self.name,(self.node.attrs.widget||self.field.type),self.view);window.w=self;console.log("window.w =",window.w);});}
if(!this.disable_utility_classes){this.off("change:required",this,this._set_required);this.on("change:required",this,this._set_required);this._set_required();}
this._check_visibility();this.field_manager.off("change:display_invalid_fields",this,this._check_css_flags);this.field_manager.on("change:display_invalid_fields",this,this._check_css_flags);this._check_css_flags();},start:function(){this._super();this.on("change:value",this,function(){if(!this.no_rerender){this.render_value();}
this._toggle_label();});this.on("change:effective_readonly",this,function(){this._toggle_label();});this.render_value();this._toggle_label();},_toggle_label:function(){var empty=this.get('effective_readonly')&&this.is_false();this.$el.toggleClass('o_form_field_empty',empty);},_set_required:function(){this.$el.toggleClass('oe_form_required',this.get("required"));},set_value:function(value_){this.set({'value':value_});},get_value:function(){return this.get('value');},internal_set_value:function(value_){var tmp=this.no_rerender;this.no_rerender=true;this.set({'value':value_});this.no_rerender=tmp;},render_value:function(){},is_valid:function(){return this.is_syntax_valid()&&!(this.get('required')&&this.is_false());},is_syntax_valid:function(){return true;},is_false:function(){return this.get('value')===false;},_check_css_flags:function(){if(this.field.translate){this.$el.find('.oe_field_translate').toggle(this.field_manager.get('actual_mode')!=="create");}
this.$el.toggleClass('oe_form_invalid',!this.disable_utility_classes&&!!this.field_manager.get('display_invalid_fields')&&!this.is_valid());},focus:function(){return false;},set_input_id:function(id){this.id_for_label=id;},on_translate:function(){var self=this;var trans=new data.DataSet(this,'ir.translation');return trans.call_button('translate_fields',[this.view.dataset.model,this.view.datarecord.id,this.name,this.view.dataset.get_context()]).done(function(r){self.do_action(r);});},set_dimensions:function(height,width){this.$el.css({width:width,minHeight:height});},commit_value:function(){return $.when();},});var ViewDialog=Dialog.extend({init:function(parent,options){options=options||{};options.dialogClass=options.dialogClass||'';options.dialogClass+=' o_act_window';this._super(parent,_.clone(options));this.res_model=options.res_model||null;this.res_id=options.res_id||null;this.domain=options.domain||[];this.context=options.context||{};this.options=_.extend(this.options||{},options||{});this.on('closed',this,this.select);options.parent_view&&options.parent_view.on('load_record',this,function(){this.view_form&&this.view_form.reload();})
this.on_selected=options.on_selected||(function(){});},init_dataset:function(){var self=this;this.created_elements=[];this.dataset=new data.ProxyDataSet(this,this.res_model,this.context);this.dataset.read_function=this.options.read_function;this.dataset.create_function=function(data,options,sup){var fct=self.options.create_function||sup;return fct.call(this,data,options).done(function(r){self.trigger('create_completed saved',r);self.created_elements.push(r);});};this.dataset.write_function=function(id,data,options,sup){var fct=self.options.write_function||sup;return fct.call(this,id,data,options).done(function(r){self.trigger('write_completed saved',r);});};this.dataset.parent_view=this.options.parent_view;this.dataset.child_name=this.options.child_name;},select:function(){if(this.created_elements.length>0){this.on_selected(this.created_elements);this.created_elements=[];}}});var FormViewDialog=ViewDialog.extend({init:function(parent,options){var self=this;var multi_select=!_.isNumber(options.res_id)&&!options.disable_multiple_selection;var readonly=_.isNumber(options.res_id)&&options.readonly;if(!options||!options.buttons){options=options||{};options.buttons=[{text:(readonly?_t("Close"):_t("Discard")),classes:"btn-default o_form_button_cancel",close:true,click:function(){self.view_form.trigger('on_button_cancel');}}];if(!readonly){options.buttons.splice(0,0,{text:_t("Save")+((multi_select)?" "+_t(" & Close"):""),classes:"btn-primary o_formdialog_save",click:function(){self.view_form.onchanges_mutex.def.then(function(){if(!self.view_form.warning_displayed){$.when(self.view_form.save()).done(function(){self.view_form.reload_mutex.exec(function(){self.trigger('record_saved');self.close();});});}});}});if(multi_select){options.buttons.splice(1,0,{text:_t("Save & New"),classes:"btn-primary",click:function(){$.when(self.view_form.save()).done(function(){self.view_form.reload_mutex.exec(function(){self.view_form.on_button_new();});});}});}}}
this._super(parent,options);},open:function(){var self=this;self._super();self.init_dataset();if(self.res_id){self.dataset.ids=[self.res_id];self.dataset.index=0;}else{self.dataset.index=null;}
var options=_.clone(self.options.form_view_options)||{};if(self.res_id!==null){options.initial_mode=self.options.readonly?"view":"edit";}
_.extend(options,{$buttons:self.$buttons,});var FormView=core.view_registry.get('form');self.view_form=new FormView(self,self.dataset,self.options.view_id||false,options);if(self.options.alternative_form_view){self.view_form.set_embedded_view(self.options.alternative_form_view);}
self.do_hide();self.view_form.appendTo(self.$el);self.view_form.on("form_view_loaded",self,function(){self.view_form.do_show().then(function(){self.do_show();});});return this;},});var SelectCreateListView=ListView.extend({do_add_record:function(){this.popup.create_edit_record();},select_record:function(index){this.popup.on_selected([this.dataset.ids[index]]);this.popup.close();},do_select:function(ids,records){this._super(ids,records);this.popup.on_click_element(ids);}});var SelectCreateDialog=ViewDialog.extend({init:function(parent,options){this._super(parent,options);_.defaults(this.options,{initial_view:"search"});this.initial_ids=this.options.initial_ids;},open:function(){this._super();this.init_dataset();if(this.options.initial_view=="search"){var context=pyeval.sync_eval_domains_and_contexts({domains:[],contexts:[this.context]}).context;var search_defaults={};_.each(context,function(value_,key){var match=/^search_default_(.*)$/.exec(key);if(match){search_defaults[match[1]]=value_;}});this.setup(search_defaults);}else{this.create_edit_record();}
return this;},sidebar_eval_context:function(){return $.when(new data.CompoundContext({select_create:true}));},get_selected_ids:function(){return[];},setup:function(search_defaults){var self=this;if(this.searchview){this.searchview.destroy();}
var $header=$('<div/>').addClass('o_modal_header oe-control-panel').appendTo(this.$el);var $pager=$('<div/>').addClass('o_pager').appendTo($header);var $buttons=$('<div/>').addClass('oe-search-options').appendTo($header);this.searchview=new SearchView(this,this.dataset,false,search_defaults,{$buttons:$buttons});this.searchview.on('search_data',self,function(domains,contexts,groupbys){if(self.initial_ids){self.do_search(domains.concat([[["id","in",self.initial_ids]],self.domain]),contexts.concat(self.context),groupbys);self.initial_ids=undefined;}else{self.do_search(domains.concat([self.domain]),contexts.concat(self.context),groupbys);}});this.searchview.prependTo($header).done(function(){self.searchview.toggle_visibility(true);self.view_list=new SelectCreateListView(self,self.dataset,false,_.extend({'deletable':false,'selectable':!self.options.disable_multiple_selection,'import_enabled':false,'$buttons':self.$footer,'disable_editable_mode':true,'pager':true,'sidebar':true,},self.options.list_view_options||{}));self.view_list.on('edit:before',self,function(e){e.cancel=true;});self.view_list.popup=self;self.view_list.appendTo(self.$el).then(function(){self.view_list.do_show();self.view_list.render_pager($pager);}).then(function(){self.view_list.sidebar=new Sidebar(self,{});self.view_list.sidebar.add_toolbar(self.view_list.fields_view.toolbar);self.view_list.sidebar.appendTo($buttons);if(self.options.initial_facet){self.searchview.query.reset([self.options.initial_facet],{preventSearch:true,});}
self.searchview.do_search();});var buttons=[{text:_t("Cancel"),classes:"btn-default o_form_button_cancel",close:true}];if(!self.options.no_create){buttons.splice(0,0,{text:_t("Create"),classes:"btn-primary",click:function(){self.create_edit_record();}});}
if(!self.options.disable_multiple_selection){buttons.splice(0,0,{text:_t("Select"),classes:"btn-primary o_selectcreatepopup_search_select",disabled:true,close:true,click:function(){self.on_selected(self.selected_ids);}});}
self.set_buttons(buttons);});},do_search:function(domains,contexts,groupbys){var results=pyeval.sync_eval_domains_and_contexts({domains:domains||[],contexts:contexts||[],group_by_seq:groupbys||[]});this.view_list.do_search(results.domain,results.context,results.group_by);},on_click_element:function(ids){this.selected_ids=ids||[];this.$footer.find(".o_selectcreatepopup_search_select").prop('disabled',this.selected_ids.length<=0);},create_edit_record:function(){new FormViewDialog(this.getParent(),this.options).open();this.close();},});var DomainEditorDialog=SelectCreateDialog.extend({init:function(parent,options){options=_.defaults(options,{initial_facet:{category:_t("Custom Filter"),icon:'fa-star',field:{get_context:function(){return options.context;},get_groupby:function(){return[];},get_domain:function(){return options.default_domain;},},values:[{label:_t("Selected domain"),value:null}],}});this._super(parent,options);},get_domain:function(selected_ids){var group_domain=[],domain;if(this.$('input.oe_list_record_selector').prop('checked')){if(this.view_list.grouped){var group_domain=_.chain(_.values(this.view_list.groups.children)).filter(function(child){return child.records.length;}).map(function(c){return c.datagroup.domain;}).value();group_domain=_.flatten(group_domain,true);group_domain=_.times(group_domain.length-1,_.constant('|')).concat(group_domain);}
var search_data=this.searchview.build_search_data();domain=pyeval.sync_eval_domains_and_contexts({domains:search_data.domains,contexts:search_data.contexts,group_by_seq:search_data.groupbys||[]}).domain;}
else{domain=[["id","in",selected_ids]];}
return this.dataset.domain.concat(group_domain).concat(domain||[]);},});return{FieldManagerMixin:FieldManagerMixin,ReinitializeWidgetMixin:ReinitializeWidgetMixin,ReinitializeFieldMixin:ReinitializeFieldMixin,CompletionFieldMixin:CompletionFieldMixin,FormWidget:FormWidget,DefaultFieldManager:DefaultFieldManager,InvisibilityChanger:InvisibilityChanger,NotebookInvisibilityChanger:NotebookInvisibilityChanger,commands:commands,AbstractField:AbstractField,ViewDialog:ViewDialog,FormViewDialog:FormViewDialog,SelectCreateDialog:SelectCreateDialog,DomainEditorDialog:DomainEditorDialog,};});;

/* /web/static/src/js/views/form_widgets.js defined in bundle 'web.assets_backend' */
odoo.define('web.form_widgets',function(require){"use strict";var core=require('web.core');var crash_manager=require('web.crash_manager');var data=require('web.data');var datepicker=require('web.datepicker');var ProgressBar=require('web.ProgressBar');var Dialog=require('web.Dialog');var common=require('web.form_common');var formats=require('web.formats');var framework=require('web.framework');var Model=require('web.DataModel');var Priority=require('web.Priority');var pyeval=require('web.pyeval');var session=require('web.session');var utils=require('web.utils');var dom_utils=require('web.dom_utils');var formats=require('web.formats');var _t=core._t;var QWeb=core.qweb;var WidgetButton=common.FormWidget.extend({template:'WidgetButton',init:function(field_manager,node){node.attrs.type=node.attrs['data-button-type'];this._super(field_manager,node);this.force_disabled=false;this.string=(this.node.attrs.string||'').replace(/_/g,'');if(JSON.parse(this.node.attrs.default_focus||"0")){this.view.default_focus_button=this;}
if(this.node.attrs.icon){this.fa_icon=this.node.attrs.icon.indexOf('fa-')===0;if(!this.fa_icon&&(!/\//.test(this.node.attrs.icon))){this.node.attrs.icon='/web/static/src/img/icons/'+this.node.attrs.icon+'.png';}}},start:function(){this._super.apply(this,arguments);this.view.on('view_content_has_changed',this,this.check_disable);this.check_disable();this.$el.click(this.on_click);if(this.node.attrs.help||session.debug){this.do_attach_tooltip();}
this.setupFocus(this.$el);},on_click:function(){var self=this;this.force_disabled=true;this.check_disable();this.execute_action().always(function(){self.force_disabled=false;self.check_disable();if(self.$el.hasClass('o_wow')){self.show_wow();}});},execute_action:function(){var self=this;var exec_action=function(){if(self.node.attrs.confirm){var def=$.Deferred();Dialog.confirm(self,self.node.attrs.confirm,{confirm_callback:self.on_confirmed}).on("closed",null,function(){def.resolve();});return def.promise();}else{return self.on_confirmed();}};if(!this.node.attrs.special){return this.view.recursive_save().then(exec_action);}else{return exec_action();}},on_confirmed:function(){var self=this;var context=this.build_context();return this.view.do_execute_action(_.extend({},this.node.attrs,{context:context}),this.view.dataset,this.view.datarecord.id,function(reason){if(!_.isObject(reason)){self.view.recursive_reload();}}).fail(function(){self.view.recursive_reload();});},check_disable:function(){var disabled=(this.force_disabled||!this.view.is_interactible_record());this.$el.prop('disabled',disabled);this.$el.css('color',disabled?'grey':'');},show_wow:function(){var class_to_add='o_wow_thumbs';if(Math.random()>0.9){var other_classes=['o_wow_peace','o_wow_heart'];class_to_add=other_classes[Math.floor(Math.random()*other_classes.length)];}
var $body=$('body');$body.addClass(class_to_add);setTimeout(function(){$body.removeClass(class_to_add);},1000);}});var FieldChar=common.AbstractField.extend(common.ReinitializeFieldMixin,{template:'FieldChar',widget_class:'oe_form_field_char',events:{'change input':'store_dom_value',},init:function(field_manager,node){this._super(field_manager,node);this.password=this.node.attrs.password==='True'||this.node.attrs.password==='1';},initialize_content:function(){this.setupFocus(this.$('input'));},store_dom_value:function(){if(!this.get('effective_readonly')&&this.$('input').length&&this.is_syntax_valid()){this.internal_set_value(this.parse_value(this.$('input').val()));}},commit_value:function(){this.store_dom_value();return this._super();},render_value:function(){var show_value=this.format_value(this.get('value'),'');if(!this.get("effective_readonly")){this.$el.find('input').val(show_value);}else{if(this.password){show_value=new Array(show_value.length+1).join('*');}
this.$(".oe_form_char_content").text(show_value);}},is_syntax_valid:function(){if(!this.get("effective_readonly")&&this.$("input").size()>0){try{this.parse_value(this.$('input').val(),'');return true;}catch(e){return false;}}
return true;},parse_value:function(val,def){return formats.parse_value(val,this,def);},format_value:function(val,def){return formats.format_value(val,this,def);},is_false:function(){return this.get('value')===''||this._super();},focus:function(){var input=this.$('input:first')[0];return input?input.focus():false;},set_dimensions:function(height,width){this._super(height,width);this.$('input').css({height:height,width:width});}});var KanbanSelection=FieldChar.extend({template:"FormSelection",init:function(field_manager,node){this._super(field_manager,node);},start:function(){var self=this;this.states=[];this._super.apply(this,arguments);this.getParent().on('view_content_has_changed',self,function(){self.render_value();});},prepare_dropdown_selection:function(){var self=this;var _data=[];var current_stage_id=self.view.datarecord.stage_id[0];var stage_data={id:current_stage_id,legend_normal:self.view.datarecord.legend_normal||undefined,legend_blocked:self.view.datarecord.legend_blocked||undefined,legend_done:self.view.datarecord.legend_done||undefined,};_.map(self.field.selection||[],function(selection_item){var value={'name':selection_item[0],'tooltip':selection_item[1],};if(selection_item[0]==='normal'){value.state_name=stage_data.legend_normal?stage_data.legend_normal:selection_item[1];}else if(selection_item[0]==='done'){value.state_class='oe_kanban_status_green';value.state_name=stage_data.legend_done?stage_data.legend_done:selection_item[1];}else{value.state_class='oe_kanban_status_red';value.state_name=stage_data.legend_blocked?stage_data.legend_blocked:selection_item[1];}
_data.push(value);});return _data;},render_value:function(){this._super();this.states=this.prepare_dropdown_selection();var self=this;var current_state=_.find(this.states,function(state){return state.name===self.get('value');});this.$('.oe_kanban_status').removeClass('oe_kanban_status_red oe_kanban_status_green').addClass(current_state.state_class);var $items=$(QWeb.render('FormSelection.items',{states:_.without(this.states,current_state)}));var $dropdown=this.$el.find('.dropdown-menu');$dropdown.children().remove();$items.appendTo($dropdown);this.$el.find('a').on('click',this.set_kanban_selection.bind(this));},set_kanban_selection:function(ev){var self=this;ev.preventDefault();var li=$(ev.target).closest('li');if(li.length){var value=String(li.data('value'));if(this.view.get('actual_mode')=='view'){var write_values={};write_values[self.name]=value;return this.view.dataset._model.call('write',[[this.view.datarecord.id],write_values,self.view.dataset.get_context()]).done(self.reload_record.bind(self));}
else{return this.set_value(value);}}},reload_record:function(){this.view.reload();},});var FieldPriority=common.AbstractField.extend({events:{'mouseup':function(e){e.stopPropagation();},},start:function(){this.priority=new Priority(this,{readonly:this.get('readonly'),value:this.get('value'),values:this.field.selection||[],});this.priority.on('update',this,function(update){var view=this.view;if(view.get('actual_mode')==='view'){var write_values={};write_values[this.name]=update.value;view.dataset._model.call('write',[[view.datarecord.id],write_values,view.dataset.get_context()]).done(function(){view.reload();});}else{this.set_value(update.value);}});this.on('change:readonly',this,function(){this.priority.readonly=this.get('readonly');var $div=$('<div/>').insertAfter(this.$el);this.priority.replace($div);this.setElement(this.priority.$el);});var self=this;return $.when(this._super(),this.priority.appendTo('<div>').then(function(){self.priority.$el.addClass(self.$el.attr('class'));self.replaceElement(self.priority.$el);}));},render_value:function(){this.priority.set_value(this.get('value'));},});var FieldID=FieldChar.extend({process_modifiers:function(){this._super();this.set({readonly:true});},});var FieldEmail=FieldChar.extend({template:'FieldEmail',initialize_content:function(){this._super();var $button=this.$el.find('button');$button.click(this.on_button_clicked);this.setupFocus($button);},render_value:function(){if(!this.get("effective_readonly")){this._super();}else{this.$el.find('a').attr('href','mailto:'+this.get('value')).text(this.get('value')||'');}},on_button_clicked:function(){if(!this.get('value')||!this.is_syntax_valid()){this.do_warn(_t("E-mail Error"),_t("Can't send email to invalid e-mail address"));}else{location.href='mailto:'+this.get('value');}}});var FieldUrl=FieldChar.extend({template:'FieldUrl',initialize_content:function(){this._super();var $button=this.$el.find('button');$button.click(this.on_button_clicked);this.setupFocus($button);},render_value:function(){if(!this.get("effective_readonly")){this._super();}else{var tmp=this.get('value');var s=/(\w+):(.+)|^\.{0,2}\//.exec(tmp);if(!s){tmp="http://"+this.get('value');}
var text=this.get('value')?this.node.attrs.text||tmp:'';this.$el.find('a').attr('href',tmp).text(text);}},on_button_clicked:function(){if(!this.get('value')){this.do_warn(_t("Resource Error"),_t("This resource is empty"));}else{var url=$.trim(this.get('value'));if(/^www\./i.test(url))
url='http://'+url;window.open(url);}}});var FieldFloat=FieldChar.extend({is_field_number:true,widget_class:'oe_form_field_float',init:function(field_manager,node){this._super(field_manager,node);if(this.node.attrs.digits){this.digits=this.node.attrs.digits;}else{this.digits=this.field.digits;}},set_value:function(value_){if(value_!==false&&this.digits!==undefined&&this.digits.length===2){value_=utils.round_decimals(value_,this.digits[1]);}
this._super.apply(this,[value_]);},focus:function(){var $input=this.$('input:first');return $input.length?$input.select():false;}});var FieldCharDomain=common.AbstractField.extend(common.ReinitializeFieldMixin,{template:"FieldCharDomain",events:{'click button':'on_click','change .o_debug_input':function(e){this.set('value',$(e.target).val());}},init:function(){this._super.apply(this,arguments);this.debug=session.debug;},render_value:function(){var self=this;if(this.get('value')){var model=this.options.model||this.field_manager.get_field_value(this.options.model_field);var domain=pyeval.eval('domain',this.get('value'));var ds=new data.DataSetStatic(self,model,self.build_context());ds.call('search_count',[domain]).then(function(results){self.$('.o_count').text(results+_t(' selected records'));if(self.get('effective_readonly')){self.$('button').text(_t('See selection '));}
else{self.$('button').text(_t('Change selection '));}
self.$('button').append($("<span/>").addClass('fa fa-arrow-right'));});if(this.debug){this.$('.o_debug_input').val(this.get('value'));}}else{this.$('.o_count').text(_t('No selected record'));var $arrow=this.$('button span').detach();this.$('button').text(_('Select records ')).append($("<span/>").addClass('fa fa-arrow-right'));}},on_click:function(event){event.preventDefault();var self=this;var dialog=new common.DomainEditorDialog(this,{res_model:this.options.model||this.field_manager.get_field_value(this.options.model_field),default_domain:this.get('value'),title:this.get('effective_readonly')?_t('Selected records'):_t('Select records...'),readonly:this.get('effective_readonly'),disable_multiple_selection:this.get('effective_readonly'),no_create:this.get('effective_readonly'),on_selected:function(selected_ids){if(!self.get('effective_readonly')){self.set_value(dialog.get_domain(selected_ids));}}}).open();},});var FieldDatetime=common.AbstractField.extend(common.ReinitializeFieldMixin,{template:"FieldDatetime",build_widget:function(){return new datepicker.DateTimeWidget(this);},destroy_content:function(){if(this.datewidget){this.datewidget.destroy();this.datewidget=undefined;}},initialize_content:function(){if(!this.get("effective_readonly")){this.datewidget=this.build_widget();this.datewidget.on('datetime_changed',this,_.bind(function(){this.internal_set_value(this.datewidget.get_value());},this));this.datewidget.appendTo(this.$el);this.setupFocus(this.datewidget.$input);}},render_value:function(){if(!this.get("effective_readonly")){this.datewidget.set_value(this.get('value'));}else{this.$el.text(formats.format_value(this.get('value'),this,''));}},is_syntax_valid:function(){if(!this.get("effective_readonly")&&this.datewidget){return this.datewidget.is_valid();}
return true;},is_false:function(){return this.get('value')===''||this._super();},focus:function(){var input=this.datewidget&&this.datewidget.$input[0];return input?input.focus():false;},set_dimensions:function(height,width){this._super(height,width);if(!this.get("effective_readonly")){this.datewidget.$input.css('height',height);}}});var FieldDate=FieldDatetime.extend({template:"FieldDate",build_widget:function(){return new datepicker.DateWidget(this);}});var FieldText=common.AbstractField.extend(common.ReinitializeFieldMixin,{template:'FieldText',events:{'keyup':function(e){if(e.which===$.ui.keyCode.ENTER){e.stopPropagation();}},'keypress':function(e){if(e.which===$.ui.keyCode.ENTER){e.stopPropagation();}},'change textarea':'store_dom_value',},initialize_content:function(){if(!this.get("effective_readonly")){this.$textarea=this.$el.find('textarea');this.auto_sized=false;this.default_height=this.$textarea.css('height');if(this.default_height==='0px')this.default_height='90px';if(this.get("effective_readonly")){this.$textarea.attr('disabled','disabled');}
this.setupFocus(this.$textarea);}else{this.$textarea=undefined;}},commit_value:function(){if(!this.get("effective_readonly")&&this.$textarea){this.store_dom_value();}
return this._super();},store_dom_value:function(){this.internal_set_value(formats.parse_value(this.$textarea.val(),this));},render_value:function(){if(!this.get("effective_readonly")){var show_value=formats.format_value(this.get('value'),this,'');this.$textarea.val(show_value);dom_utils.autoresize(this.$textarea,{parent:this,min_height:parseInt(this.default_height)});}else{var txt=this.get("value")||'';this.$(".oe_form_text_content").text(txt);}},is_syntax_valid:function(){if(!this.get("effective_readonly")&&this.$textarea){try{formats.parse_value(this.$textarea.val(),this,'');return true;}catch(e){return false;}}
return true;},is_false:function(){return this.get('value')===''||this._super();},focus:function($el){var input=!this.get("effective_readonly")&&this.$textarea&&this.$textarea[0];return input?input.focus():false;},set_dimensions:function(height,width){this._super(height,width);if(!this.get("effective_readonly")&&this.$textarea){this.$textarea.css({width:width,minHeight:height});}},});var FieldBoolean=common.AbstractField.extend({template:'FieldBoolean',start:function(){var self=this;this.$checkbox=$("input",this.$el);this.setupFocus(this.$checkbox);this.$el.click(_.bind(function(){this.internal_set_value(this.$checkbox.is(':checked'));},this));var check_readonly=function(){self.$checkbox.prop('disabled',self.get("effective_readonly"));self.click_disabled_boolean();};this.on("change:effective_readonly",this,check_readonly);check_readonly.call(this);this._super.apply(this,arguments);},render_value:function(){this.$checkbox[0].checked=this.get('value');},focus:function(){var input=this.$checkbox&&this.$checkbox[0];return input?input.focus():false;},click_disabled_boolean:function(){var $disabled=this.$el.find('input[type=checkbox]:disabled');$disabled.each(function(){$(this).next('div').remove();$(this).closest("span").append($('<div class="boolean"></div>'));});}});var FieldBooleanButton=common.AbstractField.extend({className:'o_stat_info',init:function(){this._super.apply(this,arguments);switch(this.options["terminology"]){case"active":this.string_true=_t("Active");this.hover_true=_t("Deactivate");this.string_false=_t("Inactive");this.hover_false=_t("Activate");break;case"archive":this.string_true=_t("Not Archived");this.hover_true=_t("Archive");this.string_false=_t("Archived");this.hover_false=_t("Unarchive");break;default:this.string_true=_t("On");this.hover_true=_t("Switch Off");this.string_false=_t("Off");this.hover_false=_t("Switch On");}},render_value:function(){this._super();this.$el.html(QWeb.render("BooleanButton",{widget:this}));},is_false:function(){return false;},});var FieldProgressBar=common.AbstractField.extend(common.ReinitializeFieldMixin,{initialize_content:function(){if(this.progressbar){this.progressbar.destroy();}
this.progressbar=new ProgressBar(this,{readonly:this.get('effective_readonly'),edit_on_click:true,value:this.get('value')||0,});var self=this;this.progressbar.appendTo('<div>').done(function(){self.progressbar.$el.addClass(self.$el.attr('class'));self.replaceElement(self.progressbar.$el);self.progressbar.on('update',self,function(update){self.set('value',update.changed_value);});});},render_value:function(){this.progressbar.set_value(this.get('value'));},});var FieldPercentPie=common.AbstractField.extend({template:'FieldPercentPie',render_value:function(){var value=this.get('value'),formatted_value=Math.round(value||0)+'%',svg=this.$('svg')[0];svg.innerHTML="";nv.addGraph(function(){var width=42,height=42;var chart=nv.models.pieChart().width(width).height(height).margin({top:0,right:0,bottom:0,left:0}).donut(true).showLegend(false).showLabels(false).color(['#7C7BAD','#DDD']).donutRatio(0.62);chart.tooltip.enabled(false);d3.select(svg).datum([{'x':'value','y':value},{'x':'complement','y':100-value}]).transition().call(chart).attr('style','width: '+width+'px; height:'+height+'px;');d3.select(svg).append("text").attr({x:width/2,y:height/2+3,'text-anchor':'middle'}).style({"font-size":"10px","font-weight":"bold"}).text(formatted_value);return chart;});}});var FieldBarChart=common.AbstractField.extend({template:'FieldBarChart',render_value:function(){var value=JSON.parse(this.get('value'));var svg=this.$('svg')[0];svg.innerHTML="";nv.addGraph(function(){var width=34,height=34;var chart=nv.models.discreteBarChart().x(function(d){return d.tooltip;}).y(function(d){return d.value;}).width(width).height(height).margin({top:0,right:0,bottom:0,left:0}).showValues(false).transition(350).showXAxis(false).showYAxis(false);chart.tooltip.enabled(false);d3.select(svg).datum([{key:'values',values:value}]).transition().call(chart).attr('style','width: '+(width+4)+'px; height: '+(height+8)+'px;');nv.utils.windowResize(chart.update);return chart;});}});var FieldSelection=common.AbstractField.extend(common.ReinitializeFieldMixin,{template:'FieldSelection',events:{'change select':'store_dom_value',},init:function(field_manager,node){this._super(field_manager,node);this.set("value",false);this.set("values",[]);this.records_orderer=new utils.DropMisordered();this.field_manager.on("view_content_has_changed",this,function(){var domain=new data.CompoundDomain(this.build_domain()).eval();if(!_.isEqual(domain,this.get("domain"))){this.set("domain",domain);}});},initialize_field:function(){common.ReinitializeFieldMixin.initialize_field.call(this);this.on("change:domain",this,this.query_values);this.set("domain",new data.CompoundDomain(this.build_domain()).eval());this.on("change:values",this,this.render_value);},query_values:function(){var self=this;var def;if(this.field.type==="many2one"){var model=new Model(this.field.relation);def=model.call("name_search",['',this.get("domain")],{"context":this.build_context()});}else{var values=_.reject(this.field.selection,function(v){return v[0]===false&&v[1]==='';});def=$.when(values);}
this.records_orderer.add(def).then(function(values){if(!_.isEqual(values,self.get("values"))){self.set("values",values);}});},initialize_content:function(){var ischanging=false;var $select=this.$el.find('select').change(function(){ischanging=true;}).click(function(){ischanging=false;}).keyup(function(e){if(e.which!==13||!ischanging){return;}
e.stopPropagation();ischanging=false;});this.setupFocus($select);},commit_value:function(){this.store_dom_value();return this._super();},store_dom_value:function(){if(!this.get('effective_readonly')&&this.$('select').length){var val=JSON.parse(this.$('select').val());this.internal_set_value(val);}},set_value:function(value_){value_=value_===null?false:value_;value_=value_ instanceof Array?value_[0]:value_;this._super(value_);},render_value:function(){var values=this.get("values");values=[[false,this.node.attrs.placeholder||'']].concat(values);var found=_.find(values,function(el){return el[0]===this.get("value");},this);if(!found){found=[this.get("value"),_t('Unknown')];values=[found].concat(values);}
if(!this.get("effective_readonly")){this.$().html(QWeb.render("FieldSelectionSelect",{widget:this,values:values}));this.$("select").val(JSON.stringify(found[0]));}else{this.$el.text(found[1]);}},focus:function(){var input=this.$('select:first')[0];return input?input.focus():false;},set_dimensions:function(height,width){this._super(height,width);this.$('select').css({height:height,width:width});}});var TimezoneMismatch=FieldSelection.extend({initialize_content:function(){this._super.apply(this,arguments);this.tz_offset_field=(this.options&&this.options.tz_offset_field)||this.tz_offset_field||'tz_offset';this.set({"tz_offset":this.field_manager.get_field_value(this.tz_offset_field)});this.on("change:tz_offset",this,this.render_value);},start:function(){this._super.apply(this,arguments);this.field_manager.on("field_changed:"+this.tz_offset_field,this,function(){this.set({"tz_offset":this.field_manager.get_field_value(this.tz_offset_field)});});},check_timezone:function(){var user_offset=this.get('tz_offset');if(user_offset){var offset=-(new Date().getTimezoneOffset());var browser_offset=(offset<0)?"-":"+";browser_offset+=_.str.sprintf("%02d",Math.abs(offset/60));browser_offset+=_.str.sprintf("%02d",Math.abs(offset%60));return(browser_offset!==user_offset);}
return false;},render_value:function(){this._super.apply(this,arguments);if(this.check_timezone()){this.$label.find('.oe_tz_warning').remove();var options=_.extend({delay:{show:501,hide:0},title:_t("Timezone Mismatch : The timezone of your browser doesn't match the selected one. The time in Odoo is displayed according to your field timezone."),});this.$label.css('white-space','normal');$(QWeb.render('WebClient.timezone_warning')).appendTo(this.$label);this.$label.find('.oe_tz_warning').tooltip(options);}}});var LabelSelection=FieldSelection.extend({init:function(field_manager,node){this._super(field_manager,node);this.classes=this.options&&this.options.classes||{};},render_value:function(){this._super.apply(this,arguments);if(this.get("effective_readonly")){var btn_class=this.classes[this.get('value')]||'default';this.$el.wrapInner($('<span/>').addClass('label label-'+btn_class));}},});var FieldRadio=common.AbstractField.extend(common.ReinitializeFieldMixin,{template:'FieldRadio',events:{'click input':'click_change_value'},init:function(field_manager,node){this._super(field_manager,node);this.selection=_.clone(this.field.selection)||[];this.domain=false;this.uniqueId=_.uniqueId("radio");},initialize_content:function(){this.on("change:effective_readonly",this,this.render_value);this.field_manager.on("view_content_has_changed",this,this.get_selection);this.get_selection();},click_change_value:function(event){var val=$(event.target).val();val=this.field.type=="selection"?val:+val;if(val!==this.get_value()){this.set_value(val);}},get_selection:function(){var self=this;var selection=[];var def=$.Deferred();if(self.field.type=="many2one"){var domain=pyeval.eval('domain',this.build_domain())||[];if(!_.isEqual(self.domain,domain)){self.domain=domain;var ds=new data.DataSetStatic(self,self.field.relation,self.build_context());ds.call('search',[self.domain]).then(function(records){ds.name_get(records).then(function(records){selection=records;def.resolve();});});}else{selection=self.selection;def.resolve();}}
else if(self.field.type=="selection"){selection=self.field.selection||[];def.resolve();}
return def.then(function(){if(!_.isEqual(selection,self.selection)){self.selection=_.clone(selection);self.renderElement();self.render_value();}});},set_value:function(value_){if(this.field.type=="selection"){value_=_.find(this.field.selection,function(sel){return sel[0]==value_;});}
else if(!this.selection.length){this.selection=[value_];}
this._super(value_);},get_value:function(){var value=this.get('value');return((value instanceof Array)?value[0]:value)||false;},render_value:function(){var self=this;this.$el.toggleClass("oe_readonly",this.get('effective_readonly'));this.$("input").filter(function(){return this.value==self.get_value();}).prop("checked",true);this.$(".oe_radio_readonly").text(this.get('value')?this.get('value')[1]:"");}});var FieldReference=common.AbstractField.extend(common.ReinitializeFieldMixin,{template:'FieldReference',init:function(field_manager,node){this._super(field_manager,node);this.reference_ready=true;},destroy_content:function(){if(this.fm){this.fm.destroy();this.fm=undefined;}},initialize_content:function(){var self=this;var fm=new common.DefaultFieldManager(this);this.fm=fm;fm.extend_field_desc({"selection":{selection:this.field_manager.get_field_desc(this.name).selection,type:"selection",},"m2o":{relation:null,type:"many2one",},});this.selection=new FieldSelection(fm,{attrs:{name:'selection',modifiers:JSON.stringify({readonly:this.get('effective_readonly')}),}});this.selection.on("change:value",this,this.on_selection_changed);this.selection.appendTo(this.$(".oe_form_view_reference_selection"));this.selection.on('focused',null,function(){self.trigger('focused');}).on('blurred',null,function(){self.trigger('blurred');});var FieldMany2One=core.form_widget_registry.get('many2one');this.m2o=new FieldMany2One(fm,{attrs:{name:'Referenced Document',modifiers:JSON.stringify({readonly:this.get('effective_readonly')}),}});this.m2o.on("change:value",this,this.data_changed);this.m2o.appendTo(this.$(".oe_form_view_reference_m2o"));this.m2o.on('focused',null,function(){self.trigger('focused');}).on('blurred',null,function(){self.trigger('blurred');});},on_selection_changed:function(){if(this.reference_ready){this.internal_set_value([this.selection.get_value(),false]);this.render_value();}},data_changed:function(){if(this.reference_ready){this.internal_set_value([this.selection.get_value(),this.m2o.get_value()]);}},set_value:function(val){if(val){val=val.split(',');val[0]=val[0]||false;val[1]=val[0]?(val[1]?parseInt(val[1],10):val[1]):false;}
this._super(val||[false,false]);},get_value:function(){return this.get('value')[0]&&this.get('value')[1]?(this.get('value')[0]+','+this.get('value')[1]):false;},render_value:function(){this.reference_ready=false;if(!this.get("effective_readonly")){this.selection.set_value(this.get('value')[0]);}
this.m2o.field.relation=this.get('value')[0];this.m2o.set_value(this.get('value')[1]);this.m2o.do_toggle(!!this.get('value')[0]);this.reference_ready=true;},});var FieldBinary=common.AbstractField.extend(common.ReinitializeFieldMixin,{init:function(field_manager,node){var self=this;this._super(field_manager,node);this.binary_value=false;this.useFileAPI=!!window.FileReader;this.max_upload_size=25*1024*1024;if(!this.useFileAPI){this.fileupload_id=_.uniqueId('oe_fileupload');$(window).on(this.fileupload_id,function(){var args=[].slice.call(arguments).slice(1);self.on_file_uploaded.apply(self,args);});}},stop:function(){if(!this.useFileAPI){$(window).off(this.fileupload_id);}
this._super.apply(this,arguments);},initialize_content:function(){var self=this;this.$('input.o_form_input_file').change(this.on_file_change);this.$('button.oe_form_binary_file_save').click(this.on_save_as);this.$('.oe_form_binary_file_clear').click(this.on_clear);this.$('.oe_form_binary_file_edit').click(function(){self.$('input.o_form_input_file').click();});},on_file_change:function(e){var self=this;var file_node=e.target;if((this.useFileAPI&&file_node.files.length)||(!this.useFileAPI&&$(file_node).val()!=='')){if(this.useFileAPI){var file=file_node.files[0];if(file.size>this.max_upload_size){var msg=_t("The selected file exceed the maximum file size of %s.");this.do_warn(_t("File upload"),_.str.sprintf(msg,utils.human_size(this.max_upload_size)));return false;}
var filereader=new FileReader();filereader.readAsDataURL(file);filereader.onloadend=function(upload){var data=upload.target.result;data=data.split(',')[1];self.on_file_uploaded(file.size,file.name,file.type,data);};}else{this.$el.find('form.o_form_binary_form input[name=session_id]').val(this.session.session_id);this.$el.find('form.o_form_binary_form').submit();}
this.$el.find('.oe_form_binary_progress').show();this.$el.find('.oe_form_binary').hide();}},on_file_uploaded:function(size,name,content_type,file_base64){if(size===false){this.do_warn(_t("File Upload"),_t("There was a problem while uploading your file"));console.warn("Error while uploading file : ",name);}else{this.filename=name;this.on_file_uploaded_and_valid.apply(this,arguments);}
this.$el.find('.oe_form_binary_progress').hide();this.$el.find('.oe_form_binary').show();},on_file_uploaded_and_valid:function(size,name,content_type,file_base64){},on_save_as:function(ev){var value=this.get('value');if(!value){this.do_warn(_t("Save As..."),_t("The field is empty, there's nothing to save !"));ev.stopPropagation();}else{framework.blockUI();var c=crash_manager;var filename_fieldname=this.node.attrs.filename;var filename_field=this.view.fields&&this.view.fields[filename_fieldname];this.session.get_file({'url':'/web/content','data':{'model':this.view.dataset.model,'id':this.view.datarecord.id,'field':this.name,'filename_field':filename_fieldname,'filename':filename_field?filename_field.get('value'):null,'download':true,'data':utils.is_bin_size(value)?null:value,},'complete':framework.unblockUI,'error':c.rpc_error.bind(c)});ev.stopPropagation();return false;}},set_filename:function(value){var filename=this.node.attrs.filename;if(filename){var field=this.field_manager.fields[filename];if(field){field.set_value(value);field._dirty_flag=true;}}},on_clear:function(){if(this.get('value')!==false){this.binary_value=false;this.internal_set_value(false);}
return false;}});var FieldBinaryFile=FieldBinary.extend({template:'FieldBinaryFile',initialize_content:function(){this._super();if(this.get("effective_readonly")){var self=this;this.$el.find('a').click(function(ev){if(self.get('value')){self.on_save_as(ev);}
return false;});}},render_value:function(){var show_value;if(!this.get("effective_readonly")){if(this.node.attrs.filename){show_value=this.view.datarecord[this.node.attrs.filename]||'';}else{show_value=(this.get('value')!==null&&this.get('value')!==undefined&&this.get('value')!==false)?this.get('value'):'';}
this.$el.find('input').eq(0).val(show_value);}else{this.$el.find('a').toggle(!!this.get('value'));if(this.get('value')){show_value=_t("Download");if(this.view)
show_value+=" "+(this.view.datarecord[this.node.attrs.filename]||'');this.$el.find('a').text(show_value);}}},on_file_uploaded_and_valid:function(size,name,content_type,file_base64){this.binary_value=true;this.set_filename(name);this.internal_set_value(file_base64);var show_value=name+" ("+utils.human_size(size)+")";this.$el.find('input').eq(0).val(show_value);},on_clear:function(){this._super.apply(this,arguments);this.$el.find('input').eq(0).val('');this.set_filename('');},set_value:function(value_){var changed=value_!==this.get_value();this._super.apply(this,arguments);if(!changed){this.trigger("change:value",this,{oldValue:value_,newValue:value_});}}});var FieldBinaryImage=FieldBinary.extend({template:'FieldBinaryImage',placeholder:"/web/static/src/img/placeholder.png",render_value:function(){var self=this;var url;this.session=session;if(this.get('value')&&!utils.is_bin_size(this.get('value'))){url='data:image/png;base64,'+this.get('value');}else if(this.get('value')){var id=JSON.stringify(this.view.datarecord.id||null);var field=this.name;if(this.options.preview_image)
field=this.options.preview_image;url=session.url('/web/image',{model:this.view.dataset.model,id:id,field:field,unique:(this.view.datarecord.__last_update||'').replace(/[^0-9]/g,''),});}else{url=this.placeholder;}
var $img=$(QWeb.render("FieldBinaryImage-img",{widget:this,url:url}));$($img).click(function(e){if(self.view.get("actual_mode")=="view"){var $button=$(".oe_form_button_edit");$button.openerpBounce();e.stopPropagation();}});this.$el.find('> img').remove();this.$el.prepend($img);$img.load(function(){if(!self.options.size)
return;$img.css("max-width",""+self.options.size[0]+"px");$img.css("max-height",""+self.options.size[1]+"px");});$img.on('error',function(){$img.attr('src',self.placeholder);self.do_warn(_t("Image"),_t("Could not display the selected image."));});},on_file_uploaded_and_valid:function(size,name,content_type,file_base64){this.internal_set_value(file_base64);this.binary_value=true;this.render_value();this.set_filename(name);},on_clear:function(){this._super.apply(this,arguments);this.render_value();this.set_filename('');},set_value:function(value_){var changed=value_!==this.get_value();this._super.apply(this,arguments);if(!changed){this.trigger("change:value",this,{oldValue:value_,newValue:value_});}}});var FieldStatus=common.AbstractField.extend({template:"FieldStatus",init:function(field_manager,node){this._super(field_manager,node);this.options.clickable=this.options.clickable||(this.node.attrs||{}).clickable||false;this.options.visible=this.options.visible||(this.node.attrs||{}).statusbar_visible||false;this.set({value:false});this.selection={'unfolded':[],'folded':[]};this.set("selection",{'unfolded':[],'folded':[]});this.selection_dm=new utils.DropMisordered();this.dataset=new data.DataSetStatic(this,this.field.relation,this.build_context());},start:function(){this.field_manager.on("view_content_has_changed",this,this.calc_domain);this.calc_domain();this.on("change:value",this,this.get_selection);this.on("change:evaluated_selection_domain",this,this.get_selection);this.on("change:selection",this,function(){this.selection=this.get("selection");this.render_value();});this.get_selection();if(this.options.clickable){this.$el.on('click','li[data-id]',this.on_click_stage);}
if(this.$el.parent().is('header')){this.$el.after('<div class="oe_clear"/>');}
this._super();},set_value:function(value_){if(value_ instanceof Array){value_=value_[0];}
this._super(value_);},render_value:function(){var self=this;var content=QWeb.render("FieldStatus.content",{'widget':self,'value_folded':_.find(self.selection.folded,function(i){return i[0]===self.get('value');})});self.$el.html(content);},calc_domain:function(){var d=pyeval.eval('domain',this.build_domain());var domain=[];if(d.length){domain=['|',['id','=',this.get('value')]].concat(d);}
if(!_.isEqual(domain,this.get("evaluated_selection_domain"))){this.set("evaluated_selection_domain",domain);}},get_selection:function(){var self=this;var selection_unfolded=[];var selection_folded=[];var fold_field=this.options.fold_field;var calculation=_.bind(function(){if(this.field.type=="many2one"){return self.get_distant_fields().then(function(fields){return new data.DataSetSearch(self,self.field.relation,self.build_context(),self.get("evaluated_selection_domain")).read_slice(_.union(_.keys(self.distant_fields),['id']),{}).then(function(records){var ids=_.pluck(records,'id');return self.dataset.name_get(ids).then(function(records_name){_.each(records,function(record){var name=_.find(records_name,function(val){return val[0]==record.id;})[1];if(fold_field&&record[fold_field]&&record.id!=self.get('value')){selection_folded.push([record.id,name]);}else{selection_unfolded.push([record.id,name]);}});});});});}else{var select=this.field.selection;for(var i=0;i<select.length;i++){var key=select[i][0];if(key==this.get('value')||!this.options.visible||this.options.visible.indexOf(key)!=-1){selection_unfolded.push(select[i]);}}
return $.when();}},this);this.selection_dm.add(calculation()).then(function(){var selection={'unfolded':selection_unfolded,'folded':selection_folded};if(!_.isEqual(selection,self.get("selection"))){self.set("selection",selection);}});},get_distant_fields:function(){var self=this;if(!this.options.fold_field){this.distant_fields={};}
if(this.distant_fields){return $.when(this.distant_fields);}
return new Model(self.field.relation).call("fields_get",[[this.options.fold_field]]).then(function(fields){self.distant_fields=fields;return fields;});},on_click_stage:function(ev){var self=this;var $li=$(ev.currentTarget);var val;if(this.field.type=="many2one"){val=parseInt($li.data("id"),10);}
else{val=$li.data("id");}
if(val!=self.get('value')){this.view.recursive_save().done(function(){var change={};change[self.name]=val;self.view.dataset.write(self.view.datarecord.id,change).done(function(){self.view.reload();});});}},});var FieldMonetary=FieldFloat.extend({template:"FieldMonetary",widget_class:'oe_form_field_float oe_form_field_monetary',init:function(){this._super.apply(this,arguments);this.set({"currency":false});var currency_field=(this.options&&this.options.currency_field)||this.field.currency_field||'currency_id';if(currency_field){this.field_manager.on("field_changed:"+currency_field,this,function(){this.set({"currency":this.field_manager.get_field_value(currency_field)});});}
this.on("change:currency",this,this.get_currency_info);this.get_currency_info();},start:function(){var tmp=this._super();this.on("change:currency_info",this,this.update);return tmp;},get_currency_info:function(){var self=this;if(this.get("currency")===false){this.set({"currency_info":null});return;}
return self.set({"currency_info":session.get_currency(self.get("currency"))});},update:function(){if(this.view.options.is_list_editable){return;}else{return this.reinitialize();}},get_digits_precision:function(){return this.node.attrs.digits||this.field.digits||(this.get('currency_info')&&this.get('currency_info').digits);},parse_value:function(val,def){return formats.parse_value(val,{type:"float",digits:this.get_digits_precision()},def);},format_value:function(val,def){return formats.format_value(val,{type:"float",digits:this.get_digits_precision()},def);},});var StatInfo=common.AbstractField.extend({is_field_number:true,init:function(){this._super.apply(this,arguments);this.internal_set_value(0);},set_value:function(value_){if(value_===false||value_===undefined){value_=0;}
this._super.apply(this,[value_]);},render_value:function(){var options={value:this.get("value")||0,};if(!this.node.attrs.nolabel){if(this.options.label_field&&this.view.datarecord[this.options.label_field]){options.text=this.view.datarecord[this.options.label_field];}
else{options.text=this.string;}}
this.$el.html(QWeb.render("StatInfo",options));this.$el.addClass('o_stat_info');},});var FieldToggleBoolean=common.AbstractField.extend({render_value:function(){this.icon=this.get_value()?'gtk-yes.png':'gtk-normal.png';this.$el.html(QWeb.render("FieldToggleBoolean",{'widget':this}));this.$('.oe_toggle_button').on('click',this.set_toggle_button.bind(this));},set_toggle_button:function(){var self=this;var toggle_value=this.get_value()===false?true:false;if(this.view.get('actual_mode')=='view'){var rec_values={};rec_values[self.node.attrs.name]=toggle_value;return this.view.dataset._model.call('write',[[this.view.datarecord.id],rec_values,self.view.dataset.get_context()]).done(function(){self.reload_record();});}
else{this.set_value(toggle_value);}},reload_record:function(){this.view.reload();},});var AbstractFieldUpgrade={events:{'click input':'on_click_input',},start:function(){this._super.apply(this,arguments);this.get_enterprise_label().after($("<span>",{text:"Enterprise",'class':"label label-primary oe_inline"}));},open_dialog:function(){var message=$(QWeb.render('EnterpriseUpgrade'));var buttons=[{text:_t("Upgrade now"),classes:'btn-primary',close:true,click:this.confirm_upgrade,},{text:_t("Cancel"),close:true,},];return new Dialog(this,{size:'medium',buttons:buttons,$content:$('<div>',{html:message,}),title:_t("Odoo Enterprise"),}).open();},confirm_upgrade:function(){new Model("res.users").call("search_count",[[["share","=",false]]]).then(function(data){framework.redirect("https://www.odoo.com/odoo-enterprise/upgrade?num_users="+data);});},get_enterprise_label:function(){},on_click_input:function(){},};var UpgradeBoolean=FieldBoolean.extend(AbstractFieldUpgrade,{template:"FieldUpgradeBoolean",get_enterprise_label:function(){return this.$label;},on_click_input:function(event){if(this.$checkbox.prop("checked")){this.open_dialog().on('closed',this,function(){this.$checkbox.prop("checked",false);});}},});var UpgradeRadio=FieldRadio.extend(AbstractFieldUpgrade,{get_enterprise_label:function(){return this.$('label').last();},on_click_input:function(event){if($(event.target).val()==1){this.open_dialog().on('closed',this,function(){this.$('input').first().prop("checked",true);});}},});core.form_widget_registry.add('char',FieldChar).add('id',FieldID).add('email',FieldEmail).add('url',FieldUrl).add('text',FieldText).add('char_domain',FieldCharDomain).add('date',FieldDate).add('datetime',FieldDatetime).add('selection',FieldSelection).add('radio',FieldRadio).add('reference',FieldReference).add('boolean',FieldBoolean).add('boolean_button',FieldBooleanButton).add('toggle_button',FieldToggleBoolean).add('float',FieldFloat).add('percentpie',FieldPercentPie).add('barchart',FieldBarChart).add('integer',FieldFloat).add('float_time',FieldFloat).add('progressbar',FieldProgressBar).add('image',FieldBinaryImage).add('binary',FieldBinaryFile).add('statusbar',FieldStatus).add('monetary',FieldMonetary).add('priority',FieldPriority).add('kanban_state_selection',KanbanSelection).add('statinfo',StatInfo).add('timezone_mismatch',TimezoneMismatch).add('label_selection',LabelSelection).add('upgrade_boolean',UpgradeBoolean).add('upgrade_radio',UpgradeRadio);core.form_tag_registry.add('button',WidgetButton);return{FieldChar:FieldChar,FieldFloat:FieldFloat,FieldMonetary:FieldMonetary,WidgetButton:WidgetButton};});;

/* /web/static/src/js/views/form_relational_widgets.js defined in bundle 'web.assets_backend' */
odoo.define('web.form_relational',function(require){"use strict";var ControlPanel=require('web.ControlPanel');var core=require('web.core');var data=require('web.data');var Dialog=require('web.Dialog');var common=require('web.form_common');var FormView=require('web.FormView');var ListView=require('web.ListView');var Model=require('web.DataModel');var session=require('web.session');var utils=require('web.utils');var ViewManager=require('web.ViewManager');var formats=require('web.formats');var _t=core._t;var QWeb=core.qweb;var COMMANDS=common.commands;var list_widget_registry=core.list_widget_registry;var M2ODialog=Dialog.extend({template:"M2ODialog",init:function(parent){this.name=parent.string;this._super(parent,{title:_.str.sprintf(_t("Create a %s"),parent.string),size:'medium',buttons:[{text:_t('Create'),classes:'btn-primary',click:function(){if(this.$("input").val()!==''){this.getParent()._quick_create(this.$("input").val());this.close();}else{e.preventDefault();this.$("input").focus();}}},{text:_t('Create and edit'),classes:'btn-primary',close:true,click:function(){this.getParent()._search_create_popup("form",undefined,this.getParent()._create_context(this.$("input").val()));}},{text:_t('Cancel'),close:true}]});},start:function(){var text=_.str.sprintf(_t("You are creating a new %s, are you sure it does not exist yet?"),this.name);this.$("p").text(text);this.$("input").val(this.getParent().$input.val());},});var FieldMany2One=common.AbstractField.extend(common.CompletionFieldMixin,common.ReinitializeFieldMixin,{template:"FieldMany2One",events:{'keydown input':function(e){switch(e.which){case $.ui.keyCode.UP:case $.ui.keyCode.DOWN:e.stopPropagation();}},},init:function(field_manager,node){this._super(field_manager,node);common.CompletionFieldMixin.init.call(this);this.set({'value':false});this.display_value={};this.display_value_backup={};this.last_search=[];this.floating=false;this.current_display=null;this.is_started=false;this.ignore_focusout=false;},reinit_value:function(val){this.internal_set_value(val);this.floating=false;if(this.is_started&&!this.no_rerender){this.render_value();}},initialize_field:function(){this.is_started=true;core.bus.on('click',this,function(){if(!this.get("effective_readonly")&&this.$input.is(':visible')&&this.$input.autocomplete('widget').is(':visible')){this.$input.autocomplete("close");}});common.ReinitializeFieldMixin.initialize_field.call(this);},initialize_content:function(){if(!this.get("effective_readonly"))
this.render_editable();},destroy_content:function(){if(this.$dropdown){this.$dropdown.off('click');delete this.$dropdown;}
if(this.$input){this.$input.closest(".modal .modal-content").off('scroll');this.$input.off('keyup blur autocompleteclose autocompleteopen '+'focus focusout change keydown');delete this.$input;}
if(this.$follow_button){this.$follow_button.off('blur focus click');delete this.$follow_button;}},destroy:function(){this.destroy_content();return this._super();},init_error_displayer:function(){},hide_error_displayer:function(){},show_error_displayer:function(){new M2ODialog(this).open();},render_editable:function(){var self=this;this.$input=this.$el.find("input");this.init_error_displayer();self.$input.on('focus',function(){self.hide_error_displayer();});this.$dropdown=this.$el.find(".oe_m2o_drop_down_button");this.$follow_button=$(".oe_m2o_cm_button",this.$el);this.$follow_button.click(function(ev){ev.preventDefault();if(!self.get('value')){self.focus();return;}
var context=self.build_context().eval();var model_obj=new Model(self.field.relation);model_obj.call('get_formview_id',[self.get("value"),context]).then(function(view_id){var pop=new common.FormViewDialog(self,{res_model:self.field.relation,res_id:self.get("value"),context:self.build_context(),title:_t("Open: ")+self.string,view_id:view_id,readonly:!self.can_write}).open();pop.on('write_completed',self,function(){self.display_value={};self.display_value_backup={};self.render_value();self.focus();self.trigger('changed_value');});});});var input_changed=function(){if(self.current_display!==self.$input.val()){self.current_display=self.$input.val();if(self.$input.val()===""){self.internal_set_value(false);self.floating=false;}else{self.floating=true;}}};this.$input.keydown(input_changed);this.$input.change(input_changed);this.$dropdown.click(function(){self.$input.focus();if(self.$input.autocomplete("widget").is(":visible")){self.$input.autocomplete("close");}else{if(self.get("value")&&!self.floating){self.$input.autocomplete("search","");}else{self.$input.autocomplete("search");}}});var close_autocomplete=_.debounce(function(){if(self.$input.autocomplete("widget").is(":visible")){self.$input.autocomplete("close");}},50);this.$input.closest(".modal .modal-content").on('scroll',this,close_autocomplete);self.ed_def=$.Deferred();self.uned_def=$.Deferred();var ed_delay=200;var ed_duration=15000;var anyoneLoosesFocus=function(e){if(self.ignore_focusout){return;}
var used=false;if(self.floating){if(self.last_search.length>0){if(self.last_search[0][0]!=self.get("value")){self.display_value={};self.display_value_backup={};self.display_value[""+self.last_search[0][0]]=self.last_search[0][1];self.reinit_value(self.last_search[0][0]);self.last_search=[];}else{used=true;self.render_value();}}else{used=true;}
self.floating=false;}
var has_changed=(self.get("value")===false||self.display_value[""+self.get("value")]!==self.$input.val());if(used&&has_changed&&!self.no_ed&&!(self.options&&(self.options.no_create||self.options.no_quick_create))){self.ed_def.reject();self.uned_def.reject();self.ed_def=$.Deferred();self.ed_def.done(function(){self.can_create&&self.$input&&self.show_error_displayer();ignore_blur=false;self.trigger('focused');});ignore_blur=true;setTimeout(function(){self.ed_def.resolve();self.uned_def.reject();self.uned_def=$.Deferred();self.uned_def.done(function(){self.hide_error_displayer();});setTimeout(function(){self.uned_def.resolve();},ed_duration);},ed_delay);}else{self.no_ed=false;self.ed_def.reject();}};var ignore_blur=false;this.$input.on({focusout:anyoneLoosesFocus,focus:function(){self.trigger('focused');},autocompleteopen:function(){ignore_blur=true;},autocompleteclose:function(){setTimeout(function(){ignore_blur=false;},0);},blur:function(){if(ignore_blur){$(this).focus();return;}
if(_(self.getChildren()).any(function(child){return child instanceof common.ViewDialog;})){return;}
self.trigger('blurred');}});var isSelecting=false;this.$input.autocomplete({source:function(req,resp){self.get_search_result(req.term).done(function(result){resp(result);});},select:function(event,ui){isSelecting=true;var item=ui.item;if(item.id){self.display_value={};self.display_value_backup={};self.display_value[""+item.id]=item.name;self.reinit_value(item.id);}else if(item.action){item.action();self.trigger('focused');}
return false;},focus:function(e,ui){e.preventDefault();},autoFocus:true,html:true,minLength:0,delay:200,});this.$input.autocomplete("option","position",{my:"left top",at:"left bottom"});this.$input.autocomplete("widget").openerpClass();this.$input.keyup(function(e){if(e.which===13){if(isSelecting)
e.stopPropagation();}
if(e.which===40||e.which===38){e.stopPropagation();}
isSelecting=false;});this.setupFocus(this.$follow_button);},render_value:function(no_recurse){var self=this;if(!this.get("value")){this.display_string("");return;}
var display=this.display_value[""+this.get("value")];if(display){this.display_string(display);return;}
if(!no_recurse){var dataset=new data.DataSetStatic(this,this.field.relation,self.build_context());var def=this.alive(dataset.name_get([self.get("value")])).done(function(data){if(!data[0]){self.do_warn(_t("Render"),_t("No value found for the field "+self.field.string+" for value "+self.get("value")));return;}
self.display_value[""+self.get("value")]=data[0][1];self.render_value(true);}).fail(function(data,event){event.preventDefault();self.display_value[""+self.get("value")]=self.display_value_backup[""+self.get("value")];self.render_value(true);});if(this.view&&this.view.render_value_defs){this.view.render_value_defs.push(def);}}},display_string:function(str){var self=this;if(!this.get("effective_readonly")){this.$input.val(str.split("\n")[0]);this.current_display=this.$input.val();if(this.is_false()){this.$('.oe_m2o_cm_button').css({'display':'none'});}else{this.$('.oe_m2o_cm_button').css({'display':'inline'});}}else{var lines=_.escape(str).split("\n");var link="";var follow="";link=lines[0];follow=_.rest(lines).join("<br />");if(follow)
link+="<br />";var $link=this.$el.find('.oe_form_uri').unbind('mousedown').unbind('click').html(link);if(!this.options.no_open){this.$el.find('.oe_form_uri').on('mousedown',function(e){if(e.which===2){var context=self.build_context().eval();var model_obj=new Model(self.field.relation);model_obj.call('get_formview_action',[self.get("value"),context]).then(function(action){window.open('/web#id='+action.res_id+'&view_type=form&model='+action.res_model);return false;});return false;}});$link.click(function(ev){$('.modal-backdrop').remove();$('.modal').hide();var context=self.build_context().eval();var model_obj=new Model(self.field.relation);model_obj.call('get_formview_action',[self.get("value"),context]).then(function(action){if(ev.which==2){return null;}else{self.do_action(action);}});return false;});}
$(".oe_form_m2o_follow",this.$el).html(follow);}},set_value:function(value_){if(value_ instanceof Array){this.display_value={};this.display_value_backup={};if(!this.options.always_reload){this.display_value[""+value_[0]]=value_[1];}
else{this.display_value_backup[""+value_[0]]=value_[1];}
value_=value_[0];}
value_=value_||false;this.reinit_value(value_);},get_displayed:function(){return this.display_value[""+this.get("value")];},add_id:function(id){this.display_value={};this.display_value_backup={};this.reinit_value(id);},is_false:function(){return!this.get("value");},focus:function(){var input=!this.get('effective_readonly')&&this.$input&&this.$input[0];return input?input.focus():false;},_quick_create:function(){this.no_ed=true;this.ed_def.reject();return common.CompletionFieldMixin._quick_create.apply(this,arguments);},_search_create_popup:function(){this.no_ed=true;this.ed_def.reject();this.ignore_focusout=true;this.reinit_value(false);var res=common.CompletionFieldMixin._search_create_popup.apply(this,arguments);this.ignore_focusout=false;this.no_ed=false;return res;},set_dimensions:function(height,width){this._super(height,width);if(!this.get("effective_readonly")&&this.$input)
this.$input.css('height',height);}});var AbstractManyField=common.AbstractField.extend({init:function(field_manager,node){var self=this;this._super(field_manager,node);this.dataset=new X2ManyDataSet(this,this.field.relation,this.build_context());this.dataset.x2m=this;this.dataset.parent_view=this.view;this.dataset.child_name=this.name;this.set('value',[]);this.starting_ids=[];this.mutex=new utils.Mutex();this.view.on("load_record",this,this._on_load_record);this.dataset.on('dataset_changed',this,function(){var options=_.clone(_.last(arguments));if(!_.isObject(options)||_.isArray(options)){options={};}
if(!self.internal_dataset_changed&&!options.internal_dataset_changed){self.trigger("change:commands",options);}});this.on("change:commands",this,function(options){self._inhibit_on_change_flag=!!options._inhibit_on_change_flag;self.set({'value':self.dataset.ids.slice()});self._inhibit_on_change_flag=false;});},_on_load_record:function(record){this.starting_ids=[];if(record.id&&record[this.name]&&(!isNaN(record.id)||record.id.indexOf(this.dataset.virtual_id_prefix)===-1)){this.starting_ids=this.get('value').slice();}
this.trigger("load_record",record);},set_value:function(ids){ids=(ids||[]).slice();if(_.find(ids,function(id){return typeof(id)==="string";})){throw new Error("set_value of '"+this.name+"' must receive an list of ids without virtual ids.",ids);}
if(_.find(ids,function(id){return typeof(id)!=="number";})){return this.send_commands(ids,{'_inhibit_on_change_flag':this._inhibit_on_change_flag});}
this.dataset.reset_ids(ids);return $.when(this._super(ids));},internal_set_value:function(ids){if(_.isEqual(ids,this.get("value"))){return;}
var tmp=this.no_rerender;this.no_rerender=true;this.data_replace(ids.slice());this.no_rerender=tmp;},data_create:function(data,options){return this.send_commands([COMMANDS.create(data)],options);},data_update:function(id,data,options){return this.send_commands([COMMANDS.update(id,data)],options);},data_link:function(id,options){return this.send_commands([COMMANDS.link_to(id)],options);},data_link_multi:function(ids,options){return this.send_commands(_.map(ids,function(id){return COMMANDS.link_to(id);}),options);},data_delete:function(id){return this.send_commands([COMMANDS.delete(id)]);},data_forget:function(id){return this.send_commands([COMMANDS.forget(id)]);},data_replace:function(ids,options){return this.send_commands([COMMANDS.replace_with(ids)],options);},data_read:function(ids,fields,options){return this.dataset.read_ids(ids,fields,options);},send_commands:function(command_list,options){var self=this;var def=$.Deferred();var dataset=this.dataset;var res=true;options=options||{};var internal_options=_.extend({},options,{'internal_dataset_changed':true});_.each(command_list,function(command){self.mutex.exec(function(){var id=command[1];if(!id||_.isString(id)||_.isNumber(id)){switch(command[0]){case COMMANDS.CREATE:var data=_.clone(command[2]);delete data.id;return dataset.create(data,internal_options).then(function(id){dataset.ids.push(id);res=id;});case COMMANDS.UPDATE:return dataset.write(id,command[2],internal_options).then(function(){if(dataset.ids.indexOf(id)===-1){dataset.ids.push(id);res=id;}});case COMMANDS.FORGET:return dataset.unlink([id]);case COMMANDS.DELETE:return dataset.unlink([id]);case COMMANDS.LINK_TO:if(dataset.ids.indexOf(id)===-1){return dataset.add_ids([id],internal_options);}
return;case COMMANDS.DELETE_ALL:return dataset.reset_ids([]);case COMMANDS.REPLACE_WITH:dataset.ids=[];return dataset.alter_ids(command[2],internal_options);}}
throw new Error("send_commands to '"+self.name+"' receive a non command value."+"\n"+JSON.stringify(command_list));});});this.mutex.def.then(function(){self.trigger("change:commands",options);def.resolve(res);});return def;},get_value:function(){var self=this,is_one2many=this.field.type==="one2many",not_delete=this.options.not_delete,starting_ids=this.starting_ids.slice(),replace_with_ids=[],add_ids=[],command_list=[],id,index,record;_.each(this.get('value'),function(id){index=starting_ids.indexOf(id);if(index!==-1){starting_ids.splice(index,1);}
var record=self.dataset.get_cache(id);if(!_.isEmpty(record.changes)){var values=_.clone(record.changes);for(var k in values){if((values[k]instanceof Array)&&values[k].length===2&&typeof values[k][0]==="number"&&typeof values[k][1]==="string"){values[k]=values[k][0];}}
if(record.to_create){command_list.push(COMMANDS.create(values));}else{if(index===-1){command_list.push(COMMANDS.link_to(id));}
command_list.push(COMMANDS.update(record.id,values));}
return;}
if(!is_one2many||not_delete||self.dataset.delete_all){replace_with_ids.push(id);}else{command_list.push(COMMANDS.link_to(id));}});if((!is_one2many||not_delete||self.dataset.delete_all)&&(replace_with_ids.length||starting_ids.length)){_.each(command_list,function(command){if(command[0]===COMMANDS.UPDATE){replace_with_ids.push(command[1]);}});command_list.unshift(COMMANDS.replace_with(replace_with_ids));}
_.each(starting_ids,function(id){if(id.toString().match(data.BufferedDataSet.virtual_id_regex)){return;}
if(is_one2many&&!not_delete){command_list.push(COMMANDS.delete(id));}else if(is_one2many&&!self.dataset.delete_all){command_list.push(COMMANDS.forget(id));}});return command_list;},is_valid:function(){return this.mutex.def.state()==="resolved"&&this._super();},is_false:function(){return _(this.get('value')).isEmpty();},destroy:function(){this.view.off("load_record",this,this._on_load_record);this._super();}});var FieldX2Many=AbstractManyField.extend({multi_selection:false,disable_utility_classes:true,x2many_views:{},view_options:{},default_view:'tree',init:function(field_manager,node){this._super(field_manager,node);this.is_loaded=$.Deferred();this.initial_is_loaded=this.is_loaded;this.is_started=false;this.set_value([]);},start:function(){this._super.apply(this,arguments);this.$el.addClass('oe_form_field');var self=this;this.load_views();var destroy=function(){self.is_loaded=self.is_loaded.then(function(){self.viewmanager.destroy();return $.when(self.load_views()).done(function(){self.reload_current_view();});});};this.is_loaded.done(function(){self.on("change:effective_readonly",self,destroy);});this.view.on("on_button_cancel",this,destroy);this.is_started=true;this.reload_current_view();},load_views:function(){var self=this;var view_types=this.node.attrs.mode;view_types=!!view_types?view_types.split(","):[this.default_view];var views=[];_.each(view_types,function(view_type){if(!_.include(["list","tree","graph","kanban"],view_type)){throw new Error(_.str.sprintf(_t("View type '%s' is not supported in X2Many."),view_type));}
var view={view_id:false,view_type:view_type==="tree"?"list":view_type,options:{}};if(self.field.views&&self.field.views[view_type]){view.embedded_view=self.field.views[view_type];}
if(view.view_type==="list"){_.extend(view.options,{addable:null,selectable:self.multi_selection,sortable:true,import_enabled:false,deletable:true});if(self.get("effective_readonly")){_.extend(view.options,{deletable:null,reorderable:false,});}}else if(view.view_type==="kanban"){_.extend(view.options,{confirm_on_delete:false,});if(self.get("effective_readonly")){_.extend(view.options,{action_buttons:false,quick_creatable:false,creatable:false,read_only_mode:true,});}}
views.push(view);});this.views=views;this.viewmanager=new X2ManyViewManager(this,this.dataset,views,this.view_options,this.x2many_views);this.viewmanager.x2m=self;var def=$.Deferred().done(function(){self.initial_is_loaded.resolve();});this.viewmanager.on("controller_inited",self,function(view_type,controller){controller.x2m=self;if(view_type=="list"){if(self.get("effective_readonly")){controller.on('edit:before',self,function(e){e.cancel=true;});_(controller.columns).find(function(column){if(!(column instanceof list_widget_registry.get('field.handle'))){return false;}
column.modifiers.invisible=true;return true;});}}else if(view_type=="graph"){self.reload_current_view();}
def.resolve();});this.viewmanager.on("switch_mode",self,function(n_mode){$.when(self.commit_value()).done(function(){if(n_mode==="list"){$.async_when().done(function(){self.reload_current_view();});}});});$.async_when().done(function(){if(!self.isDestroyed()){self.viewmanager.appendTo(self.$el);}});return def;},reload_current_view:function(){var self=this;self.is_loaded=self.is_loaded.then(function(){var view=self.get_active_view();if(view.type==="list"){return view.controller.reload_content();}else if(view.controller.do_search){return view.controller.do_search(self.build_domain(),self.dataset.get_context(),[]);}},undefined);return self.is_loaded;},get_active_view:function(){return(this.viewmanager&&this.viewmanager.active_view);},set_value:function(value_){var self=this;this._super(value_).then(function(){if(self.is_started&&!self.no_rerender){return self.reload_current_view();}});},commit_value:function(){var view=this.get_active_view();if(view&&view.type==="list"&&view.controller.__focus){var def=$.Deferred();view.controller._on_blur_one2many().always(function(){def.resolve();});return def;}
return $.when(false);},is_syntax_valid:function(){var view=this.get_active_view();if(!view){return true;}
switch(this.viewmanager.active_view.type){case'form':return _(view.controller.fields).chain().invoke('is_valid').all(_.identity).value();case'list':return view.controller.is_valid();}
return true;},});var X2ManyDataSet=data.BufferedDataSet.extend({get_context:function(){this.context=this.x2m.build_context();var self=this;_.each(arguments,function(context){self.context.add(context);});return this.context;}});var X2ManyViewManager=ViewManager.extend({init:function(parent,dataset,views,flags,x2many_views){var flags=_.extend({},flags,{headless:false,search_view:false,action_buttons:true,pager:true,sidebar:false,});this.control_panel=new ControlPanel(parent,"X2ManyControlPanel");this.set_cp_bus(this.control_panel.get_bus());this._super(parent,dataset,views,flags);this.registry=core.view_registry.extend(x2many_views);},start:function(){this.control_panel.prependTo(this.$el);return this._super();},switch_mode:function(mode,unused){if(mode!=='form'){return this._super(mode,unused);}
var self=this;var id=self.x2m.dataset.index!==null?self.x2m.dataset.ids[self.x2m.dataset.index]:null;var pop=new common.FormViewDialog(this,{res_model:self.x2m.field.relation,res_id:id,context:self.x2m.build_context(),title:_t("Open: ")+self.x2m.string,create_function:function(data,options){return self.x2m.data_create(data,options);},write_function:function(id,data,options){return self.x2m.data_update(id,data,options).done(function(){self.x2m.reload_current_view();});},alternative_form_view:self.x2m.field.views?self.x2m.field.views.form:undefined,parent_view:self.x2m.view,child_name:self.x2m.name,read_function:function(ids,fields,options){return self.x2m.data_read(ids,fields,options);},form_view_options:{'not_interactible_on_create':true},readonly:self.x2m.get("effective_readonly")}).open();pop.on("elements_selected",self,function(){self.x2m.reload_current_view();});},});var X2ManyListView=ListView.extend({is_valid:function(){var self=this;if(!this.fields_view||!this.editable()){return true;}
if(_.isEmpty(this.records.records)){return true;}
var fields=this.editor.form.fields;var current_values={};_.each(fields,function(field){field._inhibit_on_change_flag=true;field.__no_rerender=field.no_rerender;field.no_rerender=true;current_values[field.name]=field.get('value');});var cached_records=_.filter(this.dataset.cache,function(item){return!_.isEmpty(item.values)&&!item.to_delete;});var valid=_.every(cached_records,function(record){_.each(fields,function(field){var value=record.values[field.name];field.set_value(_.isArray(value)&&_.isArray(value[0])?[COMMANDS.delete_all()].concat(value):value);});return _.every(fields,function(field){field.process_modifiers();field._check_css_flags();return field.is_valid();});});_.each(fields,function(field){field.set('value',current_values[field.name],{silent:true});field._inhibit_on_change_flag=false;field.no_rerender=field.__no_rerender;});return valid;},});var X2ManyList=ListView.List.extend({pad_table_to:function(count){if(!this.view.is_action_enabled('create')||this.view.x2m.get('effective_readonly')){this._super(count);return;}
this._super(count>0?count-1:0);var self=this;var columns=_(this.columns).filter(function(column){return column.invisible!=='1';}).length;if(this.options.selectable){columns++;}
if(this.options.deletable){columns++;}
var $cell=$('<td>',{colspan:columns,'class':'oe_form_field_x2many_list_row_add'}).append($('<a>',{href:'#'}).text(_t("Add an item")).click(function(e){e.preventDefault();e.stopPropagation();if(self.view.editor.form.__blur_timeout){clearTimeout(self.view.editor.form.__blur_timeout);self.view.editor.form.__blur_timeout=false;}
self.view.save_edition().done(function(){self.view.do_add_record();});}));var $padding=this.$current.find('tr:not([data-id]):first');var $newrow=$('<tr>').append($cell);if($padding.length){$padding.before($newrow);}else{this.$current.append($newrow);}},});var One2ManyListView=X2ManyListView.extend({_template:'One2Many.listview',init:function(parent,dataset,view_id,options){var self=this;this._super(parent,dataset,view_id,_.extend(options||{},{GroupsType:One2ManyGroups,ListType:X2ManyList}));this.on('edit:after',this,this.proxy('_after_edit'));this.on('save:before cancel:before',this,this.proxy('_before_unedit'));core.bus.on('click',this,this._on_click_outside);this.dataset.on('dataset_changed',this,function(){this._dataset_changed=true;});this.dataset.x2m.on('load_record',this,function(){this._dataset_changed=false;});},do_add_record:function(){if(this.editable()){this._super.apply(this,arguments);}else{var self=this;new common.SelectCreateDialog(this,{res_model:self.x2m.field.relation,domain:self.x2m.build_domain(),context:self.x2m.build_context(),title:_t("Create: ")+self.x2m.string,initial_view:"form",alternative_form_view:self.x2m.field.views?self.x2m.field.views.form:undefined,create_function:function(data,options){return self.x2m.data_create(data,options);},read_function:function(ids,fields,options){return self.x2m.data_read(ids,fields,options);},parent_view:self.x2m.view,child_name:self.x2m.name,form_view_options:{'not_interactible_on_create':true},on_selected:function(){self.x2m.reload_current_view();}}).open();}},do_activate_record:function(index,id){var self=this;new common.FormViewDialog(self,{res_model:self.x2m.field.relation,res_id:id,context:self.x2m.build_context(),title:_t("Open: ")+self.x2m.string,write_function:function(id,data,options){return self.x2m.data_update(id,data,options).done(function(){self.x2m.reload_current_view();});},alternative_form_view:self.x2m.field.views?self.x2m.field.views.form:undefined,parent_view:self.x2m.view,child_name:self.x2m.name,read_function:function(ids,fields,options){return self.x2m.data_read(ids,fields,options);},form_view_options:{'not_interactible_on_create':true},readonly:!this.is_action_enabled('edit')||self.x2m.get("effective_readonly")}).open();},do_button_action:function(name,id,callback){if(!_.isNumber(id)){this.do_warn(_t("Action Button"),_t("The o2m record must be saved before an action can be used"));return;}
var parent_form=this.x2m.view;var self=this;this.save_edition().then(function(){if(parent_form){return parent_form.save();}else{return $.when();}}).done(function(){var ds=self.x2m.dataset;var changed_records=_.find(ds.cache,function(record){return record.to_create||record.to_delete||!_.isEmpty(record.changes);});if(!self.x2m.options.reload_on_button&&!changed_records){var promise=self.handle_button(name,id,callback);promise.always(function(){self.x2m.view.reload();});}else{self.handle_button(name,id,function(){self.x2m.view.reload();});}});},start_edition:function(record,options){if(!this.__focus){this._on_focus_one2many();}
return this._super(record,options);},reload_content:function(){var self=this;if(self.__focus){self._on_blur_one2many();return this._super().then(function(){var record_being_edited=self.records.get(self.editor.form.datarecord.id);if(record_being_edited){self.start_edition(record_being_edited);}});}
return this._super();},_on_focus_one2many:function(){if(!this.editor.is_editing()){return;}
this.dataset.x2m.internal_dataset_changed=true;this._dataset_changed=false;this.__focus=true;},_on_click_outside:function(e){if(this.__ignore_blur||!this.editor.is_editing()){return;}
var $target=$(e.target);var click_outside=($target.closest('.ui-autocomplete,.btn,.modal-backdrop').length===0);var $o2m=$target.closest(".oe_list_editable");if($o2m.length&&$o2m[0]===this.el){click_outside=false;}
var $modal=$target.closest(".modal");if($modal.length){var $currentModal=this.$el.closest(".modal");if($currentModal.length===0||$currentModal[0]!==$modal[0]){click_outside=false;}}
if(click_outside){this._on_blur_one2many();}},_on_blur_one2many:function(){if(this.__ignore_blur){return $.when();}
this.__ignore_blur=true;this.__focus=false;this.dataset.x2m.internal_dataset_changed=false;var self=this;return this.save_edition().done(function(){if(self._dataset_changed){self.dataset.trigger('dataset_changed');}}).always(function(){self.__ignore_blur=false;});},_after_edit:function(){this.editor.form.on('blurred',this,this._on_blur_one2many);this.editor.form.widgetFocused();},_before_unedit:function(){this.editor.form.off('blurred',this,this._on_blur_one2many);},do_delete:function(ids){var confirm=window.confirm;window.confirm=function(){return true;};try{return this._super(ids);}finally{window.confirm=confirm;}},reload_record:function(record,options){if(!options||!options.do_not_evict){this.dataset.evict_record(record.get('id'));}
return this._super(record);},setup_columns:function(fields,grouped){var self=this;var ret=this._super(fields,grouped);_.each(this.columns,function(col){if(col.column_invisible){var fm=self.getParent().getParent()._ic_field_manager;var set_col_invisible=function(){var invisible=fm.compute_domain(py.eval(col.column_invisible));var index=self.$('[data-id='+col.name+']').index()+1;if(invisible){self.$('td:nth-child('+index+'),th:nth-child('+index+')').hide();}else{self.$('td:nth-child('+index+'),th:nth-child('+index+')').show();}}
self.on('view_list_rendered',self,set_col_invisible);fm.on('view_content_has_changed',fm,set_col_invisible);}})
return ret;},});var One2ManyGroups=ListView.Groups.extend({setup_resequence_rows:function(){if(!this.view.x2m.get('effective_readonly')){this._super.apply(this,arguments);}}});var One2ManyFormView=FormView.extend({form_template:'One2Many.formview',init:function(parent,dataset,view_id,options){options.action_buttons=false;var self=this;this._super(parent,dataset,view_id,options);parent.on('switch_mode:list',this,function(){self.save();});this.dataset.x2m.on('load_record',this,function(){this.reload();});this.has_been_loaded.done(function(){self.check_actual_mode();});core.bus.on('act_next',this,this.on_act_next);},on_act_next:function(model){if(this.model!=model){return;}
this.execute_pager_action('next');parent=this.getParent();while(parent.reload==undefined){parent=parent.getParent();}
parent.reload();},load_form:function(data){this._super(data);var self=this;this.$buttons&&this.$buttons.find('button.oe_form_button_create').click(function(){self.save().done(self.on_button_new);});},do_notify_change:function(){if(this.dataset.parent_view){this.dataset.parent_view.do_notify_change();}else{this._super.apply(this,arguments);}},destroy:function(){core.bus.off('act_next',this,this.on_act_next);this.save();}});var FieldOne2Many=FieldX2Many.extend({init:function(){this._super.apply(this,arguments);this.x2many_views={form:One2ManyFormView,kanban:core.view_registry.get('one2many_kanban'),list:One2ManyListView,};},start:function(){this.$el.addClass('oe_form_field_one2many');return this._super.apply(this,arguments);},before_save:function(){if(this.viewmanager.active_view.type==="list"&&this.viewmanager.active_view.controller.editable()){return this.viewmanager.active_view.controller.save_edition();}
return $.when();},});var Many2ManyListView=X2ManyListView.extend({init:function(parent,dataset,view_id,options){this._super(parent,dataset,view_id,_.extend(options||{},{ListType:X2ManyList,}));},do_add_record:function(){var self=this;new common.SelectCreateDialog(this,{res_model:this.model,domain:new data.CompoundDomain(this.x2m.build_domain(),["!",["id","in",this.x2m.dataset.ids]]),context:this.x2m.build_context(),title:_t("Add: ")+this.x2m.string,alternative_form_view:this.x2m.field.views?this.x2m.field.views.form:undefined,no_create:this.x2m.options.no_create,on_selected:function(element_ids){return self.x2m.data_link_multi(element_ids).then(function(){self.x2m.reload_current_view();});}}).open();},do_activate_record:function(index,id){var self=this;var pop=new common.FormViewDialog(this,{res_model:this.dataset.model,res_id:id,context:this.x2m.build_context(),title:_t("Open: ")+this.x2m.string,alternative_form_view:this.x2m.field.views?this.x2m.field.views.form:undefined,readonly:!this.is_action_enabled('edit')||self.x2m.get("effective_readonly"),}).open();pop.on('write_completed',self,function(){self.dataset.evict_record(id);self.reload_content();});},do_button_action:function(name,id,callback){var self=this;var _sup=_.bind(this._super,this);if(!this.x2m.options.reload_on_button){return _sup(name,id,callback);}else{return this.x2m.view.save().then(function(){return _sup(name,id,function(){self.x2m.view.reload();});});}},});var FieldMany2Many=FieldX2Many.extend({init:function(){this._super.apply(this,arguments);this.x2many_views={list:Many2ManyListView,kanban:core.view_registry.get('many2many_kanban'),};},start:function(){this.$el.addClass('oe_form_field_many2many');return this._super.apply(this,arguments);}});var FieldMany2ManyKanban=FieldMany2Many.extend({default_view:'kanban',init:function(){this._super.apply(this,arguments);this.view_options=_.extend({},this.view_options,{'create_text':_t("Add"),});}});var FieldMany2ManyTags=AbstractManyField.extend(common.CompletionFieldMixin,common.ReinitializeFieldMixin,{className:"oe_form_field o_form_field_many2manytags",tag_template:"FieldMany2ManyTag",events:{'click .o_delete':function(e){this.remove_id($(e.target).parent().data('id'));},'click .badge':'open_color_picker','mousedown .o_colorpicker span':'update_color','focusout .o_colorpicker':'close_color_picker',},init:function(field_manager,node){this._super(field_manager,node);common.CompletionFieldMixin.init.call(this);this.set({"value":[]});this._display_orderer=new utils.DropMisordered();var self=this;this.mutex.exec(function(){return self.dataset.call('fields_get',[]).then(function(fields){self.fields=fields;});});},initialize_content:function(){if(!this.get("effective_readonly")){this.many2one=new FieldMany2One(this.field_manager,this.node);this.many2one.options.no_open=true;this.many2one.on('changed_value',this,function(){var newValue=this.many2one.get('value');if(newValue){this.add_id(newValue);this.many2one.set({'value':false});}});this.many2one.prependTo(this.$el);var self=this;this.many2one.$('input').on('keydown',function(e){if(!$(e.target).val()&&e.which===8){var $badges=self.$('.badge');if($badges.length){self.remove_id($badges.last().data('id'));}}});this.many2one.get_search_blacklist=function(){return self.get('value');};}},destroy_content:function(){if(this.many2one){this.many2one.destroy();this.many2one=undefined;}},get_render_data:function(ids){var self=this;return this.mutex.exec(function(){var fields=self.fields.color?['display_name','name','color']:['display_name','name'];return self.dataset.read_ids(ids,fields);});},render_tag:function(data){this.$('.badge').remove();this.$el.prepend(QWeb.render(this.tag_template,{elements:data,readonly:this.get('effective_readonly')}));},render_value:function(){var self=this;var values=self.get("value");var handle_names=function(data){if(self.isDestroyed())
return;var indexed={};_.each(data,function(el){indexed[el['id']]=el;});data=_.map(values,function(el){return indexed[el];});self.render_tag(data);};if(!values||values.length>0){return this._display_orderer.add(self.get_render_data(values)).done(handle_names);}else{handle_names([]);}},add_id:function(id){this.set({'value':_.uniq(this.get('value').concat([id]))});},remove_id:function(id){this.set({'value':_.without(this.get("value"),id)});},focus:function(){if(!this.get("effective_readonly")){return this.many2one.focus();}
return false;},set_dimensions:function(height,width){this._super(height,width);var $input=this.$('input');if(!this.get("effective_readonly")&&$input){$input.css('height',height);}},open_color_picker:function(ev){this.mutex.exec(function(){if(this.fields.color){this.$color_picker=$(QWeb.render('FieldMany2ManyTag.colorpicker',{'widget':this,'tag_id':$(ev.currentTarget).data('id'),}));$(ev.currentTarget).append(this.$color_picker);this.$color_picker.dropdown('toggle');this.$color_picker.attr("tabindex",1).focus();}}.bind(this));},close_color_picker:function(){this.$color_picker.remove();},update_color:function(ev){ev.preventDefault();var color=$(ev.currentTarget).data('color');var id=$(ev.currentTarget).data('id');var self=this;this.dataset.call('write',[id,{'color':color}]).done(function(){self.dataset.cache[id].from_read={};self.dataset.evict_record(id);var tag=self.$el.find("span.badge[data-id='"+id+"']");var old_color=tag.data('color');tag.removeClass('o_tag_color_'+old_color);tag.data('color',color);tag.addClass('o_tag_color_'+color);});},});var FieldMany2ManyBinaryMultiFiles=AbstractManyField.extend(common.ReinitializeFieldMixin,{template:"FieldBinaryFileUploader",init:function(field_manager,node){this._super(field_manager,node);this.field_manager=field_manager;this.node=node;this.session=session;if(this.field.type!="many2many"||this.field.relation!='ir.attachment'){throw _.str.sprintf(_t("The type of the field '%s' must be a many2many field with a relation to 'ir.attachment' model."),this.field.string);}
this.data={};this.set_value([]);this.ds_file=new data.DataSetSearch(this,'ir.attachment');this.fileupload_id=_.uniqueId('oe_fileupload_temp');$(window).on(this.fileupload_id,_.bind(this.on_file_loaded,this));},initialize_content:function(){this.$el.on('change','input.o_form_input_file',this.on_file_change);},get_file_url:function(attachment){return'/web/content/'+attachment.id+'?download=true';},read_name_values:function(){var self=this;var ids=this.get('value');var _value=_.filter(ids,function(id){return typeof self.data[id]=='undefined';});if(_value.length){return this.ds_file.call('read',[_value,['id','name','datas_fname','mimetype']]).then(function(datas){_.each(datas,function(data){data.no_unlink=true;data.url=self.get_file_url(data);self.data[data.id]=data;});return ids;});}else{return $.when(ids);}},render_value:function(){var self=this;this.read_name_values().then(function(ids){var render=$(QWeb.render('FieldBinaryFileUploader.files',{'widget':self,'values':ids}));render.on('click','.oe_delete',_.bind(self.on_file_delete,self));self.$('.oe_placeholder_files, .oe_attachments').replaceWith(render);var $input=self.$('input.o_form_input_file');$input.after($input.clone(true)).remove();self.$(".oe_fileupload").show();self.$(".o_image[data-mimetype^='image']").each(function(){var $img=$(this);if(/gif|jpe|jpg|png/.test($img.data('mimetype'))&&$img.data('src')){$img.css('background-image',"url('"+$img.data('src')+"')");}});});},on_file_change:function(event){event.stopPropagation();var self=this;var $target=$(event.target);if($target.val()!==''){var filename=$target.val().replace(/.*[\\\/]/,'');if(self.data[0]&&self.data[0].upload){return false;}
for(var id in this.get('value')){if(self.data[id]&&(self.data[id].filename||self.data[id].name)==filename&&!self.data[id].no_unlink){self.ds_file.unlink([id]);}}
if(this.node.attrs.blockui>0){framework.blockUI();}
this.$('form.o_form_binary_form').submit();this.$(".oe_fileupload").hide();this.data[0]={'id':0,'name':filename,'filename':filename,'url':'','upload':true};}},on_file_loaded:function(event,result){var files=this.get('value');if(this.node.attrs.blockui>0){framework.unblockUI();}
if(result.error||!result.id){this.do_warn(_t('Uploading Error'),result.error);delete this.data[0];}else{if(this.data[0]&&this.data[0].filename==result.filename&&this.data[0].upload){delete this.data[0];}
result.url=this.get_file_url(result);this.data[result.id]=result;var values=_.clone(this.get('value'));values.push(result.id);this.set({'value':values});}
this.render_value();},on_file_delete:function(event){event.stopPropagation();var file_id=$(event.target).closest('.oe_delete').data("id");if(file_id){var files=_.filter(this.get('value'),function(id){return id!=file_id;});if(!this.data[file_id].no_unlink){this.ds_file.unlink([file_id]);}
this.set({'value':files});}},});var FieldMany2ManyCheckBoxes=AbstractManyField.extend(common.ReinitializeFieldMixin,{className:"oe_form_many2many_checkboxes",init:function(){this._super.apply(this,arguments);this.set("records",[]);this.field_manager.on("view_content_has_changed",this,function(){var domain=new data.CompoundDomain(this.build_domain()).eval();if(!_.isEqual(domain,this.get("domain"))){this.set("domain",domain);}});this.records_orderer=new utils.DropMisordered();},initialize_field:function(){common.ReinitializeFieldMixin.initialize_field.call(this);this.on("change:domain",this,this.query_records);this.set("domain",new data.CompoundDomain(this.build_domain()).eval());this.on("change:records",this,this.render_value);},query_records:function(){var self=this;var model=new Model(this.field.relation);this.records_orderer.add(model.call("search",[this.get("domain")],{"context":this.build_context()}).then(function(record_ids){return model.call("name_get",[record_ids],{"context":self.build_context()});})).then(function(res){self.set("records",res);});},render_value:function(){this.$().html(QWeb.render("FieldMany2ManyCheckBoxes",{widget:this}));var inputs=this.$("input");inputs.change(_.bind(this.from_dom,this));if(this.get("effective_readonly"))
inputs.attr("disabled","true");},from_dom:function(){var new_value=this.$("input:checked").map(function(){return+$(this).data("record-id");}).get();if(!_.isEqual(new_value,this.get("value"))){this.internal_set_value(new_value);}}});core.form_widget_registry.add('many2one',FieldMany2One).add('many2many',FieldMany2Many).add('many2many_tags',FieldMany2ManyTags).add('many2many_kanban',FieldMany2ManyKanban).add('one2many',FieldOne2Many).add('one2many_list',FieldOne2Many).add('many2many_binary',FieldMany2ManyBinaryMultiFiles).add('many2many_checkboxes',FieldMany2ManyCheckBoxes);return{FieldMany2ManyTags:FieldMany2ManyTags,AbstractManyField:AbstractManyField,};});;

/* /web/static/src/js/views/list_view_editable.js defined in bundle 'web.assets_backend' */
odoo.define('web.ListEditor',function(require){"use strict";var core=require('web.core');var data=require('web.data');var FormView=require('web.FormView');var common=require('web.list_common');var ListView=require('web.ListView');var utils=require('web.utils');var Widget=require('web.Widget');var _t=core._t;var Editor=Widget.extend({init:function(parent,options){this._super(parent);this.options=options||{};_.defaults(this.options,{formView:FormView,delegate:this.getParent(),});this.delegate=this.options.delegate;this.record=null;this.form=new(this.options.formView)(this,this.delegate.dataset,false,{initial_mode:'edit',is_list_editable:true,disable_autofocus:true,$buttons:$(),$pager:$(),});},start:function(){var self=this;this.form.embedded_view=this._validate_view(this.delegate.edition_view(this));return $.when(this._super(),this.form.appendTo($('<div/>')).then(function(){self.form.$el.addClass(self.$el.attr('class'));self.replaceElement(self.form.$el);}).done(this.proxy('do_hide')));},_validate_view:function(edition_view){if(!edition_view){throw new Error("editor delegate's #edition_view must return a view descriptor");}
var arch=edition_view.arch;if(!(arch&&arch.children instanceof Array)){throw new Error("Editor delegate's #edition_view must have a non-empty arch");}
if(arch.tag!=="form"){throw new Error("Editor delegate's #edition_view must have a 'form' root node");}
if(!(arch.attrs&&arch.attrs.version==="7.0")){throw new Error("Editor delegate's #edition_view must be a version 7 view");}
if(!/\boe_form_container\b/.test(arch.attrs['class'])){throw new Error("Editor delegate's #edition_view must have the class "+"'boe_form_container' on its root element");}
return edition_view;},is_editing:function(){return!!this.record;},is_creating:function(){return(this.is_editing()&&!this.record.id);},edit:function(record,configureField,options){var loaded;if(record){loaded=this.form.trigger('load_record',_.extend({},record))}else{loaded=this.form.load_defaults();}
var self=this;return $.when(loaded).then(function(){return self.do_show({reload:false});}).then(function(){self.record=self.form.datarecord;_(self.form.fields).each(function(field,name){configureField(name,field);});return self.form;});},save:function(){var self=this;return this.form.save(this.delegate.prepends_on_create()).then(function(result){if(result.created&&!self.record.id){self.record.id=result.result;}
return self.record;});},cancel:function(force){var self=this;if(force){return do_cancel();}
var message=_t("The line has been modified, your changes will be discarded. Are you sure you want to discard the changes ?");return this.form.can_be_discarded(message).then(do_cancel);function do_cancel(){var record=self.record;self.record=null;self.do_hide();return $.when(record);}},do_hide:function(){this.form.do_hide.apply(this.form,arguments);this.form.set({display_invalid_fields:false});},do_show:function(){this.form.do_show.apply(this.form,arguments);},});ListView.prototype.defaults.editable=null;ListView.include({init:function(){var self=this;this._super.apply(this,arguments);this.saving_mutex=new utils.Mutex();this._force_editability=null;this._context_editable=false;this.editor=new Editor(this);this.fields_for_resize=[];core.bus.on('resize',this,this.resize_fields);$(this.groups).bind({'edit':function(e,id,dataset){self.do_edit(dataset.index,id,dataset);},'saved':function(){if(self.groups.get_selection().length){return;}
self.configure_pager(self.dataset);self.compute_aggregates();}});this.records.bind('remove',function(){if(self.editor.is_editing()){self.cancel_edition();}});this.on('edit:before',this,function(event){if(!self.editable()||self.editor.is_editing()){event.cancel=true;}});this.on('edit:after',this,function(){self.$el.add(self.$buttons).addClass('oe_editing');self.$('.ui-sortable').sortable('disable');});this.on('save:after cancel:after',this,function(){self.$('.ui-sortable').sortable('enable');self.$el.add(self.$buttons).removeClass('oe_editing');});},destroy:function(){core.bus.off('resize',this,this.resize_fields);this._super();},do_hide:function(){if(this.editor.is_editing()){this.cancel_edition(true);}
this._super();},sort_by_column:function(e){e.stopPropagation();if(!this.editor.is_editing()){this._super.apply(this,arguments);}},do_edit:function(index,id,dataset){_.extend(this.dataset,dataset);},do_delete:function(ids){var nonfalse=_.compact(ids);var _super=this._super.bind(this);var next=(this.editor.is_editing())?this.cancel_edition(true):$.when();return next.then(function(){return _super(nonfalse);});},editable:function(){return!this.grouped&&!this.options.disable_editable_mode&&(this.fields_view.arch.attrs.editable||this._context_editable||this.options.editable);},do_search:function(domain,context,group_by){var self=this;var _super=this._super;var args=arguments;var ready=(this.editor.is_editing())?this.cancel_edition(true):$.when();return ready.then(function(){self._context_editable=!!context.set_editable;return _super.apply(self,args);});},do_add_record:function(){if(this.editable()){this.$('table:first').show();this.$('.oe_view_nocontent').remove();this.start_edition();}else{this._super.apply(this,arguments);}},load_list:function(data,grouped){var result=this._super.apply(this,arguments);this.editor.destroy();this.editor=new Editor(this);if(this.editable()){this.$el.addClass('oe_list_editable');return $.when(result,this.editor.prependTo(this.$el).done(this.proxy('setup_events')));}else{this.$el.removeClass('oe_list_editable');}
return result;},render_buttons:function(){var add_button=!this.$buttons;var result=this._super.apply(this,arguments);if(add_button&&(this.editable()||this.grouped)){var self=this;this.$buttons.off('click','.o_list_button_save').on('click','.o_list_button_save',this.proxy('save_edition')).off('click','.o_list_button_discard').on('click','.o_list_button_discard',function(e){e.preventDefault();self.cancel_edition();});}
return result;},do_button_action:function(name,id,callback){var self=this;this.save_edition().done(function(data){if(!id&&data.created){id=data.record.get('id');}
self.handle_button(name,id,callback);});},make_empty_record:function(id){var attrs={id:id};_(this.columns).chain().filter(function(x){return x.tag==='field';}).pluck('name').each(function(field){attrs[field]=false;});return new common.Record(attrs);},start_edition:function(record,options){var self=this;var item=false;if(record){item=record.attributes;this.dataset.select_id(record.get('id'));}else{record=this.make_empty_record(false);this.records.add(record,{at:(this.prepends_on_create())?0:null});}
return this.save_edition().then(function(){return $.when.apply($,self.editor.form.render_value_defs);}).then(function(){var $recordRow=self.groups.get_row_for(record);var cells=self.get_cells_for($recordRow);var fields={};self.fields_for_resize.splice(0,self.fields_for_resize.length);return self.with_event('edit',{record:record.attributes,cancel:false,},function(){return self.editor.edit(item,function(field_name,field){var cell=cells[field_name];if(!cell){return;}
field.$el.attr('data-fieldname',field_name);fields[field_name]=field;self.fields_for_resize.push({field:field,cell:cell});},options).then(function(){$recordRow.addClass('oe_edition');self.resize_fields();var is_focusable=function(field){return field&&field.$el.is(':visible:not(.oe_readonly)');};var focus_field=options&&options.focus_field?options.focus_field:undefined;if(!is_focusable(fields[focus_field])){focus_field=_.find(self.editor.form.fields_order,function(field){return is_focusable(fields[field]);});}
if(fields[focus_field]){fields[focus_field].$el.find('input, textarea').andSelf().filter('input, textarea').focus();}
return record.attributes;});}).fail(function(){if(!record.get('id')){self.records.remove(record);}});},function(){return $.Deferred().resolve();});},get_cells_for:function($row){var cells={};$row.children('td').each(function(index,el){cells[el.getAttribute('data-field')]=el;});return cells;},resize_fields:function(){if(!this.editor.is_editing()){return;}
for(var i=0,len=this.fields_for_resize.length;i<len;i++){var item=this.fields_for_resize[i];this.resize_field(item.field,item.cell);}},resize_field:function(field,cell){var $cell=$(cell);field.set_dimensions($cell.outerHeight(),$cell.outerWidth());field.$el.addClass('o_temp_visible').css({top:0,left:0}).position({my:'left top',at:'left top',of:$cell,}).removeClass('o_temp_visible');if(field.get('effective_readonly')){field.$el.addClass('oe_readonly');}
if(field.widget=="handle"){field.$el.addClass('oe_list_field_handle');}},save_edition:function(){var self=this;return self.saving_mutex.exec(function(){if(!self.editor.is_editing()){return $.when();}
return self.with_event('save',{editor:self.editor,form:self.editor.form,cancel:false,},function(){return self.editor.save().then(function(attrs){var created=false;var record=self.records.get(attrs.id);if(!record){created=true;record=self.records.find(function(r){return!r.get('id');}).set('id',attrs.id);}
return self.cancel_edition(true).then(function(){return self.handle_onwrite(record);}).then(function(){return self.reload_record(record);}).then(function(){return{created:created,record:record};});},function(){return self.cancel_edition();});});});},cancel_edition:function(force){var self=this;return this.with_event('cancel',{editor:this.editor,form:this.editor.form,cancel:false},function(){return this.editor.cancel(force).then(function(attrs){if(attrs.id){var record=self.records.get(attrs.id);if(!record){return;}
return self.reload_record(record,{do_not_evict:true});}
var to_delete=self.records.find(function(r){return!r.get('id');});if(to_delete){self.records.remove(to_delete);}});});},with_event:function(event_name,event,action){var self=this;event=event||{};this.trigger(event_name+':before',event);if(event.cancel){return $.Deferred().reject({message:_.str.sprintf("Event %s:before cancelled",event_name)});}
return $.when(action.call(this)).done(function(){self.trigger.apply(self,[event_name+':after'].concat(_.toArray(arguments)));});},edition_view:function(editor){var view=$.extend(true,{},this.fields_view);view.arch.tag='form';_.extend(view.arch.attrs,{'class':'oe_form_container',version:'7.0'});_(view.arch.children).chain().zip(_(this.columns).filter(function(c){return!(c instanceof ListView.MetaColumn);})).each(function(ar){var widget=ar[0],column=ar[1];var modifiers=_.extend({},column.modifiers);widget.attrs.nolabel=true;if(modifiers['tree_invisible']||widget.tag==='button'){modifiers.invisible=true;}
widget.attrs.modifiers=JSON.stringify(modifiers);});return view;},handle_onwrite:function(source_record){var self=this;var on_write_callback=self.fields_view.arch.attrs.on_write;if(!on_write_callback){return $.when();}
var context=new data.CompoundContext(self.dataset.get_context(),{'on_write_domain':self.dataset.domain}).eval();return this.dataset.call(on_write_callback,[source_record.get('id'),context]).then(function(ids){return $.when.apply(null,_(ids).map(_.bind(self.handle_onwrite_record,self,source_record)));});},handle_onwrite_record:function(source_record,id){var record=this.records.get(id);if(!record){var index=this.records.indexOf(source_record)+1;record=this.make_empty_record(id);this.records.add(record,{at:index});}
return this.reload_record(record);},prepends_on_create:function(){return(this.editable()==='top');},setup_events:function(){var self=this;_.each(this.editor.form.fields,function(field,field_name){field.on("change:effective_readonly",self,function(){var item=_(self.fields_for_resize).find(function(item){return item.field===field;});if(item){setTimeout(function(){self.resize_field(item.field,item.cell);},0);}});});this.editor.$el.on('keyup keypress keydown',function(e){if(!self.editor.is_editing()){return true;}
var key=_($.ui.keyCode).chain().map(function(v,k){return{name:k,code:v};}).find(function(o){return o.code===e.which;}).value();if(!key){return true;}
var method=e.type+'_'+key.name;if(!(method in self)){return true;}
return self[method](e);});},_next:function(next_record,options){next_record=next_record||'succ';var self=this;return this.save_edition().then(function(saveInfo){if(!saveInfo){return null;}
if(saveInfo.created){return self.start_edition();}
var record=self.records[next_record](saveInfo.record,{wraparound:true});return self.start_edition(record,options);});},keyup_ENTER:function(){return this._next();},keydown_ESCAPE:function(e){return false;},keyup_ESCAPE:function(e){return this.cancel_edition();},_text_selection_range:function(el){var selectionStart;try{selectionStart=el.selectionStart;}catch(e){return null;}
if(selectionStart!==undefined){return{start:selectionStart,end:el.selectionEnd};}else if(document.body.createTextRange){throw new Error("Implement text range handling for MSIE");}
return null;},_text_cursor:function(el){var selection=this._text_selection_range(el);if(!selection){return null;}
if(selection.start!==selection.end){return{position:null,collapsed:false};}
return{position:selection.start,collapsed:true};},_at_start:function(cursor,el){return cursor.collapsed&&(cursor.position===0);},_at_end:function(cursor,el){return cursor.collapsed&&(cursor.position===el.value.length);},_key_move_record:function(event,record_direction,is_valid_move){if(!this.editor.is_editing()||this.editor.is_creating()){return $.when();}
var cursor=this._text_cursor(event.target);if(cursor&&!is_valid_move(event.target,cursor)){return $.when();}
event.preventDefault();var source_field=$(event.target).closest('[data-fieldname]').attr('data-fieldname');return this._next(record_direction,{focus_field:source_field});},keyup_UP:function(e){var self=this;return this._key_move_record(e,'pred',function(el,cursor){return self._at_start(cursor,el);});},keyup_DOWN:function(e){var self=this;return this._key_move_record(e,'succ',function(el,cursor){return self._at_end(cursor,el);});},keydown_LEFT:function(e){var source_field=$(e.target).closest('[data-fieldname]').attr('data-fieldname');var cursor=this._text_cursor(e.target);if(cursor&&!this._at_start(cursor,e.target)){return $.when();}
var fields_order=this.editor.form.fields_order;var field_index=_(fields_order).indexOf(source_field);var fields=this.editor.form.fields;var field;do{if(--field_index<0){return $.when();}
field=fields[fields_order[field_index]];}while(!field.$el.is(':visible'));field.focus();return $.when();},keydown_RIGHT:function(e){var source_field=$(e.target).closest('[data-fieldname]').attr('data-fieldname');var cursor=this._text_cursor(e.target);if(cursor&&!this._at_end(cursor,e.target)){return $.when();}
var fields_order=this.editor.form.fields_order;var field_index=_(fields_order).indexOf(source_field);var fields=this.editor.form.fields;var field;do{if(++field_index>=fields_order.length){return $.when();}
field=fields[fields_order[field_index]];}while(!field.$el.is(':visible'));field.focus();return $.when();},keydown_TAB:function(e){var form=this.editor.form;var last_field=_(form.fields_order).chain().map(function(name){return form.fields[name];}).filter(function(field){return field.$el.is(':visible')&&!field.get('effective_readonly');}).last().value();if(last_field&&$(e.target).closest(last_field.el).length){e.preventDefault();return this._next();}
this.editor.form.__clicked_inside=true;return $.when();},});ListView.Groups.include({passthrough_events:ListView.Groups.prototype.passthrough_events+" edit saved",get_row_for:function(record){return _(this.children).chain().invoke('get_row_for',record).compact().first().value();}});ListView.List.include({row_clicked:function(event){if(!this.view.editable()||!this.view.is_action_enabled('edit')){return this._super.apply(this,arguments);}
var self=this;var args=arguments;var _super=self._super;var record_id=$(event.currentTarget).data('id');var self=this;this.view.save_edition().done(function(){if(self._dataset_changed){self.dataset.trigger('dataset_changed');}});return this.view.start_edition(((record_id)?this.records.get(record_id):null),{focus_field:$(event.target).not(".oe_readonly").data('field'),}).fail(function(){return _super.apply(self,args);});},get_row_for:function(record){var $row=this.$current.children('[data-id='+record.get('id')+']');return(($row.length)?$row:null);},});return Editor;});;

/* /web/static/src/js/views/pivot_view.js defined in bundle 'web.assets_backend' */
odoo.define('web.PivotView',function(require){"use strict";var core=require('web.core');var crash_manager=require('web.crash_manager');var formats=require('web.formats');var framework=require('web.framework');var Model=require('web.DataModel');var session=require('web.session');var Sidebar=require('web.Sidebar');var utils=require('web.utils');var View=require('web.View');var _lt=core._lt;var _t=core._t;var QWeb=core.qweb;var PivotView=View.extend({template:'PivotView',icon:'fa-table',display_name:_lt('Pivot'),view_type:'pivot',events:{'click .oe-opened':'on_open_header_click','click .oe-closed':'on_closed_header_click','click .o-field-menu':'on_field_menu_selection','click td':'on_cell_click','click .measure-row':'on_measure_row_click',},init:function(parent,dataset,view_id,options){this._super(parent,dataset,view_id,options);this.model=new Model(dataset.model,{group_by_no_leaf:true});this.fields={};this.measures={};this.groupable_fields={};this.ready=false;this.data_loaded=$.Deferred();this.title=options.title;this.main_row={root:undefined,groupbys:[],};this.main_col={root:undefined,groupbys:[],};this.initial_col_groupby=[];this.initial_row_groupby=[];this.active_measures=[];this.headers={};this.cells={};this.has_data=false;this.last_header_selected=null;this.sorted_column={};this.numbering={};},willStart:function(){var self=this;return session.rpc('/web/pivot/check_xlwt').then(function(result){self.xlwt_installed=result;});},start:function(){this.$table_container=this.$('.o-pivot-table');var load_fields=this.model.call('fields_get',[],{context:this.dataset.get_context()}).then(this.prepare_fields.bind(this));return $.when(this._super(),load_fields).then(this.render_field_selection.bind(this));},render_field_selection:function(){var self=this;var context={fields:_.chain(this.groupable_fields).pairs().sortBy(function(f){return f[1].string;}).value()};this.$field_selection=this.$('.o-field-selection');this.$field_selection.html(QWeb.render('PivotView.FieldSelection',context));core.bus.on('click',self,function(){self.$field_selection.find('ul').first().hide();});},render_buttons:function($node){if($node){var self=this;var context={measures:_.pairs(_.omit(this.measures,'__count__'))};this.$buttons=$(QWeb.render('PivotView.buttons',context));this.$buttons.click(this.on_button_click.bind(this));this.active_measures.forEach(function(measure){self.$buttons.find('li[data-field="'+measure+'"]').addClass('selected');});this.$buttons.find('button').tooltip();this.$buttons.appendTo($node);}},render_sidebar:function($node){if(this.xlwt_installed&&$node&&this.options.sidebar){this.sidebar=new Sidebar(this,{editable:this.is_action_enabled('edit')});this.sidebar.add_items('other',[{label:_t("Download xls"),callback:this.download_table.bind(this),}]);this.sidebar.appendTo($node);}},view_loading:function(fvg){var self=this;this.title=this.title||fvg.arch.attrs.string;this.enable_linking=!fvg.arch.attrs.disable_linking;this.$el.toggleClass('oe-enable-linking',this.enable_linking);fvg.arch.children.forEach(function(field){var name=field.attrs.name;if(field.attrs.interval){name+=':'+field.attrs.interval;}
switch(field.attrs.type){case'measure':self.active_measures.push(name);break;case'col':self.initial_col_groupby.push(name);break;default:if('operator'in field.attrs){self.active_measures.push(name);break;}
case'row':self.initial_row_groupby.push(name);}});if((!self.active_measures.length)||fvg.arch.attrs.display_quantity){self.active_measures.push('__count__');}
_.each(this.active_measures,function(m){if(!(m in self.measures)){self.measures[m]=self.fields[m];}});},prepare_fields:function(fields){var self=this,groupable_types=['many2one','char','boolean','selection','date','datetime'];this.fields=fields;_.each(fields,function(field,name){if((name!=='id')&&(field.store===true)){if(field.type==='integer'||field.type==='float'||field.type==='monetary'){self.measures[name]=field;}
if(_.contains(groupable_types,field.type)){self.groupable_fields[name]=field;}}});this.measures.__count__={string:_t("Quantity"),type:"integer"};},do_search:function(domain,context,group_by){if(!this.ready){this.initial_row_groupby=context.pivot_row_groupby||this.initial_row_groupby;this.initial_col_groupby=context.pivot_col_groupby||this.initial_col_groupby;}
this.main_row.groupbys=group_by.length?group_by:this.initial_row_groupby.slice(0);this.main_col.groupbys=context.pivot_column_groupby||this.initial_col_groupby.slice(0);this.active_measures=context.pivot_measures||this.active_measures;this.domain=domain;this.context=context;if(!this.ready){this.data_loaded=this.load_data(true);this.ready=true;return;}
this.data_loaded=this.load_data(false);return this.do_show();},do_show:function(){var self=this;this.do_push_state({});this.data_loaded.done(function(){self.display_table();});return this._super();},get_context:function(){return!this.ready?{}:{pivot_measures:this.active_measures,pivot_column_groupby:this.main_col.groupbys,pivot_row_groupby:this.main_row.groupbys,};},on_button_click:function(event){var $target=$(event.target);if($target.hasClass('oe-pivot-flip')){return this.flip();}
if($target.hasClass('oe-pivot-expand-all')){return this.expand_all();}
if($target.parents('.oe-measure-list').length){var parent=$target.parent(),field=parent.data('field');parent.toggleClass('selected');event.stopPropagation();return this.toggle_measure(field);}
if($target.hasClass('oe-pivot-download')){return this.download_table();}},on_open_header_click:function(event){var id=$(event.target).data('id'),header=this.headers[id];header.expanded=false;header.children=[];var new_groupby_length=this.get_header_depth(header.root)-1;header.root.groupbys.splice(new_groupby_length);this.display_table();},on_closed_header_click:function(event){var id=$(event.target).data('id'),header=this.headers[id],groupbys=header.root.groupbys;if(header.path.length-1<groupbys.length){this.expand_header(header,groupbys[header.path.length-1]).then(this.proxy('display_table'));}else{var $test=$(event.target);var pos=$test.position();this.last_header_selected=id;var $menu=this.$field_selection.find('ul').first();$menu.css('top',pos.top+$test.parent().height()-2);$menu.css('left',pos.left+event.offsetX);$menu.show();event.stopPropagation();}},on_cell_click:function(event){var $target=$(event.target);if($target.hasClass('oe-closed')||$target.hasClass('oe-opened')||$target.hasClass('oe-empty')||!this.enable_linking){return;}
var row_id=$target.data('id'),col_id=$target.data('col_id'),row_domain=this.headers[row_id].domain,col_domain=this.headers[col_id].domain,context=_.omit(_.clone(this.context),'group_by');var views=[[this.options.action_views_ids.list||false,'list'],[this.options.action_views_ids.form||false,'form']];return this.do_action({type:'ir.actions.act_window',name:this.title,res_model:this.model.name,views:views,view_type:"list",view_mode:"list",target:'current',context:context,domain:this.domain.concat(row_domain,col_domain),});},on_measure_row_click:function(event){var $target=$(event.target),col_id=$target.data('id'),measure=$target.data('measure');this.sort_rows(col_id,measure,$target.hasClass('o-sorted-asc'));this.display_table();},sort_rows:function(col_id,measure,descending){console.log('order',descending);var self=this;traverse_tree(this.main_row.root,function(header){header.children.sort(compare);});this.sorted_column={id:col_id,measure:measure,order:descending?'desc':'asc',};function compare(row1,row2){var values1=self.get_value(row1.id,col_id),values2=self.get_value(row2.id,col_id),value1=values1?values1[measure]:0,value2=values2?values2[measure]:0;return descending?value1-value2:value2-value1;}},on_field_menu_selection:function(event){var field=$(event.target).parent().data('field'),interval=$(event.target).data('interval'),header=this.headers[this.last_header_selected];if(interval)field=field+':'+interval;this.expand_header(header,field).then(function(){header.root.groupbys.push(field);}).then(this.proxy('display_table'));},expand_header:function(header,field){var self=this;var other_root=header.root.other_root,other_groupbys=header.root.other_root.groupbys,fields=[].concat(field,other_groupbys,this.active_measures),groupbys=[];for(var i=0;i<=other_groupbys.length;i++){groupbys.push([field].concat(other_groupbys.slice(0,i)));}
return $.when.apply(null,groupbys.map(function(groupby){return self.model.query(fields).filter(header.domain.length?header.domain:self.domain).context(self.context).lazy(false).group_by(groupby);})).then(function(){var data=Array.prototype.slice.call(arguments),datapt,attrs,j,k,l,row,col,cell_value,field_name;for(i=0;i<data.length;i++){for(j=0;j<data[i].length;j++){datapt=data[i][j];attrs=datapt.attributes;if(i===0)attrs.value=[attrs.value];for(k=0;k<attrs.value.length;k++){if(k<1)field_name=field;else field_name=other_groupbys[k-1];attrs.value[k]=self.sanitize_value(attrs.value[k],field_name);}
if(i===0){row=self.make_header(datapt,header.root,0,1,header);}else{row=self.get_header(datapt,header.root,0,1,header);}
col=self.get_header(datapt,other_root,1,i+1);if(!col)continue;for(cell_value={},l=0;l<self.active_measures.length;l++){cell_value[self.active_measures[l]]=attrs.aggregates[self.active_measures[l]];}
cell_value.__count__=attrs.length;if(!self.cells[row.id])self.cells[row.id]=[];self.cells[row.id][col.id]=cell_value;}}});},expand_all:function(){this.load_data(false).then(this.proxy('display_table'));},load_data:function(update){var should_update=(update&&this.main_row.root&&this.main_col.root);var self=this,i,j,groupbys=[],row_gbs=this.main_row.groupbys,col_gbs=this.main_col.groupbys,fields=[].concat(row_gbs,col_gbs,this.active_measures);for(i=0;i<row_gbs.length+1;i++){for(j=0;j<col_gbs.length+1;j++){groupbys.push(row_gbs.slice(0,i).concat(col_gbs.slice(0,j)));}}
return $.when.apply(null,groupbys.map(function(groupby){return self.model.query(fields).filter(self.domain).context(self.context).lazy(false).group_by(groupby);})).then(function(){var data=Array.prototype.slice.call(arguments);self.prepare_data(data,should_update);});},prepare_data:function(data,should_update){var i,j,k,l,m,index=0,row_gbs=this.main_row.groupbys,col_gbs=this.main_col.groupbys,main_row_header,main_col_header,row,col,attrs,datapt,cell_value,field;for(i=0;i<row_gbs.length+1;i++){for(j=0;j<col_gbs.length+1;j++){for(k=0;k<data[index].length;k++){datapt=data[index][k];attrs=datapt.attributes;if(i+j===1){attrs.value=[attrs.value];}
for(l=0;l<attrs.value.length;l++){if(l<i)field=row_gbs[l];else field=col_gbs[l-i];attrs.value[l]=this.sanitize_value(attrs.value[l],field);}
if(j===0){row=this.make_header(datapt,main_row_header,0,i);}else{row=this.get_header(datapt,main_row_header,0,i);}
if(i===0){col=this.make_header(datapt,main_col_header,i,i+j);}else{col=this.get_header(datapt,main_col_header,i,i+j);}
if(i+j===0){this.has_data=attrs.length>0;main_row_header=row;main_col_header=col;}
if(!this.cells[row.id])this.cells[row.id]=[];for(cell_value={},m=0;m<this.active_measures.length;m++){cell_value[this.active_measures[m]]=attrs.aggregates[this.active_measures[m]];}
cell_value.__count__=attrs.length;this.cells[row.id][col.id]=cell_value;}
index++;}}
if(should_update){this.update_tree(this.main_row.root,main_row_header);var new_groupby_length=this.get_header_depth(main_row_header)-1;main_row_header.groupbys=this.main_row.root.groupbys.slice(0,new_groupby_length);this.update_tree(this.main_col.root,main_col_header);new_groupby_length=this.get_header_depth(main_col_header)-1;main_col_header.groupbys=this.main_col.root.groupbys.slice(0,new_groupby_length);}else{main_row_header.groupbys=this.main_row.groupbys;main_col_header.groupbys=this.main_col.groupbys;}
main_row_header.other_root=main_col_header;main_col_header.other_root=main_row_header;this.main_row.root=main_row_header;this.main_col.root=main_col_header;},update_tree:function(old_tree,new_tree){if(!old_tree.expanded){new_tree.expanded=false;new_tree.children=[];return;}
var tree,j,old_title,new_title;for(var i=0;i<new_tree.children.length;i++){tree=undefined;new_title=new_tree.children[i].path[new_tree.children[i].path.length-1];for(j=0;j<old_tree.children.length;j++){old_title=old_tree.children[j].path[old_tree.children[j].path.length-1];if(old_title===new_title){tree=old_tree.children[j];break;}}
if(tree)this.update_tree(tree,new_tree.children[i]);else{new_tree.children[i].expanded=false;new_tree.children[i].children=[];}}},sanitize_value:function(value,field){if(value===false)return _t("Undefined");if(value instanceof Array)return this.get_numbered_value(value,field);if(field&&this.fields[field]&&(this.fields[field].type==='selection')){var selected=_.where(this.fields[field].selection,{0:value})[0];return selected?selected[1]:value;}
return value;},get_numbered_value:function(value,field){var id=value[0];var name=value[1]
this.numbering[field]=this.numbering[field]||{};this.numbering[field][name]=this.numbering[field][name]||{};var numbers=this.numbering[field][name];numbers[id]=numbers[id]||_.size(numbers)+1;return name+(numbers[id]>1?"  ("+numbers[id]+")":"");},make_header:function(data_pt,root,i,j,parent_header){var total=_t("Total");var attrs=data_pt.attributes,value=attrs.value,title=value.length?value[value.length-1]:total;var path,parent;if(parent_header){path=parent_header.path.concat(title);parent=parent_header;}else{path=[total].concat(value.slice(i,j-1));parent=value.length?find_path_in_tree(root,path):null;}
var header={id:utils.generate_id(),expanded:false,domain:data_pt.model._domain,children:[],path:value.length?parent.path.concat(title):[title]};this.headers[header.id]=header;header.root=root||header;if(parent){parent.children.push(header);parent.expanded=true;}
return header;},get_header:function(data_pt,root,i,j,parent){var path;var total=_t("Total");if(parent){path=parent.path.concat(data_pt.attributes.value.slice(i,j));}else{path=[total].concat(data_pt.attributes.value.slice(i,j));}
return find_path_in_tree(root,path);},display_table:function(){if(!this.active_measures.length||!this.has_data){return this.$table_container.empty().append(QWeb.render('PivotView.nodata'));}
var $fragment=$(document.createDocumentFragment()),$table=$('<table>').addClass('table table-hover table-condensed').appendTo($fragment),$thead=$('<thead>').appendTo($table),$tbody=$('<tbody>').appendTo($table),headers=this.compute_headers(),rows=this.compute_rows(),nbr_measures=this.active_measures.length,nbr_cols=(this.main_col.width===1)?nbr_measures:(this.main_col.width+1)*nbr_measures;for(var i=0;i<nbr_cols+1;i++){$table.prepend($('<col>'));}
this.draw_headers($thead,headers);this.draw_rows($tbody,rows);$table.on('hover','td',function(){$table.find('col:eq('+$(this).index()+')').toggleClass('hover');});this.$table_container.empty().append($fragment);this.$table_container.find('.oe-opened,.oe-closed').tooltip();},draw_headers:function($thead,headers){var self=this,i,j,cell,$row,$cell;var groupby_labels=_.map(this.main_col.groupbys,function(gb){return self.fields[gb.split(':')[0]].string;});for(i=0;i<headers.length;i++){$row=$('<tr>');for(j=0;j<headers[i].length;j++){cell=headers[i][j];$cell=$('<th>').text(cell.title).attr('rowspan',cell.height).attr('colspan',cell.width);if(cell.total){$cell.addClass('oe-total');}
if(i>0){$cell.attr('title',groupby_labels[i-1]);}
if(cell.expanded!==undefined){$cell.addClass(cell.expanded?'oe-opened':'oe-closed');$cell.data('id',cell.id);}
if(cell.measure){$cell.addClass('measure-row text-muted').text(this.measures[cell.measure].string).toggleClass('oe-total',cell.is_bold);$cell.data('id',cell.id).data('measure',cell.measure);if(cell.id===this.sorted_column.id&&cell.measure===this.sorted_column.measure){$cell.addClass('o-sorted o-sorted-'+this.sorted_column.order);}}
$row.append($cell);}
$thead.append($row);}},draw_rows:function($tbody,rows){var self=this,i,j,value,$row,$cell,$header,nbr_measures=this.active_measures.length,length=rows[0].values.length,display_total=this.main_col.width>1;var groupby_labels=_.map(this.main_row.groupbys,function(gb){return self.fields[gb.split(':')[0]].string;});var measure_types=this.active_measures.map(function(name){return self.measures[name].type;});for(i=0;i<rows.length;i++){$row=$('<tr>');$header=$('<td>').text(rows[i].title).data('id',rows[i].id).css('padding-left',(5+rows[i].indent*30)+'px').addClass(rows[i].expanded?'oe-opened':'oe-closed');if(rows[i].indent>0)$header.attr('title',groupby_labels[rows[i].indent-1]);$header.appendTo($row);for(j=0;j<length;j++){value=formats.format_value(rows[i].values[j],{type:measure_types[j%nbr_measures]});$cell=$('<td>').data('id',rows[i].id).data('col_id',rows[i].col_ids[Math.floor(j/nbr_measures)]).toggleClass('oe-empty',!value).text(value);if(((j>=length-this.active_measures.length)&&display_total)||i===0){$cell.css('font-weight','bold');}
$row.append($cell);}
$tbody.append($row);}},compute_headers:function(){var self=this,main_col_dims=this.get_header_width_depth(this.main_col.root),depth=main_col_dims.depth,width=main_col_dims.width,nbr_measures=this.active_measures.length,result=[[{width:1,height:depth+1}]],col_ids=[];this.main_col.width=width;traverse_tree(this.main_col.root,function(header){var index=header.path.length-1,cell={width:self.get_header_width(header)*nbr_measures,height:header.expanded?1:depth-index,title:header.path[header.path.length-1],id:header.id,expanded:header.expanded,};if(!header.expanded)col_ids.push(header.id);if(result[index])result[index].push(cell);else result[index]=[cell];});col_ids.push(this.main_col.root.id);this.main_col.width=width;if(width>1){var total_cell={width:nbr_measures,height:depth,title:""};if(nbr_measures===1){total_cell.title=this.measures[this.active_measures[0]].string;total_cell.total=true;}
result[0].push(total_cell);}
var nbr_cols=width===1?nbr_measures:(width+1)*nbr_measures;for(var i=0,measure_row=[],measure;i<nbr_cols;i++){measure=this.active_measures[i%nbr_measures];measure_row.push({measure:measure,is_bold:(width>1)&&(i>=nbr_measures*width),id:col_ids[Math.floor(i/nbr_measures)],});}
result.push(measure_row);return result;},get_header_width:function(header){var self=this;if(!header.children.length)return 1;if(!header.expanded)return 1;return header.children.reduce(function(s,c){return s+self.get_header_width(c);},0);},get_header_width_depth:function(header){var depth=1,width=0;traverse_tree(header,function(hdr){depth=Math.max(depth,hdr.path.length);if(!hdr.expanded)width++;});return{width:width,depth:depth};},get_header_depth:function(header){var depth=1;traverse_tree(header,function(hdr){depth=Math.max(depth,hdr.path.length);});return depth;},compute_rows:function(){var self=this,aggregates,i,result=[];traverse_tree(this.main_row.root,function(header){var values=[],col_ids=[];result.push({id:header.id,col_ids:col_ids,indent:header.path.length-1,title:header.path[header.path.length-1],expanded:header.expanded,values:values,});traverse_tree(self.main_col.root,add_cells,header.id,values,col_ids);if(self.main_col.width>1){aggregates=self.get_value(header.id,self.main_col.root.id);for(i=0;i<self.active_measures.length;i++){values.push(aggregates&&aggregates[self.active_measures[i]]);}
col_ids.push(self.main_col.root.id);}});return result;function add_cells(col_hdr,row_id,values,col_ids){if(col_hdr.expanded)return;col_ids.push(col_hdr.id);aggregates=self.get_value(row_id,col_hdr.id);for(i=0;i<self.active_measures.length;i++){values.push(aggregates&&aggregates[self.active_measures[i]]);}}},get_value:function(id1,id2){if((id1 in this.cells)&&(id2 in this.cells[id1])){return this.cells[id1][id2];}
if(id2 in this.cells)return this.cells[id2][id1];},flip:function(){var temp=this.main_col;this.main_col=this.main_row;this.main_row=temp;this.display_table();},toggle_measure:function(field){if(_.contains(this.active_measures,field)){this.active_measures=_.without(this.active_measures,field);this.display_table();}else{this.active_measures.push(field);this.load_data().then(this.display_table.bind(this));}},download_table:function(){framework.blockUI();var nbr_measures=this.active_measures.length,headers=this.compute_headers(),measure_row=nbr_measures>1?_.last(headers):[],rows=this.compute_rows(),i,j,value;headers[0].splice(0,1);for(i=0;i<measure_row.length;i++){measure_row[i].measure=this.measures[measure_row[i].measure].string;}
for(i=0,j,value;i<rows.length;i++){for(j=0;j<rows[i].values.length;j++){value=rows[i].values[j];rows[i].values[j]={is_bold:(i===0)||((this.main_col.width>1)&&(j>=rows[i].values.length-nbr_measures)),value:(value===undefined)?"":value,};}}
var table={headers:_.initial(headers),measure_row:measure_row,rows:rows,nbr_measures:nbr_measures,title:this.title,};if(table.measure_row.length+1>256){c.show_message(_t("For Excel compatibility, data cannot be exported if there is more than 256 columns.\n\nTip: try to flip axis, filter further or reduce the number of measures."));return;}
session.get_file({url:'/web/pivot/export_xls',data:{data:JSON.stringify(table)},complete:framework.unblockUI,error:crash_manager.rpc_error.bind(crash_manager)});},});function traverse_tree(root,f,arg1,arg2,arg3){f(root,arg1,arg2,arg3);if(!root.expanded)return;for(var i=0;i<root.children.length;i++){traverse_tree(root.children[i],f,arg1,arg2,arg3);}}
function find_path_in_tree(root,path){var i,l=root.path.length;if(l===path.length){return(root.path[l-1]===path[l-1])?root:null;}
for(i=0;i<root.children.length;i++){if(root.children[i].path[l]===path[l]){return find_path_in_tree(root.children[i],path);}}
return null;}
core.view_registry.add('pivot',PivotView);return PivotView;});;

/* /web/static/src/js/views/graph_view.js defined in bundle 'web.assets_backend' */
odoo.define('web.GraphView',function(require){"use strict";var core=require('web.core');var GraphWidget=require('web.GraphWidget');var Model=require('web.DataModel');var View=require('web.View');var _lt=core._lt;var _t=core._t;var QWeb=core.qweb;var GraphView=View.extend({className:'oe_graph',display_name:_lt('Graph'),icon:'fa-bar-chart',view_type:'graph',init:function(parent,dataset,view_id,options){this._super(parent,dataset,view_id,options);this.model=new Model(dataset.model,{group_by_no_leaf:true});this.measures=[];this.active_measure='__count__';this.initial_groupbys=[];this.widget=undefined;},start:function(){var load_fields=this.model.call('fields_get',[],{context:this.dataset.get_context()}).then(this.prepare_fields.bind(this));return $.when(this._super(),load_fields);},render_buttons:function($node){if($node){var context={measures:_.pairs(_.omit(this.measures,'__count__'))};this.$buttons=$(QWeb.render('GraphView.buttons',context));this.$measure_list=this.$buttons.find('.oe-measure-list');this.update_measure();this.$buttons.find('button').tooltip();this.$buttons.click(this.on_button_click.bind(this));this.$buttons.appendTo($node);}},update_measure:function(){var self=this;this.$measure_list.find('li').each(function(index,li){$(li).toggleClass('selected',$(li).data('field')===self.active_measure);});},view_loading:function(fvg){var self=this;fvg.arch.children.forEach(function(field){var name=field.attrs.name;if(field.attrs.interval){name+=':'+field.attrs.interval;}
if(field.attrs.type==='measure'){self.active_measure=name;}else{self.initial_groupbys.push(name);}});},do_show:function(){this.do_push_state({});return this._super();},prepare_fields:function(fields){var self=this;this.fields=fields;_.each(fields,function(field,name){if((name!=='id')&&(field.store===true)){if(field.type==='integer'||field.type==='float'||field.type==='monetary'){self.measures[name]=field;}}});this.measures.__count__={string:_t("Quantity"),type:"integer"};},do_search:function(domain,context,group_by){if(!this.widget){this.initial_groupbys=context.graph_groupbys||this.initial_groupbys;this.widget=new GraphWidget(this,this.dataset.model,{measure:context.graph_measure||this.active_measure,mode:context.graph_mode||this.active_mode,domain:domain,groupbys:this.initial_groupbys,context:context,fields:this.fields,});this.widget.appendTo(this.$el);}else{var groupbys=group_by.length?group_by:this.initial_groupbys.slice(0);this.widget.update_data(domain,groupbys);}},get_context:function(){return!this.widget?{}:{graph_mode:this.widget.mode,graph_measure:this.widget.measure,graph_groupbys:this.widget.groupbys};},on_button_click:function(event){var $target=$(event.target);if($target.hasClass('oe-bar-mode')){this.widget.set_mode('bar');}
if($target.hasClass('oe-line-mode')){this.widget.set_mode('line');}
if($target.hasClass('oe-pie-mode')){this.widget.set_mode('pie');}
if($target.parents('.oe-measure-list').length){var parent=$target.parent(),field=parent.data('field');this.active_measure=field;parent.toggleClass('selected');event.stopPropagation();this.update_measure();this.widget.set_measure(this.active_measure);}},});core.view_registry.add('graph',GraphView);return GraphView;});;

/* /web/static/src/js/views/graph_widget.js defined in bundle 'web.assets_backend' */
odoo.define('web.GraphWidget',function(require){"use strict";var config=require('web.config');var core=require('web.core');var Model=require('web.DataModel');var Widget=require('web.Widget');var _t=core._t;var QWeb=core.qweb;var MAX_LEGEND_LENGTH=25*(1+config.device.size_class);return Widget.extend({init:function(parent,model,options){this._super(parent);this.context=options.context;this.fields=options.fields;this.fields.__count__={string:_t("Quantity"),type:"integer"};this.model=new Model(model,{group_by_no_leaf:true});this.domain=options.domain||[];this.groupbys=options.groupbys||[];this.mode=options.mode||"bar";this.measure=options.measure||"__count__";},start:function(){return this.load_data().then(this.proxy('display_graph'));},update_data:function(domain,groupbys){this.domain=domain;this.groupbys=groupbys;return this.load_data().then(this.proxy('display_graph'));},set_mode:function(mode){this.mode=mode;this.display_graph();},set_measure:function(measure){this.measure=measure;return this.load_data().then(this.proxy('display_graph'));},load_data:function(){var fields=this.groupbys.slice(0);if(this.measure!=='__count__'.slice(0))
fields=fields.concat(this.measure);return this.model.query(fields).filter(this.domain).context(this.context).lazy(false).group_by(this.groupbys.slice(0,2)).then(this.proxy('prepare_data'));},prepare_data:function(){var raw_data=arguments[0],is_count=this.measure==='__count__';var data_pt,j,values,value;this.data=[];for(var i=0;i<raw_data.length;i++){data_pt=raw_data[i].attributes;values=[];if(this.groupbys.length===1)data_pt.value=[data_pt.value];for(j=0;j<data_pt.value.length;j++){values[j]=this.sanitize_value(data_pt.value[j],data_pt.grouped_on[j]);}
value=is_count?data_pt.length:data_pt.aggregates[this.measure];this.data.push({labels:values,value:value});}},sanitize_value:function(value,field){if(value===false)return _t("Undefined");if(value instanceof Array)return value[1];if(field&&this.fields[field]&&(this.fields[field].type==='selection')){var selected=_.where(this.fields[field].selection,{0:value})[0];return selected?selected[1]:value;}
return value;},display_graph:function(){if(this.to_remove){nv.utils.offWindowResize(this.to_remove);}
this.$el.empty();if(!this.data.length){this.$el.append(QWeb.render('GraphView.error',{title:_t("No data to display"),description:_t("No data available for this chart. "+"Try to add some records, or make sure that "+"there is no active filter in the search bar."),}));}else{this['display_'+this.mode]();}},display_bar:function(){var data,values,measure=this.fields[this.measure].string;if(this.groupbys.length===0){data=[{values:[{x:measure,y:this.data[0].value}],key:measure}];}
if(this.groupbys.length===1){values=this.data.map(function(datapt){return{x:datapt.labels,y:datapt.value};});data=[{values:values,key:measure,}];}
if(this.groupbys.length>1){var xlabels=[],series=[],label,serie,value;values={};for(var i=0;i<this.data.length;i++){label=this.data[i].labels[0];serie=this.data[i].labels[1];value=this.data[i].value;if((!xlabels.length)||(xlabels[xlabels.length-1]!==label)){xlabels.push(label);}
series.push(this.data[i].labels[1]);if(!(serie in values)){values[serie]={};}
values[serie][label]=this.data[i].value;}
series=_.uniq(series);data=[];var current_serie,j;for(i=0;i<series.length;i++){current_serie={values:[],key:series[i]};for(j=0;j<xlabels.length;j++){current_serie.values.push({x:xlabels[j],y:values[series[i]][xlabels[j]]||0,});}
data.push(current_serie);}}
var svg=d3.select(this.$el[0]).append('svg');svg.datum(data);svg.transition().duration(0);var chart=nv.models.multiBarChart();chart.options({margin:{bottom:100},delay:250,transition:10,showLegend:_.size(data)<=MAX_LEGEND_LENGTH,showXAxis:true,showYAxis:true,rightAlignYAxis:false,stacked:true,reduceXTicks:false,rotateLabels:-20,showControls:(this.groupbys.length>1)});chart.yAxis.tickFormat(function(d){return openerp.web.format_value(d,{type:'float'});});chart(svg);this.to_remove=chart.update;nv.utils.onWindowResize(chart.update);},display_pie:function(){var data=[],all_negative=true,some_negative=false,all_zero=true;this.data.forEach(function(datapt){all_negative=all_negative&&(datapt.value<0);some_negative=some_negative||(datapt.value<0);all_zero=all_zero&&(datapt.value===0);});if(some_negative&&!all_negative){return this.$el.append(QWeb.render('GraphView.error',{title:_t("Invalid data"),description:_t("Pie chart cannot mix positive and negative numbers. "+"Try to change your domain to only display positive results"),}));}
if(all_zero){return this.$el.append(QWeb.render('GraphView.error',{title:_t("Invalid data"),description:_t("Pie chart cannot display all zero numbers.. "+"Try to change your domain to display positive results"),}));}
if(this.groupbys.length){data=this.data.map(function(datapt){return{x:datapt.labels.join("/"),y:datapt.value};});}
var svg=d3.select(this.$el[0]).append('svg');svg.datum(data);svg.transition().duration(100);var legend_right=config.device.size_class>config.device.SIZES.XS;var chart=nv.models.pieChart();chart.options({delay:250,showLegend:legend_right||_.size(data)<=MAX_LEGEND_LENGTH,legendPosition:legend_right?'right':'top',transition:100,color:d3.scale.category10().range(),pieLabelsOutside:true,});chart(svg);this.to_remove=chart.update;nv.utils.onWindowResize(chart.update);},display_line:function(){if(this.data.length<2){this.$el.append(QWeb.render('GraphView.error',{title:_t("Not enough data points"),description:"You need at least two data points to display a line chart."}));return;}
var self=this,data=[],tickValues,tickFormat,measure=this.fields[this.measure].string;if(this.groupbys.length===1){var values=this.data.map(function(datapt,index){return{x:index,y:datapt.value};});data=[{values:values,key:measure,}];tickValues=this.data.map(function(d,i){return i;});tickFormat=function(d){return self.data[d].labels;};}
if(this.groupbys.length>1){data=[];var data_dict={},tick=0,tickLabels=[],serie,tickLabel,identity=function(p){return p;};tickValues=[];for(var i=0;i<this.data.length;i++){if(this.data[i].labels[0]!==tickLabel){tickLabel=this.data[i].labels[0];tickValues.push(tick);tickLabels.push(tickLabel);tick++;}
serie=this.data[i].labels[1];if(!data_dict[serie]){data_dict[serie]={values:[],key:serie,};}
data_dict[serie].values.push({x:tick,y:this.data[i].value,});data=_.map(data_dict,identity);}
tickFormat=function(d){return tickLabels[d];};}
var svg=d3.select(this.$el[0]).append('svg');svg.datum(data);svg.transition().duration(0);var chart=nv.models.lineChart();chart.options({margin:{left:50,right:50},useInteractiveGuideline:true,showLegend:_.size(data)<=MAX_LEGEND_LENGTH,showXAxis:true,showYAxis:true,});chart.xAxis.tickValues(tickValues).tickFormat(tickFormat);chart(svg);this.to_remove=chart.update;nv.utils.onWindowResize(chart.update);},destroy:function(){nv.utils.offWindowResize(this.to_remove);return this._super();}});});;

/* /web/static/src/js/views/search_view.js defined in bundle 'web.assets_backend' */
odoo.define('web.SearchView',function(require){"use strict";var AutoComplete=require('web.AutoComplete');var core=require('web.core');var FavoriteMenu=require('web.FavoriteMenu');var FilterMenu=require('web.FilterMenu');var GroupByMenu=require('web.GroupByMenu');var Model=require('web.DataModel');var pyeval=require('web.pyeval');var search_inputs=require('web.search_inputs');var utils=require('web.utils');var Widget=require('web.Widget');var Backbone=window.Backbone;var FacetValue=Backbone.Model.extend({});var FacetValues=Backbone.Collection.extend({model:FacetValue});var Facet=Backbone.Model.extend({initialize:function(attrs){var values=attrs.values;delete attrs.values;Backbone.Model.prototype.initialize.apply(this,arguments);this.values=new FacetValues(values||[]);this.values.on('add remove change reset',function(_,options){this.trigger('change',this,options);},this);},get:function(key){if(key!=='values'){return Backbone.Model.prototype.get.call(this,key);}
return this.values.toJSON();},set:function(key,value){if(key!=='values'){return Backbone.Model.prototype.set.call(this,key,value);}
this.values.reset(value);},toJSON:function(){var out={};var attrs=this.attributes;for(var att in attrs){if(!attrs.hasOwnProperty(att)||att==='field'){continue;}
out[att]=attrs[att];}
out.values=this.values.toJSON();return out;}});var SearchQuery=Backbone.Collection.extend({model:Facet,initialize:function(){Backbone.Collection.prototype.initialize.apply(this,arguments);this.on('change',function(facet){if(!facet.values.isEmpty()){return;}
this.remove(facet,{silent:true});},this);},add:function(values,options){options=options||{};if(!values){values=[];}else if(!(values instanceof Array)){values=[values];}
_(values).each(function(value){var model=this._prepareModel(value,options);var previous=this.detect(function(facet){return facet.get('category')===model.get('category')&&facet.get('field')===model.get('field');});if(previous){previous.values.add(model.get('values'),_.omit(options,'at','merge'));return;}
Backbone.Collection.prototype.add.call(this,model,options);},this);return this;},toggle:function(value,options){options=options||{};var facet=this.detect(function(facet){return facet.get('category')===value.category&&facet.get('field')===value.field;});if(!facet){return this.add(value,options);}
var changed=false;_(value.values).each(function(val){var already_value=facet.values.detect(function(v){return v.get('value')===val.value&&v.get('label')===val.label;});if(already_value){facet.values.remove(already_value,{silent:true});}else{facet.values.add(val,{silent:true});}
changed=true;});facet.trigger('change',facet);return this;}});var InputView=Widget.extend({template:'SearchView.InputView',events:{focus:function(){this.trigger('focused',this);},blur:function(){this.$el.text('');this.trigger('blurred',this);},keydown:'onKeydown',paste:'onPaste',},getSelection:function(){this.el.normalize();var root=this.el.childNodes[0];if(!root||!root.textContent){return{start:0,end:0};}
var range=window.getSelection().getRangeAt(0);if(range.startContainer===this.el&&range.startOffset===0){range.setStart(root,0);}
if(range.endContainer===this.el&&range.endOffset===1){range.setEnd(root,root.length);}
utils.assert(range.startContainer===root,"selection should be in the input view");utils.assert(range.endContainer===root,"selection should be in the input view");return{start:range.startOffset,end:range.endOffset};},onKeydown:function(e){this.el.normalize();var sel;switch(e.which){case $.ui.keyCode.ENTER:e.preventDefault();break;case $.ui.keyCode.BACKSPACE:sel=this.getSelection();if(sel.start===0&&sel.start===sel.end){e.preventDefault();var preceding=this.getParent().siblingSubview(this,-1);if(preceding&&(preceding instanceof FacetView)){preceding.model.destroy();}}
break;case $.ui.keyCode.LEFT:sel=this.getSelection();if(sel.start!==0||sel.start!==sel.end){e.stopPropagation();}
break;case $.ui.keyCode.RIGHT:sel=this.getSelection();var len=this.$el.text().length;if(sel.start!==len||sel.start!==sel.end){e.stopPropagation();}
break;}},setCursorAtEnd:function(){this.el.normalize();var sel=window.getSelection();sel.removeAllRanges();var range=document.createRange();range.selectNode(this.el.childNodes[0]);range.collapse(false);sel.addRange(range);},onPaste:function(){this.el.normalize();setTimeout(function(){var data=this.$el.text();if(!data)
return;this.$el.empty().text(data);this.el.normalize();this.setCursorAtEnd();}.bind(this),0);}});var FacetView=Widget.extend({template:'SearchView.FacetView',events:{'focus':function(){this.trigger('focused',this);},'blur':function(){this.trigger('blurred',this);},'click':function(e){if($(e.target).is('.oe_facet_remove')){this.model.destroy();return false;}
this.$el.focus();e.stopPropagation();},'keydown':function(e){var keys=$.ui.keyCode;switch(e.which){case keys.BACKSPACE:case keys.DELETE:this.model.destroy();return false;}}},init:function(parent,model){this._super(parent);this.model=model;this.model.on('change',this.model_changed,this);},destroy:function(){this.model.off('change',this.model_changed,this);this._super();},start:function(){var self=this;var $e=this.$('> span:last-child');return $.when(this._super()).then(function(){return $.when.apply(null,self.model.values.map(function(value){return new FacetValueView(self,value).appendTo($e);}));});},model_changed:function(){this.$el.text(this.$el.text()+'*');}});var FacetValueView=Widget.extend({template:'SearchView.FacetView.Value',init:function(parent,model){this._super(parent);this.model=model;this.model.on('change',this.model_changed,this);},destroy:function(){this.model.off('change',this.model_changed,this);this._super();},model_changed:function(){this.$el.text(this.$el.text()+'*');}});var SearchView=Widget.extend({template:"SearchView",events:{'click':function(e){if(e.target===this.$('.oe_searchview_facets')[0]){this.$('.oe_searchview_input:last').focus();}},'click div.oe_searchview_search':function(e){e.stopImmediatePropagation();this.do_search();},'click .oe_searchview_unfold_drawer':function(e){e.stopImmediatePropagation();$(e.target).toggleClass('fa-caret-down fa-caret-up');localStorage.visible_search_menu=(localStorage.visible_search_menu!=='true');this.toggle_buttons();},'keydown .oe_searchview_input, .oe_searchview_facet':function(e){switch(e.which){case $.ui.keyCode.LEFT:this.focusPreceding(e.target);e.preventDefault();break;case $.ui.keyCode.RIGHT:if(!this.autocomplete.is_expandable()){this.focusFollowing(e.target);}
e.preventDefault();break;}},'autocompleteopen':function(){this.$el.autocomplete('widget').css('z-index',9999);},},init:function(parent,dataset,view_id,defaults,options){this.options=_.defaults(options||{},{hidden:false,disable_filters:false,disable_groupby:false,disable_favorites:false,disable_custom_filters:false,});this._super(parent);this.query=undefined;this.dataset=dataset;this.view_id=view_id;this.title=options.action&&options.action.name;this.search_fields=[];this.filters=[];this.groupbys=[];this.visible_filters=(localStorage.visible_search_menu==='true');this.input_subviews=[];this.defaults=defaults||{};this.headless=this.options.hidden&&_.isEmpty(this.defaults);this.$buttons=this.options.$buttons;this.filter_menu=undefined;this.groupby_menu=undefined;this.favorite_menu=undefined;this.action_id=this.options&&this.options.action&&this.options.action.id;},start:function(){if(this.headless){this.do_hide();}
this.toggle_visibility(false);this.$facets_container=this.$('div.oe_searchview_facets');this.setup_global_completion();this.query=new SearchQuery().on('add change reset remove',this.proxy('do_search')).on('change',this.proxy('renderChangedFacets')).on('add reset remove',this.proxy('renderFacets'));var load_view=this.dataset._model.fields_view_get({view_id:this.view_id,view_type:'search',context:this.dataset.get_context(),});this.$('.oe_searchview_unfold_drawer').toggleClass('fa-caret-down',!this.visible_filters).toggleClass('fa-caret-up',this.visible_filters);return this.alive($.when(this._super(),this.alive(load_view).then(this.view_loaded.bind(this))));},get_title:function(){return this.title;},view_loaded:function(r){var menu_defs=[];this.fields_view_get=r;this.view_id=this.view_id||r.view_id;this.prepare_search_inputs();if(this.$buttons){var fields_def=new Model(this.dataset.model).call('fields_get',{context:this.dataset.get_context()});if(!this.options.disable_filters){this.filter_menu=new FilterMenu(this,this.filters,fields_def);menu_defs.push(this.filter_menu.appendTo(this.$buttons));}
if(!this.options.disable_groupby){this.groupby_menu=new GroupByMenu(this,this.groupbys,fields_def);menu_defs.push(this.groupby_menu.appendTo(this.$buttons));}
if(!this.options.disable_favorites){this.favorite_menu=new FavoriteMenu(this,this.query,this.dataset.model,this.action_id);menu_defs.push(this.favorite_menu.appendTo(this.$buttons));}}
return $.when.apply($,menu_defs).then(this.proxy('set_default_filters'));},set_default_filters:function(){var self=this,default_custom_filter=this.$buttons&&this.favorite_menu.get_default_filter();if(!self.options.disable_custom_filters&&default_custom_filter){return this.favorite_menu.toggle_filter(default_custom_filter,true);}
if(!_.isEmpty(this.defaults)){var inputs=this.search_fields.concat(this.filters,this.groupbys),defaults=_.invoke(inputs,'facet_for_defaults',this.defaults);return $.when.apply(null,defaults).then(function(){self.query.reset(_(arguments).compact(),{preventSearch:true});});}
this.query.reset([],{preventSearch:true});return $.when();},do_search:function(_query,options){if(options&&options.preventSearch){return;}
var search=this.build_search_data();this.trigger('search_data',search.domains,search.contexts,search.groupbys);},build_search_data:function(){var domains=[],contexts=[],groupbys=[];this.query.each(function(facet){var field=facet.get('field');var domain=field.get_domain(facet);if(domain){domains.push(domain);}
var context=field.get_context(facet);if(context){contexts.push(context);}
var group_by=field.get_groupby(facet);if(group_by){groupbys.push.apply(groupbys,group_by);}});return{domains:domains,contexts:contexts,groupbys:groupbys,};},toggle_visibility:function(is_visible){this.do_toggle(!this.headless&&is_visible);if(this.$buttons){this.$buttons.toggle(!this.headless&&is_visible&&this.visible_filters);}
if(!this.headless&&is_visible){this.$('div.oe_searchview_input').last().focus();}},toggle_buttons:function(is_visible){this.visible_filters=is_visible||!this.visible_filters;if(this.$buttons){this.$buttons.toggle(this.visible_filters);}},setup_global_completion:function(){var self=this;this.autocomplete=new AutoComplete(this,{source:this.proxy('complete_global_search'),select:this.proxy('select_completion'),get_search_string:function(){return self.$('div.oe_searchview_input').text();},});this.autocomplete.appendTo(this.$el);},complete_global_search:function(req,resp){var inputs=this.search_fields.concat(this.filters,this.groupbys);$.when.apply(null,_(inputs).chain().filter(function(input){return input.visible();}).invoke('complete',req.term).value()).then(function(){resp(_(arguments).chain().compact().flatten(true).value());});},select_completion:function(e,ui){e.preventDefault();var input_index=_(this.input_subviews).indexOf(this.subviewForRoot(this.$('div.oe_searchview_input:focus')[0]));this.query.add(ui.item.facet,{at:input_index/2});},subviewForRoot:function(subview_root){return _(this.input_subviews).detect(function(subview){return subview.$el[0]===subview_root;});},siblingSubview:function(subview,direction,wrap_around){var index=_(this.input_subviews).indexOf(subview)+direction;if(wrap_around&&index<0){index=this.input_subviews.length-1;}else if(wrap_around&&index>=this.input_subviews.length){index=0;}
return this.input_subviews[index];},focusPreceding:function(subview_root){return this.siblingSubview(this.subviewForRoot(subview_root),-1,true).$el.focus();},focusFollowing:function(subview_root){return this.siblingSubview(this.subviewForRoot(subview_root),+1,true).$el.focus();},renderFacets:function(collection,model,options){var self=this;var started=[];_.invoke(this.input_subviews,'destroy');this.input_subviews=[];var i=new InputView(this);started.push(i.appendTo(this.$facets_container));this.input_subviews.push(i);this.query.each(function(facet){var f=new FacetView(this,facet);started.push(f.appendTo(self.$facets_container));self.input_subviews.push(f);var i=new InputView(this);started.push(i.appendTo(self.$facets_container));self.input_subviews.push(i);},this);_.each(this.input_subviews,function(childView){childView.on('focused',self,self.proxy('childFocused'));childView.on('blurred',self,self.proxy('childBlurred'));});$.when.apply(null,started).then(function(){if(options&&options.focus_input===false)return;var input_to_focus;if(!options||typeof options.at!=='number'){input_to_focus=_.last(self.input_subviews);}else{input_to_focus=self.input_subviews[(options.at+1)*2];}
input_to_focus.$el.focus();});},childFocused:function(){this.$el.addClass('active');},childBlurred:function(){this.$el.val('').removeClass('active').trigger('blur');this.autocomplete.close();},renderChangedFacets:function(model,options){this.renderFacets(undefined,model,options);},prepare_search_inputs:function(){var self=this,arch=this.fields_view_get.arch;var filters=[].concat.apply([],_.map(arch.children,function(item){return item.tag!=='group'?eval_item(item):item.children.map(eval_item);}));function eval_item(item){var category='filters';if(item.attrs.context){try{var context=pyeval.eval('context',item.attrs.context);if(context.group_by){category='group_by';}}catch(e){}}
return{item:item,category:category,};}
var current_group=[],current_category='filters',categories={filters:this.filters,group_by:this.groupbys};_.each(filters.concat({category:'filters',item:'separator'}),function(filter){if(filter.item.tag==='filter'&&filter.category===current_category){return current_group.push(new search_inputs.Filter(filter.item,self));}
if(current_group.length){var group=new search_inputs.FilterGroup(current_group,self);categories[current_category].push(group);current_group=[];}
if(filter.item.tag==='field'){var attrs=filter.item.attrs;var field=self.fields_view_get.fields[attrs.name];if(field.type==="many2one"&&attrs.widget==="selection"){attrs.widget=undefined;}
var Obj=core.search_widgets_registry.get_any([attrs.widget,field.type]);if(Obj){self.search_fields.push(new(Obj)(filter.item,field,self));}}
if(filter.item.tag==='filter'){current_group.push(new search_inputs.Filter(filter.item,self));}
current_category=filter.category;});},});_.extend(SearchView,{SearchQuery:SearchQuery,Facet:Facet,});return SearchView;});odoo.define('web.AutoComplete',function(require){"use strict";var Widget=require('web.Widget');return Widget.extend({template:"SearchView.autocomplete",init:function(parent,options){this._super(parent);this.$input=parent.$el;this.source=options.source;this.select=options.select;this.get_search_string=options.get_search_string;this.current_result=null;this.searching=true;this.search_string='';this.current_search=null;},start:function(){var self=this;this.$input.on('keyup',function(ev){if(ev.which===$.ui.keyCode.RIGHT){self.searching=true;ev.preventDefault();return;}
if(ev.which===$.ui.keyCode.ENTER){if(self.search_string.length){self.select_item(ev);}
return;}
var search_string=self.get_search_string();if(self.search_string!==search_string){if(search_string.length){self.search_string=search_string;self.initiate_search(search_string);}else{self.close();}}});this.$input.on('keypress',function(ev){self.search_string=self.search_string+String.fromCharCode(ev.which);if(self.search_string.length){self.searching=true;var search_string=self.search_string;self.initiate_search(search_string);}else{self.close();}});this.$input.on('keydown',function(ev){switch(ev.which){case $.ui.keyCode.ENTER:case $.ui.keyCode.TAB:if(self.search_string.length){self.select_item(ev);}
break;case $.ui.keyCode.DOWN:self.move('down');self.searching=false;ev.preventDefault();break;case $.ui.keyCode.UP:self.move('up');self.searching=false;ev.preventDefault();break;case $.ui.keyCode.RIGHT:self.searching=false;var current=self.current_result;if(current&&current.expand&&!current.expanded){self.expand();self.searching=true;}
ev.preventDefault();break;case $.ui.keyCode.ESCAPE:self.close();self.searching=false;break;}});},initiate_search:function(query){if(query===this.search_string&&query!==this.current_search){this.search(query);}},search:function(query){var self=this;this.current_search=query;this.source({term:query},function(results){if(results.length){self.render_search_results(results);self.focus_element(self.$('li:first-child'));}else{self.close();}});},render_search_results:function(results){var self=this;var $list=this.$('ul');$list.empty();var render_separator=false;results.forEach(function(result){if(result.is_separator){if(render_separator)
$list.append($('<li>').addClass('oe-separator'));render_separator=false;}else{var $item=self.make_list_item(result).appendTo($list);result.$el=$item;render_separator=true;}});this.show();},make_list_item:function(result){var self=this;var $li=$('<li>').hover(function(){self.focus_element($li);}).mousedown(function(ev){if(ev.button===0){self.select(ev,{item:{facet:result.facet}});self.close();}else{ev.preventDefault();}}).data('result',result);if(result.expand){var $expand=$('<span class="oe-expand">').text('▶').appendTo($li);$expand.mousedown(function(ev){ev.preventDefault();ev.stopPropagation();if(result.expanded)
self.fold();else
self.expand();});result.expanded=false;}
if(result.indent)$li.addClass('oe-indent');$li.append($('<span>').html(result.label));return $li;},expand:function(){var self=this;var current_result=this.current_result;current_result.expand(this.get_search_string()).then(function(results){(results||[{label:'(no result)'}]).reverse().forEach(function(result){result.indent=true;var $li=self.make_list_item(result);current_result.$el.after($li);});current_result.expanded=true;current_result.$el.find('span.oe-expand').html('▼');});},fold:function(){var $next=this.current_result.$el.next();while($next.hasClass('oe-indent')){$next.remove();$next=this.current_result.$el.next();}
this.current_result.expanded=false;this.current_result.$el.find('span.oe-expand').html('▶');},focus_element:function($li){this.$('li').removeClass('oe-selection-focus');$li.addClass('oe-selection-focus');this.current_result=$li.data('result');},select_item:function(ev){if(this.current_result.facet){this.select(ev,{item:{facet:this.current_result.facet}});this.close();}},show:function(){this.$el.show();},close:function(){this.current_search=null;this.search_string='';this.searching=true;this.$el.hide();},move:function(direction){var $next;if(direction==='down'){$next=this.$('li.oe-selection-focus').nextAll(':not(.oe-separator)').first();if(!$next.length)$next=this.$('li:first-child');}else{$next=this.$('li.oe-selection-focus').prevAll(':not(.oe-separator)').first();if(!$next.length)$next=this.$('li:not(.oe-separator)').last();}
this.focus_element($next);},is_expandable:function(){return!!this.$('.oe-selection-focus .oe-expand').length;},});});;

/* /web/static/src/js/views/search_filters.js defined in bundle 'web.assets_backend' */
odoo.define('web.search_filters',function(require){"use strict";var core=require('web.core');var datepicker=require('web.datepicker');var formats=require('web.formats');var Widget=require('web.Widget');var _t=core._t;var _lt=core._lt;var ExtendedSearchProposition=Widget.extend({template:'SearchView.extended_search.proposition',events:{'change .searchview_extended_prop_field':'changed','change .searchview_extended_prop_op':'operator_changed','click .searchview_extended_delete_prop':function(e){e.stopPropagation();this.getParent().remove_proposition(this);},},init:function(parent,fields){this._super(parent);this.fields=_(fields).chain().map(function(val,key){return _.extend({},val,{'name':key});}).filter(function(field){return!field.deprecated&&field.searchable;}).sortBy(function(field){return field.string;}).value();this.attrs={_:_,fields:this.fields,selected:null};this.value=null;},start:function(){return this._super().done(this.proxy('changed'));},changed:function(){var nval=this.$(".searchview_extended_prop_field").val();if(this.attrs.selected===null||this.attrs.selected===undefined||nval!=this.attrs.selected.name){this.select_field(_.detect(this.fields,function(x){return x.name==nval;}));}},operator_changed:function(e){var $value=this.$('.searchview_extended_prop_value');switch($(e.target).val()){case'∃':case'∄':$value.hide();break;default:$value.show();}},select_field:function(field){var self=this;if(this.attrs.selected!==null&&this.attrs.selected!==undefined){this.value.destroy();this.value=null;this.$('.searchview_extended_prop_op').html('');}
this.attrs.selected=field;if(field===null||field===undefined){return;}
var type=field.type;var Field=core.search_filters_registry.get_any([type,"char"]);this.value=new Field(this,field);_.each(this.value.operators,function(operator){$('<option>',{value:operator.value}).text(String(operator.text)).appendTo(self.$('.searchview_extended_prop_op'));});var $value_loc=this.$('.searchview_extended_prop_value').show().empty();this.value.appendTo($value_loc);},get_filter:function(){if(this.attrs.selected===null||this.attrs.selected===undefined)
return null;var field=this.attrs.selected,op_select=this.$('.searchview_extended_prop_op')[0],operator=op_select.options[op_select.selectedIndex];return{attrs:{domain:[this.value.get_domain(field,operator)],string:this.value.get_label(field,operator),},children:[],tag:'filter',};},});ExtendedSearchProposition.Field=Widget.extend({init:function(parent,field){this._super(parent);this.field=field;},get_label:function(field,operator){var format;switch(operator.value){case'∃':case'∄':format=_t('%(field)s %(operator)s');break;default:format=_t('%(field)s %(operator)s "%(value)s"');break;}
return this.format_label(format,field,operator);},format_label:function(format,field,operator){return _.str.sprintf(format,{field:field.string,operator:operator.label||operator.text,value:this});},get_domain:function(field,operator){switch(operator.value){case'∃':return this.make_domain(field.name,'!=',false);case'∄':return this.make_domain(field.name,'=',false);default:return this.make_domain(field.name,operator.value,this.get_value());}},make_domain:function(field,operator,value){return[field,operator,value];},toString:function(){return this.get_value();}});ExtendedSearchProposition.Char=ExtendedSearchProposition.Field.extend({template:'SearchView.extended_search.proposition.char',operators:[{value:"ilike",text:_lt("contains")},{value:"not ilike",text:_lt("doesn't contain")},{value:"=",text:_lt("is equal to")},{value:"!=",text:_lt("is not equal to")},{value:"∃",text:_lt("is set")},{value:"∄",text:_lt("is not set")}],get_value:function(){return this.$el.val();}});ExtendedSearchProposition.DateTime=ExtendedSearchProposition.Field.extend({template:'SearchView.extended_search.proposition.empty',operators:[{value:"=",text:_lt("is equal to")},{value:"!=",text:_lt("is not equal to")},{value:">",text:_lt("greater than")},{value:"<",text:_lt("less than")},{value:">=",text:_lt("greater than or equal to")},{value:"<=",text:_lt("less than or equal to")},{value:"∃",text:_lt("is set")},{value:"∄",text:_lt("is not set")}],widget:function(){return datepicker.DateTimeWidget;},get_value:function(){return this.datewidget.get_value();},toString:function(){return formats.format_value(this.get_value(),{type:"datetime"});},start:function(){var ready=this._super();this.datewidget=new(this.widget())(this);this.datewidget.appendTo(this.$el);return ready;}});ExtendedSearchProposition.Date=ExtendedSearchProposition.DateTime.extend({widget:function(){return datepicker.DateWidget;},toString:function(){return formats.format_value(this.get_value(),{type:"date"});}});ExtendedSearchProposition.Integer=ExtendedSearchProposition.Field.extend({template:'SearchView.extended_search.proposition.integer',operators:[{value:"=",text:_lt("is equal to")},{value:"!=",text:_lt("is not equal to")},{value:">",text:_lt("greater than")},{value:"<",text:_lt("less than")},{value:">=",text:_lt("greater than or equal to")},{value:"<=",text:_lt("less than or equal to")},{value:"∃",text:_lt("is set")},{value:"∄",text:_lt("is not set")}],toString:function(){return this.$el.val();},get_value:function(){try{var val=this.$el.val();return formats.parse_value(val===""?0:val,{'widget':'integer'});}catch(e){return"";}}});ExtendedSearchProposition.Id=ExtendedSearchProposition.Integer.extend({operators:[{value:"=",text:_lt("is")}]});ExtendedSearchProposition.Float=ExtendedSearchProposition.Field.extend({template:'SearchView.extended_search.proposition.float',operators:[{value:"=",text:_lt("is equal to")},{value:"!=",text:_lt("is not equal to")},{value:">",text:_lt("greater than")},{value:"<",text:_lt("less than")},{value:">=",text:_lt("greater than or equal to")},{value:"<=",text:_lt("less than or equal to")},{value:"∃",text:_lt("is set")},{value:"∄",text:_lt("is not set")}],init:function(parent){this._super(parent);this.decimal_point=_t.database.parameters.decimal_point;},toString:function(){return this.$el.val();},get_value:function(){try{var val=this.$el.val();return formats.parse_value(val===""?0.0:val,{'widget':'float'});}catch(e){return"";}}});ExtendedSearchProposition.Selection=ExtendedSearchProposition.Field.extend({template:'SearchView.extended_search.proposition.selection',operators:[{value:"=",text:_lt("is")},{value:"!=",text:_lt("is not")},{value:"∃",text:_lt("is set")},{value:"∄",text:_lt("is not set")}],toString:function(){var select=this.$el[0];var option=select.options[select.selectedIndex];return option.label||option.text;},get_value:function(){return this.$el.val();}});ExtendedSearchProposition.Boolean=ExtendedSearchProposition.Field.extend({template:'SearchView.extended_search.proposition.empty',operators:[{value:"=",text:_lt("is true")},{value:"!=",text:_lt("is false")}],get_label:function(field,operator){return this.format_label(_t('%(field)s %(operator)s'),field,operator);},get_value:function(){return true;}});core.search_filters_registry.add('char',ExtendedSearchProposition.Char).add('text',ExtendedSearchProposition.Char).add('one2many',ExtendedSearchProposition.Char).add('many2one',ExtendedSearchProposition.Char).add('many2many',ExtendedSearchProposition.Char).add('datetime',ExtendedSearchProposition.DateTime).add('date',ExtendedSearchProposition.Date).add('integer',ExtendedSearchProposition.Integer).add('float',ExtendedSearchProposition.Float).add('monetary',ExtendedSearchProposition.Float).add('boolean',ExtendedSearchProposition.Boolean).add('selection',ExtendedSearchProposition.Selection).add('id',ExtendedSearchProposition.Id);return{ExtendedSearchProposition:ExtendedSearchProposition};});;

/* /web/static/src/js/views/search_inputs.js defined in bundle 'web.assets_backend' */
odoo.define('web.search_inputs',function(require){"use strict";var core=require('web.core');var data=require('web.data');var formats=require('web.formats');var Model=require('web.DataModel');var pyeval=require('web.pyeval');var time=require('web.time');var utils=require('web.utils');var Widget=require('web.Widget');var _t=core._t;var _lt=core._lt;var Input=Widget.extend({init:function(parent){this._super(parent);this.searchview=parent;this.load_attrs({});},complete:function(value){return $.when(null);},facet_for_defaults:function(defaults){if(!this.attrs||!(this.attrs.name in defaults&&defaults[this.attrs.name])){return $.when(null);}
return this.facet_for(defaults[this.attrs.name]);},get_context:function(){throw new Error("get_context not implemented for widget "+this.attrs.type);},get_groupby:function(){throw new Error("get_groupby not implemented for widget "+this.attrs.type);},get_domain:function(){throw new Error("get_domain not implemented for widget "+this.attrs.type);},load_attrs:function(attrs){attrs.modifiers=attrs.modifiers?JSON.parse(attrs.modifiers):{};this.attrs=attrs;},visible:function(){return!this.attrs.modifiers.invisible;},});var Field=Input.extend({template:'SearchView.field',default_operator:'=',init:function(view_section,field,parent){this._super(parent);this.load_attrs(_.extend({},field,view_section.attrs));},facet_for:function(value){return $.when({field:this,category:this.attrs.string||this.attrs.name,values:[{label:String(value),value:value}]});},value_from:function(facetValue){return facetValue.get('value');},get_context:function(facet){var self=this;var context=this.attrs.context;if(_.isEmpty(context)||!facet.values.length){return;}
var contexts=facet.values.map(function(facetValue){return new data.CompoundContext(context).set_eval_context({self:self.value_from(facetValue)});});if(contexts.length===1){return contexts[0];}
return _.extend(new data.CompoundContext(),{__contexts:contexts});},get_groupby:function(){},make_domain:function(name,operator,facet){return[[name,operator,this.value_from(facet)]];},get_domain:function(facet){if(!facet.values.length){return;}
var value_to_domain;var self=this;var domain=this.attrs.filter_domain;if(domain){value_to_domain=function(facetValue){return new data.CompoundDomain(domain).set_eval_context({self:self.value_from(facetValue)});};}else{value_to_domain=function(facetValue){return self.make_domain(self.attrs.name,self.attrs.operator||self.default_operator,facetValue);};}
var domains=facet.values.map(value_to_domain);if(domains.length===1){return domains[0];}
for(var i=domains.length;--i;){domains.unshift(['|']);}
return _.extend(new data.CompoundDomain(),{__domains:domains});}});var CharField=Field.extend({default_operator:'ilike',complete:function(value){if(_.isEmpty(value)){return $.when(null);}
var label=_.str.sprintf(_.str.escapeHTML(_t("Search %(field)s for: %(value)s")),{field:'<em>'+_.escape(this.attrs.string)+'</em>',value:'<strong>'+_.escape(value)+'</strong>'});return $.when([{label:label,facet:{category:this.attrs.string,field:this,values:[{label:value,value:value}]}}]);}});var NumberField=Field.extend({complete:function(value){var val=this.parse(value);if(isNaN(val)){return $.when();}
var label=_.str.sprintf(_t("Search %(field)s for: %(value)s"),{field:'<em>'+_.escape(this.attrs.string)+'</em>',value:'<strong>'+_.escape(value)+'</strong>'});return $.when([{label:label,facet:{category:this.attrs.string,field:this,values:[{label:value,value:val}]}}]);},});var IntegerField=NumberField.extend({error_message:_t("not a valid integer"),parse:function(value){try{return formats.parse_value(value,{'widget':'integer'});}catch(e){return NaN;}}});var FloatField=NumberField.extend({error_message:_t("not a valid number"),parse:function(value){try{return formats.parse_value(value,{'widget':'float'});}catch(e){return NaN;}}});function facet_from(field,pair){return{field:field,category:field.attrs.string,values:[{label:pair[1],value:pair[0]}]};}
var SelectionField=Field.extend({template:'SearchView.field.selection',init:function(){this._super.apply(this,arguments);this.prepend_empty=!_(this.attrs.selection).detect(function(item){return!item[1];});},complete:function(needle){var self=this;var results=_(this.attrs.selection).chain().filter(function(sel){var value=sel[0],label=sel[1];if(value===undefined||!label){return false;}
return label.toLowerCase().indexOf(needle.toLowerCase())!==-1;}).map(function(sel){return{label:_.escape(sel[1]),indent:true,facet:facet_from(self,sel)};}).value();if(_.isEmpty(results)){return $.when(null);}
return $.when.call(null,[{label:_.escape(this.attrs.string)}].concat(results));},facet_for:function(value){var match=_(this.attrs.selection).detect(function(sel){return sel[0]===value;});if(!match){return $.when(null);}
return $.when(facet_from(this,match));}});var BooleanField=SelectionField.extend({init:function(){this._super.apply(this,arguments);this.attrs.selection=[[true,_t("Yes")],[false,_t("No")]];}});var DateField=Field.extend({value_from:function(facetValue){return time.date_to_str(facetValue.get('value'));},complete:function(needle){var m=moment(needle,'L');if(!m.isValid()){return $.when(null);}
var d=m.toDate();var date_string=formats.format_value(d,this.attrs);var label=_.str.sprintf(_.str.escapeHTML(_t("Search %(field)s at: %(value)s")),{field:'<em>'+_.escape(this.attrs.string)+'</em>',value:'<strong>'+date_string+'</strong>'});return $.when([{label:label,facet:{category:this.attrs.string,field:this,values:[{label:date_string,value:d}]}}]);}});var DateTimeField=DateField.extend({value_from:function(facetValue){return time.datetime_to_str(facetValue.get('value'));}});var ManyToOneField=CharField.extend({default_operator:{},init:function(view_section,field,parent){this._super(view_section,field,parent);this.model=new Model(this.attrs.relation);this.searchview=parent;},complete:function(value){if(_.isEmpty(value)){return $.when(null);}
var label=_.str.sprintf(_.str.escapeHTML(_t("Search %(field)s for: %(value)s")),{field:'<em>'+_.escape(this.attrs.string)+'</em>',value:'<strong>'+_.escape(value)+'</strong>'});return $.when([{label:label,facet:{category:this.attrs.string,field:this,values:[{label:value,value:value,operator:'ilike'}]},expand:this.expand.bind(this),}]);},expand:function(needle){var self=this;var context=pyeval.eval('contexts',[this.searchview.dataset.get_context()]);var args=this.attrs.domain;if(typeof args==='string'){try{args=pyeval.eval('domain',args);}catch(e){args=[];}}
return this.model.call('name_search',[],{name:needle,args:args,limit:8,context:context}).then(function(results){if(_.isEmpty(results)){return null;}
return _(results).map(function(result){return{label:_.escape(result[1]),facet:facet_from(self,result)};});});},facet_for:function(value){var self=this;if(value instanceof Array){if(value.length===2&&_.isString(value[1])){return $.when(facet_from(this,value));}
utils.assert(value.length<=1,_t("M2O search fields do not currently handle multiple default values"));value=value[0];}
var context=pyeval.eval('contexts',[this.searchview.dataset.get_context()]);return this.model.call('name_get',[value],{context:context}).then(function(names){if(_(names).isEmpty()){return null;}
return facet_from(self,names[0]);});},value_from:function(facetValue){return facetValue.get('label');},make_domain:function(name,operator,facetValue){operator=facetValue.get('operator')||operator;switch(operator){case this.default_operator:return[[name,'=',facetValue.get('value')]];case'ilike':return[[name,'ilike',facetValue.get('value')]];case'child_of':return[[name,'child_of',facetValue.get('value')]];}
return this._super(name,operator,facetValue);},get_context:function(facet){var values=facet.values;if(_.isEmpty(this.attrs.context)&&values.length===1){var c={};var v=values.at(0);if(v.get('operator')!=='ilike'){c['default_'+this.attrs.name]=v.get('value');}
return c;}
return this._super(facet);}});var FilterGroup=Input.extend({template:'SearchView.filters',icon:"fa-filter",completion_label:_lt("Filter on: %s"),init:function(filters,parent){if(!(this instanceof GroupbyGroup)&&_(filters).all(function(f){if(!f.attrs.context){return false;}
var c=pyeval.eval('context',f.attrs.context);return!_.isEmpty(c.group_by);})){return new GroupbyGroup(filters,parent);}
this._super(parent);this.filters=filters;this.searchview=parent;this.searchview.query.on('add remove change reset',this.proxy('search_change'));},start:function(){this.$el.on('click','a',this.proxy('toggle_filter'));return $.when(null);},search_change:function(){var self=this;var $filters=this.$el.removeClass('selected');var facet=this.searchview.query.find(_.bind(this.match_facet,this));if(!facet){return;}
facet.values.each(function(v){var i=_(self.filters).indexOf(v.get('value'));if(i===-1){return;}
$filters.filter(function(){return Number($(this).data('index'))===i;}).addClass('selected');});},match_facet:function(facet){return facet.get('field')===this;},make_facet:function(values){return{category:_t("Filter"),icon:this.icon,values:values,field:this};},make_value:function(filter){return{label:filter.attrs.string||filter.attrs.help||filter.attrs.name,value:filter};},facet_for_defaults:function(defaults){var self=this;var fs=_(this.filters).chain().filter(function(f){return f.attrs&&f.attrs.name&&!!defaults[f.attrs.name];}).map(function(f){return self.make_value(f);}).value();if(_.isEmpty(fs)){return $.when(null);}
return $.when(this.make_facet(fs));},get_context:function(facet){var contexts=facet.values.chain().map(function(f){return f.get('value').attrs.context;}).without('{}').reject(_.isEmpty).value();if(!contexts.length){return;}
if(contexts.length===1){return contexts[0];}
return _.extend(new data.CompoundContext(),{__contexts:contexts});},get_groupby:function(facet){return facet.values.chain().map(function(f){return f.get('value').attrs.context;}).without('{}').reject(_.isEmpty).value();},get_domain:function(facet){var domains=facet.values.chain().map(function(f){return f.get('value').attrs.domain;}).without('[]').reject(_.isEmpty).value();if(!domains.length){return;}
if(domains.length===1){return domains[0];}
for(var i=domains.length;--i;){domains.unshift(['|']);}
return _.extend(new data.CompoundDomain(),{__domains:domains});},toggle_filter:function(e){e.stopPropagation();this.toggle(this.filters[Number($(e.target).parent().data('index'))]);},toggle:function(filter,options){this.searchview.query.toggle(this.make_facet([this.make_value(filter)]),options);},is_visible:function(){return _.some(this.filters,function(filter){return!filter.attrs.invisible;});},complete:function(item){var self=this;item=item.toLowerCase();var facet_values=_(this.filters).chain().filter(function(filter){return filter.visible();}).filter(function(filter){var at={string:filter.attrs.string||'',help:filter.attrs.help||'',name:filter.attrs.name||''};var include=_.str.include;return include(at.string.toLowerCase(),item)||include(at.help.toLowerCase(),item)||include(at.name.toLowerCase(),item);}).map(this.make_value).value();if(_(facet_values).isEmpty()){return $.when(null);}
return $.when(_.map(facet_values,function(facet_value){return{label:_.str.sprintf(self.completion_label.toString(),_.escape(facet_value.label)),facet:self.make_facet([facet_value])};}));}});var GroupbyGroup=FilterGroup.extend({icon:'fa-bars',completion_label:_lt("Group by: %s"),init:function(filters,parent){this._super(filters,parent);this.searchview=parent;if(!this.searchview._s_groupby){this.searchview._s_groupby={help:"See GroupbyGroup#init",get_context:this.proxy('get_context'),get_domain:this.proxy('get_domain'),get_groupby:this.proxy('get_groupby')};}},match_facet:function(facet){return facet.get('field')===this.searchview._s_groupby;},make_facet:function(values){return{category:_t("Group By"),icon:this.icon,values:values,field:this.searchview._s_groupby};}});var Filter=Input.extend({template:'SearchView.filter',init:function(node,parent){this._super(parent);this.load_attrs(node.attrs);},facet_for:function(){return $.when(null);},get_context:function(){},get_domain:function(){},});core.search_widgets_registry.add('char',CharField).add('text',CharField).add('html',CharField).add('boolean',BooleanField).add('integer',IntegerField).add('id',IntegerField).add('float',FloatField).add('monetary',FloatField).add('selection',SelectionField).add('datetime',DateTimeField).add('date',DateField).add('many2one',ManyToOneField).add('many2many',CharField).add('one2many',CharField);return{FilterGroup:FilterGroup,Filter:Filter,Field:Field,GroupbyGroup:GroupbyGroup,};});;

/* /web/static/src/js/views/search_menus.js defined in bundle 'web.assets_backend' */
odoo.define('web.FavoriteMenu',function(require){"use strict";var core=require('web.core');var Model=require('web.DataModel');var pyeval=require('web.pyeval');var session=require('web.session');var Widget=require('web.Widget');var _t=core._t;return Widget.extend({template:'SearchView.FavoriteMenu',events:{'click li':function(event){event.stopImmediatePropagation();},'click .oe-save-search a':function(){this.toggle_save_menu();},'click .oe-save-name button':'save_favorite','hidden.bs.dropdown':'close_menus','keyup .oe-save-name input':function(ev){if(ev.which===$.ui.keyCode.ENTER){this.save_favorite();}},},init:function(parent,query,target_model,action_id){this._super.apply(this,arguments);this.searchview=parent;this.query=query;this.target_model=target_model;this.model=new Model('ir.filters');this.filters={};this.$filters={};this.action_id=action_id;},start:function(){var self=this;this.$save_search=this.$('.oe-save-search');this.$save_name=this.$('.oe-save-name');this.$inputs=this.$save_name.find('input');this.$divider=this.$('.divider');this.$inputs.eq(0).val(this.searchview.get_title());var $shared_filter=this.$inputs.eq(1),$default_filter=this.$inputs.eq(2);$shared_filter.click(function(){$default_filter.prop('checked',false);});$default_filter.click(function(){$shared_filter.prop('checked',false);});this.query.on('remove',function(facet){if(facet.get('is_custom_filter')){self.clear_selection();}}).on('reset',this.proxy('clear_selection'));return this.model.call('get_filters',[this.target_model,this.action_id],{context:this.searchview.dataset.context}).done(this.proxy('prepare_dropdown_menu'));},prepare_dropdown_menu:function(filters){filters.map(this.append_filter.bind(this));},toggle_save_menu:function(is_open){this.$save_search.toggleClass('o_closed_menu',!(_.isUndefined(is_open))?!is_open:undefined).toggleClass('o_open_menu',is_open);this.$save_name.toggle(is_open);if(this.$save_search.hasClass('o_open_menu')){this.$save_name.find('input').first().focus();}},close_menus:function(){this.toggle_save_menu(false);},save_favorite:function(){var self=this,filter_name=this.$inputs[0].value,default_filter=this.$inputs[1].checked,shared_filter=this.$inputs[2].checked;if(!filter_name.length){this.do_warn(_t("Error"),_t("Filter name is required."));this.$inputs.first().focus();return;}
if(_.chain(this.filters).pluck('name').contains(filter_name).value()){this.do_warn(_t("Error"),_t("Filter with same name already exists."));this.$inputs.first().focus();return;}
var search=this.searchview.build_search_data(),view_manager=this.findAncestor(function(a){return'active_view'in a;}),view_context=view_manager?view_manager.active_view.controller.get_context():{},results=pyeval.sync_eval_domains_and_contexts({domains:search.domains,contexts:search.contexts.concat(view_context||[]),group_by_seq:search.groupbys||[],});if(!_.isEmpty(results.group_by)){results.context.group_by=results.group_by;}
var ctx=results.context;_(_.keys(session.user_context)).each(function(key){delete ctx[key];});var filter={name:filter_name,user_id:shared_filter?false:session.uid,model_id:this.searchview.dataset.model,context:results.context,domain:results.domain,sort:JSON.stringify(this.searchview.dataset._sort),is_default:default_filter,action_id:this.action_id,};return this.model.call('create_or_replace',[filter]).done(function(id){filter.id=id;self.toggle_save_menu(false);self.$save_name.find('input').val('').prop('checked',false);self.append_filter(filter);self.toggle_filter(filter,true);});},get_default_filter:function(){var self=this;var personal_filter=_.find(this.filters,function(filter){return parseInt(self.searchview.options.action.filter)==filter.id})||_.find(this.filters,function(filter){return filter.user_id&&filter.is_default;});if(personal_filter){return personal_filter;}
return _.find(this.filters,function(filter){return!filter.user_id&&filter.is_default;});},key_for:function(filter){var user_id=filter.user_id,action_id=filter.action_id,uid=(user_id instanceof Array)?user_id[0]:user_id,act_id=(action_id instanceof Array)?action_id[0]:action_id;return _.str.sprintf('(%s)(%s)%s',uid,act_id,filter.name);},facet_for:function(filter){return{category:_t("Custom Filter"),icon:'fa-star',field:{get_context:function(){return filter.context;},get_groupby:function(){return[filter.context];},get_domain:function(){return filter.domain;}},_id:filter.id,is_custom_filter:true,values:[{label:filter.name,value:null}]};},clear_selection:function(){this.$('li.selected').removeClass('selected');},append_filter:function(filter){var self=this,key=this.key_for(filter),$filter;this.$divider.show();if(key in this.$filters){$filter=this.$filters[key];}else{this.filters[key]=filter;$filter=$('<li></li>').insertBefore(this.$divider).toggleClass('oe_searchview_custom_default',filter.is_default).append($('<a>').text(filter.name));this.$filters[key]=$filter;this.$filters[key].addClass(filter.user_id?'oe_searchview_custom_private':'oe_searchview_custom_public');$('<span>').addClass('fa fa-trash-o remove-filter').click(function(event){event.stopImmediatePropagation();self.remove_filter(filter,$filter,key);}).appendTo($filter);}
this.$filters[key].unbind('click').click(function(){self.toggle_filter(filter);});},toggle_filter:function(filter,preventSearch){var current=this.query.find(function(facet){return facet.get('_id')===filter.id;});if(current){this.query.remove(current);this.$filters[this.key_for(filter)].removeClass('selected');return;}
this.query.reset([this.facet_for(filter)],{preventSearch:preventSearch||false});if(!_.isUndefined(filter.sort)){var sort_items=JSON.parse(filter.sort);this.searchview.dataset.set_sort(sort_items);}
this.$filters[this.key_for(filter)].addClass('selected');},remove_filter:function(filter,$filter,key){var self=this;var global_warning=_t("This filter is global and will be removed for everybody if you continue."),warning=_t("Are you sure that you want to remove this filter?");if(!confirm(filter.user_id?warning:global_warning)){return;}
this.model.call('unlink',[filter.id]).done(function(){$filter.remove();delete self.$filters[key];delete self.filters[key];if(_.isEmpty(self.filters)){self.$divider.hide();}});},});});odoo.define('web.FilterMenu',function(require){"use strict";var search_filters=require('web.search_filters');var search_inputs=require('web.search_inputs');var Widget=require('web.Widget');return Widget.extend({template:'SearchView.FilterMenu',events:{'click .oe-add-filter':function(){this.toggle_custom_filter_menu();},'click li':function(event){event.stopImmediatePropagation();},'hidden.bs.dropdown':function(){this.toggle_custom_filter_menu(false);},'click .oe-add-condition':'append_proposition','click .oe-apply-filter':'commit_search','keyup .searchview_extended_prop_value':function(ev){if(ev.which===$.ui.keyCode.ENTER){this.commit_search();}},},init:function(parent,filters,fields_def){this._super(parent);this.filters=filters||[];this.searchview=parent;this.propositions=[];this.fields_def=fields_def.then(function(data){var fields={id:{string:'ID',type:'id',searchable:true}};_.each(data,function(field_def,field_name){if(field_def.selectable!==false&&field_name!=='id'){fields[field_name]=field_def;}});return fields;});},start:function(){var self=this;this.$menu=this.$('.filters-menu');this.$add_filter=this.$('.oe-add-filter');this.$apply_filter=this.$('.oe-apply-filter');this.$add_filter_menu=this.$('.oe-add-filter-menu');_.each(this.filters,function(group){if(group.is_visible()){group.insertBefore(self.$add_filter);$('<li class="divider">').insertBefore(self.$add_filter);}});this.append_proposition().then(function(prop){prop.$el.hide();});},toggle_custom_filter_menu:function(is_open){this.$add_filter.toggleClass('o_closed_menu',!(_.isUndefined(is_open))?!is_open:undefined).toggleClass('o_open_menu',is_open);this.$add_filter_menu.toggle(is_open);if(this.$add_filter.hasClass('o_closed_menu')&&(!this.propositions.length)){this.append_proposition();}
this.$('.oe-filter-condition').toggle(is_open);},append_proposition:function(){var self=this;return this.fields_def.then(function(fields){var prop=new search_filters.ExtendedSearchProposition(self,fields);self.propositions.push(prop);prop.insertBefore(self.$add_filter_menu);self.$apply_filter.prop('disabled',false);return prop;});},remove_proposition:function(prop){this.propositions=_.without(this.propositions,prop);if(!this.propositions.length){this.$apply_filter.prop('disabled',true);}
prop.destroy();},commit_search:function(){var filters=_.invoke(this.propositions,'get_filter'),filters_widgets=_.map(filters,function(filter){return new search_inputs.Filter(filter,this);}),filter_group=new search_inputs.FilterGroup(filters_widgets,this.searchview),facets=filters_widgets.map(function(filter){return filter_group.make_facet([filter_group.make_value(filter)]);});filter_group.insertBefore(this.$add_filter);$('<li class="divider">').insertBefore(this.$add_filter);this.searchview.query.add(facets,{silent:true});this.searchview.query.trigger('reset');_.invoke(this.propositions,'destroy');this.propositions=[];this.append_proposition();this.toggle_custom_filter_menu(false);},});});odoo.define('web.GroupByMenu',function(require){"use strict";var Widget=require('web.Widget');var core=require('web.core');var search_inputs=require('web.search_inputs');var QWeb=core.qweb;return Widget.extend({template:'SearchView.GroupByMenu',events:{'click li':function(event){event.stopImmediatePropagation();},'hidden.bs.dropdown':function(){this.toggle_add_menu(false);},'click .add-custom-group a':function(){this.toggle_add_menu();},},init:function(parent,groups,fields_def){this._super(parent);this.groups=groups||[];this.groupable_fields=[];this.searchview=parent;this.fields_def=fields_def.then(this.proxy('get_groupable_fields'));},start:function(){var self=this;this.$menu=this.$('.group-by-menu');var divider=this.$menu.find('.divider');_.invoke(this.groups,'insertBefore',divider);if(this.groups.length){divider.show();}
this.$add_group=this.$menu.find('.add-custom-group');this.fields_def.then(function(){self.$menu.append(QWeb.render('GroupByMenuSelector',self));self.$add_group_menu=self.$('.oe-add-group');self.$group_selector=self.$('.oe-group-selector');self.$('.oe-select-group').click(function(){self.toggle_add_menu(false);var field=self.$group_selector.find(':selected').data('name');self.add_groupby_to_menu(field);});});},get_groupable_fields:function(fields){var groupable_types=['many2one','char','boolean','selection','date','datetime'];var filter_group_field=_.filter(fields,function(field,name){if(field.store&&_.contains(groupable_types,field.type)){field.name=name;return field;}});this.groupable_fields=_.sortBy(filter_group_field,'string');},toggle_add_menu:function(is_open){this.$add_group.toggleClass('o_closed_menu',!(_.isUndefined(is_open))?!is_open:undefined).toggleClass('o_open_menu',is_open);this.$add_group_menu.toggle(is_open);if(this.$add_group.hasClass('o_open_menu')){this.$group_selector.focus();}},add_groupby_to_menu:function(field_name){var filter=new search_inputs.Filter({attrs:{context:"{'group_by':'"+field_name+"''}",name:_.find(this.groupable_fields,{name:field_name}).string,}},this.searchview);var group=new search_inputs.FilterGroup([filter],this.searchview),divider=this.$('.divider').show();group.insertBefore(divider);group.toggle(filter);},});});;

/* /web/static/src/js/views/tree_view.js defined in bundle 'web.assets_backend' */
odoo.define('web.TreeView',function(require){"use strict";var core=require('web.core');var data=require('web.data');var formats=require('web.formats');var pyeval=require('web.pyeval');var session=require('web.session');var View=require('web.View');var _lt=core._lt;var QWeb=core.qweb;var TreeView=View.extend({display_name:_lt('Tree'),icon:'fa-align-left',view_type:'tree',searchable:false,init:function(parent,dataset,view_id,options){this._super(parent);this.dataset=dataset;this.model=dataset.model;this.view_id=view_id;this.records={};this.options=_.extend({},this.defaults,options||{});_.bindAll(this,'color_for');},view_loading:function(r){return this.load_tree(r);},fields_list:function(){var fields=_.keys(this.fields);if(!_(fields).contains(this.children_field)){fields.push(this.children_field);}
return fields;},load_tree:function(fields_view){var self=this;var has_toolbar=!!fields_view.arch.attrs.toolbar;this.children_field=fields_view.field_parent;this.fields_view=fields_view;_(this.fields_view.arch.children).each(function(field){if(field.attrs.modifiers){field.attrs.modifiers=JSON.parse(field.attrs.modifiers);}});this.fields=fields_view.fields;this.hook_row_click();this.$el.html(QWeb.render('TreeView',{'title':this.fields_view.arch.attrs.string,'fields_view':this.fields_view.arch.children,'fields':this.fields,'toolbar':has_toolbar}));this.$el.addClass(this.fields_view.arch.attrs['class']);this.dataset.read_slice(this.fields_list()).done(function(records){if(!has_toolbar){self.getdata(null,_(records).pluck('id'));return;}
var $select=self.$el.find('select').change(function(){var $option=$(this).find(':selected');self.getdata($option.val(),$option.data('children'));});_(records).each(function(record){self.records[record.id]=record;$('<option>').val(record.id).text(record.name).data('children',record[self.children_field]).appendTo($select);});if(!_.isEmpty(records)){$select.change();}});this.do_push_state({});if(!this.fields_view.arch.attrs.colors){return;}
this.colors=_(this.fields_view.arch.attrs.colors.split(';')).chain().compact().map(function(color_pair){var pair=color_pair.split(':'),color=pair[0],expr=pair[1];return[color,py.parse(py.tokenize(expr)),expr];}).value();},color_for:function(record){if(!this.colors){return'';}
var context=_.extend({},record,{uid:session.uid,current_date:moment().format('YYYY-MM-DD')});for(var i=0,len=this.colors.length;i<len;++i){var pair=this.colors[i],color=pair[0],expression=pair[1];if(py.PY_isTrue(py.evaluate(expression,context))){return'color: '+color+';';}}
return'';},hook_row_click:function(){var self=this;this.$el.delegate('.treeview-td span, .treeview-tr span','click',function(e){e.stopImmediatePropagation();self.activate($(this).closest('tr').data('id'));});this.$el.delegate('.treeview-tr','click',function(){var is_loaded=0,$this=$(this),record_id=$this.data('id'),row_parent_id=$this.data('row-parent-id'),record=self.records[record_id],children_ids=record[self.children_field];_(children_ids).each(function(childid){var sib=$this.parent().next();var $el=$();while(sib.data('level')==$this.parent().data('level')+1){if(sib.data("row-parent-id")==record_id&&sib.attr('id')=='treerow_'+childid){$el=sib;}
sib=sib.next();}
if($el.length){if($el.is(':hidden')){is_loaded=-1;}else{is_loaded++;}}});if(is_loaded===0){if(!$this.parent().hasClass('oe_open')){self.getdata(record_id,children_ids,$this.parent());}}else{self.showcontent($this,record_id,is_loaded<0);}});},getdata:function(id,children_ids,$node){var self=this;self.dataset.read_ids(children_ids,this.fields_list()).done(function(records){_(records).each(function(record){self.records[record.id]=record;});var $curr_node=$node||$();var children_rows=QWeb.render('TreeView.rows',{'records':records,'children_field':self.children_field,'fields_view':self.fields_view.arch.children,'fields':self.fields,'level':$curr_node.data('level')||0,'render':formats.format_value,'color_for':self.color_for,'row_parent_id':id});if($curr_node.length){$curr_node.addClass('oe_open');$curr_node.after(children_rows);}else{self.$el.find('tbody').html(children_rows);}});},activate:function(id){var self=this;var local_context={active_model:self.dataset.model,active_id:id,active_ids:[id]};var ctx=pyeval.eval('context',new data.CompoundContext(this.dataset.get_context(),local_context));return this.rpc('/web/treeview/action',{id:id,model:this.dataset.model,context:ctx}).then(function(actions){if(!actions.length){return;}
var action=actions[0][2];var c=new data.CompoundContext(local_context).set_eval_context(ctx);if(action.context){c.add(action.context);}
action.context=c;return self.do_action(action);});},showcontent:function(curnode,record_id,show){curnode.parent('tr').toggleClass('oe_open',show);var current_level=curnode.parent('tr').data('level');var $row=curnode.parent('tr').next();while($row.data('level')>current_level){if(!show||show&&$row.data('level')==current_level+1){if($row.hasClass('oe_open')){$row.toggleClass('oe_open',show);}
$row.toggle(show);}
$row=$row.next();}},do_hide:function(){this.hidden=true;this._super();}});core.view_registry.add('tree',TreeView);return TreeView;});;

/* /web/static/src/js/views/simple_view.js defined in bundle 'web.assets_backend' */
odoo.define('web.SimpleView',function(require){"use strict";var core=require('web.core');var data=require('web.data');var formats=require('web.formats');var pyeval=require('web.pyeval');var session=require('web.session');var View=require('web.View');var Model=require('web.DataModel');var _lt=core._lt;var QWeb=core.qweb;var SimpleView=View.extend({display_name:_lt('Simple'),view_type:'simple',searchview_hidden:true,searchable:false,view_loading:function(r){return this.load_template(r);},load_template:function(data){var MyView=new Model('ir.ui.view');var self=this;MyView.query().filter([['id','=',this.ViewManager.action.view_id[0]]]).first().then(function(data){var IterateOver=new Model(data.model);QWeb.add_template(data.arch);var template_name=data.arch;template_name=template_name.replace('<simple>','');template_name=template_name.replace('</simple>','');template_name=template_name.replace(/\s+/g,'');IterateOver.query().all().then(function(model){self.$el.html(QWeb.render(template_name,{model:model}));});});},});core.view_registry.add('simple',SimpleView);return SimpleView;});;

/* /web/static/src/js/apps.js defined in bundle 'web.assets_backend' */
odoo.define('base.apps',function(require){"use strict";var core=require('web.core');var framework=require('web.framework');var Model=require('web.DataModel');var session=require('web.session');var web_client=require('web.web_client');var Widget=require('web.Widget');var _t=core._t;var qweb=core.qweb;var apps_client=null;var Apps=Widget.extend({template:'EmptyComponent',remote_action_tag:'loempia.embed',failback_action_id:'base.open_module_tree',init:function(parent,action){this._super(parent,action);var options=action.params||{};this.params=options;},get_client:function(){var check_client_available=function(client){var d=$.Deferred();var i=new Image();i.onerror=function(){d.reject(client);};i.onload=function(){d.resolve(client);};var ts=new Date().getTime();i.src=_.str.sprintf('%s/web/static/src/img/sep-a.gif?%s',client.origin,ts);return d.promise();};if(apps_client){return check_client_available(apps_client);}else{var Mod=new Model('ir.module.module');return Mod.call('get_apps_server').then(function(u){var link=$(_.str.sprintf('<a href="%s"></a>',u))[0];var host=_.str.sprintf('%s//%s',link.protocol,link.host);var dbname=link.pathname;if(dbname[0]==='/'){dbname=dbname.substr(1);}
var client={origin:host,dbname:dbname};apps_client=client;return check_client_available(client);});}},destroy:function(){$(window).off("message.apps");if(this.$ifr){this.$ifr.remove();this.$ifr=null;}
return this._super();},_on_message:function($e){var self=this,client=this.client,e=$e.originalEvent;if(e.origin!==client.origin){return;}
var dispatcher={'event':function(m){self.trigger('message:'+m.event,m);},'action':function(m){self.do_action(m.action).then(function(r){var w=self.$ifr[0].contentWindow;w.postMessage({id:m.id,result:r},client.origin);});},'rpc':function(m){self.session.rpc.apply(self.session,m.args).then(function(r){var w=self.$ifr[0].contentWindow;w.postMessage({id:m.id,result:r},client.origin);});},'Model':function(m){var M=new Model(m.model);M[m.method].apply(M,m.args).then(function(r){var w=self.$ifr[0].contentWindow;w.postMessage({id:m.id,result:r},client.origin);});},};if(!_.isObject(e.data)){return;}
if(dispatcher[e.data.type]){dispatcher[e.data.type](e.data);}},start:function(){var self=this;return self.get_client().done(function(client){self.client=client;var qs=(session.debug?'debug&':'')+'db='+client.dbname;var u=client.origin+'/apps/embed/client?'+qs;var css={width:'100%',height:'400px'};self.$ifr=$('<iframe>').attr('src',u);$(window).on("message.apps",self.proxy('_on_message'));self.on('message:ready',self,function(m){var w=this.$ifr[0].contentWindow;var act={type:'ir.actions.client',tag:this.remote_action_tag,params:_.extend({},this.params,{db:this.session.db,origin:this.session.origin,})};w.postMessage({type:'action',action:act},client.origin);});self.on('message:set_height',self,function(m){this.$ifr.height(m.height);});self.on('message:update_count',self,function(m){var count=m.count;var get_upd_menu_id=function(){if(_.isUndefined(self._upd_menu_id)){var IMD=new Model('ir.model.data');return IMD.call('get_object_reference',['base','menu_module_updates']).then(function(r){var mid=r[1];if(r[0]!=='ir.ui.menu'){mid=null;}
self._upd_menu_id=mid;return mid;});}else{return $.Deferred().resolve(self._upd_menu_id).promise();}};$.when(get_upd_menu_id()).done(function(menu_id){if(_.isNull(menu_id)){return;}
var $menu=web_client.menu.$secondary_menus.find(_.str.sprintf('a[data-menu=%s]',menu_id));if($menu.length===0){return;}
if(_.isUndefined(count)){count=0;}
var needupdate=$menu.find('#menu_counter');if(needupdate&&needupdate.length!==0){if(count>0){needupdate.text(count);}else{needupdate.remove();}}else if(count>0){$menu.append(qweb.render("Menu.needaction_counter",{widget:{needaction_counter:count}}));}});});self.on('message:blockUI',self,function(){framework.blockUI();});self.on('message:unblockUI',self,function(){framework.unblockUI();});self.on('message:warn',self,function(m){self.do_warn(m.title,m.message,m.sticky);});self.$ifr.appendTo(self.$el).css(css).addClass('apps-client');}).fail(function(client){self.do_warn(_t('Odoo Apps will be available soon'),_t('Showing locally available modules'),true);self.rpc('/web/action/load',{action_id:self.failback_action_id}).done(function(action){self.do_action(action);web_client.menu.open_action(action.id);});});},});var AppsUpdates=Apps.extend({remote_action_tag:'loempia.embed.updates',});core.action_registry.add("apps",Apps);core.action_registry.add("apps.updates",AppsUpdates);});;

/* /base_import/static/lib/javascript-state-machine/state-machine.js defined in bundle 'web.assets_backend' */
(function(window){StateMachine={VERSION:"2.1.0",Result:{SUCCEEDED:1,NOTRANSITION:2,CANCELLED:3,ASYNC:4,},Error:{INVALID_TRANSITION:100,PENDING_TRANSITION:200,INVALID_CALLBACK:300,},WILDCARD:'*',ASYNC:'async',create:function(cfg,target){var initial=(typeof cfg.initial=='string')?{state:cfg.initial}:cfg.initial;var fsm=target||cfg.target||{};var events=cfg.events||[];var callbacks=cfg.callbacks||{};var map={};var add=function(e){var from=(e.from instanceof Array)?e.from:(e.from?[e.from]:[StateMachine.WILDCARD]);map[e.name]=map[e.name]||{};for(var n=0;n<from.length;n++)
map[e.name][from[n]]=e.to||from[n];};if(initial){initial.event=initial.event||'startup';add({name:initial.event,from:'none',to:initial.state});}
for(var n=0;n<events.length;n++)
add(events[n]);for(var name in map){if(map.hasOwnProperty(name))
fsm[name]=StateMachine.buildEvent(name,map[name]);}
for(var name in callbacks){if(callbacks.hasOwnProperty(name))
fsm[name]=callbacks[name]}
fsm.current='none';fsm.is=function(state){return this.current==state;};fsm.can=function(event){return!this.transition&&(map[event].hasOwnProperty(this.current)||map[event].hasOwnProperty(StateMachine.WILDCARD));}
fsm.cannot=function(event){return!this.can(event);};fsm.error=cfg.error||function(name,from,to,args,error,msg){throw msg;};if(initial&&!initial.defer)
fsm[initial.event]();return fsm;},doCallback:function(fsm,func,name,from,to,args){if(func){try{return func.apply(fsm,[name,from,to].concat(args));}
catch(e){return fsm.error(name,from,to,args,StateMachine.Error.INVALID_CALLBACK,"an exception occurred in a caller-provided callback function");}}},beforeEvent:function(fsm,name,from,to,args){return StateMachine.doCallback(fsm,fsm['onbefore'+name],name,from,to,args);},afterEvent:function(fsm,name,from,to,args){return StateMachine.doCallback(fsm,fsm['onafter'+name]||fsm['on'+name],name,from,to,args);},leaveState:function(fsm,name,from,to,args){return StateMachine.doCallback(fsm,fsm['onleave'+from],name,from,to,args);},enterState:function(fsm,name,from,to,args){return StateMachine.doCallback(fsm,fsm['onenter'+to]||fsm['on'+to],name,from,to,args);},changeState:function(fsm,name,from,to,args){return StateMachine.doCallback(fsm,fsm['onchangestate'],name,from,to,args);},buildEvent:function(name,map){return function(){var from=this.current;var to=map[from]||map[StateMachine.WILDCARD]||from;var args=Array.prototype.slice.call(arguments);if(this.transition)
return this.error(name,from,to,args,StateMachine.Error.PENDING_TRANSITION,"event "+name+" inappropriate because previous transition did not complete");if(this.cannot(name))
return this.error(name,from,to,args,StateMachine.Error.INVALID_TRANSITION,"event "+name+" inappropriate in current state "+this.current);if(false===StateMachine.beforeEvent(this,name,from,to,args))
return StateMachine.CANCELLED;if(from===to){StateMachine.afterEvent(this,name,from,to,args);return StateMachine.NOTRANSITION;}
var fsm=this;this.transition=function(){fsm.transition=null;fsm.current=to;StateMachine.enterState(fsm,name,from,to,args);StateMachine.changeState(fsm,name,from,to,args);StateMachine.afterEvent(fsm,name,from,to,args);};var leave=StateMachine.leaveState(this,name,from,to,args);if(false===leave){this.transition=null;return StateMachine.CANCELLED;}
else if("async"===leave){return StateMachine.ASYNC;}
else{if(this.transition)
this.transition();return StateMachine.SUCCEEDED;}};}};if("function"===typeof define){define("statemachine",[],function(){return StateMachine;});}
else{window.StateMachine=StateMachine;}}(this));;

/* /base_import/static/src/js/import.js defined in bundle 'web.assets_backend' */
odoo.define('base_import.import',function(require){"use strict";var ControlPanelMixin=require('web.ControlPanelMixin');var core=require('web.core');var ListView=require('web.ListView');var Model=require('web.DataModel');var session=require('web.session');var Widget=require('web.Widget');var QWeb=core.qweb;var _t=core._t;var _lt=core._lt;var StateMachine=window.StateMachine;function jsonp(form,attributes,callback){attributes=attributes||{};var options={jsonp:_.uniqueId('import_callback_')};window[options.jsonp]=function(){delete window[options.jsonp];callback.apply(null,arguments);};if('data'in attributes){_.extend(attributes.data,options);}else{_.extend(attributes,{data:options});}
_.extend(attributes,{dataType:'script',});$(form).ajaxSubmit(attributes);}
ListView.prototype.defaults.import_enabled=true;ListView.include({render_buttons:function(){var self=this;var add_button=false;if(!this.$buttons){add_button=true;}
this._super.apply(this,arguments);if(add_button){this.$buttons.on('click','.o_list_button_import',function(){self.do_action({type:'ir.actions.client',tag:'import',params:{model:self.dataset.model,context:self.getParent().action.context,}},{on_reverse_breadcrumb:function(){return self.reload();},});return false;});}
return this.$buttons;}});var DataImport=Widget.extend(ControlPanelMixin,{template:'ImportView',opts:[{name:'encoding',label:_lt("Encoding:"),value:'utf-8'},{name:'separator',label:_lt("Separator:"),value:','},{name:'quoting',label:_lt("Quoting:"),value:'"'}],events:{'change .oe_import_file':'loaded_file','click .oe_import_file_reload':'loaded_file','change input.oe_import_has_header, .oe_import_options input':'settings_changed','click a.oe_import_toggle':function(e){e.preventDefault();var $el=$(e.target);($el.next().length?$el.next():$el.parent().next()).toggle();},'click .oe_import_report a.oe_import_report_count':function(e){e.preventDefault();$(e.target).parent().toggleClass('oe_import_report_showmore');},'click .oe_import_moreinfo_action a':function(e){e.preventDefault();var action=JSON.parse($(e.target).attr('data-action'));action.views=_(action.views).map(function(view){var id=view[0],type=view[1];return[id,type!=='tree'?type:action.view_type==='form'?'list':'tree'];});this.do_action(_.extend(action,{target:'new',flags:{search_view:true,display_title:true,pager:true,list:{selectable:false}}}));},},init:function(parent,action){this._super.apply(this,arguments);this.action_manager=parent;this.res_model=action.params.model;this.parent_context=action.params.context||{};this.id=null;this.Import=new Model('base_import.import');this.session=session;action.display_name=_t('Import a File');},start:function(){var self=this;this.setup_encoding_picker();this.setup_separator_picker();return $.when(this._super(),this.Import.call('create',[{'res_model':this.res_model}]).done(function(id){self.id=id;self.$('input[name=import_id]').val(id);self.render_buttons();var status={breadcrumbs:self.action_manager.get_breadcrumbs(),cp_content:{$buttons:self.$buttons},};self.update_control_panel(status);}));},render_buttons:function(){var self=this;this.$buttons=$(QWeb.render("ImportView.buttons",this));this.$buttons.filter('.o_import_validate').on('click',this.validate.bind(this));this.$buttons.filter('.o_import_import').on('click',this.import.bind(this));this.$buttons.filter('.o_import_cancel').on('click',function(e){e.preventDefault();self.exit();});},setup_encoding_picker:function(){this.$('input.oe_import_encoding').select2({width:'160px',query:function(q){var make=function(term){return{id:term,text:term};};var suggestions=_.map(('utf-8 utf-16 windows-1252 latin1 latin2 big5 '+'gb18030 shift_jis windows-1251 koir8_r').split(/\s+/),make);if(q.term){suggestions.unshift(make(q.term));}
q.callback({results:suggestions});},initSelection:function(e,c){return c({id:'utf-8',text:'utf-8'});}}).select2('val','utf-8');},setup_separator_picker:function(){this.$('input.oe_import_separator').select2({width:'160px',query:function(q){var suggestions=[{id:',',text:_t("Comma")},{id:';',text:_t("Semicolon")},{id:'\t',text:_t("Tab")},{id:' ',text:_t("Space")}];if(q.term){suggestions.unshift({id:q.term,text:q.term});}
q.callback({results:suggestions});},initSelection:function(e,c){return c({id:',',text:_t("Comma")});},});},import_options:function(){var self=this;var options={headers:this.$('input.oe_import_has_header').prop('checked')};_(this.opts).each(function(opt){options[opt.name]=self.$('input.oe_import_'+opt.name).val();});return options;},onfile_loaded:function(){this.$buttons.filter('.o_import_button').add(this.$('.oe_import_file_reload')).prop('disabled',true);if(!this.$('input.oe_import_file').val()){return;}
this.$el.removeClass('oe_import_preview oe_import_error');this.$el.find('.oe_import_toggle').toggle((this.$('input.oe_import_file')[0].files[0].type=="text/csv"));jsonp(this.$el,{url:'/base_import/set_file'},this.proxy('settings_changed'));},onpreviewing:function(){var self=this;this.$buttons.filter('.o_import_button').add(this.$('.oe_import_file_reload')).prop('disabled',true);this.$el.addClass('oe_import_with_file');this.$el.removeClass('oe_import_preview_error oe_import_error');this.$el.toggleClass('oe_import_noheaders',!this.$('input.oe_import_has_header').prop('checked'));this.Import.call('parse_preview',[this.id,this.import_options()]).done(function(result){var signal=result.error?'preview_failed':'preview_succeeded';self[signal](result);});},onpreview_error:function(event,from,to,result){this.$('.oe_import_options').show();this.$('.oe_import_file_reload').prop('disabled',false);this.$el.addClass('oe_import_preview_error oe_import_error');this.$('.oe_import_error_report').html(QWeb.render('ImportView.preview.error',result));},onpreview_success:function(event,from,to,result){this.$buttons.filter('.o_import_import').removeClass('btn-primary');this.$buttons.filter('.o_import_validate').addClass('btn-primary');this.$buttons.filter('.o_import_button').add(this.$('.oe_import_file_reload')).prop('disabled',false);this.$el.addClass('oe_import_preview');this.$('.oe_import_grid').html(QWeb.render('ImportView.preview',result));if(result.headers.length===1){this.$('.oe_import_options').show();this.onresults(null,null,null,[{type:'warning',message:_t("A single column was found in the file, this often means the file separator is incorrect")}]);}
var $fields=this.$('.oe_import_fields input');this.render_fields_matches(result,$fields);var data=this.generate_fields_completion(result);var item_finder=function(id,items){items=items||data;for(var i=0;i<items.length;++i){var item=items[i];if(item.id===id){return item;}
var val;if(item.children&&(val=item_finder(id,item.children))){return val;}}
return'';};$fields.select2({allowClear:true,minimumInputLength:0,data:data,initSelection:function(element,callback){var default_value=element.val();if(!default_value){callback('');return;}
callback(item_finder(default_value));},placeholder:_t('Don\'t import'),width:'resolve',dropdownCssClass:'oe_import_selector'});},generate_fields_completion:function(root){var basic=[];var regulars=[];var o2m=[];function traverse(field,ancestors,collection){var subfields=field.fields;var field_path=ancestors.concat(field);var label=_(field_path).pluck('string').join(' / ');var id=_(field_path).pluck('name').join('/');if(!collection){if(field.name==='id'){collection=basic;}else if(_.isEmpty(subfields)||_.isEqual(_.pluck(subfields,'name'),['id','.id'])){collection=regulars;}else{collection=o2m;}}
collection.push({id:id,text:label,required:field.required});for(var i=0,end=subfields.length;i<end;++i){traverse(subfields[i],field_path,collection);}}
_(root.fields).each(function(field){traverse(field,[]);});var cmp=function(field1,field2){return field1.text.localeCompare(field2.text);};regulars.sort(cmp);o2m.sort(cmp);return basic.concat([{text:_t("Normal Fields"),children:regulars},{text:_t("Relation Fields"),children:o2m}]);},render_fields_matches:function(result,$fields){if(_(result.matches).isEmpty()){return;}
$fields.each(function(index,input){var match=result.matches[index];if(!match){return;}
var current_field=result;input.value=_(match).chain().map(function(name){return current_field=_(current_field.fields).find(function(subfield){return subfield.name===name;});}).pluck('name').value().join('/');});},call_import:function(kwargs){var fields=this.$('.oe_import_fields input.oe_import_match_field').map(function(index,el){return $(el).select2('val')||false;}).get();kwargs.context=_.extend({},this.parent_context,{tracking_disable:!this.$('#oe_import_tracking').prop('checked')});return this.Import.call('do',[this.id,fields,this.import_options()],kwargs).then(undefined,function(error,event){if(event){event.preventDefault();}
return $.when([{type:'error',record:false,message:error.data.arguments[1],}]);});},onvalidate:function(){return this.call_import({dryrun:true}).done(this.proxy('validated'));},onimport:function(){var self=this;return this.call_import({dryrun:false}).done(function(message){if(!_.any(message,function(message){return message.type==='error';})){self['import_succeeded']();return;}
self['import_failed'](message);});},onimported:function(){this.exit();},exit:function(){this.do_action({type:'ir.actions.client',tag:'history_back'});},onresults:function(event,from,to,message){var no_messages=_.isEmpty(message);this.$buttons.filter('.o_import_import').toggleClass('btn-primary',no_messages);this.$buttons.filter('.o_import_import').toggleClass('btn-default',!no_messages);this.$buttons.filter('.o_import_validate').toggleClass('btn-primary',!no_messages);this.$buttons.filter('.o_import_validate').toggleClass('btn-default',no_messages);if(no_messages){message.push({type:'info',message:_t("Everything seems valid.")});}
var offset=1;if(this.import_options().headers){offset+=1;}
this.$el.addClass('oe_import_error');this.$('.oe_import_error_report').html(QWeb.render('ImportView.error',{errors:_(message).groupBy('message'),at:function(rows){var from=rows.from+offset;var to=rows.to+offset;if(from===to){return _.str.sprintf(_t("at row %d"),from);}
return _.str.sprintf(_t("between rows %d and %d"),from,to);},more:function(n){return _.str.sprintf(_t("(%d more)"),n);},info:function(msg){if(typeof msg==='string'){return _.str.sprintf('<div class="oe_import_moreinfo oe_import_moreinfo_message">%s</div>',_.str.escapeHTML(msg));}
if(msg instanceof Array){return _.str.sprintf('<div class="oe_import_moreinfo oe_import_moreinfo_choices">%s <ul>%s</ul></div>',_.str.escapeHTML(_t("Here are the possible values:")),_(msg).map(function(msg){return'<li>'
+_.str.escapeHTML(msg)
+'</li>';}).join(''));}
return['<div class="oe_import_moreinfo oe_import_moreinfo_action">',_.str.sprintf('<a href="#" data-action="%s">',_.str.escapeHTML(JSON.stringify(msg))),_.str.escapeHTML(_t("Get all possible values")),'</a>','</div>'].join('');},}));},});core.action_registry.add('import',DataImport);StateMachine.create({target:DataImport.prototype,events:[{name:'loaded_file',from:['none','file_loaded','preview_error','preview_success','results'],to:'file_loaded'},{name:'settings_changed',from:['file_loaded','preview_error','preview_success','results'],to:'previewing'},{name:'preview_failed',from:'previewing',to:'preview_error'},{name:'preview_succeeded',from:'previewing',to:'preview_success'},{name:'validate',from:'preview_success',to:'validating'},{name:'validate',from:'results',to:'validating'},{name:'validated',from:'validating',to:'results'},{name:'import',from:['preview_success','results'],to:'importing'},{name:'import_succeeded',from:'importing',to:'imported'},{name:'import_failed',from:'importing',to:'results'}]});});;

/* /base_openprod/static/lib/dhtmlxtreegrid-max.js defined in bundle 'web.assets_backend' */
if(typeof(window.dhx)=="undefined"){window.dhx=window.dhx4={version:"5.0.2",skin:null,skinDetect:function(comp){var i=Math.floor(dhx4.readFromCss(comp+"_skin_detect")/10)*10;return{10:"dhx_skyblue",20:"dhx_web",30:"dhx_terrace",40:"material"}[i]||null;},readFromCss:function(className,property,innerHTML){var t=document.createElement("DIV");t.className=className;if(document.body.firstChild!=null)document.body.insertBefore(t,document.body.firstChild);else document.body.appendChild(t);if(typeof(innerHTML)=="string")t.innerHTML=innerHTML;var w=t[property||"offsetWidth"];t.parentNode.removeChild(t);t=null;return w;},lastId:1,newId:function(){return this.lastId++;},zim:{data:{},step:5,first:function(){return 100;},last:function(){var t=this.first();for(var a in this.data)t=Math.max(t,this.data[a]);return t;},reserve:function(id){this.data[id]=this.last()+this.step;return this.data[id];},clear:function(id){if(this.data[id]!=null){this.data[id]=null;delete this.data[id];}}},s2b:function(r){if(typeof(r)=="string")r=r.toLowerCase();return(r==true||r==1||r=="true"||r=="1"||r=="yes"||r=="y"||r=="on");},s2j:function(s){var obj=null;dhx4.temp=null;try{eval("dhx4.temp="+s);}catch(e){dhx4.temp=null;}
obj=dhx4.temp;dhx4.temp=null;return obj;},absLeft:function(obj){if(typeof(obj)=="string")obj=document.getElementById(obj);return this.getOffset(obj).left;},absTop:function(obj){if(typeof(obj)=="string")obj=document.getElementById(obj);return this.getOffset(obj).top;},_aOfs:function(elem){var top=0,left=0;while(elem){top=top+parseInt(elem.offsetTop);left=left+parseInt(elem.offsetLeft);elem=elem.offsetParent;}
return{top:top,left:left};},_aOfsRect:function(elem){var box=elem.getBoundingClientRect();var body=document.body;var docElem=document.documentElement;var scrollTop=window.pageYOffset||docElem.scrollTop||body.scrollTop;var scrollLeft=window.pageXOffset||docElem.scrollLeft||body.scrollLeft;var clientTop=docElem.clientTop||body.clientTop||0;var clientLeft=docElem.clientLeft||body.clientLeft||0;var top=box.top+scrollTop-clientTop;var left=box.left+scrollLeft-clientLeft;return{top:Math.round(top),left:Math.round(left)};},getOffset:function(elem){if(elem.getBoundingClientRect){return this._aOfsRect(elem);}else{return this._aOfs(elem);}},_isObj:function(k){return(k!=null&&typeof(k)=="object"&&typeof(k.length)=="undefined");},_copyObj:function(r){if(this._isObj(r)){var t={};for(var a in r){if(typeof(r[a])=="object"&&r[a]!=null)t[a]=this._copyObj(r[a]);else t[a]=r[a];}}else{var t=[];for(var a=0;a<r.length;a++){if(typeof(r[a])=="object"&&r[a]!=null)t[a]=this._copyObj(r[a]);else t[a]=r[a];}}
return t;},screenDim:function(){var isIE=(navigator.userAgent.indexOf("MSIE")>=0);var dim={};dim.left=document.body.scrollLeft;dim.right=dim.left+(window.innerWidth||document.body.clientWidth);dim.top=Math.max((isIE?document.documentElement:document.getElementsByTagName("html")[0]).scrollTop,document.body.scrollTop);dim.bottom=dim.top+(isIE?Math.max(document.documentElement.clientHeight||0,document.documentElement.offsetHeight||0):window.innerHeight);return dim;},selectTextRange:function(inp,start,end){inp=(typeof(inp)=="string"?document.getElementById(inp):inp);var len=inp.value.length;start=Math.max(Math.min(start,len),0);end=Math.min(end,len);if(inp.setSelectionRange){try{inp.setSelectionRange(start,end);}catch(e){};}else if(inp.createTextRange){var range=inp.createTextRange();range.moveStart("character",start);range.moveEnd("character",end-len);try{range.select();}catch(e){};}},transData:null,transDetect:function(){if(this.transData==null){this.transData={transProp:false,transEv:null};var k={"MozTransition":"transitionend","WebkitTransition":"webkitTransitionEnd","OTransition":"oTransitionEnd","msTransition":"transitionend","transition":"transitionend"};for(var a in k){if(this.transData.transProp==false&&document.documentElement.style[a]!=null){this.transData.transProp=a;this.transData.transEv=k[a];}}
k=null;}
return this.transData;},_xmlNodeValue:function(node){var value="";for(var q=0;q<node.childNodes.length;q++){value+=(node.childNodes[q].nodeValue!=null?node.childNodes[q].nodeValue.toString().replace(/^[\n\r\s]{0,}/,"").replace(/[\n\r\s]{0,}$/,""):"");}
return value;}};window.dhx4.isIE=(navigator.userAgent.indexOf("MSIE")>=0||navigator.userAgent.indexOf("Trident")>=0);window.dhx4.isIE6=(window.XMLHttpRequest==null&&navigator.userAgent.indexOf("MSIE")>=0);window.dhx4.isIE7=(navigator.userAgent.indexOf("MSIE 7.0")>=0&&navigator.userAgent.indexOf("Trident")<0);window.dhx4.isIE8=(navigator.userAgent.indexOf("MSIE 8.0")>=0&&navigator.userAgent.indexOf("Trident")>=0);window.dhx4.isIE9=(navigator.userAgent.indexOf("MSIE 9.0")>=0&&navigator.userAgent.indexOf("Trident")>=0);window.dhx4.isIE10=(navigator.userAgent.indexOf("MSIE 10.0")>=0&&navigator.userAgent.indexOf("Trident")>=0&&window.navigator.pointerEnabled!=true);window.dhx4.isIE11=(navigator.userAgent.indexOf("Trident")>=0&&window.navigator.pointerEnabled==true);window.dhx4.isEdge=(navigator.userAgent.indexOf("Edge")>=0);window.dhx4.isOpera=(navigator.userAgent.indexOf("Opera")>=0);window.dhx4.isChrome=(navigator.userAgent.indexOf("Chrome")>=0)&&!window.dhx4.isEdge;window.dhx4.isKHTML=(navigator.userAgent.indexOf("Safari")>=0||navigator.userAgent.indexOf("Konqueror")>=0)&&!window.dhx4.isEdge;window.dhx4.isFF=(navigator.userAgent.indexOf("Firefox")>=0);window.dhx4.isIPad=(navigator.userAgent.search(/iPad/gi)>=0);window.dhx4.dnd={evs:{},p_en:((window.dhx4.isIE||window.dhx4.isEdge)&&(window.navigator.pointerEnabled||window.navigator.msPointerEnabled)),_mTouch:function(e){return(window.dhx4.isIE10&&e.pointerType==e.MSPOINTER_TYPE_MOUSE||window.dhx4.isIE11&&e.pointerType=="mouse"||window.dhx4.isEdge&&e.pointerType=="mouse");},_touchOn:function(obj){if(obj==null)obj=document.body;obj.style.touchAction=obj.style.msTouchAction="";obj=null;},_touchOff:function(obj){if(obj==null)obj=document.body;obj.style.touchAction=obj.style.msTouchAction="none";obj=null;}};if(window.navigator.pointerEnabled==true){window.dhx4.dnd.evs={start:"pointerdown",move:"pointermove",end:"pointerup"};}else if(window.navigator.msPointerEnabled==true){window.dhx4.dnd.evs={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"};}else if(typeof(window.addEventListener)!="undefined"){window.dhx4.dnd.evs={start:"touchstart",move:"touchmove",end:"touchend"};};};if(typeof(window.dhx4.template)=="undefined"){window.dhx4.trim=function(t){return String(t).replace(/^\s{1,}/,"").replace(/\s{1,}$/,"");};window.dhx4.template=function(tpl,data,trim){return tpl.replace(/#([a-z0-9_-]{1,})(\|([^#]*))?#/gi,function(){var key=arguments[1];var t=window.dhx4.trim(arguments[3]);var func=null;var args=[data[key]];if(t.length>0){t=t.split(":");var k=[];for(var q=0;q<t.length;q++){if(q>0&&k[k.length-1].match(/\\$/)!=null){k[k.length-1]=k[k.length-1].replace(/\\$/,"")+":"+t[q];}else{k.push(t[q]);}}
func=k[0];for(var q=1;q<k.length;q++)args.push(k[q]);}
if(typeof(func)=="string"&&typeof(window.dhx4.template[func])=="function"){return window.dhx4.template[func].apply(window.dhx4.template,args);}
if(key.length>0&&typeof(data[key])!="undefined"){if(trim==true)return window.dhx4.trim(data[key]);return String(data[key]);}
return"";});};window.dhx4.template.date=function(value,format){if(value!=null){if(value instanceof Date){return window.dhx4.date2str(value,format);}else{value=value.toString();if(value.match(/^\d*$/)!=null)return window.dhx4.date2str(new Date(parseInt(value)),format);return value;}}
return"";};window.dhx4.template.maxlength=function(value,limit){return String(value).substr(0,limit);};window.dhx4.template.number_format=function(value,format,group_sep,dec_sep){var fmt=window.dhx4.template._parseFmt(format,group_sep,dec_sep);if(fmt==false)return value;return window.dhx4.template._getFmtValue(value,fmt);};window.dhx4.template.lowercase=function(value){if(typeof(value)=="undefined"||value==null)value="";return String(value).toLowerCase();};window.dhx4.template.uppercase=function(value){if(typeof(value)=="undefined"||value==null)value="";return String(value).toUpperCase();};window.dhx4.template._parseFmt=function(format,group_sep,dec_sep){var t=format.match(/^([^\.\,0-9]*)([0\.\,]*)([^\.\,0-9]*)/);if(t==null||t.length!=4)return false;var fmt={i_len:false,i_sep:(typeof(group_sep)=="string"?group_sep:","),d_len:false,d_sep:(typeof(dec_sep)=="string"?dec_sep:"."),s_bef:(typeof(t[1])=="string"?t[1]:""),s_aft:(typeof(t[3])=="string"?t[3]:"")};var f=t[2].split(".");if(f[1]!=null)fmt.d_len=f[1].length;var r=f[0].split(",");if(r.length>1)fmt.i_len=r[r.length-1].length;return fmt;};window.dhx4.template._getFmtValue=function(value,fmt){var r=String(value).match(/^(-)?([0-9]{1,})(\.([0-9]{1,}))?$/);if(r!=null&&r.length==5){var v0="";if(r[1]!=null)v0+=r[1];v0+=fmt.s_bef;if(fmt.i_len!==false){var i=0;var v1="";for(var q=r[2].length-1;q>=0;q--){v1=""+r[2].charAt(q)+v1;if(++i==fmt.i_len&&q>0){v1=fmt.i_sep+v1;i=0;}}
v0+=v1;}else{v0+=r[2];}
if(fmt.d_len!==false){if(r[4]==null)r[4]="";while(r[4].length<fmt.d_len)r[4]+="0";eval("dhx4.temp = new RegExp(/\\d{"+fmt.d_len+"}/);");var t1=(r[4]).match(dhx4.temp);if(t1!=null)v0+=fmt.d_sep+t1;dhx4.temp=t1=null;}
v0+=fmt.s_aft;return v0;}
return value;};};if(typeof(window.dhx4.dateLang)=="undefined"){window.dhx4.dateLang="en";window.dhx4.dateStrings={en:{monthFullName:["January","February","March","April","May","June","July","August","September","October","November","December"],monthShortName:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayFullName:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayShortName:["Su","Mo","Tu","We","Th","Fr","Sa"]}};window.dhx4.dateFormat={en:"%Y-%m-%d"};window.dhx4.date2str=function(val,format,strings){if(format==null||typeof(format)=="undefined")format=window.dhx4.dateFormat[window.dhx4.dateLang];if(strings==null||typeof(strings)=="undefined")strings=window.dhx4.dateStrings[window.dhx4.dateLang];if(val instanceof Date){var z=function(t){return(String(t).length==1?"0"+String(t):t);}
var k=function(t){switch(t){case"%d":return z(val.getDate());case"%j":return val.getDate();case"%D":return strings.dayShortName[val.getDay()];case"%l":return strings.dayFullName[val.getDay()];case"%m":return z(val.getMonth()+1);case"%n":return val.getMonth()+1;case"%M":return strings.monthShortName[val.getMonth()];case"%F":return strings.monthFullName[val.getMonth()];case"%y":return z(val.getYear()%100);case"%Y":return val.getFullYear();case"%g":return(val.getHours()+11)%12+1;case"%h":return z((val.getHours()+11)%12+1);case"%G":return val.getHours();case"%H":return z(val.getHours());case"%i":return z(val.getMinutes());case"%s":return z(val.getSeconds());case"%a":return(val.getHours()>11?"pm":"am");case"%A":return(val.getHours()>11?"PM":"AM");case"%%":return"%";case"%u":return val.getMilliseconds();case"%P":if(window.dhx4.temp_calendar!=null&&window.dhx4.temp_calendar.tz!=null)return window.dhx4.temp_calendar.tz;var ofs=val.getTimezoneOffset();var h=Math.abs(Math.floor(ofs/60));var m=Math.abs(ofs)-h*60;return(ofs>0?"-":"+")+z(h)+":"+z(m);default:return t;}}
var t=String(format||window.dhx4.dateFormat).replace(/%[a-zA-Z]/g,k);}
return(t||String(val));};window.dhx4.str2date=function(val,format,strings){if(format==null||typeof(format)=="undefined")format=window.dhx4.dateFormat[window.dhx4.dateLang];if(strings==null||typeof(strings)=="undefined")strings=window.dhx4.dateStrings[window.dhx4.dateLang];format=format.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\\:|]/g,"\\$&");var v=[];var f=[];format=format.replace(/%[a-z]/gi,function(t){switch(t){case"%d":case"%m":case"%y":case"%h":case"%H":case"%i":case"%s":f.push(t);return"(\\d{2})";case"%D":case"%l":case"%M":case"%F":f.push(t);return"([a-zéûä\u0430-\u044F\u0451]{1,})";case"%j":case"%n":case"%g":case"%G":f.push(t);return"(\\d{1,2})";case"%Y":f.push(t);return"(\\d{4})";case"%a":f.push(t);return"([a|p]m)";case"%A":f.push(t);return"([A|P]M)";case"%u":f.push(t);return"(\\d{1,6})";case"%P":f.push(t);return"([+-]\\d{1,2}:\\d{1,2})";}
return t;});var re=new RegExp(format,"i");var e=val.match(re);if(e==null||e.length-1!=f.length)return"Invalid Date";for(var q=1;q<e.length;q++)v.push(e[q]);var p={"%y":1,"%Y":1,"%n":2,"%m":2,"%M":2,"%F":2,"%d":3,"%j":3,"%a":4,"%A":4,"%H":5,"%G":5,"%h":5,"%g":5,"%i":6,"%s":7,"%u":7,"%P":7};var v2={};var f2={};for(var q=0;q<f.length;q++){if(typeof(p[f[q]])!="undefined"){var ind=p[f[q]];if(!v2[ind]){v2[ind]=[];f2[ind]=[];}
v2[ind].push(v[q]);f2[ind].push(f[q]);}}
v=[];f=[];for(var q=1;q<=7;q++){if(v2[q]!=null){for(var w=0;w<v2[q].length;w++){v.push(v2[q][w]);f.push(f2[q][w]);}}}
var r=new Date();r.setDate(1);r.setHours(0);r.setMinutes(0);r.setSeconds(0);r.setMilliseconds(0);var getInd=function(val,ar){for(var q=0;q<ar.length;q++)if(ar[q].toLowerCase()==val)return q;return-1;}
for(var q=0;q<v.length;q++){switch(f[q]){case"%d":case"%j":case"%n":case"%m":case"%Y":case"%H":case"%G":case"%i":case"%s":case"%u":if(!isNaN(v[q]))r[{"%d":"setDate","%j":"setDate","%n":"setMonth","%m":"setMonth","%Y":"setFullYear","%H":"setHours","%G":"setHours","%i":"setMinutes","%s":"setSeconds","%u":"setMilliseconds"}[f[q]]](Number(v[q])+(f[q]=="%m"||f[q]=="%n"?-1:0));break;case"%M":case"%F":var k=getInd(v[q].toLowerCase(),strings[{"%M":"monthShortName","%F":"monthFullName"}[f[q]]]);if(k>=0)r.setMonth(k);break;case"%y":if(!isNaN(v[q])){var v0=Number(v[q]);r.setFullYear(v0+(v0>50?1900:2000));}
break;case"%g":case"%h":if(!isNaN(v[q])){var v0=Number(v[q]);if(v0<=12&&v0>=0)r.setHours(v0+(getInd("pm",v)>=0?(v0==12?0:12):(v0==12?-12:0)));}
break;case"%P":if(window.dhx4.temp_calendar!=null){window.dhx4.temp_calendar.tz=v[q];}
break;}}
return r;};};if(typeof(window.dhx4.ajax)=="undefined"){window.dhx4.ajax={cache:false,method:"get",parse:function(data){if(typeof data!=="string")return data;data=data.replace(/^[\s]+/,"");if(window.DOMParser&&!dhx4.isIE){var obj=(new window.DOMParser()).parseFromString(data,"text/xml");}else if(window.ActiveXObject!==window.undefined){var obj=new window.ActiveXObject("Microsoft.XMLDOM");obj.async="false";obj.loadXML(data);}
return obj;},xmltop:function(tagname,xhr,obj){if(typeof xhr.status=="undefined"||xhr.status<400){xml=(!xhr.responseXML)?dhx4.ajax.parse(xhr.responseText||xhr):(xhr.responseXML||xhr);if(xml&&xml.documentElement!==null){try{if(!xml.getElementsByTagName("parsererror").length)
return xml.getElementsByTagName(tagname)[0];}catch(e){}}}
if(obj!==-1)dhx4.callEvent("onLoadXMLError",["Incorrect XML",arguments[1],obj]);return document.createElement("DIV");},xpath:function(xpathExp,docObj){if(!docObj.nodeName)docObj=docObj.responseXML||docObj;if(dhx4.isIE){try{return docObj.selectNodes(xpathExp)||[];}catch(e){return[];}}else{var rows=[];var first;var col=(docObj.ownerDocument||docObj).evaluate(xpathExp,docObj,null,XPathResult.ANY_TYPE,null);while(first=col.iterateNext())rows.push(first);return rows;}},query:function(config){dhx4.ajax._call((config.method||"GET"),config.url,config.data||"",(config.async||true),config.callback,null,config.headers);},get:function(url,onLoad){return this._call("GET",url,null,true,onLoad);},getSync:function(url){return this._call("GET",url,null,false);},put:function(url,postData,onLoad){return this._call("PUT",url,postData,true,onLoad);},del:function(url,postData,onLoad){return this._call("DELETE",url,postData,true,onLoad);},post:function(url,postData,onLoad){if(arguments.length==1){postData="";}else if(arguments.length==2&&(typeof(postData)=="function"||typeof(window[postData])=="function")){onLoad=postData;postData="";}else{postData=String(postData);}
return this._call("POST",url,postData,true,onLoad);},postSync:function(url,postData){postData=(postData==null?"":String(postData));return this._call("POST",url,postData,false);},getLong:function(url,onLoad){this._call("GET",url,null,true,onLoad,{url:url});},postLong:function(url,postData,onLoad){if(arguments.length==2&&(typeof(postData)=="function"||typeof(window[postData]))){onLoad=postData;postData="";}
this._call("POST",url,postData,true,onLoad,{url:url,postData:postData});},_call:function(method,url,postData,async,onLoad,longParams,headers){var t=(window.XMLHttpRequest&&!dhx4.isIE?new XMLHttpRequest():new ActiveXObject("Microsoft.XMLHTTP"));var isQt=(navigator.userAgent.match(/AppleWebKit/)!=null&&navigator.userAgent.match(/Qt/)!=null&&navigator.userAgent.match(/Safari/)!=null);if(async==true){t.onreadystatechange=function(){if((t.readyState==4)||(isQt==true&&t.readyState==3)){if(t.status!=200||t.responseText=="")
if(!dhx4.callEvent("onAjaxError",[{xmlDoc:t,filePath:url,async:async}]))return;window.setTimeout(function(){if(typeof(onLoad)=="function"){onLoad.apply(window,[{xmlDoc:t,filePath:url,async:async}]);}
if(longParams!=null){if(typeof(longParams.postData)!="undefined"){dhx4.ajax.postLong(longParams.url,longParams.postData,onLoad);}else{dhx4.ajax.getLong(longParams.url,onLoad);}}
onLoad=null;t=null;},1);}}}
if(method=="GET"){url+=this._dhxr(url);}
t.open(method,url,async);if(headers!=null){for(var key in headers)t.setRequestHeader(key,headers[key]);}else if(method=="POST"||method=="PUT"||method=="DELETE"){t.setRequestHeader("Content-Type","application/x-www-form-urlencoded");}else if(method=="GET"){postData=null;}
t.setRequestHeader("X-Requested-With","XMLHttpRequest");t.send(postData);if(async!=true){if((t.readyState==4)||(isQt==true&&t.readyState==3)){if(t.status!=200||t.responseText=="")dhx4.callEvent("onAjaxError",[{xmlDoc:t,filePath:url,async:async}]);}}
return{xmlDoc:t,filePath:url,async:async};},_dhxr:function(sign,value){if(this.cache!=true){if(sign.match(/^[\?\&]$/)==null)sign=(sign.indexOf("?")>=0?"&":"?");if(typeof(value)=="undefined")value=true;return sign+"dhxr"+new Date().getTime()+(value==true?"=1":"");}
return"";}};};if(typeof(window.dhx4._enableDataLoading)=="undefined"){window.dhx4._enableDataLoading=function(obj,initObj,xmlToJson,xmlRootTag,mode){if(mode=="clear"){for(var a in obj._dhxdataload){obj._dhxdataload[a]=null;delete obj._dhxdataload[a];};obj._loadData=null;obj._dhxdataload=null;obj.load=null;obj.loadStruct=null;obj=null;return;}
obj._dhxdataload={initObj:initObj,xmlToJson:xmlToJson,xmlRootTag:xmlRootTag,onBeforeXLS:null};obj._loadData=function(data,loadParams,onLoad){if(arguments.length==2){onLoad=loadParams;loadParams=null;}
var obj=null;if(arguments.length==3)onLoad=arguments[2];if(typeof(data)=="string"){var k=data.replace(/^\s{1,}/,"").replace(/\s{1,}$/,"");var tag=new RegExp("^<"+this._dhxdataload.xmlRootTag);if(tag.test(k.replace(/^<\?xml[^\?]*\?>\s*/,""))){obj=dhx4.ajax.parse(data);if(obj!=null)obj=this[this._dhxdataload.xmlToJson].apply(this,[obj]);}
if(obj==null&&(k.match(/^[\s\S]*{[.\s\S]*}[\s\S]*$/)!=null||k.match(/^[\s\S]*\[[.\s\S]*\][\s\S]*$/)!=null)){obj=dhx4.s2j(k);}
if(obj==null){this.callEvent("onXLS",[]);var params=[];if(typeof(this._dhxdataload.onBeforeXLS)=="function"){var k=this._dhxdataload.onBeforeXLS.apply(this,[data]);if(k!=null&&typeof(k)=="object"){if(k.url!=null)data=k.url;if(k.params!=null){for(var a in k.params)params.push(a+"="+encodeURIComponent(k.params[a]));}}}
var t=this;var callBack=function(r){var obj=null;if((r.xmlDoc.getResponseHeader("Content-Type")||"").search(/xml/gi)>=0||(r.xmlDoc.responseText.replace(/^\s{1,}/,"")).match(/^</)!=null){obj=t[t._dhxdataload.xmlToJson].apply(t,[r.xmlDoc.responseXML]);}else{obj=dhx4.s2j(r.xmlDoc.responseText);}
if(obj!=null)t[t._dhxdataload.initObj].apply(t,[obj,data]);t.callEvent("onXLE",[]);if(onLoad!=null){if(typeof(onLoad)=="function"){onLoad.apply(t,[]);}else if(typeof(window[onLoad])=="function"){window[onLoad].apply(t,[]);}}
callBack=onLoad=null;obj=r=t=null;};params=params.join("&")+(typeof(loadParams)=="string"?"&"+loadParams:"");if(dhx4.ajax.method=="post"){dhx4.ajax.post(data,params,callBack);}else if(dhx4.ajax.method=="get"){dhx4.ajax.get(data+(params.length>0?(data.indexOf("?")>0?"&":"?")+params:""),callBack);}
return;}}else{if(typeof(data.documentElement)=="object"||(typeof(data.tagName)!="undefined"&&typeof(data.getElementsByTagName)!="undefined"&&data.getElementsByTagName(this._dhxdataload.xmlRootTag).length>0)){obj=this[this._dhxdataload.xmlToJson].apply(this,[data]);}else{obj=window.dhx4._copyObj(data);}}
if(obj!=null)this[this._dhxdataload.initObj].apply(this,[obj]);if(onLoad!=null){if(typeof(onLoad)=="function"){onLoad.apply(this,[]);}else if(typeof(window[onLoad])=="function"){window[onLoad].apply(this,[]);}
onLoad=null;}};if(mode!=null){var k={struct:"loadStruct",data:"load"};for(var a in mode){if(mode[a]==true)obj[k[a]]=function(){return this._loadData.apply(this,arguments);}}}
obj=null;};};if(typeof(window.dhx4._eventable)=="undefined"){window.dhx4._eventable=function(obj,mode){if(mode=="clear"){obj.detachAllEvents();obj.dhxevs=null;obj.attachEvent=null;obj.detachEvent=null;obj.checkEvent=null;obj.callEvent=null;obj.detachAllEvents=null;obj=null;return;}
obj.dhxevs={data:{}};obj.attachEvent=function(name,func){name=String(name).toLowerCase();if(!this.dhxevs.data[name])this.dhxevs.data[name]={};var eventId=window.dhx4.newId();this.dhxevs.data[name][eventId]=func;return eventId;}
obj.detachEvent=function(eventId){for(var a in this.dhxevs.data){var k=0;for(var b in this.dhxevs.data[a]){if(b==eventId){this.dhxevs.data[a][b]=null;delete this.dhxevs.data[a][b];}else{k++;}}
if(k==0){this.dhxevs.data[a]=null;delete this.dhxevs.data[a];}}}
obj.checkEvent=function(name){name=String(name).toLowerCase();return(this.dhxevs.data[name]!=null);}
obj.callEvent=function(name,params){name=String(name).toLowerCase();if(this.dhxevs.data[name]==null)return true;var r=true;for(var a in this.dhxevs.data[name]){r=this.dhxevs.data[name][a].apply(this,params)&&r;}
return r;}
obj.detachAllEvents=function(){for(var a in this.dhxevs.data){for(var b in this.dhxevs.data[a]){this.dhxevs.data[a][b]=null;delete this.dhxevs.data[a][b];}
this.dhxevs.data[a]=null;delete this.dhxevs.data[a];}}
obj=null;};dhx4._eventable(dhx4);};if(!window.dhtmlxValidation){dhtmlxValidation=function(){};dhtmlxValidation.prototype={isEmpty:function(value){return value=='';},isNotEmpty:function(value){return(value instanceof Array?value.length>0:!value=='');},isValidBoolean:function(value){return!!value.toString().match(/^(0|1|true|false)$/);},isValidEmail:function(value){return!!value.toString().match(/(^[a-z0-9]([0-9a-z\-_\.]*)@([0-9a-z_\-\.]*)([.][a-z]{3})$)|(^[a-z]([0-9a-z_\.\-]*)@([0-9a-z_\-\.]*)(\.[a-z]{2,5})$)/i);},isValidInteger:function(value){return!!value.toString().match(/(^-?\d+$)/);},isValidNumeric:function(value){return!!value.toString().match(/(^-?\d\d*[\.|,]\d*$)|(^-?\d\d*$)|(^-?[\.|,]\d\d*$)/);},isValidAplhaNumeric:function(value){return!!value.toString().match(/^[_\-a-z0-9]+$/gi);},isValidDatetime:function(value){var dt=value.toString().match(/^(\d{4})-(\d{2})-(\d{2})\s(\d{2}):(\d{2}):(\d{2})$/);return dt&&!!(dt[1]<=9999&&dt[2]<=12&&dt[3]<=31&&dt[4]<=59&&dt[5]<=59&&dt[6]<=59)||false;},isValidDate:function(value){var d=value.toString().match(/^(\d{4})-(\d{2})-(\d{2})$/);return d&&!!(d[1]<=9999&&d[2]<=12&&d[3]<=31)||false;},isValidTime:function(value){var t=value.toString().match(/^(\d{1,2}):(\d{1,2}):(\d{1,2})$/);return t&&!!(t[1]<=24&&t[2]<=59&&t[3]<=59)||false;},isValidIPv4:function(value){var ip=value.toString().match(/^(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})$/);return ip&&!!(ip[1]<=255&&ip[2]<=255&&ip[3]<=255&&ip[4]<=255)||false;},isValidCurrency:function(value){return value.toString().match(/^\$?\s?\d+?([\.,\,]?\d+)?\s?\$?$/)&&true||false;},isValidSSN:function(value){return value.toString().match(/^\d{3}\-?\d{2}\-?\d{4}$/)&&true||false;},isValidSIN:function(value){return value.toString().match(/^\d{9}$/)&&true||false;}};dhtmlxValidation=new dhtmlxValidation();};if(typeof(window.dhtmlx)=="undefined"){window.dhtmlx={extend:function(a,b){for(var key in b)
if(!a[key])
a[key]=b[key];return a;},extend_api:function(name,map,ext){var t=window[name];if(!t)return;window[name]=function(obj){if(obj&&typeof obj=="object"&&!obj.tagName){var that=t.apply(this,(map._init?map._init(obj):arguments));for(var a in dhtmlx)
if(map[a])this[map[a]](dhtmlx[a]);for(var a in obj){if(map[a])this[map[a]](obj[a]);else if(a.indexOf("on")===0){this.attachEvent(a,obj[a]);}}}else
var that=t.apply(this,arguments);if(map._patch)map._patch(this);return that||this;};window[name].prototype=t.prototype;if(ext)
dhtmlx.extend(window[name].prototype,ext);},url:function(str){if(str.indexOf("?")!=-1)
return"&";else
return"?";}};};function dhtmlDragAndDropObject(){if(window.dhtmlDragAndDrop)
return window.dhtmlDragAndDrop;this.lastLanding=0;this.dragNode=0;this.dragStartNode=0;this.dragStartObject=0;this.tempDOMU=null;this.tempDOMM=null;this.waitDrag=0;window.dhtmlDragAndDrop=this;return this;};dhtmlDragAndDropObject.prototype.removeDraggableItem=function(htmlNode){htmlNode.onmousedown=null;htmlNode.dragStarter=null;htmlNode.dragLanding=null;}
dhtmlDragAndDropObject.prototype.addDraggableItem=function(htmlNode,dhtmlObject){htmlNode.onmousedown=this.preCreateDragCopy;htmlNode.dragStarter=dhtmlObject;this.addDragLanding(htmlNode,dhtmlObject);}
dhtmlDragAndDropObject.prototype.addDragLanding=function(htmlNode,dhtmlObject){htmlNode.dragLanding=dhtmlObject;}
dhtmlDragAndDropObject.prototype.preCreateDragCopy=function(e){if((e||window.event)&&(e||event).button==2)
return;if(window.dhtmlDragAndDrop.waitDrag){window.dhtmlDragAndDrop.waitDrag=0;document.body.onmouseup=window.dhtmlDragAndDrop.tempDOMU;document.body.onmousemove=window.dhtmlDragAndDrop.tempDOMM;return false;}
if(window.dhtmlDragAndDrop.dragNode)
window.dhtmlDragAndDrop.stopDrag(e);window.dhtmlDragAndDrop.waitDrag=1;window.dhtmlDragAndDrop.tempDOMU=document.body.onmouseup;window.dhtmlDragAndDrop.tempDOMM=document.body.onmousemove;window.dhtmlDragAndDrop.dragStartNode=this;window.dhtmlDragAndDrop.dragStartObject=this.dragStarter;document.body.onmouseup=window.dhtmlDragAndDrop.preCreateDragCopy;document.body.onmousemove=window.dhtmlDragAndDrop.callDrag;window.dhtmlDragAndDrop.downtime=new Date().valueOf();if((e)&&(e.preventDefault)){e.preventDefault();return false;}
return false;};dhtmlDragAndDropObject.prototype.callDrag=function(e){if(!e)
e=window.event;dragger=window.dhtmlDragAndDrop;if((new Date()).valueOf()-dragger.downtime<100)return;if(!dragger.dragNode){if(dragger.waitDrag){dragger.dragNode=dragger.dragStartObject._createDragNode(dragger.dragStartNode,e);if(!dragger.dragNode)
return dragger.stopDrag();dragger.dragNode.onselectstart=function(){return false;}
dragger.gldragNode=dragger.dragNode;document.body.appendChild(dragger.dragNode);document.body.onmouseup=dragger.stopDrag;dragger.waitDrag=0;dragger.dragNode.pWindow=window;dragger.initFrameRoute();}
else return dragger.stopDrag(e,true);}
if(dragger.dragNode.parentNode!=window.document.body&&dragger.gldragNode){var grd=dragger.gldragNode;if(dragger.gldragNode.old)
grd=dragger.gldragNode.old;grd.parentNode.removeChild(grd);var oldBody=dragger.dragNode.pWindow;if(grd.pWindow&&grd.pWindow.dhtmlDragAndDrop.lastLanding)
grd.pWindow.dhtmlDragAndDrop.lastLanding.dragLanding._dragOut(grd.pWindow.dhtmlDragAndDrop.lastLanding);if(_isIE){var div=document.createElement("Div");div.innerHTML=dragger.dragNode.outerHTML;dragger.dragNode=div.childNodes[0];}else
dragger.dragNode=dragger.dragNode.cloneNode(true);dragger.dragNode.pWindow=window;dragger.gldragNode.old=dragger.dragNode;document.body.appendChild(dragger.dragNode);oldBody.dhtmlDragAndDrop.dragNode=dragger.dragNode;}
dragger.dragNode.style.left=e.clientX+15+(dragger.fx?dragger.fx*(-1):0)
+(document.body.scrollLeft||document.documentElement.scrollLeft)+"px";dragger.dragNode.style.top=e.clientY+3+(dragger.fy?dragger.fy*(-1):0)
+(document.body.scrollTop||document.documentElement.scrollTop)+"px";if(!e.srcElement)
var z=e.target;else
z=e.srcElement;dragger.checkLanding(z,e);}
dhtmlDragAndDropObject.prototype.calculateFramePosition=function(n){if(window.name){var el=parent.frames[window.name].frameElement.offsetParent;var fx=0;var fy=0;while(el){fx+=el.offsetLeft;fy+=el.offsetTop;el=el.offsetParent;}
if((parent.dhtmlDragAndDrop)){var ls=parent.dhtmlDragAndDrop.calculateFramePosition(1);fx+=ls.split('_')[0]*1;fy+=ls.split('_')[1]*1;}
if(n)
return fx+"_"+fy;else
this.fx=fx;this.fy=fy;}
return"0_0";}
dhtmlDragAndDropObject.prototype.checkLanding=function(htmlObject,e){if((htmlObject)&&(htmlObject.dragLanding)){if(this.lastLanding)
this.lastLanding.dragLanding._dragOut(this.lastLanding);this.lastLanding=htmlObject;this.lastLanding=this.lastLanding.dragLanding._dragIn(this.lastLanding,this.dragStartNode,e.clientX,e.clientY,e);this.lastLanding_scr=(_isIE?e.srcElement:e.target);}else{if((htmlObject)&&(htmlObject.tagName!="BODY"))
this.checkLanding(htmlObject.parentNode,e);else{if(this.lastLanding)
this.lastLanding.dragLanding._dragOut(this.lastLanding,e.clientX,e.clientY,e);this.lastLanding=0;if(this._onNotFound)
this._onNotFound();}}}
dhtmlDragAndDropObject.prototype.stopDrag=function(e,mode){dragger=window.dhtmlDragAndDrop;if(!mode){dragger.stopFrameRoute();var temp=dragger.lastLanding;dragger.lastLanding=null;if(temp)
temp.dragLanding._drag(dragger.dragStartNode,dragger.dragStartObject,temp,(_isIE?event.srcElement:e.target));}
dragger.lastLanding=null;if((dragger.dragNode)&&(dragger.dragNode.parentNode==document.body))
dragger.dragNode.parentNode.removeChild(dragger.dragNode);dragger.dragNode=0;dragger.gldragNode=0;dragger.fx=0;dragger.fy=0;dragger.dragStartNode=0;dragger.dragStartObject=0;document.body.onmouseup=dragger.tempDOMU;document.body.onmousemove=dragger.tempDOMM;dragger.tempDOMU=null;dragger.tempDOMM=null;dragger.waitDrag=0;}
dhtmlDragAndDropObject.prototype.stopFrameRoute=function(win){if(win)
window.dhtmlDragAndDrop.stopDrag(1,1);for(var i=0;i<window.frames.length;i++){try{if((window.frames[i]!=win)&&(window.frames[i].dhtmlDragAndDrop))
window.frames[i].dhtmlDragAndDrop.stopFrameRoute(window);}catch(e){}}
try{if((parent.dhtmlDragAndDrop)&&(parent!=window)&&(parent!=win))
parent.dhtmlDragAndDrop.stopFrameRoute(window);}catch(e){}}
dhtmlDragAndDropObject.prototype.initFrameRoute=function(win,mode){if(win){window.dhtmlDragAndDrop.preCreateDragCopy();window.dhtmlDragAndDrop.dragStartNode=win.dhtmlDragAndDrop.dragStartNode;window.dhtmlDragAndDrop.dragStartObject=win.dhtmlDragAndDrop.dragStartObject;window.dhtmlDragAndDrop.dragNode=win.dhtmlDragAndDrop.dragNode;window.dhtmlDragAndDrop.gldragNode=win.dhtmlDragAndDrop.dragNode;window.document.body.onmouseup=window.dhtmlDragAndDrop.stopDrag;window.waitDrag=0;if(((!_isIE)&&(mode))&&((!_isFF)||(_FFrv<1.8)))
window.dhtmlDragAndDrop.calculateFramePosition();}
try{if((parent.dhtmlDragAndDrop)&&(parent!=window)&&(parent!=win))
parent.dhtmlDragAndDrop.initFrameRoute(window);}catch(e){}
for(var i=0;i<window.frames.length;i++){try{if((window.frames[i]!=win)&&(window.frames[i].dhtmlDragAndDrop))
window.frames[i].dhtmlDragAndDrop.initFrameRoute(window,((!win||mode)?1:0));}catch(e){}}}
_isFF=false;_isIE=false;_isOpera=false;_isKHTML=false;_isMacOS=false;_isChrome=false;_FFrv=false;_KHTMLrv=false;_OperaRv=false;if(navigator.userAgent.indexOf('Macintosh')!=-1)
_isMacOS=true;if(navigator.userAgent.toLowerCase().indexOf('chrome')>-1)
_isChrome=true;if((navigator.userAgent.indexOf('Safari')!=-1)||(navigator.userAgent.indexOf('Konqueror')!=-1)){_KHTMLrv=parseFloat(navigator.userAgent.substr(navigator.userAgent.indexOf('Safari')+7,5));if(_KHTMLrv>525){_isFF=true;_FFrv=1.9;}else
_isKHTML=true;}else if(navigator.userAgent.indexOf('Opera')!=-1){_isOpera=true;_OperaRv=parseFloat(navigator.userAgent.substr(navigator.userAgent.indexOf('Opera')+6,3));}
else if(navigator.appName.indexOf("Microsoft")!=-1){_isIE=true;if((navigator.appVersion.indexOf("MSIE 8.0")!=-1||navigator.appVersion.indexOf("MSIE 9.0")!=-1||navigator.appVersion.indexOf("MSIE 10.0")!=-1||document.documentMode>7)&&document.compatMode!="BackCompat"){_isIE=8;}}else if(navigator.appName=='Netscape'&&navigator.userAgent.indexOf("Trident")!=-1){_isIE=8;}else{_isFF=true;_FFrv=parseFloat(navigator.userAgent.split("rv:")[1])}
if(typeof(window.dhtmlxEvent)=="undefined"){function dhtmlxEvent(el,event,handler){if(el.addEventListener)
el.addEventListener(event,handler,false);else if(el.attachEvent)
el.attachEvent("on"+event,handler);}};if(dhtmlxEvent.touchDelay==null){dhtmlxEvent.touchDelay=2000;};if(typeof(dhtmlxEvent.initTouch)=="undefined"){dhtmlxEvent.initTouch=function(){var longtouch;var target;var tx,ty;dhtmlxEvent(document.body,"touchstart",function(ev){target=ev.touches[0].target;tx=ev.touches[0].clientX;ty=ev.touches[0].clientY;longtouch=window.setTimeout(touch_event,dhtmlxEvent.touchDelay);});function touch_event(){if(target){var ev=document.createEvent("HTMLEvents");ev.initEvent("dblclick",true,true);target.dispatchEvent(ev);longtouch=target=null;}};dhtmlxEvent(document.body,"touchmove",function(ev){if(longtouch){if(Math.abs(ev.touches[0].clientX-tx)>50||Math.abs(ev.touches[0].clientY-ty)>50){window.clearTimeout(longtouch);longtouch=target=false;}}});dhtmlxEvent(document.body,"touchend",function(ev){if(longtouch){window.clearTimeout(longtouch);longtouch=target=false;}});dhtmlxEvent.initTouch=function(){};};};function dataProcessor(serverProcessorURL){this.serverProcessor=serverProcessorURL;this.action_param="!nativeeditor_status";this.object=null;this.updatedRows=[];this.autoUpdate=true;this.updateMode="cell";this._tMode="GET";this._headers=null;this._payload=null;this.post_delim="_";this._waitMode=0;this._in_progress={};this._invalid={};this.mandatoryFields=[];this.messages=[];this.styles={updated:"font-weight:bold;",inserted:"font-weight:bold;",deleted:"text-decoration : line-through;",invalid:"background-color:FFE0E0;",invalid_cell:"border-bottom:2px solid red;",error:"color:red;",clear:"font-weight:normal;text-decoration:none;"};this.enableUTFencoding(true);dhx4._eventable(this);if(this.connector_init){this.setTransactionMode("POST",true);this.serverProcessor+=(this.serverProcessor.indexOf("?")!=-1?"&":"?")+"editing=true";};return this;}
dataProcessor.prototype={url:function(str){if(str.indexOf("?")!=-1)
return"&";else
return"?";},setTransactionMode:function(mode,total){if(typeof mode=="object"){this._tMode=mode.mode||this._tMode;this._headers=this._headers||mode.headers;this._payload=this._payload||mode.payload;}else{this._tMode=mode;this._tSend=total;}
if(this._tMode=="REST"){this._tSend=false;this._endnm=true;}},escape:function(data){if(this._utf)
return encodeURIComponent(data);else
return escape(data);},enableUTFencoding:function(mode){this._utf=dhx4.s2b(mode);},setDataColumns:function(val){this._columns=(typeof val=="string")?val.split(","):val;},getSyncState:function(){return!this.updatedRows.length;},enableDataNames:function(mode){this._endnm=dhx4.s2b(mode);},enablePartialDataSend:function(mode){this._changed=dhx4.s2b(mode);},setUpdateMode:function(mode,dnd){this.autoUpdate=(mode=="cell");this.updateMode=mode;this.dnd=dnd;},ignore:function(code,master){this._silent_mode=true;code.call(master||window);this._silent_mode=false;},setUpdated:function(rowId,state,mode){this._log("item "+rowId+" "+(state?"marked":"unmarked")+" ["+(mode||"updated")+"]");if(this._silent_mode)return;var ind=this.findRow(rowId);mode=mode||"updated";var existing=this.obj.getUserData(rowId,this.action_param);if(existing&&mode=="updated")mode=existing;if(state){this.set_invalid(rowId,false);this.updatedRows[ind]=rowId;this.obj.setUserData(rowId,this.action_param,mode);if(this._in_progress[rowId])
this._in_progress[rowId]="wait";}else{if(!this.is_invalid(rowId)){this.updatedRows.splice(ind,1);this.obj.setUserData(rowId,this.action_param,"");}}
if(!state)
this._clearUpdateFlag(rowId);this.markRow(rowId,state,mode);if(state&&this.autoUpdate)this.sendData(rowId);},_clearUpdateFlag:function(id){},markRow:function(id,state,mode){var str="";var invalid=this.is_invalid(id);if(invalid){str=this.styles[invalid];state=true;}
if(this.callEvent("onRowMark",[id,state,mode,invalid])){str=this.styles[state?mode:"clear"]+str;this.obj[this._methods[0]](id,str);if(invalid&&invalid.details){str+=this.styles[invalid+"_cell"];for(var i=0;i<invalid.details.length;i++)
if(invalid.details[i])
this.obj[this._methods[1]](id,i,str);}}},getState:function(id){return this.obj.getUserData(id,this.action_param);},is_invalid:function(id){return this._invalid[id];},set_invalid:function(id,mode,details){if(details)mode={value:mode,details:details,toString:function(){return this.value.toString();}};this._invalid[id]=mode;},checkBeforeUpdate:function(rowId){return true;},sendData:function(rowId){if(rowId)
this._log("Sending: "+rowId);if(this._waitMode&&(this.obj.mytype=="tree"||this.obj._h2))return;if(this.obj.editStop)this.obj.editStop();if(typeof rowId=="undefined"||this._tSend)return this.sendAllData();if(this._in_progress[rowId])return false;this.messages=[];if(this.getState(rowId)!=="deleted")
if(!this.checkBeforeUpdate(rowId)&&this.callEvent("onValidationError",[rowId,this.messages]))return false;this._beforeSendData(this._getRowData(rowId),rowId);},_beforeSendData:function(data,rowId){if(!this.callEvent("onBeforeUpdate",[rowId,this.getState(rowId),data]))return false;this._sendData(data,rowId);},serialize:function(data,id){if(typeof data=="string")
return data;if(typeof id!="undefined")
return this.serialize_one(data,"");else{var stack=[];var keys=[];for(var key in data)
if(data.hasOwnProperty(key)){stack.push(this.serialize_one(data[key],key+this.post_delim));keys.push(key);}
stack.push("ids="+this.escape(keys.join(",")));if(window.dhtmlx&&dhtmlx.security_key)
stack.push("dhx_security="+dhtmlx.security_key);return stack.join("&");}},serialize_one:function(data,pref){if(typeof data=="string")
return data;var stack=[];for(var key in data)
if(data.hasOwnProperty(key)){if((key=="id"||key==this.action_param)&&this._tMode=="REST")continue;stack.push(this.escape((pref||"")+key)+"="+this.escape(data[key]));}
return stack.join("&");},_applyPayload:function(url){if(this._payload)
for(var key in this._payload)
url=url+(url.indexOf("?")===-1?"?":"&")+this.escape(key)+"="+this.escape(this._payload[key]);return url;},_sendData:function(a1,rowId){this._log("url: "+this.serverProcessor);this._log(a1)
if(!a1)return;if(!this.callEvent("onBeforeDataSending",rowId?[rowId,this.getState(rowId),a1]:[null,null,a1]))return false;if(rowId)
this._in_progress[rowId]=(new Date()).valueOf();var that=this;var back=function(xml){var ids=[];if(rowId)
ids.push(rowId);else if(a1)
for(var key in a1)
ids.push(key);return that.afterUpdate(that,xml,ids);};var a3=this.serverProcessor+(this._user?(this.url(this.serverProcessor)+["dhx_user="+this._user,"dhx_version="+this.obj.getUserData(0,"version")].join("&")):"");var a4=this._applyPayload(a3);if(this._tMode=="GET"){dhx4.ajax.query({url:a4+((a4.indexOf("?")!=-1)?"&":"?")+this.serialize(a1,rowId),method:"GET",headers:this._headers,callback:back});}
else if(this._tMode=="POST"){dhx4.ajax.query({url:a4,method:"POST",headers:this._headers,callback:back,data:this.serialize(a1,rowId)});}
else if(this._tMode=="REST"){var state=this.getState(rowId);var url=a3.replace(/(\&|\?)editing\=true/,"");var parts=url.split("?");if(parts[1])
parts[1]="?"+parts[1];var data="";var method="post";if(state=="inserted"){data=this.serialize(a1,rowId);}else if(state=="deleted"){method="DELETE";url=parts[0]+rowId+(parts[1]||"");}else{method="PUT";data=this.serialize(a1,rowId);url=parts[0]+rowId+(parts[1]||"");}
this._applyPayload(url);dhx4.ajax.query({url:url,method:method,headers:this._headers,data:data,callback:back});}
this._waitMode++;},sendAllData:function(){this._log("Sending all updated items");if(!this.updatedRows.length)return;this.messages=[];var valid=true;for(var i=0;i<this.updatedRows.length;i++)
if(this.getState(this.updatedRows[i])!=="deleted")
valid&=this.checkBeforeUpdate(this.updatedRows[i]);if(!valid&&!this.callEvent("onValidationError",["",this.messages]))return false;if(this._tSend)
this._sendData(this._getAllData());else
for(var i=0;i<this.updatedRows.length;i++)
if(!this._in_progress[this.updatedRows[i]]){if(this.is_invalid(this.updatedRows[i]))continue;this._beforeSendData(this._getRowData(this.updatedRows[i]),this.updatedRows[i]);if(this._waitMode&&(this.obj.mytype=="tree"||this.obj._h2))return;}},_getAllData:function(rowId){var out={};var has_one=false;for(var i=0;i<this.updatedRows.length;i++){var id=this.updatedRows[i];if(this._in_progress[id]||this.is_invalid(id))continue;if(!this.callEvent("onBeforeUpdate",[id,this.getState(id),this._getRowData(id)]))continue;out[id]=this._getRowData(id,id+this.post_delim);has_one=true;this._in_progress[id]=(new Date()).valueOf();}
return has_one?out:null;},setVerificator:function(ind,verifFunction){this.mandatoryFields[ind]=verifFunction||(function(value){return(value!=="");});},clearVerificator:function(ind){this.mandatoryFields[ind]=false;},findRow:function(pattern){var i=0;for(i=0;i<this.updatedRows.length;i++)
if(pattern==this.updatedRows[i])break;return i;},defineAction:function(name,handler){if(!this._uActions)this._uActions=[];this._uActions[name]=handler;},afterUpdateCallback:function(sid,tid,action,btag){this._log("Action: "+action+" SID:"+sid+" TID:"+tid,btag);var marker=sid;var correct=(action!="error"&&action!="invalid");if(!correct)this.set_invalid(sid,action);if((this._uActions)&&(this._uActions[action])&&(!this._uActions[action](btag)))
return(delete this._in_progress[marker]);if(this._in_progress[marker]!="wait")
this.setUpdated(sid,false);var soid=sid;switch(action){case"inserted":case"insert":if(tid!=sid){this.obj[this._methods[2]](sid,tid);sid=tid;}
break;case"delete":case"deleted":this.obj.setUserData(sid,this.action_param,"true_deleted");this.obj[this._methods[3]](sid);delete this._in_progress[marker];return this.callEvent("onAfterUpdate",[sid,action,tid,btag]);break;}
if(this._in_progress[marker]!="wait"){if(correct)this.obj.setUserData(sid,this.action_param,'');delete this._in_progress[marker];}else{delete this._in_progress[marker];this.setUpdated(tid,true,this.obj.getUserData(sid,this.action_param));}
this.callEvent("onAfterUpdate",[soid,action,tid,btag]);},enableDebug:function(){this._debug=true;},_log:function(){if(this._debug&&window.console&&window.console.info)
window.console.info.apply(window.console,arguments);},afterUpdate:function(that,xml,id){this._log("Server response received");if(window.JSON){try{var tag=JSON.parse(xml.xmlDoc.responseText);var action=tag.action||this.getState(id)||"updated";var sid=tag.sid||id[0];var tid=tag.tid||id[0];that.afterUpdateCallback(sid,tid,action,tag);that.finalizeUpdate();return;}catch(e){}}
var top=dhx4.ajax.xmltop("data",xml.xmlDoc);if(!top||top.tagName=="DIV")return this.cleanUpdate(id);var atag=dhx4.ajax.xpath("//data/action",top);if(!atag.length)return this.cleanUpdate(id);for(var i=0;i<atag.length;i++){var btag=atag[i];var action=btag.getAttribute("type");var sid=btag.getAttribute("sid");var tid=btag.getAttribute("tid");that.afterUpdateCallback(sid,tid,action,btag);}
that.finalizeUpdate();},cleanUpdate:function(id){if(id)
for(var i=0;i<id.length;i++)
delete this._in_progress[id[i]];},finalizeUpdate:function(){if(this._waitMode)this._waitMode--;if((this.obj.mytype=="tree"||this.obj._h2)&&this.updatedRows.length)
this.sendData();this.callEvent("onAfterUpdateFinish",[]);if(!this.updatedRows.length)
this.callEvent("onFullSync",[]);},init:function(anObj){this.obj=anObj;if(anObj._dp_init)
anObj._dp_init(this);if(this.connector_init)
anObj._dataprocessor=this;},setOnAfterUpdate:function(ev){this.attachEvent("onAfterUpdate",ev);},setOnBeforeUpdateHandler:function(func){this.attachEvent("onBeforeDataSending",func);},setAutoUpdate:function(interval,user){interval=interval||2000;this._user=user||(new Date()).valueOf();this._need_update=false;this._update_busy=false;this.attachEvent("onAfterUpdate",function(sid,action,tid,xml_node){this.afterAutoUpdate(sid,action,tid,xml_node);});this.attachEvent("onFullSync",function(){this.fullSync();});var self=this;window.setInterval(function(){self.loadUpdate();},interval);},afterAutoUpdate:function(sid,action,tid,xml_node){if(action=='collision'){this._need_update=true;return false;}else{return true;}},fullSync:function(){if(this._need_update==true){this._need_update=false;this.loadUpdate();}
return true;},getUpdates:function(url,callback){if(this._update_busy)
return false;else
this._update_busy=true;dhx4.ajax.get(url,callback);},_v:function(node){if(node.firstChild)return node.firstChild.nodeValue;return"";},_a:function(arr){var res=[];for(var i=0;i<arr.length;i++){res[i]=this._v(arr[i]);};return res;},loadUpdate:function(){var self=this;var version=this.obj.getUserData(0,"version");var url=this.serverProcessor+this.url(this.serverProcessor)+["dhx_user="+this._user,"dhx_version="+version].join("&");url=url.replace("editing=true&","");this.getUpdates(url,function(r){var top=dhx4.ajax.xmltop("updates",r.xmlDoc);var vers=dhx4.ajax.xpath("//userdata",top);self.obj.setUserData(0,"version",self._v(vers[0]));var upds=dhx4.ajax.xpath("//update",top);if(upds.length){self._silent_mode=true;for(var i=0;i<upds.length;i++){var status=upds[i].getAttribute('status');var id=upds[i].getAttribute('id');var parent=upds[i].getAttribute('parent');switch(status){case'inserted':self.callEvent("insertCallback",[upds[i],id,parent]);break;case'updated':self.callEvent("updateCallback",[upds[i],id,parent]);break;case'deleted':self.callEvent("deleteCallback",[upds[i],id,parent]);break;}}
self._silent_mode=false;}
self._update_busy=false;self=null;});}};if(window.dataProcessor&&!dataProcessor.prototype.init_original)
dataProcessor.prototype.connector_init=true;function dhtmlXCalendarObject(inps,skin){this.i={};var p=null;if(typeof(inps)=="string"){var t0=document.getElementById(inps);}else{var t0=inps;}
if(t0&&typeof(t0)=="object"&&t0.tagName&&String(t0.tagName).toLowerCase()!="input")p=t0;t0=null;if(typeof(inps)!="object"||!inps.length)inps=[inps];for(var q=0;q<inps.length;q++){if(typeof(inps[q])=="string")inps[q]=(document.getElementById(inps[q])||null);if(inps[q]!=null&&inps[q].tagName&&String(inps[q].tagName).toLowerCase()=="input"){this.i[window.dhx4.newId()]={input:inps[q]};}else{if(!(inps[q]instanceof Array)&&inps[q]instanceof Object&&(inps[q].input!=null||inps[q].button!=null)){if(inps[q].input!=null&&typeof(inps[q].input)=="string")inps[q].input=document.getElementById(inps[q].input);if(inps[q].button!=null&&typeof(inps[q].button)=="string")inps[q].button=document.getElementById(inps[q].button);this.i[window.dhx4.newId()]=inps[q];}}
inps[q]=null;}
this.conf={skin:(skin||window.dhx4.skin||(typeof(dhtmlx)!="undefined"?dhtmlx.skin:null)||window.dhx4.skinDetect("dhtmlxcalendar")||"material"),zi:window.dhx4.newId(),touch:!window.dhx4.isIE,time:true,today:false,ws_first:true}
this.setSkin=function(skin,force){if(this.conf.skin==skin&&!force)return;this.conf.skin=skin;this.base.className="dhtmlxcalendar_"+this.conf.skin;this._ifrSize();}
this.base=document.createElement("DIV");this.base.style.display="none";this.base.appendChild(document.createElement("DIV"));if(p!=null){this._hasParent=true;p.appendChild(this.base);p=null;}else{document.body.appendChild(this.base);}
this.setParent=function(p){if(this._hasParent){if(typeof(p)=="object"){p.appendChild(this.base);}else if(typeof(p)=="string"){document.getElementById(p).appendChild(this.base);}}}
this.setSkin(this.conf.skin,true);this.base.onclick=function(e){e=e||event;if(e.preventDefault)e.preventDefault();e.cancelBubble=true;}
this.base.onmousedown=function(){return false;}
if(this.conf.touch){this.base.ontouchstart=this.base.onclick;}
this.loadUserLanguage=function(lang){if(!this.langData[lang])return;this.lang=lang;this.setWeekStartDay(this.langData[this.lang].weekstart);this.setDateFormat(this.langData[this.lang].dateformat||"%Y-%m-%d");if(this.msCont){var e=0;for(var q=0;q<this.msCont.childNodes.length;q++){for(var w=0;w<this.msCont.childNodes[q].childNodes.length;w++){this.msCont.childNodes[q].childNodes[w].innerHTML=this.langData[this.lang].monthesSNames[e++];}}}
this.contTime.childNodes[0].childNodes[0].childNodes[5].innerHTML=this.langData[this.lang].today;this.contTime.childNodes[0].childNodes[0].childNodes[4].innerHTML=this.langData[this.lang].clear;}
this.contMonth=document.createElement("DIV");this.contMonth.className="dhtmlxcalendar_month_cont";this.contMonth.onselectstart=function(e){e=e||event;e.cancelBubble=true;if(e.preventDefault)e.preventDefault();else e.returnValue=false;return false;}
this.base.firstChild.appendChild(this.contMonth);var ul=document.createElement("UL");ul.className="dhtmlxcalendar_line";this.contMonth.appendChild(ul);var li=document.createElement("LI");li.className="dhtmlxcalendar_cell dhtmlxcalendar_month_hdr";li.innerHTML="<div class='dhtmlxcalendar_month_arrow dhtmlxcalendar_month_arrow_left' onmouseover='this.className=\"dhtmlxcalendar_month_arrow dhtmlxcalendar_month_arrow_left_hover\";' onmouseout='this.className=\"dhtmlxcalendar_month_arrow dhtmlxcalendar_month_arrow_left\";'></div>"+"<span></span>"+"<div class='dhtmlxcalendar_month_arrow dhtmlxcalendar_month_arrow_right' onmouseover='this.className=\"dhtmlxcalendar_month_arrow dhtmlxcalendar_month_arrow_right_hover\";' onmouseout='this.className=\"dhtmlxcalendar_month_arrow dhtmlxcalendar_month_arrow_right\";'></div>";ul.appendChild(li);var that=this;li.onclick=function(e){e=e||event;if(e.type=="touchstart"&&e.preventDefault!=null)e.preventDefault();var t=(e.target||e.srcElement);if(t.className&&t.className.indexOf("dhtmlxcalendar_month_arrow")===0){that._hideSelector();var ind=(t.parentNode.firstChild==t?-1:1);var k0=new Date(that._activeMonth);that._drawMonth(new Date(that._activeMonth.getFullYear(),that._activeMonth.getMonth()+ind,1,0,0,0,0));that._evOnArrowClick([k0,new Date(that._activeMonth)]);return;}
if(t.className&&t.className=="dhtmlxcalendar_month_label_month"){e.cancelBubble=true;that._showSelector("month",Math.round(t.offsetLeft+t.offsetWidth/2),t.offsetTop+t.offsetHeight+2,"selector_month",true);return;}
if(t.className&&t.className=="dhtmlxcalendar_month_label_year"){e.cancelBubble=true;that._showSelector("year",Math.round(t.offsetLeft+t.offsetWidth/2),t.offsetTop+t.offsetHeight+2,"selector_year",true);return;}
that._hideSelector();}
if(this.conf.touch==true){li.ontouchstart=li.onclick;}
this.contDays=document.createElement("DIV");this.contDays.className="dhtmlxcalendar_days_cont";this.base.firstChild.appendChild(this.contDays);this.setWeekStartDay=function(ind){if(ind==0)ind=7;this._wStart=Math.min(Math.max((isNaN(ind)?1:ind),1),7);this._drawDaysOfWeek();}
this._drawDaysOfWeek=function(){if(this.contDays.childNodes.length==0){var ul=document.createElement("UL");ul.className="dhtmlxcalendar_line";this.contDays.appendChild(ul);}else{var ul=this.contDays.firstChild;}
var w=this._wStart;var k=this.langData[this.lang].daysSNames;k.push(String(this.langData[this.lang].daysSNames[0]).valueOf());for(var q=0;q<8;q++){if(ul.childNodes[q]==null){var li=document.createElement("LI");ul.appendChild(li);}else{var li=ul.childNodes[q];}
if(q==0){li.className="dhtmlxcalendar_cell_wn";li.innerHTML="<div class='dhtmlxcalendar_label'>"+(this.langData[this.lang].weekname||"w")+"</div>";}else{li.className="dhtmlxcalendar_cell"+(w>=6?" dhtmlxcalendar_day_weekday_cell":"")+(q==1?"_first":"");li.innerHTML=k[w];if(++w>7)w=1;}}
if(this._activeMonth!=null)this._drawMonth(this._activeMonth);}
this._wStart=this.langData[this.lang].weekstart;this.setWeekStartDay(this._wStart);this.contDates=document.createElement("DIV");this.contDates.className="dhtmlxcalendar_dates_cont";this.base.firstChild.appendChild(this.contDates);this.contDates.onclick=function(e){e=e||event;if(e.type=="touchstart"&&e.preventDefault!=null)e.preventDefault();var t=(e.target||e.srcElement);if(t.parentNode!=null&&t.parentNode._date!=null)t=t.parentNode;if(t._date!=null&&!t._css_dis){var t1=that._activeDate.getHours();var t2=that._activeDate.getMinutes();var d0=t._date;if(that.checkEvent("onBeforeChange")){if(!that.callEvent("onBeforeChange",[new Date(t._date.getFullYear(),t._date.getMonth(),t._date.getDate(),t1,t2)]))return;}
if(that._activeDateCell!=null){that._activeDateCell._css_date=false;that._updateCellStyle(that._activeDateCell._q,that._activeDateCell._w);}
var refreshView=(that._activeDate.getFullYear()+"_"+that._activeDate.getMonth()!=d0.getFullYear()+"_"+d0.getMonth());that._nullDate=false;that._activeDate=new Date(d0.getFullYear(),d0.getMonth(),d0.getDate(),t1,t2);that._activeDateCell=t;that._activeDateCell._css_date=true;that._activeDateCell._css_hover=false;that._updateCellStyle(that._activeDateCell._q,that._activeDateCell._w);if(refreshView)that._drawMonth(that._activeDate);that._updateInp();if(!that._hasParent){if(e.type=="touchstart"){window.setTimeout(function(){that._hide();},400);}else{that._hide();}}
that._evOnClick([new Date(that._activeDate.getTime())]);}}
if(this.conf.touch==true){this.contDates.ontouchstart=this.contDates.onclick;}
this.contDates.onmouseover=function(e){e=e||event;var t=(e.target||e.srcElement);if(t.parentNode!=null&&t.parentNode._date!=null)t=t.parentNode;if(t._date!=null){if(that._lastHover==t||t._css_hover)return;t._css_hover=true;that._updateCellStyle(t._q,t._w);that._lastHover=t;that._evOnMouseOver([new Date(t._date.getFullYear(),t._date.getMonth(),t._date.getDate(),0,0,0,0),e]);t=null;}}
this.contDates.onmouseout=function(e){that._clearDayHover(e||event);}
this._lastHover=null;this._clearDayHover=function(ev){if(!this._lastHover)return;this._lastHover._css_hover=false;this._updateCellStyle(this._lastHover._q,this._lastHover._w);if(ev!=null)that._evOnMouseOut([new Date(this._lastHover._date.getFullYear(),this._lastHover._date.getMonth(),this._lastHover._date.getDate(),0,0,0,0),ev]);this._lastHover=null;}
for(var q=0;q<6;q++){var ul=document.createElement("UL");ul.className="dhtmlxcalendar_line";this.contDates.appendChild(ul);for(var w=0;w<=7;w++){var li=document.createElement("LI");if(w==0){li.className="dhtmlxcalendar_cell_wn";}else{li.className="dhtmlxcalendar_cell";}
ul.appendChild(li);}}
this.contTime=document.createElement("DIV");this.contTime.className="dhtmlxcalendar_time_cont";this.contTime.style.display="none";this.base.firstChild.appendChild(this.contTime);this.showTime=function(){if(this.conf.time!=true){this.conf.time=true;this._adjustTimeCont();}}
this.hideTime=function(){if(this.conf.time==true){this.conf.time=false;this._adjustTimeCont();}}
this.showToday=function(){if(this.conf.today!=true){this.conf.today=true;this._adjustTimeCont();}}
this.hideToday=function(){if(this.conf.today==true){this.conf.today=false;this._adjustTimeCont();}}
this._adjustTimeCont=function(){var css="";if(this.conf.time==true)css+="_time";if(this.conf.today==true)css+="_today";if(css==""){this.contTime.style.display="none";}else{this.contTime.className="dhtmlxcalendar_time_cont dhtmlxcalendar_mode"+css;this.contTime.style.display="";}
this._ifrSize();}
this._adjustTimeCont();var ul=document.createElement("UL");ul.className="dhtmlxcalendar_line";this.contTime.appendChild(ul);var li=document.createElement("LI");li.className="dhtmlxcalendar_cell dhtmlxcalendar_time_hdr";li.innerHTML="<div class='dhtmlxcalendar_time_img'></div>"+"<span class='dhtmlxcalendar_label_hours'></span><span class='dhtmlxcalendar_label_colon'>:</span><span class='dhtmlxcalendar_label_minutes'></span>"+"<span class='dhtmlxcalendar_label_clear'>"+this.langData[this.lang].clear+"</span><span class='dhtmlxcalendar_label_today'>"+this.langData[this.lang].today+"</span>";ul.appendChild(li);li.onclick=function(e){e=e||event;if(e.type=="touchstart"&&e.preventDefault!=null)e.preventDefault();var t=(e.target||e.srcElement);if(t.tagName!=null&&t.tagName.toLowerCase()=="span"&&t._par==true&&t.parentNode!=null){t=t.parentNode;}
if(t.className&&t.className=="dhtmlxcalendar_label_hours"){e.cancelBubble=true;var h=that.contMonth.offsetHeight+that.contDays.offsetHeight+that.contDates.offsetHeight+t.offsetTop;that._showSelector("hours",Math.round(t.offsetLeft+t.offsetWidth/2),h-2,"selector_hours",true);return;}
if(t.className&&t.className=="dhtmlxcalendar_label_minutes"){e.cancelBubble=true;if(that._minutesInterval==1){var d=that.getFormatedDate("%i");t.innerHTML="<span class='dhtmlxcalendar_selected_date'>"+d.charAt(0)+"</span>"+d.charAt(1);t.firstChild._par=true;that._selectorMode=1;}
var h=that.contMonth.offsetHeight+that.contDays.offsetHeight+that.contDates.offsetHeight+t.offsetTop;that._showSelector("minutes",Math.round(t.offsetLeft+t.offsetWidth/2),h-2,"selector_minutes",true);return;}
that._hideSelector();if(t.className&&t.className=="dhtmlxcalendar_label_today"){var d=new Date();d=new Date(d.getFullYear(),d.getMonth(),d.getDate(),that._activeDate.getHours(),that._activeDate.getMinutes(),that._activeDate.getSeconds(),that._activeDate.getMilliseconds());that.setDate(d);that._updateInp();that.callEvent("onButtonClick",[d]);}
if(t.className&&t.className=="dhtmlxcalendar_label_clear"){that._nullDate=true;that._drawMonth(new Date());that._updateInp();that.callEvent("onButtonClick",[null]);}}
if(this.conf.touch==true){li.ontouchstart=li.onclick;}
this._activeMonth=null;this._activeDate=new Date();this._activeDateCell=null;this.setDate=function(d){window.dhx4.temp_calendar={tz:null};this._nullDate=(typeof(d)=="undefined"||d===""||!d);if(!(d instanceof Date)){d=this._strToDate(String(d||""));if(d=="Invalid Date")d=new Date();else this.conf.tz=window.dhx4.temp_calendar.tz;window.dhx4.temp_calendar=null;}
if(this.conf.tz==null)this.conf.tz=window.dhx4.date2str(d,"%P");var time=d.getTime();if(this._isOutOfRange(time))return;this._activeDate=new Date(time);this._drawMonth(this._nullDate?new Date():this._activeDate);this._updateVisibleHours();this._updateVisibleMinutes();}
this.getDate=function(formated){if(this._nullDate)return null;var t=new Date(this._activeDate.getTime());if(formated){window.dhx4.temp_calendar={tz:this.conf.tz};var d=this._dateToStr(t);window.dhx4.temp_calendar=null;return d;}
return t;}
this._drawMonth=function(d){if(!(d instanceof Date))return;if(isNaN(d.getFullYear()))d=new Date(this._activeMonth.getFullYear(),this._activeMonth.getMonth(),1,0,0,0,0);this._activeMonth=new Date(d.getFullYear(),d.getMonth(),1,0,0,0,0);this._activeDateCell=null;var first=new Date(this._activeMonth.getTime());var d0=first.getDay();var e0=d0-this._wStart;if(e0<0)e0=e0+7;first.setDate(first.getDate()-e0);var mx=d.getMonth();var dx=new Date(this._activeDate.getFullYear(),this._activeDate.getMonth(),this._activeDate.getDate(),0,0,0,0).getTime();var i=0;for(var q=0;q<6;q++){var ws=this._wStart;for(var w=0;w<=7;w++){if(w==0){var wn=this.getWeekNumber(new Date(first.getFullYear(),first.getMonth(),first.getDate()+i,0,0,0,0));if(wn>=52&&this.conf.ws_first==true&&this._activeMonth.getMonth()==0){var wn2=this.getWeekNumber(new Date(first.getFullYear(),first.getMonth(),first.getDate()+i+7,0,0,0,0));if(wn2<wn&&wn2>1)wn=1;}
this.contDates.childNodes[q].childNodes[w].innerHTML="<div class='dhtmlxcalendar_label'>"+wn+"</div>";}else{var d2=new Date(first.getFullYear(),first.getMonth(),first.getDate()+i,0,0,0,0);if(d2.getHours()!=0){var h=(d2.getHours()>12?24-d2.getHours():d2.getHours());d2.setTime(d2.getTime()+60*60*1000*h);}
var day=d2.getDay();var time=d2.getTime();var label_css="dhtmlxcalendar_label";if(this._tipData[time]!=null){if(this._tipData[time].usePopup&&typeof(window.dhtmlXPopup)=="function"){this.contDates.childNodes[q].childNodes[w].removeAttribute("title");this._initTooltipPopup();}else{this.contDates.childNodes[q].childNodes[w].setAttribute("title",this._tipData[time].text);}
if(this._tipData[time].showIcon)label_css+=" dhtmlxcalendar_label_title";}else{this.contDates.childNodes[q].childNodes[w].removeAttribute("title");}
this.contDates.childNodes[q].childNodes[w].innerHTML="<div class='"+label_css+"'>"+d2.getDate()+"</div>";this.contDates.childNodes[q].childNodes[w]._date=new Date(time);this.contDates.childNodes[q].childNodes[w]._q=q;this.contDates.childNodes[q].childNodes[w]._w=w;this.contDates.childNodes[q].childNodes[w]._css_month=(d2.getMonth()==mx);this.contDates.childNodes[q].childNodes[w]._css_date=(!this._nullDate&&time==dx);this.contDates.childNodes[q].childNodes[w]._css_weekend=(ws>=6);this.contDates.childNodes[q].childNodes[w]._css_dis=this._isOutOfRange(time);this.contDates.childNodes[q].childNodes[w]._css_holiday=(this._holidays[time]==true);this._updateCellStyle(q,w);if(time==dx)this._activeDateCell=this.contDates.childNodes[q].childNodes[w];if(++ws>7)ws=1;i++;}}}
this.contMonth.firstChild.firstChild.childNodes[1].innerHTML=this._buildMonthHdr(d);}
this._updateCellStyle=function(q,w){var r=this.contDates.childNodes[q].childNodes[w];var s="dhtmlxcalendar_cell dhtmlxcalendar_cell";s+=(r._css_month?"_month":"");s+=(r._css_date?"_date":"");s+=(r._css_weekend?"_weekend":"");s+=(r._css_holiday?"_holiday":"");s+=(r._css_dis?"_dis":"");s+=(r._css_hover&&!r._css_dis?"_hover":"");r.className=s;r=null;}
this._minutesInterval=5;this._initSelector=function(type,css){if(!this._selCover){this._selCover=document.createElement("DIV");this._selCover.className="dhtmlxcalendar_selector_cover";this.base.firstChild.appendChild(this._selCover);}
if(!this._sel){this._sel=document.createElement("DIV");this._sel.className="dhtmlxcalendar_selector_obj";this.base.firstChild.appendChild(this._sel);this._sel.appendChild(document.createElement("TABLE"));this._sel.firstChild.className="dhtmlxcalendar_selector_table";this._sel.firstChild.cellSpacing=0;this._sel.firstChild.cellPadding=0;this._sel.firstChild.border=0;this._sel.firstChild.appendChild(document.createElement("TBODY"));this._sel.firstChild.firstChild.appendChild(document.createElement("TR"));this._sel.firstChild.firstChild.firstChild.appendChild(document.createElement("TD"));this._sel.firstChild.firstChild.firstChild.appendChild(document.createElement("TD"));this._sel.firstChild.firstChild.firstChild.appendChild(document.createElement("TD"));this._sel.firstChild.firstChild.firstChild.childNodes[0].className="dhtmlxcalendar_selector_cell_left";this._sel.firstChild.firstChild.firstChild.childNodes[1].className="dhtmlxcalendar_selector_cell_middle";this._sel.firstChild.firstChild.firstChild.childNodes[2].className="dhtmlxcalendar_selector_cell_right";this._sel.firstChild.firstChild.firstChild.childNodes[0].innerHTML="&nbsp;";this._sel.firstChild.firstChild.firstChild.childNodes[2].innerHTML="&nbsp;";this._sel.firstChild.firstChild.firstChild.childNodes[0].onmouseover=function(){this.className="dhtmlxcalendar_selector_cell_left dhtmlxcalendar_selector_cell_left_hover";}
this._sel.firstChild.firstChild.firstChild.childNodes[0].onmouseout=function(){this.className="dhtmlxcalendar_selector_cell_left";}
this._sel.firstChild.firstChild.firstChild.childNodes[2].onmouseover=function(){this.className="dhtmlxcalendar_selector_cell_right dhtmlxcalendar_selector_cell_right_hover";}
this._sel.firstChild.firstChild.firstChild.childNodes[2].onmouseout=function(){this.className="dhtmlxcalendar_selector_cell_right";}
this._sel.onmouseover=function(e){e=e||event;var t=(e.target||e.srcElement);if(t._cell===true){if(that._selHover!=t)that._clearSelHover();if(String(t.className).match(/^\s{0,}dhtmlxcalendar_selector_cell\s{0,}$/gi)!=null){t.className+=" dhtmlxcalendar_selector_cell_hover";that._selHover=t;}}}
this._sel.onmouseout=function(){that._clearSelHover();}
this._sel.firstChild.firstChild.firstChild.childNodes[0].onclick=function(e){e=e||event;if(e.type=="touchstart"&&e.preventDefault!=null)e.preventDefault();e.cancelBubble=true;that._scrollYears(-1);}
this._sel.firstChild.firstChild.firstChild.childNodes[2].onclick=function(e){e=e||event;if(e.type=="touchstart"&&e.preventDefault!=null)e.preventDefault();e.cancelBubble=true;that._scrollYears(1);}
if(this.conf.touch==true){this._sel.firstChild.firstChild.firstChild.childNodes[0].ontouchstart=this._sel.firstChild.firstChild.firstChild.childNodes[0].onclick;this._sel.firstChild.firstChild.firstChild.childNodes[2].ontouchstart=this._sel.firstChild.firstChild.firstChild.childNodes[2].onclick;}
this._sel._ta={};this._selHover=null;this._sel.appendChild(document.createElement("DIV"));this._sel.lastChild.className="dhtmlxcalendar_selector_obj_arrow";}
if(this._sel._ta[type]==true)return;if(type=="month"){this._msCells={};this.msCont=document.createElement("DIV");this.msCont.className="dhtmlxcalendar_area_"+css;this._sel.firstChild.firstChild.firstChild.childNodes[1].appendChild(this.msCont);var i=0;for(var q=0;q<4;q++){var ul=document.createElement("UL");ul.className="dhtmlxcalendar_selector_line";this.msCont.appendChild(ul);for(var w=0;w<3;w++){var li=document.createElement("LI");li.innerHTML=this.langData[this.lang].monthesSNames[i];li.className="dhtmlxcalendar_selector_cell";ul.appendChild(li);li._month=i;li._cell=true;this._msCells[i++]=li;}}
this.msCont.onclick=function(e){e=e||event;if(e.type=="touchstart"&&e.preventDefault!=null)e.preventDefault();e.cancelBubble=true;var t=(e.target||e.srcElement);if(t._month!=null){that._hideSelector();that._updateActiveMonth();that._drawMonth(new Date(that._activeMonth.getFullYear(),t._month,1,0,0,0,0));that._doOnSelectorChange();}}
if(this.conf.touch==true){this.msCont.ontouchstart=this.msCont.onclick;}}
if(type=="year"){this._ysCells={};this.ysCont=document.createElement("DIV");this.ysCont.className="dhtmlxcalendar_area_"+css;this._sel.firstChild.firstChild.firstChild.childNodes[1].appendChild(this.ysCont);for(var q=0;q<4;q++){var ul=document.createElement("UL");ul.className="dhtmlxcalendar_selector_line";this.ysCont.appendChild(ul);for(var w=0;w<3;w++){var li=document.createElement("LI");li.className="dhtmlxcalendar_selector_cell";li._cell=true;ul.appendChild(li);}}
this.ysCont.onclick=function(e){e=e||event;if(e.type=="touchstart"&&e.preventDefault!=null)e.preventDefault();e.cancelBubble=true;var t=(e.target||e.srcElement);if(t._year!=null){that._hideSelector();that._drawMonth(new Date(t._year,that._activeMonth.getMonth(),1,0,0,0,0));that._doOnSelectorChange();}}
if(this.conf.touch==true){this.ysCont.ontouchstart=this.ysCont.onclick;}}
if(type=="hours"){this._hsCells={};this.hsCont=document.createElement("DIV");this.hsCont.className="dhtmlxcalendar_area_"+css;this._sel.firstChild.firstChild.firstChild.childNodes[1].appendChild(this.hsCont);var i=0;for(var q=0;q<4;q++){var ul=document.createElement("UL");ul.className="dhtmlxcalendar_selector_line";this.hsCont.appendChild(ul);for(var w=0;w<6;w++){var li=document.createElement("LI");li.innerHTML=this._fixLength(i,2);li.className="dhtmlxcalendar_selector_cell";ul.appendChild(li);li._hours=i;li._cell=true;this._hsCells[i++]=li;}}
this.hsCont.onclick=function(e){e=e||event;if(e.type=="touchstart"&&e.preventDefault!=null)e.preventDefault();e.cancelBubble=true;var t=(e.target||e.srcElement);if(t._hours!=null){that._hideSelector();that._activeDate.setHours(t._hours);that._updateActiveHours();that._updateVisibleHours();that._doOnSelectorChange();that.callEvent("onTimeChange",[new Date(that._activeDate.getTime())]);}}
if(this.conf.touch==true){this.hsCont.ontouchstart=this.hsCont.onclick;}}
if(type=="minutes"){var q1=4;var w1=3;var len=2;if(this._minutesInterval==1){if(this._selectorMode==1){q1=2;w1=3;len=1;}else{q1=2;w1=5;len=1;css+="5";}}
if(this._minutesInterval==10)q1=2;if(this._minutesInterval==15){q1=1;w1=4;css+="4";}
this._rsCells={};this.rsCont=document.createElement("DIV");this.rsCont.className="dhtmlxcalendar_area_"+css;this._sel.firstChild.firstChild.firstChild.childNodes[1].appendChild(this.rsCont);var i=0;for(var q=0;q<q1;q++){var ul=document.createElement("UL");ul.className="dhtmlxcalendar_selector_line";this.rsCont.appendChild(ul);for(var w=0;w<w1;w++){var li=document.createElement("LI");li.innerHTML=(len>1?this._fixLength(i,len):i);li.className="dhtmlxcalendar_selector_cell";ul.appendChild(li);li._minutes=i;li._cell=true;this._rsCells[i]=li;i+=this._minutesInterval;}}
this.rsCont.onclick=function(e){e=e||event;if(e.type=="touchstart"&&e.preventDefault!=null)e.preventDefault();e.cancelBubble=true;var t=(e.target||e.srcElement);if(t._minutes!=null){if(that._minutesInterval==1){var m=that.getFormatedDate("%i");if(that._selectorMode==1){m=t._minutes.toString()+m.charAt(1);}else{m=m.charAt(0)+t._minutes.toString();}
that._activeDate.setMinutes(Number(m));that.callEvent("onTimeChange",[new Date(that._activeDate.getTime())]);that._hideSelector();if(that._selectorMode==1){that._updateVisibleMinutes(true);that._selectorMode=2;that._showSelector("minutes",that._sel._x,that._sel._y,"selector_minutes",true);that._updateActiveMinutes();return;}else{that._selectorMode=1;}}else{that._hideSelector();that._activeDate.setMinutes(t._minutes);that._updateActiveMinutes();that.callEvent("onTimeChange",[new Date(that._activeDate.getTime())]);}
that._updateVisibleMinutes();that._doOnSelectorChange();}}
if(this.conf.touch==true){this.rsCont.ontouchstart=this.rsCont.onclick;}}
this._sel._ta[type]=true;}
this._showSelector=function(type,x,y,css,autoHide){if(autoHide===true&&this._sel!=null&&this._isSelectorVisible()&&type==this._sel._t){this._hideSelector();return;}
if(this.conf.skin=="dhx_terrace"){x+=12;}
if(!this._sel||!this._sel._ta[type])this._initSelector(type,css);if(type!=this._sel._t&&this._sel._t=="minutes"&&this._minutesInterval==1){this.contTime.firstChild.firstChild.childNodes[3].innerHTML=this.getFormatedDate("%i");}
this._sel._x=x;this._sel._y=y;this._sel.style.visibility="hidden";this._sel.style.display="";this._selCover.style.width=this.base.offsetWidth-2+"px";this._selCover.style.top=this.contMonth.offsetHeight+"px";this._selCover.style.height=this.contDates.offsetHeight+this.contDays.offsetHeight-1+"px";this._selCover.style.display="";this._sel._t=type;this._sel.className="dhtmlxcalendar_selector_obj dhtmlxcalendar_"+css+(type=="hours"&&this.conf.today==true?"2":"");this._sel.childNodes[0].firstChild.firstChild.childNodes[0].style.display=this._sel.childNodes[0].firstChild.firstChild.childNodes[2].style.display=(type=="year"?"":"none");var x0=Math.max(0,x-Math.round(this._sel.offsetWidth/2));if(x0+this._sel.offsetWidth>this._sel.parentNode.offsetWidth){x0=this._sel.parentNode.offsetWidth-this._sel.offsetWidth;}
this._sel.style.left=x0+"px";if(type=="hours"||type=="minutes"){this._sel.style.top=y-this._sel.offsetHeight+"px";}else{this._sel.style.top=y+"px";}
this._sel.childNodes[1].style.width=this._sel.childNodes[0].offsetWidth+"px";this._sel.style.visibility="visible";this._doOnSelectorShow(type);}
this._doOnSelectorShow=function(type){if(type=="month")this._updateActiveMonth();if(type=="year")this._updateYearsList(this._activeMonth);if(type=="hours")this._updateActiveHours();if(type=="minutes")this._updateActiveMinutes();}
this._hideSelector=function(selMode){if(!this._sel)return;this._sel.style.display="none";this._sel.style.visible="hidden";this._selCover.style.display="none";if(this._sel._t=="minutes"&&this._minutesInterval==1){this.contTime.firstChild.firstChild.childNodes[3].innerHTML=this.getFormatedDate("%i");this._unloadSelector("minutes");}}
this._isSelectorVisible=function(){if(!this._sel)return false;return(this._sel.style.display!="none");}
this._doOnSelectorChange=function(state){this.callEvent("onChange",[new Date(this._activeMonth.getFullYear(),this._activeMonth.getMonth(),this._activeDate.getDate(),this._activeDate.getHours(),this._activeDate.getMinutes(),this._activeDate.getSeconds()),state===true]);}
this._clearSelHover=function(){if(!this._selHover)return;this._selHover.className=String(this._selHover.className.replace(/dhtmlxcalendar_selector_cell_hover/gi,""));this._selHover=null;}
this._unloadSelector=function(type){if(!this._sel)return;if(!this._sel._ta[type])return;if(type=="month"){this.msCont.onclick=this.msCont.ontouchstart=null;this._msActive=null;for(var a in this._msCells){this._msCells[a]._cell=null;this._msCells[a]._month=null;this._msCells[a].parentNode.removeChild(this._msCells[a]);this._msCells[a]=null;}
this._msCells=null;while(this.msCont.childNodes.length>0)this.msCont.removeChild(this.msCont.lastChild);this.msCont.parentNode.removeChild(this.msCont);this.msCont=null;}
if(type=="year"){this.ysCont.onclick=this.ysCont.ontouchstart=null;for(var a in this._ysCells){this._ysCells[a]._cell=null;this._ysCells[a]._year=null;this._ysCells[a].parentNode.removeChild(this._ysCells[a]);this._ysCells[a]=null;}
this._ysCells=null;while(this.ysCont.childNodes.length>0)this.ysCont.removeChild(this.ysCont.lastChild);this.ysCont.parentNode.removeChild(this.ysCont);this.ysCont=null;}
if(type=="hours"){this.hsCont.onclick=this.hsCont.ontouchstart=null;this._hsActive=null;for(var a in this._hsCells){this._hsCells[a]._cell=null;this._hsCells[a]._hours=null;this._hsCells[a].parentNode.removeChild(this._hsCells[a]);this._hsCells[a]=null;}
this._hsCells=null;while(this.hsCont.childNodes.length>0)this.hsCont.removeChild(this.hsCont.lastChild);this.hsCont.parentNode.removeChild(this.hsCont);this.hsCont=null;}
if(type=="minutes"){this.rsCont.onclick=this.rsCont.ontouchstart=null;this._rsActive=null;for(var a in this._rsCells){this._rsCells[a]._cell=null;this._rsCells[a]._minutes=null;this._rsCells[a].parentNode.removeChild(this._rsCells[a]);this._rsCells[a]=null;}
this._rsCells=null;while(this.rsCont.childNodes.length>0)this.rsCont.removeChild(this.rsCont.lastChild);this.rsCont.parentNode.removeChild(this.rsCont);this.rsCont=null;}
this._sel._ta[type]=null;}
this.setMinutesInterval=function(d){if(!(d==1||d==5||d==10||d==15))return;this._minutesInterval=d;this._unloadSelector("minutes");}
this._updateActiveMonth=function(){if(typeof(this._msActive)!="undefined"&&typeof(this._msCells[this._msActive])!="undefined")this._msCells[this._msActive].className="dhtmlxcalendar_selector_cell";this._msActive=this._activeMonth.getMonth();this._msCells[this._msActive].className="dhtmlxcalendar_selector_cell dhtmlxcalendar_selector_cell_active";}
this._updateActiveYear=function(){var i=this._activeMonth.getFullYear();if(this._ysCells[i])this._ysCells[i].className="dhtmlxcalendar_selector_cell dhtmlxcalendar_selector_cell_active";}
this._updateYearsList=function(d){for(var a in this._ysCells){this._ysCells[a]=null;delete this._ysCells[a];}
var i=12*Math.floor(d.getFullYear()/12);for(var q=0;q<4;q++){for(var w=0;w<3;w++){this.ysCont.childNodes[q].childNodes[w].innerHTML=i;this.ysCont.childNodes[q].childNodes[w]._year=i;this.ysCont.childNodes[q].childNodes[w].className="dhtmlxcalendar_selector_cell";this._ysCells[i++]=this.ysCont.childNodes[q].childNodes[w];}}
this._updateActiveYear();}
this._scrollYears=function(i){var y=(i<0?this.ysCont.firstChild.firstChild._year:this.ysCont.lastChild.lastChild._year)+i;var d=new Date(y,this._activeMonth.getMonth(),1,0,0,0,0);this._updateYearsList(d);}
this._updateActiveHours=function(){if(typeof(this._hsActive)!="undefined"&&typeof(this._hsCells[this._hsActive])!="undefined")this._hsCells[this._hsActive].className="dhtmlxcalendar_selector_cell";this._hsActive=this._activeDate.getHours();this._hsCells[this._hsActive].className="dhtmlxcalendar_selector_cell dhtmlxcalendar_selector_cell_active";}
this._updateVisibleHours=function(){this.contTime.firstChild.firstChild.childNodes[1].innerHTML=this._fixLength(this._activeDate.getHours(),2);}
this._updateActiveMinutes=function(){if(this._rsActive!=null&&typeof(this._rsActive)!="undefined"&&typeof(this._rsCells[this._rsActive])!="undefined")this._rsCells[this._rsActive].className="dhtmlxcalendar_selector_cell";if(this._minutesInterval==1){this._rsActive=(this.getFormatedDate("%i").toString()).charAt(this._selectorMode==1?0:1);}else{this._rsActive=this._activeDate.getMinutes();}
if(typeof(this._rsCells[this._rsActive])!="undefined")this._rsCells[this._rsActive].className="dhtmlxcalendar_selector_cell dhtmlxcalendar_selector_cell_active";}
this._updateVisibleMinutes=function(h){var t=this._fixLength(this._activeDate.getMinutes(),2).toString();if(h==true)t=t.charAt(0)+"<span class='dhtmlxcalendar_selected_date'>"+t.charAt(1)+"</span>";this.contTime.firstChild.firstChild.childNodes[3].innerHTML=t;if(h==true)this.contTime.firstChild.firstChild.childNodes[3].lastChild._par=true;}
this._fixLength=function(t,r){while(String(t).length<r)t="0"+String(t);return t;}
this._dateFormat="";this._dateFormatRE=null;this.setDateFormat=function(format){var upd={};if(this._strToDate!=null){for(var a in this.i){if(this.i[a].input!=null&&this.i[a].input.value.length>0){var d=this._strToDate(this.i[a].input.value,this._dateFormat||this.langData[this.lang].dateformat||"%Y-%m-%d");if(d instanceof Date)upd[a]=d;}}}
this._dateFormat=format;var k=String(this._dateFormat).replace(/%[a-zA-Z]+/g,function(t){var t2=t.replace(/%/,"");switch(t2){case"n":case"h":case"j":case"g":case"G":return"\\d{1,2}";case"m":case"d":case"H":case"i":case"s":case"y":return"\\d{2}";case"Y":return"\\d{4}";case"M":return"("+that.langData[that.lang].monthesSNames.join("|").toLowerCase()+"){1,}";case"F":return"("+that.langData[that.lang].monthesFNames.join("|").toLowerCase()+"){1,}";case"D":return"[a-z]{2}";case"a":case"A":return"AM|PM";case"u":return"\\d{1,6}";case"P":return"[\\+\\-]\\d{1,2}\\:\\d{1,2}";}
return t;});this._dateFormatRE=new RegExp(k,"i");for(var a in upd){this.i[a].input.value=this._dateToStr(upd[a]);}
upd=null;}
this.setDateFormat(this.langData[this.lang].dateformat||"%Y-%m-%d");this._updateDateStr=function(str){if(!this._dateFormatRE||!str.match(this._dateFormatRE))return;if(str==this.getFormatedDate())return;var r=this._strToDate(str);if(!(r instanceof Date))return;if(this.checkEvent("onBeforeChange")){if(!this.callEvent("onBeforeChange",[new Date(r.getFullYear(),r.getMonth(),r.getDate(),r.getHours(),r.getMinutes(),r.getSeconds())])){this._updateInp();return;}}
this._nullDate=false;this._activeDate=r;this._drawMonth(this._nullDate?new Date():this._activeDate);this._updateVisibleMinutes();this._updateVisibleHours();if(this._sel&&this._isSelectorVisible())this._doOnSelectorShow(this._sel._t);this._doOnSelectorChange(true);}
this.showMonth=function(d){if(typeof(d)=="string")d=this._strToDate(d);if(!(d instanceof Date))return;this._drawMonth(d);}
this.setFormatedDate=function(format,str,a,return_only){var date=this._strToDate(str,format);if(return_only)return date;this.setDate(date);}
this.getFormatedDate=function(format,date){if(!(date&&date instanceof Date)){if(this._nullDate)return"";date=new Date(this._activeDate);}
return this._dateToStr(date,format);}
this.getWeekNumber=function(dateX){if(typeof(dateX)=="string")dateX=this._strToDate(dateX);if(!(dateX instanceof Date))return"Invalid Date";if(typeof(this._ftDay)=="undefined")this._ftDay=4;var ws=this._wStart;var we=ws+7;var ft=4;var x1_date=new Date(dateX.getFullYear(),0,1,0,0,0,0);var x1=x1_date.getDay();if(x1==0)x1=7;if(ft<ws){ft+=7;x1+=7;}
var i=0;if(x1>=ws&&x1<=ft){}else{i=1;}
var k=x1-ws;var w1=new Date(dateX.getFullYear(),0,1-k+i*7,0,0,0,0);var d7=604800000;var x2=new Date(dateX.getFullYear(),dateX.getMonth(),dateX.getDate()+1,0,0,0,0);var wn=Math.ceil((x2.getTime()-w1.getTime())/d7);if(wn==0){var curDate=new Date(dateX.getFullYear(),dateX.getMonth(),dateX.getDate(),0,0,0,0);var firstDay=curDate.getDay()-this._wStart;if(firstDay<0)firstDay=firstDay+7;curDate.setDate(curDate.getDate()-firstDay);wn=this.getWeekNumber(curDate);}
return wn;}
this.showWeekNumbers=function(){this.base.firstChild.className="dhtmlxcalendar_wn";}
this.hideWeekNumbers=function(){this.base.firstChild.className="";}
this.show=function(id){if(!id&&this._hasParent){this._show();return;}
if(typeof(id)=="string"){var i=document.getElementById(id);if(i!=null&&typeof(i._dhtmlxcalendar_uid)!="undefined"&&this.i[i._dhtmlxcalendar_uid]!=null){this._show(i._dhtmlxcalendar_uid);return;}}
if(typeof(id)=="object"&&typeof(id._dhtmlxcalendar_uid)!="undefined"&&this.i[id._dhtmlxcalendar_uid]==id){this._show(id._dhtmlxcalendar_uid);return;}
if(typeof(id)=="undefined"){for(var a in this.i)if(!id)id=a;}
if(!id)return;this._show(id);}
this.hide=function(){if(this._isVisible())this._hide();}
this.isVisible=function(){return this._isVisible();}
this._activeInp=null;this.pos="bottom";this.setPosition=function(x,y){this._px=null;this._py=null;if(x=="right"||x=="bottom"){this.pos=x;}else{this.pos="int";if(typeof(x)!="undefined"&&!isNaN(x)){this.base.style.left=x+"px";this._px=x;}
if(typeof(y)!="undefined"&&!isNaN(y)){this.base.style.top=y+"px";this._py=y;}
this._ifrSize();}}
this._show=function(inpId,autoHide){if(autoHide===true&&this._activeInp==inpId&&this._isVisible()){this._hide();return;}
this.base.style.visibility="hidden";this.base.style.display="";if(!inpId){if(this._px!=null&&this._py!=null){this.base.style.left=this._px+"px";this.base.style.top=this._py+"px";}else{this.base.style.left="0px";this.base.style.top="0px";}}else{if(this.base.className.indexOf("dhtmlxcalendar_in_input")==-1)this.base.className+=" dhtmlxcalendar_in_input";var i=(this.i[inpId].input||this.i[inpId].button);var dim=window.dhx4.screenDim();var inp={top:window.dhx4.absTop(i),left:window.dhx4.absLeft(i)};if(this.pos=="right"){this.base.style.left=inp.left+i.offsetWidth+"px";this.base.style.top=Math.min(inp.top,dim.bottom-this.base.offsetHeight)+"px";}else if(this.pos=="bottom"){var y0=inp.top+i.offsetHeight+1;if(y0+this.base.offsetHeight>dim.bottom){var ny0=inp.top-this.base.offsetHeight;if(ny0>=-20)y0=ny0;}
var x=inp.left;if(x+this.base.offsetWidth>dim.right)x=Math.max(0,inp.left+i.offsetWidth-this.base.offsetWidth);this.base.style.left=x+"px";this.base.style.top=y0+"px";}else{this.base.style.left=(this._px||0)+"px";this.base.style.top=(this._py||0)+"px";}
this._activeInp=inpId;i=null;}
this._hideSelector();this.base.style.visibility="visible";this.base.style.zIndex=window.dhx4.zim.reserve(this.conf.zi);this._ifrSize();if(this._ifr)this._ifr.style.display="";this.callEvent("onShow",[]);}
this._hide=function(){if(this._lastHover!=null)this._clearDayHover();this._hideSelector();this.base.style.display="none";window.dhx4.zim.clear(this.conf.zi);if(this.base.className.indexOf("dhtmlxcalendar_in_input")>=0)this.base.className=this.base.className.replace(/\s{0,}dhtmlxcalendar_in_input/gi,"");this._activeInp=null;if(this._ifr)this._ifr.style.display="none";this.callEvent("onHide",[]);}
this._isVisible=function(){return(this.base.style.display!="none");}
this._rangeActive=false;this._rangeFrom=null;this._rangeTo=null;this._rangeSet={};this.setInsensitiveDays=function(d){var t=this._extractDates(d);for(var q=0;q<t.length;q++)this._rangeSet[new Date(t[q].getFullYear(),t[q].getMonth(),t[q].getDate(),0,0,0,0).getTime()]=true;this._drawMonth(this._activeMonth);}
this.clearInsensitiveDays=function(){this._clearRangeSet();this._drawMonth(this._activeMonth);}
this._holidays={};this.setHolidays=function(r){if(r==null){this._clearHolidays();}else if(r!=null){var t=this._extractDates(r);for(var q=0;q<t.length;q++)this._holidays[new Date(t[q].getFullYear(),t[q].getMonth(),t[q].getDate(),0,0,0,0).getTime()]=true;}
this._drawMonth(this._activeMonth);}
this._extractDates=function(r){if(typeof(r)=="string"||r instanceof Date)r=[r];var t=[];for(var q=0;q<r.length;q++){if(typeof(r[q])=="string"){var e=r[q].split(",");for(var w=0;w<e.length;w++)t.push(this._strToDate(e[w]));}else if(r[q]instanceof Date){t.push(r[q]);}}
return t;}
this._clearRange=function(){this._rangeActive=false;this._rangeType=null;this._rangeFrom=null;this._rangeTo=null;}
this._clearRangeSet=function(){for(var a in this._rangeSet){this._rangeSet[a]=null;delete this._rangeSet[a];}}
this._clearHolidays=function(){for(var a in this._holidays){this._holidays[a]=null;delete this._holidays[a];}}
this._isOutOfRange=function(time){if(this._rangeSet[time]==true)return true;if(this._rangeActive){if(this._rangeType=="in"&&(time<this._rangeFrom||time>this._rangeTo))return true;if(this._rangeType=="out"&&(time>=this._rangeFrom&&time<=this._rangeTo))return true;if(this._rangeType=="from"&&time<this._rangeFrom)return true;if(this._rangeType=="to"&&time>this._rangeTo)return true;}
var t0=new Date(time);if(this._rangeWeek){if(this._rangeWeekData[t0.getDay()]===true)return true;}
if(this._rangeMonth){if(this._rangeMonthData[t0.getDate()]===true)return true;}
if(this._rangeYear){if(this._rangeYearData[t0.getMonth()+"_"+t0.getDate()]===true)return true;}
return false;}
this.clearSensitiveRange=function(){this._clearRange();this._drawMonth(this._activeMonth);}
this.setSensitiveRange=function(from,to,ins){var f=false;if(from!=null&&to!=null){if(!(from instanceof Date))from=this._strToDate(from);if(!(to instanceof Date))to=this._strToDate(to);if(from.getTime()>to.getTime())return;this._rangeFrom=new Date(from.getFullYear(),from.getMonth(),from.getDate(),0,0,0,0).getTime();this._rangeTo=new Date(to.getFullYear(),to.getMonth(),to.getDate(),0,0,0,0).getTime();this._rangeActive=true;this._rangeType="in";f=true;}
if(!f&&from!=null&&to==null){if(!(from instanceof Date))from=this._strToDate(from);this._rangeFrom=new Date(from.getFullYear(),from.getMonth(),from.getDate(),0,0,0,0).getTime();this._rangeTo=null;if(ins===true)this._rangeFrom++;this._rangeActive=true;this._rangeType="from";f=true;}
if(!f&&from==null&&to!=null){if(!(to instanceof Date))to=this._strToDate(to);this._rangeFrom=null;this._rangeTo=new Date(to.getFullYear(),to.getMonth(),to.getDate(),0,0,0,0).getTime();if(ins===true)this._rangeTo--;this._rangeActive=true;this._rangeType="to";f=true;}
if(f)this._drawMonth(this._activeMonth);}
this.setInsensitiveRange=function(from,to){if(from!=null&&to!=null){if(!(from instanceof Date))from=this._strToDate(from);if(!(to instanceof Date))to=this._strToDate(to);if(from.getTime()>to.getTime())return;this._rangeFrom=new Date(from.getFullYear(),from.getMonth(),from.getDate(),0,0,0,0).getTime();this._rangeTo=new Date(to.getFullYear(),to.getMonth(),to.getDate(),0,0,0,0).getTime();this._rangeActive=true;this._rangeType="out";this._drawMonth(this._activeMonth);return;}
if(from!=null&&to==null){this.setSensitiveRange(null,from,true);return;}
if(from==null&&to!=null){this.setSensitiveRange(to,null,true);return;}}
this.disableDays=function(mode,d){if(mode=="week"){if(typeof(d)!="object"&&typeof(d.length)=="undefined")d=[d];if(!this._rangeWeekData)this._rangeWeekData={};for(var a in this._rangeWeekData){this._rangeWeekData[a]=false;delete this._rangeWeekData[a];}
for(var q=0;q<d.length;q++){this._rangeWeekData[d[q]]=true;if(d[q]==7)this._rangeWeekData[0]=true;}
this._rangeWeek=true;}
if(mode=="month"){if(typeof(d)!="object"&&typeof(d.length)=="undefined")d=[d];if(!this._rangeMonthData)this._rangeMonthData={};for(var a in this._rangeMonthData){this._rangeMonthData[a]=false;delete this._rangeMonthData[a];}
for(var q=0;q<d.length;q++)this._rangeMonthData[d[q]]=true;this._rangeMonth=true;}
if(mode=="year"){var t=this._extractDates(d);if(!this._rangeYearData)this._rangeYearData={};for(var a in this._rangeYearData){this._rangeYearData[a]=false;delete this._rangeYearData[a];}
for(var q=0;q<t.length;q++)this._rangeYearData[t[q].getMonth()+"_"+t[q].getDate()]=true;this._rangeYear=true;}
this._drawMonth(this._activeMonth);}
this.enableDays=function(mode){if(mode=="week"){this._rangeWeek=false;}
if(mode=="month"){this._rangeMonth=false;}
if(mode=="year"){this._rangeYear=false;}
this._drawMonth(this._activeMonth);}
this._tipData={};this._tipTM=null;this._tipTMTime=400;this._tipEvs=false;this._tipPopup=null;this._tipCellDate=null;this._tipCellDim=null;this.setTooltip=function(dateX,text,showIcon,usePopup){var t=this._extractDates(dateX);for(var q=0;q<t.length;q++){var k=new Date(t[q].getFullYear(),t[q].getMonth(),t[q].getDate(),0,0,0,0).getTime();this._tipData[k]={text:text,showIcon:showIcon,usePopup:usePopup};}
this._drawMonth(this._activeMonth);}
this.clearTooltip=function(dateX){var t=this._extractDates(dateX);for(var q=0;q<t.length;q++){var k=new Date(t[q].getFullYear(),t[q].getMonth(),t[q].getDate(),0,0,0,0).getTime();this._tipData[k]=null;delete this._tipData[k];}
this._drawMonth(this._activeMonth);}
this._initTooltipPopup=function(){if(this._tipEvs)return;this.attachEvent("onMouseOver",function(d){var k=new Date(d.getFullYear(),d.getMonth(),d.getDate(),0,0,0,0).getTime();if(this._tipData[k]!=null){if(this._tipTM)window.clearTimeout(this._tipTM);this._tipCellDate=d;this._tipCellDim=this.getCellDimension(d);this._tipText=this._tipData[k].text;this._tipTM=window.setTimeout(this._showTooltipPopup,this._tipTMTime);}});this.attachEvent("onMouseOut",this._hideTooltipPopup);this._tipEvs=true;}
this._showTooltipPopup=function(text,x,y,w,h){if(!that._tipPopup)that._tipPopup=new dhtmlXPopup({mode:"top"});that._tipPopup.attachHTML(that._tipText);that._tipPopup.show(that._tipCellDim.x,that._tipCellDim.y,that._tipCellDim.w,that._tipCellDim.h);that.callEvent("onPopupShow",[that._tipCellDate]);}
this._hideTooltipPopup=function(){if(this._tipTM)window.clearTimeout(this._tipTM);if(this._tipPopup!=null&&this._tipPopup.isVisible()){this._tipPopup.hide();this.callEvent("onPopupHide",[this._tipCellDate]);}}
this.getPopup=function(){return this._tipPopup;}
this.getCellDimension=function(dateX){if(typeof(dateX)=="string")dateX=this._strToDate(dateX);if(!(dateX instanceof Date))return null;var t=new Date(dateX.getFullYear(),dateX.getMonth(),dateX.getDate(),0,0,0,0).getTime();var k=null;for(var q=0;q<this.contDates.childNodes.length;q++){for(var w=0;w<this.contDates.childNodes[q].childNodes.length;w++){var p=this.contDates.childNodes[q].childNodes[w];if(p._date!=null&&p._date.getTime()==t)k={x:window.dhx4.absLeft(p),y:window.dhx4.absTop(p),w:p.offsetWidth,h:p.offsetHeight};p=null;}}
return k;}
this._updateFromInput=function(t){if(this._nullInInput&&((t.value).replace(/\s/g,"")).length==0){if(this.checkEvent("onBeforeChange")){if(!this.callEvent("onBeforeChange",[null])){this._updateInp();return;}}
this.setDate(null);}else{this._updateDateStr(t.value);}
t=null;}
this._doOnClick=function(e){e=e||event;var t=(e.target||e.srcElement);if(t._dhtmlxcalendar_uid&&t._dhtmlxcalendar_uid!=that._activeInp&&that._isVisible()&&that._activeInp){that._hide();return;}
if(!t._dhtmlxcalendar_uid||!that.i[t._dhtmlxcalendar_uid]){if(that._isSelectorVisible())that._hideSelector();else if(!that._hasParent&&that._isVisible())that._hide();}}
this._doOnKeyDown=function(e){e=e||event;if(e.keyCode==27||e.keyCode==13){if(that._isSelectorVisible())that._hideSelector();else if(that._isVisible()&&!that._hasParent)that._hide();}}
this._doOnInpClick=function(e){e=e||event;if(e.type=="touchstart"&&e.preventDefault!=null)e.preventDefault();var t=(e.target||e.srcElement);if(!t._dhtmlxcalendar_uid)return;if(!that._listenerEnabled){that._updateFromInput(t);}
that._show(t._dhtmlxcalendar_uid,true);}
this._doOnInpKeyUp=function(e){e=e||event;var t=(e.target||e.srcElement);if(e.keyCode==13||!t._dhtmlxcalendar_uid)return;if(!that._listenerEnabled)that._updateFromInput(t);}
this._doOnBtnClick=function(e){e=e||event;if(e.type=="touchstart"&&e.preventDefault!=null)e.preventDefault();var t=(e.target||e.srcElement);if(!t._dhtmlxcalendar_uid)return;if(that.i[t._dhtmlxcalendar_uid].input!=null)that._updateFromInput(that.i[t._dhtmlxcalendar_uid].input);that._show(t._dhtmlxcalendar_uid,true);}
this._doOnUnload=function(){if(that&&that.unload)that.unload();}
if(typeof(window.addEventListener)=="function"){document.body.addEventListener("click",that._doOnClick,false);window.addEventListener("keydown",that._doOnKeyDown,false);window.addEventListener("unload",that._doOnUnload,false);if(this.conf.touch==true)document.body.addEventListener("touchstart",that._doOnClick,false);}else{document.body.attachEvent("onclick",that._doOnClick);document.body.attachEvent("onkeydown",that._doOnKeyDown);window.attachEvent("onunload",that._doOnUnload);}
this.attachObj=function(obj){var a=window.dhx4.newId();if(typeof(obj)=="string"){this.i[a]={input:document.getElementById(obj)};}else if(typeof(obj.tagName)!="undefined"){this.i[a]={input:obj};}else if(typeof(obj)=="object"&&(obj.input!=null||obj.button!=null)){this.i[a]={};if(obj.input!=null)this.i[a].input=(typeof(obj.input)=="string"?document.getElementById(obj.input):obj.input);if(obj.button!=null)this.i[a].button=(typeof(obj.button)=="string"?document.getElementById(obj.button):obj.button);}
this._attachEventsToObject(a);return a;}
this.detachObj=function(obj){var a=null;if(this.i[obj]!=null){a=obj;}else if(typeof(obj)=="string"){obj=document.getElementById(obj);a=obj._dhtmlxcalendar_uid;}else if(typeof(obj.tagName)!="undefined"){a=obj._dhtmlxcalendar_uid;}else if(typeof(obj)=="object"&&(obj.input!=null||obj.button!=null)){if(a==null&&obj.input!=null)a=(typeof(obj.input)=="string"?document.getElementById(obj.input):obj.input)._dhtmlxcalendar_uid;if(a==null&&obj.button!=null)a=(typeof(obj.button)=="string"?document.getElementById(obj.button):obj.button)._dhtmlxcalendar_uid;}
if(a!=null&&this.i[a]!=null){this._detachEventsFromObject(a);for(var b in this.i[b]){this.i[a][b]._dhtmlxcalendar_uid=null;this.i[a][b]=null;delete this.i[a][b];}
this.i[a]=null;delete this.i[a];return true;}
return false;}
this._attachEventsToObject=function(a){if(this.i[a].button!=null){this.i[a].button._dhtmlxcalendar_uid=a;if(typeof(window.addEventListener)=="function"){this.i[a].button.addEventListener("click",that._doOnBtnClick,false);if(this.conf.touch==true)this.i[a].button.addEventListener("touchstart",that._doOnBtnClick,false);}else{this.i[a].button.attachEvent("onclick",that._doOnBtnClick);}}else if(this.i[a].input!=null){this.i[a].input._dhtmlxcalendar_uid=a;if(typeof(window.addEventListener)=="function"){this.i[a].input.addEventListener("click",that._doOnInpClick,false);this.i[a].input.addEventListener("keyup",that._doOnInpKeyUp,false);if(this.conf.touch==true)this.i[a].input.addEventListener("touchstart",that._doOnInpClick,false);}else{this.i[a].input.attachEvent("onclick",that._doOnInpClick);this.i[a].input.attachEvent("onkeyup",that._doOnInpKeyUp);}}}
this._detachEventsFromObject=function(a){if(this.i[a].button!=null){if(typeof(window.addEventListener)=="function"){this.i[a].button.removeEventListener("click",that._doOnBtnClick,false);if(this.conf.touch==true)this.i[a].button.removeEventListener("touchstart",that._doOnBtnClick,false);}else{this.i[a].button.detachEvent("onclick",that._doOnBtnClick);}}else if(this.i[a].input!=null){if(typeof(window.addEventListener)=="function"){this.i[a].input.removeEventListener("click",that._doOnInpClick,false);this.i[a].input.removeEventListener("keyup",that._doOnInpKeyUp,false);if(this.conf.touch==true)this.i[a].input.removeEventListener("touchstart",that._doOnInpClick,false);}else{this.i[a].input.detachEvent("onclick",that._doOnInpClick);this.i[a].input.detachEvent("onkeyup",that._doOnInpKeyUp);}}}
this._updateInp=function(){if(this.i!=null&&this._activeInp!=null&&this.i[this._activeInp]!=null&&this.i[this._activeInp].input!=null){this.i[this._activeInp].input.value=this.getFormatedDate();}}
this.enableListener=function(t){if(!t)return;if(typeof(window.addEventListener)=="function"){t.addEventListener("focus",that._listenerEvFocus,false);t.addEventListener("blur",that._listenerEvBlur,false);}else{t.attachEvent("onfocus",that._listenerEvFocus);t.attachEvent("onblur",that._listenerEvBlur);}
t=null;}
this.disableListener=function(t){if(!t)return;t._f0=false;if(this._tmListener)window.clearTimeout(this._tmListener);if(typeof(window.addEventListener)=="function"){t.removeEventListener("focus",that._listenerEvFocus,false);t.removeEventListener("blur",that._listenerEvBlur,false);}else{t.detachEvent("onfocus",that._listenerEvFocus);t.detachEvent("onblur",that._listenerEvBlur);}
t=null;}
this._startListener=function(t){if(this._tmListener)window.clearTimeout(this._tmListener);if(typeof(t._v1)=="undefined")t._v1=t.value;if(t._v1!=t.value){this._updateFromInput(t);t._v1=t.value;}
if(t._f0)this._tmListener=window.setTimeout(function(){that._startListener(t);},100);}
this._listenerEvFocus=function(e){e=e||event;var t=e.target||e.srcElement;t._f0=true;that._startListener(t)
t=null;}
this._listenerEvBlur=function(e){e=e||event;var t=e.target||e.srcElement;t._f0=false;t=null;}
for(var a in this.i)this._attachEventsToObject(a);window.dhx4._eventable(this);this._evOnArrowClick=function(args){return this.callEvent("onArrowClick",args);}
this._evOnClick=function(args){return this.callEvent("onClick",args);}
this._evOnMouseOut=function(args){return this.callEvent("onMouseOut",args);}
this._evOnMouseOver=function(args){return this.callEvent("onMouseOver",args);}
this.unload=function(){this._activeDate=null;this._activeDateCell=null;this._activeInp=null;this._activeMonth=null;this._dateFormat=null;this._dateFormatRE=null;this._lastHover=null;if(this._tmListener)window.clearTimeout(this._tmListener);this._tmListener=null;if(typeof(window.addEventListener)=="function"){document.body.removeEventListener("click",that._doOnClick,false);window.removeEventListener("keydown",that._doOnKeyDown,false);window.removeEventListener("unload",that._doOnUnload,false);if(this.conf.touch==true)document.body.removeEventListener("touchstart",that._doOnClick,false);}else{document.body.detachEvent("onclick",that._doOnClick);document.body.detachEvent("onkeydown",that._doOnKeyDown);window.detachEvent("onunload",that._doOnKeyDown);}
this._doOnClick=null;this._doOnKeyDown=null;this._doOnUnload=null;for(var a in this.i){this.i[a]._dhtmlxcalendar_uid=null;this._detachEventsFromObject(a);this.disableListener(this.i[a].input);this.i[a]=null;delete this.i[a];}
this.i=null;this._doOnInpClick=null;this._doOnInpKeyUp=null;window.dhx4._eventable(this,"clear");this.contMonth.onselectstart=null;this.contMonth.firstChild.firstChild.onclick=null;this.contMonth.firstChild.firstChild.ontouchstart=null;this.contMonth.firstChild.firstChild.firstChild.onmouseover=null;this.contMonth.firstChild.firstChild.firstChild.onmouseout=null;this.contMonth.firstChild.firstChild.lastChild.onmouseover=null;this.contMonth.firstChild.firstChild.lastChild.onmouseout=null;while(this.contMonth.firstChild.firstChild.childNodes.length>0)this.contMonth.firstChild.firstChild.removeChild(this.contMonth.firstChild.firstChild.lastChild);this.contMonth.firstChild.removeChild(this.contMonth.firstChild.firstChild);this.contMonth.removeChild(this.contMonth.firstChild);this.contMonth.parentNode.removeChild(this.contMonth);this.contMonth=null;while(this.contDays.firstChild.childNodes.length>0)this.contDays.firstChild.removeChild(this.contDays.firstChild.lastChild);this.contDays.removeChild(this.contDays.firstChild);this.contDays.parentNode.removeChild(this.contDays);this.contDays=null;this.contDates.onclick=null;this.contDates.ontouchstart=null;this.contDates.onmouseover=null;this.contDates.onmouseout=null;while(this.contDates.childNodes.length>0){while(this.contDates.lastChild.childNodes.length>0){this.contDates.lastChild.lastChild._css_date=null;this.contDates.lastChild.lastChild._css_month=null;this.contDates.lastChild.lastChild._css_weekend=null;this.contDates.lastChild.lastChild._css_hover=null;this.contDates.lastChild.lastChild._date=null;this.contDates.lastChild.lastChild._q=null;this.contDates.lastChild.lastChild._w=null;this.contDates.lastChild.removeChild(this.contDates.lastChild.lastChild);}
this.contDates.removeChild(this.contDates.lastChild);}
this.contDates.parentNode.removeChild(this.contDates);this.contDates=null;this.contTime.firstChild.firstChild.onclick=null;this.contTime.firstChild.firstChild.ontouchstart=null;while(this.contTime.firstChild.firstChild.childNodes.length>0)this.contTime.firstChild.firstChild.removeChild(this.contTime.firstChild.firstChild.lastChild);this.contTime.firstChild.removeChild(this.contTime.firstChild.firstChild);this.contTime.removeChild(this.contTime.firstChild);this.contTime.parentNode.removeChild(this.contTime);this.contTime=null;this._lastHover=null;this._unloadSelector("month");this._unloadSelector("year");this._unloadSelector("hours");this._unloadSelector("minutes");if(this._selCover){this._selCover.parentNode.removeChild(this._selCover);this._selCover=null;}
if(this._sel){for(var a in this._sel._ta)this._sel._ta[a]=null;this._sel._ta=null;this._sel._t=null;this._sel.onmouseover=null;this._sel.onmouseout=null;while(this._sel.firstChild.firstChild.firstChild.childNodes.length>0){this._sel.firstChild.firstChild.firstChild.lastChild.onclick=null;this._sel.firstChild.firstChild.firstChild.lastChild.onmouseover=null;this._sel.firstChild.firstChild.firstChild.lastChild.onmouseout=null;this._sel.firstChild.firstChild.firstChild.removeChild(this._sel.firstChild.firstChild.firstChild.lastChild);}
this._sel.firstChild.firstChild.removeChild(this._sel.firstChild.firstChild.firstChild);this._sel.firstChild.removeChild(this._sel.firstChild.firstChild);while(this._sel.childNodes.length>0)this._sel.removeChild(this._sel.lastChild);this._sel.parentNode.removeChild(this._sel);this._sel=null;}
this.base.onclick=null;this.base.onmousedown=null;this.base.ontouchstart=null;this.base.onmouseout=null;this.base.parentNode.removeChild(this.base);this.base=null;this._clearDayHover=null;this._clearSelHover=null;this._doOnSelectorChange=null;this._doOnSelectorShow=null;this._drawMonth=null;this._fixLength=null;this._ifrSize=null;this._hide=null;this._hideSelector=null;this._initSelector=null;this._isSelectorVisible=null;this._isVisible=null;this._scrollYears=null;this._show=null;this._showSelector=null;this._strToDate=null;this._updateActiveHours=null;this._updateActiveMinutes=null;this._updateActiveMonth=null;this._updateActiveYear=null;this._updateCellStyle=null;this._updateDateStr=null;this._updateVisibleHours=null;this._updateVisibleMinutes=null;this._updateYearsList=null;this.enableIframe=null;this.hide=null;this.hideTime=null;this.setDate=null;this.setDateFormat=null;this.setYearsRange=null;this.show=null;this.showTime=null;this.unload=null;if(this._tipPopup!=null){this._tipPopup.unload();this._tipPopup=null;}
for(var a in this)delete this[a];a=that=null;}
this.setDate(this._activeDate);return this;};dhtmlXCalendarObject.prototype.lang="en";dhtmlXCalendarObject.prototype.langData={"en":{dateformat:"%Y-%m-%d",hdrformat:"%F %Y",monthesFNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthesSNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],daysFNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],daysSNames:["Su","Mo","Tu","We","Th","Fr","Sa"],weekstart:1,weekname:"w",today:"Today",clear:"Clear"}};dhtmlXCalendarObject.prototype._buildMonthHdr=function(val){var that=this;var z=function(t){return(String(t).length==1?"0"+String(t):t);}
var w=function(type,str){return"<span class='dhtmlxcalendar_month_label_"+type+"'>"+str+"</span>";}
var format=String(this.langData[this.lang].hdrformat||("%F %Y")).replace(/%[a-z]/gi,function(t){switch(t){case"%m":return w("month",z(val.getMonth()+1));case"%n":return w("month",val.getMonth()+1);case"%M":return w("month",that.langData[that.lang].monthesSNames[val.getMonth()]);case"%F":return w("month",that.langData[that.lang].monthesFNames[val.getMonth()]);case"%y":return w("year",z(val.getYear()%100));case"%Y":return w("year",val.getFullYear());case"%%":return"%";default:return t;}});that=z=w=null;return format;};dhtmlXCalendarObject.prototype.enableIframe=function(mode){if(mode==true){if(!this._ifr){this._ifr=document.createElement("IFRAME");this._ifr.frameBorder=0;this._ifr.border=0;this._ifr.setAttribute("src","javascript:false;");this._ifr.className="dhtmlxcalendar_ifr";this._ifr.onload=function(){this.onload=null;this.contentWindow.document.open("text/html","replace");this.contentWindow.document.write("<html><head><style>html,body{width:100%;height:100%;overflow:hidden;margin:0px;}</style></head><body</body></html>");}
this.base.parentNode.insertBefore(this._ifr,this.base);this._ifrSize();}}else{if(this._ifr){this._ifr.parentNode.removeChild(this._ifr);this._ifr=null;}}};dhtmlXCalendarObject.prototype._ifrSize=function(){if(this._ifr){this._ifr.style.left=this.base.style.left;this._ifr.style.top=this.base.style.top;this._ifr.style.width=this.base.offsetWidth+"px";this._ifr.style.height=this.base.offsetHeight+"px";}};dhtmlxCalendarObject=dhtmlXCalendarObject;dhtmlXCalendarObject.prototype._dateStrings=function(){var k=this.langData[this.lang];return{monthFullName:k.monthesFNames,monthShortName:k.monthesSNames,dayFullName:k.daysFNames,dayShortName:k.daysSNames};};dhtmlXCalendarObject.prototype._strToDate=function(val,format){return window.dhx4.str2date(val,format||this._dateFormat,this._dateStrings());};dhtmlXCalendarObject.prototype._dateToStr=function(val,format){return window.dhx4.date2str(val,format||this._dateFormat,this._dateStrings());};window.dhtmlxDblCalendarObject=window.dhtmlXDoubleCalendarObject=window.dhtmlXDoubleCalendar=function(parentId){var that=this;this.leftCalendar=new dhtmlXCalendarObject(parentId);this.leftCalendar.hideTime();this.rightCalendar=new dhtmlXCalendarObject(parentId);this.rightCalendar.hideTime();this.leftCalendar.attachEvent("onClick",function(d){that._updateRange("rightCalendar",d,null);that._evOnClick(["left",d]);});this.rightCalendar.attachEvent("onClick",function(d){that._updateRange("leftCalendar",null,d);that._evOnClick(["right",d]);});this.leftCalendar.attachEvent("onBeforeChange",function(d){return that._evOnBeforeChange(["left",d]);});this.rightCalendar.attachEvent("onBeforeChange",function(d){return that._evOnBeforeChange(["right",d]);});this.show=function(){this.leftCalendar.show();this.rightCalendar.base.style.marginLeft=this.leftCalendar.base.offsetWidth-1+"px";this.rightCalendar.show();}
this.hide=function(){this.leftCalendar.hide();this.rightCalendar.hide();}
this.setDateFormat=function(t){this.leftCalendar.setDateFormat(t);this.rightCalendar.setDateFormat(t);}
this.setDates=function(d0,d1){if(d0!=null)this.leftCalendar.setDate(d0);if(d1!=null)this.rightCalendar.setDate(d1);this._updateRange();}
this._updateRange=function(obj,from,to){if(arguments.length==3){(obj=="leftCalendar"?this.leftCalendar:this.rightCalendar).setSensitiveRange(from,to);}else{this.leftCalendar.setSensitiveRange(null,this.rightCalendar.getDate());this.rightCalendar.setSensitiveRange(this.leftCalendar.getDate(),null);}}
this.getFormatedDate=function(){return this.leftCalendar.getFormatedDate.apply(this.leftCalendar,arguments);}
this.unload=function(){window.dhx4._eventable(this,"clear");this.leftCalendar.unload();this.rightCalendar.unload();this.leftCalendar=this.rightCalendar=null;this._updateRange=null;this._evOnClick=null;this._evOnBeforeChange=null;this.show=null;this.hide=null;this.setDateFormat=null;this.setDates=null;this.getFormatedDate=null;this.unload=null;that=null;}
this._evOnClick=function(args){return this.callEvent("onClick",args);}
this._evOnBeforeChange=function(args){return this.callEvent("onBeforeChange",args);}
window.dhx4._eventable(this);return this;}
function dhtmlXCombo(parentId,formName,width,optionType,tabIndex){var that=this;var apiObj=null;var skin=null;if(typeof(parentId)=="object"&&!parentId.tagName){apiObj=parentId;parentId=apiObj.parent;width=apiObj.width;formName=apiObj.name;optionType=apiObj.mode;skin=apiObj.skin;}
this.cont=(typeof(parentId)=="string"?document.getElementById(parentId):parentId);this.conf={skin:null,form_name:formName||"dhxcombo",combo_width:(parseInt(width)||this.cont.offsetWidth||120)-(dhx4.isFF||dhx4.isIE||dhx4.isChrome||dhx4.isOpera?2:0),combo_image:false,combo_focus:false,opts_type:(typeof(optionType)=="string"&&typeof(this.modes[optionType])!="undefined"?optionType:"option"),opts_count:8,opts_count_min:3,opts_width:null,item_h:null,list_zi_id:window.dhx4.newId(),allow_free_text:true,allow_empty_value:true,free_text_empty:false,enabled:true,btn_left:((window.dhx4.isIE6||window.dhx4.isIE7||window.dhx4.isIE8)&&typeof(window.addEventListener)=="undefined"?1:0),ro_mode:false,ro_text:"",ro_tm:null,ro_tm_time:750,img_path:"",img_def:"",img_def_dis:true,template:{header:true,input:"#text#",option:"#text#"},f_func:null,f_mode:false,f_url:false,f_cache:false,f_cache_data:{},f_dyn:false,f_dyn_end:false,f_mask:"",f_ac:true,f_ac_text:"",f_server_tm:null,f_server_last:"",f_loading:false,s_tm:null,s_time:200,s_mode:"select",last_hover:null,last_selected:null,last_match:null,last_text:"",last_value:"",tm_hover:null,tm_confirm_blur:null,clear_click:false,clear_blur:false,clear_bsp:false,clear_key:false,i_ofs:23,sp:{dhx_skyblue:{list_ofs:1,hdr_ofs:1,scr_ofs:1},dhx_web:{list_ofs:0,hdr_ofs:1,scr_ofs:0},dhx_terrace:{list_ofs:1,hdr_ofs:1,scr_ofs:1},material:{list_ofs:0,hdr_ofs:1,scr_ofs:1}},col_w:null};this.conf.combo_image=(this.modes[this.conf.opts_type].image==true);this.t={};this.base=document.createElement("DIV");this.base.style.width=this.conf.combo_width+"px";this.base.innerHTML="<input type='text' class='dhxcombo_input' style='width:"+(this.conf.combo_width-(this.conf.i_ofs+1)-(this.conf.combo_image?this.conf.i_ofs:0))+"px;"+(this.conf.combo_image?"margin-left:"+this.conf.i_ofs+"px;":"")+"' autocomplete='off'>"+"<input type='hidden' value=''>"+"<input type='hidden' value='false'>"+"<div class='dhxcombo_select_button'><div class='dhxcombo_select_img'></div></div>"+
(this.conf.combo_image?"<div class='dhxcombo_top_image'>"+this.modes[this.conf.opts_type].getTopImage(null,this.conf.enabled)+"</div>":"");this.cont.appendChild(this.base);this.list=document.createElement("DIV");this.list._listId=window.dhx4.newId();this.list.style.display="none";document.body.insertBefore(this.list,document.body.firstChild);this._doOnListScroll=function(){if(that.conf.s_tm!=null)window.clearTimeout(that.conf.s_tm);that.conf.s_tm=window.setTimeout(that._doOnListScrollAction,that.conf.s_time);}
this._doOnListScrollAction=function(){that.conf.s_tm=null;if(that.conf.s_mode=="scroll"&&that.list.scrollHeight-that.list.scrollTop-10<that.list.clientHeight){that._subloadRequest();}}
if(typeof(window.addEventListener)=="function"){this.list.addEventListener("scroll",this._doOnListScroll,false);}else{this.list.attachEvent("onscroll",this._doOnListScroll);}
this.setSkin(skin||window.dhx4.skin||(typeof(dhtmlx)!="undefined"?dhtmlx.skin:null)||window.dhx4.skinDetect("dhxcombo")||"material");this._updateTopImage=function(id){if(!this.conf.combo_image)return;if(id!=null){this.base.lastChild.innerHTML=this.t[id].obj.getTopImage(this.t[id].item,this.conf.enabled);}else{this.base.lastChild.innerHTML=this.modes[this.conf.opts_type].getTopImage(null,this.conf.enabled);}}
this._filterOpts=function(hiddenMode){if(this.conf.f_server_tm)window.clearTimeout(this.conf.f_server_tm);var k=String(this.base.firstChild.value).replace(new RegExp(this._fixRE(this.conf.f_ac_text)+"$","i"),"");if(this.conf.f_server_last==k.toLowerCase()){this._checkForMatch();return;}
if(this.conf.f_url!=null&&this.checkEvent("onDynXLS")){this.conf.f_server_last=k.toLowerCase();this.callEvent("onDynXLS",[k]);return;}
if(this.conf.f_url!=null){if(k.length==0){this.conf.f_server_last=k.toLowerCase();this.clearAll();return;}
if(this.conf.f_cache==true&&this.conf.f_cache_data[k]!=null){this.clearAll();this.conf.f_server_last=k.toLowerCase();for(var q=0;q<this.conf.f_cache_data[k].data.length;q++){this.load(this.conf.f_cache_data[k].data[q]);}
if(this.conf.f_dyn){this.conf.f_dyn_end=this.conf.f_cache_data[k].dyn_end;this.conf.f_mask=this.conf.f_cache_data[k].mask;}
if(hiddenMode!==true){this._showList(true);this._checkForMatch();}}else{this.conf.f_server_tm=window.setTimeout(function(){that.conf.f_server_last=k.toLowerCase();that.conf.f_mask=k;var params="mask="+encodeURIComponent(k);if(that.conf.f_dyn){params+="&pos=0";that.conf.f_dyn_end=false;}
var callBack=function(r){if(that.conf.f_cache){if(!that.conf.f_cache_data[k])that.conf.f_cache_data[k]={data:[],dyn_end:false,mask:k};that.conf.f_cache_data[k].data.push(r.xmlDoc.responseXML);}
that.clearAll();that.load(r.xmlDoc.responseXML);var v=(that.base.offsetWidth>0&&that.base.offsetHeight>0);if(v==true&&that.conf.enabled==true&&that.conf.combo_focus==true&&hiddenMode!==true){if(that.conf.f_ac&&that.conf.f_mode=="start"&&that.conf.clear_bsp==false&&that.list.firstChild!=null){var sid=that.list.firstChild._optId;var text=String(that.t[sid].obj.getText(that.list.firstChild,true));if(k==that.base.firstChild.value&&String(text).toLowerCase().indexOf(String(k).toLowerCase())===0){that.base.firstChild.value=text;that.conf.f_ac_text=text.substr(k.length);that._selectRange(k.length,text.length);}}
that._showList(true);that._checkForMatch();}
callBack=null;}
if(window.dhx4.ajax.method=="post"){window.dhx4.ajax.post(that.conf.f_url,params,callBack);}else if(window.dhx4.ajax.method=="get"){window.dhx4.ajax.get(that.conf.f_url+(String(that.conf.f_url).indexOf("?")>=0?"&":"?")+params,callBack);}},200);}}else{this.conf.f_server_last=k.toLowerCase();var r=(k.length==0?true:new RegExp((this.conf.f_mode=="start"?"^":"")+this._fixRE(k),"i"));var acText=null;for(var a in this.t){var t=false;if(r!==true){if(this.conf.f_func!=null){var option=this._getOption(this.t[a].item._optId,q);t=(this.conf.f_func.apply(window,[k,option])==true);}else{var text=this.t[a].obj.getText(this.t[a].item,true);t=(r.test(text)==true);}}
if(r===true||t==true){this.t[a].item.style.display="";if(acText==null&&k.length>0)acText=String(this.t[a].obj.getText(this.t[a].item,true));}else{this.t[a].item.style.display="none";}}
if(this.conf.f_ac&&this.conf.f_mode=="start"&&this.conf.clear_bsp==false&&acText!=null){this.conf.f_ac_text=acText.replace(new RegExp("^"+k,"i"),"");this.base.firstChild.value=acText;this._selectRange(this.conf.f_server_last.length,this.base.firstChild.value.length);}
if(this.conf.f_mode=="between"&&this.conf.clear_bsp==true){this._checkForMatch(true);}
if(hiddenMode!==true){this._showList(true);this._checkForMatch();}}}
this._searchRO=function(s){if(this.conf.ro_tm)window.clearTimeout(this.conf.ro_tm);this.conf.ro_text+=s;this._showList();for(var q=0;q<this.list.childNodes.length;q++){var sid=this.list.childNodes[q]._optId;var text=String(this.t[sid].obj.getText(this.list.childNodes[q],true)).toLowerCase();if(text.indexOf(this.conf.ro_text)===0){this._setSelected(sid,true,true);this._confirmSelect("script",false);break;}}
this.conf.ro_tm=window.setTimeout(function(){that.conf.ro_text="";},this.conf.ro_tm_time);}
this._fixRE=function(t){return String(t).replace(/[\\\^\$\*\+\?\.\(\)\|\{\}\[\]]/gi,"\\$&");}
this._initObj=function(data){if(typeof(data.template)!="undefined")this.setTemplate(data.template);if(data.add!=true&&this.conf.f_loading!=true)this.clearAll(false);this.addOption(data.options);}
this._xmlToObj=function(data,selectToObj,selectedIndex){var t={add:false,options:[]};var root=(selectToObj==true?data:data.getElementsByTagName("complete"));if(root.length>0){if(window.dhx4.s2b(root[0].getAttribute("add"))==true)t.add=true;var nodes=root[0].childNodes;for(var q=0;q<nodes.length;q++){if(typeof(nodes[q].tagName)!="undefined"){if(String(nodes[q].tagName).toLowerCase()=="template"){var template={};for(var w=0;w<nodes[q].childNodes.length;w++){var n=nodes[q].childNodes[w];if(n.tagName!=null){var k=n.tagName;if(typeof(this.conf.template[k])!="undefined"){template[k]=window.dhx4._xmlNodeValue(n);}
if(k=="columns"){for(var e=0;e<n.childNodes.length;e++){var col=n.childNodes[e];if(col.tagName!=null&&col.tagName=="column"){var colData={};for(var a in{width:1,css:1,header:1,option:1}){if(col.getAttribute(a)!=null)colData[a]=col.getAttribute(a);}
for(var a in{header:1,option:1}){var h=col.getElementsByTagName(a);if(h[0]!=null&&h[0].firstChild!=null)colData[a]=window.dhx4._xmlNodeValue(h[0]);}
if(template.columns==null)template.columns=[];template.columns.push(colData);}
col=null;}}}
n=null;}
this.setTemplate(template);}
if(String(nodes[q].tagName).toLowerCase()=="option"){var optSelected=false;if(selectToObj==true){optSelected=(t.options.length==selectedIndex);}else{optSelected=window.dhx4.s2b(nodes[q].getAttribute("selected"));}
var opt={value:nodes[q].getAttribute("value"),text:window.dhx4._xmlNodeValue(nodes[q]),selected:optSelected,checked:window.dhx4.s2b(nodes[q].getAttribute("checked"))};for(var a in{img:1,img_dis:1,img_src:1,img_src_dis:1,css:1}){if(nodes[q].getAttribute(a)!=null)opt[a]=nodes[q].getAttribute(a);}
for(var w=0;w<nodes[q].childNodes.length;w++){if(nodes[q].childNodes[w].tagName!=null&&String(nodes[q].childNodes[w].tagName).toLowerCase()=="text"){opt.text={};var n=nodes[q].childNodes[w];for(var e=0;e<n.childNodes.length;e++){if(n.childNodes[e].tagName!=null){opt.text[n.childNodes[e].tagName]=window.dhx4._xmlNodeValue(n.childNodes[e]);}}}}
t.options.push(opt);}}}
root=nodes=null;}
return t;}
window.dhx4._enableDataLoading(this,"_initObj","_xmlToObj","complete",{data:true});window.dhx4._eventable(this);this._getNearItem=function(item,dir){var sid=null;while(item!=null){item=item[dir<0?"previousSibling":"nextSibling"];if(sid==null&&item!=null&&item.style.display==""&&item._optId!=null){sid=item;item=null;}}
return sid;}
this.setName(this.conf.form_name);this._doOnListMouseMove=function(e){e=e||event;var t=e.target||e.srcElement;while(t!=null&&t!=this){if(typeof(t._optId)!="undefined"){if(that.conf.tm_hover)window.clearTimeout(that.conf.tm_hover);that._setSelected(t._optId,false,false,true);}
t=t.parentNode;}
t=null;}
this._doOnListMouseDown=function(e){e=e||event;e.cancelBubble=true;that.conf.clear_click=true;window.setTimeout(function(){that.base.firstChild.focus();},1);}
this._doOnListMouseUp=function(e){e=e||event;if(e.button!=that.conf.btn_left)return;var t=e.target||e.srcElement;while(t!=null&&t!=this){if(typeof(t._optId)!="undefined"){var r=true;if(typeof(that.t[t._optId].obj.optionClick)=="function"&&that.t[t._optId].obj.optionClick(t,e,that)!==true)r=false;if(r){that._setSelected(t._optId,null,true);that._confirmSelect("click");}}
t=t.parentNode;}
t=null;}
this._doOnListMouseOut=function(e){if(that.conf.tm_hover)window.clearTimeout(that.conf.tm_hover);that.conf.tm_hover=window.setTimeout(function(){var sId=that.conf.last_match||that.conf.last_selected;if(that.conf.last_match==null&&that.t[sId]!=null){if(that.base.firstChild.value!=that.t[sId].obj.getText(that.t[sId].item,true))sId=null;}
that._setSelected(sId,null,true,true);},1);}
this._doOnBaseMouseDown=function(e){if(!that.conf.enabled)return;that.conf.clear_click=true;e=e||event;if(e.button!=that.conf.btn_left)return;var t=e.target||e.srcElement;if(t!=this.firstChild){window.setTimeout(function(){that.base.firstChild.focus();},1);var p=t;while(p!=this&&p!=null){if(p==this.lastChild){if(typeof(that.modes[that.conf.opts_type].topImageClick)=="function"){var t_id=(that.conf.last_hover||that.conf.last_selected);var t_item=(t_id!=null?that.t[t_id].item:null);if(that.modes[that.conf.opts_type].topImageClick(t_item,that)!==true){t_id=t_item=null;return;}}
p=null;}else{p=p.parentNode;}}}
if(that._isListVisible()){that._hideList();}else{if(t!=this.firstChild)that.conf.clear_blur=true;that._showList();that._setSelected(that.conf.last_selected,true,true);}
t=null;}
this._doOnBodyMouseDown=function(){if(that.conf.clear_click){that.conf.clear_click=false;return;}
that._confirmSelect("blur");}
this._doOnInputFocus=function(){that.conf.clear_blur=false;if(that.conf.tm_confirm_blur)window.clearTimeout(that.conf.tm_confirm_blur);if(that.conf.combo_focus==false){that.conf.combo_focus=true;if(that.conf.skin=="material"&&that.base.className.match(/dhxcombo_actv/)==null){that.base.className+=" dhxcombo_actv";}
that.callEvent("onFocus",[]);}}
this._doOnInputBlur=function(){if(that.conf.clear_blur==true){that.conf.clear_blur=false;return;}
if(that.conf.tm_confirm_blur)window.clearTimeout(that.conf.tm_confirm_blur);that.conf.tm_confirm_blur=window.setTimeout(function(){if(that.conf.clear_click==false){that._confirmSelect("blur");that.conf.combo_focus=false;if(that.conf.skin=="material"&&that.base.className.match(/dhxcombo_actv/)!=null){that.base.className=that.base.className.replace(/\s*dhxcombo_actv/gi,"");}
that.callEvent("onBlur",[]);}},20);}
this._doOnInputKeyUp=function(e){e=e||event;if(that.conf.f_mode!=false){that.conf.clear_bsp=(e.keyCode==8||e.keyCode==46);that._filterOpts();return;}else{that._checkForMatch();}}
this._doOnInputKeyDown=function(e){e=e||event;if((e.keyCode==38||e.keyCode==40)&&!e.ctrlKey&&!e.shiftKey&&!e.altKey){if(e.preventDefault)e.preventDefault();else e.returnValue=false;e.cancelBubble=true;that._keyOnUpDown(e.keyCode==38?-1:1);}
if(e.keyCode==113){if(!that._isListVisible()){that._showList();if(that.base.firstChild.value==that.conf.last_text){that._setSelected(that.conf.last_selected,true,true);that.base.firstChild.value=that.conf.last_text;that.conf.f_server_last=that.base.firstChild.value.toLowerCase();}else{that.conf.f_server_last=that.base.firstChild.value.toLowerCase();if(that.conf.f_mode==false)that._checkForMatch();}}else{}}
if(e.keyCode==27){if(e.preventDefault)e.preventDefault();else e.returnValue=false;e.cancelBubble=true;that._cancelSelect();}
if(e.keyCode==13){if(e.preventDefault)e.preventDefault();that._confirmSelect("kbd");}
if(that.conf.ro_mode==true&&((e.keyCode>=48&&e.keyCode<=57)||(e.keyCode>=65&&e.keyCode<=90))){that._searchRO(String.fromCharCode(e.keyCode).toLowerCase());e.cancelBubble=true;}
that.conf.clear_key=true;that.callEvent("onKeyPressed",[e.keyCode||e.charCode]);}
this._doOnInputKeyPress=function(e){if(that.conf.clear_key){that.conf.clear_key=false;return;}
e=e||event;that.callEvent("onKeyPressed",[e.keyCode||e.charCode]);}
this._keyOnUpDown=function(dir){var item=null;if(this.conf.last_hover){item=this.t[this.conf.last_hover].item;}else if(this.conf.last_selected){item=this.t[this.conf.last_selected].item;}
if(!item&&this._getListVisibleCount()==0)return;if(item!=null&&item.style.display!="")item=null;this._showList();if(item!=null){if(this.t[item._optId].obj.isSelected(item))item=this._getNearItem(item,dir);}else{item=this.list.firstChild;if(item.style.display!="")item=this._getNearItem(item,1);}
if(item==null)return;this._setSelected(item._optId,true,true);if(this.conf.f_mode==false){this.base.firstChild.value=this.t[item._optId].obj.getText(item,true);}else{var text=String(this.t[item._optId].obj.getText(item,true));if(this.conf.f_mode=="start"&&this.conf.f_ac==true){if(text.toLowerCase().indexOf(this.conf.f_server_last)===0){this.conf.f_ac_text=text.substring(this.conf.f_server_last.length,text.length);this.base.firstChild.value=text;this._selectRange(this.conf.f_server_last.length,this.base.firstChild.value.length);}else{this.base.firstChild.value=text;this.conf.f_server_last=this.base.firstChild.value.toLowerCase();this._selectRange(0,this.base.firstChild.value.length);}}else{this.base.firstChild.value=text;this.conf.f_server_last=this.base.firstChild.value.toLowerCase();}}
item=null;}
this.conf.evs_nodes=[{node:document.body,evs:{mousedown:"_doOnBodyMouseDown"}},{node:this.base,evs:{mousedown:"_doOnBaseMouseDown"}},{node:this.base.firstChild,evs:{keyup:"_doOnInputKeyUp",keydown:"_doOnInputKeyDown",keypress:"_doOnInputKeyPress",focus:"_doOnInputFocus",blur:"_doOnInputBlur"}},{node:this.list,evs:{mousemove:"_doOnListMouseMove",mousedown:"_doOnListMouseDown",mouseup:"_doOnListMouseUp",mouseout:"_doOnListMouseOut"}}];for(var q=0;q<this.conf.evs_nodes.length;q++){for(var a in this.conf.evs_nodes[q].evs){if(typeof(window.addEventListener)=="function"){this.conf.evs_nodes[q].node.addEventListener(a,this[this.conf.evs_nodes[q].evs[a]],false);}else{this.conf.evs_nodes[q].node.attachEvent("on"+a,this[this.conf.evs_nodes[q].evs[a]]);}}}
this.unload=function(){this.clearAll();this.t=null;for(var q=0;q<this.conf.evs_nodes.length;q++){for(var a in this.conf.evs_nodes[q].evs){if(typeof(window.addEventListener)=="function"){this.conf.evs_nodes[q].node.removeEventListener(a,this[this.conf.evs_nodes[q].evs[a]],false);}else{this.conf.evs_nodes[q].node.detachEvent("on"+a,this[this.conf.evs_nodes[q].evs[a]]);}
this.conf.evs_nodes[q].evs[a]=null;delete this.conf.evs_nodes[q].evs[a];}
this.conf.evs_nodes[q].node=null;this.conf.evs_nodes[q].evs=null;delete this.conf.evs_nodes[q].node;delete this.conf.evs_nodes[q].evs;this.conf.evs_nodes[q]=null;}
window.dhx4._eventable(this,"clear");window.dhx4._enableDataLoading(this,null,null,null,"clear");this._mcDetachHeader();this.DOMelem_input=this.DOMelem_button=this.DOMlist=this.DOMelem=this.DOMParent=null;for(var a in this.conf){this.conf[a]=null;delete this.conf[a];}
this.conf=null;if(typeof(window.addEventListener)=="function"){this.list.removeEventListener("scroll",this._doOnListScroll,false);}else{this.list.detachEvent("onscroll",this._doOnListScroll);}
this.base.parentNode.removeChild(this.base);this.list.parentNode.removeChild(this.list);this.base=this.list=this.cont=null;this.modes=null;for(var a in this){if(typeof(this[a])=="function")this[a]=null;}
that=null;};this.DOMelem_input=this.base.firstChild;this.DOMelem_button=this.base.childNodes[this.base.childNodes.length-(this.conf.combo_image?2:1)];this.DOMlist=this.list;this.DOMelem=this.base;this.DOMParent=parentId;parentId=null;if(apiObj!=null){if(apiObj.filter!=null){if(typeof(apiObj.filter)=="string"){this.enableFilteringMode(true,apiObj.filter,window.dhx4.s2b(apiObj.filter_cache),window.dhx4.s2b(apiObj.filter_sub_load));}else{this.enableFilteringMode(true);}}
if(apiObj.image_path!=null)this.setImagePath(apiObj.image_path);if(apiObj.default_image!=null||apiObj.default_image_dis!=null)this.setDefaultImage(apiObj.default_image,apiObj.default_image_dis);if(apiObj.items||apiObj.options)this.addOption(apiObj.items||apiObj.options);if(apiObj.xml||apiObj.json)this.load(apiObj.xml||apiObj.json);if(typeof(apiObj.readonly)!="undefined")this.readonly(apiObj.readonly);apiObj=null;}
return this;};function dhtmlXComboFromSelect(selectId){if(typeof(selectId)=="string")selectId=document.getElementById(selectId);var comboWidth=selectId.offsetWidth;var formName=selectId.getAttribute("name")||null;var comboNode=document.createElement("SPAN");selectId.parentNode.insertBefore(comboNode,selectId);var comboMode=selectId.getAttribute("mode")||selectId.getAttribute("opt_type")||"option";var combo=new dhtmlXCombo(comboNode,formName,comboWidth,comboMode);comboNode=null;var imagePath=selectId.getAttribute("imagePath");if(imagePath)combo.setImagePath(imagePath);var defImg=selectId.getAttribute("defaultImage");var defImgDis=selectId.getAttribute("defaultImageDis");if(window.dhx4.s2b(defImgDis)==true)defImgDis=true;if(defImg!=null||defImgDis!=null)combo.setDefaultImage(defImg,defImgDis);var opts=combo._xmlToObj([selectId],true,selectId.selectedIndex);if(opts.options.length>0)combo.addOption(opts.options);opts=null;selectId.parentNode.removeChild(selectId);selectId=null;return combo;};dhtmlXCombo.prototype.setName=function(name){this.conf.form_name=name;this.base.childNodes[1].name=name;this.base.childNodes[2].name=name.replace(/(\[.*)?$/,"_new_value$1");};dhtmlXCombo.prototype.readonly=function(mode){if(window.dhx4.s2b(mode)){this.base.firstChild.setAttribute("readOnly","true");this.conf.ro_mode=true;}else{this.base.firstChild.removeAttribute("readOnly");this.conf.ro_mode=false;}};dhtmlXCombo.prototype.setPlaceholder=function(text){if(typeof(text)=="undefined"||text==null)text="";this.base.firstChild.setAttribute("placeholder",String(text));};dhtmlXCombo.prototype.setTemplate=function(tpl){for(var a in tpl){if(typeof(this.conf.template[a])!="undefined"){if(a=="header"){this.conf.template[a]=window.dhx4.s2b(tpl[a]);}else{this.conf.template[a]=String(tpl[a]);}}};if(tpl.columns!=null){this._mcMakeTemplate(tpl.columns);}else{this._mcDetachHeader();}
for(var a in this.t){this.t[a].obj.setText(this.t[a].item,this.t[a].item._conf.text);};this._confirmSelect();};dhtmlXCombo.prototype.setSkin=function(skin){if(skin==this.conf.skin)return;this.conf.skin=skin;this.base.className="dhxcombo_"+this.conf.skin+(this.conf.enabled?"":" dhxcombo_disabled");this.list.className="dhxcombolist_"+this.conf.skin+(this.hdr!=null?" dhxcombolist_multicolumn":"");if(this.hdr!=null)this.hdr.className="dhxcombolist_"+this.conf.skin+" dhxcombolist_hdr";this.conf.i_ofs=(skin=="material"?26:23);this._adjustBase();};dhtmlXCombo.prototype.getInput=function(){return this.base.firstChild;};dhtmlXCombo.prototype.getButton=function(){return this.base.childNodes[this.base.childNodes.length-(this.conf.combo_image?2:1)];};dhtmlXCombo.prototype.getList=function(){return this.list;};dhtmlXCombo.prototype.getBase=function(){return this.base;};dhtmlXCombo.prototype.getParent=function(){return this.DOMParent;};dhtmlXCombo.prototype.forEachOption=function(handler){for(var q=0;q<this.list.childNodes.length;q++){handler.apply(window,[this._getOption(this.list.childNodes[q]._optId,q)]);}};dhtmlXCombo.prototype.setFocus=function(){if(this.conf.enabled)this.base.firstChild.focus();};dhtmlXCombo.prototype.setFontSize=function(sizeInp,sizeList){if(sizeInp!=null)this.base.firstChild.style.fontSize=sizeInp;if(sizeList!=null)this.list.style.fontSize=sizeList;};dhtmlXCombo.prototype.getOption=function(value){var id=null;var index=null;for(var q=0;q<this.list.childNodes.length;q++){if(id==null){var a=this.list.childNodes[q]._optId;if(this.t[a].obj.getValue(this.t[a].item)==value){id=a;index=q;}}}
return(id==null?null:this._getOption(id,index));};dhtmlXCombo.prototype.getOptionByIndex=function(index){if(index<0)return null;if(this.list.childNodes[index]==null)return null;return this._getOption(this.list.childNodes[index]._optId,index);};dhtmlXCombo.prototype.getOptionByLabel=function(text){var id=null;var index=null;for(var q=0;q<this.list.childNodes.length;q++){if(id==null){var a=this.list.childNodes[q]._optId;if(this.t[a].obj.getText(this.t[a].item,true)==text){id=a;index=q;}}}
return(id==null?null:this._getOption(id,index));};dhtmlXCombo.prototype.getSelectedIndex=function(){return this._getOptionProp(this.conf.last_selected,"index",-1);};dhtmlXCombo.prototype.getSelectedText=function(){return this._getOptionProp(this.conf.last_selected,"text","");};dhtmlXCombo.prototype.getSelectedValue=function(){return this._getOptionProp(this.conf.temp_selected||this.conf.last_selected,"value",null);};dhtmlXCombo.prototype.getActualValue=function(){return this.base.childNodes[1].value;};dhtmlXCombo.prototype.getComboText=function(){return this.base.childNodes[0].value;};dhtmlXCombo.prototype.getIndexByValue=function(value){var t=this.getOption(value);return(t!=null?t.index:-1);};dhtmlXCombo.prototype.setComboText=function(text){if(this.conf.allow_free_text!=true)return;this.unSelectOption();this.conf.last_text=this.base.firstChild.value=text;this.conf.f_server_last=this.base.firstChild.value.toLowerCase();};dhtmlXCombo.prototype.setComboValue=function(value){var t=this.getOption(value);if(t!=null){this.selectOption(t.index);}else{this.conf.last_value=value;this.base.childNodes[1].value=this.conf.last_value;this.base.childNodes[2].value="true";}};dhtmlXCombo.prototype.selectOption=function(index,filter,conf){if(index<0||index>=this.list.childNodes.length)return;var id=this.list.childNodes[index]._optId;this._setSelected(id,this._isListVisible(),true);this._confirmSelect("script");};dhtmlXCombo.prototype.unSelectOption=function(){if(this.conf.last_hover!=null){this.t[this.conf.last_hover].obj.setSelected(this.t[this.conf.last_hover].item,false);this.conf.last_hover=null;}
this.base.firstChild.value="";if(this.conf.f_mode!=false){this._filterOpts(true);}
this._hideList();this._updateTopImage(null);this._confirmSelect("script");};dhtmlXCombo.prototype.confirmValue=function(){this._confirmSelect("script");};dhtmlXCombo.prototype.enable=function(mode){mode=(typeof(mode)=="undefined"?true:window.dhx4.s2b(mode));if(this.conf.enabled==mode)return;this.conf.enabled=mode;if(mode){this.base.className="dhxcombo_"+this.conf.skin;this.base.firstChild.removeAttribute("disabled");}else{this._hideList();this.base.className="dhxcombo_"+this.conf.skin+" dhxcombo_disabled";this.base.firstChild.setAttribute("disabled","true");}
this._updateTopImage(this.conf.last_selected);};dhtmlXCombo.prototype.disable=function(mode){mode=(typeof(mode)=="undefined"?true:window.dhx4.s2b(mode));this.enable(!mode);};dhtmlXCombo.prototype.isEnabled=function(){return(this.conf.enabled==true);};dhtmlXCombo.prototype.show=function(mode){if(typeof(mode)=="undefined")mode=true;else mode=window.dhx4.s2b(mode);this.base.style.display=(mode==true?"":"none");};dhtmlXCombo.prototype.hide=function(mode){if(typeof(mode)=="undefined")mode=true;this.show(!mode);};dhtmlXCombo.prototype.isVisible=function(){return(this.base.style.display=="");};dhtmlXCombo.prototype.setFilterHandler=function(f){if(typeof(f)=="function"){this.conf.f_func=f;this.conf.f_mode=true;this.conf.f_dyn=this.conf.f_cache=this.conf.f_url=null;}else if(typeof(f)=="string"&&typeof(window[f])=="function"){this.conf.f_func=window[f];this.conf.f_mode=true;this.conf.f_dyn=this.conf.f_cache=this.conf.f_url=null;}else{this.conf.f_func=null;}};dhtmlXCombo.prototype.enableFilteringMode=function(mode,url,cache,dyn){if(mode==true||mode=="between"){this.conf.f_mode=(mode==true?"start":"between");if(url!=null){this.conf.f_url=url;this.conf.f_cache=window.dhx4.s2b(cache);this.conf.f_dyn=window.dhx4.s2b(dyn);}else{this.conf.f_url=null;this.conf.f_cache=false;this.conf.f_dyn=false;}}else{this.conf.f_mode=false;this.conf.f_url=null;this.conf.f_cache=false;this.conf.f_dyn=false;}};dhtmlXCombo.prototype.filter=function(handler,showList){for(var q=0;q<this.list.childNodes.length;q++){var k=handler.apply(window,[this._getOption(this.list.childNodes[q]._optId,q)]);this.list.childNodes[q].style.display=(k===true?"":"none");}
if(typeof(showList)=="undefined"||showList==true){this._showList(true);}};dhtmlXCombo.prototype.sort=function(mode){var r=[];for(var q=0;q<this.list.childNodes.length;q++){var id=this.list.childNodes[q]._optId;r.push([id,this._getOption(id,q)]);}
if(mode=="asc"||mode=="desc"){k=true;r.sort(function(a,b){a=a[1].text_option.toLowerCase();b=b[1].text_option.toLowerCase();var r=(mode=="asc"?1:-1);return(a>b?r:-1*r);});}else if(typeof(mode)=="function"||typeof(window[mode])=="function"){if(typeof(window[mode])=="function")mode=window[mode];r.sort(function(a,b){return mode.apply(window,[a[1],b[1]]);});}
while(this.list.childNodes.length>0)this.list.removeChild(this.list.lastChild);for(var q=0;q<r.length;q++)this.list.appendChild(this.t[r[q][0]].item);};dhtmlXCombo.prototype.enableAutocomplete=function(mode){if(typeof(mode)=="undefined")mode=true;else mode=window.dhx4.s2b(mode);this.conf.f_ac=mode;};dhtmlXCombo.prototype.disableAutocomplete=function(mode){if(typeof(mode)=="undefined")mode=true;else mode=window.dhx4.s2b(mode);this.enableAutocomplete(!mode);};dhtmlXCombo.prototype.allowFreeText=function(mode,resetToEmpty){this.conf.allow_free_text=(typeof(mode)=="undefined"?true:window.dhx4.s2b(mode));this.conf.free_text_empty=(typeof(resetToEmpty)=="undefined"?false:window.dhx4.s2b(resetToEmpty));};dhtmlXCombo.prototype._checkForMatch=function(forceClear){var k=window.dhx4.trim(this.base.firstChild.value).toLowerCase();var id=null;var item=this.list.firstChild;while(item!=null){if(item.style.display==""&&item._optId!=null){var text=window.dhx4.trim(this.t[item._optId].obj.getText(item,true)).toLowerCase();if(k==text){id=item._optId;item=null;}}
if(item!=null)item=item.nextSibling;}
if(this.conf.last_match==null){if(id!=null){this._setSelected(id,true,true);this.conf.last_match=id;}else{if(this.conf.f_mode!="between"||forceClear==true){this._setSelected(null,true,true);this.conf.last_match=null;}}}else{if(id!=null){if(id!=this.conf.last_match){this._setSelected(id,true,true);this.conf.last_match=id;}}else{this._setSelected(null,true,true);this.conf.last_match=null;}}};dhtmlXCombo.prototype._selectRange=function(from,to){if(this.conf.combo_focus==true)window.dhx4.selectTextRange(this.base.firstChild,from,to);};dhtmlXCombo.prototype.openSelect=function(){if(!this._isListVisible())this._showList();};dhtmlXCombo.prototype.closeAll=function(){this._hideList();};dhtmlXCombo.prototype._showList=function(autoHide){if(this._getListVisibleCount()==0){if(autoHide&&this._isListVisible())this._hideList();return;}
if(this._isListVisible()){this._checkListHeight();return;}
this.list.style.zIndex=window.dhx4.zim.reserve(this.conf.list_zi_id);if(this.hdr!=null&&this.conf.template.header==true)this.hdr.style.zIndex=Number(this.list.style.zIndex)+1;this.list.style.visibility="hidden";this.list.style.display="";if(this.hdr!=null&&this.conf.template.header==true){this.hdr.style.visibility=this.list.style.visibility;this.hdr.style.display=this.list.style.display;}
var h0=(this.hdr!=null&&this.conf.template.header==true?this.hdr.offsetHeight:0);this.list.style.width=Math.max(this.conf.opts_width||this.conf.col_w||0,this.conf.combo_width)+"px";this.list.style.top=window.dhx4.absTop(this.base)+h0+this.base.offsetHeight-1+"px";this.list.style.left=window.dhx4.absLeft(this.base)+"px";if(this.hdr!=null&&this.conf.template.header==true){this.hdr.style.width=this.list.style.width;this.hdr.style.left=this.list.style.left;this.hdr.style.top=parseInt(this.list.style.top)-h0+"px";}
this._checkListHeight();this.list.style.visibility="visible";if(this.hdr!=null&&this.conf.template.header==true)this.hdr.style.visibility="visible";this.callEvent("onOpen",[]);};dhtmlXCombo.prototype._hideList=function(){if(!this._isListVisible())return;window.dhx4.zim.clear(this.conf.list_zi_id);this.list.style.display="none";if(this.hdr!=null&&this.conf.template.header==true)this.hdr.style.display="none";this.conf.clear_click=false;this.callEvent("onClose",[]);};dhtmlXCombo.prototype._isListVisible=function(){return(this.list.style.display=="");};dhtmlXCombo.prototype._getListVisibleCount=function(){var k=0;for(var q=0;q<this.list.childNodes.length;q++)k+=(this.list.childNodes[q].style.display==""?1:0);return k;};dhtmlXCombo.prototype._checkListHeight=function(){if(!this._isListVisible())return;if(this.conf.item_h==null){var item=this.list.firstChild;while(item!=null){if(item.style.display==""){this.conf.item_h=item.offsetHeight+(this.hdr!=null?-1:0);item=null;}else{item=item.nextSibling;}}
item=null;}
var s=window.dhx4.screenDim();var by=window.dhx4.absTop(this.base);var bh=this.base.offsetHeight;var hh=(this.hdr!=null&&this.conf.template.header==true?this.hdr.offsetHeight:0);var onTop=Math.max(0,Math.floor((by+hh-s.top)/this.conf.item_h));var onBottom=Math.max(0,Math.floor((s.bottom-(by+bh+hh))/this.conf.item_h));var itemsCount=this._getListVisibleCount();if(onBottom<Math.min(this.conf.opts_count_min,itemsCount)&&onTop>onBottom)onBottom=null;var itemsToShow=Math.min((onBottom==null?onTop:onBottom),this.conf.opts_count,itemsCount);var h=(itemsToShow<itemsCount?(itemsToShow*this.conf.item_h)+"px":"");var ofs=this.conf.sp[this.conf.skin][this.hdr!=null&&this.conf.template.header==true?"hdr_ofs":"list_ofs"];this.list.style.height=h;this.list.style.top=(onBottom==null?by-this.list.offsetHeight+ofs:by+bh+hh-ofs)+"px";if(this.hdr!=null&&this.conf.template.header==true)this.hdr.style.top=(onBottom==null?by-hh-this.list.offsetHeight+ofs:by+bh-ofs)+"px";};dhtmlXCombo.prototype._scrollToItem=function(id){var y1=this.t[id].item.offsetTop;var y2=y1+this.t[id].item.offsetHeight;var a1=this.list.scrollTop;var a2=a1+this.list.clientHeight;if(y1<a1){this.list.scrollTop=y1+(this.hdr!=null&&this.conf.template.header==true?1:0);}else if(y2>a2){this.list.scrollTop=y2-this.list.clientHeight+(this.hdr!=null&&this.conf.template.header==true?-this.conf.sp[this.conf.skin].scr_ofs:0);}};dhtmlXCombo.prototype._setSelected=function(id,scrollToItem,updateImg,mouseMove){this.conf.temp_selected=null;if(updateImg)this._updateTopImage(id);if(id!=null&&this.conf.last_hover==id){if(scrollToItem)this._scrollToItem(id);return;}
if(this.conf.last_hover!=null){this.t[this.conf.last_hover].obj.setSelected(this.t[this.conf.last_hover].item,false);this.conf.last_hover=null;if(id==null)this.callEvent("onSelectionChange",[]);}
if(id!=null){this.t[id].obj.setSelected(this.t[id].item,true);this.conf.last_hover=id;if(mouseMove!=true){this.conf.temp_selected=id;this.callEvent("onSelectionChange",[]);}
if(this.conf.s_mode=="select"&&this.t[id].item==this.t[id].item.parentNode.lastChild)this._subloadRequest();if(scrollToItem)this._scrollToItem(id);}};dhtmlXCombo.prototype._subloadRequest=function(){if(this.conf.f_url!=null&&this.conf.f_dyn==true&&this.conf.f_dyn_end==false){var params="mask="+encodeURIComponent(this.conf.f_mask)+"&pos="+this.list.childNodes.length;var t=this;var callBack=function(r){if(t.conf.f_cache)t.conf.f_cache_data[t.conf.f_mask].data.push(r.xmlDoc.responseXML);var k=t.list.childNodes.length;t.conf.f_loading=true;t.load(r.xmlDoc.responseXML);t.conf.f_loading=false;if(k==t.list.childNodes.length){t.conf.f_dyn_end=true;if(t.conf.f_cache)t.conf.f_cache_data[t.conf.f_mask].dyn_end=true;}
callBack=t=null;}
if(window.dhx4.ajax.method=="post"){window.dhx4.ajax.post(this.conf.f_url,params,callBack);}else if(window.dhx4.ajax.method=="get"){window.dhx4.ajax.get(this.conf.f_url+(String(this.conf.f_url).indexOf("?")>=0?"&":"?")+params,callBack);}}};dhtmlXCombo.prototype.addOption=function(value,text,css,img,selected){var toSelect=null;if(!(value instanceof Array)){var id=this._renderOption({value:value,text:text,css:css,img:img});if(toSelect==null&&window.dhx4.s2b(selected)==true)toSelect=id;}else{for(var q=0;q<value.length;q++){if(typeof(value[q])=="undefined")continue;if(value[q]instanceof Array){id=this._renderOption({value:value[q][0],text:value[q][1],css:value[q][2],img:value[q][3]});if(toSelect==null&&window.dhx4.s2b(value[q][4])==true)toSelect=id;}else{var id=this._renderOption(value[q]);if(toSelect==null&&window.dhx4.s2b(value[q].selected)==true)toSelect=id;}}}
if(toSelect!=null){this._setSelected(toSelect,this._isListVisible(),true);this._confirmSelect("onInit");}};dhtmlXCombo.prototype.updateOption=function(oldValue,newValue,newText,newCss){var id=this._getOptionId(oldValue);if(id==null)return;this.t[id].obj.update(this.t[id].item,{value:newValue,text:newText,css:newCss});if(this.conf.last_selected==id){this.conf.last_text=this.base.firstChild.value=this.t[id].obj.getText(this.t[id].item,true);this.conf.f_server_last=this.base.firstChild.value.toLowerCase();}};dhtmlXCombo.prototype.deleteOption=function(value){for(var a in this.t){var v=this.t[a].obj.getValue(this.t[a].item);if(v==value)this._removeOption(a);}
if(this._isListVisible())this._showList(true);};dhtmlXCombo.prototype.clearAll=function(hideList){hideList=(typeof(hideList)=="undefined"?true:window.dhx4.s2b(hideList));for(var a in this.t)this._removeOption(a);if(this.conf.tm_hover)window.clearTimeout(this.conf.tm_hover);this.conf.last_hover=null;this.conf.last_selected=null;this.list.scrollTop=0;if(hideList==true)this._hideList();};dhtmlXCombo.prototype._renderOption=function(data){var id=window.dhx4.newId();var item=document.createElement("DIV");item._optId=id;item._tpl=this.conf.template;if(typeof(data.img)=="undefined"&&typeof(data.img_src)!="undefined"){data.img=data.img_src;delete data.img_src;}
if(typeof(data.img_dis)=="undefined"&&typeof(data.img_src_dis)!="undefined"){data.img_dis=data.img_src_dis;delete data.img_src_dis;}
data.img_path=this.conf.img_path;data.img_def=this.conf.img_def;data.img_def_dis=this.conf.img_def_dis;this.list.appendChild(item);var v=(this._isListVisible()&&window.dhx4.isFF==true);if(v==true){var k=this.list.scrollTop;this.list.scrollTop-=1;}
if(this.hdr!=null)data.multicol=true;this.t[item._optId]={obj:this.modes[this.conf.opts_type].render(item,data),item:item,conf:{type:this.conf.opts_type}};item=null;if(v==true)this.list.scrollTop+=1;return id;};dhtmlXCombo.prototype._removeOption=function(id){this.t[id].obj.destruct(this.t[id].item);this.t[id].obj=null;this.t[id].item.parentNode.removeChild(this.t[id].item);this.t[id].item=null;this.t[id].conf=null;this.t[id]=null;delete this.t[id];if(this.conf.last_hover==id)this.conf.last_hover=null;if(this.conf.last_selected==id){this.conf.last_selected=null;this._confirmSelect("onDelete");}};dhtmlXCombo.prototype._confirmSelect=function(mode,hideList){var wasChanged=false;if(typeof(hideList)=="undefined")hideList=true;if(this.conf.f_server_tm)window.clearTimeout(this.conf.f_server_tm);if(this.conf.last_hover!=null){wasChanged=wasChanged||(this.conf.last_value!=this._getOptionValue(this.conf.last_hover));this.conf.last_match=this.conf.last_selected=this.conf.last_hover;this.conf.last_value=this._getOptionValue(this.conf.last_selected);this.conf.last_text=this.base.firstChild.value=this.t[this.conf.last_selected].obj.getText(this.t[this.conf.last_selected].item,true);this.conf.f_server_last=this.base.firstChild.value.toLowerCase();this.base.childNodes[1].value=this.conf.last_value;this.base.childNodes[2].value="false";}else{if(this.conf.allow_free_text||(this.base.firstChild.value==""&&this.conf.allow_empty_value)){wasChanged=wasChanged||(this.conf.last_text!=this.base.firstChild.value);this.conf.last_match=this.conf.last_value=this.conf.last_selected=null;this.conf.last_text=this.base.firstChild.value;this.conf.f_server_last=this.base.firstChild.value.toLowerCase();this.base.childNodes[1].value=this.conf.last_text;this.base.childNodes[2].value="true";}else{this._cancelSelect(true);this._updateTopImage(this.conf.last_selected);return;}}
if(this.conf.f_ac&&this.conf.f_mode=="start"){this.conf.f_ac_text="";if(mode!="blur"){this._selectRange(this.base.firstChild.value.length,this.base.firstChild.value.length);}}
if(hideList)this._hideList();if(wasChanged==true&&mode!="onInit"&&mode!="onDelete"){this.callEvent("onSelectionChange",[]);this.callEvent("onChange",[this.conf.last_value,this.conf.last_text]);}};dhtmlXCombo.prototype._cancelSelect=function(freeTextReset){this._hideList();if(freeTextReset==true&&this.conf.allow_free_text==false&&this.conf.free_text_empty==true){this.conf.f_server_last=this.conf.last_match=this.conf.last_value=this.conf.last_selected=null;this.base.childNodes[1].value=this.conf.last_text=this.base.firstChild.value="";this.base.childNodes[2].value="false";}else{this.base.firstChild.value=this.conf.last_text;}
if(this.conf.f_mode!=false){this._filterOpts(true);}};dhtmlXCombo.prototype._getOption=function(id,index){if(!this.t[id])return null;if(typeof(index)=="undefined")index=-1;if(index<0){for(var q=0;q<this.list.childNodes.length;q++){if(index<0&&this.list.childNodes[q]._optId==id)index=q;}}
var t={value:this.t[id].obj.getValue(this.t[id].item),text:this.t[id].obj.getText(this.t[id].item),text_input:this.t[id].obj.getText(this.t[id].item,true),text_option:this.t[id].obj.getText(this.t[id].item,null,true),css:this.t[id].obj.getCss(this.t[id].item),selected:(id==this.conf.last_selected),index:index};if(typeof(this.t[id].obj.getExtraData)=="function"){var k=this.t[id].obj.getExtraData(this.t[id].item);for(var a in k){if(typeof(t[a])=="undefined")t[a]=k[a];}}
return t;};dhtmlXCombo.prototype._getOptionProp=function(id,prop,def){if(id!=null){var t=this._getOption(id);if(t!=null)return t[prop];}
return def;};dhtmlXCombo.prototype._getOptionId=function(value){var id=null;for(var q=0;q<this.list.childNodes.length;q++){if(id==null){var p=this.list.childNodes[q]._optId;if(value==this.t[p].obj.getValue(this.t[p].item))id=p;}}
return id;};dhtmlXCombo.prototype._getOptionValue=function(id){return this._getOptionProp(id,"value",null);};dhtmlXCombo.prototype.setSize=function(width){this.conf.combo_width=parseInt(width)-(dhx4.isFF||dhx4.isIE||dhx4.isChrome||dhx4.isOpera?2:0);this.base.style.width=Math.max(0,this.conf.combo_width)+"px";this._adjustBase();};dhtmlXCombo.prototype._adjustBase=function(){this.base.firstChild.style.width=Math.max(0,(this.conf.combo_width-(this.conf.i_ofs+1)-(this.conf.combo_image?this.conf.i_ofs:0)))+"px";this.base.firstChild.style.marginLeft=(this.conf.combo_image?this.conf.i_ofs+"px":"0px");};dhtmlXCombo.prototype.setOptionWidth=function(w){this.conf.opts_width=(parseInt(w)||null);};dhtmlXCombo.prototype.setOptionIndex=function(value,index){if(isNaN(index)||index<0)return;var p=this.getOption(value);if(p==null)return;if(index==p.index)return;var t=this.list.childNodes[p.index];t.parentNode.removeChild(t);if(this.list.childNodes[index]!=null){this.list.insertBefore(t,this.list.childNodes[index]);}else{this.list.appendChild(t);}
t=null;};dhtmlXCombo.prototype.getOptionsCount=function(){return this.list.childNodes.length;};dhtmlXCombo.prototype._mcMakeTemplate=function(cols){var h="";var t="";this.conf.col_w=0;for(var q=0;q<cols.length;q++){var w=Number(parseInt(cols[q].width)||50);var css=(cols[q].css||"");var cssIE=(q==0&&window.dhx4.isIE6==true?"_first":"");t+="<div class='dhxcombo_cell"+cssIE+" "+css+"' style='width:"+w+"px;'><div class='dhxcombo_cell_text'>"+(cols[q].option||"&nbsp;")+"</div></div>";h+="<div class='dhxcombo_hdrcell"+cssIE+" "+css+"' style='width:"+w+"px;'><div class='dhxcombo_hdrcell_text'>"+(cols[q].header||"&nbsp;")+"</div></div>";this.conf.col_w+=w+1;}
var w=500;var k=document.createElement("DIV");k.style.position="absolute";k.style.top="10px";k.style.left=-w*2+"px";k.style.width=w+"px";k.style.height="50px";k.style.overflowY="scroll";k.innerHTML="<div>&nbsp;</div>";document.body.appendChild(k);this.conf.col_w+=w-k.firstChild.offsetWidth+10;k.parentNode.removeChild(k);k=null;this.conf.template.option=t;this._mcAttachHeader(h);this.list.className+=" dhxcombolist_multicolumn";};dhtmlXCombo.prototype._mcAttachHeader=function(text){if(this.hdr==null){this.hdr=document.createElement("DIV");this.hdr.className="dhxcombolist_"+this.conf.skin+" dhxcombolist_hdr";this.hdr.style.display="none";this.list.parentNode.insertBefore(this.hdr,this.list);if(typeof(window.addEventListener)=="function"){this.hdr.addEventListener("mousedown",this._doOnListMouseDown,false);}else{this.hdr.attachEvent("onmousedown",this._doOnListMouseDown);}
if(this.conf.opts_type=="checkbox"&&this.conf.combo_image==true){this.conf.combo_image=false;if(this.base.lastChild.className.match(/dhxcombo_top_image/)!=null)this.base.removeChild(this.base.lastChild);this._adjustBase();}}
this.hdr.innerHTML="<div class='dhxcombo_hdrtext'>"+text+"</div>";};dhtmlXCombo.prototype._mcDetachHeader=function(){if(this.hdr!=null){if(typeof(window.addEventListener)=="function"){this.hdr.removeEventListener("mousedown",this._doOnListMouseDown,false);}else{this.hdr.detachEvent("onmousedown",this._doOnListMouseDown);}
this.hdr.parentNode.removeChild(this.hdr);this.hdr=null;}
this.conf.col_w=null;this.conf.item_h=null;};dhtmlXCombo.prototype.modes={};dhtmlXCombo.prototype.doWithItem=function(index,method,param1,param2){var id=(index>=0&&index<this.list.childNodes.length?this.list.childNodes[index]._optId:null);if(id==null)return null;if(typeof(this.t[id].obj[method])!="function")return null;var params=[this.t[id].item];for(var q=2;q<arguments.length;q++)params.push(arguments[q]);return this.t[id].obj[method].apply(this.t[id].obj,params);};function dhtmlXComboExtend(to,from){for(var a in dhtmlXCombo.prototype.modes[from]){if(typeof(dhtmlXCombo.prototype.modes[to][a])=="undefined"){dhtmlXCombo.prototype.modes[to][a]=dhtmlXCombo.prototype.modes[from][a];}};};dhtmlXCombo.prototype.modes.option={image:false,html:false,option_css:"dhxcombo_option_text",render:function(item,data){item._conf={value:data.value,css:""};item.className="dhxcombo_option";item.innerHTML="<div class='"+this.option_css+"'>&nbsp;</div>";if(data.css!=null){item.lastChild.style.cssText=data.css;item._conf.css=data.css;}
this.setText(item,data.text);return this;},destruct:function(item){item._conf=null;},update:function(item,data){item._conf.value=data.value;item._conf.css=data.css;item.lastChild.style.cssText=data.css;this.setText(item,data.text);},setText:function(item,text,skip){item._conf.text=text;var t=(typeof(text)=="object"?window.dhx4.template(item._tpl.option,this.replaceHtml(item._conf.text,skip),true):window.dhx4.trim(this.replaceHtml(item._conf.text,skip)||""));item.lastChild.innerHTML=(t.length==0?"&nbsp;":t);},getText:function(item,asStringInput,asStringOption){if(window.dhx4.s2b(asStringInput)&&typeof(item._conf.text)=="object")return window.dhx4.template(item._tpl.input,item._conf.text,true);if(window.dhx4.s2b(asStringOption)&&typeof(item._conf.text)=="object")return window.dhx4.template(item._tpl.option,item._conf.text,true);return item._conf.text;},getValue:function(item){return item._conf.value;},getCss:function(item){return item._conf.css;},setSelected:function(item,state){item.className="dhxcombo_option"+(state?" dhxcombo_option_selected":"");},isSelected:function(item){return String(item.className).indexOf("dhxcombo_option_selected")>=0;},getExtraData:function(item){return{type:"option"};},replaceHtml:function(text,skip){if(this.html==true)return text;if(typeof(skip)=="undefined"||skip==null)skip={};if(typeof(text)=="object"){var t={};for(var a in text){t[a]=(skip[a]==true?text[a]:this.replaceHtml(text[a]));}}else{var t=(text||"").replace(/[\<\>\&\s]/g,function(t){switch(t){case"<":return"&lt;";case">":return"&gt;";case"&":return"&amp;";case" ":return"&nbsp;";}
return t;});}
return t;}};dhtmlXCombo.prototype.modes.checkbox={image:true,html:false,image_css:"dhxcombo_checkbox dhxcombo_chbx_#state#",option_css:"dhxcombo_option_text dhxcombo_option_text_chbx",render:function(item,data){if(this.image_css_regexp==null)this.image_css_regexp=new RegExp(this.image_css.replace("#state#","\\d*"));item._conf={value:data.value,css:"",checked:window.dhx4.s2b(data.checked)};item.className="dhxcombo_option";var skip={};if(data.multicol==true){data.text.checkbox="<div class='"+String(this.image_css).replace("#state#",(item._conf.checked?"1":"0"))+"'></div>&nbsp;";skip.checkbox=true;item.innerHTML="<div class='"+dhtmlXCombo.prototype.modes.option.option_css+"'></div>";}else{item.innerHTML="<div class='"+String(this.image_css).replace("#state#",(item._conf.checked?"1":"0"))+"'></div>"+"<div class='"+this.option_css+"'>&nbsp;</div>";}
if(data.css!=null){item.lastChild.style.cssText+=data.css;item._conf.css=data.css;}
this.setText(item,data.text,skip);return this;},setChecked:function(item,state){item._conf.checked=window.dhx4.s2b(state);var css=String(this.image_css).replace("#state#",(item._conf.checked?"1":"0"));this._changeChbxCss(item.childNodes,css);},_changeChbxCss:function(nodes,css){for(var q=0;q<nodes.length;q++){if(nodes[q].tagName!=null&&nodes[q].className!=null&&nodes[q].className.match(this.image_css_regexp)!=null){nodes[q].className=css;}else if(nodes[q].childNodes.length>0){this._changeChbxCss(nodes[q].childNodes,css);}}},isChecked:function(item){return(item._conf.checked==true);},getExtraData:function(item){return{type:"checkbox",checked:item._conf.checked};},optionClick:function(item,ev,combo){var r=true;var t=(ev.target||ev.srcElement);while(r==true&&t!=null&&t!=item&&t.className!=null){if(t.className.match(this.image_css_regexp)!=null){var args=[item._conf.value,!item._conf.checked];if(combo.callEvent("onBeforeCheck",args)===true){this.setChecked(item,!this.isChecked(item));combo.callEvent("onCheck",args);};r=false;args=null;}else{t=t.parentNode;}}
t=combo=item=null;return r;},getTopImage:function(item,enabled){return"";},topImageClick:function(item,combo){return true;}};dhtmlXComboExtend("checkbox","option");dhtmlXCombo.prototype.setChecked=function(index,mode){this.doWithItem(index,"setChecked",mode);};dhtmlXCombo.prototype.getChecked=function(index){var t=[];for(var q=0;q<this.list.childNodes.length;q++){if(this.isChecked(q))t.push(this._getOptionProp(this.list.childNodes[q]._optId,"value",""));}
return t;};dhtmlXCombo.prototype.isChecked=function(index){return this.doWithItem(index,"isChecked");};dhtmlXCombo.prototype.modes.image={image:true,html:false,image_css:"dhxcombo_image",option_css:"dhxcombo_option_text dhxcombo_option_text_image",render:function(item,data){item._conf={value:data.value,css:""};item.className="dhxcombo_option";item.innerHTML="<div class='"+this.image_css+"'></div>"+"<div class='"+this.option_css+"'>&nbsp;</div>";if(data.css!=null){item.lastChild.style.cssText+=data.css;item._conf.css=data.css;}
this.setText(item,data.text);this.setImage(item,data.img,data.img_dis,data.img_path,data.img_def,data.img_def_dis);return this;},update:function(item,data){item._conf.value=data.value;item._conf.css=data.css;item.lastChild.style.cssText=data.css;this.setText(item,data.text);this.setImage(item,data.img,data.img_dis,data.img_path,data.img_def,data.img_def_dis);},setImage:function(item,img,img_dis,path,def,def_dis){if(img!=null&&img.length>0){img=path+img;}else if(def!=null&&def.length>0){img=path+def;}else{img=null;}
if(img_dis!=null&&img_dis.length>0){img_dis=path+img_dis;}else if(def_dis!=null&&def_dis.length>0){img_dis=path+def_dis;}else if(def_dis==true){img_dis=img;}else{img_dis=null;}
item._conf.img=img;item._conf.img_dis=img_dis;item.firstChild.style.backgroundImage=(img!=null?"url("+img+")":"none");},getExtraData:function(item){return{type:"image"};},getTopImage:function(item,enabled){var a=(enabled?"img":"img_dis");if(item!=null&&item._conf[a]!=null)return"<div class='"+this.image_css+"' style='background-image:url("+item._conf[a]+");'></div>";return"";}};dhtmlXComboExtend("image","option");dhtmlXCombo.prototype.setDefaultImage=function(img,imgDis){if(img!=null)this.conf.img_def=img;if(imgDis!=null)this.conf.img_def_dis=imgDis;};dhtmlXCombo.prototype.setImagePath=function(path){this.conf.img_path=path;};function dhtmlXMenuObject(base,skin){var that=this;this.conf={skin:(skin||window.dhx4.skin||(typeof(dhtmlx)!="undefined"?dhtmlx.skin:null)||window.dhx4.skinDetect("dhxmenu")||"material"),mode:"web",align:"left",is_touched:false,selected:-1,last_click:-1,fixed_pos:false,rtl:false,icons_path:"",icons_css:false,arrow_ff_fix:(navigator.userAgent.indexOf("MSIE")>=0&&document.compatMode=="BackCompat"),live_id:window.dhx4.newId(),tags:{root:"menu",item:"item",text_ext:"itemtext",userdata:"userdata",tooltip:"tooltip",hotkey:"hotkey",href:"href"},autoload:{},hide_tm:{},top_mode:true,top_tmtime:200,v_enabled:false,v:{x1:null,x2:null,y1:null,y2:null},dir_toplv:"bottom",dir_sublv:"right",auto_overflow:false,overflow_limit:0,of_utm:null,of_utime:20,of_ustep:3,of_dtm:null,of_dtime:20,of_dstep:3,of_ah:{dhx_skyblue:24,dhx_web:25,dhx_terrace:27,material:25},of_ih:{dhx_skyblue:24,dhx_web:24,dhx_terrace:24,material:30},tm_sec:400,tm_handler:null,dload:false,dload_url:"",dload_icon:false,dload_params:{action:"loadMenu"},dload_pid:"parentId",tl_botmarg:1,tl_rmarg:0,tl_ofsleft:1,context:false,ctx_zoneid:false,ctx_autoshow:true,ctx_autohide:true,ctx_hideall:true,ctx_zones:{},ctx_baseid:null,selected_sub:[],opened_poly:[]}
if(typeof(base)=="object"&&base!=null&&typeof(base.tagName)=="undefined"){if(base.icons_path!=null||base.icon_path!=null)this.conf.icons_path=(base.icons_path||base.icon_path);if(base.skin!=null)this.conf.skin=base.skin;if(base.visible_area){this.conf.v_enabled=true;this.conf.v={x1:base.visible_area.x1,x2:base.visible_area.x2,y1:base.visible_area.y1,y2:base.visible_area.y2};}
for(var a in{json:1,xml:1,items:1,top_text:1,align:1,open_mode:1,overflow:1,dynamic:1,dynamic_icon:1,context:1,onload:1,onclick:1,oncheckboxclick:1,onradioclick:1,iconset:1}){if(base[a]!=null)this.conf.autoload[a]=base[a];}
base=base.parent;}
if(base==null){this.base=document.body;}else{var baseObj=(typeof(base)=="string"?document.getElementById(base):base);if(baseObj!=null){this.base=baseObj;if(!this.base.id)this.base.id="menuBaseId_"+new Date().getTime();this.base.className+=" dhtmlxMenu_"+this.conf.skin+"_Middle dir_left";this.base._autoSkinUpdate=true;if(this.base.oncontextmenu)this.base._oldContextMenuHandler=this.base.oncontextmenu;this.conf.ctx_baseid=this.base.id;this.base.onselectstart=function(e){e=e||event;if(e.preventDefault)e.preventDefault();else e.returnValue=false;return false;}
this.base.oncontextmenu=function(e){e=e||event;if(e.preventDefault)e.preventDefault();else e.returnValue=false;return false;}}else{this.base=document.body;}}
this.idPrefix="";this.topId="dhxWebMenuTopId";this.idPull={};this.itemPull={};this.userData={};this.radio={};this.setSkin=function(skin){var oldSkin=this.conf.skin;this.conf.skin=skin;switch(this.conf.skin){case"dhx_skyblue":case"dhx_web":this.conf.tl_botmarg=2;this.conf.tl_rmarg=1;this.conf.tl_ofsleft=1;break;case"dhx_terrace":case"material":this.conf.tl_botmarg=0;this.conf.tl_rmarg=0;this.conf.tl_ofsleft=0;break;}
if(this.base._autoSkinUpdate){this.base.className=this.base.className.replace("dhtmlxMenu_"+oldSkin+"_Middle","")+" dhtmlxMenu_"+this.conf.skin+"_Middle";}
for(var a in this.idPull){this.idPull[a].className=String(this.idPull[a].className).replace(oldSkin,this.conf.skin);}}
this.setSkin(this.conf.skin);this._addSubItemToSelected=function(item,polygon){var t=true;for(var q=0;q<this.conf.selected_sub.length;q++){if((this.conf.selected_sub[q][0]==item)&&(this.conf.selected_sub[q][1]==polygon)){t=false;}}
if(t==true){this.conf.selected_sub.push(new Array(item,polygon));}
return t;}
this._removeSubItemFromSelected=function(item,polygon){var m=new Array();var t=false;for(var q=0;q<this.conf.selected_sub.length;q++){if((this.conf.selected_sub[q][0]==item)&&(this.conf.selected_sub[q][1]==polygon)){t=true;}else{m[m.length]=this.conf.selected_sub[q];}}
if(t==true){this.conf.selected_sub=m;}
return t;}
this._getSubItemToDeselectByPolygon=function(polygon){var m=new Array();for(var q=0;q<this.conf.selected_sub.length;q++){if(this.conf.selected_sub[q][1]==polygon){m[m.length]=this.conf.selected_sub[q][0];m=m.concat(this._getSubItemToDeselectByPolygon(this.conf.selected_sub[q][0]));var t=true;for(var w=0;w<this.conf.opened_poly.length;w++){if(this.conf.opened_poly[w]==this.conf.selected_sub[q][0]){t=false;}}
if(t==true){this.conf.opened_poly[this.conf.opened_poly.length]=this.conf.selected_sub[q][0];}
this.conf.selected_sub[q][0]=-1;this.conf.selected_sub[q][1]=-1;}}
return m;}
this._hidePolygon=function(id){if(this.idPull["polygon_"+id]!=null){if(this.idPull["polygon_"+id]._zId!=null){window.dhx4.zim.clear(this.idPull["polygon_"+id]._zId);}
if(typeof(this._menuEffect)!="undefined"&&this._menuEffect!==false){this._hidePolygonEffect("polygon_"+id);}else{if(this.idPull["polygon_"+id].style.display=="none")return;this.idPull["polygon_"+id].style.display="none";if(this.idPull["arrowup_"+id]!=null)this.idPull["arrowup_"+id].style.display="none";if(this.idPull["arrowdown_"+id]!=null)this.idPull["arrowdown_"+id].style.display="none";this._updateItemComplexState(id,true,false);if(window.dhx4.isIE6&&this.idPull["polygon_"+id+"_ie6cover"]!=null)this.idPull["polygon_"+id+"_ie6cover"].style.display="none";}
id=String(id).replace(this.idPrefix,"");if(id==this.topId)id=null;this.callEvent("onHide",[id]);if(id!=null&&this.conf.skin=="dhx_terrace"&&this.itemPull[this.idPrefix+id].parent==this.idPrefix+this.topId){this._improveTerraceButton(this.idPrefix+id,true);}}}
this._showPolygon=function(id,openType){var itemCount=this._countVisiblePolygonItems(id);if(itemCount==0)return;var pId="polygon_"+id;if((this.idPull[pId]!=null)&&(this.idPull[id]!=null)){if(this.conf.top_mode&&this.conf.mode=="web"&&!this.conf.context){if(!this.idPull[id]._mouseOver&&openType==this.conf.dir_toplv)return;}
if(!this.conf.fixed_pos)this._autoDetectVisibleArea();var arrUpH=0;var arrDownH=0;var arrowUp=null;var arrowDown=null;if(this.idPull[pId]._zId==null){this.idPull[pId]._zId=window.dhx4.newId();}
this.idPull[pId]._zInd=window.dhx4.zim.reserve(this.idPull[pId]._zId);this.idPull[pId].style.visibility="hidden";this.idPull[pId].style.left="0px";this.idPull[pId].style.top="0px";this.idPull[pId].style.display="";this.idPull[pId].style.zIndex=this.idPull[pId]._zInd;if(this.conf.auto_overflow){if(this.idPull[pId].childNodes[1].childNodes[0].offsetHeight>this.conf.v.y2-this.conf.v.y1){var t0=Math.max(Math.floor((this.conf.v.y2-this.conf.v.y1-this.conf.of_ah[this.conf.skin]*2)/this.conf.of_ih[this.conf.skin]),1);this.conf.overflow_limit=t0;}else{this.conf.overflow_limit=0;if(this.idPull["arrowup_"+id]!=null)this._removeUpArrow(String(id).replace(this.idPrefix,""));if(this.idPull["arrowdown_"+id]!=null)this._removeDownArrow(String(id).replace(this.idPrefix,""));}}
if(this.conf.overflow_limit>0&&this.conf.overflow_limit<itemCount){if(this.idPull["arrowup_"+id]==null)this._addUpArrow(String(id).replace(this.idPrefix,""));if(this.idPull["arrowdown_"+id]==null)this._addDownArrow(String(id).replace(this.idPrefix,""));arrowUp=this.idPull["arrowup_"+id];arrowUp.style.display="none";arrowDown=this.idPull["arrowdown_"+id];arrowDown.style.display="none";}
if(this.conf.overflow_limit>0&&this.conf.overflow_limit<itemCount){this.idPull[pId].childNodes[1].style.height=this.conf.of_ih[this.conf.skin]*this.conf.overflow_limit+"px";arrowUp.style.width=arrowDown.style.width=this.idPull[pId].childNodes[1].style.width=this.idPull[pId].childNodes[1].childNodes[0].offsetWidth+"px";this.idPull[pId].childNodes[1].scrollTop=0;arrowUp.style.display="";arrUpH=arrowUp.offsetHeight;arrowDown.style.display="";arrDownH=arrowDown.offsetHeight;}else{this.idPull[pId].childNodes[1].style.height="";this.idPull[pId].childNodes[1].style.width="";}
if(this.itemPull[id]!=null){var parPoly="polygon_"+this.itemPull[id]["parent"];}else if(this.conf.context){var parPoly=this.idPull[this.idPrefix+this.topId];}
var srcX=(this.idPull[id].tagName!=null?window.dhx4.absLeft(this.idPull[id]):this.idPull[id][0]);var srcY=(this.idPull[id].tagName!=null?window.dhx4.absTop(this.idPull[id]):this.idPull[id][1]);var srcW=(this.idPull[id].tagName!=null?this.idPull[id].offsetWidth:0);var srcH=(this.idPull[id].tagName!=null?this.idPull[id].offsetHeight:0);var x=0;var y=0;var w=this.idPull[pId].offsetWidth;var h=this.idPull[pId].offsetHeight;if(openType=="bottom"){if(this.conf.rtl){x=srcX+(srcW!=null?srcW:0)-w;}else{if(this.conf.align=="right"){x=srcX+srcW-w;}else{x=srcX-1+(openType==this.conf.dir_toplv?this.conf.tl_rmarg:0);}}
y=srcY-1+srcH+this.conf.tl_botmarg;}
if(openType=="right"){x=srcX+srcW-1;y=srcY+2;}
if(openType=="left"){x=srcX-this.idPull[pId].offsetWidth+2;y=srcY+2;}
if(openType=="top"){x=srcX-1;y=srcY-h+2;}
if(this.conf.fixed_pos){var mx=65536;var my=65536;}else{var mx=(this.conf.v.x2!=null?this.conf.v.x2:0);var my=(this.conf.v.y2!=null?this.conf.v.y2:0);if(mx==0){if(window.innerWidth){mx=window.innerWidth;my=window.innerHeight;}else{mx=document.body.offsetWidth;my=document.body.scrollHeight;}}}
if(x+w>mx&&!this.conf.rtl){x=srcX-w+2;}
if(x<this.conf.v.x1&&this.conf.rtl){x=srcX+srcW-2;}
if(x<0){x=0;}
if(y+h>my&&this.conf.v.y2!=null){y=Math.max(srcY+srcH-h+2,(this.conf.v_enabled?this.conf.v.y1+2:2));if(this.conf.context&&this.idPrefix+this.topId==id&&arrowDown!=null){y=y-2;}
if(this.itemPull[id]!=null&&!this.conf.context){if(this.itemPull[id]["parent"]==this.idPrefix+this.topId)y=y-this.base.offsetHeight;}}
this.idPull[pId].style.left=x+"px";this.idPull[pId].style.top=y+"px";if(typeof(this._menuEffect)!="undefined"&&this._menuEffect!==false){this._showPolygonEffect(pId);}else{this.idPull[pId].style.visibility="";if(this.conf.overflow_limit>0&&this.conf.overflow_limit<itemCount){this.idPull[pId].childNodes[1].scrollTop=0;this._checkArrowsState(id);}
if(window.dhx4.isIE6){var pIdIE6=pId+"_ie6cover";if(this.idPull[pIdIE6]==null){var ifr=document.createElement("IFRAME");ifr.className="dhtmlxMenu_IE6CoverFix_"+this.conf.skin;ifr.frameBorder=0;ifr.setAttribute("src","javascript:false;");document.body.insertBefore(ifr,document.body.firstChild);this.idPull[pIdIE6]=ifr;}
this.idPull[pIdIE6].style.left=x+"px";this.idPull[pIdIE6].style.top=y+"px";this.idPull[pIdIE6].style.width=this.idPull[pId].offsetWidth+"px";this.idPull[pIdIE6].style.height=this.idPull[pId].offsetHeight+"px";this.idPull[pIdIE6].style.zIndex=this.idPull[pId].style.zIndex-1;this.idPull[pIdIE6].style.display="";}}
id=String(id).replace(this.idPrefix,"");if(id==this.topId)id=null;this.callEvent("onShow",[id]);if(id!=null&&this.conf.skin=="dhx_terrace"&&this.itemPull[this.idPrefix+id].parent==this.idPrefix+this.topId){this._improveTerraceButton(this.idPrefix+id,false);}}}
this._redistribSubLevelSelection=function(id,parentId){while(this.conf.opened_poly.length>0)this.conf.opened_poly.pop();var i=this._getSubItemToDeselectByPolygon(parentId);this._removeSubItemFromSelected(-1,-1);for(var q=0;q<i.length;q++){if((this.idPull[i[q]]!=null)&&(i[q]!=id)){if(this.itemPull[i[q]]["state"]=="enabled"){this.idPull[i[q]].className="sub_item";}}}
for(var q=0;q<this.conf.opened_poly.length;q++){if(this.conf.opened_poly[q]!=parentId){this._hidePolygon(this.conf.opened_poly[q]);}}
if(this.itemPull[id]["state"]=="enabled"){this.idPull[id].className="sub_item_selected";if(this.itemPull[id]["complex"]&&this.conf.dload&&(this.itemPull[id]["loaded"]=="no")){if(this.conf.dload_icon==true){this._updateLoaderIcon(id,true);}
this.itemPull[id].loaded="get";var xmlParentId=id.replace(this.idPrefix,"");this._dhxdataload.onBeforeXLS=function(){var p={params:{}};p.params[this.conf.dload_pid]=xmlParentId;for(var a in this.conf.dload_params)p.params[a]=this.conf.dload_params[a];return p;};this.loadStruct(this.conf.dload_url);}
if(this.itemPull[id]["complex"]||(this.conf.dload&&(this.itemPull[id]["loaded"]=="yes"))){if((this.itemPull[id]["complex"])&&(this.idPull["polygon_"+id]!=null)){this._updateItemComplexState(id,true,true);this._showPolygon(id,this.conf.dir_sublv);}}
this._addSubItemToSelected(id,parentId);this.conf.selected=id;}}
this._doOnClick=function(id,type,casState){this.conf.last_click=id;if(this.itemPull[this.idPrefix+id]["href_link"]!=null&&this.itemPull[this.idPrefix+id].state=="enabled"){var form=document.createElement("FORM");var k=String(this.itemPull[this.idPrefix+id]["href_link"]).split("?");form.action=k[0];if(k[1]!=null){var p=String(k[1]).split("&");for(var q=0;q<p.length;q++){var j=String(p[q]).split("=");var m=document.createElement("INPUT");m.type="hidden";m.name=(j[0]||"");m.value=(j[1]||"");form.appendChild(m);}}
if(this.itemPull[this.idPrefix+id]["href_target"]!=null){form.target=this.itemPull[this.idPrefix+id]["href_target"];}
form.style.display="none";document.body.appendChild(form);form.submit();if(form!=null){document.body.removeChild(form);form=null;}
return;}
if(type.charAt(0)=="c")return;if(type.charAt(1)=="d")return;if(type.charAt(2)=="s")return;if(this.checkEvent("onClick")){this.callEvent("onClick",[id,this.conf.ctx_zoneid,casState]);}else{if((type.charAt(1)=="d")||(this.conf.mode=="win"&&type.charAt(2)=="t"))return;}
if(this.conf.context&&this._isContextMenuVisible()&&this.conf.ctx_autohide){this._hideContextMenu();}else{if(this._clearAndHide)this._clearAndHide();}}
this._doOnTouchMenu=function(id){if(this.conf.is_touched==false){this.conf.is_touched=true;if(this.checkEvent("onTouch")){this.callEvent("onTouch",[id]);}}}
this._searchMenuNode=function(node,menu){var m=new Array();for(var q=0;q<menu.length;q++){if(typeof(menu[q])=="object"){if(menu[q].length==5){if(typeof(menu[q][0])!="object"){if((menu[q][0].replace(this.idPrefix,"")==node)&&(q==0)){m=menu;}}}
var j=this._searchMenuNode(node,menu[q]);if(j.length>0){m=j;}}}
return m;}
this._getMenuNodes=function(node){var m=new Array;for(var a in this.itemPull){if(this.itemPull[a]["parent"]==node){m[m.length]=a;}}
return m;}
this._genStr=function(w){var s="dhxId_";var z="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";for(var q=0;q<w;q++)s+=z.charAt(Math.round(Math.random()*(z.length-1)));return s;}
this.getItemType=function(id){id=this.idPrefix+id;if(this.itemPull[id]==null){return null;}
return this.itemPull[id]["type"];}
this.forEachItem=function(handler){for(var a in this.itemPull){handler(String(a).replace(this.idPrefix,""));}}
this._clearAndHide=function(){that.conf.selected=-1;that.conf.last_click=-1;while(that.conf.opened_poly.length>0){that.conf.opened_poly.pop();}
for(var q=0;q<that.conf.selected_sub.length;q++){var id=that.conf.selected_sub[q][0];if(that.idPull[id]!=null){if(that.itemPull[id]["state"]=="enabled"){if(that.idPull[id].className=="sub_item_selected")that.idPull[id].className="sub_item";if(that.idPull[id].className=="dhtmlxMenu_"+that.conf.skin+"_TopLevel_Item_Selected"){if(that.itemPull[id]["cssNormal"]!=null){that.idPull[id].className=that.itemPull[id]["cssNormal"];}else{that.idPull[id].className="dhtmlxMenu_"+that.conf.skin+"_TopLevel_Item_Normal";}}}}
that._hidePolygon(id);}
that.conf.is_touched=false;if(that.conf.context&&that.conf.ctx_hideall)that._hidePolygon(that.idPrefix+that.topId);}
this._showSubLevelItem=function(id,back){if(document.getElementById("arrow_"+this.idPrefix+id)!=null){document.getElementById("arrow_"+this.idPrefix+id).style.display=(back?"none":"");}
if(document.getElementById("image_"+this.idPrefix+id)!=null){document.getElementById("image_"+this.idPrefix+id).style.display=(back?"none":"");}
if(document.getElementById(this.idPrefix+id)!=null){document.getElementById(this.idPrefix+id).style.display=(back?"":"none");}}
this._hideSubLevelItem=function(id){this._showSubLevelItem(id,true)}
this.idPrefix=this._genStr(12)+"_";this._bodyClick=function(e){e=e||event;if(e.button==2||(window.dhx4.isOpera&&e.ctrlKey==true))return;if(that.conf.context){if(that.conf.ctx_autohide&&(!window.dhx4.isOpera||(that._isContextMenuVisible()&&window.dhx4.isOpera)))that._hideContextMenu();}else{if(that._clearAndHide)that._clearAndHide();}}
this._bodyContext=function(e){e=e||event;var t=String((e.srcElement||e.target).className);if(t.search("dhtmlxMenu")!=-1&&t.search("SubLevelArea")!=-1)return;var toHide=true;var testZone=e.target||e.srcElement;while(testZone!=null){if(testZone.id!=null)if(that.isContextZone(testZone.id))toHide=false;if(testZone==document.body)toHide=false;testZone=testZone.parentNode;}
if(toHide)that.hideContextMenu();}
if(typeof(window.addEventListener)!="undefined"){window.addEventListener("click",this._bodyClick,false);window.addEventListener("contextmenu",this._bodyContext,false);}else{document.body.attachEvent("onclick",this._bodyClick);document.body.attachEvent("oncontextmenu",this._bodyContext);}
this.unload=function(){window.dhx4._eventable(this,"clear");dhtmlXMenuObject.prototype.liveInst[this.conf.live_id]=null;try{delete dhtmlXMenuObject.prototype.liveInst[this.conf.live_id];}catch(e){}
this.conf.live_id=null;if(typeof(window.addEventListener)=="function"){window.removeEventListener("click",this._bodyClick,false);window.removeEventListener("contextmenu",this._bodyContext,false);}else{document.body.detachEvent("onclick",this._bodyClick);document.body.detachEvent("oncontextmenu",this._bodyContext);}
this._bodyClick=null;this._bodyContext=null;this.removeItem(this.idPrefix+this.topId,true);this.itemPull=null;this.idPull=null;if(this.conf.context)for(var a in this.conf.ctx_zones)this.removeContextZone(a);if(this.cont!=null){this.cont.className="";this.cont.parentNode.removeChild(this.cont);this.cont=null;}
if(this.base!=null){if(!this.conf.context)this.base.className="";if(!this.conf.context)this.base.oncontextmenu=(this.base._oldContextMenuHandler||null);this.base.onselectstart=null;this.base=null;}
for(var a in this)this[a]=null;that=null;}
dhtmlXMenuObject.prototype.liveInst[this.conf.live_id]=this;window.dhx4._enableDataLoading(this,"_initObj","_xmlToJson",this.conf.tags.root,{struct:true});window.dhx4._eventable(this);if(window.dhx4.s2b(this.conf.autoload.context)==true)this.renderAsContextMenu();if(this.conf.autoload.dynamic!=null){this.enableDynamicLoading(this.conf.autoload.dynamic,window.dhx4.s2b(this.conf.autoload.dynamic_icon));}else if(this.conf.autoload.items!=null){this.loadStruct(this.conf.autoload.items,this.conf.autoload.onload);}else if(this.conf.autoload.json!=null){this.loadStruct(this.conf.autoload.json,this.conf.autoload.onload);}else if(this.conf.autoload.xml!=null){this.loadStruct(this.conf.autoload.xml,this.conf.autoload.onload);}
for(var a in{onclick:1,oncheckboxclick:1,onradioclick:1}){if(this.conf.autoload[a]!=null){if(typeof(this.conf.autoload[a])=="function"){this.attachEvent(a,this.conf.autoload[a]);}else if(typeof(window[this.conf.autoload[a]])=="function"){this.attachEvent(a,window[this.conf.autoload[a]]);}}}
if(this.conf.autoload.top_text!=null)this.setTopText(this.conf.autoload.top_text);if(this.conf.autoload.align!=null)this.setAlign(this.conf.autoload.align);if(this.conf.autoload.open_mode!=null)this.setOpenMode(this.conf.autoload.open_mode);if(this.conf.autoload.overflow!=null)this.setOverflowHeight(this.conf.autoload.overflow);if(this.conf.autoload.iconset=="awesome"){this.conf.icons_css=true;}
for(var a in this.conf.autoload){this.conf.autoload[a]=null;delete this.conf.autoload[a];}
this.conf.autoload=null;return this;};dhtmlXMenuObject.prototype._init=function(){if(this._isInited==true)return;if(this.conf.dload){this._dhxdataload.onBeforeXLS=function(){var p={params:{}};for(var a in this.conf.dload_params)p.params[a]=this.conf.dload_params[a];return p;};this.loadStruct(this.conf.dload_url);}else{this._initTopLevelMenu();this._isInited=true;}};dhtmlXMenuObject.prototype._countVisiblePolygonItems=function(id){var count=0;for(var a in this.itemPull){var par=this.itemPull[a]["parent"];var tp=this.itemPull[a]["type"];if(this.idPull[a]!=null){if(par==id&&(tp=="item"||tp=="radio"||tp=="checkbox")&&this.idPull[a].style.display!="none"){count++;}}}
return count;};dhtmlXMenuObject.prototype._redefineComplexState=function(id){if(this.idPrefix+this.topId==id){return;}
if((this.idPull["polygon_"+id]!=null)&&(this.idPull[id]!=null)){var u=this._countVisiblePolygonItems(id);if((u>0)&&(!this.itemPull[id]["complex"])){this._updateItemComplexState(id,true,false);}
if((u==0)&&(this.itemPull[id]["complex"])){this._updateItemComplexState(id,false,false);}}};dhtmlXMenuObject.prototype._updateItemComplexState=function(id,state,over){if((!this.conf.context)&&(this._getItemLevelType(id.replace(this.idPrefix,""))=="TopLevel")){this.itemPull[id]["complex"]=state;return;}
if((this.idPull[id]==null)||(this.itemPull[id]==null)){return;}
this.itemPull[id]["complex"]=state;if(id==this.idPrefix+this.topId)return;var arrowObj=null;var item=this.idPull[id].childNodes[this.conf.rtl?0:2];if(item.childNodes[0])if(String(item.childNodes[0].className).search("complex_arrow")===0)arrowObj=item.childNodes[0];if(this.itemPull[id]["complex"]){if(arrowObj==null){arrowObj=document.createElement("DIV");arrowObj.className="complex_arrow";arrowObj.id="arrow_"+id;while(item.childNodes.length>0)item.removeChild(item.childNodes[0]);item.appendChild(arrowObj);}
if(this.conf.dload&&(this.itemPull[id].loaded=="get")&&this.conf.dload_icon){if(arrowObj.className!="complex_arrow_loading")arrowObj.className="complex_arrow_loading";}else{arrowObj.className="complex_arrow";}
return;}
if((!this.itemPull[id]["complex"])&&(arrowObj!=null)){item.removeChild(arrowObj);if(this.itemPull[id]["hotkey_backup"]!=null&&this.setHotKey){this.setHotKey(id.replace(this.idPrefix,""),this.itemPull[id]["hotkey_backup"]);}}};dhtmlXMenuObject.prototype._getItemLevelType=function(id){return(this.itemPull[this.idPrefix+id]["parent"]==this.idPrefix+this.topId?"TopLevel":"SubLevelArea");};dhtmlXMenuObject.prototype.setIconsPath=function(path){this.conf.icons_path=path;};dhtmlXMenuObject.prototype._updateItemImage=function(id,levelType){id=this.idPrefix+id;var tp=this.itemPull[id]["type"];if(tp=="checkbox"||tp=="radio")return;var isTopLevel=(this.itemPull[id]["parent"]==this.idPrefix+this.topId&&!this.conf.context);var imgObj=null;if(isTopLevel){for(var q=0;q<this.idPull[id].childNodes.length;q++){if(imgObj==null&&(this.idPull[id].childNodes[q].className||"")=="dhtmlxMenu_TopLevel_Item_Icon"||(this.idPull[id].childNodes[q].tagName||"").toLowerCase()=="i"){imgObj=this.idPull[id].childNodes[q];}}}else{try{var imgObj=this.idPull[id].childNodes[this.conf.rtl?2:0].childNodes[0];}catch(e){}
if(!(imgObj!=null&&typeof(imgObj.className)!="undefined"&&(imgObj.className=="sub_icon"||imgObj.tagName.toLowerCase()=="i")))imgObj=null;}
var imgSrc=this.itemPull[id][(this.itemPull[id]["state"]=="enabled"?"imgen":"imgdis")];if(imgSrc.length>0){if(imgObj!=null){if(this.conf.icons_css==true){imgObj.className=this.conf.icons_path+imgSrc;}else{imgObj.src=this.conf.icons_path+imgSrc;}}else{if(isTopLevel){if(this.conf.icons_css==true){var imgObj=document.createElement("i");imgObj.className=this.conf.icons_path+imgSrc;}else{var imgObj=document.createElement("IMG");imgObj.className="dhtmlxMenu_TopLevel_Item_Icon";imgObj.src=this.conf.icons_path+imgSrc;imgObj.border="0";imgObj.id="image_"+id;}
if(!this.conf.rtl&&this.idPull[id].childNodes.length>0)this.idPull[id].insertBefore(imgObj,this.idPull[id].childNodes[0]);else this.idPull[id].appendChild(imgObj);}else{if(this.conf.icons_css==true){var item=this.idPull[id].childNodes[this.conf.rtl?2:0];item.innerHTML="<i class='"+this.conf.icons_path+imgSrc+"'></i>";}else{var imgObj=document.createElement("IMG");imgObj.className="sub_icon";imgObj.src=this.conf.icons_path+imgSrc;imgObj.border="0";imgObj.id="image_"+id;var item=this.idPull[id].childNodes[this.conf.rtl?2:0];while(item.childNodes.length>0)item.removeChild(item.childNodes[0]);item.appendChild(imgObj);}}}}else{if(imgObj!=null){if(isTopLevel){imgObj.parentNode.removeChild(imgObj);imgObj=null;}else{var p=imgObj.parentNode;p.removeChild(imgObj);p.innerHTML="&nbsp;";p=imgObj=null;}}}};dhtmlXMenuObject.prototype._getAllParents=function(id){var parents=new Array();for(var a in this.itemPull){if(this.itemPull[a]["parent"]==id){parents[parents.length]=this.itemPull[a]["id"];if(this.itemPull[a]["complex"]){var t=this._getAllParents(this.itemPull[a]["id"]);for(var q=0;q<t.length;q++){parents[parents.length]=t[q];}}}}
return parents;};dhtmlXMenuObject.prototype._autoDetectVisibleArea=function(){if(this.conf.v_enabled)return;var d=window.dhx4.screenDim();this.conf.v.x1=d.left;this.conf.v.x2=d.right;this.conf.v.y1=d.top;this.conf.v.y2=d.bottom;};dhtmlXMenuObject.prototype.getItemPosition=function(id){id=this.idPrefix+id;var pos=-1;if(this.itemPull[id]==null)return pos;var parent=this.itemPull[id]["parent"];var obj=(this.idPull["polygon_"+parent]!=null?this.idPull["polygon_"+parent].tbd:this.cont);for(var q=0;q<obj.childNodes.length;q++){if(obj.childNodes[q]==this.idPull["separator_"+id]||obj.childNodes[q]==this.idPull[id]){pos=q;}}
return pos;};dhtmlXMenuObject.prototype.setItemPosition=function(id,pos){id=this.idPrefix+id;if(this.idPull[id]==null){return;}
var isOnTopLevel=(this.itemPull[id]["parent"]==this.idPrefix+this.topId);var itemData=this.idPull[id];var itemPos=this.getItemPosition(id.replace(this.idPrefix,""));var parent=this.itemPull[id]["parent"];var obj=(this.idPull["polygon_"+parent]!=null?this.idPull["polygon_"+parent].tbd:this.cont);obj.removeChild(obj.childNodes[itemPos]);if(pos<0)pos=0;if(isOnTopLevel&&pos<1){pos=1;}
if(pos<obj.childNodes.length){obj.insertBefore(itemData,obj.childNodes[pos]);}else{obj.appendChild(itemData);}};dhtmlXMenuObject.prototype.getParentId=function(id){id=this.idPrefix+id;if(this.itemPull[id]==null){return null;}
return((this.itemPull[id]["parent"]!=null?this.itemPull[id]["parent"]:this.topId).replace(this.idPrefix,""));};dhtmlXMenuObject.prototype.hide=function(){this._clearAndHide();};dhtmlXMenuObject.prototype.clearAll=function(){this.removeItem(this.idPrefix+this.topId,true);this._isInited=false;this.idPrefix=this._genStr(12)+"_";this.itemPull={};};if(typeof(dhtmlXMenuObject.prototype.liveInst)=="undefined"){dhtmlXMenuObject.prototype.liveInst={};};dhtmlXMenuObject.prototype.setIconset=function(name){this.conf.icons_css=(name=="awesome");};dhtmlXMenuObject.prototype._redistribTopLevelSelection=function(id,parent){var i=this._getSubItemToDeselectByPolygon("parent");this._removeSubItemFromSelected(-1,-1);for(var q=0;q<i.length;q++){if(i[q]!=id){this._hidePolygon(i[q]);}
if((this.idPull[i[q]]!=null)&&(i[q]!=id)){this.idPull[i[q]].className=this.idPull[i[q]].className.replace(/Selected/g,"Normal");}}
if(this.itemPull[this.idPrefix+id]["state"]=="enabled"){this.idPull[this.idPrefix+id].className="dhtmlxMenu_"+this.conf.skin+"_TopLevel_Item_Selected";this._addSubItemToSelected(this.idPrefix+id,"parent");this.conf.selected=(this.conf.mode=="win"?(this.conf.selected!=-1?id:this.conf.selected):id);if((this.itemPull[this.idPrefix+id]["complex"])&&(this.conf.selected!=-1)){this._showPolygon(this.idPrefix+id,this.conf.dir_toplv);}}};dhtmlXMenuObject.prototype._initTopLevelMenu=function(){this.conf.dir_toplv="bottom";this.conf.dir_sublv=(this.conf.rtl?"left":"right");if(this.conf.context){this.idPull[this.idPrefix+this.topId]=new Array(0,0);this._addSubMenuPolygon(this.idPrefix+this.topId,this.idPrefix+this.topId);}else{var m=this._getMenuNodes(this.idPrefix+this.topId);for(var q=0;q<m.length;q++){if(this.itemPull[m[q]]["type"]=="item")this._renderToplevelItem(m[q],null);if(this.itemPull[m[q]]["type"]=="separator")this._renderSeparator(m[q],null);}}};dhtmlXMenuObject.prototype._renderToplevelItem=function(id,pos){var that=this;var m=document.createElement("DIV");m.id=id;if(this.itemPull[id]["state"]=="enabled"&&this.itemPull[id]["cssNormal"]!=null){m.className=this.itemPull[id]["cssNormal"];}else{m.className="dhtmlxMenu_"+this.conf.skin+"_TopLevel_Item_"+(this.itemPull[id]["state"]=="enabled"?"Normal":"Disabled");}
if(this.itemPull[id]["title"]!=""){var t1=document.createElement("DIV");t1.className="top_level_text";t1.innerHTML=this.itemPull[id]["title"];m.appendChild(t1);}
if(this.itemPull[id]["tip"].length>0)m.title=this.itemPull[id]["tip"];if((this.itemPull[id]["imgen"]!="")||(this.itemPull[id]["imgdis"]!="")){var imgTop=this.itemPull[id][(this.itemPull[id]["state"]=="enabled")?"imgen":"imgdis"];if(imgTop){if(this.conf.icons_css==true){var i=document.createElement("i");i.className=this.conf.icons_path+imgTop;if(m.childNodes.length>0&&!this.conf.rtl)m.insertBefore(i,m.childNodes[0]);else m.appendChild(i);}else{var img=document.createElement("IMG");img.border="0";img.id="image_"+id;img.src=this.conf.icons_path+imgTop;img.className="dhtmlxMenu_TopLevel_Item_Icon";if(m.childNodes.length>0&&!this.conf.rtl)m.insertBefore(img,m.childNodes[0]);else m.appendChild(img);}}}
m.onselectstart=function(e){e=e||event;if(e.preventDefault)e.preventDefault();else e.returnValue=false;return false;}
m.oncontextmenu=function(e){e=e||event;if(e.preventDefault)e.preventDefault();else e.returnValue=false;return false;}
if(!this.cont){this.cont=document.createElement("DIV");this.cont.dir="ltr";this.cont.className=(this.conf.align=="right"?"align_right":"align_left");this.base.appendChild(this.cont);}
if(pos!=null){pos++;if(pos<0)pos=0;if(pos>this.cont.childNodes.length-1)pos=null;}
if(pos!=null)this.cont.insertBefore(m,this.cont.childNodes[pos]);else this.cont.appendChild(m);this.idPull[m.id]=m;if(this.itemPull[id]["complex"]&&(!this.conf.dload))this._addSubMenuPolygon(this.itemPull[id]["id"],this.itemPull[id]["id"]);m.onmouseover=function(){if(that.conf.mode=="web"){window.clearTimeout(that.conf.tm_handler);}
var i=that._getSubItemToDeselectByPolygon("parent");that._removeSubItemFromSelected(-1,-1);for(var q=0;q<i.length;q++){if(i[q]!=this.id){that._hidePolygon(i[q]);}
if((that.idPull[i[q]]!=null)&&(i[q]!=this.id)){if(that.itemPull[i[q]]["cssNormal"]!=null){that.idPull[i[q]].className=that.itemPull[i[q]]["cssNormal"];}else{if(that.idPull[i[q]].className=="sub_item_selected")that.idPull[i[q]].className="sub_item";that.idPull[i[q]].className=that.idPull[i[q]].className.replace(/Selected/g,"Normal");}}}
if(that.itemPull[this.id]["state"]=="enabled"){this.className="dhtmlxMenu_"+that.conf.skin+"_TopLevel_Item_Selected";that._addSubItemToSelected(this.id,"parent");that.conf.selected=(that.conf.mode=="win"?(that.conf.selected!=-1?this.id:that.conf.selected):this.id);if(that.conf.dload){if(that.itemPull[this.id].loaded=="no"){this._dynLoadTM=new Date().getTime();that.itemPull[this.id].loaded="get";var xmlParentId=this.id.replace(that.idPrefix,"");that._dhxdataload.onBeforeXLS=function(){var p={params:{}};p.params[this.conf.dload_pid]=xmlParentId;for(var a in this.conf.dload_params)p.params[a]=this.conf.dload_params[a];return p;};that.loadStruct(that.conf.dload_url);}
if(that.conf.top_mode&&that.conf.mode=="web"&&!that.conf.context){this._mouseOver=true;}}
if((!that.conf.dload)||(that.conf.dload&&(!that.itemPull[this.id]["loaded"]||that.itemPull[this.id]["loaded"]=="yes"))){if((that.itemPull[this.id]["complex"])&&(that.conf.selected!=-1)){if(that.conf.top_mode&&that.conf.mode=="web"&&!that.conf.context){this._mouseOver=true;var showItemId=this.id;this._menuOpenTM=window.setTimeout(function(){that._showPolygon(showItemId,that.conf.dir_toplv);},that.conf.top_tmtime);}else{that._showPolygon(this.id,that.conf.dir_toplv);}}}}
that._doOnTouchMenu(this.id.replace(that.idPrefix,""));}
m.onmouseout=function(){if(!((that.itemPull[this.id]["complex"])&&(that.conf.selected!=-1))&&(that.itemPull[this.id]["state"]=="enabled")){if(that.itemPull[this.id]["cssNormal"]!=null){m.className=that.itemPull[this.id]["cssNormal"];}else{m.className="dhtmlxMenu_"+that.conf.skin+"_TopLevel_Item_Normal";}}
if(that.conf.mode=="web"){window.clearTimeout(that.conf.tm_handler);that.conf.tm_handler=window.setTimeout(function(){that._clearAndHide();},that.conf.tm_sec,"JavaScript");}
if(that.conf.top_mode&&that.conf.mode=="web"&&!that.conf.context){this._mouseOver=false;window.clearTimeout(this._menuOpenTM);}}
m.onclick=function(e){if(that.conf.mode=="web"){window.clearTimeout(that.conf.tm_handler);}
if(that.conf.mode!="web"&&that.itemPull[this.id]["state"]=="disabled"){return;}
e=e||event;e.cancelBubble=true;if(e.preventDefault)e.preventDefault();else e.returnValue=false;if(that.conf.mode=="win"){if(that.itemPull[this.id]["complex"]){if(that.conf.selected==this.id){that.conf.selected=-1;var s=false;}else{that.conf.selected=this.id;var s=true;}
if(s){that._showPolygon(this.id,that.conf.dir_toplv);}else{that._hidePolygon(this.id);}}}
var tc=(that.itemPull[this.id]["complex"]?"c":"-");var td=(that.itemPull[this.id]["state"]!="enabled"?"d":"-");var cas={"ctrl":e.ctrlKey,"alt":e.altKey,"shift":e.shiftKey};that._doOnClick(this.id.replace(that.idPrefix,""),tc+td+"t",cas);return false;}
if(this.conf.skin=="dhx_terrace"){this._improveTerraceSkin();}};dhtmlXMenuObject.prototype._addSubMenuPolygon=function(id,parentId){var s=this._renderSublevelPolygon(id,parentId);var j=this._getMenuNodes(parentId);for(q=0;q<j.length;q++){if(this.itemPull[j[q]]["type"]=="separator"){this._renderSeparator(j[q],null);}else{this._renderSublevelItem(j[q],null);}}
if(id==parentId){var level="topLevel";}else{var level="subLevel";}
for(var q=0;q<j.length;q++){if(this.itemPull[j[q]]["complex"]){this._addSubMenuPolygon(id,this.itemPull[j[q]]["id"]);}}};dhtmlXMenuObject.prototype._renderSublevelPolygon=function(id,parentId){var s=document.createElement("DIV");s.className="dhtmlxMenu_"+this.conf.skin+"_SubLevelArea_Polygon "+(this.conf.rtl?"dir_right":"");s.dir="ltr";s.oncontextmenu=function(e){e=e||event;if(e.preventDefault)e.preventDefault();else e.returnValue=false;e.cancelBubble=true;return false;}
s.id="polygon_"+parentId;s.onclick=function(e){e=e||event;e.cancelBubble=true;}
s.style.display="none";document.body.insertBefore(s,document.body.firstChild);s.innerHTML='<div style="position:relative;"></div>'+'<div style="position: relative; overflow:hidden;"></div>'+'<div style="position:relative;"></div>';var tbl=document.createElement("TABLE");tbl.className="dhtmlxMebu_SubLevelArea_Tbl";tbl.cellSpacing=0;tbl.cellPadding=0;tbl.border=0;var tbd=document.createElement("TBODY");tbl.appendChild(tbd);s.childNodes[1].appendChild(tbl);s.tbl=tbl;s.tbd=tbd;this.idPull[s.id]=s;if(this.sxDacProc!=null){this.idPull["sxDac_"+parentId]=new this.sxDacProc(s,s.className);if(window.dhx4.isIE){this.idPull["sxDac_"+parentId]._setSpeed(this.dacSpeedIE);this.idPull["sxDac_"+parentId]._setCustomCycle(this.dacCyclesIE);}else{this.idPull["sxDac_"+parentId]._setSpeed(this.dacSpeed);this.idPull["sxDac_"+parentId]._setCustomCycle(this.dacCycles);}}
return s;};dhtmlXMenuObject.prototype._renderSublevelItem=function(id,pos){var that=this;var tr=document.createElement("TR");tr.className=(this.itemPull[id]["state"]=="enabled"?"sub_item":"sub_item_dis");var t1=document.createElement("TD");t1.className="sub_item_icon";var tp=this.itemPull[id]["type"];var icon=this.itemPull[id][(this.itemPull[id]["state"]=="enabled"?"imgen":"imgdis")];if(icon!=""){if(tp=="checkbox"||tp=="radio"){var img=document.createElement("DIV");img.id="image_"+this.itemPull[id]["id"];img.className="sub_icon "+icon;t1.appendChild(img);}
if(!(tp=="checkbox"||tp=="radio")){if(this.conf.icons_css==true){t1.innerHTML="<i class='"+this.conf.icons_path+icon+"'></i>";}else{var img=document.createElement("IMG");img.id="image_"+this.itemPull[id]["id"];img.className="sub_icon";img.src=this.conf.icons_path+icon;t1.appendChild(img);}}}else{t1.innerHTML="&nbsp;";}
var t2=document.createElement("TD");t2.className="sub_item_text";if(this.itemPull[id]["title"]!=""){var t2t=document.createElement("DIV");t2t.className="sub_item_text";t2t.innerHTML=this.itemPull[id]["title"];t2.appendChild(t2t);}else{t2.innerHTML="&nbsp;";}
var t3=document.createElement("TD");t3.className="sub_item_hk";if(this.itemPull[id]["complex"]){var arw=document.createElement("DIV");arw.className="complex_arrow";arw.id="arrow_"+this.itemPull[id]["id"];t3.appendChild(arw);}else{if(this.itemPull[id]["hotkey"].length>0&&!this.itemPull[id]["complex"]){var t3t=document.createElement("DIV");t3t.className="sub_item_hk";t3t.innerHTML=this.itemPull[id]["hotkey"];t3.appendChild(t3t);}else{t3.innerHTML="&nbsp;";}}
tr.appendChild(this.conf.rtl?t3:t1);tr.appendChild(t2);tr.appendChild(this.conf.rtl?t1:t3);tr.id=this.itemPull[id]["id"];tr.parent=this.itemPull[id]["parent"];if(this.itemPull[id]["tip"].length>0)tr.title=this.itemPull[id]["tip"];tr.onselectstart=function(e){e=e||event;if(e.preventDefault)e.preventDefault();else e.returnValue=false;return false;}
tr.onmouseover=function(e){if(that.conf.hide_tm[this.id])window.clearTimeout(that.conf.hide_tm[this.id]);if(that.conf.mode=="web")window.clearTimeout(that.conf.tm_handler);if(!this._visible)that._redistribSubLevelSelection(this.id,this.parent);this._visible=true;}
tr.onmouseout=function(){if(that.conf.mode=="web"){if(that.conf.tm_handler)window.clearTimeout(that.conf.tm_handler);that.conf.tm_handler=window.setTimeout(function(){if(that&&that._clearAndHide)that._clearAndHide();},that.conf.tm_sec,"JavaScript");}
var k=this;if(that.conf.hide_tm[this.id])window.clearTimeout(that.conf.hide_tm[this.id]);that.conf.hide_tm[this.id]=window.setTimeout(function(){k._visible=false;},50);}
tr.onclick=function(e){if(!that.checkEvent("onClick")&&that.itemPull[this.id]["complex"])return;e=e||event;e.cancelBubble=true;if(e.preventDefault)e.preventDefault();else e.returnValue=false;tc=(that.itemPull[this.id]["complex"]?"c":"-");td=(that.itemPull[this.id]["state"]=="enabled"?"-":"d");var cas={"ctrl":e.ctrlKey,"alt":e.altKey,"shift":e.shiftKey};switch(that.itemPull[this.id]["type"]){case"checkbox":that._checkboxOnClickHandler(this.id.replace(that.idPrefix,""),tc+td+"n",cas);break;case"radio":that._radioOnClickHandler(this.id.replace(that.idPrefix,""),tc+td+"n",cas);break;case"item":that._doOnClick(this.id.replace(that.idPrefix,""),tc+td+"n",cas);break;}
return false;}
var polygon=this.idPull["polygon_"+this.itemPull[id]["parent"]];if(pos!=null){pos++;if(pos<0)pos=0;if(pos>polygon.tbd.childNodes.length-1)pos=null;}
if(pos!=null&&polygon.tbd.childNodes[pos]!=null)polygon.tbd.insertBefore(tr,polygon.tbd.childNodes[pos]);else polygon.tbd.appendChild(tr);this.idPull[tr.id]=tr;};dhtmlXMenuObject.prototype._renderSeparator=function(id,pos){var level=(this.conf.context?"SubLevelArea":(this.itemPull[id]["parent"]==this.idPrefix+this.topId?"TopLevel":"SubLevelArea"));if(level=="TopLevel"&&this.conf.context)return;var that=this;if(level!="TopLevel"){var tr=document.createElement("TR");tr.className="sub_sep";var td=document.createElement("TD");td.colSpan="3";tr.appendChild(td);}
var k=document.createElement("DIV");k.id="separator_"+id;k.className=(level=="TopLevel"?"top_sep":"sub_sep");k.onselectstart=function(e){e=e||event;if(e.preventDefault)e.preventDefault();else e.returnValue=false;}
k.onclick=function(e){e=e||event;e.cancelBubble=true;var cas={"ctrl":e.ctrlKey,"alt":e.altKey,"shift":e.shiftKey};that._doOnClick(this.id.replace("separator_"+that.idPrefix,""),"--s",cas);}
if(level=="TopLevel"){if(pos!=null){pos++;if(pos<0){pos=0;}
if(this.cont.childNodes[pos]!=null){this.cont.insertBefore(k,this.cont.childNodes[pos]);}else{this.cont.appendChild(k);}}else{var last=this.cont.childNodes[this.cont.childNodes.length-1];if(String(last).search("TopLevel_Text")==-1){this.cont.appendChild(k);}else{this.cont.insertBefore(k,last);}}
this.idPull[k.id]=k;}else{var polygon=this.idPull["polygon_"+this.itemPull[id]["parent"]];if(pos!=null){pos++;if(pos<0)pos=0;if(pos>polygon.tbd.childNodes.length-1)pos=null;}
if(pos!=null&&polygon.tbd.childNodes[pos]!=null)polygon.tbd.insertBefore(tr,polygon.tbd.childNodes[pos]);else polygon.tbd.appendChild(tr);td.appendChild(k);this.idPull[k.id]=tr;}};dhtmlXMenuObject.prototype.addNewSeparator=function(nextToId,itemId){itemId=this.idPrefix+(itemId!=null?itemId:this._genStr(24));var parentId=this.idPrefix+this.getParentId(nextToId);this._addItemIntoGlobalStrorage(itemId,parentId,"","separator",false,"","");this._renderSeparator(itemId,this.getItemPosition(nextToId));};dhtmlXMenuObject.prototype._initObj=function(items,nested,parentId){if(!(items instanceof Array)){parentId=items.parentId;if(parentId!=null&&String(parentId).indexOf(this.idPrefix)!==0)parentId=this.idPrefix+String(parentId);items=items.items;}
for(var q=0;q<items.length;q++){if(typeof(items[q].id)=="undefined"||items[q].id==null){items[q].id=this._genStr(24);}
if(items[q].text==null)items[q].text="";if(String(items[q].id).indexOf(this.idPrefix)!==0){items[q].id=this.idPrefix+String(items[q].id);}
var k={type:"item",tip:"",hotkey:"",state:"enabled",imgen:"",imgdis:""};for(var a in k){if(typeof(items[q][a])=="undefined")items[q][a]=k[a];}
if(items[q].imgen==""&&items[q].img!=null)items[q].imgen=items[q].img;if(items[q].imgdis==""&&items[q].img_disabled!=null)items[q].imgdis=items[q].img_disabled;if(items[q].title==null&&items[q].text!=null)items[q].title=items[q].text;if(items[q].href!=null){if(items[q].href.link!=null)items[q].href_link=items[q].href.link;if(items[q].href.target!=null)items[q].href_target=items[q].href.target;}
if(items[q].userdata!=null){for(var a in items[q].userdata)this.userData[items[q].id+"_"+a]=items[q].userdata[a];}
if(typeof(items[q].enabled)!="undefined"&&window.dhx4.s2b(items[q].enabled)==false){items[q].state="disabled";}else if(typeof(items[q].disabled)!="undefined"&&window.dhx4.s2b(items[q].disabled)==true){items[q].state="disabled";}
if(typeof(items[q].parent)=="undefined"){items[q].parent=(parentId!=null?parentId:this.idPrefix+this.topId);}
if(items[q].type=="checkbox"){items[q].checked=window.dhx4.s2b(items[q].checked);items[q].imgen=items[q].imgdis="chbx_"+(items[q].checked?"1":"0");}
if(items[q].type=="radio"){items[q].checked=window.dhx4.s2b(items[q].checked);items[q].imgen=items[q].imgdis="rdbt_"+(items[q].checked?"1":"0");if(typeof(items[q].group)=="undefined"||items[q].group==null)items[q].group=this._genStr(24);if(this.radio[items[q].group]==null)this.radio[items[q].group]=[];this.radio[items[q].group].push(items[q].id);}
this.itemPull[items[q].id]=items[q];if(items[q].items!=null&&items[q].items.length>0){this.itemPull[items[q].id].complex=true;this._initObj(items[q].items,true,items[q].id);}else if(this.conf.dload&&items[q].complex==true){this.itemPull[items[q].id].loaded="no";}
this.itemPull[items[q].id].items=null;}
if(nested!==true){if(this.conf.dload==true){if(parentId==null){this._initTopLevelMenu();}else{this._addSubMenuPolygon(parentId,parentId);if(this.conf.selected==parentId){var isTop=(this.itemPull[parentId].parent==this.idPrefix+this.topId);var level=(isTop&&!this.conf.context?this.conf.dir_toplv:this.conf.dir_sublv);var isShow=false;if(isTop&&this.conf.top_mode&&this.conf.mode=="web"&&!this.conf.context){var item=this.idPull[parentId];if(item._mouseOver==true){var delay=this.conf.top_tmtime-(new Date().getTime()-item._dynLoadTM);if(delay>1){var pId=parentId;var that=this;item._menuOpenTM=window.setTimeout(function(){that._showPolygon(pId,level);that=pId=null;},delay);isShow=true;}}}
if(!isShow)this._showPolygon(parentId,level);}
this.itemPull[parentId].loaded="yes";if(this.conf.dload_icon==true)this._updateLoaderIcon(parentId,false);}}else{this._init();}}};dhtmlXMenuObject.prototype._xmlToJson=function(xml,parentId){var items=[];if(parentId==null){var root=xml.getElementsByTagName(this.conf.tags.root);if(root==null||(root!=null&&root.length==0))return{items:[]};root=root[0];}else{root=xml;}
if(root.getAttribute("parentId")!=null){parentId=this.idPrefix+root.getAttribute("parentId");}
for(var q=0;q<root.childNodes.length;q++){if(typeof(root.childNodes[q].tagName)!="undefined"&&String(root.childNodes[q].tagName).toLowerCase()==this.conf.tags.item){var r=root.childNodes[q];var item={id:this.idPrefix+(r.getAttribute("id")||this._genStr(24)),title:r.getAttribute("text")||"",imgen:r.getAttribute("img")||"",imgdis:r.getAttribute("imgdis")||"",tip:"",hotkey:"",type:r.getAttribute("type")||"item"};if(r.getAttribute("cssNormal")!=null){item.cssNormal=r.getAttribute("cssNormal");}
if(item.type=="checkbox")item.checked=r.getAttribute("checked");if(item.type=="radio"){item.checked=r.getAttribute("checked");item.group=r.getAttribute("group");}
item.state="enabled";if(r.getAttribute("enabled")!=null&&window.dhx4.s2b(r.getAttribute("enabled"))==false){item.state="disabled";}else if(r.getAttribute("disabled")!=null&&window.dhx4.s2b(r.getAttribute("disabled"))==true){item.state="disabled";}
item.parent=(parentId!=null?parentId:this.idPrefix+this.topId);if(this.conf.dload){item.complex=(r.getAttribute("complex")!=null);if(item.complex)item.loaded="no";}else{var i=this._xmlToJson(r,item.id);item.items=i.items;item.complex=(item.items.length>0);}
for(var w=0;w<r.childNodes.length;w++){if(typeof(r.childNodes[w].tagName)!="undefined"){var t=String(r.childNodes[w].tagName||"").toLowerCase();if(t==this.conf.tags.userdata){var d=r.childNodes[w];if(d.getAttribute("name")!=null){this.userData[item.id+"_"+d.getAttribute("name")]=(d.firstChild!=null&&d.firstChild.nodeValue!=null?d.firstChild.nodeValue:"");}}
if(t==this.conf.tags.text_ext){item.title=r.childNodes[w].firstChild.nodeValue;}
if(t==this.conf.tags.tooltip){item.tip=r.childNodes[w].firstChild.nodeValue;}
if(t==this.conf.tags.hotkey){item.hotkey=r.childNodes[w].firstChild.nodeValue;}
if(t==this.conf.tags.href&&item.type=="item"){item.href_link=r.childNodes[w].firstChild.nodeValue;if(r.childNodes[w].getAttribute("target")!=null){item.href_target=r.childNodes[w].getAttribute("target");}}}}
items.push(item);}}
var r={parentId:parentId,items:items};return r;};dhtmlXMenuObject.prototype.enableDynamicLoading=function(url,icon){this.conf.dload=true;this.conf.dload_url=url;this.conf.dload_sign=(String(this.conf.dload_url).search(/\?/)==-1?"?":"&");this.conf.dload_icon=icon;this._init();};dhtmlXMenuObject.prototype._updateLoaderIcon=function(id,state){if(this.idPull[id]==null)return;if(String(this.idPull[id].className).search("TopLevel_Item")>=0)return;var ind=(this.conf.rtl?0:2);if(!this.idPull[id].childNodes[ind])return;if(!this.idPull[id].childNodes[ind].childNodes[0])return;var aNode=this.idPull[id].childNodes[ind].childNodes[0];if(String(aNode.className).search("complex_arrow")===0)aNode.className="complex_arrow"+(state?"_loading":"");};dhtmlXMenuObject.prototype.addNewSibling=function(nextToId,itemId,itemText,disabled,imgEnabled,imgDisabled){var id=this.idPrefix+(itemId!=null?itemId:this._genStr(24));var parentId=this.idPrefix+(nextToId!=null?this.getParentId(nextToId):this.topId);this._addItemIntoGlobalStrorage(id,parentId,itemText,"item",disabled,imgEnabled,imgDisabled);if((parentId==this.idPrefix+this.topId)&&(!this.conf.context)){this._renderToplevelItem(id,this.getItemPosition(nextToId));}else{this._renderSublevelItem(id,this.getItemPosition(nextToId));}};dhtmlXMenuObject.prototype.addNewChild=function(parentId,pos,itemId,itemText,disabled,imgEnabled,imgDisabled){if(parentId==null){if(this.conf.context){parentId=this.topId;}else{this.addNewSibling(parentId,itemId,itemText,disabled,imgEnabled,imgDisabled);if(pos!=null)this.setItemPosition(itemId,pos);return;}}
itemId=this.idPrefix+(itemId!=null?itemId:this._genStr(24));if(this.setHotKey)this.setHotKey(parentId,"");parentId=this.idPrefix+parentId;this._addItemIntoGlobalStrorage(itemId,parentId,itemText,"item",disabled,imgEnabled,imgDisabled);if(this.idPull["polygon_"+parentId]==null){this._renderSublevelPolygon(parentId,parentId);}
this._renderSublevelItem(itemId,pos-1);this._redefineComplexState(parentId);};dhtmlXMenuObject.prototype.removeItem=function(id,_isTId,_recCall){if(!_isTId)id=this.idPrefix+id;var pId=null;if(id!=this.idPrefix+this.topId){if(this.itemPull[id]==null)return;if(this.idPull["polygon_"+id]&&this.idPull["polygon_"+id]._tmShow)window.clearTimeout(this.idPull["polygon_"+id]._tmShow);var t=this.itemPull[id]["type"];if(t=="separator"){var item=this.idPull["separator_"+id];if(this.itemPull[id]["parent"]==this.idPrefix+this.topId){item.onclick=null;item.onselectstart=null;item.id=null;item.parentNode.removeChild(item);}else{item.childNodes[0].childNodes[0].onclick=null;item.childNodes[0].childNodes[0].onselectstart=null;item.childNodes[0].childNodes[0].id=null;item.childNodes[0].removeChild(item.childNodes[0].childNodes[0]);item.removeChild(item.childNodes[0]);item.parentNode.removeChild(item);}
this.idPull["separator_"+id]=null;this.itemPull[id]=null;delete this.idPull["separator_"+id];delete this.itemPull[id];item=null;}else{pId=this.itemPull[id]["parent"];var item=this.idPull[id];item.onclick=null;item.oncontextmenu=null;item.onmouseover=null;item.onmouseout=null;item.onselectstart=null;item.id=null;while(item.childNodes.length>0)item.removeChild(item.childNodes[0]);item.parentNode.removeChild(item);this.idPull[id]=null;this.itemPull[id]=null;delete this.idPull[id];delete this.itemPull[id];item=null;}
t=null;}
for(var a in this.itemPull)if(this.itemPull[a]["parent"]==id)this.removeItem(a,true,true);var p2=new Array(id);if(pId!=null&&!_recCall){if(this.idPull["polygon_"+pId]!=null){if(this.idPull["polygon_"+pId].tbd.childNodes.length==0){p2.push(pId);this._updateItemComplexState(pId,false,false);}}}
for(var q=0;q<p2.length;q++){if(this.idPull["polygon_"+p2[q]]){var p=this.idPull["polygon_"+p2[q]];p.onclick=null;p.oncontextmenu=null;p.tbl.removeChild(p.tbd);p.tbd=null;p.childNodes[1].removeChild(p.tbl);p.tbl=null;p.id=null;p.parentNode.removeChild(p);p=null;if(window.dhx4.isIE6){var pc="polygon_"+p2[q]+"_ie6cover";if(this.idPull[pc]!=null){document.body.removeChild(this.idPull[pc]);delete this.idPull[pc];}}
if(this.idPull["arrowup_"+id]!=null&&this._removeArrow)this._removeArrow("arrowup_"+id);if(this.idPull["arrowdown_"+id]!=null&&this._removeArrow)this._removeArrow("arrowdown_"+id);this.idPull["polygon_"+p2[q]]=null;delete this.idPull["polygon_"+p2[q]];}}
p2=null;if(this.conf.skin=="dhx_terrace"&&arguments.length==1)this._improveTerraceSkin();};dhtmlXMenuObject.prototype._addItemIntoGlobalStrorage=function(itemId,itemParentId,itemText,itemType,disabled,img,imgDis){var item={id:itemId,title:itemText,imgen:(img!=null?img:""),imgdis:(imgDis!=null?imgDis:""),type:itemType,state:(disabled==true?"disabled":"enabled"),parent:itemParentId,complex:false,hotkey:"",tip:""};this.itemPull[item.id]=item;};dhtmlXMenuObject.prototype.renderAsContextMenu=function(){this.conf.context=true;if(this.base._autoSkinUpdate==true){this.base.className=this.base.className.replace("dhtmlxMenu_"+this.conf.skin+"_Middle","");this.base._autoSkinUpdate=false;}
if(this.conf.ctx_baseid!=null){this.addContextZone(this.conf.ctx_baseid);}};dhtmlXMenuObject.prototype.addContextZone=function(zoneId){if(zoneId==document.body){zoneId="document.body."+this.idPrefix;var zone=document.body;}else if(typeof(zoneId)=="string"){var zone=document.getElementById(zoneId);}else{var zone=zoneId;}
var zoneExists=false;for(var a in this.conf.ctx_zones){zoneExists=zoneExists||(a==zoneId)||(this.conf.ctx_zones[a]==zone);}
if(zoneExists==true)return false;this.conf.ctx_zones[zoneId]=zone;var that=this;if(window.dhx4.isOpera){this.operaContext=function(e){that._doOnContextMenuOpera(e,that);}
zone.addEventListener("mouseup",this.operaContext,false);}else{if(zone.oncontextmenu!=null&&!zone._oldContextMenuHandler)zone._oldContextMenuHandler=zone.oncontextmenu;zone.oncontextmenu=function(e){for(var q in dhtmlXMenuObject.prototype.liveInst){if(q!=that.conf.live_id){if(dhtmlXMenuObject.prototype.liveInst[q].context){dhtmlXMenuObject.prototype.liveInst[q]._hideContextMenu();}}}
e=e||event;e.cancelBubble=true;if(e.preventDefault)e.preventDefault();else e.returnValue=false;that._doOnContextBeforeCall(e,this);return false;}}};dhtmlXMenuObject.prototype._doOnContextMenuOpera=function(e,that){for(var q in dhtmlXMenuObject.prototype.liveInst){if(q!=that.conf.live_id){if(dhtmlXMenuObject.prototype.liveInst[q].context){dhtmlXMenuObject.prototype.liveInst[q]._hideContextMenu();}}}
e.cancelBubble=true;if(e.preventDefault)e.preventDefault();else e.returnValue=false;if(e.button==0&&e.ctrlKey==true){that._doOnContextBeforeCall(e,this);}
return false;};dhtmlXMenuObject.prototype.removeContextZone=function(zoneId){if(!this.isContextZone(zoneId))return false;if(zoneId==document.body)zoneId="document.body."+this.idPrefix;var zone=this.conf.ctx_zones[zoneId];if(window.dhx4.isOpera){zone.removeEventListener("mouseup",this.operaContext,false);}else{zone.oncontextmenu=(zone._oldContextMenuHandler!=null?zone._oldContextMenuHandler:null);zone._oldContextMenuHandler=null;}
try{this.conf.ctx_zones[zoneId]=null;delete this.conf.ctx_zones[zoneId];}catch(e){}
return true;};dhtmlXMenuObject.prototype.isContextZone=function(zoneId){if(zoneId==document.body&&this.conf.ctx_zones["document.body."+this.idPrefix]!=null)return true;var isZone=false;if(this.conf.ctx_zones[zoneId]!=null){if(this.conf.ctx_zones[zoneId]==document.getElementById(zoneId))isZone=true;}
return isZone;};dhtmlXMenuObject.prototype._isContextMenuVisible=function(){if(this.idPull["polygon_"+this.idPrefix+this.topId]==null)return false;return(this.idPull["polygon_"+this.idPrefix+this.topId].style.display=="");};dhtmlXMenuObject.prototype._showContextMenu=function(x,y,zoneId){this._clearAndHide();if(this.idPull["polygon_"+this.idPrefix+this.topId]==null)return false;window.clearTimeout(this.conf.tm_handler);this.idPull[this.idPrefix+this.topId]=new Array(x,y);this._showPolygon(this.idPrefix+this.topId,"bottom");this.callEvent("onContextMenu",[zoneId]);};dhtmlXMenuObject.prototype._hideContextMenu=function(){if(this.idPull["polygon_"+this.idPrefix+this.topId]==null)return false;this._clearAndHide();this._hidePolygon(this.idPrefix+this.topId);};dhtmlXMenuObject.prototype._doOnContextBeforeCall=function(e,cZone){this.conf.ctx_zoneid=cZone.id;this._clearAndHide();this._hideContextMenu();if(window.dhx4.isChrome==true||window.dhx4.isEdge==true||window.dhx4.isOpera==true||window.dhx4.isIE11==true){var mx=window.dhx4.absLeft(e.target)+e.offsetX;var my=window.dhx4.absTop(e.target)+e.offsetY;}else if(window.dhx4.isIE6==true||window.dhx4.isIE7==true||window.dhx4.isIE==true){var mx=window.dhx4.absLeft(e.srcElement)+e.x||0;var my=window.dhx4.absTop(e.srcElement)+e.y||0;}else{var p=(e.srcElement||e.target);var px=(window.dhx4.isIE||window.dhx4.isKHTML?e.offsetX:e.layerX);var py=(window.dhx4.isIE||window.dhx4.isKHTML?e.offsetY:e.layerY);var mx=window.dhx4.absLeft(p)+px;var my=window.dhx4.absTop(p)+py;}
if(this.checkEvent("onBeforeContextMenu")){if(this.callEvent("onBeforeContextMenu",[cZone.id,e])){if(this.conf.ctx_autoshow){this._showContextMenu(mx,my,cZone.id);this.callEvent("onAfterContextMenu",[cZone.id,e]);}}}else{if(this.conf.ctx_autoshow){this._showContextMenu(mx,my,cZone.id);this.callEvent("onAfterContextMenu",[cZone.id]);}}};dhtmlXMenuObject.prototype.showContextMenu=function(x,y){this._showContextMenu(x,y,false);};dhtmlXMenuObject.prototype.hideContextMenu=function(){this._hideContextMenu();};dhtmlXMenuObject.prototype.setAutoShowMode=function(mode){this.conf.ctx_autoshow=(mode==true?true:false);};dhtmlXMenuObject.prototype.setAutoHideMode=function(mode){this.conf.ctx_autohide=(mode==true?true:false);};dhtmlXMenuObject.prototype.setContextMenuHideAllMode=function(mode){this.conf.ctx_hideall=(mode==true?true:false);};dhtmlXMenuObject.prototype.getContextMenuHideAllMode=function(){return this.conf.ctx_hideall;};dhtmlXMenuObject.prototype._improveTerraceSkin=function(){for(var a in this.itemPull){if(this.itemPull[a].parent==this.idPrefix+this.topId&&this.idPull[a]!=null){var bl=false;var br=false;if(this.idPull[a].parentNode.firstChild==this.idPull[a]){bl=true;}
if(this.idPull[a].parentNode.lastChild==this.idPull[a]){br=true;}
for(var b in this.itemPull){if(this.itemPull[b].type=="separator"&&this.itemPull[b].parent==this.idPrefix+this.topId){if(this.idPull[a].nextSibling==this.idPull["separator_"+b]){br=true;}
if(this.idPull[a].previousSibling==this.idPull["separator_"+b]){bl=true;}}}
this.idPull[a].style.borderLeftWidth=(bl?"1px":"0px");this.idPull[a].style.borderTopLeftRadius=this.idPull[a].style.borderBottomLeftRadius=(bl?"3px":"0px");this.idPull[a].style.borderTopRightRadius=this.idPull[a].style.borderBottomRightRadius=(br?"3px":"0px");this.idPull[a]._bl=bl;this.idPull[a]._br=br;}}};dhtmlXMenuObject.prototype._improveTerraceButton=function(id,state){if(state){this.idPull[id].style.borderBottomLeftRadius=(this.idPull[id]._bl?"3px":"0px");this.idPull[id].style.borderBottomRightRadius=(this.idPull[id]._br?"3px":"0px");}else{this.idPull[id].style.borderBottomLeftRadius="0px";this.idPull[id].style.borderBottomRightRadius="0px";}};if(typeof(window.dhtmlXCellObject)!="undefined"){dhtmlXCellObject.prototype._createNode_menu=function(obj,type,htmlString,append,node){if(typeof(node)!="undefined"){obj=node;}else{obj=document.createElement("DIV");obj.className="dhx_cell_menu_"+(this.conf.borders?"def":"no_borders");obj.appendChild(document.createElement("DIV"));}
this.cell.insertBefore(obj,this.cell.childNodes[this.conf.idx.toolbar||this.conf.idx.cont]);this.conf.ofs_nodes.t.menu=true;this._updateIdx();return obj;};dhtmlXCellObject.prototype.attachMenu=function(conf){if(this.dataNodes.menu)return;this.callEvent("_onBeforeContentAttach",["menu"]);if(typeof(conf)=="undefined")conf={};if(typeof(conf.skin)=="undefined")conf.skin=this.conf.skin;conf.parent=this._attachObject("menu").firstChild;this.dataNodes.menu=new dhtmlXMenuObject(conf);this._adjustCont(this._idd);conf.parent=null;conf=null;this.callEvent("_onContentAttach",[]);return this.dataNodes.menu;};dhtmlXCellObject.prototype.detachMenu=function(){if(this.dataNodes.menu==null)return;if(typeof(this.dataNodes.menu.unload)=="function")this.dataNodes.menu.unload();this.dataNodes.menu=null;delete this.dataNodes.menu;this._detachObject("menu");};dhtmlXCellObject.prototype.showMenu=function(){this._mtbShowHide("menu","");};dhtmlXCellObject.prototype.hideMenu=function(){this._mtbShowHide("menu","none");};dhtmlXCellObject.prototype.getAttachedMenu=function(){return this.dataNodes.menu;};}
dhtmlXMenuObject.prototype.setItemEnabled=function(id){this._changeItemState(id,"enabled",this._getItemLevelType(id));};dhtmlXMenuObject.prototype.setItemDisabled=function(id){this._changeItemState(id,"disabled",this._getItemLevelType(id));};dhtmlXMenuObject.prototype.isItemEnabled=function(id){return(this.itemPull[this.idPrefix+id]!=null?(this.itemPull[this.idPrefix+id]["state"]=="enabled"):false);};dhtmlXMenuObject.prototype._changeItemState=function(id,newState,levelType){var t=false;var j=this.idPrefix+id;if((this.itemPull[j]!=null)&&(this.idPull[j]!=null)){if(this.itemPull[j]["state"]!=newState){this.itemPull[j]["state"]=newState;if(this.itemPull[j]["parent"]==this.idPrefix+this.topId&&!this.conf.context){this.idPull[j].className="dhtmlxMenu_"+this.conf.skin+"_TopLevel_Item_"+(this.itemPull[j]["state"]=="enabled"?"Normal":"Disabled");}else{this.idPull[j].className="sub_item"+(this.itemPull[j]["state"]=="enabled"?"":"_dis");}
this._updateItemComplexState(this.idPrefix+id,this.itemPull[this.idPrefix+id]["complex"],false);this._updateItemImage(id,levelType);if((this.idPrefix+this.conf.last_click==j)&&(levelType!="TopLevel")){this._redistribSubLevelSelection(j,this.itemPull[j]["parent"]);}
if(levelType=="TopLevel"&&!this.conf.context){}}}
return t;};dhtmlXMenuObject.prototype.getItemText=function(id){return(this.itemPull[this.idPrefix+id]!=null?this.itemPull[this.idPrefix+id]["title"]:"");};dhtmlXMenuObject.prototype.setItemText=function(id,text){id=this.idPrefix+id;if((this.itemPull[id]!=null)&&(this.idPull[id]!=null)){this._clearAndHide();this.itemPull[id]["title"]=text;if(this.itemPull[id]["parent"]==this.idPrefix+this.topId&&!this.conf.context){var tObj=null;for(var q=0;q<this.idPull[id].childNodes.length;q++){try{if(this.idPull[id].childNodes[q].className=="top_level_text")tObj=this.idPull[id].childNodes[q];}catch(e){}}
if(String(this.itemPull[id]["title"]).length==""||this.itemPull[id]["title"]==null){if(tObj!=null)tObj.parentNode.removeChild(tObj);}else{if(!tObj){tObj=document.createElement("DIV");tObj.className="top_level_text";if(this.conf.rtl&&this.idPull[id].childNodes.length>0)this.idPull[id].insertBefore(tObj,this.idPull[id].childNodes[0]);else this.idPull[id].appendChild(tObj);}
tObj.innerHTML=this.itemPull[id]["title"];}}else{var tObj=null;for(var q=0;q<this.idPull[id].childNodes[1].childNodes.length;q++){if(String(this.idPull[id].childNodes[1].childNodes[q].className||"")=="sub_item_text")tObj=this.idPull[id].childNodes[1].childNodes[q];}
if(String(this.itemPull[id]["title"]).length==""||this.itemPull[id]["title"]==null){if(tObj){tObj.parentNode.removeChild(tObj);tObj=null;this.idPull[id].childNodes[1].innerHTML="&nbsp;";}}else{if(!tObj){tObj=document.createElement("DIV");tObj.className="sub_item_text";this.idPull[id].childNodes[1].innerHTML="";this.idPull[id].childNodes[1].appendChild(tObj);}
tObj.innerHTML=this.itemPull[id]["title"];}}}};dhtmlXMenuObject.prototype.loadFromHTML=function(objId,clearAfterAdd,onLoad){var t=this.conf.tags.item;this.conf.tags.item="div";var node=(typeof(objId)=="string"?document.getElementById(objId):objId);var items=this._xmlToJson(node,this.idPrefix+this.topId);this._initObj(items);this.conf.tags.item=t;if(clearAfterAdd)node.parentNode.removeChild(node);node=objOd=null;if(onload!=null){if(typeof(onLoad)=="function"){onLoad();}else if(typeof(window[onLoad])=="function"){window[onLoad]();}}};dhtmlXMenuObject.prototype.hideItem=function(id){this._changeItemVisible(id,false);};dhtmlXMenuObject.prototype.showItem=function(id){this._changeItemVisible(id,true);};dhtmlXMenuObject.prototype.isItemHidden=function(id){var isHidden=null;if(this.idPull[this.idPrefix+id]!=null){isHidden=(this.idPull[this.idPrefix+id].style.display=="none");}
return isHidden;};dhtmlXMenuObject.prototype._changeItemVisible=function(id,visible){var itemId=this.idPrefix+id;if(this.itemPull[itemId]==null)return;if(this.itemPull[itemId]["type"]=="separator"){itemId="separator_"+itemId;}
if(this.idPull[itemId]==null)return;this.idPull[itemId].style.display=(visible?"":"none");this._redefineComplexState(this.itemPull[this.idPrefix+id]["parent"]);};dhtmlXMenuObject.prototype.setUserData=function(id,name,value){this.userData[this.idPrefix+id+"_"+name]=value;};dhtmlXMenuObject.prototype.getUserData=function(id,name){return(this.userData[this.idPrefix+id+"_"+name]!=null?this.userData[this.idPrefix+id+"_"+name]:null);};dhtmlXMenuObject.prototype.setOpenMode=function(mode){this.conf.mode=(mode=="win"?"win":"web");};dhtmlXMenuObject.prototype.setWebModeTimeout=function(tm){this.conf.tm_sec=(!isNaN(tm)?tm:400);};dhtmlXMenuObject.prototype.getItemImage=function(id){var imgs=new Array(null,null);id=this.idPrefix+id;if(this.itemPull[id]["type"]=="item"){imgs[0]=this.itemPull[id]["imgen"];imgs[1]=this.itemPull[id]["imgdis"];}
return imgs;};dhtmlXMenuObject.prototype.setItemImage=function(id,img,imgDis){if(this.itemPull[this.idPrefix+id]["type"]!="item")return;this.itemPull[this.idPrefix+id]["imgen"]=img;this.itemPull[this.idPrefix+id]["imgdis"]=imgDis;this._updateItemImage(id,this._getItemLevelType(id));};dhtmlXMenuObject.prototype.clearItemImage=function(id){this.setItemImage(id,"","");};dhtmlXMenuObject.prototype.setVisibleArea=function(x1,x2,y1,y2){this.conf.v_enabled=true;this.conf.v.x1=x1;this.conf.v.x2=x2;this.conf.v.y1=y1;this.conf.v.y2=y2;};dhtmlXMenuObject.prototype.setTooltip=function(id,tip){id=this.idPrefix+id;if(!(this.itemPull[id]!=null&&this.idPull[id]!=null))return;this.idPull[id].title=(tip.length>0?tip:null);this.itemPull[id]["tip"]=tip;};dhtmlXMenuObject.prototype.getTooltip=function(id){if(this.itemPull[this.idPrefix+id]==null)return null;return this.itemPull[this.idPrefix+id]["tip"];};dhtmlXMenuObject.prototype.setTopText=function(text){if(this.conf.context)return;if(this._topText==null){this._topText=document.createElement("DIV");this._topText.className="dhtmlxMenu_TopLevel_Text_"+(this.conf.rtl?"left":(this.conf.align=="left"?"right":"left"));this.base.appendChild(this._topText);}
this._topText.innerHTML=text;};dhtmlXMenuObject.prototype.setAlign=function(align){if(this.conf.align==align)return;if(align=="left"||align=="right"){this.conf.align=align;if(this.cont)this.cont.className=(this.conf.align=="right"?"align_right":"align_left");if(this._topText!=null)this._topText.className="dhtmlxMenu_TopLevel_Text_"+(this.conf.align=="left"?"right":"left");}};dhtmlXMenuObject.prototype.setHref=function(itemId,href,target){if(this.itemPull[this.idPrefix+itemId]==null)return;this.itemPull[this.idPrefix+itemId]["href_link"]=href;if(target!=null)this.itemPull[this.idPrefix+itemId]["href_target"]=target;};dhtmlXMenuObject.prototype.clearHref=function(itemId){if(this.itemPull[this.idPrefix+itemId]==null)return;delete this.itemPull[this.idPrefix+itemId]["href_link"];delete this.itemPull[this.idPrefix+itemId]["href_target"];};dhtmlXMenuObject.prototype.getCircuit=function(id){var parents=new Array(id);while(this.getParentId(id)!=this.topId){id=this.getParentId(id);parents[parents.length]=id;}
return parents.reverse();};dhtmlXMenuObject.prototype._getCheckboxState=function(id){if(this.itemPull[this.idPrefix+id]==null)return null;return this.itemPull[this.idPrefix+id]["checked"];};dhtmlXMenuObject.prototype._setCheckboxState=function(id,state){if(this.itemPull[this.idPrefix+id]==null)return;this.itemPull[this.idPrefix+id]["checked"]=state;};dhtmlXMenuObject.prototype._updateCheckboxImage=function(id){if(this.idPull[this.idPrefix+id]==null)return;this.itemPull[this.idPrefix+id]["imgen"]="chbx_"+(this._getCheckboxState(id)?"1":"0");this.itemPull[this.idPrefix+id]["imgdis"]=this.itemPull[this.idPrefix+id]["imgen"];try{this.idPull[this.idPrefix+id].childNodes[(this.conf.rtl?2:0)].childNodes[0].className="sub_icon "+this.itemPull[this.idPrefix+id]["imgen"];}catch(e){}};dhtmlXMenuObject.prototype._checkboxOnClickHandler=function(id,type,casState){if(type.charAt(1)=="d")return;if(this.itemPull[this.idPrefix+id]==null)return;var state=this._getCheckboxState(id);if(this.checkEvent("onCheckboxClick")){if(this.callEvent("onCheckboxClick",[id,state,this.conf.ctx_zoneid,casState])){this.setCheckboxState(id,!state);}}else{this.setCheckboxState(id,!state);}
if(this.checkEvent("onClick"))this.callEvent("onClick",[id]);};dhtmlXMenuObject.prototype.setCheckboxState=function(id,state){this._setCheckboxState(id,state);this._updateCheckboxImage(id);};dhtmlXMenuObject.prototype.getCheckboxState=function(id){return this._getCheckboxState(id);};dhtmlXMenuObject.prototype.addCheckbox=function(mode,nextToId,pos,itemId,itemText,state,disabled){if(this.conf.context&&nextToId==this.topId){}else{if(this.itemPull[this.idPrefix+nextToId]==null)return;if(mode=="child"&&this.itemPull[this.idPrefix+nextToId]["type"]!="item")return;}
var img="chbx_"+(state?"1":"0");var imgDis=img;if(mode=="sibling"){var id=this.idPrefix+(itemId!=null?itemId:this._genStr(24));var parentId=this.idPrefix+this.getParentId(nextToId);this._addItemIntoGlobalStrorage(id,parentId,itemText,"checkbox",disabled,img,imgDis);this.itemPull[id]["checked"]=state;this._renderSublevelItem(id,this.getItemPosition(nextToId));}else{var id=this.idPrefix+(itemId!=null?itemId:this._genStr(24));var parentId=this.idPrefix+nextToId;this._addItemIntoGlobalStrorage(id,parentId,itemText,"checkbox",disabled,img,imgDis);this.itemPull[id]["checked"]=state;if(this.idPull["polygon_"+parentId]==null){this._renderSublevelPolygon(parentId,parentId);}
this._renderSublevelItem(id,pos-1);this._redefineComplexState(parentId);}};dhtmlXMenuObject.prototype.setHotKey=function(id,hkey){id=this.idPrefix+id;if(!(this.itemPull[id]!=null&&this.idPull[id]!=null))return;if(this.itemPull[id]["parent"]==this.idPrefix+this.topId&&!this.conf.context)return;if(this.itemPull[id]["complex"])return;var t=this.itemPull[id]["type"];if(!(t=="item"||t=="checkbox"||t=="radio"))return;var hkObj=null;try{if(this.idPull[id].childNodes[this.conf.rtl?0:2].childNodes[0].className=="sub_item_hk")hkObj=this.idPull[id].childNodes[this.conf.rtl?0:2].childNodes[0];}catch(e){}
if(hkey.length==0){this.itemPull[id]["hotkey_backup"]=this.itemPull[id]["hotkey"];this.itemPull[id]["hotkey"]="";if(hkObj!=null)hkObj.parentNode.removeChild(hkObj);}else{this.itemPull[id]["hotkey"]=hkey;this.itemPull[id]["hotkey_backup"]=null;if(hkObj==null){hkObj=document.createElement("DIV");hkObj.className="sub_item_hk";var item=this.idPull[id].childNodes[this.conf.rtl?0:2];while(item.childNodes.length>0)item.removeChild(item.childNodes[0]);item.appendChild(hkObj);}
hkObj.innerHTML=hkey;}};dhtmlXMenuObject.prototype.getHotKey=function(id){if(this.itemPull[this.idPrefix+id]==null)return null;return this.itemPull[this.idPrefix+id]["hotkey"];};dhtmlXMenuObject.prototype._clearAllSelectedSubItemsInPolygon=function(polygon){var subIds=this._getSubItemToDeselectByPolygon(polygon);for(var q=0;q<this.conf.opened_poly.length;q++){if(this.conf.opened_poly[q]!=polygon)this._hidePolygon(this.conf.opened_poly[q]);}
for(var q=0;q<subIds.length;q++){if(this.idPull[subIds[q]]!=null&&this.itemPull[subIds[q]]["state"]=="enabled"){this.idPull[subIds[q]].className="dhtmlxMenu_"+this.conf.skin+"_SubLevelArea_Item_Normal";}}};dhtmlXMenuObject.prototype._checkArrowsState=function(id){var polygon=this.idPull["polygon_"+id].childNodes[1];var arrowUp=this.idPull["arrowup_"+id];var arrowDown=this.idPull["arrowdown_"+id];if(polygon.scrollTop==0){arrowUp.className="dhtmlxMenu_"+this.conf.skin+"_SubLevelArea_ArrowUp_Disabled";}else{arrowUp.className="dhtmlxMenu_"+this.conf.skin+"_SubLevelArea_ArrowUp"+(arrowUp.over?"_Over":"");}
if(polygon.scrollTop+polygon.offsetHeight<polygon.scrollHeight){arrowDown.className="dhtmlxMenu_"+this.conf.skin+"_SubLevelArea_ArrowDown"+(arrowDown.over?"_Over":"");}else{arrowDown.className="dhtmlxMenu_"+this.conf.skin+"_SubLevelArea_ArrowDown_Disabled";}
polygon=arrowUp=arrowDown=null;};dhtmlXMenuObject.prototype._addUpArrow=function(id){var that=this;var arrow=document.createElement("DIV");arrow.pId=this.idPrefix+id;arrow.id="arrowup_"+this.idPrefix+id;arrow.className="dhtmlxMenu_"+this.conf.skin+"_SubLevelArea_ArrowUp";arrow.over=false;arrow.onselectstart=function(e){e=e||event;if(e.preventDefault)e.preventDefault();else e.returnValue=false;return false;}
arrow.oncontextmenu=function(e){e=e||event;if(e.preventDefault)e.preventDefault();else e.returnValue=false;return false;}
arrow.onmouseover=function(){if(that.conf.mode=="web"){window.clearTimeout(that.conf.tm_handler);}
that._clearAllSelectedSubItemsInPolygon(this.pId);if(this.className=="dhtmlxMenu_"+that.conf.skin+"_SubLevelArea_ArrowUp_Disabled")return;this.className="dhtmlxMenu_"+that.conf.skin+"_SubLevelArea_ArrowUp_Over";this.over=true;that._canScrollUp=true;that._doScrollUp(this.pId,true);}
arrow.onmouseout=function(){if(that.conf.mode=="web"){window.clearTimeout(that.conf.tm_handler);that.conf.tm_handler=window.setTimeout(function(){that._clearAndHide();},that.conf.tm_sec,"JavaScript");}
this.over=false;that._canScrollUp=false;if(this.className=="dhtmlxMenu_"+that.conf.skin+"_SubLevelArea_ArrowUp_Disabled")return;this.className="dhtmlxMenu_"+that.conf.skin+"_SubLevelArea_ArrowUp";window.clearTimeout(that.conf.of_utm);}
arrow.onclick=function(e){e=e||event;if(e.preventDefault)e.preventDefault();else e.returnValue=false;e.cancelBubble=true;return false;}
var polygon=this.idPull["polygon_"+this.idPrefix+id];polygon.childNodes[0].appendChild(arrow);this.idPull[arrow.id]=arrow;polygon=arrow=null;};dhtmlXMenuObject.prototype._addDownArrow=function(id){var that=this;var arrow=document.createElement("DIV");arrow.pId=this.idPrefix+id;arrow.id="arrowdown_"+this.idPrefix+id;arrow.className="dhtmlxMenu_"+this.conf.skin+"_SubLevelArea_ArrowDown";arrow.over=false;arrow.onselectstart=function(e){e=e||event;if(e.preventDefault)e.preventDefault();else e.returnValue=false;return false;}
arrow.oncontextmenu=function(e){e=e||event;if(e.preventDefault)e.preventDefault();else e.returnValue=false;return false;}
arrow.onmouseover=function(){if(that.conf.mode=="web"){window.clearTimeout(that.conf.tm_handler);}
that._clearAllSelectedSubItemsInPolygon(this.pId);if(this.className=="dhtmlxMenu_"+that.conf.skin+"_SubLevelArea_ArrowDown_Disabled")return;this.className="dhtmlxMenu_"+that.conf.skin+"_SubLevelArea_ArrowDown_Over";this.over=true;that._canScrollDown=true;that._doScrollDown(this.pId,true);}
arrow.onmouseout=function(){if(that.conf.mode=="web"){window.clearTimeout(that.conf.tm_handler);that.conf.tm_handler=window.setTimeout(function(){that._clearAndHide();},that.conf.tm_sec,"JavaScript");}
this.over=false;that._canScrollDown=false;if(this.className=="dhtmlxMenu_"+that.conf.skin+"_SubLevelArea_ArrowDown_Disabled")return;this.className="dhtmlxMenu_"+that.conf.skin+"_SubLevelArea_ArrowDown";window.clearTimeout(that.conf.of_dtm);}
arrow.onclick=function(e){e=e||event;if(e.preventDefault)e.preventDefault();else e.returnValue=false;e.cancelBubble=true;return false;}
var polygon=this.idPull["polygon_"+this.idPrefix+id];polygon.childNodes[2].appendChild(arrow);this.idPull[arrow.id]=arrow;polygon=arrow=null;};dhtmlXMenuObject.prototype._removeUpArrow=function(id){var fullId="arrowup_"+this.idPrefix+id;this._removeArrow(fullId);};dhtmlXMenuObject.prototype._removeDownArrow=function(id){var fullId="arrowdown_"+this.idPrefix+id;this._removeArrow(fullId);};dhtmlXMenuObject.prototype._removeArrow=function(fullId){var arrow=this.idPull[fullId];arrow.onselectstart=null;arrow.oncontextmenu=null;arrow.onmouseover=null;arrow.onmouseout=null;arrow.onclick=null;if(arrow.parentNode)arrow.parentNode.removeChild(arrow);arrow=null;this.idPull[fullId]=null;try{delete this.idPull[fullId];}catch(e){}};dhtmlXMenuObject.prototype._isArrowExists=function(id){if(this.idPull["arrowup_"+id]!=null&&this.idPull["arrowdown_"+id]!=null)return true;return false;};dhtmlXMenuObject.prototype._doScrollUp=function(id,checkArrows){var polygon=this.idPull["polygon_"+id].childNodes[1];if(this._canScrollUp&&polygon.scrollTop>0){var theEnd=false;var nextScrollTop=polygon.scrollTop-this.conf.of_ustep;if(nextScrollTop<0){theEnd=true;nextScrollTop=0;}
polygon.scrollTop=nextScrollTop;if(!theEnd){var that=this;this.conf.of_utm=window.setTimeout(function(){that._doScrollUp(id,false);that=null;},this.conf.of_utime);}else{checkArrows=true;}}else{this._canScrollUp=false;this._checkArrowsState(id);}
if(checkArrows){this._checkArrowsState(id);}};dhtmlXMenuObject.prototype._doScrollDown=function(id,checkArrows){var polygon=this.idPull["polygon_"+id].childNodes[1];if(this._canScrollDown&&polygon.scrollTop+polygon.offsetHeight<=polygon.scrollHeight){var theEnd=false;var nextScrollTop=polygon.scrollTop+this.conf.of_dstep;if(nextScrollTop+polygon.offsetHeight>=polygon.scrollHeight){theEnd=true;nextScrollTop=polygon.scrollHeight-polygon.offsetHeight;}
polygon.scrollTop=nextScrollTop;if(!theEnd){var that=this;this.conf.of_dtm=window.setTimeout(function(){that._doScrollDown(id,false);that=null;},this.conf.of_dtime);}else{checkArrows=true;}}else{this._canScrollDown=false;this._checkArrowsState(id);}
if(checkArrows){this._checkArrowsState(id);}};dhtmlXMenuObject.prototype._countPolygonItems=function(id){var count=0;for(var a in this.itemPull){var par=this.itemPull[a]["parent"];var tp=this.itemPull[a]["type"];if(par==this.idPrefix+id&&(tp=="item"||tp=="radio"||tp=="checkbox")){count++;}}
return count;};dhtmlXMenuObject.prototype.setOverflowHeight=function(itemsNum){if(itemsNum==="auto"){this.conf.overflow_limit=0;this.conf.auto_overflow=true;return;}
if(this.conf.overflow_limit==0&&itemsNum<=0)return;this._clearAndHide();if(this.conf.overflow_limit>=0&&itemsNum>0){this.conf.overflow_limit=itemsNum;return;}
if(this.conf.overflow_limit>0&&itemsNum<=0){for(var a in this.itemPull){if(this._isArrowExists(a)){var b=String(a).replace(this.idPrefix,"");this._removeUpArrow(b);this._removeDownArrow(b);this.idPull["polygon_"+a].childNodes[1].style.height="";}}
this.conf.overflow_limit=0;return;}};dhtmlXMenuObject.prototype._getRadioImgObj=function(id){try{var imgObj=this.idPull[this.idPrefix+id].childNodes[(this.conf.rtl?2:0)].childNodes[0]}catch(e){var imgObj=null;}
return imgObj;};dhtmlXMenuObject.prototype._setRadioState=function(id,state){var imgObj=this._getRadioImgObj(id);if(imgObj!=null){var rObj=this.itemPull[this.idPrefix+id];rObj["checked"]=state;rObj["imgen"]="rdbt_"+(rObj["checked"]?"1":"0");rObj["imgdis"]=rObj["imgen"];imgObj.className="sub_icon "+rObj["imgen"];}};dhtmlXMenuObject.prototype._radioOnClickHandler=function(id,type,casState){if(type.charAt(1)=="d"||this.itemPull[this.idPrefix+id]["group"]==null)return;var group=this.itemPull[this.idPrefix+id]["group"];if(this.checkEvent("onRadioClick")){if(this.callEvent("onRadioClick",[group,this.getRadioChecked(group),id,this.conf.ctx_zoneid,casState])){this.setRadioChecked(group,id);}}else{this.setRadioChecked(group,id);}
if(this.checkEvent("onClick"))this.callEvent("onClick",[id]);};dhtmlXMenuObject.prototype.getRadioChecked=function(group){var id=null;for(var q=0;q<this.radio[group].length;q++){var itemId=this.radio[group][q].replace(this.idPrefix,"");var imgObj=this._getRadioImgObj(itemId);if(imgObj!=null){var checked=(imgObj.className).match(/rdbt_1$/gi);if(checked!=null)id=itemId;}}
return id;};dhtmlXMenuObject.prototype.setRadioChecked=function(group,id){if(this.radio[group]==null)return;for(var q=0;q<this.radio[group].length;q++){var itemId=this.radio[group][q].replace(this.idPrefix,"");this._setRadioState(itemId,(itemId==id));}}
dhtmlXMenuObject.prototype.addRadioButton=function(mode,nextToId,pos,itemId,itemText,group,state,disabled){if(this.conf.context&&nextToId==this.topId){}else{if(this.itemPull[this.idPrefix+nextToId]==null)return;if(mode=="child"&&this.itemPull[this.idPrefix+nextToId]["type"]!="item")return;}
var id=this.idPrefix+(itemId!=null?itemId:this._genStr(24));var img="rdbt_"+(state?"1":"0");var imgDis=img;if(mode=="sibling"){var parentId=this.idPrefix+this.getParentId(nextToId);this._addItemIntoGlobalStrorage(id,parentId,itemText,"radio",disabled,img,imgDis);this._renderSublevelItem(id,this.getItemPosition(nextToId));}else{var parentId=this.idPrefix+nextToId;this._addItemIntoGlobalStrorage(id,parentId,itemText,"radio",disabled,img,imgDis);if(this.idPull["polygon_"+parentId]==null){this._renderSublevelPolygon(parentId,parentId);}
this._renderSublevelItem(id,pos-1);this._redefineComplexState(parentId);}
var gr=(group!=null?group:this._genStr(24));this.itemPull[id]["group"]=gr;if(this.radio[gr]==null){this.radio[gr]=new Array();}
this.radio[gr][this.radio[gr].length]=id;if(state==true)this.setRadioChecked(gr,String(id).replace(this.idPrefix,""));};dhtmlXMenuObject.prototype.serialize=function(){var xml="<menu>"+this._readLevel(this.idPrefix+this.topId)+"</menu>";return xml;};dhtmlXMenuObject.prototype._readLevel=function(parentId){var xml="";for(var a in this.itemPull){if(this.itemPull[a]["parent"]==parentId){var imgEn="";var imgDis="";var hotKey="";var itemId=String(this.itemPull[a]["id"]).replace(this.idPrefix,"");var itemType="";var itemText=(this.itemPull[a]["title"]!=""?' text="'+this.itemPull[a]["title"]+'"':"");var itemState="";if(this.itemPull[a]["type"]=="item"){if(this.itemPull[a]["imgen"]!="")imgEn=' img="'+this.itemPull[a]["imgen"]+'"';if(this.itemPull[a]["imgdis"]!="")imgDis=' imgdis="'+this.itemPull[a]["imgdis"]+'"';if(this.itemPull[a]["hotkey"]!="")hotKey='<hotkey>'+this.itemPull[a]["hotkey"]+'</hotkey>';}
if(this.itemPull[a]["type"]=="separator"){itemType=' type="separator"';}else{if(this.itemPull[a]["state"]=="disabled")itemState=' enabled="false"';}
if(this.itemPull[a]["type"]=="checkbox"){itemType=' type="checkbox"'+(this.itemPull[a]["checked"]?' checked="true"':"");}
if(this.itemPull[a]["type"]=="radio"){itemType=' type="radio" group="'+this.itemPull[a]["group"]+'" '+(this.itemPull[a]["checked"]?' checked="true"':"");}
xml+="<item id='"+itemId+"'"+itemText+itemType+imgEn+imgDis+itemState+">";xml+=hotKey;if(this.itemPull[a]["complex"])xml+=this._readLevel(a);xml+="</item>";}}
return xml;};dhtmlXMenuObject.prototype.enableEffect=function(name,maxOpacity,effectSpeed){this._menuEffect=(name=="opacity"||name=="slide"||name=="slide+"?name:false);this._pOpStyleIE=(navigator.userAgent.search(/MSIE\s[678]\.0/gi)>=0);for(var a in this.idPull){if(a.search(/polygon/)===0){this._pOpacityApply(a,(this._pOpStyleIE?100:1));this.idPull[a].style.height="";}}
this._pOpMax=(typeof(maxOpacity)=="undefined"?100:maxOpacity)/(this._pOpStyleIE?1:100);this._pOpStyleName=(this._pOpStyleIE?"filter":"opacity");this._pOpStyleValue=(this._pOpStyleIE?"progid:DXImageTransform.Microsoft.Alpha(Opacity=#)":"#");this._pSlSteps=(this._pOpStyleIE?10:20);this._pSlTMTimeMax=effectSpeed||50;};dhtmlXMenuObject.prototype._showPolygonEffect=function(pId){this._pShowHide(pId,true);};dhtmlXMenuObject.prototype._hidePolygonEffect=function(pId){this._pShowHide(pId,false);};dhtmlXMenuObject.prototype._pOpacityApply=function(pId,val){this.idPull[pId].style[this._pOpStyleName]=String(this._pOpStyleValue).replace("#",val||this.idPull[pId]._op);};dhtmlXMenuObject.prototype._pShowHide=function(pId,mode){if(!this.idPull)return;if(this.idPull[pId]._tmShow!=null){if((this.idPull[pId]._step_h>0&&mode==true)||(this.idPull[pId]._step_h<0&&mode==false))return;window.clearTimeout(this.idPull[pId]._tmShow);this.idPull[pId]._tmShow=null;this.idPull[pId]._max_h=null;}
if(mode==false&&(this.idPull[pId].style.visibility=="hidden"||this.idPull[pId].style.display=="none"))return;if(mode==true&&this.idPull[pId].style.display=="none"){this.idPull[pId].style.visibility="hidden";this.idPull[pId].style.display="";}
if(this.idPull[pId]._max_h==null){this.idPull[pId]._max_h=parseInt(this.idPull[pId].offsetHeight);this.idPull[pId]._h=(mode==true?0:this.idPull[pId]._max_h);this.idPull[pId]._step_h=Math.round(this.idPull[pId]._max_h/this._pSlSteps)*(mode==true?1:-1);if(this.idPull[pId]._step_h==0)return;this.idPull[pId]._step_tm=Math.round(this._pSlTMTimeMax/this._pSlSteps);if(this._menuEffect=="slide+"||this._menuEffect=="opacity"){this.idPull[pId].op_tm=this.idPull[pId]._step_tm;this.idPull[pId].op_step=(this._pOpMax/this._pSlSteps)*(mode==true?1:-1);if(this._pOpStyleIE)this.idPull[pId].op_step=Math.round(this.idPull[pId].op_step);this.idPull[pId]._op=(mode==true?0:this._pOpMax);this._pOpacityApply(pId);}else{this.idPull[pId]._op=(this._pOpStyleIE?100:1);this._pOpacityApply(pId);}
if(this._menuEffect.search(/slide/)===0)this.idPull[pId].style.height="0px";this.idPull[pId].style.visibility="visible";}
this._pEffectSet(pId,this.idPull[pId]._h+this.idPull[pId]._step_h);};dhtmlXMenuObject.prototype._pEffectSet=function(pId,t){if(!this.idPull)return;if(this.idPull[pId]._tmShow)window.clearTimeout(this.idPull[pId]._tmShow);this.idPull[pId]._h=Math.max(0,Math.min(t,this.idPull[pId]._max_h));if(this._menuEffect.search(/slide/)===0)this.idPull[pId].style.height=this.idPull[pId]._h+"px";t+=this.idPull[pId]._step_h;if(this._menuEffect=="slide+"||this._menuEffect=="opacity"){this.idPull[pId]._op=Math.max(0,Math.min(this._pOpMax,this.idPull[pId]._op+this.idPull[pId].op_step));this._pOpacityApply(pId);}
if((this.idPull[pId]._step_h>0&&t<=this.idPull[pId]._max_h)||(this.idPull[pId]._step_h<0&&t>=0)){var k=this;this.idPull[pId]._tmShow=window.setTimeout(function(){k._pEffectSet(pId,t);},this.idPull[pId]._step_tm);}else{if(this._menuEffect.search(/slide/)===0)this.idPull[pId].style.height="";if(this.idPull[pId]._step_h<0)this.idPull[pId].style.visibility="hidden";if(this._menuEffect=="slide+"||this._menuEffect=="opacity"){this.idPull[pId]._op=(this.idPull[pId]._step_h<0?(this._pOpStyleIE?100:1):this._pOpMax);this._pOpacityApply(pId);}
this.idPull[pId]._tmShow=null;this.idPull[pId]._h=null;this.idPull[pId]._max_h=null;this.idPull[pId]._step_tm=null;}};function dhtmlXToolbarObject(base,skin){var main_self=this;this.conf={skin:(skin||window.dhx4.skin||(typeof(dhtmlx)!="undefined"?dhtmlx.skin:null)||window.dhx4.skinDetect("dhxtoolbar")||"material"),align:"left",align_autostart:"left",icons_path:"",icons_css:false,iconSize:18,sel_ofs_x:0,sel_ofs_y:0,xml_autoload:null,items_autoload:null,cssShadow:(dhx4.isIE6||dhx4.isIE7||dhx4.isIE8?"":" dhx_toolbar_shadow")}
if(typeof(base)=="object"&&base!=null&&typeof(base.tagName)=="undefined"){if(base.icons_path!=null||base.icon_path!=null)this.conf.icons_path=(base.icons_path||base.icon_path);if(base.icons_size!=null)this.conf.icons_size_autoload=base.icons_size;if(base.iconset!=null)this.conf.icons_css=(base.iconset=="awesome");if(base.json!=null)this.conf.json_autoload=base.json;if(base.xml!=null)this.conf.xml_autoload=base.xml;if(base.onload!=null)this.conf.onload_autoload=base.onload;if(base.onclick!=null||base.onClick!=null)this.conf.auto_onclick=(base.onclick||base.onClick);if(base.items!=null)this.conf.items_autoload=base.items;if(base.skin!=null)this.conf.skin=base.skin;if(base.align!=null)this.conf.align_autostart=base.align;base=base.parent;}
this.cont=(typeof(base)!="object")?document.getElementById(base):base;while(this.cont.childNodes.length>0)this.cont.removeChild(this.cont.childNodes[0]);base=null;this.cont.dir="ltr";this.base=document.createElement("DIV");this.base.className="dhxtoolbar_float_left";this.cont.appendChild(this.base);this.cont.ontouchstart=function(e){e=e||event;if((String(e.target.tagName||"").toLowerCase()=="input"))return true;if(e.preventDefault)e.preventDefault();else e.returnValue=false;e.cancelBubble=true;return false;}
this.setSkin(this.conf.skin);this.objPull={};this.anyUsed=null;this._genStr=function(w){var s="dhxId_";var z="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";for(var q=0;q<w;q++)s+=z.charAt(Math.round(Math.random()*(z.length-1)));return s;}
this.rootTypes=new Array("button","buttonSelect","buttonTwoState","separator","label","slider","text","buttonInput");this.idPrefix=this._genStr(12);window.dhx4._enableDataLoading(this,"_initObj","_xmlToJson","toolbar",{struct:true});window.dhx4._eventable(this);this._getObj=function(obj,tag){var targ=null;for(var q=0;q<obj.childNodes.length;q++){if(obj.childNodes[q].tagName!=null){if(String(obj.childNodes[q].tagName).toLowerCase()==String(tag).toLowerCase())targ=obj.childNodes[q];}}
return targ;}
this._addImgObj=function(obj){var imgObj=document.createElement(this.conf.icons_css==true?"I":"IMG");if(obj.childNodes.length>0)obj.insertBefore(imgObj,obj.childNodes[0]);else obj.appendChild(imgObj);return imgObj;}
this._setItemImage=function(item,url,dis){if(dis==true)item.imgEn=url;else item.imgDis=url;if((!item.state&&dis==true)||(item.state&&dis==false))return;if(this.conf.icons_css==true){var imgObj=this._getObj(item.obj,"i");if(imgObj==null)imgObj=this._addImgObj(item.obj);imgObj.className=this.conf.icons_path+url;}else{var imgObj=this._getObj(item.obj,"img");if(imgObj==null)imgObj=this._addImgObj(item.obj);imgObj.src=this.conf.icons_path+url;}}
this._clearItemImage=function(item,dis){if(dis==true)item.imgEn="";else item.imgDis="";if((!item.state&&dis==true)||(item.state&&dis==false))return;var imgObj=this._getObj(item.obj,(this.conf.icons_css?"i":"img"));if(imgObj!=null)imgObj.parentNode.removeChild(imgObj);}
this._setItemText=function(item,text){var txtObj=this._getObj(item.obj,"div");if(text==null||text.length==0){if(txtObj!=null)txtObj.parentNode.removeChild(txtObj);return;}
if(txtObj==null){txtObj=document.createElement("DIV");txtObj.className="dhxtoolbar_text";item.obj.appendChild(txtObj);}
txtObj.innerHTML=text;}
this._getItemText=function(item){var txtObj=this._getObj(item.obj,"div");if(txtObj!=null)return txtObj.innerHTML;return"";}
this._enableItem=function(item){if(item.state)return;item.state=true;if(this.objPull[item.id]["type"]=="buttonTwoState"&&this.objPull[item.id]["obj"]["pressed"]==true){item.obj.className="dhx_toolbar_btn dhxtoolbar_btn_pres";item.obj.renderAs="dhx_toolbar_btn dhxtoolbar_btn_over";}else{item.obj.className="dhx_toolbar_btn dhxtoolbar_btn_def";item.obj.renderAs=item.obj.className;}
if(item.arw)item.arw.className=String(item.obj.className).replace("btn","arw");var imgObj=this._getObj(item.obj,(this.conf.icons_css?"i":"img"));if(item.imgEn!=""){if(imgObj==null)imgObj=this._addImgObj(item.obj);imgObj[this.conf.icons_css?"className":"src"]=this.conf.icons_path+item.imgEn;}else{if(imgObj!=null)imgObj.parentNode.removeChild(imgObj);}}
this._disableItem=function(item){if(!item.state)return;item.state=false;item.obj.className="dhx_toolbar_btn dhxtoolbar_btn_"+(this.objPull[item.id]["type"]=="buttonTwoState"&&item.obj.pressed?"pres_":"")+"dis";item.obj.renderAs="dhx_toolbar_btn dhxtoolbar_btn_def";if(item.arw)item.arw.className=String(item.obj.className).replace("btn","arw");var imgObj=this._getObj(item.obj,(this.conf.icons_css?"i":"img"));if(item.imgDis!=""){if(imgObj==null)imgObj=this._addImgObj(item.obj);imgObj[this.conf.icons_css?"className":"src"]=this.conf.icons_path+item.imgDis;}else{if(imgObj!=null)imgObj.parentNode.removeChild(imgObj);}
if(item.polygon!=null){if(item.polygon.style.display!="none"){window.dhx4.zim.clear(item.polygon._idd);item.polygon.style.display="none";if(item.polygon._ie6cover)item.polygon._ie6cover.style.display="none";if(this.conf.skin=="dhx_terrace")this._improveTerraceButtonSelect(item.id,true);this.callEvent("onButtonSelectHide",[item.obj.idd]);}}
this.anyUsed=null;}
this.clearAll=function(){for(var a in this.objPull)this._removeItem(String(a).replace(this.idPrefix,""));}
this._doOnClick=function(e){if(main_self&&main_self.forEachItem){main_self.forEachItem(function(itemId){if(main_self.objPull[main_self.idPrefix+itemId].type=="buttonSelect"){var item=main_self.objPull[main_self.idPrefix+itemId];if(item.arw._skip===true){item.arw._skip=false;}else if(item.polygon.style.display!="none"){item.obj.renderAs="dhx_toolbar_btn dhxtoolbar_btn_def";item.obj.className=item.obj.renderAs;item.arw.className=String(item.obj.renderAs).replace("btn","arw");main_self.anyUsed=null;main_self.conf.touch_id=null;window.dhx4.zim.clear(item.polygon._idd);item.polygon.style.display="none";if(item.polygon._ie6cover)item.polygon._ie6cover.style.display="none";if(main_self.conf.skin=="dhx_terrace")main_self._improveTerraceButtonSelect(item.id,true);main_self.callEvent("onButtonSelectHide",[item.obj.idd]);}}});}}
if(typeof(window.addEventListener)!="undefined"){window.addEventListener("mousedown",this._doOnClick,false);window.addEventListener("touchstart",this._doOnClick,false);}else{document.body.attachEvent("onmousedown",this._doOnClick);}
if(this.conf.icons_size_autoload!=null){this.setIconSize(this.conf.icons_size_autoload);this.conf.icons_size_autoload=null;}
if(this.conf.items_autoload!=null){this.loadStruct(this.conf.items_autoload,this.conf.onload_autoload);this.conf.items_autoload=null;}else if(this.conf.json_autoload!=null){this.loadStruct(this.conf.json_autoload,this.conf.onload_autoload);this.conf.json_autoload=null;}else if(this.conf.xml_autoload!=null){this.loadStruct(this.conf.xml_autoload,this.conf.onload_autoload);this.conf.xml_autoload=null;}
if(this.conf.align_autostart!=this.conf.align){this.setAlign(this.conf.align_autostart);this.conf.align_autostart=null;}
if(typeof(this.conf.auto_onclick)=="function"){this.attachEvent("onClick",this.conf.auto_onclick);}else if(typeof(this.conf.auto_onclick)=="string"&&typeof(window[this.conf.auto_onclick])=="function"){this.attachEvent("onClick",window[this.conf.auto_onclick]);}
return this;}
dhtmlXToolbarObject.prototype.addSpacer=function(nextToId){var nti=this.idPrefix+nextToId;if(this._spacer!=null){if(this._spacer.idd==nextToId)return;if(this._spacer==this.objPull[nti].obj.parentNode){var doMove=true;while(doMove){var idd=this._spacer.childNodes[0].idd;this.base.appendChild(this._spacer.childNodes[0]);if(idd==nextToId||this._spacer.childNodes.length==0){if(this.objPull[nti].arw!=null)this.base.appendChild(this.objPull[nti].arw);doMove=false;}}
this._spacer.idd=nextToId;this._fixSpacer();return;}
if(this.base==this.objPull[nti].obj.parentNode){var doMove=true;var chArw=(this.objPull[nti].arw!=null);while(doMove){var q=this.base.childNodes.length-1;if(chArw==true)if(this.base.childNodes[q]==this.objPull[nti].arw)doMove=false;if(this.base.childNodes[q].idd==nextToId)doMove=false;if(doMove){if(this._spacer.childNodes.length>0)this._spacer.insertBefore(this.base.childNodes[q],this._spacer.childNodes[0]);else this._spacer.appendChild(this.base.childNodes[q]);}}
this._spacer.idd=nextToId;this._fixSpacer();return;}}else{var np=null;for(var q=0;q<this.base.childNodes.length;q++){if(this.base.childNodes[q]==this.objPull[this.idPrefix+nextToId].obj){np=q;if(this.objPull[this.idPrefix+nextToId].arw!=null)np=q+1;}}
if(np!=null){this._spacer=document.createElement("DIV");this._spacer.className=(this.conf.align=="right"?" dhxtoolbar_float_left":" dhxtoolbar_float_right");this._spacer.dir="ltr";this._spacer.idd=nextToId;while(this.base.childNodes.length>np+1)this._spacer.appendChild(this.base.childNodes[np+1]);this.cont.appendChild(this._spacer);this._fixSpacer();}}
if(this.conf.skin=="dhx_terrace")this._improveTerraceSkin();}
dhtmlXToolbarObject.prototype.removeSpacer=function(){if(!this._spacer)return;while(this._spacer.childNodes.length>0)this.base.appendChild(this._spacer.childNodes[0]);this._spacer.parentNode.removeChild(this._spacer);this._spacer=null;if(this.conf.skin=="dhx_terrace")this._improveTerraceSkin();}
dhtmlXToolbarObject.prototype._fixSpacer=function(){if(typeof(window.addEventListener)=="undefined"&&this._spacer!=null){this._spacer.style.borderLeft="1px solid #a4bed4";var k=this._spacer;window.setTimeout(function(){k.style.borderLeft="0px solid #a4bed4";k=null;},1);}}
dhtmlXToolbarObject.prototype.getType=function(itemId){var parentId=this.getParentId(itemId);if(parentId!=null){var typeExt=null;var itemData=this.objPull[this.idPrefix+parentId]._listOptions[itemId];if(itemData!=null)if(itemData.sep!=null)typeExt="buttonSelectSeparator";else typeExt="buttonSelectButton";return typeExt;}else{if(this.objPull[this.idPrefix+itemId]==null)return null;return this.objPull[this.idPrefix+itemId]["type"];}}
dhtmlXToolbarObject.prototype.getTypeExt=function(itemId){var type=this.getType(itemId);if(type=="buttonSelectButton"||type=="buttonSelectSeparator"){if(type=="buttonSelectButton")type="button";else type="separator";return type;}
return null;}
dhtmlXToolbarObject.prototype.inArray=function(array,value){for(var q=0;q<array.length;q++){if(array[q]==value)return true;}
return false;}
dhtmlXToolbarObject.prototype.getParentId=function(listId){var parentId=null;for(var a in this.objPull)if(this.objPull[a]._listOptions)for(var b in this.objPull[a]._listOptions)if(b==listId)parentId=String(a).replace(this.idPrefix,"");return parentId;}
dhtmlXToolbarObject.prototype._addItem=function(itemData,pos){if(typeof(itemData.text)=="string"){itemData.text=window.dhx4.trim(itemData.text);if(itemData.text.length==0)itemData.text=null;}
this._addItemToStorage(itemData,pos);if(this.conf.skin=="dhx_terrace")this._improveTerraceSkin();}
dhtmlXToolbarObject.prototype.addButton=function(id,pos,text,imgEnabled,imgDisabled){this._addItem({id:id,type:"button",text:text,img:imgEnabled,imgdis:imgDisabled},pos);}
dhtmlXToolbarObject.prototype.addText=function(id,pos,text){this._addItem({id:id,type:"text",text:text},pos);}
dhtmlXToolbarObject.prototype.addButtonSelect=function(id,pos,text,opts,imgEnabled,imgDisabled,renderSelect,openAll,maxOpen,mode){var options=[];for(var q=0;q<opts.length;q++){var u={};if(opts[q]instanceof Array){u.id=opts[q][0];u.type=(opts[q][1]=="obj"?"button":"separator");u.text=(opts[q][2]||null);u.img=(opts[q][3]||null);}else if(opts[q]instanceof Object&&opts[q]!=null&&typeof(opts[q].id)!="undefined"&&typeof(opts[q].type)!="undefined"){u.id=opts[q].id;u.type=(opts[q].type=="obj"?"button":"separator");u.text=opts[q].text;u.img=opts[q].img;}
options.push(u);}
this._addItem({id:id,type:"buttonSelect",text:text,img:imgEnabled,imgdis:imgDisabled,renderSelect:renderSelect,openAll:openAll,options:options,maxOpen:maxOpen,mode:mode},pos);}
dhtmlXToolbarObject.prototype.addButtonTwoState=function(id,pos,text,imgEnabled,imgDisabled){this._addItem({id:id,type:"buttonTwoState",img:imgEnabled,imgdis:imgDisabled,text:text},pos);}
dhtmlXToolbarObject.prototype.addSeparator=function(id,pos){this._addItem({id:id,type:"separator"},pos);}
dhtmlXToolbarObject.prototype.addSlider=function(id,pos,len,valueMin,valueMax,valueNow,textMin,textMax,tip){this._addItem({id:id,type:"slider",length:len,valueMin:valueMin,valueMax:valueMax,valueNow:valueNow,textMin:textMin,textMax:textMax,toolTip:tip},pos);}
dhtmlXToolbarObject.prototype.addInput=function(id,pos,value,width){this._addItem({id:id,type:"buttonInput",value:value,width:width},pos);}
dhtmlXToolbarObject.prototype.forEachItem=function(handler){for(var a in this.objPull){if(this.inArray(this.rootTypes,this.objPull[a]["type"])){handler(this.objPull[a]["id"].replace(this.idPrefix,""));}}};(function(){var list="isVisible,enableItem,disableItem,isEnabled,setItemText,getItemText,setItemToolTip,getItemToolTip,getInput,setItemImage,setItemImageDis,clearItemImage,clearItemImageDis,setItemState,getItemState,setItemToolTipTemplate,getItemToolTipTemplate,setValue,getValue,setMinValue,getMinValue,setMaxValue,getMaxValue,setWidth,getWidth,setMaxOpen".split(",")
var ret=[false,"","",false,"","","","","","","","","",false,"","","",null,"",[null,null],"",[null,null],"",null]
var functor=function(name,res){return function(itemId,a,b){itemId=this.idPrefix+itemId;if(this.objPull[itemId][name]!=null)return this.objPull[itemId][name].call(this.objPull[itemId],a,b);else return res;};}
for(var i=0;i<list.length;i++){var name=list[i];var res=ret[i];dhtmlXToolbarObject.prototype[name]=functor(name,res);}})();dhtmlXToolbarObject.prototype.showItem=function(itemId){itemId=this.idPrefix+itemId;if(this.objPull[itemId]!=null&&this.objPull[itemId].showItem!=null){this.objPull[itemId].showItem();if(this.conf.skin=="dhx_terrace")this._improveTerraceSkin();}}
dhtmlXToolbarObject.prototype.hideItem=function(itemId){itemId=this.idPrefix+itemId;if(this.objPull[itemId]!=null&&this.objPull[itemId].hideItem!=null){this.objPull[itemId].hideItem();if(this.conf.skin=="dhx_terrace")this._improveTerraceSkin();}}
dhtmlXToolbarObject.prototype.getPosition=function(itemId){return this._getPosition(itemId);}
dhtmlXToolbarObject.prototype._getPosition=function(id,getRealPosition){if(this.objPull[this.idPrefix+id]==null)return null;var pos=null;var w=0;for(var q=0;q<this.base.childNodes.length;q++){if(this.base.childNodes[q].idd!=null){if(this.base.childNodes[q].idd==id)pos=w;w++;}}
if(!pos&&this._spacer!=null){for(var q=0;q<this._spacer.childNodes.length;q++){if(this._spacer.childNodes[q].idd!=null){if(this._spacer.childNodes[q].idd==id)pos=w;w++;}}}
return pos;}
dhtmlXToolbarObject.prototype.setPosition=function(itemId,pos){this._setPosition(itemId,pos);}
dhtmlXToolbarObject.prototype._setPosition=function(id,pos){if(this.objPull[this.idPrefix+id]==null)return;var spacerId=null;if(this._spacer){spacerId=this._spacer.idd;this.removeSpacer();}
if(isNaN(pos))pos=this.base.childNodes.length;if(pos<0)pos=0;var item=this.objPull[this.idPrefix+id];this.base.removeChild(item.obj);if(item.arw)this.base.removeChild(item.arw);var newPos=this._getIdByPosition(pos,true);if(newPos[0]==null){this.base.appendChild(item.obj);if(item.arw)this.base.appendChild(item.arw);}else{this.base.insertBefore(item.obj,this.base.childNodes[newPos[1]]);if(item.arw)this.base.insertBefore(item.arw,this.base.childNodes[newPos[1]+1]);}
if(spacerId!=null)this.addSpacer(spacerId);}
dhtmlXToolbarObject.prototype._getIdByPosition=function(pos,retRealPos){var id=null;var w=0;var realPos=0;for(var q=0;q<this.base.childNodes.length;q++){if(this.base.childNodes[q]["idd"]!=null&&id==null){if((w++)==pos)id=this.base.childNodes[q]["idd"];}
if(id==null)realPos++;}
realPos=(id==null?null:realPos);return(retRealPos==true?new Array(id,realPos):id);}
dhtmlXToolbarObject.prototype.removeItem=function(itemId){this._removeItem(itemId);if(this.conf.skin=="dhx_terrace")this._improveTerraceSkin();};dhtmlXToolbarObject.prototype._removeItem=function(itemId){var t=this.getType(itemId);itemId=this.idPrefix+itemId;var p=this.objPull[itemId];if({button:1,buttonTwoState:1}[t]==1){if(window.dhx4.isIE)p.obj.onselectstart=null;this._evs.clear.apply(p,[p.obj.evs,p.obj]);for(var a in p.obj)if(typeof(p.obj[a])=="function")p.obj[a]=null;p.obj.parentNode.removeChild(p.obj);p.obj=null;for(var a in p)p[a]=null;}
if(t=="buttonSelect"){for(var a in p._listOptions)this.removeListOption(itemId,a);p._listOptions=null;if(p.polygon._ie6cover){document.body.removeChild(p.polygon._ie6cover);p.polygon._ie6cover=null;}
p.p_tbl.removeChild(p.p_tbody);p.polygon.removeChild(p.p_tbl);p.polygon.onselectstart=null;document.body.removeChild(p.polygon);if(window.dhx4.isIE){p.obj.onselectstart=null;p.arw.onselectstart=null;}
this._evs.clear.apply(p,[p.obj.evs,p.obj]);this._evs.clear.apply(p,[p.arw.evs,p.arw]);for(var a in p.obj)if(typeof(p.obj[a])=="function")p.obj[a]=null;p.obj.parentNode.removeChild(p.obj);p.obj=null;for(var a in p.arw)if(typeof(p.arw[a])=="function")p.arw[a]=null;p.arw.parentNode.removeChild(p.arw);p.arw=null;for(var a in p)p[a]=null;}
if(t=="buttonInput"){p.obj.childNodes[0].onkeydown=null;p.obj.removeChild(p.obj.childNodes[0]);p.obj.w=null;p.obj.idd=null;p.obj.parentNode.removeChild(p.obj);p.obj=null;p.id=null;p.type=null;p.enableItem=null;p.disableItem=null;p.isEnabled=null;p.showItem=null;p.hideItem=null;p.isVisible=null;p.setItemToolTip=null;p.getItemToolTip=null;p.setWidth=null;p.getWidth=null;p.setValue=null;p.getValue=null;p.setItemText=null;p.getItemText=null;}
if(t=="slider"){if(window.dhx4.isIPad){document.removeEventListener("touchmove",pen._doOnMouseMoveStart,false);document.removeEventListener("touchend",pen._doOnMouseMoveEnd,false);}else{if(typeof(window.addEventListener)=="function"){window.removeEventListener("mousemove",p.pen._doOnMouseMoveStart,false);window.removeEventListener("mouseup",p.pen._doOnMouseMoveEnd,false);}else{document.body.detachEvent("onmousemove",p.pen._doOnMouseMoveStart);document.body.detachEvent("onmouseup",p.pen._doOnMouseMoveEnd);}}
p.pen.allowMove=null;p.pen.initXY=null;p.pen.maxX=null;p.pen.minX=null;p.pen.nowX=null;p.pen.newNowX=null;p.pen.valueMax=null;p.pen.valueMin=null;p.pen.valueNow=null;p.pen._definePos=null;p.pen._detectLimits=null;p.pen._doOnMouseMoveStart=null;p.pen._doOnMouseMoveEnd=null;p.pen.onmousedown=null;p.obj.removeChild(p.pen);p.pen=null;p.label.tip=null;document.body.removeChild(p.label);p.label=null;p.obj.onselectstart=null;p.obj.idd=null;while(p.obj.childNodes.length>0)p.obj.removeChild(p.obj.childNodes[0]);p.obj.parentNode.removeChild(p.obj);p.obj=null;p.id=null;p.type=null;p.state=null;p.enableItem=null;p.disableItem=null;p.isEnabled=null;p.setItemToolTipTemplate=null;p.getItemToolTipTemplate=null;p.setMaxValue=null;p.setMinValue=null;p.getMaxValue=null;p.getMinValue=null;p.setValue=null;p.getValue=null;p.showItem=null;p.hideItem=null;p.isVisible=null;}
if(t=="separator"){p.obj.onselectstart=null;p.obj.idd=null;p.obj.parentNode.removeChild(p.obj);p.obj=null;p.id=null;p.type=null;p.showItem=null;p.hideItem=null;p.isVisible=null;}
if(t=="text"){p.obj.onselectstart=null;p.obj.idd=null;p.obj.parentNode.removeChild(p.obj);p.obj=null;p.id=null;p.type=null;p.showItem=null;p.hideItem=null;p.isVisible=null;p.setWidth=null;p.setItemText=null;p.getItemText=null;}
t=null;p=null;this.objPull[this.idPrefix+itemId]=null;delete this.objPull[this.idPrefix+itemId];};(function(){var list="addListOption,removeListOption,showListOption,hideListOption,isListOptionVisible,enableListOption,disableListOption,isListOptionEnabled,setListOptionPosition,getListOptionPosition,setListOptionText,getListOptionText,setListOptionToolTip,getListOptionToolTip,setListOptionImage,getListOptionImage,clearListOptionImage,forEachListOption,getAllListOptions,setListOptionSelected,getListOptionSelected".split(",")
var functor=function(name){return function(parentId,a,b,c,d,e){parentId=this.idPrefix+parentId;if(this.objPull[parentId]==null)return;if(this.objPull[parentId]["type"]!="buttonSelect")return;return this.objPull[parentId][name].call(this.objPull[parentId],a,b,c,d,e);}}
for(var i=0;i<list.length;i++){var name=list[i];dhtmlXToolbarObject.prototype[name]=functor(name)}})();dhtmlXToolbarObject.prototype._rtlParseBtn=function(t1,t2){return t1+t2;}
dhtmlXToolbarObject.prototype._separatorObject=function(that,id,data){this.id=that.idPrefix+id;this.obj=document.createElement("DIV");this.obj.className="dhx_toolbar_sep";this.obj.style.display=(data.hidden!=null?"none":"");this.obj.idd=String(id);this.obj.title=(data.title||"");this.obj.onselectstart=function(e){e=e||event;if(e.preventDefault)e.preventDefault();else e.returnValue=false;}
this.obj.ontouchstart=function(e){e=e||event;if(e.preventDefault)e.preventDefault();else e.returnValue=false;e.cancelBubble=true;return false;}
that.base.appendChild(this.obj);this.showItem=function(){this.obj.style.display="";}
this.hideItem=function(){this.obj.style.display="none";}
this.isVisible=function(){return(this.obj.style.display=="");}
return this;}
dhtmlXToolbarObject.prototype._textObject=function(that,id,data){this.id=that.idPrefix+id;this.obj=document.createElement("DIV");this.obj.className="dhx_toolbar_text";this.obj.style.display=(data.hidden!=null?"none":"");this.obj.idd=String(id);this.obj.title=(data.title||"");this.obj.onselectstart=function(e){e=e||event;if(e.preventDefault)e.preventDefault();else e.returnValue=false;}
this.obj.ontouchstart=function(e){e=e||event;if(e.preventDefault)e.preventDefault();else e.returnValue=false;e.cancelBubble=true;return false;}
this.obj.innerHTML=(data.text||"");that.base.appendChild(this.obj);this.showItem=function(){this.obj.style.display="";}
this.hideItem=function(){this.obj.style.display="none";}
this.isVisible=function(){return(this.obj.style.display=="");}
this.setItemText=function(text){this.obj.innerHTML=text;}
this.getItemText=function(){return this.obj.innerHTML;}
this.setWidth=function(width){this.obj.style.width=width+"px";}
this.setItemToolTip=function(t){this.obj.title=t;}
this.getItemToolTip=function(){return this.obj.title;}
return this;}
dhtmlXToolbarObject.prototype._buttonObject=function(that,id,data){this.id=that.idPrefix+id;this.state=(data.enabled!=null?false:true);this.imgEn=(data.img||"");this.imgDis=(data.imgdis||"");this.img=(this.state?(this.imgEn!=""?this.imgEn:""):(this.imgDis!=""?this.imgDis:""));this.obj=document.createElement("DIV");this.obj.className="dhx_toolbar_btn dhxtoolbar_btn_"+(this.state?"def":"dis");this.obj.style.display=(data.hidden!=null?"none":"");this.obj.allowClick=false;this.obj.extAction=(data.action||null);this.obj.renderAs=this.obj.className;this.obj.idd=String(id);this.obj.title=(data.title||"");this.obj.pressed=false;var img=(that.conf.icons_css?"<i class='"+that.conf.icons_path+this.img+"'></i>":"<img src='"+that.conf.icons_path+this.img+"'>");this.obj.innerHTML=that._rtlParseBtn((this.img!=""?img:""),(data.text!=null?"<div class='dhxtoolbar_text'>"+data.text+"</div>":""));that.base.appendChild(this.obj);if(window.dhx4.isIE){this.obj.onselectstart=function(e){e=e||event;if(e.preventDefault)e.preventDefault();else e.returnValue=false;return false;}}
var t=this;this._doOnMouseOver=function(e){e=e||event;if(t.state==false||t.obj.pressed==true||t.obj.over==true)return;if(t.obj.className.match(/dhxtoolbar_btn_over/gi)==null)t.obj.className="dhx_toolbar_btn dhxtoolbar_btn_over";t.obj.over=true;}
this._doOnMouseOut=function(e){e=e||event;if(t.state==false)return;if(t.obj.className.match(/dhxtoolbar_btn_over/gi)!=null)t.obj.className="dhx_toolbar_btn dhxtoolbar_btn_def";t.obj.over=t.obj.pressed=false;}
this._doOnMouseDown=function(e){e=e||event;if(e.type=="touchstart"){if(e.preventDefault)e.preventDefault();e.cancelBubble=true;if(that.conf.touch_id!=null&&that.conf.touch_id!=t.id)return;that.conf.touch_id=t.id;}
if(t.state==false)return;if(t.obj.className.match(/dhxtoolbar_btn_pres/gi)==null)t.obj.className="dhx_toolbar_btn dhxtoolbar_btn_pres";t.obj.pressed=true;}
this._doOnMouseUp=function(e){e=e||event;if(e.type=="touchend"){if(e.preventDefault)e.preventDefault();e.cancelBubble=true;if(that.conf.touch_id==t.id)that.conf.touch_id=null;}
if(t.state==false||t.obj.pressed==false)return;if(t.obj.className.match(/dhxtoolbar_btn_pres/gi)!=null)t.obj.className="dhx_toolbar_btn dhxtoolbar_btn_"+(t.obj.over?"over":"def");t.obj.pressed=false;if(t.obj.extAction){window.setTimeout(function(){try{if(t&&t.obj)window[t.obj.extAction](t.id);}catch(e){}},1);}
that.callEvent("onClick",[t.obj.idd.replace(that.idPrefix,"")]);}
this.obj.evs={mouseover:"_doOnMouseOver",mouseout:"_doOnMouseOut",mousedown:"_doOnMouseDown",mouseup:"_doOnMouseUp",touchstart:"_doOnMouseDown",touchend:"_doOnMouseUp"};that._evs.add.apply(this,[this.obj.evs,this.obj]);this.enableItem=function(){that._enableItem(this);}
this.disableItem=function(){that._disableItem(this);}
this.isEnabled=function(){return this.state;}
this.showItem=function(){this.obj.style.display="";}
this.hideItem=function(){this.obj.style.display="none";}
this.isVisible=function(){return(this.obj.style.display=="");}
this.setItemText=function(text){that._setItemText(this,text);}
this.getItemText=function(){return that._getItemText(this);}
this.setItemImage=function(url){that._setItemImage(this,url,true);}
this.clearItemImage=function(){that._clearItemImage(this,true);}
this.setItemImageDis=function(url){that._setItemImage(this,url,false);}
this.clearItemImageDis=function(){that._clearItemImage(this,false);}
this.setItemToolTip=function(tip){this.obj.title=tip;}
this.getItemToolTip=function(){return this.obj.title;}
return this;}
dhtmlXToolbarObject.prototype._buttonSelectObject=function(that,id,data){this.id=that.idPrefix+id;this.state=(data.enabled!=null?(data.enabled=="true"?true:false):true);this.imgEn=(data.img||"");this.imgDis=(data.imgdis||"");this.img=(this.state?(this.imgEn!=""?this.imgEn:""):(this.imgDis!=""?this.imgDis:""));this.mode=(data.mode||"button");if(this.mode=="select"){this.openAll=true;this.renderSelect=false;if(!data.text||data.text.length==0)data.text="&nbsp;"}else{this.openAll=(window.dhx4.s2b(data.openAll)==true);this.renderSelect=(data.renderSelect==null?true:window.dhx4.s2b(data.renderSelect));}
this.maxOpen=(!isNaN(data.maxOpen?data.maxOpen:"")?data.maxOpen:null);this._maxOpenTest=function(){if(!isNaN(this.maxOpen)){if(!that._sbw){var t=document.createElement("DIV");t.className="dhxtoolbar_maxopen_test";document.body.appendChild(t);var k=document.createElement("DIV");k.className="dhxtoolbar_maxopen_test2";t.appendChild(k);that._sbw=t.offsetWidth-k.offsetWidth;t.removeChild(k);k=null;document.body.removeChild(t);t=null;}}}
this._maxOpenTest();this.obj=document.createElement("DIV");this.obj.allowClick=false;this.obj.extAction=(data.action||null);this.obj.className="dhx_toolbar_btn dhxtoolbar_btn_"+(this.state?"def":"dis");this.obj.style.display=(data.hidden!=null?"none":"");this.obj.renderAs=this.obj.className;this.obj.onselectstart=function(e){e=e||event;if(e.preventDefault)e.preventDefault();else e.returnValue=false;}
this.obj.idd=String(id);this.obj.title=(data.title||"");this.obj.pressed=false;this.callEvent=false;var img=(that.conf.icons_css?"<i class='"+that.conf.icons_path+this.img+"'></i>":"<img src='"+that.conf.icons_path+this.img+"'>");this.obj.innerHTML=that._rtlParseBtn((this.img!=""?img:""),(data.text!=null?"<div class='dhxtoolbar_text'>"+data.text+"</div>":""));that.base.appendChild(this.obj);this.arw=document.createElement("DIV");this.arw.className="dhx_toolbar_arw dhxtoolbar_btn_"+(this.state?"def":"dis");this.arw.style.display=this.obj.style.display;this.arw.innerHTML="<div class='arwimg'>&nbsp;</div>";this.arw.title=this.obj.title;this.arw.onselectstart=function(e){e=e||event;if(e.preventDefault)e.preventDefault();else e.returnValue=false;}
that.base.appendChild(this.arw);var self=this;if(window.dhx4.isIE){this.arw.onselectstart=this.obj.onselectstart=function(e){e=e||event;if(e.preventDefault)e.preventDefault();else e.returnValue=false;return false;}}
this._doOnMouseOver=function(e){e=e||event;if(self.state==false||self.obj.over==true||that.anyUsed==self.obj.idd)return;if(self.obj.className.match(/dhxtoolbar_btn_over/gi)==null){self.obj.className="dhx_toolbar_btn dhxtoolbar_btn_over";self.arw.className="dhx_toolbar_arw dhxtoolbar_btn_over";}
self.obj.over=true;}
this._doOnMouseOut=function(e){e=e||event;if(self.state==false||that.anyUsed==self.obj.idd||that.anyUsed==self.obj.idd)return;if(self.obj.className.match(/dhxtoolbar_btn_over/gi)!=null){self.obj.className="dhx_toolbar_btn dhxtoolbar_btn_def";self.arw.className="dhx_toolbar_arw dhxtoolbar_btn_def";}
self.obj.over=self.obj.pressed=false;}
this._doOnMouseDown=function(e){e=e||event;if(e.type=="touchstart"){if(e.preventDefault)e.preventDefault();e.cancelBubble=true;if(that.conf.touch_id!=null&&that.conf.touch_id!=self.id)return;that.conf.touch_id=self.id;}
if(self.state==false)return;if(that.anyUsed==self.obj.idd){if(self.obj.over==true){self.obj.className="dhx_toolbar_btn dhxtoolbar_btn_over";self.arw.className="dhx_toolbar_arw dhxtoolbar_btn_over";}else{self.obj.className="dhx_toolbar_btn dhxtoolbar_btn_def";self.arw.className="dhx_toolbar_arw dhxtoolbar_btn_def";}
self._hidePoly(true);that.anyUsed=null;}else{var node=(e.target||e.srcElement);if(self.openAll==true||node==self.arw||node.parentNode==self.arw){if(e.type=="touchstart")self.obj.className="dhx_toolbar_btn dhxtoolbar_btn_over";self.arw.className="dhx_toolbar_arw dhxtoolbar_btn_pres";self.arw._skip=true;self._showPoly(true);that.anyUsed=self.obj.idd;}else{if(self.obj.className.match(/dhxtoolbar_btn_pres/gi)==null){self.obj.className="dhx_toolbar_btn dhxtoolbar_btn_pres";self.arw.className="dhx_toolbar_arw dhxtoolbar_btn_pres";}
self.obj.pressed=true;}}}
this._doOnMouseUp=function(e){e=e||event;if(e.type=="touchend"){if(self.polygon.style.display=="")return;if(e.preventDefault)e.preventDefault();e.cancelBubble=true;if(that.conf.touch_id==self.id)that.conf.touch_id=null;}
if(self.state==false||self.obj.pressed==false)return;if(self.obj.className.match(/dhxtoolbar_btn_pres/gi)!=null){self.obj.className="dhx_toolbar_btn dhxtoolbar_btn_"+(self.obj.over?"over":"def");self.arw.className="dhx_toolbar_arw dhxtoolbar_btn_"+(self.obj.over?"over":"def");}
if(this.extAction){var k=this;window.setTimeout(function(){try{window[k.extAction](id);}catch(e){};k=null;},1);}
that.callEvent("onClick",[self.obj.idd.replace(that.idPrefix,"")]);}
this.arw.evs={mouseover:"_doOnMouseOver",mouseout:"_doOnMouseOut",mousedown:"_doOnMouseDown",touchstart:"_doOnMouseDown"};that._evs.add.apply(this,[this.arw.evs,this.arw]);this.obj.evs={mouseover:"_doOnMouseOver",mouseout:"_doOnMouseOut",mousedown:"_doOnMouseDown",mouseup:"_doOnMouseUp",touchstart:"_doOnMouseDown",touchend:"_doOnMouseUp"};that._evs.add.apply(this,[this.obj.evs,this.obj]);this._showPoly=function(callEvent){if(that.anyUsed!=null){if(that.objPull[that.idPrefix+that.anyUsed].type=="buttonSelect"){var item=that.objPull[that.idPrefix+that.anyUsed];if(item.polygon.style.display!="none"){item.obj.className="dhx_toolbar_btn dhxtoolbar_btn_def";item.arw.className="dhx_toolbar_arw dhxtoolbar_btn_def";item.obj.over=false;window.dhx4.zim.clear(item.polygon._idd);item.polygon.style.display="none";if(item.polygon._ie6cover)item.polygon._ie6cover.style.display="none";if(that.conf.skin=="dhx_terrace")that._improveTerraceButtonSelect(item.id,true);that.callEvent("onButtonSelectHide",[item.obj.idd]);}}}
this.polygon.style.top="0px";this.polygon.style.visibility="hidden";this.polygon.style.zIndex=window.dhx4.zim.reserve(this.polygon._idd);this.polygon.style.display="";if(that.conf.skin=="dhx_terrace")that._improveTerraceButtonSelect(this.id,false);this._fixMaxOpenHeight(this.maxOpen||null);that._autoDetectVisibleArea();var newTop=window.dhx4.absTop(this.obj)+this.obj.offsetHeight+that.conf.sel_ofs_y;var newH=this.polygon.offsetHeight;if(newTop+newH>that.tY2){var k0=(this.maxOpen!=null?Math.floor((that.tY2-newTop)/22):0);if(k0>=1){this._fixMaxOpenHeight(k0);}else{newTop=window.dhx4.absTop(this.obj)-newH-that.conf.sel_ofs_y;if(newTop<0)newTop=0;}}
this.polygon.style.top=newTop+"px";if(that.rtl){this.polygon.style.left=window.dhx4.absLeft(this.obj)+this.obj.offsetWidth-this.polygon.offsetWidth+that.conf.sel_ofs_x+"px";}else{var x1=document.body.scrollLeft;var x2=x1+(window.innerWidth||document.body.clientWidth);var newLeft=window.dhx4.absLeft(this.obj)+that.conf.sel_ofs_x;if(newLeft+this.polygon.offsetWidth>x2)newLeft=window.dhx4.absLeft(this.arw)+this.arw.offsetWidth-this.polygon.offsetWidth;this.polygon.style.left=Math.max(newLeft,5)+"px";}
this.polygon.style.visibility="visible";if(this.polygon._ie6cover){this.polygon._ie6cover.style.left=this.polygon.style.left;this.polygon._ie6cover.style.top=this.polygon.style.top;this.polygon._ie6cover.style.width=this.polygon.offsetWidth+"px";this.polygon._ie6cover.style.height=this.polygon.offsetHeight+"px";this.polygon._ie6cover.style.display="";}
if(callEvent)that.callEvent("onButtonSelectShow",[this.obj.idd]);}
this._hidePoly=function(callEvent){window.dhx4.zim.clear(this.polygon._idd);this.polygon.style.display="none";if(this.polygon._ie6cover)this.polygon._ie6cover.style.display="none";if(that.conf.skin=="dhx_terrace")that._improveTerraceButtonSelect(this.id,true);if(callEvent)that.callEvent("onButtonSelectHide",[this.obj.idd]);that.conf.touch_id=null;}
this.obj.iddPrefix=that.idPrefix;this._listOptions={};this._fixMaxOpenHeight=function(maxOpen){var h="auto";var h0=false;if(maxOpen!==null){var t=0;for(var a in this._listOptions)t++;if(t>maxOpen){this._ph=22*maxOpen;h=this._ph+"px";}else{h0=true;}}
this.polygon.style.width="auto";this.polygon.style.height="auto";if(!h0&&self.maxOpen!=null){this.polygon.style.width=this.p_tbl.offsetWidth+that._sbw+"px";this.polygon.style.height=h;}}
this._separatorButtonSelectObject=function(id,data,pos){this.obj={};this.obj.tr=document.createElement("TR");this.obj.tr.className="tr_sep";this.obj.tr.onselectstart=function(e){e=e||event;if(e.preventDefault)e.preventDefault();else e.returnValue=false;return false;}
this.obj.td=document.createElement("TD");this.obj.td.colSpan="2";this.obj.td.className="td_btn_sep";this.obj.td.onselectstart=function(e){e=e||event;if(e.preventDefault)e.preventDefault();else e.returnValue=false;return false;}
if(isNaN(pos))pos=self.p_tbody.childNodes.length+1;else if(pos<1)pos=1;if(pos>self.p_tbody.childNodes.length)self.p_tbody.appendChild(this.obj.tr);else self.p_tbody.insertBefore(this.obj.tr,self.p_tbody.childNodes[pos-1]);this.obj.tr.appendChild(this.obj.td);this.obj.sep=document.createElement("DIV");this.obj.sep.className="btn_sep";this.obj.sep.onselectstart=function(e){e=e||event;if(e.preventDefault)e.preventDefault();else e.returnValue=false;return false;}
this.obj.td.appendChild(this.obj.sep);self._listOptions[id]=this.obj;return this;}
this._buttonButtonSelectObject=function(id,data,pos){var en=true;if(typeof(data.enabled)!="undefined"){en=window.dhx4.s2b(data.enabled);}else if(typeof(data.disabled)!="undefined"){en=window.dhx4.s2b(data.disabled);}
this.obj={};this.obj.tr=document.createElement("TR");this.obj.tr.en=en;this.obj.tr.extAction=(data.action||null);this.obj.tr._selected=(data.selected!=null);this.obj.tr.className="tr_btn"+(this.obj.tr.en?(this.obj.tr._selected&&self.renderSelect?" tr_btn_selected":""):" tr_btn_disabled");this.obj.tr.onselectstart=function(e){e=e||event;if(e.preventDefault)e.preventDefault();else e.returnValue=false;return false;}
this.obj.tr.idd=String(id);if(isNaN(pos))pos=self.p_tbody.childNodes.length+1;else if(pos<1)pos=1;if(pos>self.p_tbody.childNodes.length)self.p_tbody.appendChild(this.obj.tr);else self.p_tbody.insertBefore(this.obj.tr,self.p_tbody.childNodes[pos-1]);this.obj.td_a=document.createElement("TD");this.obj.td_a.className="td_btn_img";this.obj.td_a.onselectstart=function(e){e=e||event;if(e.preventDefault)e.preventDefault();else e.returnValue=false;return false;}
this.obj.td_b=document.createElement("TD");this.obj.td_b.className="td_btn_txt";this.obj.td_b.onselectstart=function(e){e=e||event;if(e.preventDefault)e.preventDefault();else e.returnValue=false;return false;}
if(that.rtl){this.obj.tr.appendChild(this.obj.td_b);this.obj.tr.appendChild(this.obj.td_a);}else{this.obj.tr.appendChild(this.obj.td_a);this.obj.tr.appendChild(this.obj.td_b);}
if(data.img!=null){if(that.conf.icons_css==true){this.obj.td_a.innerHTML="<i class='"+that.conf.icons_path+data.img+"'></i>";}else{this.obj.td_a.innerHTML="<img class='btn_sel_img' src='"+that.conf.icons_path+data.img+"' border='0'>";}
this.obj.tr._img=data.img;}else{this.obj.td_a.innerHTML="&nbsp;";}
var itemText=(data.text!=null?data.text:(data.itemText||""));this.obj.td_b.innerHTML="<div class='btn_sel_text'>"+itemText+"</div>";this.obj.tr.onmouseover=function(e){e=e||event;if(e.type.match(/touch/)!=null)return;if(!this.en||(this._selected&&self.renderSelect))return;this.className="tr_btn tr_btn_over";}
this.obj.tr.onmouseout=function(e){e=e||event;if(e.type.match(/touch/)!=null)return;if(!this.en)return;if(this._selected&&self.renderSelect){if(String(this.className).search("tr_btn_selected")==-1)this.className="tr_btn tr_btn_selected";}else{this.className="tr_btn";}}
this.obj.tr.ontouchstart=this.obj.tr.onmousedown=function(e){e=e||event;if(this._etype==null)this._etype=e.type;}
this.obj.tr.onclick=function(e){e=e||event;e.cancelBubble=true;if(!this.en)return;self.setListOptionSelected(this.idd.replace(that.idPrefix,""));self.obj.className="dhx_toolbar_btn dhxtoolbar_btn_def";self.arw.className="dhx_toolbar_arw dhxtoolbar_btn_def";self.obj.over=false;if(this._etype!=null&&this._etype.match(/touch/)==null){window.dhx4.zim.clear(self.polygon._idd);self.polygon.style.display="none";if(self.polygon._ie6cover)self.polygon._ie6cover.style.display="none";}else{var p=self.polygon;window.setTimeout(function(){window.dhx4.zim.clear(p._idd);p.style.display="none";p=null;},500);}
this._etype=null;if(that.conf.skin=="dhx_terrace")that._improveTerraceButtonSelect(self.id,true);that.anyUsed=null;that.conf.touch_id=null;that.callEvent("onButtonSelectHide",[self.obj.idd]);var id=this.idd.replace(that.idPrefix,"");if(this.extAction)try{window[this.extAction](id);}catch(e){};that.callEvent("onClick",[id]);}
self._listOptions[id]=this.obj;return this;}
this.polygon=document.createElement("DIV");this.polygon.dir="ltr";this.polygon.style.display="none";this.polygon.className="dhx_toolbar_poly_"+that.conf.skin+" dhxtoolbar_icons_"+that.conf.iconSize+that.conf.cssShadow;this.polygon.onselectstart=function(e){e=e||event;if(e.preventDefault)e.preventDefault();else e.returnValue=false;}
this.polygon.onmousedown=function(e){e=e||event;e.cancelBubble=true;}
this.polygon.style.overflowY="auto";this.polygon._idd=window.dhx4.newId();this.polygon.ontouchstart=function(e){e=e||event;e.cancelBubble=true;}
this.polygon.ontouchend=function(e){e=e||event;e.cancelBubble=true;}
this.p_tbl=document.createElement("TABLE");this.p_tbl.className="buttons_cont";this.p_tbl.cellSpacing="0";this.p_tbl.cellPadding="0";this.p_tbl.border="0";this.polygon.appendChild(this.p_tbl);this.p_tbody=document.createElement("TBODY");this.p_tbl.appendChild(this.p_tbody);if(data.options!=null){for(var q=0;q<data.options.length;q++){var t="_"+(data.options[q].type||"")+"ButtonSelectObject";if(data.options[q].id==null)data.options[q].id=that._genStr(24);if(typeof(this[t])=="function")new this[t](data.options[q].id,data.options[q]);}}
document.body.appendChild(this.polygon);if(window.dhx4.isIE6){this.polygon._ie6cover=document.createElement("IFRAME");this.polygon._ie6cover.frameBorder=0;this.polygon._ie6cover.style.position="absolute";this.polygon._ie6cover.style.border="none";this.polygon._ie6cover.style.backgroundColor="#000000";this.polygon._ie6cover.style.filter="alpha(opacity=100)";this.polygon._ie6cover.style.display="none";this.polygon._ie6cover.setAttribute("src","javascript:false;");document.body.appendChild(this.polygon._ie6cover);}
this.setWidth=function(width){this.obj.style.width=width-this.arw.offsetWidth+"px";this.polygon.style.width=this.obj.offsetWidth+this.arw.offsetWidth-2+"px";this.p_tbl.style.width=this.polygon.style.width;}
this.enableItem=function(){that._enableItem(this);}
this.disableItem=function(){that._disableItem(this);}
this.isEnabled=function(){return this.state;}
this.showItem=function(){this.obj.style.display="";this.arw.style.display="";}
this.hideItem=function(){this.obj.style.display="none";this.arw.style.display="none";}
this.isVisible=function(){return(this.obj.style.display=="");}
this.setItemText=function(text){that._setItemText(this,text);}
this.getItemText=function(){return that._getItemText(this);}
this.setItemImage=function(url){that._setItemImage(this,url,true);}
this.clearItemImage=function(){that._clearItemImage(this,true);}
this.setItemImageDis=function(url){that._setItemImage(this,url,false);}
this.clearItemImageDis=function(){that._clearItemImage(this,false);}
this.setItemToolTip=function(tip){this.obj.title=tip;this.arw.title=tip;}
this.getItemToolTip=function(){return this.obj.title;}
this.addListOption=function(id,pos,type,text,img){if(!(type=="button"||type=="separator"))return;var dataItem={id:id,type:type,text:text,img:img};new this["_"+type+"ButtonSelectObject"](id,dataItem,pos);}
this.removeListOption=function(id){if(!this._isListButton(id,true))return;var item=this._listOptions[id];if(item.td_a!=null&&item.td_b!=null){item.td_a.onselectstart=null;item.td_b.onselectstart=null;while(item.td_a.childNodes.length>0)item.td_a.removeChild(item.td_a.childNodes[0]);while(item.td_b.childNodes.length>0)item.td_b.removeChild(item.td_b.childNodes[0]);item.tr.onselectstart=null;item.tr.onmouseover=null;item.tr.onmouseout=null;item.tr.onclick=null;item.tr.ontouchstart=null;item.tr.onmousedown=null;while(item.tr.childNodes.length>0)item.tr.removeChild(item.tr.childNodes[0]);item.tr.parentNode.removeChild(item.tr);item.td_a=null;item.td_b=null;item.tr=null;}else{item.sep.onselectstart=null;item.td.onselectstart=null;item.tr.onselectstart=null;while(item.td.childNodes.length>0)item.td.removeChild(item.td.childNodes[0]);while(item.tr.childNodes.length>0)item.tr.removeChild(item.tr.childNodes[0]);item.tr.parentNode.removeChild(item.tr);item.sep=null;item.td=null;item.tr=null;}
item=null;this._listOptions[id]=null;try{delete this._listOptions[id];}catch(e){}}
this.showListOption=function(id){if(!this._isListButton(id,true))return;this._listOptions[id].tr.style.display="";}
this.hideListOption=function(id){if(!this._isListButton(id,true))return;this._listOptions[id].tr.style.display="none";}
this.isListOptionVisible=function(id){if(!this._isListButton(id,true))return;return(this._listOptions[id].tr.style.display!="none");}
this.enableListOption=function(id){if(!this._isListButton(id))return;this._listOptions[id].tr.en=true;this._listOptions[id].tr.className="tr_btn"+(this._listOptions[id].tr._selected&&that.renderSelect?" tr_btn_selected":"");}
this.disableListOption=function(id){if(!this._isListButton(id))return;this._listOptions[id].tr.en=false;this._listOptions[id].tr.className="tr_btn tr_btn_disabled";}
this.isListOptionEnabled=function(id){if(!this._isListButton(id))return;return this._listOptions[id].tr.en;}
this.setListOptionPosition=function(id,pos){if(!this._listOptions[id]||this.getListOptionPosition(id)==pos||isNaN(pos))return;if(pos<1)pos=1;var tr=this._listOptions[id].tr;this.p_tbody.removeChild(tr);if(pos>this.p_tbody.childNodes.length)this.p_tbody.appendChild(tr);else this.p_tbody.insertBefore(tr,this.p_tbody.childNodes[pos-1]);tr=null;}
this.getListOptionPosition=function(id){var pos=-1;if(!this._listOptions[id])return pos;for(var q=0;q<this.p_tbody.childNodes.length;q++)if(this.p_tbody.childNodes[q]==this._listOptions[id].tr)pos=q+1;return pos;}
this.setListOptionImage=function(id,img){if(!this._isListButton(id))return;var td=this._listOptions[id].tr.childNodes[(that.rtl?1:0)];td.innerHTML=(that.conf.icons_css?"<i class='"+that.conf.icons_path+img+"'></i>":"<img src='"+that.conf.icons_path+img+"' class='btn_sel_img'>");td=null;}
this.getListOptionImage=function(id){if(!this._isListButton(id))return;var td=this._listOptions[id].tr.childNodes[(that.rtl?1:0)];var src=null;if(td.childNodes.length>0)src=td.childNodes[0][(that.conf.icons_css?"className":"src")];td=null;return src;}
this.clearListOptionImage=function(id){if(!this._isListButton(id))return;var td=this._listOptions[id].tr.childNodes[(that.rtl?1:0)];while(td.childNodes.length>0)td.removeChild(td.childNodes[0]);td.innerHTML="&nbsp;";td=null;}
this.setListOptionText=function(id,text){if(!this._isListButton(id))return;this._listOptions[id].tr.childNodes[(that.rtl?0:1)].childNodes[0].innerHTML=text;}
this.getListOptionText=function(id){if(!this._isListButton(id))return;return this._listOptions[id].tr.childNodes[(that.rtl?0:1)].childNodes[0].innerHTML;}
this.setListOptionToolTip=function(id,tip){if(!this._isListButton(id))return;this._listOptions[id].tr.title=tip;}
this.getListOptionToolTip=function(id){if(!this._isListButton(id))return;return this._listOptions[id].tr.title;}
this.forEachListOption=function(handler){for(var a in this._listOptions)handler(a);}
this.getAllListOptions=function(){var listData=new Array();for(var a in this._listOptions)listData[listData.length]=a;return listData;}
this.setListOptionSelected=function(id){for(var a in this._listOptions){var item=this._listOptions[a];if(item.td_a!=null&&item.td_b!=null&&item.tr.en){if(a==id){item.tr._selected=true;item.tr.className="tr_btn"+(this.renderSelect?" tr_btn_selected":"");if(this.mode=="select"){if(item.tr._img)this.setItemImage(item.tr._img);else this.clearItemImage();this.setItemText(this.getListOptionText(id));}}else{item.tr._selected=false;item.tr.className="tr_btn";}}
item=null;}}
this.getListOptionSelected=function(){var id=null;for(var a in this._listOptions)if(this._listOptions[a].tr._selected==true)id=a;return id;}
this._isListButton=function(id,allowSeparator){if(this._listOptions[id]==null)return false;if(!allowSeparator&&this._listOptions[id].tr.className=="tr_sep")return false;return true;}
this.setMaxOpen=function(r){this._ph=null;if(typeof(r)=="number"){this.maxOpen=r;this._maxOpenTest();return;}
this.maxOpen=null;}
if(data.width)this.setWidth(data.width);if(this.mode=="select"&&typeof(data.selected)!="undefined")this.setListOptionSelected(data.selected);return this;}
dhtmlXToolbarObject.prototype._buttonInputObject=function(that,id,data){this.id=that.idPrefix+id;this.obj=document.createElement("DIV");this.obj.className="dhx_toolbar_btn dhxtoolbar_btn_def";this.obj.style.display=(data.hidden!=null?"none":"");this.obj.idd=String(id);this.obj.w=(data.width!=null?data.width:100);this.obj.title=(data.title!=null?data.title:"");this.obj.innerHTML="<input class='dhxtoolbar_input' type='text' style='width:"+this.obj.w+"px;'"+(data.value!=null?" value='"+data.value+"'":"")+">";var th=that;var self=this;this.obj.childNodes[0].onkeydown=function(e){e=e||event;if(e.keyCode==13){th.callEvent("onEnter",[self.obj.idd,this.value]);}}
that.base.appendChild(this.obj);this.enableItem=function(){this.obj.childNodes[0].disabled=false;}
this.disableItem=function(){this.obj.childNodes[0].disabled=true;}
this.isEnabled=function(){return(!this.obj.childNodes[0].disabled);}
this.showItem=function(){this.obj.style.display="";}
this.hideItem=function(){this.obj.style.display="none";}
this.isVisible=function(){return(this.obj.style.display!="none");}
this.setValue=function(value){this.obj.childNodes[0].value=value;}
this.getValue=function(){return this.obj.childNodes[0].value;}
this.setWidth=function(width){this.obj.w=width;this.obj.childNodes[0].style.width=this.obj.w+"px";}
this.getWidth=function(){return this.obj.w;}
this.setItemToolTip=function(tip){this.obj.title=tip;}
this.getItemToolTip=function(){return this.obj.title;}
this.getInput=function(){return this.obj.firstChild;}
if(typeof(data.enabled)!="undefined"&&window.dhx4.s2b(data.enabled)==false){this.disableItem();}
return this;}
dhtmlXToolbarObject.prototype._buttonTwoStateObject=function(that,id,data){this.id=that.idPrefix+id;this.state=(data.enabled!=null?false:true);this.imgEn=(data.img!=null?data.img:"");this.imgDis=(data.imgdis!=null?data.imgdis:"");this.img=(this.state?(this.imgEn!=""?this.imgEn:""):(this.imgDis!=""?this.imgDis:""));this.obj=document.createElement("DIV");this.obj.pressed=(data.selected!=null);this.obj.extAction=(data.action||null);this.obj.className="dhx_toolbar_btn dhxtoolbar_btn_"+(this.obj.pressed?"pres"+(this.state?"":"_dis"):(this.state?"def":"dis"));this.obj.style.display=(data.hidden!=null?"none":"");this.obj.renderAs=this.obj.className;this.obj.idd=String(id);this.obj.title=(data.title||"");if(this.obj.pressed){this.obj.renderAs="dhx_toolbar_btn dhxtoolbar_btn_over";}
var img=(that.conf.icons_css?"<i class='"+that.conf.icons_path+this.img+"'></i>":"<img src='"+that.conf.icons_path+this.img+"'>");this.obj.innerHTML=that._rtlParseBtn((this.img!=""?img:""),(data.text!=null?"<div class='dhxtoolbar_text'>"+data.text+"</div>":""));that.base.appendChild(this.obj);if(window.dhx4.isIE){this.obj.onselectstart=function(e){e=e||event;if(e.preventDefault)e.preventDefault();else e.returnValue=false;return false;}}
var t=this;this._doOnMouseOver=function(e){e=e||event;if(t.state==false||t.obj.over==true)return;if(t.obj.pressed!=true&&t.obj.className.match(/dhxtoolbar_btn_over/gi)==null)t.obj.className="dhx_toolbar_btn dhxtoolbar_btn_over";t.obj.over=true;}
this._doOnMouseOut=function(e){e=e||event;if(t.state==false)return;if(t.obj.pressed!=true&&t.obj.className.match(/dhxtoolbar_btn_over/gi)!=null)t.obj.className="dhx_toolbar_btn dhxtoolbar_btn_def";t.obj.over=false;}
this._doOnMouseDown=function(e){e=e||event;if(e.type=="touchstart"){if(e.preventDefault)e.preventDefault();e.cancelBubble=true;if(that.conf.touch_id!=null&&that.conf.touch_id!=t.id)return;that.conf.touch_id=t.id;}
if(t.state==false)return;if(that.callEvent("onBeforeStateChange",[t.obj.idd.replace(that.idPrefix,""),t.obj.pressed])!==true)return;t.obj.pressed=!t.obj.pressed;t.obj.className="dhx_toolbar_btn "+(t.obj.pressed==true?"dhxtoolbar_btn_pres":(t.obj.over==true?"dhxtoolbar_btn_over":"dhxtoolbar_btn_def"));var id=t.obj.idd.replace(that.idPrefix,"");if(t.obj.extAction)try{window[t.obj.extAction](idd,t.obj.pressed);}catch(e){};that.callEvent("onStateChange",[id,t.obj.pressed]);}
this._doOnMouseUp=function(e){e=e||event;if(e.type=="touchend"){if(e.preventDefault)e.preventDefault();e.cancelBubble=true;if(that.conf.touch_id==t.id)that.conf.touch_id=null;}}
this.obj.evs={mouseover:"_doOnMouseOver",mouseout:"_doOnMouseOut",mousedown:"_doOnMouseDown",touchstart:"_doOnMouseDown",touchend:"_doOnMouseUp"};that._evs.add.apply(this,[this.obj.evs,this.obj]);this.setItemState=function(state,callEvent){if(this.obj.pressed!=state){if(state==true){this.obj.pressed=true;this.obj.className="dhx_toolbar_btn dhxtoolbar_btn_pres"+(this.state?"":"_dis");}else{this.obj.pressed=false;this.obj.className="dhx_toolbar_btn dhxtoolbar_btn_"+(this.state?"def":"dis");}
if(callEvent==true){var id=this.obj.idd.replace(that.idPrefix,"");if(this.obj.extAction)try{window[this.obj.extAction](id,this.obj.pressed);}catch(e){};that.callEvent("onStateChange",[id,this.obj.pressed]);}}}
this.getItemState=function(){return this.obj.pressed;}
this.enableItem=function(){that._enableItem(this);}
this.disableItem=function(){that._disableItem(this);}
this.isEnabled=function(){return this.state;}
this.showItem=function(){this.obj.style.display="";}
this.hideItem=function(){this.obj.style.display="none";}
this.isVisible=function(){return(this.obj.style.display=="");}
this.setItemText=function(text){that._setItemText(this,text);}
this.getItemText=function(){return that._getItemText(this);}
this.setItemImage=function(url){that._setItemImage(this,url,true);}
this.clearItemImage=function(){that._clearItemImage(this,true);}
this.setItemImageDis=function(url){that._setItemImage(this,url,false);}
this.clearItemImageDis=function(){that._clearItemImage(this,false);}
this.setItemToolTip=function(tip){this.obj.title=tip;}
this.getItemToolTip=function(){return this.obj.title;}
return this;}
dhtmlXToolbarObject.prototype._sliderObject=function(that,id,data){this.id=that.idPrefix+id;this.state=(data.enabled!=null?(data.enabled=="true"?true:false):true);this.obj=document.createElement("DIV");this.obj.className="dhx_toolbar_btn dhxtoolbar_btn_"+(this.state?"def":"dis");this.obj.style.display=(data.hidden!=null?"none":"");this.obj.onselectstart=function(e){e=e||event;if(e.preventDefault)e.preventDefault();else e.returnValue=false;}
this.obj.idd=String(id);this.obj.len=(data.length!=null?Number(data.length):50);this.obj.innerHTML="<div class='dhxtoolbar_text'>"+(data.textMin||"")+"</div>"+"<div class='dhxtoolbar_sl_bg_l'></div>"+"<div class='dhxtoolbar_sl_bg_m' style='width:"+this.obj.len+"px;'></div>"+"<div class='dhxtoolbar_sl_bg_r'></div>"+"<div class='dhxtoolbar_text'>"+(data.textMax||"")+"</div>";that.base.appendChild(this.obj);var self=this;this.pen=document.createElement("DIV");this.pen.className="dhxtoolbar_sl_pen";this.obj.appendChild(this.pen);var pen=this.pen;this.label=document.createElement("DIV");this.label.dir="ltr";this.label.className="dhx_toolbar_slider_label_"+that.conf.skin+(that.rtl?"_rtl":"");this.label.style.display="none";this.label.tip=(data.toolTip||"%v");this.label._zi=window.dhx4.newId();document.body.appendChild(this.label);var label=this.label;this.pen.valueMin=(data.valueMin!=null?Number(data.valueMin):0);this.pen.valueMax=(data.valueMax!=null?Number(data.valueMax):100);if(this.pen.valueMin>this.pen.valueMax)this.pen.valueMin=this.pen.valueMax;this.pen.valueNow=(data.valueNow!=null?Number(data.valueNow):this.pen.valueMax);if(this.pen.valueNow>this.pen.valueMax)this.pen.valueNow=this.pen.valueMax;if(this.pen.valueNow<this.pen.valueMin)this.pen.valueNow=this.pen.valueMin;this.pen._detectLimits=function(){this.minX=self.obj.childNodes[1].offsetLeft+2;this.maxX=self.obj.childNodes[3].offsetLeft-this.offsetWidth+1;}
this.pen._detectLimits();this.pen._definePos=function(){this.nowX=Math.round((this.valueNow-this.valueMin)*(this.maxX-this.minX)/(this.valueMax-this.valueMin)+this.minX);this.style.left=this.nowX+"px";this.newNowX=this.nowX;}
this.pen._definePos();this.pen.initXY=0;this.pen.allowMove=false;this.pen[window.dhx4.isIPad?"ontouchstart":"onmousedown"]=function(e){if(self.state==false)return;e=e||event;this.initXY=(window.dhx4.isIPad?e.touches[0].clientX:e.clientX);this.newValueNow=this.valueNow;this.allowMove=true;this.className="dhxtoolbar_sl_pen dhxtoolbar_over";if(label.tip!=""){label.style.visibility="hidden";label.style.display="";label.innerHTML=label.tip.replace("%v",this.valueNow);label.style.left=Math.round(window.dhx4.absLeft(this)+this.offsetWidth/2-label.offsetWidth/2)+"px";label.style.top=window.dhx4.absTop(this)-label.offsetHeight-3+"px";label.style.visibility="";label.style.zIndex=window.dhx4.zim.reserve(label._zi);}}
this.pen._doOnMouseMoveStart=function(e){e=e||event;if(!pen.allowMove)return;var ecx=(window.dhx4.isIPad?e.touches[0].clientX:e.clientX);var ofst=ecx-pen.initXY;if(ecx<window.dhx4.absLeft(pen)+Math.round(pen.offsetWidth/2)&&pen.nowX==pen.minX)return;if(ecx>window.dhx4.absLeft(pen)+Math.round(pen.offsetWidth/2)&&pen.nowX==pen.maxX)return;pen.newNowX=pen.nowX+ofst;if(pen.newNowX<pen.minX)pen.newNowX=pen.minX;if(pen.newNowX>pen.maxX)pen.newNowX=pen.maxX;pen.nowX=pen.newNowX;pen.style.left=pen.nowX+"px";pen.initXY=ecx;pen.newValueNow=Math.round((pen.valueMax-pen.valueMin)*(pen.newNowX-pen.minX)/(pen.maxX-pen.minX)+pen.valueMin);if(label.tip!=""){label.innerHTML=label.tip.replace(/%v/gi,pen.newValueNow);label.style.left=Math.round(window.dhx4.absLeft(pen)+pen.offsetWidth/2-label.offsetWidth/2)+"px";label.style.top=window.dhx4.absTop(pen)-label.offsetHeight-3+"px";}
e.cancelBubble=true;if(e.preventDefault)e.preventDefault();else e.returnValue=false;return false;}
this.pen._doOnMouseMoveEnd=function(){if(!pen.allowMove)return;pen.className="dhxtoolbar_sl_pen";pen.allowMove=false;pen.nowX=pen.newNowX;pen.valueNow=pen.newValueNow;if(label.tip!=""){label.style.display="none";window.dhx4.zim.clear(label._zi);}
that.callEvent("onValueChange",[self.obj.idd.replace(that.idPrefix,""),pen.valueNow]);}
if(window.dhx4.isIPad){document.addEventListener("touchmove",pen._doOnMouseMoveStart,false);document.addEventListener("touchend",pen._doOnMouseMoveEnd,false);}else{if(typeof(window.addEventListener)!="undefined"){window.addEventListener("mousemove",pen._doOnMouseMoveStart,false);window.addEventListener("mouseup",pen._doOnMouseMoveEnd,false);}else{document.body.attachEvent("onmousemove",pen._doOnMouseMoveStart);document.body.attachEvent("onmouseup",pen._doOnMouseMoveEnd);}}
this.enableItem=function(){if(this.state)return;this.state=true;this.obj.className="dhx_toolbar_btn dhxtoolbar_btn_def";}
this.disableItem=function(){if(!this.state)return;this.state=false;this.obj.className="dhx_toolbar_btn dhxtoolbar_btn_dis";}
this.isEnabled=function(){return this.state;}
this.showItem=function(){this.obj.style.display="";}
this.hideItem=function(){this.obj.style.display="none";}
this.isVisible=function(){return(this.obj.style.display=="");}
this.setValue=function(value,callEvent){value=Number(value);if(value<this.pen.valueMin)value=this.pen.valueMin;if(value>this.pen.valueMax)value=this.pen.valueMax;this.pen.valueNow=value;this.pen._definePos();if(callEvent==true)that.callEvent("onValueChange",[this.obj.idd.replace(that.idPrefix,""),this.pen.valueNow]);}
this.getValue=function(){return this.pen.valueNow;}
this.setMinValue=function(value,label){value=Number(value);if(value>this.pen.valueMax)return;this.obj.childNodes[0].innerHTML=label;this.obj.childNodes[0].style.display=(label.length>0?"":"none");this.pen.valueMin=value;if(this.pen.valueNow<this.pen.valueMin)this.pen.valueNow=this.pen.valueMin;this.pen._detectLimits();this.pen._definePos();}
this.setMaxValue=function(value,label){value=Number(value);if(value<this.pen.valueMin)return;this.obj.childNodes[4].innerHTML=label;this.obj.childNodes[4].style.display=(label.length>0?"":"none");this.pen.valueMax=value;if(this.pen.valueNow>this.pen.valueMax)this.pen.valueNow=this.pen.valueMax;this.pen._detectLimits();this.pen._definePos();}
this.getMinValue=function(){var label=this.obj.childNodes[0].innerHTML;var value=this.pen.valueMin;return new Array(value,label);}
this.getMaxValue=function(){var label=this.obj.childNodes[4].innerHTML;var value=this.pen.valueMax;return new Array(value,label);}
this.setItemToolTipTemplate=function(template){this.label.tip=template;}
this.getItemToolTipTemplate=function(){return this.label.tip;}
return this;}
dhtmlXToolbarObject.prototype.unload=function(){if(typeof(window.addEventListener)=="function"){window.removeEventListener("mousedown",this._doOnClick,false);window.removeEventListener("touchstart",this._doOnClick,false);}else{document.body.detachEvent("onmousedown",this._doOnClick);}
this._doOnClick=null;this.clearAll();this.objPull=null;if(this._xmlLoader){this._xmlLoader.destructor();this._xmlLoader=null;}
while(this.base.childNodes.length>0)this.base.removeChild(this.base.childNodes[0]);this.cont.removeChild(this.base);this.base=null;while(this.cont.childNodes.length>0)this.cont.removeChild(this.cont.childNodes[0]);this.cont.className="";this.cont=null;window.dhx4._enableDataLoading(this,null,null,null,"clear");window.dhx4._eventable(this,"clear");this.tX1=null;this.tX2=null;this.tY1=null;this.tY2=null;this.anyUsed=null;this.idPrefix=null;this.rootTypes=null;this._rtl=null;this._rtlParseBtn=null;this.setRTL=null;this._sbw=null;this._getObj=null;this._addImgObj=null;this._setItemImage=null;this._clearItemImage=null;this._setItemText=null;this._getItemText=null;this._enableItem=null;this._disableItem=null;this._xmlParser=null;this._addItemToStorage=null;this._genStr=null;this._addItem=null;this._getPosition=null;this._setPosition=null;this._getIdByPosition=null;this._separatorObject=null;this._textObject=null;this._buttonObject=null;this._buttonSelectObject=null;this._buttonInputObject=null;this._buttonTwoStateObject=null;this._sliderObject=null;this._autoDetectVisibleArea=null;this._removeItem=null;this.setAlign=null;this.setSkin=null;this.setIconsPath=null;this.setIconPath=null;this.loadXML=null;this.loadXMLString=null;this.clearAll=null;this.addSpacer=null;this.removeSpacer=null;this.getType=null;this.getTypeExt=null;this.inArray=null;this.getParentId=null;this.addButton=null;this.addText=null;this.addButtonSelect=null;this.addButtonTwoState=null;this.addSeparator=null;this.addSlider=null;this.addInput=null;this.forEachItem=null;this.showItem=null;this.hideItem=null;this.isVisible=null;this.enableItem=null;this.disableItem=null;this.isEnabled=null;this.setItemText=null;this.getItemText=null;this.setItemToolTip=null;this.getItemToolTip=null;this.setItemImage=null;this.setItemImageDis=null;this.clearItemImage=null;this.clearItemImageDis=null;this.setItemState=null;this.getItemState=null;this.setItemToolTipTemplate=null;this.getItemToolTipTemplate=null;this.setValue=null;this.getValue=null;this.setMinValue=null;this.getMinValue=null;this.setMaxValue=null;this.getMaxValue=null;this.setWidth=null;this.getWidth=null;this.getPosition=null;this.setPosition=null;this.removeItem=null;this.addListOption=null;this.removeListOption=null;this.showListOption=null;this.hideListOption=null;this.isListOptionVisible=null;this.enableListOption=null;this.disableListOption=null;this.isListOptionEnabled=null;this.setListOptionPosition=null;this.getListOptionPosition=null;this.setListOptionText=null;this.getListOptionText=null;this.setListOptionToolTip=null;this.getListOptionToolTip=null;this.setListOptionImage=null;this.getListOptionImage=null;this.clearListOptionImage=null;this.forEachListOption=null;this.getAllListOptions=null;this.setListOptionSelected=null;this.getListOptionSelected=null;this.unload=null;this.setUserData=null;this.getUserData=null;this.setMaxOpen=null;this.items=null;this.conf=null;};dhtmlXToolbarObject.prototype._autoDetectVisibleArea=function(){var d=window.dhx4.screenDim();this.tX1=d.left;this.tX2=d.right;this.tY1=d.top;this.tY2=d.bottom;};dhtmlXToolbarObject.prototype.setIconset=function(name){this.conf.icons_css=(name=="awesome");};dhtmlXToolbarObject.prototype._evs={add:function(evs,obj){for(var a in evs){if(typeof(window.addEventListener)=="function"){obj.addEventListener(a,this[evs[a]],false);}else if(a.match(/^touch/)==null){obj.attachEvent("on"+a,this[evs[a]]);}}
obj=evs=null;},clear:function(evs,obj){for(var a in evs){if(typeof(window.addEventListener)=="function"){obj.removeEventListener(a,this[evs[a]],false);}else if(a.match(/^touch/)==null){obj.detachEvent("on"+a,this[evs[a]]);}}
obj=evs=null;}};dhtmlXToolbarObject.prototype._initObj=function(data){for(var q=0;q<data.length;q++)this._addItemToStorage(data[q]);if(this.conf.skin=="dhx_terrace")this._improveTerraceSkin();};dhtmlXToolbarObject.prototype._xmlToJson=function(xml){var data=[];var root=xml.getElementsByTagName("toolbar");if(root!=null&&root[0]!=null){root=root[0];var getExtText=function(node){var t=null;for(var q=0;q<node.childNodes.length;q++){if(t==null&&node.childNodes[q].tagName=="itemText"){t=window.dhx4._xmlNodeValue(node.childNodes[q]);break;}}
return t;}
var t=["id","type","hidden","title","text","enabled","img","imgdis","action","openAll","renderSelect","mode","maxOpen","width","value","selected","length","textMin","textMax","toolTip","valueMin","valueMax","valueNow"];var p=["id","type","enabled","disabled","action","selected","img","text"];for(var q=0;q<root.childNodes.length;q++){if(root.childNodes[q].tagName=="item"){var itemData={};for(var w=0;w<t.length;w++){var val=root.childNodes[q].getAttribute(t[w]);if(val!=null)itemData[t[w]]=val;}
for(var e=0;e<root.childNodes[q].childNodes.length;e++){if(root.childNodes[q].childNodes[e].tagName=="item"&&itemData.type=="buttonSelect"){var u={};for(var w=0;w<p.length;w++){var val=root.childNodes[q].childNodes[e].getAttribute(p[w]);if(val!=null)u[p[w]]=val;}
var h=root.childNodes[q].childNodes[e].getElementsByTagName("userdata");for(var w=0;w<h.length;w++){if(!u.userdata)u.userdata={};var r={};try{r.name=h[w].getAttribute("name");}catch(k){r.name=null;}
try{r.value=h[w].firstChild.nodeValue;}catch(k){r.value="";}
if(r.name!=null)u.userdata[r.name]=r.value;}
u.text=getExtText(root.childNodes[q].childNodes[e])||u.text;if(itemData.options==null)itemData.options=[];itemData.options.push(u);}
if(root.childNodes[q].childNodes[e].tagName=="userdata"){if(itemData.userdata==null)itemData.userdata={};var u={};try{u.name=root.childNodes[q].childNodes[e].getAttribute("name");}catch(k){u.name=null;}
try{u.value=root.childNodes[q].childNodes[e].firstChild.nodeValue;}catch(k){u.value="";}
if(u.name!=null)itemData.userdata[u.name]=u.value;}}
itemData.text=getExtText(root.childNodes[q])||itemData.text;data.push(itemData);}}
getExtText=null;}
return data;};dhtmlXToolbarObject.prototype._addItemToStorage=function(data,pos){var id=(data.id||this._genStr(24));var type=(data.type||"");if(type=="spacer"){this.addSpacer(this._lastId);}else{this._lastId=id;}
if(type!=""&&this["_"+type+"Object"]!=null){if(type=="buttonSelect"){if(data.options!=null){for(var q=0;q<data.options.length;q++){if(data.options[q].type=="obj")data.options[q].type="button";if(data.options[q].type=="sep")data.options[q].type="separator";}}}
if(type=="slider"){var k={tip_template:"toolTip",value_min:"valueMin",value_max:"valueMax",value_now:"valueNow",text_min:"textMin",text_max:"textMax"};for(var a in k){if(data[k[a]]==null&&data[a]!=null)data[k[a]]=data[a];}}
if(type=="buttonInput"){if(data.value==null&&data.text!=null)data.value=data.text;}
if(type=="buttonTwoState"){if(typeof(data.selected)=="undefined"&&typeof(data.pressed)!="undefined"&&window.dhx4.s2b(data.pressed)){data.selected=true;}}
if(typeof(data.enabled)=="undefined"&&typeof(data.disabled)!="undefined"&&window.dhx4.s2b(data.disabled)){data.enabled=false;}
if(data.imgDis==null&&data.img_disabled!=null){data.imgdis=data.img_disabled;}
if((typeof(data.openAll)=="undefined"||data.openAll==null)&&this.conf.skin=="dhx_terrace")data.openAll=true;this.objPull[this.idPrefix+id]=new this["_"+type+"Object"](this,id,data);this.objPull[this.idPrefix+id]["type"]=type;this.setPosition(id,pos);}
if(data.userdata!=null){for(var a in data.userdata)this.setUserData(id,a,data.userdata[a]);}
if(data.options!=null){for(var q=0;q<data.options.length;q++){if(data.options[q].userdata!=null){for(var a in data.options[q].userdata){this.setListOptionUserData(data.id,data.options[q].id,a,data.options[q].userdata[a]);}}}}};dhtmlXToolbarObject.prototype.setSkin=function(skin,onlyIcons){if(onlyIcons===true){this.cont.className=this.cont.className.replace(/dhxtoolbar_icons_\d{1,}/,"dhxtoolbar_icons_"+this.conf.iconSize);}else{this.conf.skin=skin;if(this.conf.skin=="dhx_skyblue"){this.conf.sel_ofs_y=1;}
if(this.conf.skin=="dhx_web"){this.conf.sel_ofs_y=1;this.conf.sel_ofs_x=1;}
if(this.conf.skin=="dhx_terrace"){this.conf.sel_ofs_y=-1;this.conf.sel_ofs_x=0;}
if(this.conf.skin=="material"){this.conf.sel_ofs_y=-1;this.conf.sel_ofs_x=0;}
this.cont.className="dhx_toolbar_"+this.conf.skin+" dhxtoolbar_icons_"+this.conf.iconSize+this.conf.cssShadow;}
for(var a in this.objPull){var item=this.objPull[a];if(item["type"]=="slider"){item.pen._detectLimits();item.pen._definePos();item.label.className="dhx_toolbar_slider_label_"+this.conf.skin;}
if(item["type"]=="buttonSelect"){item.polygon.className="dhx_toolbar_poly_"+this.conf.skin+" dhxtoolbar_icons_"+this.conf.iconSize+this.conf.cssShadow;}}
if(skin=="dhx_terrace")this._improveTerraceSkin();};dhtmlXToolbarObject.prototype.setAlign=function(align){this.conf.align=(align=="right"?"right":"left");this.base.className=(align=="right"?"dhxtoolbar_float_right":"dhxtoolbar_float_left");if(this._spacer)this._spacer.className=(align=="right"?" dhxtoolbar_float_left":" dhxtoolbar_float_right")};dhtmlXToolbarObject.prototype.setIconSize=function(size){this.conf.iconSize=({18:true,24:true,32:true,48:true}[size]?size:18);this.setSkin(this.conf.skin,true);this.callEvent("_onIconSizeChange",[this.conf.iconSize]);};dhtmlXToolbarObject.prototype.setIconsPath=function(path){this.conf.icons_path=path;};dhtmlXToolbarObject.prototype.setUserData=function(id,name,value){id=this.idPrefix+id;if(this.objPull[id]!=null){if(this.objPull[id].userData==null)this.objPull[id].userData={};this.objPull[id].userData[name]=value;}};dhtmlXToolbarObject.prototype.getUserData=function(id,name){id=this.idPrefix+id;if(this.objPull[id]!=null&&this.objPull[id].userData!=null)return this.objPull[id].userData[name]||null;return null;};dhtmlXToolbarObject.prototype._isListOptionExists=function(listId,optionId){if(this.objPull[this.idPrefix+listId]==null)return false;var item=this.objPull[this.idPrefix+listId];if(item.type!="buttonSelect")return false;if(item._listOptions[optionId]==null)return false;return true;};dhtmlXToolbarObject.prototype.setListOptionUserData=function(listId,optionId,name,value){if(!this._isListOptionExists(listId,optionId))return;var opt=this.objPull[this.idPrefix+listId]._listOptions[optionId];if(opt.userData==null)opt.userData={};opt.userData[name]=value;};dhtmlXToolbarObject.prototype.getListOptionUserData=function(listId,optionId,name){if(!this._isListOptionExists(listId,optionId))return null;var opt=this.objPull[this.idPrefix+listId]._listOptions[optionId];if(!opt.userData)return null;return(opt.userData[name]?opt.userData[name]:null);};dhtmlXToolbarObject.prototype._improveTerraceSkin=function(){if(this.conf.terrace_radius==null)this.conf.terrace_radius="3px";var p=[];var bn={separator:true,text:true};var e=[this.base];if(this._spacer!=null)e.push(this._spacer);for(var w=0;w<e.length;w++){p[w]=[];for(var q=0;q<e[w].childNodes.length;q++){if(e[w].childNodes[q].idd!=null&&e[w].childNodes[q].style.display!="none"){var a=this.idPrefix+e[w].childNodes[q].idd;if(this.objPull[a]!=null&&this.objPull[a].obj==e[w].childNodes[q]){p[w].push({a:a,type:this.objPull[a].type,node:this.objPull[a][this.objPull[a].type=="buttonSelect"?"arw":"obj"]});}}}
e[w]=null;}
for(var w=0;w<p.length;w++){for(var q=0;q<p[w].length;q++){var t=p[w][q];var br=false;var bl=false;if(!bn[t.type]){if(q==p[w].length-1||(p[w][q+1]!=null&&bn[p[w][q+1].type]))br=true;if(q==0||(q-1>=0&&p[w][q-1]!=null&&bn[p[w][q-1].type]))bl=true;}
t.node.style.borderRightWidth=(br?"1px":"0px");t.node.style.borderTopRightRadius=t.node.style.borderBottomRightRadius=(br?this.conf.terrace_radius:"0px");if(t.type=="buttonSelect"){t.node.previousSibling.style.borderTopLeftRadius=t.node.previousSibling.style.borderBottomLeftRadius=(bl?this.conf.terrace_radius:"0px");t.node.previousSibling._br=br;t.node.previousSibling._bl=bl;}else{t.node.style.borderTopLeftRadius=t.node.style.borderBottomLeftRadius=(bl?this.conf.terrace_radius:"0px");}
t.node._br=br;t.node._bl=bl;}}
for(var w=0;w<p.length;w++){for(var q=0;q<p[w].length;q++){for(var a in p[w][q])p[w][q][a]=null;p[w][q]=null;}
p[w]=null;}
p=e=null;};dhtmlXToolbarObject.prototype._improveTerraceButtonSelect=function(id,state){var item=this.objPull[id];if(state==true){item.obj.style.borderBottomLeftRadius=(item.obj._bl?this.conf.terrace_radius:"0px");item.arw.style.borderBottomRightRadius=(item.obj._br?this.conf.terrace_radius:"0px");}else{item.obj.style.borderBottomLeftRadius="0px";item.arw.style.borderBottomRightRadius="0px";}
item=null;};if(typeof(window.dhtmlXCellObject)!="undefined"){dhtmlXCellObject.prototype._createNode_toolbar=function(obj,type,htmlString,append,node){if(typeof(node)!="undefined"){obj=node;}else{obj=document.createElement("DIV");obj.className="dhx_cell_toolbar_"+(this.conf.borders?"def":"no_borders");obj.appendChild(document.createElement("DIV"));obj.firstChild.className="dhx_toolbar_base_18_dhx_skyblue";}
this.cell.insertBefore(obj,this.cell.childNodes[this.conf.idx.cont]);this.conf.ofs_nodes.t.toolbar=true;this._updateIdx();return obj;}
dhtmlXCellObject.prototype.attachToolbar=function(conf){if(!(this.dataNodes.ribbon==null&&this.dataNodes.toolbar==null))return;this.callEvent("_onBeforeContentAttach",["toolbar"]);if(typeof(conf)=="undefined"){conf={};}else if(typeof(conf)=="string"){conf={skin:conf};}
if(typeof(conf.skin)=="undefined")conf.skin=this.conf.skin;conf.parent=this._attachObject("toolbar").firstChild;this.dataNodes.toolbar=new dhtmlXToolbarObject(conf);this._adjustCont(this._idd);this.dataNodes.toolbar._masterCell=this;this.dataNodes.toolbar.attachEvent("_onIconSizeChange",function(){this._masterCell._adjustCont();});conf.parent=null;conf=null;this.callEvent("_onContentAttach",[]);return this.dataNodes.toolbar;};dhtmlXCellObject.prototype.detachToolbar=function(){if(this.dataNodes.toolbar==null)return;this.dataNodes.toolbar._masterCell=null;if(typeof(this.dataNodes.toolbar.unload)=="function")this.dataNodes.toolbar.unload();this.dataNodes.toolbar=null;delete this.dataNodes.toolbar;this._detachObject("toolbar");};dhtmlXCellObject.prototype.showToolbar=function(){this._mtbShowHide("toolbar","");};dhtmlXCellObject.prototype.hideToolbar=function(){this._mtbShowHide("toolbar","none");};dhtmlXCellObject.prototype.getAttachedToolbar=function(){return this.dataNodes.toolbar;};}
var globalActiveDHTMLGridObject;String.prototype._dhx_trim=function(){return this.replace(/&nbsp;/g," ").replace(/(^[ \t]*)|([ \t]*$)/g,"");}
function dhtmlxArray(ar){return dhtmlx.extend((ar||new Array()),dhtmlxArray._master);};dhtmlxArray._master={_dhx_find:function(pattern){for(var i=0;i<this.length;i++){if(pattern==this[i])
return i;}
return-1;},_dhx_insertAt:function(ind,value){this[this.length]=null;for(var i=this.length-1;i>=ind;i--)
this[i]=this[i-1]
this[ind]=value},_dhx_removeAt:function(ind){this.splice(ind,1)},_dhx_swapItems:function(ind1,ind2){var tmp=this[ind1];this[ind1]=this[ind2]
this[ind2]=tmp;}}
function dhtmlXGridObject(id){if(dhtmlxEvent.initTouch)
dhtmlxEvent.initTouch();if(_isIE)
try{document.execCommand("BackgroundImageCache",false,true);}
catch(e){}
if(id){if(typeof(id)=='object'){this.entBox=id
if(!this.entBox.id)this.entBox.id="cgrid2_"+this.uid();}else
this.entBox=document.getElementById(id);}else{this.entBox=document.createElement("DIV");this.entBox.id="cgrid2_"+this.uid();}
this.entBox.innerHTML="";dhx4._eventable(this);var self=this;this._RaSeCol=[];this._wcorr=0;this.fontWidth=7;this.cell=null;this.row=null;this.iconURL="";this.editor=null;this._f2kE=true;this._dclE=true;this.combos=new Array(0);this.defVal=new Array(0);this.rowsAr={};this.rowsBuffer=dhtmlxArray();this.rowsCol=dhtmlxArray();this._data_cache={};this._ecache={}
this._ud_enabled=true;this.xmlLoader=this.doLoadDetails;this._maskArr=[];this.selectedRows=dhtmlxArray();this.UserData={};this._sizeFix=this._borderFix=0;this.entBox.className+=" gridbox";this.entBox.style.width=this.entBox.getAttribute("width")||(window.getComputedStyle?(this.entBox.style.width||window.getComputedStyle(this.entBox,null)["width"]):(this.entBox.currentStyle?this.entBox.currentStyle["width"]:this.entBox.style.width||0))||"100%";this.entBox.style.height=this.entBox.getAttribute("height")||(window.getComputedStyle?(this.entBox.style.height||window.getComputedStyle(this.entBox,null)["height"]):(this.entBox.currentStyle?this.entBox.currentStyle["height"]:this.entBox.style.height||0))||"100%";this.entBox.style.cursor='default';this.entBox.onselectstart=function(){return false};var t_creator=function(name){var t=document.createElement("TABLE");t.cellSpacing=t.cellPadding=0;t.style.cssText='width:100%;table-layout:fixed;';t.className=name.substr(2);return t;}
this.obj=t_creator("c_obj");this.hdr=t_creator("c_hdr");this.hdr.style.marginRight="20px";this.hdr.style.paddingRight="20px";this.objBox=document.createElement("DIV");this.objBox.style.width="100%";this.objBox.style.overflow="auto";this.objBox.appendChild(this.obj);this.objBox.className="objbox";if(dhtmlx.$customScroll)
dhtmlx.CustomScroll.enable(this);this.hdrBox=document.createElement("DIV");this.hdrBox.style.width="100%"
this.hdrBox.style.height="25px";this.hdrBox.style.overflow="hidden";this.hdrBox.className="xhdr";this.preloadImagesAr=new Array(0)
this.sortImg=document.createElement("DIV")
this.sortImg.style.display="none";this.hdrBox.appendChild(this.sortImg)
this.hdrBox.appendChild(this.hdr);this.hdrBox.style.position="relative";this.entBox.appendChild(this.hdrBox);this.entBox.appendChild(this.objBox);this.entBox.grid=this;this.objBox.grid=this;this.hdrBox.grid=this;this.obj.grid=this;this.hdr.grid=this;this.cellWidthPX=[];this.cellWidthPC=[];this.cellWidthType=this.entBox.cellwidthtype||"px";this.delim=this.entBox.delimiter||",";this._csvDelim=",";this.hdrLabels=[];this.columnIds=[];this.columnColor=[];this._hrrar=[];this.cellType=dhtmlxArray();this.cellAlign=[];this.initCellWidth=[];this.fldSort=[];this._srdh=(_isIE&&(document.compatMode!="BackCompat")?22:20);this.imgURL=window.dhx_globalImgPath||"";this.isActive=false;this.isEditable=true;this.useImagesInHeader=false;this.pagingOn=false;this.rowsBufferOutSize=0;dhtmlxEvent(window,"unload",function(){try{if(self.destructor)self.destructor();}
catch(e){}});this.setSkin=function(name){this._srdh=window.dhx4.readFromCss("dhxgrid_rh_"+name)+4;this.skin_name=name;if(this._imgURL)
this.setImagePath(this._imgURL);var classname=this.entBox.className.split(" gridbox")[0];this.entBox.className=classname+" gridbox gridbox_"+name+(_isIE?" isIE":" isModern");this.skin_h_correction=0;this.enableAlterCss("ev_"+name,"odd_"+name,this.isTreeGrid())
this._fixAlterCss()
switch(name){case"dhx_terrace":case"material":this._srdh=33;this.forceDivInHeader=true;break;case"dhx_web":case"material":this.forceDivInHeader=true;this._srdh=31;break;case"dhx_skyblue":this.forceDivInHeader=true;break;}
if(_isIE&&this.hdr){var d=this.hdr.parentNode;d.removeChild(this.hdr);d.appendChild(this.hdr);}
this.setSizes();}
if(_isIE)
this.preventIECaching(true);if(window.dhtmlDragAndDropObject)
this.dragger=new dhtmlDragAndDropObject();this._doOnScroll=function(e,mode){this.callEvent("onScroll",[this.objBox.scrollLeft,this.objBox.scrollTop]);this.doOnScroll(e,mode);}
this.doOnScroll=function(e,mode){this.hdrBox.scrollLeft=this.objBox.scrollLeft;if(this.ftr)
this.ftr.parentNode.scrollLeft=this.objBox.scrollLeft;if(mode)
return;if(this._srnd){if(this._dLoadTimer)
window.clearTimeout(this._dLoadTimer);this._dLoadTimer=window.setTimeout(function(){if(self._update_srnd_view)
self._update_srnd_view();},100);}}
this.attachToObject=function(obj){obj.appendChild(this.globalBox?this.globalBox:this.entBox);this.setSizes();}
this.init=function(fl){if((this.isTreeGrid())&&(!this._h2)){this._h2=this._createHierarchy();if((this._fake)&&(!this._realfake))
this._fake._h2=this._h2;this._tgc={imgURL:null};}
if(!this._hstyles)
return;if(!this.skin_name)
this.setSkin(window.dhx4.skin||(typeof(dhtmlx)!="undefined"?dhtmlx.skin:null)||window.dhx4.skinDetect("dhxgrid")||"material");this.editStop()
this.lastClicked=null;this.resized=null;this.fldSorted=this.r_fldSorted=null;this.cellWidthPX=[];this.cellWidthPC=[];if(this.hdr.rows.length>0){var temp=this.xmlFileUrl;this.clearAll(true);this.xmlFileUrl=temp;}
var hdrRow=this.hdr.insertRow(0);for(var i=0;i<this.hdrLabels.length;i++){hdrRow.appendChild(document.createElement("TH"));hdrRow.childNodes[i]._cellIndex=i;hdrRow.childNodes[i].style.height="0px";}
if(_isIE&&_isIE<8&&document.body.style.msTouchAction==this.undefined)
hdrRow.style.position="absolute";else
hdrRow.style.height='auto';var hdrRow=this.hdr.insertRow(_isKHTML?2:1);hdrRow._childIndexes=new Array();var col_ex=0;for(var i=0;i<this.hdrLabels.length;i++){hdrRow._childIndexes[i]=i-col_ex;if((this.hdrLabels[i]==this.splitSign)&&(i!=0)){if(_isKHTML)
hdrRow.insertCell(i-col_ex);hdrRow.cells[i-col_ex-1].colSpan=(hdrRow.cells[i-col_ex-1].colSpan||1)+1;hdrRow.childNodes[i-col_ex-1]._cellIndex++;col_ex++;hdrRow._childIndexes[i]=i-col_ex;continue;}
hdrRow.insertCell(i-col_ex);hdrRow.childNodes[i-col_ex]._cellIndex=i;hdrRow.childNodes[i-col_ex]._cellIndexS=i;this.setColumnLabel(i,this.hdrLabels[i]);}
if(col_ex==0)
hdrRow._childIndexes=null;this._cCount=this.hdrLabels.length;if(_isIE)
window.setTimeout(function(){if(self.setSizes)
self.setSizes();},1);if(!this.obj.firstChild)
this.obj.appendChild(document.createElement("TBODY"));var tar=this.obj.firstChild;if(!tar.firstChild){tar.appendChild(document.createElement("TR"));tar=tar.firstChild;if(_isIE&&_isIE<8&&document.body.style.msTouchAction==this.undefined)
tar.style.position="absolute";else
tar.style.height='auto';for(var i=0;i<this.hdrLabels.length;i++){tar.appendChild(document.createElement("TH"));tar.childNodes[i].style.height="0px";}}
this._c_order=null;if(this.multiLine!=true)
this.obj.className+=" row20px";this.sortImg.style.position="absolute";this.sortImg.style.display="none";this.sortImg.className="dhxgrid_sort_desc";this.sortImg.defLeft=0;if(this.noHeader){this.hdrBox.style.display='none';}
else{this.noHeader=false}
if(this._ivizcol)
this.setColHidden();this.attachHeader();this.attachHeader(0,0,"_aFoot");this.setSizes();if(fl)
this.parseXML()
this.obj.scrollTop=0
if(this.dragAndDropOff)
this.dragger.addDragLanding(this.entBox,this);if(this._initDrF)
this._initD();dhx4.callEvent("onGridCreated",[this]);};this.setColumnSizes=function(gridWidth){var summ=0;var fcols=[];var fix=0;for(var i=0;i<this._cCount;i++){if((this.initCellWidth[i]=="*")&&!this._hrrar[i]){this._awdth=false;fcols.push(i);continue;}
if(this.cellWidthType=='%'){if(typeof this.cellWidthPC[i]=="undefined")
this.cellWidthPC[i]=this.initCellWidth[i];var cwidth=(gridWidth*this.cellWidthPC[i]/100)||0;if(fix>0.5){cwidth++;fix--;}
var rwidth=this.cellWidthPX[i]=Math.floor(cwidth);var fix=fix+cwidth-rwidth;}else{if(typeof this.cellWidthPX[i]=="undefined")
this.cellWidthPX[i]=this.initCellWidth[i];}
if(!this._hrrar[i])
summ+=this.cellWidthPX[i]*1;}
if(fcols.length){var ms=Math.floor((gridWidth-summ)/fcols.length);if(ms<0)ms=1;for(var i=0;i<fcols.length;i++){var next=Math.max((this._drsclmW?(this._drsclmW[fcols[i]]||0):0),ms)
this.cellWidthPX[fcols[i]]=next;summ+=next;}
if(gridWidth>summ){var last=fcols[fcols.length-1];this.cellWidthPX[last]=this.cellWidthPX[last]+(gridWidth-summ);summ=gridWidth;}
this._setAutoResize();}
this.obj.style.width=summ+"px";this.hdr.style.width=summ+"px";if(this.ftr)this.ftr.style.width=summ+"px";this.chngCellWidth();return summ;}
this.setSizes=function(){if((!this.hdr.rows[0]))return;var quirks=this.quirks=(_isIE&&document.compatMode=="BackCompat");var outerBorder=(this.entBox.offsetWidth-this.entBox.clientWidth)/2;if(!this.dontSetSizes){if(this.globalBox){if(!this.globalBox.clientWidth)return;var ow=this.globalBox.clientWidth;var splitOuterBorder=(this.globalBox.offsetWidth-ow)/2;if(this._delta_x&&!this._realfake){this.globalBox.style.width=this._delta_x;var owu=this.globalBox.clientWidth;this.entBox.style.width=Math.max(0,(owu+(quirks?splitOuterBorder*2:0))-this._fake.entBox.clientWidth)+"px";if(owu!=this._lastTimeSplitWidth){this._fake._correctSplit(this._fake.entBox.clientWidth);this._lastTimeSplitWidth=owu;}}
if(this._delta_y&&!this._realfake){this.globalBox.style.height=this._delta_y;this.entBox.style.overflow=this._fake.entBox.style.overflow="hidden";this.entBox.style.height=this._fake.entBox.style.height=this.globalBox.clientHeight+(quirks?splitOuterBorder*2:0)+"px";}}else{if(this._delta_x){if(this.entBox.parentNode&&this.entBox.parentNode.tagName=="TD"){this.entBox.style.width="1px";this.entBox.style.width=parseInt(this._delta_x)*this.entBox.parentNode.clientWidth/100-outerBorder*2+"px";}else
this.entBox.style.width=this._delta_x;}
if(this._delta_y)
this.entBox.style.height=this._delta_y;}}
window.clearTimeout(this._sizeTime);if(!this.entBox.offsetWidth&&(!this.globalBox||!this.globalBox.offsetWidth)){this._sizeTime=window.setTimeout(function(){if(self.setSizes)
self.setSizes();},250);return;}
var border_x=((!this._wthB)&&((this.entBox.cmp||this._delta_x)&&(this.skin_name||"").indexOf("dhx")==0&&!quirks)?2:0);var border_y=((!this._wthB)&&((this.entBox.cmp||this._delta_y)&&(this.skin_name||"").indexOf("dhx")==0&&!quirks)?2:0);if(this._sizeFix){border_x-=this._sizeFix;border_y-=this._sizeFix;}
var isVScroll=this.parentGrid?false:(this.objBox.scrollHeight>this.objBox.offsetHeight);var scrfix=dhtmlx.$customScroll?0:18;var gridWidth=this.entBox.clientWidth-(this.skin_h_correction||0)*(quirks?0:1)-border_x;var gridWidthActive=this.entBox.clientWidth-(this.skin_h_correction||0)-border_x;var gridHeight=this.entBox.clientHeight-border_y;var summ=this.setColumnSizes(gridWidthActive-(isVScroll?scrfix:0)-(this._correction_x||0));var isHScroll=this.parentGrid?false:((this.objBox.scrollWidth>this.objBox.offsetWidth)||(this.objBox.style.overflowX=="scroll"));var headerHeight=this.hdr.clientHeight;var footerHeight=this.ftr?this.ftr.clientHeight:0;var newWidth=gridWidth;var newHeight=gridHeight-headerHeight-footerHeight;if(this._awdth&&this._awdth[0]&&this._awdth[1]==99999)isHScroll=0;if(this._ahgr){if(this._ahgrMA)
newHeight=this.entBox.parentNode.clientHeight-headerHeight-footerHeight;else
newHeight=this.obj.offsetHeight+(isHScroll?scrfix:0)+(this._correction_y||0);if(this._ahgrM){if(this._ahgrF)
newHeight=Math.min(this._ahgrM,newHeight+headerHeight+footerHeight)-headerHeight-footerHeight;else
newHeight=Math.min(this._ahgrM,newHeight);}
if(isVScroll&&newHeight>=this.obj.scrollHeight+(isHScroll?scrfix:0)){isVScroll=false;this.setColumnSizes(gridWidthActive-(this._correction_x||0));}}
if((this._awdth)&&(this._awdth[0])){if(this.cellWidthType=='%')this.cellWidthType="px";if(this._fake)summ+=this._fake.entBox.clientWidth;var newWidth=Math.min(Math.max(summ+(isVScroll?scrfix:0),this._awdth[2]),this._awdth[1])+(this._correction_x||0);this.objBox.style.overflowX=(!isVScroll&&this.objBox.scrollWidth<=newWidth)?"hidden":"auto";if(this._fake)newWidth-=this._fake.entBox.clientWidth;}
newHeight=Math.max(0,newHeight);this._ff_size_delta=(this._ff_size_delta==0.1)?0.2:0.1;if(!_isFF)this._ff_size_delta=0;if(!this.dontSetSizes){this.entBox.style.width=Math.max(0,newWidth+(quirks?2:0)*outerBorder+this._ff_size_delta)+"px";this.entBox.style.height=newHeight+(quirks?2:0)*outerBorder+headerHeight+footerHeight+"px";}
this.objBox.style.height=newHeight+((quirks&&!isVScroll)?2:0)*outerBorder+"px";this.hdrBox.style.height=headerHeight+"px";if(newHeight!=gridHeight)
this.doOnScroll(0,!this._srnd);var ext=this["setSizes_"+this.skin_name];if(ext)ext.call(this);this.setSortImgPos();if(headerHeight!=this.hdr.clientHeight&&this._ahgr)
this.setSizes();this.callEvent("onSetSizes",[]);};this.chngCellWidth=function(){if((_isOpera)&&(this.ftr))
this.ftr.width=this.objBox.scrollWidth+"px";var l=this._cCount;for(var i=0;i<l;i++){this.hdr.rows[0].cells[i].style.width=this.cellWidthPX[i]+"px";this.obj.rows[0].childNodes[i].style.width=this.cellWidthPX[i]+"px";if(this.ftr)
this.ftr.rows[0].cells[i].style.width=this.cellWidthPX[i]+"px";}}
this.setDelimiter=function(delim){this.delim=delim;}
this.setInitWidthsP=function(wp){this.cellWidthType="%";this.initCellWidth=wp.split(this.delim.replace(/px/gi,""));if(!arguments[1])this._setAutoResize();}
this._setAutoResize=function(){if(this._realfake)return;var el=window;var self=this;dhtmlxEvent(window,"resize",function(){window.clearTimeout(self._resize_timer);if(self._setAutoResize)
self._resize_timer=window.setTimeout(function(){if(self.setSizes)
self.setSizes();if(self._fake)
self._fake._correctSplit();},100);});this._setAutoResize=function(){};}
this.setInitWidths=function(wp){this.cellWidthType="px";this.initCellWidth=wp.split(this.delim);if(_isFF){for(var i=0;i<this.initCellWidth.length;i++)
if(this.initCellWidth[i]!="*")
this.initCellWidth[i]=parseInt(this.initCellWidth[i]);}}
this.enableMultiline=function(state){this.multiLine=dhx4.s2b(state);}
this.enableMultiselect=function(state){this.selMultiRows=dhx4.s2b(state);}
this.setImagePath=function(path){path=path.replace(/imgs\/dhxgrid_[a-z]*\/$/,"imgs/");this._imgURL=path;this.imgURL=path+"dhxgrid_"+(this.skin_name||"dhx_skyblue").replace("dhx_","")+"/";this.iconTree=this.imgURL+"tree/";}
this.setImagesPath=this.setImagePath;this.setIconPath=function(path){this.iconURL=path;}
this.setIconsPath=this.setIconPath;this.changeCursorState=function(ev){var el=ev.target||ev.srcElement;if(el.tagName!="TD")
el=this.getFirstParentOfType(el,"TD")
if(!el)return;if((el.tagName=="TD")&&(this._drsclmn)&&(!this._drsclmn[el._cellIndex]))
return el.style.cursor="default";var check=(ev.layerX||0)+(((!_isIE)&&(ev.target.tagName=="DIV"))?el.offsetLeft:0);if((el.offsetWidth-(ev.offsetX||(parseInt(this.getPosition(el,this.hdrBox))-check)*-1))<(_isOpera?20:10)){el.style.cursor="E-resize";}
else{el.style.cursor="default";}
if(_isOpera)
this.hdrBox.scrollLeft=this.objBox.scrollLeft;}
this.startColResize=function(ev){if(this.resized)this.stopColResize();this.resized=null;var el=ev.target||ev.srcElement;if(el.tagName!="TD")
el=this.getFirstParentOfType(el,"TD")
var x=ev.clientX;var tabW=this.hdr.offsetWidth;var startW=parseInt(el.offsetWidth)
if(el.tagName=="TD"&&el.style.cursor!="default"){if((this._drsclmn)&&(!this._drsclmn[el._cellIndex]))
return;self._old_d_mm=document.body.onmousemove;self._old_d_mu=document.body.onmouseup;document.body.onmousemove=function(e){if(self)
self.doColResize(e||window.event,el,startW,x,tabW)}
document.body.onmouseup=function(){if(self)
self.stopColResize();}}}
this.stopColResize=function(){document.body.onmousemove=self._old_d_mm||"";document.body.onmouseup=self._old_d_mu||"";this.setSizes();this.doOnScroll(0,1)
this.callEvent("onResizeEnd",[this]);}
this.doColResize=function(ev,el,startW,x,tabW){el.style.cursor="E-resize";this.resized=el;var fcolW=startW+(ev.clientX-x);var wtabW=tabW+(ev.clientX-x)
if(!(this.callEvent("onResize",[el._cellIndex,fcolW,this])))
return;if(_isIE)
this.objBox.scrollLeft=this.hdrBox.scrollLeft;var result=false;if(el.colSpan>1){var a_sizes=new Array();for(var i=0;i<el.colSpan;i++)a_sizes[i]=Math.round(fcolW*this.hdr.rows[0].childNodes[el._cellIndexS+i].offsetWidth/el.offsetWidth);for(var i=0;i<el.colSpan;i++)
result=this._setColumnSizeR(el._cellIndexS+i*1,a_sizes[i]);}else
result=this._setColumnSizeR(el._cellIndex,fcolW);this.doOnScroll(0,1);this.setSizes();if(this._fake&&this._awdth)this._fake._correctSplit();return result;}
this._setColumnSizeR=function(ind,fcolW){if(fcolW>((this._drsclmW&&!this._notresize)?(this._drsclmW[ind]||10):10)){this.obj.rows[0].childNodes[ind].style.width=fcolW+"px";this.hdr.rows[0].childNodes[ind].style.width=fcolW+"px";if(this.ftr)
this.ftr.rows[0].childNodes[ind].style.width=fcolW+"px";if(this.cellWidthType=='px'){this.cellWidthPX[ind]=fcolW;}
else{var gridWidth=parseInt(this.entBox.offsetWidth);if(this.objBox.scrollHeight>this.objBox.offsetHeight)
gridWidth-=17;var pcWidth=Math.round(fcolW/gridWidth*100)
this.cellWidthPC[ind]=pcWidth;}
if(this.sortImg.style.display!="none")
this.setSortImgPos();}else return false;}
this.setSortImgState=function(state,ind,order,row){order=(order||"asc").toLowerCase();if(!dhx4.s2b(state)){this.sortImg.style.display="none";if(this.r_fldSorted)
this.r_fldSorted.className="";this.fldSorted=this.r_fldSorted=null;return;}
if(order=="asc")
this.sortImg.className="dhxgrid_sort_asc";else
this.sortImg.className="dhxgrid_sort_desc";this.sortImg.style.display="";this.fldSorted=this.hdr.rows[0].childNodes[ind];var r=this.hdr.rows[row||1];if(!r)return;for(var i=0;i<r.childNodes.length;i++){if(r.childNodes[i]._cellIndexS==ind){this.r_fldSorted=r.childNodes[i];return this.setSortImgPos();}}
return this.setSortImgState(state,ind,order,(row||1)+1);}
this.setSortImgPos=function(ind,mode,hRowInd,el){if(this._hrrar&&this._hrrar[this.r_fldSorted?this.r_fldSorted._cellIndex:ind])return;if(this.ar_fldSorted)
this.ar_fldSorted.className="";if(!el){if(!ind)
var el=this.r_fldSorted;else
var el=this.hdr.rows[hRowInd||0].cells[ind];}
if(el!=null){var pos=this.getPosition(el,this.hdrBox)
var wdth=el.offsetWidth;this.ar_fldSorted=el;el.className=this.sortImg.className+"_col";this.sortImg.style.left=Number(pos[0]+wdth-13)+"px";this.sortImg.defLeft=parseInt(this.sortImg.style.left)
this.sortImg.style.top=Number(pos[1]+5)+"px";if((!this.useImagesInHeader)&&(!mode))
this.sortImg.style.display="inline";this.sortImg.style.left=this.sortImg.defLeft+"px";}}
this.setActive=function(fl){if(arguments.length==0)
var fl=true;if(fl==true){if(globalActiveDHTMLGridObject&&(globalActiveDHTMLGridObject!=this)){globalActiveDHTMLGridObject.editStop();globalActiveDHTMLGridObject.callEvent("onBlur",[globalActiveDHTMLGridObject]);}
globalActiveDHTMLGridObject=this;this.isActive=true;}else{this.isActive=false;this.callEvent("onBlur",[this]);}};this._doClick=function(ev){var selMethod=0;var el=this.getFirstParentOfType(_isIE?ev.srcElement:ev.target,"TD");if(!el||!el.parentNode||!el.parentNode.idd)return;var fl=true;if(this.markedCells){var markMethod=0;if(ev.shiftKey||ev.metaKey){markMethod=1;}
if(ev.ctrlKey){markMethod=2;}
this.doMark(el,markMethod);return true;}
if(this.selMultiRows!=false){if(ev.shiftKey&&this.row!=null&&this.selectedRows.length){selMethod=1;}
if(ev.ctrlKey||ev.metaKey){selMethod=2;}}
return this.doClick(el,fl,selMethod,false)};this._doContClick=function(ev){var el=this.getFirstParentOfType(_isIE?ev.srcElement:ev.target,"TD");if((!el)||(typeof(el.parentNode.idd)=="undefined")){this.callEvent("onEmptyClick",[ev]);return true;}
if(ev.button==2||(_isMacOS&&ev.ctrlKey)){if(!this.callEvent("onRightClick",[el.parentNode.idd,el._cellIndex,ev])){var z=function(e){(e||event).cancelBubble=true;return false;};(ev.srcElement||ev.target).oncontextmenu=z;return z(ev);}
if(this._ctmndx){if(!(this.callEvent("onBeforeContextMenu",[el.parentNode.idd,el._cellIndex,this])))
return true;if(_isIE)
ev.srcElement.oncontextmenu=function(){event.cancelBubble=true;return false;};if(this._ctmndx.showContextMenu){var dEl0=window.document.documentElement;var dEl1=window.document.body;var corrector=new Array((dEl0.scrollLeft||dEl1.scrollLeft),(dEl0.scrollTop||dEl1.scrollTop));if(_isIE){var x=ev.clientX+corrector[0];var y=ev.clientY+corrector[1];}else{var x=ev.pageX;var y=ev.pageY;}
this._ctmndx.showContextMenu(x-1,y-1)
this.contextID=this._ctmndx.contextMenuZoneId=el.parentNode.idd+"_"+el._cellIndex;this._ctmndx._skip_hide=true;}else{el.contextMenuId=el.parentNode.idd+"_"+el._cellIndex;el.contextMenu=this._ctmndx;el.a=this._ctmndx._contextStart;el.a(el,ev);el.a=null;}
ev.cancelBubble=true;return false;}}
else if(this._ctmndx){if(this._ctmndx.hideContextMenu)
this._ctmndx.hideContextMenu()
else
this._ctmndx._contextEnd();}
return true;}
this.doClick=function(el,fl,selMethod,show){if(!this.selMultiRows)selMethod=0;var psid=this.row?this.row.idd:0;this.setActive(true);if(!selMethod)
selMethod=0;if(this.cell!=null)
this.cell.className=this.cell.className.replace(/cellselected/g,"");if(el.tagName=="TD"){if(this.checkEvent("onSelectStateChanged"))
var initial=this.getSelectedId();var prow=this.row;if(selMethod==1){var elRowIndex=this.rowsCol._dhx_find(el.parentNode)
var lcRowIndex=this.rowsCol._dhx_find(this.lastClicked)
if(elRowIndex>lcRowIndex){var strt=lcRowIndex;var end=elRowIndex;}else{var strt=elRowIndex;var end=lcRowIndex;}
for(var i=0;i<this.rowsCol.length;i++)
if((i>=strt&&i<=end)){if(this.rowsCol[i]&&(!this.rowsCol[i]._sRow)){if(!this.rowsCol[i].idd)continue;if(this.rowsCol[i].className.indexOf("rowselected")==-1&&(this.callEvent("onBeforeSelect",[this.rowsCol[i].idd,psid,el._cellIndex]))){this.rowsCol[i].className+=" rowselected";this.selectedRows[this.selectedRows.length]=this.rowsCol[i]}}else{this.clearSelection();return this.doClick(el,fl,0,show);}}}else if(selMethod==2){if(el.parentNode.className.indexOf("rowselected")!=-1){el.parentNode.className=el.parentNode.className.replace(/rowselected/g,"");this.selectedRows._dhx_removeAt(this.selectedRows._dhx_find(el.parentNode))
var skipRowSelection=true;show=false;}}
this.editStop()
if(typeof(el.parentNode.idd)=="undefined")
return true;if((!skipRowSelection)&&(!el.parentNode._sRow)){if(this.callEvent("onBeforeSelect",[el.parentNode.idd,psid,el._cellIndex])){if(this.getSelectedRowId()!=el.parentNode.idd){if(selMethod==0)
this.clearSelection();this.cell=el;if((prow==el.parentNode)&&(this._chRRS))
fl=false;this.row=el.parentNode;this.row.className+=" rowselected"
if(this.selectedRows._dhx_find(this.row)==-1)
this.selectedRows[this.selectedRows.length]=this.row;}else{this.cell=el;this.row=el.parentNode;}}else fl=false;}
if(this.cell&&this.cell.parentNode.className.indexOf("rowselected")!=-1)
this.cell.className=this.cell.className.replace(/cellselected/g,"")+" cellselected";if(selMethod!=1)
if(!this.row)
return;this.lastClicked=el.parentNode;var rid=this.row.idd;var cid=this.cell;if(fl&&typeof(rid)!="undefined"&&cid&&!skipRowSelection){self.onRowSelectTime=setTimeout(function(){if(self.callEvent)
self.callEvent("onRowSelect",[rid,cid._cellIndex]);},100);}else this.callEvent("onRowSelectRSOnly",[rid]);if(this.checkEvent("onSelectStateChanged")){var afinal=this.getSelectedId();if(initial!=afinal)
this.callEvent("onSelectStateChanged",[afinal,initial]);}
if(skipRowSelection)return false;}
this.isActive=true;if(show!==false&&this.cell&&this.cell.parentNode.idd)
this.moveToVisible(this.cell)}
this.selectAll=function(){this.clearSelection();var coll=this.rowsBuffer;if(this.pagingOn)coll=this.rowsCol;for(var i=0;i<coll.length;i++){this.render_row(i).className+=" rowselected";}
this.selectedRows=dhtmlxArray([].concat(coll));if(this.selectedRows.length){this.row=this.selectedRows[0];this.cell=this.row.cells[0];}
if((this._fake)&&(!this._realfake))
this._fake.selectAll();}
this.selectCell=function(r,cInd,fl,preserve,edit,show){if(!fl)
fl=false;if(typeof(r)!="object")
r=this.render_row(r)
if(!r||r==-1)return null;if(r._childIndexes)
var c=r.childNodes[r._childIndexes[cInd]];else
var c=r.childNodes[cInd];if(!c)
c=r.childNodes[0];if(!this.markedCells){if(preserve)
this.doClick(c,fl,3,show)
else
this.doClick(c,fl,0,show)}
else
this.doMark(c,preserve?2:0);if(edit)
this.editCell();}
this.moveToVisible=function(cell_obj,onlyVScroll){if(this.pagingOn){var newPage=Math.floor(this.getRowIndex(cell_obj.parentNode.idd)/this.rowsBufferOutSize)+1;if(newPage!=this.currentPage)
this.changePage(newPage);}
try{if(cell_obj.offsetHeight){var distance=cell_obj.offsetLeft+cell_obj.offsetWidth+20;var scrollLeft=0;if(distance>(this.objBox.offsetWidth+this.objBox.scrollLeft)){if(cell_obj.offsetLeft>this.objBox.scrollLeft)
scrollLeft=cell_obj.offsetLeft-(this.objBox.offsetWidth-cell_obj.offsetWidth)+5}else if(cell_obj.offsetLeft<this.objBox.scrollLeft){distance-=cell_obj.offsetWidth*2/3;if(distance<this.objBox.scrollLeft)
scrollLeft=cell_obj.offsetLeft-5}
if((scrollLeft)&&(!onlyVScroll))
this.objBox.scrollLeft=scrollLeft;}
if(!cell_obj.offsetHeight){var mask=this._realfake?this._fake.rowsAr[cell_obj.parentNode.idd]:cell_obj.parentNode;distance=this.rowsBuffer._dhx_find(mask)*this._srdh;}
else
distance=cell_obj.offsetTop;var distancemax=distance+cell_obj.offsetHeight+38;if(distancemax>(this.objBox.offsetHeight+this.objBox.scrollTop)){var scrollTop=distance;}else if(distance<this.objBox.scrollTop){var scrollTop=distance-5}
if(scrollTop)
this.objBox.scrollTop=scrollTop;}
catch(er){}}
this.editCell=function(){if(this.editor&&this.cell==this.editor.cell)
return;this.editStop();if((this.isEditable!=true)||(!this.cell))
return false;var c=this.cell;if(c.parentNode._locked)
return false;this.editor=this.cells4(c);if(this.editor!=null){if(this.editor.isDisabled()){this.editor=null;return false;}
if(this.callEvent("onEditCell",[0,this.row.idd,this.cell._cellIndex])!=false&&this.editor.edit){this._Opera_stop=(new Date).valueOf();c.className+=" editable";this.editor.edit();this.callEvent("onEditCell",[1,this.row.idd,this.cell._cellIndex])}else{this.editor=null;}}}
this.editStop=function(mode){if(_isOpera)
if(this._Opera_stop){if((this._Opera_stop*1+50)>(new Date).valueOf())
return;this._Opera_stop=null;}
if(this.editor&&this.editor!=null){this.editor.cell.className=this.editor.cell.className.replace("editable","");if(mode){var t=this.editor.val;this.editor.detach();this.editor.setValue(t);this.editor=null;this.callEvent("onEditCancel",[this.row.idd,this.cell._cellIndex,t]);return;}
if(this.editor.detach())
this.cell.wasChanged=true;var g=this.editor;if(g==null)return;this.editor=null;var z=this.callEvent("onEditCell",[2,this.row.idd,this.cell._cellIndex,g.getValue(),g.val]);if((typeof(z)=="string")||(typeof(z)=="number"))
g[g.setImage?"setLabel":"setValue"](z);else if(!z)
g[g.setImage?"setLabel":"setValue"](g.val);if(this._ahgr&&this.multiLine)this.setSizes();}}
this._nextRowCell=function(row,dir,pos){row=this._nextRow((this._groups?this.rowsCol:this.rowsBuffer)._dhx_find(row),dir);if(!row)
return null;return row.childNodes[row._childIndexes?row._childIndexes[pos]:pos];}
this._getNextCell=function(acell,dir,i){acell=acell||this.cell;var arow=acell.parentNode;if(this._tabOrder){i=this._tabOrder[acell._cellIndex];if(typeof i!="undefined")
if(i<0)
acell=this._nextRowCell(arow,dir,Math.abs(i)-1);else
acell=arow.childNodes[i];}else{var i=acell._cellIndex+dir;if(i>=0&&i<this._cCount){if(arow._childIndexes)
i=arow._childIndexes[acell._cellIndex]+dir;acell=arow.childNodes[i];}else{acell=this._nextRowCell(arow,dir,(dir==1?0:(this._cCount-1)));}}
if(!acell){if((dir==1)&&this.tabEnd){this.tabEnd.focus();this.tabEnd.focus();this.setActive(false);}
if((dir==-1)&&this.tabStart){this.tabStart.focus();this.tabStart.focus();this.setActive(false);}
return null;}
if(acell.style.display!="none"&&(!this.smartTabOrder||!this.cells(acell.parentNode.idd,acell._cellIndex).isDisabled()))
return acell;return this._getNextCell(acell,dir);}
this._nextRow=function(ind,dir){var r=this.render_row(ind+dir);if(!r||r==-1)return null;if(r&&r.style.display=="none")
return this._nextRow(ind+dir,dir);return r;}
this.scrollPage=function(dir){if(!this.rowsBuffer.length)return;var master=this._realfake?this._fake:this;var new_ind=Math.floor((master._r_select||this.getRowIndex(this.row.idd)||0)+(dir)*this.objBox.offsetHeight/(this._srdh||20));if(new_ind<0)
new_ind=0;if(new_ind>=this.rowsBuffer.length)
new_ind=this.rowsBuffer.length-1;if(this._srnd&&!this.rowsBuffer[new_ind]){this.objBox.scrollTop+=Math.floor((dir)*this.objBox.offsetHeight/(this._srdh||20))*(this._srdh||20);if(this._fake)this._fake.objBox.scrollTop=this.objBox.scrollTop;master._r_select=new_ind;}else{this.selectCell(new_ind,this.cell._cellIndex,true,false,false,(this.multiLine||this._srnd));if(!this.multiLine&&!this._srnd&&!this._realfake){this.objBox.scrollTop=this.getRowById(this.getRowId(new_ind)).offsetTop;if(this._fake)this._fake.objBox.scrollTop=this.objBox.scrollTop;}
master._r_select=null;}}
this.doKey=function(ev){if(!ev)
return true;if((ev.target||ev.srcElement).value!==window.undefined){var zx=(ev.target||ev.srcElement);if(zx.className!="dhxcombo_input"&&((!zx.parentNode)||(zx.parentNode.className.indexOf("editable")==-1)))
return true;}
if((globalActiveDHTMLGridObject)&&(this!=globalActiveDHTMLGridObject))
return globalActiveDHTMLGridObject.doKey(ev);if(this.isActive==false){return true;}
if(this._htkebl)
return true;if(!this.callEvent("onKeyPress",[ev.keyCode,ev.ctrlKey,ev.shiftKey,ev]))
return false;var code="k"+ev.keyCode+"_"+(ev.ctrlKey?1:0)+"_"+(ev.shiftKey?1:0);if(this.cell){if(this._key_events[code]){if(false===this._key_events[code].call(this))
return true;if(ev.preventDefault)
ev.preventDefault();ev.cancelBubble=true;return false;}
if(this._key_events["k_other"])
this._key_events.k_other.call(this,ev);}
return true;}
this.selectRow=function(r,fl,preserve,show){if(typeof(r)!='object')
r=this.render_row(r);this.selectCell(r,0,fl,preserve,false,show)};this.wasDblClicked=function(ev){var el=this.getFirstParentOfType(_isIE?ev.srcElement:ev.target,"TD");if(el){var rowId=el.parentNode.idd;return this.callEvent("onRowDblClicked",[rowId,el._cellIndex,ev]);}}
this._onHeaderClick=function(e,el){var that=this.grid;el=el||that.getFirstParentOfType(_isIE?event.srcElement:e.target,"TD");if(this.grid.resized==null){if(!(this.grid.callEvent("onHeaderClick",[el._cellIndexS,(e||window.event)])))
return false;that.sortField(el._cellIndexS,false,el)}
this.grid.resized=null;}
this.deleteSelectedRows=function(){var num=this.selectedRows.length
if(num==0)
return;var tmpAr=this.selectedRows;this.selectedRows=dhtmlxArray()
for(var i=num-1;i>=0;i--){var node=tmpAr[i]
if(!this.deleteRow(node.idd,node)){this.selectedRows[this.selectedRows.length]=node;}
else{if(node==this.row){var ind=i;}}}
if(ind){try{if(ind+1>this.rowsCol.length)
ind--;this.selectCell(ind,0,true)}
catch(er){this.row=null
this.cell=null}}}
this.getSelectedRowId=function(){var selAr=new Array(0);var uni={};for(var i=0;i<this.selectedRows.length;i++){var id=this.selectedRows[i].idd;if(uni[id])
continue;selAr[selAr.length]=id;uni[id]=true;}
if(selAr.length==0)
return null;else
return selAr.join(this.delim);}
this.getSelectedCellIndex=function(){if(this.cell!=null)
return this.cell._cellIndex;else
return-1;}
this.getColWidth=function(ind){return parseInt(this.cellWidthPX[ind]);}
this.setColWidth=function(ind,value){if(value=="*")
this.initCellWidth[ind]="*";else{if(this._hrrar[ind])return;if(this.cellWidthType=='px')
this.cellWidthPX[ind]=parseInt(value);else
this.cellWidthPC[ind]=parseInt(value);}
this.setSizes();}
this.getRowIndex=function(row_id){for(var i=0;i<this.rowsBuffer.length;i++)
if(this.rowsBuffer[i]&&this.rowsBuffer[i].idd==row_id)
return i;return-1;}
this.getRowId=function(ind){return this.rowsBuffer[ind]?this.rowsBuffer[ind].idd:this.undefined;}
this.setRowId=function(ind,row_id){this.changeRowId(this.getRowId(ind),row_id)}
this.changeRowId=function(oldRowId,newRowId){if(oldRowId==newRowId)
return;var row=this.rowsAr[oldRowId]
row.idd=newRowId;if(this.UserData[oldRowId]){this.UserData[newRowId]=this.UserData[oldRowId]
this.UserData[oldRowId]=null;}
if(this._h2&&this._h2.get[oldRowId]){this._h2.get[newRowId]=this._h2.get[oldRowId];this._h2.get[newRowId].id=newRowId;delete this._h2.get[oldRowId];}
this.rowsAr[oldRowId]=null;this.rowsAr[newRowId]=row;for(var i=0;i<row.childNodes.length;i++)
if(row.childNodes[i]._code)
row.childNodes[i]._code=this._compileSCL(row.childNodes[i]._val,row.childNodes[i]);if(this._mat_links&&this._mat_links[oldRowId]){var a=this._mat_links[oldRowId];delete this._mat_links[oldRowId];for(var c in a)
for(var i=0;i<a[c].length;i++)
this._compileSCL(a[c][i].original,a[c][i]);}
this.callEvent("onRowIdChange",[oldRowId,newRowId]);}
this.setColumnIds=function(ids){this.columnIds=ids.split(this.delim)}
this.setColumnId=function(ind,id){this.columnIds[ind]=id;}
this.getColIndexById=function(id){for(var i=0;i<this.columnIds.length;i++)
if(this.columnIds[i]==id)
return i;}
this.getColumnId=function(cin){return this.columnIds[cin];}
this.getColumnLabel=function(cin,ind,hdr,raw){var z=(hdr||this.hdr).rows[(ind||0)+1];for(var i=0;i<z.cells.length;i++)
if(z.cells[i]._cellIndexS==cin)return raw?z.cells[i].firstChild.innerHTML:(_isIE?z.cells[i].innerText:z.cells[i].textContent);return"";};this.getColLabel=this.getColumnLabel;this.getFooterLabel=function(cin,ind,raw){return this.getColumnLabel(cin,ind,this.ftr,raw);}
this.setRowTextBold=function(row_id){var r=this.getRowById(row_id)
if(r)r.style.fontWeight="bold";}
this.setRowTextStyle=function(row_id,styleString){var r=this.getRowById(row_id)
if(!r)return;for(var i=0;i<r.childNodes.length;i++){var pfix=r.childNodes[i]._attrs["style"]||"";if((this._hrrar)&&(this._hrrar[i]))
pfix="display:none;";if(_isIE)
r.childNodes[i].style.cssText=pfix+"width:"+r.childNodes[i].style.width+";"+styleString;else
r.childNodes[i].style.cssText=pfix+"width:"+r.childNodes[i].style.width+";"+styleString;}}
this.setRowColor=function(row_id,color){var r=this.getRowById(row_id)
for(var i=0;i<r.childNodes.length;i++)r.childNodes[i].bgColor=color;}
this.setCellTextStyle=function(row_id,ind,styleString){var r=this.getRowById(row_id)
if(!r)
return;var cell=r.childNodes[r._childIndexes?r._childIndexes[ind]:ind];if(!cell)
return;var pfix="";if((this._hrrar)&&(this._hrrar[ind]))
pfix="display:none;";if(_isIE)
cell.style.cssText=pfix+"width:"+cell.style.width+";"+styleString;else
cell.style.cssText=pfix+"width:"+cell.style.width+";"+styleString;}
this.setRowTextNormal=function(row_id){var r=this.getRowById(row_id);if(r)r.style.fontWeight="normal";}
this.doesRowExist=function(row_id){if(this.getRowById(row_id)!=null)
return true
else
return false}
this.getColumnsNum=function(){return this._cCount;}
this.moveRowUp=function(row_id){var r=this.getRowById(row_id)
if(this.isTreeGrid())
return this.moveRowUDTG(row_id,-1);var rInd=this.rowsCol._dhx_find(r)
if((r.previousSibling)&&(rInd!=0)){r.parentNode.insertBefore(r,r.previousSibling)
this.rowsCol._dhx_swapItems(rInd,rInd-1)
this.setSizes();var bInd=this.rowsBuffer._dhx_find(r);this.rowsBuffer._dhx_swapItems(bInd,bInd-1);if(this._cssEven)
this._fixAlterCss(rInd-1);}}
this.moveRowDown=function(row_id){var r=this.getRowById(row_id)
if(this.isTreeGrid())
return this.moveRowUDTG(row_id,1);var rInd=this.rowsCol._dhx_find(r);if(r.nextSibling){this.rowsCol._dhx_swapItems(rInd,rInd+1)
if(r.nextSibling.nextSibling)
r.parentNode.insertBefore(r,r.nextSibling.nextSibling)
else
r.parentNode.appendChild(r)
this.setSizes();var bInd=this.rowsBuffer._dhx_find(r);this.rowsBuffer._dhx_swapItems(bInd,bInd+1);if(this._cssEven)
this._fixAlterCss(rInd);}}
this.getCombo=function(col_ind){if(!this.combos[col_ind]){this.combos[col_ind]=new dhtmlXGridComboObject();}
return this.combos[col_ind];}
this.setUserData=function(row_id,name,value){if(!row_id)
row_id="gridglobaluserdata";if(!this.UserData[row_id])
this.UserData[row_id]=new Hashtable()
this.UserData[row_id].put(name,value)}
this.getUserData=function(row_id,name){if(!row_id)
row_id="gridglobaluserdata";this.getRowById(row_id);var z=this.UserData[row_id];return(z?z.get(name):"");}
this.setEditable=function(fl){this.isEditable=dhx4.s2b(fl);}
this.selectRowById=function(row_id,multiFL,show,call){if(!call)
call=false;this.selectCell(this.getRowById(row_id),0,call,multiFL,false,show);}
this.clearSelection=function(){this.editStop()
for(var i=0;i<this.selectedRows.length;i++){var r=this.rowsAr[this.selectedRows[i].idd];if(r)
r.className=r.className.replace(/rowselected/g,"");}
this.selectedRows=dhtmlxArray()
this.row=null;if(this.cell!=null){this.cell.className=this.cell.className.replace(/cellselected/g,"");this.cell=null;}
this.callEvent("onSelectionCleared",[]);}
this.copyRowContent=function(from_row_id,to_row_id){var frRow=this.getRowById(from_row_id)
if(!this.isTreeGrid())
for(var i=0;i<frRow.cells.length;i++){this.cells(to_row_id,i).setValue(this.cells(from_row_id,i).getValue())}
else
this._copyTreeGridRowContent(frRow,from_row_id,to_row_id);if(!_isIE)
this.getRowById(from_row_id).cells[0].height=frRow.cells[0].offsetHeight}
this.setFooterLabel=function(c,label,ind){return this.setColumnLabel(c,label,ind,this.ftr);};this.setColumnLabel=function(c,label,ind,hdr){var z=(hdr||this.hdr).rows[ind||1];var col=(z._childIndexes?z._childIndexes[c]:c);if(!z.cells[col])return;if(!this.useImagesInHeader){var hdrHTML="<div class='hdrcell'>"
if(label.indexOf('img:[')!=-1){var imUrl=label.replace(/.*\[([^>]+)\].*/,"$1");label=label.substr(label.indexOf("]")+1,label.length)
hdrHTML+="<img width='18px' height='18px' align='absmiddle' src='"+imUrl+"' hspace='2'>"}
hdrHTML+=label;hdrHTML+="</div>";z.cells[col].innerHTML=hdrHTML;if(this._hstyles[c])
z.cells[col].style.cssText=this._hstyles[c];}else{z.cells[col].style.textAlign="left";z.cells[col].innerHTML="<img src='"+label+"'>";var a=new Image();a.src=""+label.replace(/(\.[a-z]+)/,".des$1");this.preloadImagesAr[this.preloadImagesAr.length]=a;var b=new Image();b.src=""+label.replace(/(\.[a-z]+)/,".asc$1");this.preloadImagesAr[this.preloadImagesAr.length]=b;}
if((label||"").indexOf("#")!=-1){var t=label.match(/(^|{)#([^}]+)(}|$)/);if(t){var tn="_in_header_"+t[2];if(this[tn])
this[tn]((this.forceDivInHeader?z.cells[col].firstChild:z.cells[col]),col,label.split(t[0]));}}};this.setColLabel=function(a,b,ind,c){return this.setColumnLabel(a,b,(ind||0)+1,c);};this.clearAll=function(header){if(!this.obj.rows[0])return;if(this._h2){this._h2=this._createHierarchy();if(this._fake){if(this._realfake)
this._h2=this._fake._h2;else
this._fake._h2=this._h2;}}
this.limit=this._limitC=0;this.editStop(true);if(this._dLoadTimer)
window.clearTimeout(this._dLoadTimer);if(this._dload){this.objBox.scrollTop=0;this.limit=this._limitC||0;this._initDrF=true;}
var len=this.rowsCol.length;len=this.obj.rows.length;for(var i=len-1;i>0;i--){var t_r=this.obj.rows[i];t_r.parentNode.removeChild(t_r);}
if(header){this._master_row=null;this.obj.rows[0].parentNode.removeChild(this.obj.rows[0]);for(var i=this.hdr.rows.length-1;i>=0;i--){var t_r=this.hdr.rows[i];t_r.parentNode.removeChild(t_r);}
if(this.ftr){this.ftr.parentNode.removeChild(this.ftr);this.ftr=null;}
this._aHead=this.ftr=this.cellWidth=this._aFoot=null;this.cellType=dhtmlxArray();this._hrrar=[];this.columnIds=[];this.combos=[];this._strangeParams=[];this.defVal=[];this._ivizcol=null;}
this.row=null;this.cell=null;this.rowsCol=dhtmlxArray()
this.rowsAr={};this._RaSeCol=[];this.rowsBuffer=dhtmlxArray()
this.UserData=[]
this.selectedRows=dhtmlxArray();if(this.pagingOn||this._srnd)
this.xmlFileUrl="";if(this.pagingOn)
this.changePage(1);if(this._contextCallTimer)
window.clearTimeout(this._contextCallTimer);if(this._sst)
this.enableStableSorting(true);this._fillers=this.undefined;this.setSortImgState(false);this.setSizes();this.callEvent("onClearAll",[]);}
this.sortField=function(ind,repeatFl,r_el){if(this.getRowsNum()==0)
return false;var el=this.hdr.rows[0].cells[ind];if(!el)
return;if(el.tagName=="TH"&&(this.fldSort.length-1)>=el._cellIndex&&this.fldSort[el._cellIndex]!='na'){var data=this.getSortingState();var sortType=(data[0]==ind&&data[1]=="asc")?"des":"asc";if(!this.callEvent("onBeforeSorting",[ind,this.fldSort[ind],sortType]))
return;this.sortImg.className="dhxgrid_sort_"+(sortType=="asc"?"asc":"desc");if(this.useImagesInHeader){var cel=this.hdr.rows[1].cells[el._cellIndex].firstChild;if(this.fldSorted!=null){var celT=this.hdr.rows[1].cells[this.fldSorted._cellIndex].firstChild;celT.src=celT.src.replace(/(\.asc\.)|(\.des\.)/,".");}
cel.src=cel.src.replace(/(\.[a-z]+)$/,"."+sortType+"$1")}
this.sortRows(el._cellIndex,this.fldSort[el._cellIndex],sortType)
this.fldSorted=el;if(r_el&&r_el.tagName.toLowerCase()!="th")
this.r_fldSorted=r_el;var c=this.hdr.rows[1];var c=r_el.parentNode;var real_el=c._childIndexes?c._childIndexes[el._cellIndex]:el._cellIndex;this.setSortImgPos(false,false,false,r_el);}}
this.setCustomSorting=function(func,col){if(!this._customSorts)
this._customSorts=new Array();this._customSorts[col]=(typeof(func)=="string")?eval(func):func;this.fldSort[col]="cus";}
this.enableHeaderImages=function(fl){this.useImagesInHeader=fl;}
this.setHeader=function(hdrStr,splitSign,styles){if(typeof(hdrStr)!="object")
var arLab=this._eSplit(hdrStr);else
arLab=[].concat(hdrStr);var arWdth=new Array(0);var arTyp=new dhtmlxArray(0);var arAlg=new Array(0);var arVAlg=new Array(0);var arSrt=new Array(0);for(var i=0;i<arLab.length;i++){arWdth[arWdth.length]=Math.round(100/arLab.length);arTyp[arTyp.length]="ed";arAlg[arAlg.length]="left";arVAlg[arVAlg.length]="middle";arSrt[arSrt.length]="na";}
this.splitSign=splitSign||"#cspan";this.hdrLabels=arLab;this.cellWidth=arWdth;if(!this.initCellWidth.length)this.setInitWidthsP(arWdth.join(this.delim),true);this.cellType=arTyp;this.cellAlign=arAlg;this.cellVAlign=arVAlg;this.fldSort=arSrt;this._hstyles=styles||[];}
this._eSplit=function(str){if(![].push)
return str.split(this.delim);var a="r"+(new Date()).valueOf();var z=this.delim.replace(/([\|\+\*\^])/g,"\\$1")
return(str||"").replace(RegExp(z,"g"),a).replace(RegExp("\\\\"+a,"g"),this.delim).split(a);}
this.getColType=function(cInd){return this.cellType[cInd];}
this.getColTypeById=function(cID){return this.cellType[this.getColIndexById(cID)];}
this.setColTypes=function(typeStr){this.cellType=dhtmlxArray(typeStr.split(this.delim));this._strangeParams=new Array();for(var i=0;i<this.cellType.length;i++){if((this.cellType[i].indexOf("[")!=-1)){var z=this.cellType[i].split(/[\[\]]+/g);this.cellType[i]=z[0];this.defVal[i]=z[1];if(z[1].indexOf("=")==0){this.cellType[i]="math";this._strangeParams[i]=z[0];}}
if(!window["eXcell_"+this.cellType[i]])dhx4.callEvent("onConfigurationError",["Incorrect cell type: "+this.cellType[i],this,this.cellType[i]]);}}
this.setColSorting=function(sortStr){this.fldSort=sortStr.split(this.delim)
var check={str:1,"int":1,date:1};for(var i=0;i<this.fldSort.length;i++)
if((!check[this.fldSort[i]])&&(typeof(window[this.fldSort[i]])=="function")){if(!this._customSorts)
this._customSorts=new Array();this._customSorts[i]=window[this.fldSort[i]];this.fldSort[i]="cus";}}
this.setColAlign=function(alStr){this.cellAlign=alStr.split(this.delim)
for(var i=0;i<this.cellAlign.length;i++)
this.cellAlign[i]=this.cellAlign[i]._dhx_trim();}
this.setColVAlign=function(valStr){this.cellVAlign=valStr.split(this.delim)}
this.setNoHeader=function(fl){this.noHeader=dhx4.s2b(fl);}
this.showRow=function(rowID){this.getRowById(rowID)
if(this._h2)this.openItem(this._h2.get[rowID].parent.id);var c=this.getRowById(rowID).childNodes[0];while(c&&c.style.display=="none")
c=c.nextSibling;if(c)
this.moveToVisible(c,true)}
this.setStyle=function(ss_header,ss_grid,ss_selCell,ss_selRow){this.ssModifier=[ss_header,ss_grid,ss_selCell,ss_selCell,ss_selRow];var prefs=["#"+this.entBox.id+" table.hdr td","#"+this.entBox.id+" table.obj td","#"+this.entBox.id+" table.obj tr.rowselected td.cellselected","#"+this.entBox.id+" table.obj td.cellselected","#"+this.entBox.id+" table.obj tr.rowselected td"];var index=0;while(!_isIE){try{var temp=document.styleSheets[index].cssRules.length;}catch(e){index++;continue;}
break;}
for(var i=0;i<prefs.length;i++)
if(this.ssModifier[i]){if(_isIE)
document.styleSheets[0].addRule(prefs[i],this.ssModifier[i]);else
document.styleSheets[index].insertRule(prefs[i]+(" { "+this.ssModifier[i]+" }"),document.styleSheets[index].cssRules.length);}}
this.setColumnColor=function(clr){this.columnColor=clr.split(this.delim)}
this.enableAlterCss=function(cssE,cssU,perLevel,levelUnique){if(cssE||cssU)
this.attachEvent("onGridReconstructed",function(){this._fixAlterCss();if(this._fake)
this._fake._fixAlterCss();});this._cssSP=perLevel;this._cssSU=levelUnique;this._cssEven=cssE;this._cssUnEven=cssU;}
this._fixAlterCss=function(ind){if(this._h2&&(this._cssSP||this._cssSU))
return this._fixAlterCssTGR(ind);if(!this._cssEven&&!this._cssUnEven)return;ind=ind||0;var j=ind;for(var i=ind;i<this.rowsCol.length;i++){if(!this.rowsCol[i])
continue;if(this.rowsCol[i].style.display!="none"){if(this.rowsCol[i]._cntr){j=1;continue;}
if(this.rowsCol[i].className.indexOf("rowselected")!=-1){if(j%2==1)
this.rowsCol[i].className=this._cssUnEven+" rowselected "+(this.rowsCol[i]._css||"");else
this.rowsCol[i].className=this._cssEven+" rowselected "+(this.rowsCol[i]._css||"");}else{if(j%2==1)
this.rowsCol[i].className=this._cssUnEven+" "+(this.rowsCol[i]._css||"");else
this.rowsCol[i].className=this._cssEven+" "+(this.rowsCol[i]._css||"");}
j++;}}}
this.clearChangedState=function(){for(var i=0;i<this.rowsCol.length;i++){var row=this.rowsCol[i];if(row&&row.childNodes){var cols=row.childNodes.length;for(var j=0;j<cols;j++)row.childNodes[j].wasChanged=false;}}};this.getChangedRows=function(and_added){var res=new Array();this.forEachRow(function(id){var row=this.rowsAr[id];if(row.tagName!="TR")return;var cols=row.childNodes.length;if(and_added&&row._added)
res[res.length]=row.idd;else
for(var j=0;j<cols;j++)
if(row.childNodes[j].wasChanged){res[res.length]=row.idd;break;}})
return res.join(this.delim);};this._sUDa=false;this._sAll=false;this.setSerializationLevel=function(userData,fullXML,config,changedAttr,onlyChanged,asCDATA){this._sUDa=userData;this._sAll=fullXML;this._sConfig=config;this._chAttr=changedAttr;this._onlChAttr=onlyChanged;this._asCDATA=asCDATA;}
this.setSerializableColumns=function(list){if(!list){this._srClmn=null;return;}
this._srClmn=(list||"").split(",");for(var i=0;i<this._srClmn.length;i++)this._srClmn[i]=dhx4.s2b(this._srClmn[i]);}
this._serialise=function(rCol,inner,closed){this.editStop()
var out=[];var close="</"+this.xml.s_row+">"
if(this.isTreeGrid()){this._h2.forEachChildF(0,function(el){var temp=this._serializeRow(this.render_row_tree(-1,el.id));out.push(temp);if(temp)
return true;else
return false;},this,function(){out.push(close);});}
else
for(var i=0;i<this.rowsBuffer.length;i++)
if(this.rowsBuffer[i]){if(this._chAttr&&this.rowsBuffer[i]._locator)
continue;var temp=this._serializeRow(this.render_row(i));out.push(temp);if(temp)
out.push(close);}
return[out.join("")];}
this._serializeRow=function(r,i){var out=[];var ra=this.xml.row_attrs;var ca=this.xml.cell_attrs;out.push("<"+this.xml.s_row);out.push(" id='"+r.idd+"'");if((this._sAll)&&this.selectedRows._dhx_find(r)!=-1)
out.push(" selected='1'");if(this._h2&&this._h2.get[r.idd].state=="minus")
out.push(" open='1'");if(ra.length)
for(var i=0;i<ra.length;i++)out.push(" "+ra[i]+"='"+r._attrs[ra[i]]+"'");out.push(">");if(this._sUDa&&this.UserData[r.idd]){keysAr=this.UserData[r.idd].getKeys()
for(var ii=0;ii<keysAr.length;ii++){var subkey=keysAr[ii];if(subkey.indexOf("__")!==0)
out.push("<userdata name='"+subkey+"'>"+(this._asCDATA?"<![CDATA[":"")+this.UserData[r.idd].get(subkey)+(this._asCDATA?"]]>":"")+"</userdata>");}}
var changeFl=false;for(var jj=0;jj<this._cCount;jj++){if((!this._srClmn)||(this._srClmn[jj])){var zx=this.cells3(r,jj);out.push("<cell");if(ca.length)
for(var i=0;i<ca.length;i++)out.push(" "+ca[i]+"='"+zx.cell._attrs[ca[i]]+"'");zxVal=zx[this._agetm]();if(this._asCDATA)
zxVal="<![CDATA["+zxVal+"]]>";if((this._ecspn)&&(zx.cell.colSpan)&&zx.cell.colSpan>1)
out.push(" colspan=\""+zx.cell.colSpan+"\" ");if(this._chAttr){if(zx.wasChanged()){out.push(" changed=\"1\"");changeFl=true;}}
else if((this._onlChAttr)&&(zx.wasChanged()))
changeFl=true;if(this._sAll&&this.cellType[jj]=="tree")
out.push((this._h2?(" image='"+this._h2.get[r.idd].image+"'"):"")+">"+zxVal+"</cell>");else
out.push(">"+zxVal+"</cell>");if((this._ecspn)&&(zx.cell.colSpan))
for(var u=0;u<zx.cell.colSpan-1;u++){out.push("<cell/>");jj++;}}}
if((this._onlChAttr)&&(!changeFl)&&(!r._added))
return"";return out.join("");}
this._serialiseConfig=function(){var out="<head>";for(var i=0;i<this.hdr.rows[0].cells.length;i++){if(this._srClmn&&!this._srClmn[i])continue;var sort=this.fldSort[i];if(sort=="cus"){sort=this._customSorts[i].toString();sort=sort.replace(/function[\ ]*/,"").replace(/\([^\f]*/,"");}
out+="<column width='"+this.getColWidth(i)+"' align='"+this.cellAlign[i]+"' type='"+this.cellType[i]
+"' sort='"+(sort||"na")+"' color='"+(this.columnColor[i]||"")+"'"
+(this.columnIds[i]?(" id='"+this.columnIds[i]+"'"):"")+">";if(this._asCDATA)
out+="<![CDATA["+this.getColumnLabel(i)+"]]>";else
out+=this.getColumnLabel(i);var z=this.getCombo(i);if(z)
for(var j=0;j<z.keys.length;j++)out+="<option value='"+z.keys[j]+"'>"+z.values[j]+"</option>";out+="</column>"}
return out+="</head>";}
this.serialize=function(){var out='<?xml version="1.0"?><rows>';if(this._mathSerialization)
this._agetm="getMathValue";else
this._agetm="getValue";if(this._sUDa&&this.UserData["gridglobaluserdata"]){var keysAr=this.UserData["gridglobaluserdata"].getKeys()
for(var i=0;i<keysAr.length;i++)out+="<userdata name='"+keysAr[i]+"'>"+this.UserData["gridglobaluserdata"].get(keysAr[i])
+"</userdata>";}
if(this._sConfig)
out+=this._serialiseConfig();out+=this._serialise();out+='</rows>';return out;}
this.getPosition=function(oNode,pNode){if(!pNode){var pos=dhx4.getOffset(oNode);return[pos.left,pos.top];}
pNode=pNode||document.body;var oCurrentNode=oNode;var iLeft=0;var iTop=0;while((oCurrentNode)&&(oCurrentNode!=pNode)){iLeft+=oCurrentNode.offsetLeft-oCurrentNode.scrollLeft;iTop+=oCurrentNode.offsetTop-oCurrentNode.scrollTop;oCurrentNode=oCurrentNode.offsetParent;}
if(pNode==document.body){if(_isIE){iTop+=document.body.offsetTop||document.documentElement.offsetTop;iLeft+=document.body.offsetLeft||document.documentElement.offsetLeft;}else if(!_isFF){iLeft+=document.body.offsetLeft;iTop+=document.body.offsetTop;}}
return[iLeft,iTop];}
this.getFirstParentOfType=function(obj,tag){while(obj&&obj.tagName!=tag&&obj.tagName!="BODY"){obj=obj.parentNode;}
return obj;}
this.objBox.onscroll=function(){this.grid._doOnScroll();};this.hdrBox.onscroll=function(){if(this._try_header_sync)return;this._try_header_sync=true;if(Math.abs(this.grid.objBox.scrollLeft-this.scrollLeft)>1){this.grid.objBox.scrollLeft=this.scrollLeft;}
this._try_header_sync=false;}
if((!_isOpera)||(_OperaRv>8.5)){this.hdr.onmousemove=function(e){this.grid.changeCursorState(e||window.event);};this.hdr.onmousedown=function(e){return this.grid.startColResize(e||window.event);};}
this.obj.onmousemove=this._drawTooltip;this.objBox.onclick=function(e){e=e||event;e.cancelBubble=true;this.firstChild.grid.setActive(true);window.dhx4.callEvent("_onGridClick",[e,this.firstChild.grid]);};this.obj.onclick=function(e){if(this.grid._doClick(e||window.event)!==false){if(this.grid._sclE)
this.grid.editCell(e||window.event);else
this.grid.editStop();}
e=e||event;e.cancelBubble=true;window.dhx4.callEvent("_onGridClick",[e,this.grid]);};if(_isMacOS){this.entBox.oncontextmenu=function(e){e.cancelBubble=true;if(e.preventDefault)e.preventDefault();else e.returnValue=false;var that=this.grid;if(that._realfake)that=that._fake;return that._doContClick(e||window.event);};}else{this.entBox.onmousedown=function(e){return this.grid._doContClick(e||window.event);};this.entBox.oncontextmenu=function(e){if(this.grid._ctmndx)
(e||event).cancelBubble=true;return!this.grid._ctmndx;};}
this.obj.ondblclick=function(e){if(!this.grid.wasDblClicked(e||window.event))
return false;if(this.grid._dclE){var row=this.grid.getFirstParentOfType((_isIE?event.srcElement:e.target),"TR");if(row==this.grid.row)
this.grid.editCell(e||window.event);}
(e||event).cancelBubble=true;if(_isOpera)return false;};this.hdr.onclick=this._onHeaderClick;this.sortImg.onclick=function(){self._onHeaderClick.apply({grid:self},[null,self.r_fldSorted]);};this.hdr.ondblclick=this._onHeaderDblClick;if(!document.body._dhtmlxgrid_onkeydown){dhtmlxEvent(document,"keydown",function(e){if(globalActiveDHTMLGridObject)
return globalActiveDHTMLGridObject.doKey(e||window.event);});document.body._dhtmlxgrid_onkeydown=true;}
dhtmlxEvent(document.body,"click",function(){if(self.editStop)self.editStop();if(self.isActive)self.setActive(false);});if(this.entBox.style.height.toString().indexOf("%")!=-1)
this._delta_y=this.entBox.style.height;if(this.entBox.style.width.toString().indexOf("%")!=-1)
this._delta_x=this.entBox.style.width;if(this._delta_x||this._delta_y)
this._setAutoResize();this.setColHidden=this.setColumnsVisibility
this.enableCollSpan=this.enableColSpan
this.setMultiselect=this.enableMultiselect;this.setMultiLine=this.enableMultiline;this.deleteSelectedItem=this.deleteSelectedRows;this.getSelectedId=this.getSelectedRowId;this.getHeaderCol=this.getColumnLabel;this.isItemExists=this.doesRowExist;this.getColumnCount=this.getColumnsNum;this.setSelectedRow=this.selectRowById;this.setHeaderCol=this.setColumnLabel;this.preventIECashing=this.preventIECaching;this.enableAutoHeigth=this.enableAutoHeight;this.getUID=this.uid;if(dhtmlx.image_path)this.setImagePath(dhtmlx.image_path);if(dhtmlx.skin)this.setSkin(dhtmlx.skin);return this;}
dhtmlXGridObject.prototype={getRowAttribute:function(id,name){return this.getRowById(id)._attrs[name];},setRowAttribute:function(id,name,value){this.getRowById(id)._attrs[name]=value;},isTreeGrid:function(){return(this.cellType._dhx_find("tree")!=-1);},setRowHidden:function(id,state){var f=dhx4.s2b(state);var row=this.getRowById(id)
if(!row)
return;if(row.expand==="")
this.collapseKids(row);if((state)&&(row.style.display!="none")){row.style.display="none";var z=this.selectedRows._dhx_find(row);if(z!=-1){row.className=row.className.replace("rowselected","");for(var i=0;i<row.childNodes.length;i++)row.childNodes[i].className=row.childNodes[i].className.replace(/cellselected/g,"");this.selectedRows._dhx_removeAt(z);}
this.callEvent("onGridReconstructed",[]);}
if((!state)&&(row.style.display=="none")){row.style.display="";this.callEvent("onGridReconstructed",[]);}
this.callEvent("onRowHide",[id,state]);this.setSizes();},setColumnHidden:function(ind,state){if(!this.hdr.rows.length){if(!this._ivizcol)
this._ivizcol=[];return this._ivizcol[ind]=state;}
if((this.fldSorted)&&(this.fldSorted.cellIndex==ind)&&(state))
this.sortImg.style.display="none";var f=dhx4.s2b(state);if(f){if(!this._hrrar)
this._hrrar=new Array();else if(this._hrrar[ind])
return;this._hrrar[ind]="display:none;";this._hideShowColumn(ind,"none");}else{if((!this._hrrar)||(!this._hrrar[ind]))
return;this._hrrar[ind]="";this._hideShowColumn(ind,"");}
if((this.fldSorted)&&(this.fldSorted.cellIndex==ind)&&(!state))
this.sortImg.style.display="inline";this.setSortImgPos();this.callEvent("onColumnHidden",[ind,state])},isColumnHidden:function(ind){if((this._hrrar)&&(this._hrrar[ind]))
return true;return false;},setColumnsVisibility:function(list){if(list)
this._ivizcol=list.split(this.delim);if(this.hdr.rows.length&&this._ivizcol)
for(var i=0;i<this._ivizcol.length;i++)this.setColumnHidden(i,this._ivizcol[i]);},_fixHiddenRowsAll:function(pb,ind,prop,state,index){index=index||"_cellIndex";var z=pb.rows.length;for(var i=0;i<z;i++){var x=pb.rows[i].childNodes;if(x.length!=this._cCount){for(var j=0;j<x.length;j++)
if(x[j][index]==ind){x[j].style[prop]=state;break;}}else
x[ind].style[prop]=state;}},_hideShowColumn:function(ind,state){var hind=ind;if(this.hdr.rows[1]&&(this.hdr.rows[1]._childIndexes)&&(this.hdr.rows[1]._childIndexes[ind]!=ind))
hind=this.hdr.rows[1]._childIndexes[ind];if(state=="none"){this.hdr.rows[0].cells[ind]._oldWidth=this.hdr.rows[0].cells[ind].style.width||(this.initCellWidth[ind]+"px");this.hdr.rows[0].cells[ind]._oldWidthP=this.cellWidthPC[ind];this.obj.rows[0].cells[ind].style.width="0px";var t={rows:[this.obj.rows[0]]}
this.forEachRow(function(id){if(this.rowsAr[id].tagName=="TR")
t.rows.push(this.rowsAr[id])})
this._fixHiddenRowsAll(t,ind,"display","none");if(this.isTreeGrid())
this._fixHiddenRowsAllTG(ind,"none");if((_isOpera&&_OperaRv<9)||_isKHTML||(_isFF)){this._fixHiddenRowsAll(this.hdr,ind,"display","none","_cellIndexS");}
if(this.ftr)
this._fixHiddenRowsAll(this.ftr.childNodes[0],ind,"display","none");this._fixHiddenRowsAll(this.hdr,ind,"whiteSpace","nowrap","_cellIndexS");if(!this.cellWidthPX.length&&!this.cellWidthPC.length)
this.cellWidthPX=[].concat(this.initCellWidth);if(this.cellWidthPX[ind])
this.cellWidthPX[ind]=0;if(this.cellWidthPC[ind])
this.cellWidthPC[ind]=0;}else{if(this.hdr.rows[0].cells[ind]._oldWidth){var zrow=this.hdr.rows[0].cells[ind];if(_isOpera||_isKHTML||(_isFF))
this._fixHiddenRowsAll(this.hdr,ind,"display","","_cellIndexS");if(this.ftr)
this._fixHiddenRowsAll(this.ftr.childNodes[0],ind,"display","");var t={rows:[this.obj.rows[0]]}
this.forEachRow(function(id){if(this.rowsAr[id].tagName=="TR")
t.rows.push(this.rowsAr[id])})
this._fixHiddenRowsAll(t,ind,"display","");if(this.isTreeGrid())
this._fixHiddenRowsAllTG(ind,"");this._fixHiddenRowsAll(this.hdr,ind,"whiteSpace","normal","_cellIndexS");if(zrow._oldWidthP)
this.cellWidthPC[ind]=zrow._oldWidthP;if(zrow._oldWidth)
this.cellWidthPX[ind]=parseInt(zrow._oldWidth);}}
if(!state&&this._realfake)
this.setColumnSizes(this.entBox.clientWidth);this.setSizes();if((!_isIE)&&(!_isFF)){this.obj.border=1;this.obj.border=0;}},enableColSpan:function(mode){this._ecspn=dhx4.s2b(mode);},enableRowsHover:function(mode,cssClass){this._unsetRowHover(false,true);this._hvrCss=cssClass;if(dhx4.s2b(mode)){if(!this._elmnh){this.obj._honmousemove=this.obj.onmousemove;this.obj.onmousemove=this._setRowHover;if(_isIE)
this.obj.onmouseleave=this._unsetRowHover;else
this.obj.onmouseout=this._unsetRowHover;this._elmnh=true;}}else{if(this._elmnh){this.obj.onmousemove=this.obj._honmousemove;if(_isIE)
this.obj.onmouseleave=null;else
this.obj.onmouseout=null;this._elmnh=false;}}},enableEditEvents:function(click,dblclick,f2Key){this._sclE=dhx4.s2b(click);this._dclE=dhx4.s2b(dblclick);this._f2kE=dhx4.s2b(f2Key);},enableLightMouseNavigation:function(mode){if(dhx4.s2b(mode)){if(!this._elmn){this.entBox._onclick=this.entBox.onclick;this.entBox.onclick=function(){return true;};this.obj._onclick=this.obj.onclick;this.obj.onclick=function(e){var c=this.grid.getFirstParentOfType(e?e.target:event.srcElement,'TD');if(!c)return;this.grid.editStop();this.grid.doClick(c);this.grid.editCell();(e||event).cancelBubble=true;}
this.obj._onmousemove=this.obj.onmousemove;this.obj.onmousemove=this._autoMoveSelect;this._elmn=true;}}else{if(this._elmn){this.entBox.onclick=this.entBox._onclick;this.obj.onclick=this.obj._onclick;this.obj.onmousemove=this.obj._onmousemove;this._elmn=false;}}},_unsetRowHover:function(e,c){if(c)
that=this;else
that=this.grid;if((that._lahRw)&&(that._lahRw!=c)){for(var i=0;i<that._lahRw.childNodes.length;i++)that._lahRw.childNodes[i].className=that._lahRw.childNodes[i].className.replace(that._hvrCss,"");that._lahRw=null;}},_setRowHover:function(e){var c=this.grid.getFirstParentOfType(e?e.target:event.srcElement,'TD');if(c&&c.parentNode!=this.grid._lahRw){this.grid._unsetRowHover(0,c);c=c.parentNode;if(!c.idd||c.idd=="__filler__")return;for(var i=0;i<c.childNodes.length;i++)c.childNodes[i].className+=" "+this.grid._hvrCss;this.grid._lahRw=c;}
this._honmousemove(e);},_autoMoveSelect:function(e){if(!this.grid.editor){var c=this.grid.getFirstParentOfType(e?e.target:event.srcElement,'TD');if(c.parentNode.idd)
this.grid.doClick(c,true,0);}
this._onmousemove(e);},enableDistributedParsing:function(mode,count,time){if(dhx4.s2b(mode)){this._ads_count=count||10;this._ads_time=time||250;}else
this._ads_count=0;},destructor:function(){this.editStop(true);if(this._sizeTime)
this._sizeTime=window.clearTimeout(this._sizeTime);this.entBox.className=(this.entBox.className||"").replace(/gridbox.*/,"");if(this.formInputs)
for(var i=0;i<this.formInputs.length;i++)this.parentForm.removeChild(this.formInputs[i]);var a;for(var i=0;i<this.rowsCol.length;i++)
if(this.rowsCol[i])
this.rowsCol[i].grid=null;for(i in this.rowsAr)
if(this.rowsAr[i])
this.rowsAr[i]=null;this.rowsCol=new dhtmlxArray();this.rowsAr={};this.entBox.innerHTML="";var dummy=function(){};this.entBox.onclick=this.entBox.onmousedown=this.entBox.onbeforeactivate=this.entBox.onbeforedeactivate=this.entBox.onbeforedeactivate=this.entBox.onselectstart=dummy;this.setSizes=this._update_srnd_view=this.callEvent=dummy;this.entBox.grid=this.objBox.grid=this.hdrBox.grid=this.obj.grid=this.hdr.grid=null;if(this._fake){this.globalBox.innerHTML="";this._fake.setSizes=this._fake._update_srnd_view=this._fake.callEvent=dummy;this.globalBox.onclick=this.globalBox.onmousedown=this.globalBox.onbeforeactivate=this.globalBox.onbeforedeactivate=this.globalBox.onbeforedeactivate=this.globalBox.onselectstart=dummy;}
for(a in this){if((this[a])&&(this[a].m_obj))
this[a].m_obj=null;this[a]=null;}
if(this==globalActiveDHTMLGridObject)
globalActiveDHTMLGridObject=null;return null;},getSortingState:function(){var z=new Array();if(this.fldSorted){z[0]=this.fldSorted._cellIndex;z[1]=(this.sortImg.className=="dhxgrid_sort_desc"?"des":"asc");}
return z;},enableAutoHeight:function(mode,maxHeight,countFullHeight){this._ahgr=dhx4.s2b(mode);this._ahgrF=dhx4.s2b(countFullHeight);this._ahgrM=maxHeight||null;if(arguments.length==1){this.objBox.style.overflowY=mode?"hidden":"auto";}
if(maxHeight=="auto"){this._ahgrM=null;this._ahgrMA=true;this._setAutoResize();}},enableStableSorting:function(mode){this._sst=dhx4.s2b(mode);this.rowsCol.stablesort=function(cmp){var size=this.length-1;for(var i=0;i<this.length-1;i++){for(var j=0;j<size;j++)
if(cmp(this[j],this[j+1])>0){var temp=this[j];this[j]=this[j+1];this[j+1]=temp;}
size--;}}},enableKeyboardSupport:function(mode){this._htkebl=!dhx4.s2b(mode);},enableContextMenu:function(menu){this._ctmndx=menu;},setScrollbarWidthCorrection:function(width){},enableTooltips:function(list){this._enbTts=list.split(",");for(var i=0;i<this._enbTts.length;i++)this._enbTts[i]=dhx4.s2b(this._enbTts[i]);},enableResizing:function(list){this._drsclmn=list.split(",");for(var i=0;i<this._drsclmn.length;i++)this._drsclmn[i]=dhx4.s2b(this._drsclmn[i]);},setColumnMinWidth:function(width,ind){if(arguments.length==2){if(!this._drsclmW)
this._drsclmW=new Array();this._drsclmW[ind]=width;}else
this._drsclmW=width.split(",");},enableCellIds:function(mode){this._enbCid=dhx4.s2b(mode);},lockRow:function(rowId,mode){var z=this.getRowById(rowId);if(z){z._locked=dhx4.s2b(mode);if((this.cell)&&(this.cell.parentNode.idd==rowId))
this.editStop();}},_getRowArray:function(row){var text=new Array();for(var ii=0;ii<row.childNodes.length;ii++){var a=this.cells3(row,ii);text[ii]=a.getValue();}
return text;},setDateFormat:function(mask,incoming){this._dtmask=mask;this._dtmask_inc=incoming;},setNumberFormat:function(mask,cInd,p_sep,d_sep){var nmask=mask.replace(/[^0\,\.]*/g,"");var pfix=nmask.indexOf(".");if(pfix>-1)
pfix=nmask.length-pfix-1;var dfix=nmask.indexOf(",");if(dfix>-1)
dfix=nmask.length-pfix-2-dfix;if(typeof p_sep!="string")
p_sep=this.i18n.decimal_separator;if(typeof d_sep!="string")
d_sep=this.i18n.group_separator;var pref=mask.split(nmask)[0];var postf=mask.split(nmask)[1];this._maskArr[cInd]=[pfix,dfix,pref,postf,p_sep,d_sep];},_aplNFb:function(data,ind){var a=this._maskArr[ind];if(!a)
return data;var ndata=parseFloat(data.toString().replace(/[^0-9]*/g,""));if(data.toString().substr(0,1)=="-")
ndata=ndata*-1;if(a[0]>0)
ndata=ndata/Math.pow(10,a[0]);return ndata;},_aplNF:function(data,ind){var a=this._maskArr[ind];if(!a)
return data;var c=(parseFloat(data)<0?"-":"")+a[2];data=Math.abs(Math.round(parseFloat(data)*Math.pow(10,a[0]>0?a[0]:0))).toString();data=(data.length<a[0]?Math.pow(10,a[0]+1-data.length).toString().substr(1,a[0]+1)+data.toString():data).split("").reverse();data[a[0]]=(data[a[0]]||"0")+a[4];if(a[1]>0)
for(var j=(a[0]>0?0:1)+a[0]+a[1];j<data.length;j+=a[1])data[j]+=a[5];return c+data.reverse().join("")+a[3];},_launchCommands:function(arr){for(var i=0;i<arr.length;i++){var args=new Array();for(var j=0;j<arr[i].childNodes.length;j++)
if(arr[i].childNodes[j].nodeType==1)
args[args.length]=arr[i].childNodes[j].firstChild.data;this[arr[i].getAttribute("command")].apply(this,args);}},_parseHead:function(xmlDoc){var hheadCol=dhx4.ajax.xpath("./head",xmlDoc);if(hheadCol.length){var headCol=dhx4.ajax.xpath("./column",hheadCol[0]);var asettings=dhx4.ajax.xpath("./settings",hheadCol[0]);var awidthmet="setInitWidths";var split=false;if(asettings[0]){for(var s=0;s<asettings[0].childNodes.length;s++)switch(asettings[0].childNodes[s].tagName){case"colwidth":if(asettings[0].childNodes[s].firstChild&&asettings[0].childNodes[s].firstChild.data=="%")
awidthmet="setInitWidthsP";break;case"splitat":split=(asettings[0].childNodes[s].firstChild?asettings[0].childNodes[s].firstChild.data:false);break;}}
this._launchCommands(dhx4.ajax.xpath("./beforeInit/call",hheadCol[0]));if(headCol.length>0){if(this.hdr.rows.length>0)this.clearAll(true);var sets=[[],[],[],[],[],[],[],[],[]];var attrs=["","width","type","align","sort","color","format","hidden","id"];var calls=["",awidthmet,"setColTypes","setColAlign","setColSorting","setColumnColor","","","setColumnIds"];for(var i=0;i<headCol.length;i++){for(var j=1;j<attrs.length;j++)sets[j].push(headCol[i].getAttribute(attrs[j]));sets[0].push((headCol[i].firstChild?headCol[i].firstChild.data:"").replace(/^\s*((\s\S)*.+)\s*$/gi,"$1"));};this.setHeader(sets[0]);for(var i=0;i<calls.length;i++)
if(calls[i])
this[calls[i]](sets[i].join(this.delim))
for(var i=0;i<headCol.length;i++){if((this.cellType[i].indexOf('co')==0)||(this.cellType[i]=="clist")){var optCol=dhx4.ajax.xpath("./option",headCol[i]);if(optCol.length){var resAr=new Array();if(this.cellType[i]=="clist"){for(var j=0;j<optCol.length;j++)resAr[resAr.length]=optCol[j].firstChild?optCol[j].firstChild.data:"";this.registerCList(i,resAr);}else{var combo=this.getCombo(i);for(var j=0;j<optCol.length;j++)combo.put(optCol[j].getAttribute("value"),optCol[j].firstChild?optCol[j].firstChild.data:"");}}}
else if(sets[6][i])
if((this.cellType[i].toLowerCase().indexOf("calendar")!=-1)||(this.fldSort[i]=="date"))
this.setDateFormat(sets[6][i]);else
this.setNumberFormat(sets[6][i],i);}
this.init();var param=sets[7].join(this.delim);if(this.setColHidden&&param.replace(/,/g,"")!="")
this.setColHidden(param);if((split)&&(this.splitAt))
this.splitAt(split);}
this._launchCommands(dhx4.ajax.xpath("./afterInit/call",hheadCol[0]));}
var gudCol=dhx4.ajax.xpath("//rows/userdata",xmlDoc);if(gudCol.length>0){if(!this.UserData["gridglobaluserdata"])
this.UserData["gridglobaluserdata"]=new Hashtable();for(var j=0;j<gudCol.length;j++){var u_record="";for(var xj=0;xj<gudCol[j].childNodes.length;xj++)
u_record+=gudCol[j].childNodes[xj].nodeValue;this.UserData["gridglobaluserdata"].put(gudCol[j].getAttribute("name"),u_record);}}},getCheckedRows:function(col_ind){var d=new Array();this.forEachRowA(function(id){var cell=this.cells(id,col_ind);if(cell.changeState&&cell.getValue()!=0)
d.push(id);},true);return d.join(",");},checkAll:function(){var mode=arguments.length?arguments[0]:1;for(var cInd=0;cInd<this.getColumnsNum();cInd++){if(this.getColType(cInd)=="ch")this.setCheckedRows(cInd,mode)}},uncheckAll:function(){this.checkAll(0);},setCheckedRows:function(cInd,v){this.forEachRowA(function(id){if(this.cells(id,cInd).isCheckbox())this.cells(id,cInd).setValue(v)})},_drawTooltip:function(e){var c=this.grid.getFirstParentOfType(e?e.target:event.srcElement,'TD');if(!c||((this.grid.editor)&&(this.grid.editor.cell==c)))
return true;var r=c.parentNode;if(!r.idd||r.idd=="__filler__")
return;var el=(e?e.target:event.srcElement);if(r.idd==window.unknown)
return true;if(!this.grid.callEvent("onMouseOver",[r.idd,c._cellIndex,(e||window.event)]))
return true;if((this.grid._enbTts)&&(!this.grid._enbTts[c._cellIndex])){if(el.title)
el.title='';return true;}
if(c._cellIndex>=this.grid._cCount)
return;var ced=this.grid.cells3(r,c._cellIndex);if(!ced||!ced.cell||!ced.cell._attrs)return;if(el._title)
ced.cell.title="";if(!ced.cell._attrs['title'])
el._title=true;if(ced)
el.title=ced.cell._attrs['title']||(ced.getTitle?ced.getTitle():(ced.getValue()||"").toString().replace(/<[^>]*>/gi,""));return true;},enableCellWidthCorrection:function(size){if(_isFF)
this._wcorr=parseInt(size);},getAllRowIds:function(separator){var ar=[];for(var i=0;i<this.rowsBuffer.length;i++)
if(this.rowsBuffer[i])
ar.push(this.rowsBuffer[i].idd);return ar.join(separator||this.delim)},getAllItemIds:function(){return this.getAllRowIds();},setColspan:function(row_id,col_ind,colspan){if(!this._ecspn)
return;var r=this.getRowById(row_id);if((r._childIndexes)&&(r.childNodes[r._childIndexes[col_ind]])){var j=r._childIndexes[col_ind];var n=r.childNodes[j];var m=n.colSpan;n.colSpan=1;if((m)&&(m!=1))
for(var i=1;i<m;i++){var c=document.createElement("TD");if(n.nextSibling)
r.insertBefore(c,n.nextSibling);else
r.appendChild(c);r._childIndexes[col_ind+i]=j+i;c._cellIndex=col_ind+i;c.style.textAlign=this.cellAlign[i];c.style.verticalAlign=this.cellVAlign[i];n=c;this.cells3(r,col_ind+i).setValue("");}
for(var z=col_ind*1+1*m;z<r._childIndexes.length;z++){r._childIndexes[z]+=(m-1)*1;}}
if((colspan)&&(colspan>1)){if(r._childIndexes)
var j=r._childIndexes[col_ind];else{var j=col_ind;r._childIndexes=new Array();for(var z=0;z<r.childNodes.length;z++)r._childIndexes[z]=z;}
r.childNodes[j].colSpan=colspan;for(var z=1;z<colspan;z++){r._childIndexes[r.childNodes[j+1]._cellIndex]=j;r.removeChild(r.childNodes[j+1]);}
var c1=r.childNodes[r._childIndexes[col_ind]]._cellIndex;for(var z=c1*1+1*colspan;z<r._childIndexes.length;z++)r._childIndexes[z]-=(colspan-1);}},preventIECaching:function(mode){dhx4.ajax.cache=!mode;},enableColumnAutoSize:function(mode){this._eCAS=dhx4.s2b(mode);},_onHeaderDblClick:function(e){var that=this.grid;var el=that.getFirstParentOfType(_isIE?event.srcElement:e.target,"TD");if(!that._eCAS)
return false;that.adjustColumnSize(el._cellIndexS)},adjustColumnSize:function(cInd,complex){if(this._hrrar&&this._hrrar[cInd])return;this._notresize=true;var m=0;this._setColumnSizeR(cInd,20);for(var j=1;j<this.hdr.rows.length;j++){var a=this.hdr.rows[j];a=a.childNodes[(a._childIndexes)?a._childIndexes[cInd]:cInd];if((a)&&((!a.colSpan)||(a.colSpan<2))&&a._cellIndex==cInd){if((a.childNodes[0])&&(a.childNodes[0].className=="hdrcell"))
a=a.childNodes[0];m=Math.max(m,a.scrollWidth);}}
var l=this.obj.rows.length;var z=0;var tree=this.cellType._dhx_find("tree");for(var i=1;i<l;i++){var row=this.obj.rows[i];var col=cInd;if(!this.rowsAr[row.idd])continue;if(row._childIndexes){if(row._childIndexes[cInd]==row._childIndexes[cInd+1])
continue;col=row._childIndexes[cInd];}
if(!row.childNodes[col]||row.childNodes[col]._cellIndex!=cInd)
continue;z=(row.childNodes[col].innerText||row.childNodes[col].textContent||"").length*this.fontWidth;if(this._h2&&cInd==tree)
z+=this._h2.get[row.idd].level*22;if(z>m)
m=z;}
m+=20+(complex||0);this._setColumnSizeR(cInd,m);this._notresize=false;this.setSizes();},detachHeader:function(index,hdr){hdr=hdr||this.hdr;var row=hdr.rows[index+1];if(row)
row.parentNode.removeChild(row);this.setSizes();},detachFooter:function(index){this.detachHeader(index,this.ftr);},attachHeader:function(values,style,_type){if(typeof(values)=="string")
values=this._eSplit(values);if(typeof(style)=="string")
style=style.split(this.delim);_type=_type||"_aHead";if(this.hdr.rows.length){if(values)
this._createHRow([values,style],this[(_type=="_aHead")?"hdr":"ftr"]);else if(this[_type])
for(var i=0;i<this[_type].length;i++)this.attachHeader.apply(this,this[_type][i]);}else{if(!this[_type])
this[_type]=new Array();this[_type][this[_type].length]=[values,style,_type];}},_createHRow:function(data,parent){if(!parent){if(this.entBox.style.position!="absolute")
this.entBox.style.position="relative";var z=document.createElement("DIV");z.className="c_ftr".substr(2);this.entBox.appendChild(z);var t=document.createElement("TABLE");t.cellPadding=t.cellSpacing=0;if(!_isIE||_isIE==8){t.width="100%";t.style.paddingRight="20px";}
t.style.marginRight="20px";t.style.tableLayout="fixed";z.appendChild(t);t.appendChild(document.createElement("TBODY"));this.ftr=parent=t;var hdrRow=t.insertRow(0);var thl=((this.hdrLabels.length<=1)?data[0].length:this.hdrLabels.length);for(var i=0;i<thl;i++){hdrRow.appendChild(document.createElement("TH"));hdrRow.childNodes[i]._cellIndex=i;}
if(_isIE&&_isIE<8)
hdrRow.style.position="absolute";else
hdrRow.style.height='auto';}
var st1=data[1];var z=document.createElement("TR");parent.rows[0].parentNode.appendChild(z);for(var i=0;i<data[0].length;i++){if(data[0][i]=="#cspan"){var pz=z.cells[z.cells.length-1];pz.colSpan=(pz.colSpan||1)+1;continue;}
if((data[0][i]=="#rspan")&&(parent.rows.length>1)){var pind=parent.rows.length-2;var found=false;var pz=null;while(!found){var pz=parent.rows[pind];for(var j=0;j<pz.cells.length;j++)
if(pz.cells[j]._cellIndex==i){found=j+1;break;}
pind--;}
pz=pz.cells[found-1];pz.rowSpan=(pz.rowSpan||1)+1;continue;}
var w=document.createElement("TD");w._cellIndex=w._cellIndexS=i;if(this._hrrar&&this._hrrar[i]&&!_isIE)
w.style.display='none';if(typeof data[0][i]=="object")
w.appendChild(data[0][i]);else{if(this.forceDivInHeader)
w.innerHTML="<div class='hdrcell'>"+(data[0][i]||"&nbsp;")+"</div>";else
w.innerHTML=(data[0][i]||"&nbsp;");if((data[0][i]||"").indexOf("#")!=-1){var t=data[0][i].match(/(^|{)#([^}]+)(}|$)/);if(t){var tn="_in_header_"+t[2];if(this[tn])
this[tn]((this.forceDivInHeader?w.firstChild:w),i,data[0][i].split(t[0]));}}}
if(st1)
w.style.cssText=st1[i];z.appendChild(w);}
var self=parent;if(_isKHTML){if(parent._kTimer)
window.clearTimeout(parent._kTimer);parent._kTimer=window.setTimeout(function(){parent.rows[1].style.display='none';window.setTimeout(function(){parent.rows[1].style.display='';},1);},500);}},attachFooter:function(values,style){this.attachHeader(values,style,"_aFoot");},setCellExcellType:function(rowId,cellIndex,type){this.changeCellType(this.getRowById(rowId),cellIndex,type);},changeCellType:function(r,ind,type){type=type||this.cellType[ind];var z=this.cells3(r,ind);var v=z.getValue();z.cell._cellType=type;var z=this.cells3(r,ind);z.setValue(v);},setRowExcellType:function(rowId,type){var z=this.rowsAr[rowId];for(var i=0;i<z.childNodes.length;i++)this.changeCellType(z,i,type);},setColumnExcellType:function(colIndex,type){for(var i=0;i<this.rowsBuffer.length;i++)
if(this.rowsBuffer[i]&&this.rowsBuffer[i].tagName=="TR")
this.changeCellType(this.rowsBuffer[i],colIndex,type);if(this.cellType[colIndex]=="math")
this._strangeParams[i]=type;else
this.cellType[colIndex]=type;},forEachRow:function(custom_code){for(var a in this.rowsAr)
if(this.rowsAr[a]&&this.rowsAr[a].idd)
custom_code.apply(this,[this.rowsAr[a].idd]);},forEachRowA:function(custom_code){for(var a=0;a<this.rowsBuffer.length;a++){if(this.rowsBuffer[a])
custom_code.call(this,this.render_row(a).idd);}},forEachCell:function(rowId,custom_code){var z=this.getRowById(rowId);if(!z)
return;for(var i=0;i<this._cCount;i++)custom_code(this.cells3(z,i),i);},enableAutoWidth:function(mode,max_limit,min_limit){this._awdth=[dhx4.s2b(mode),parseInt(max_limit||99999),parseInt(min_limit||0)];if(arguments.length==1)
this.objBox.style.overflowX=mode?"hidden":"auto";},updateFromXML:function(url,insert_new,del_missed,afterCall){if(typeof insert_new=="undefined")
insert_new=true;this._refresh_mode=[true,insert_new,del_missed];this.load(url,afterCall)},_refreshFromXML:function(xml){if(this._f_rowsBuffer)this.filterBy(0,"");reset=false;if(window.eXcell_tree){eXcell_tree.prototype.setValueX=eXcell_tree.prototype.setValue;eXcell_tree.prototype.setValue=function(content){var r=this.grid._h2.get[this.cell.parentNode.idd]
if(r&&this.cell.parentNode.valTag){this.setLabel(content);}else
this.setValueX(content);};}
var tree=this.cellType._dhx_find("tree");var top=dhx4.ajax.xmltop("rows",xml);var pid=top.getAttribute("parent")||0;var del={};if(this._refresh_mode[2]){if(tree!=-1)
this._h2.forEachChild(pid,function(obj){del[obj.id]=true;},this);else
this.forEachRow(function(id){del[id]=true;});}
var rows=dhx4.ajax.xpath("//row",top);for(var i=0;i<rows.length;i++){var row=rows[i];var id=row.getAttribute("id");del[id]=false;var pid=row.parentNode.getAttribute("id")||pid;if(this.rowsAr[id]&&this.rowsAr[id].tagName!="TR"){if(this._h2)
this._h2.get[id].buff.data=row;else
this.rowsBuffer[this.getRowIndex(id)].data=row;this.rowsAr[id]=row;}else if(this.rowsAr[id]){this._process_xml_row(this.rowsAr[id],row,-1);this._postRowProcessing(this.rowsAr[id],true)
if(this._fake&&this._fake.rowsAr[id])
this._fake._process_xml_row(this._fake.rowsAr[id],row,-1);}else if(this._refresh_mode[1]){var dadd={idd:id,data:row,_parser:this._process_xml_row,_locator:this._get_xml_data};var render_index=this.rowsBuffer.length;if(this._refresh_mode[1]=="top"){this.rowsBuffer.unshift(dadd);render_index=0;}else
this.rowsBuffer.push(dadd);if(this._h2){reset=true;(this._h2.add(id,(row.parentNode.getAttribute("id")||row.parentNode.getAttribute("parent")))).buff=this.rowsBuffer[this.rowsBuffer.length-1];}else if(this._srnd)
reset=true;this.rowsAr[id]=row;row=this.render_row(render_index);this._insertRowAt(row,render_index?-1:0)}}
if(this._refresh_mode[2])
for(id in del){if(del[id]&&this.rowsAr[id])
this.deleteRow(id);}
this._refresh_mode=null;if(window.eXcell_tree)
eXcell_tree.prototype.setValue=eXcell_tree.prototype.setValueX;if(reset){if(this._h2)
this._renderSort();else
this.render_dataset();}
if(this._f_rowsBuffer){this._f_rowsBuffer=null;this.filterByAll();}},getCustomCombo:function(id,ind){var cell=this.cells(id,ind).cell;if(!cell._combo)
cell._combo=new dhtmlXGridComboObject();return cell._combo;},setTabOrder:function(order){var t=order.split(this.delim);this._tabOrder=[];var max=this._cCount||order.length;for(var i=0;i<max;i++)t[i]={c:parseInt(t[i]),ind:i};t.sort(function(a,b){return(a.c>b.c?1:-1);});for(var i=0;i<max;i++)
if(!t[i+1]||(typeof t[i].c=="undefined"))
this._tabOrder[t[i].ind]=(t[0].ind+1)*-1;else
this._tabOrder[t[i].ind]=t[i+1].ind;},i18n:{loading:"Loading",decimal_separator:".",group_separator:","},_key_events:{k13_1_0:function(){var rowInd=this.rowsCol._dhx_find(this.row)
this.selectCell(this.rowsCol[rowInd+1],this.cell._cellIndex,true);},k13_0_1:function(){var rowInd=this.rowsCol._dhx_find(this.row)
this.selectCell(this.rowsCol[rowInd-1],this.cell._cellIndex,true);},k13_0_0:function(){this.editStop();this.callEvent("onEnter",[(this.row?this.row.idd:null),(this.cell?this.cell._cellIndex:null)]);this._still_active=true;},k9_0_0:function(){this.editStop();if(!this.callEvent("onTab",[true]))return true;var z=this._getNextCell(null,1);if(z){this.selectCell(z.parentNode,z._cellIndex,(this.row!=z.parentNode),false,true);this._still_active=true;}},k9_0_1:function(){this.editStop();if(!this.callEvent("onTab",[false]))return false;var z=this._getNextCell(null,-1);if(z){this.selectCell(z.parentNode,z._cellIndex,(this.row!=z.parentNode),false,true);this._still_active=true;}},k113_0_0:function(){if(this._f2kE)
this.editCell();},k32_0_0:function(){var c=this.cells4(this.cell);if(!c.changeState||(c.changeState()===false))
return false;},k27_0_0:function(){this.editStop(true);},k33_0_0:function(){if(this.pagingOn)
this.changePage(this.currentPage-1);else
this.scrollPage(-1);},k34_0_0:function(){if(this.pagingOn)
this.changePage(this.currentPage+1);else
this.scrollPage(1);},k37_0_0:function(){if(!this.editor&&this.isTreeGrid())
this.collapseKids(this.row)
else
return false;},k39_0_0:function(){if(!this.editor&&this.isTreeGrid())
this.expandKids(this.row)
else
return false;},k40_0_0:function(){var master=this._realfake?this._fake:this;if(this.editor&&this.editor.combo)
this.editor.shiftNext();else{if(!this.row.idd)return;var rowInd=Math.max((master._r_select||0),this.getRowIndex(this.row.idd));var row=this._nextRow(rowInd,1);if(row){master._r_select=null;this.selectCell(row,this.cell._cellIndex,true);if(master.pagingOn)master.showRow(row.idd);}else{if(!this.callEvent("onLastRow",[]))return false;this._key_events.k34_0_0.apply(this,[]);if(this.pagingOn&&this.rowsCol[rowInd+1])
this.selectCell(rowInd+1,0,true);}}
this._still_active=true;},k38_0_0:function(){var master=this._realfake?this._fake:this;if(this.editor&&this.editor.combo)
this.editor.shiftPrev();else{if(!this.row.idd)return;var rowInd=this.getRowIndex(this.row.idd)+1;if(rowInd!=-1&&(!this.pagingOn||(rowInd!=1))){var nrow=this._nextRow(rowInd-1,-1);this.selectCell(nrow,this.cell._cellIndex,true);if(master.pagingOn&&nrow)master.showRow(nrow.idd);}else{this._key_events.k33_0_0.apply(this,[]);}}
this._still_active=true;}},_build_master_row:function(){var t=document.createElement("DIV");var html=["<table><tr>"];for(var i=0;i<this._cCount;i++)html.push("<td></td>");html.push("</tr></table>");t.innerHTML=html.join("");this._master_row=t.firstChild.rows[0];},_prepareRow:function(new_id){if(!this._master_row)
this._build_master_row();var r=this._master_row.cloneNode(true);for(var i=0;i<r.childNodes.length;i++){r.childNodes[i]._cellIndex=i;if(this._enbCid)r.childNodes[i].id="c_"+new_id+"_"+i;if(this.dragAndDropOff)
this.dragger.addDraggableItem(r.childNodes[i],this);}
r.idd=new_id;r.grid=this;return r;},_process_jsarray_row:function(r,data){r._attrs={};for(var j=0;j<r.childNodes.length;j++)r.childNodes[j]._attrs={};this._fillRow(r,(this._c_order?this._swapColumns(data):data));return r;},_get_jsarray_data:function(data,ind){return data[ind];},_process_json_row:function(r,data){data=this._c_order?this._swapColumns(data.data):data.data;return this._process_some_row(r,data);},_process_some_row:function(r,data){r._attrs={};for(var j=0;j<r.childNodes.length;j++)
r.childNodes[j]._attrs={};this._fillRow(r,data);return r;},_get_json_data:function(data,ind){return data.data[ind];},_process_js_row:function(r,data){var arr=[];for(var i=0;i<this.columnIds.length;i++){arr[i]=data[this.columnIds[i]];if(!arr[i]&&arr[i]!==0)
arr[i]="";}
this._process_some_row(r,arr);r._attrs=data;return r;},_get_js_data:function(data,ind){return data[this.columnIds[ind]];},_process_csv_row:function(r,data){r._attrs={};for(var j=0;j<r.childNodes.length;j++)r.childNodes[j]._attrs={};this._fillRow(r,(this._c_order?this._swapColumns(data.split(this.csv.cell)):data.split(this.csv.cell)));return r;},_get_csv_data:function(data,ind){return data.split(this.csv.cell)[ind];},_process_store_row:function(row,data){var result=[];for(var i=0;i<this.columnIds.length;i++)
result[i]=data[this.columnIds[i]];for(var j=0;j<row.childNodes.length;j++)
row.childNodes[j]._attrs={};row._attrs=data;this._fillRow(row,result);},_process_xml_row:function(r,xml){var cellsCol=dhx4.ajax.xpath(this.xml.cell,xml);var strAr=[];r._attrs=this._xml_attrs(xml);if(this._ud_enabled){var udCol=dhx4.ajax.xpath("./userdata",xml);for(var i=udCol.length-1;i>=0;i--){var u_record="";for(var j=0;j<udCol[i].childNodes.length;j++)
u_record+=udCol[i].childNodes[j].nodeValue;this.setUserData(r.idd,udCol[i].getAttribute("name"),u_record);}}
for(var j=0;j<cellsCol.length;j++){var cellVal=cellsCol[this._c_order?this._c_order[j]:j];if(!cellVal)continue;var cind=r._childIndexes?r._childIndexes[j]:j;var exc=cellVal.getAttribute("type");if(r.childNodes[cind]){if(exc)
r.childNodes[cind]._cellType=exc;r.childNodes[cind]._attrs=this._xml_attrs(cellVal);}
if(!cellVal.getAttribute("xmlcontent")){if(cellVal.firstChild)
cellVal=cellVal.firstChild.wholeText||cellVal.firstChild.data;else
cellVal="";}
strAr.push(cellVal);}
for(j<cellsCol.length;j<r.childNodes.length;j++)r.childNodes[j]._attrs={};if(r.parentNode&&r.parentNode.tagName=="row")
r._attrs["parent"]=r.parentNode.getAttribute("idd");this._fillRow(r,strAr);return r;},_get_xml_data:function(data,ind){data=data.firstChild;while(true){if(!data)
return"";if(data.tagName=="cell")
ind--;if(ind<0)
break;data=data.nextSibling;}
return(data.firstChild?data.firstChild.data:"");},_fillRow:function(r,text){if(this.editor&&this.editor.parentNode&&this.editor.parentNode.idd==r.idd)
this.editStop();for(var i=0;i<r.childNodes.length;i++){if((i<text.length)||(this.defVal[i])){var ii=r.childNodes[i]._cellIndex;var val=text[ii];var aeditor=this.cells4(r.childNodes[i]);if((this.defVal[ii])&&((val=="")||(typeof(val)=="undefined")))
val=this.defVal[ii];if(aeditor)aeditor.setValue(val)}else{r.childNodes[i].innerHTML="&nbsp;";r.childNodes[i]._clearCell=true;}}
return r;},_postRowProcessing:function(r,donly){if(r._attrs["class"])
r._css=r.className=r._attrs["class"];if(r._attrs.locked)
r._locked=true;if(r._attrs.bgColor)
r.bgColor=r._attrs.bgColor;var cor=0;for(var i=0;i<r.childNodes.length;i++){var c=r.childNodes[i];var ii=c._cellIndex;var s=c._attrs.style||r._attrs.style;if(s)
c.style.cssText+=";"+s;if(c._attrs["class"])
c.className=c._attrs["class"];s=c._attrs.align||this.cellAlign[ii];if(s)
c.align=s;c.vAlign=c._attrs.valign||this.cellVAlign[ii];var color=c._attrs.bgColor||this.columnColor[ii];if(color)
c.bgColor=color;if(c._attrs["colspan"]&&!donly){this.setColspan(r.idd,i+cor,c._attrs["colspan"]);cor+=(c._attrs["colspan"]-1);}
if(this._hrrar&&this._hrrar[ii]&&!donly){c.style.display="none";}};this.callEvent("onRowCreated",[r.idd,r,null]);},load:function(url,call,type){this.callEvent("onXLS",[this]);if(arguments.length==2&&typeof call!="function"){type=call;call=null;}
type=type||"xml";if(!this.xmlFileUrl)
this.xmlFileUrl=url;this._data_type=type;this.xmlLoader=this.doLoadDetails;var that=this;this.xmlLoader=function(xml){if(!that.callEvent)return;that["_process_"+type](xml.xmlDoc);if(!that._contextCallTimer)
that.callEvent("onXLE",[that,0,0,xml.xmlDoc,type]);if(call){call();call=null;}};return dhx4.ajax.get(url,this.xmlLoader);},loadXMLString:function(str,afterCall){if(window.console&&window.console.info)
window.console.info("loadXMLString was deprecated","http://docs.dhtmlx.com/migration__index.html#migrationfrom43to44");this.parse({responseXML:dhx4.ajax.parse(str)},afterCall,"xml")},loadXML:function(url,afterCall){if(window.console&&window.console.info)
window.console.info("loadXML was deprecated","http://docs.dhtmlx.com/migration__index.html#migrationfrom43to44");this.load(url,afterCall,"xml")},parse:function(data,call,type){if(arguments.length==2&&typeof call!="function"){type=call;call=null;}
type=type||"xml";this._data_type=type;if(type=="xml"&&typeof data=="string")
data={responseXML:dhx4.ajax.parse(data)};this["_process_"+type](data);if(!this._contextCallTimer)
this.callEvent("onXLE",[this,0,0,data,type]);if(call)
call();},xml:{top:"rows",row:"./row",cell:"./cell",s_row:"row",s_cell:"cell",row_attrs:[],cell_attrs:[]},csv:{row:"\n",cell:","},_xml_attrs:function(node){var data={};if(node.attributes.length){for(var i=0;i<node.attributes.length;i++)data[node.attributes[i].name]=node.attributes[i].value;}
return data;},_process_xml:function(xhr){if(this._refresh_mode)return this._refreshFromXML(xhr);this._parsing=true;var top=dhx4.ajax.xmltop(this.xml.top,xhr);if(top.tagName!=this.xml.top)return;var skey=top.getAttribute("dhx_security");if(skey)
dhtmlx.security_key=skey;this._parseHead(top);var rows=dhx4.ajax.xpath(this.xml.row,top)
var cr=parseInt(top.getAttribute("pos")||0);var total=parseInt(top.getAttribute("total_count")||0);if(!this.pagingOn)
var total=Math.min(total,32000000/this._srdh);var reset=false;if(total&&total!=this.rowsBuffer.length){if(!this.rowsBuffer[total-1]){if(this.rowsBuffer.length)
reset=true;this.rowsBuffer[total-1]=null;}
if(total<this.rowsBuffer.length){this.rowsBuffer.splice(total,this.rowsBuffer.length-total);reset=true;}}
if(this.isTreeGrid())
return this._process_tree_xml(top);for(var i=0;i<rows.length;i++){if(this.rowsBuffer[i+cr])
continue;var id=rows[i].getAttribute("id")||(i+cr+1);this.rowsBuffer[i+cr]={idd:id,data:rows[i],_parser:this._process_xml_row,_locator:this._get_xml_data};this.rowsAr[id]=rows[i];}
this.callEvent("onDataReady",[]);if(reset&&this._srnd){var h=this.objBox.scrollTop;this._reset_view();this.objBox.scrollTop=h;}else{this.render_dataset();}
this._parsing=false;},_process_jsarray:function(data){this._parsing=true;data=data.responseText||data;if(typeof data=="string"){eval("dhtmlx.temp="+data+";");data=dhtmlx.temp;}
for(var i=0;i<data.length;i++){var id=i+1;this.rowsBuffer.push({idd:id,data:data[i],_parser:this._process_jsarray_row,_locator:this._get_jsarray_data});this.rowsAr[id]=data[i];}
this.render_dataset();this._parsing=false;},_process_csv:function(data){this._parsing=true;data=data.responseText||data;data=data.replace(/\r/g,"");data=data.split(this.csv.row);if(this._csvHdr){this.clearAll();var thead=data.splice(0,1)[0].split(this.csv.cell);if(!this._csvAID)thead.splice(0,1);this.setHeader(thead.join(this.delim));this.init();}
for(var i=0;i<data.length;i++){if(!data[i]&&i==data.length-1)continue;if(this._csvAID){var id=i+1;this.rowsBuffer.push({idd:id,data:data[i],_parser:this._process_csv_row,_locator:this._get_csv_data});}else{var temp=data[i].split(this.csv.cell);var id=temp.splice(0,1)[0];this.rowsBuffer.push({idd:id,data:temp,_parser:this._process_jsarray_row,_locator:this._get_jsarray_data});}
this.rowsAr[id]=data[i];}
this.render_dataset();this._parsing=false;},_process_js:function(data){return this._process_json(data,"js");},_process_json:function(data,mode){this._parsing=true;var data=data.responseText||data;if(typeof data=="string"){eval("dhtmlx.temp="+data+";");data=dhtmlx.temp;}
if(mode=="js"){if(data.data)
data=data.data;for(var i=0;i<data.length;i++){var row=data[i];var id=row.id||(i+1);this.rowsBuffer.push({idd:id,data:row,_parser:this._process_js_row,_locator:this._get_js_data});this.rowsAr[id]=data[i];}}else{if(data.rows){for(var i=0;i<data.rows.length;i++){var id=data.rows[i].id;this.rowsBuffer.push({idd:id,data:data.rows[i],_parser:this._process_json_row,_locator:this._get_json_data});this.rowsAr[id]=data.rows[i];}}}
if(data.dhx_security)
dhtmlx.security_key=data.dhx_security;this.callEvent("onDataReady",[]);this.render_dataset();this._parsing=false;},render_dataset:function(min,max){if(this._srnd){if(this._fillers)
return this._update_srnd_view();max=Math.min((this._get_view_size()+(this._srnd_pr||0)),this.rowsBuffer.length);}
if(this.pagingOn){min=Math.max((min||0),(this.currentPage-1)*this.rowsBufferOutSize);max=Math.min(this.currentPage*this.rowsBufferOutSize,this.rowsBuffer.length)}else{min=min||0;max=max||this.rowsBuffer.length;}
for(var i=min;i<max;i++){var r=this.render_row(i)
if(r==-1){if(this.xmlFileUrl){if(this.callEvent("onDynXLS",[i,(this._dpref?this._dpref:(max-i))]))
this.load(this.xmlFileUrl+dhtmlx.url(this.xmlFileUrl)+"posStart="+i+"&count="+(this._dpref?this._dpref:(max-i)),this._data_type);}
max=i;break;}
if(!r.parentNode||!r.parentNode.tagName){this._insertRowAt(r,i);if(r._attrs["selected"]||r._attrs["select"]){this.selectRow(r,r._attrs["call"]?true:false,true);r._attrs["selected"]=r._attrs["select"]=null;}}
if(this._ads_count&&i-min==this._ads_count){var that=this;this._context_parsing=this._context_parsing||this._parsing;return this._contextCallTimer=window.setTimeout(function(){that._contextCallTimer=null;that.render_dataset(i,max);if(!that._contextCallTimer){if(that._context_parsing)
that.callEvent("onXLE",[])
else
that._fixAlterCss();that._context_parsing=false;}},this._ads_time)}}
if(this._ads_count&&i==max)
this.callEvent("onDistributedEnd",[]);if(this._srnd&&!this._fillers){var add_count=this.rowsBuffer.length-max;this._fillers=[];if(this._fake&&!this._realfake)this._fake._fillers=[];var block_size=Math.round(990000/this._srdh);while(add_count>0){var add_step=(_isIE||window._FFrv)?Math.min(add_count,block_size):add_count;var new_filler=this._add_filler(max,add_step);if(new_filler)
this._fillers.push(new_filler);add_count-=add_step;max+=add_step;}}
this.setSizes();},render_row:function(ind){if(!this.rowsBuffer[ind])
return-1;if(this.rowsBuffer[ind]._parser){var r=this.rowsBuffer[ind];if(this.rowsAr[r.idd]&&this.rowsAr[r.idd].tagName=="TR")
return this.rowsBuffer[ind]=this.rowsAr[r.idd];var row=this._prepareRow(r.idd);this.rowsBuffer[ind]=row;this.rowsAr[r.idd]=row;r._parser.call(this,row,r.data);this._postRowProcessing(row);return row;}
return this.rowsBuffer[ind];},_get_cell_value:function(row,ind,method){if(row._locator){if(this._c_order)
ind=this._c_order[ind];return row._locator.call(this,row.data,ind);}
return this.cells3(row,ind)[method?method:"getValue"]();},sortRows:function(col,type,order){this.editStop();order=(order||"asc").toLowerCase();type=(type||this.fldSort[col]);col=col||0;if(this.isTreeGrid())
this.sortTreeRows(col,type,order);else{var arrTS={};var atype=this.cellType[col];var amet="getValue";if(atype=="link")
amet="getContent";if(atype=="dhxCalendar"||atype=="dhxCalendarA")
amet="getDate";for(var i=0;i<this.rowsBuffer.length;i++)arrTS[this.rowsBuffer[i].idd]=this._get_cell_value(this.rowsBuffer[i],col,amet);this._sortRows(col,type,order,arrTS);}
this.callEvent("onAfterSorting",[col,type,order]);},_sortCore:function(col,type,order,arrTS,s){var sort="sort";if(this._sst){s["stablesort"]=this.rowsCol.stablesort;sort="stablesort";}
if(type.length>4)
type=window[type];if(type=='cus'){var cstr=this._customSorts[col];s[sort](function(a,b){return cstr(arrTS[a.idd],arrTS[b.idd],order,a.idd,b.idd);});}
else if(typeof(type)=='function'){s[sort](function(a,b){return type(arrTS[a.idd],arrTS[b.idd],order,a.idd,b.idd);});}
else
if(type=='str'){s[sort](function(a,b){if(order=="asc")
return arrTS[a.idd]>arrTS[b.idd]?1:(arrTS[a.idd]<arrTS[b.idd]?-1:0);else
return arrTS[a.idd]<arrTS[b.idd]?1:(arrTS[a.idd]>arrTS[b.idd]?-1:0);});}
else if(type=='int'){s[sort](function(a,b){var aVal=parseFloat(arrTS[a.idd]);aVal=isNaN(aVal)?-99999999999999:aVal;var bVal=parseFloat(arrTS[b.idd]);bVal=isNaN(bVal)?-99999999999999:bVal;if(order=="asc")
return aVal-bVal;else
return bVal-aVal;});}
else if(type=='date'){s[sort](function(a,b){var aVal=Date.parse(arrTS[a.idd])||(Date.parse("01/01/1900"));var bVal=Date.parse(arrTS[b.idd])||(Date.parse("01/01/1900"));if(order=="asc")
return aVal-bVal
else
return bVal-aVal});}},_sortRows:function(col,type,order,arrTS){this._sortCore(col,type,order,arrTS,this.rowsBuffer);this._reset_view();this.callEvent("onGridReconstructed",[]);},_reset_view:function(skip){if(!this.obj.rows[0])return;if(this._lahRw)this._unsetRowHover(0,true);this.callEvent("onResetView",[]);var tb=this.obj.rows[0].parentNode;var tr=tb.removeChild(tb.childNodes[0],true)
if(_isKHTML)
for(var i=tb.parentNode.childNodes.length-1;i>=0;i--){if(tb.parentNode.childNodes[i].tagName=="TR")tb.parentNode.removeChild(tb.parentNode.childNodes[i],true);}
else if(_isIE)
for(var i=tb.childNodes.length-1;i>=0;i--)tb.childNodes[i].removeNode(true);else
tb.innerHTML="";tb.appendChild(tr)
this.rowsCol=dhtmlxArray();if(this._sst)
this.enableStableSorting(true);this._fillers=this.undefined;if(!skip){if(_isIE&&this._srnd){this.render_dataset();}
else
this.render_dataset();}},deleteRow:function(row_id,node){if(!node)
node=this.getRowById(row_id)
if(!node)
return;this.editStop();if(!this._realfake)
if(this.callEvent("onBeforeRowDeleted",[row_id])==false)
return false;var pid=0;if(this.cellType._dhx_find("tree")!=-1&&!this._realfake){pid=this._h2.get[row_id].parent.id;this._removeTrGrRow(node);}
else{if(node.parentNode)
node.parentNode.removeChild(node);var ind=this.rowsCol._dhx_find(node);if(ind!=-1)
this.rowsCol._dhx_removeAt(ind);for(var i=0;i<this.rowsBuffer.length;i++)
if(this.rowsBuffer[i]&&this.rowsBuffer[i].idd==row_id){this.rowsBuffer._dhx_removeAt(i);ind=i;break;}}
this.rowsAr[row_id]=null;for(var i=0;i<this.selectedRows.length;i++)
if(this.selectedRows[i].idd==row_id)
this.selectedRows._dhx_removeAt(i);if(this._srnd){for(var i=0;i<this._fillers.length;i++){var f=this._fillers[i]
if(!f)continue;if(f[0]>=ind)
this._update_fillers(i,0,-1);else if(f[0]+f[1]>ind)
this._update_fillers(i,-1,0);};this._update_srnd_view();}
if(this.pagingOn)
this.changePage();if(!this._realfake)this.callEvent("onAfterRowDeleted",[row_id,pid]);this.callEvent("onGridReconstructed",[]);if(this._ahgr)this.setSizes();return true;},_addRow:function(new_id,text,ind){if(ind==-1||typeof ind=="undefined")
ind=this.rowsBuffer.length;if(typeof text=="string")text=text.split(this.delim);var row=this._prepareRow(new_id);row._attrs={};for(var j=0;j<row.childNodes.length;j++)row.childNodes[j]._attrs={};this.rowsAr[row.idd]=row;if(this._h2)this._h2.get[row.idd].buff=row;this._fillRow(row,text);this._postRowProcessing(row);if(this._skipInsert){this._skipInsert=false;return this.rowsAr[row.idd]=row;}
if(this.pagingOn){this.rowsBuffer._dhx_insertAt(ind,row);this.rowsAr[row.idd]=row;return row;}
if(this._fillers){this.rowsCol._dhx_insertAt(ind,null);this.rowsBuffer._dhx_insertAt(ind,row);if(this._fake)this._fake.rowsCol._dhx_insertAt(ind,null);this.rowsAr[row.idd]=row;var found=false;for(var i=0;i<this._fillers.length;i++){var f=this._fillers[i];if(f&&f[0]<=ind&&(f[0]+f[1])>=ind){f[1]=f[1]+1;var nh=f[2].firstChild.style.height=parseInt(f[2].firstChild.style.height)+this._srdh+"px";found=true;if(this._fake){this._fake._fillers[i][1]++;this._fake._fillers[i][2].firstChild.style.height=nh;}}
if(f&&f[0]>ind){f[0]=f[0]+1
if(this._fake)this._fake._fillers[i][0]++;}}
if(!found)
this._fillers.push(this._add_filler(ind,1,(ind==0?{parentNode:this.obj.rows[0].parentNode,nextSibling:(this.rowsCol[1])}:this.rowsCol[ind-1])));return row;}
this.rowsBuffer._dhx_insertAt(ind,row);return this._insertRowAt(row,ind);},addRow:function(new_id,text,ind){var r=this._addRow(new_id,text,ind);if(!this.dragContext)
this.callEvent("onRowAdded",[new_id]);if(this.pagingOn)
this.changePage(this.currentPage)
if(this._srnd)
this._update_srnd_view();r._added=true;if(this._srnd&&!this._fillers)
this._fillers=[];if(this._ahgr)
this.setSizes();this.callEvent("onGridReconstructed",[]);return r;},_insertRowAt:function(r,ind,skip){this.rowsAr[r.idd]=r;if(this._skipInsert){this._skipInsert=false;return r;}
if((ind<0)||((!ind)&&(parseInt(ind)!==0)))
ind=this.rowsCol.length;else{if(ind>this.rowsCol.length)
ind=this.rowsCol.length;}
if(this._cssEven){var css=r.className.replace(this._cssUnEven,"");if((this._cssSP?this.getLevel(r.idd):ind)%2==1)
r.className=css+" "+this._cssUnEven+(this._cssSU?(" "+this._cssUnEven+"_"+this.getLevel(r.idd)):"");else
r.className=css+" "+this._cssEven+(this._cssSU?(" "+this._cssEven+"_"+this.getLevel(r.idd)):"");}
if(!skip)
if((ind==(this.obj.rows.length-1))||(!this.rowsCol[ind]))
if(_isKHTML)
this.obj.appendChild(r);else{this.obj.firstChild.appendChild(r);}
else{this.rowsCol[ind].parentNode.insertBefore(r,this.rowsCol[ind]);}
this.rowsCol._dhx_insertAt(ind,r);this.callEvent("onRowInserted",[r,ind]);return r;},getRowById:function(id){var row=this.rowsAr[id];if(row){if(row.tagName!="TR"){for(var i=0;i<this.rowsBuffer.length;i++)
if(this.rowsBuffer[i]&&this.rowsBuffer[i].idd==id)
return this.render_row(i);if(this._h2)return this.render_row(null,row.idd);}
return row;}
return null;},cellById:function(row_id,col){return this.cells(row_id,col);},cells:function(row_id,col){if(arguments.length==0)
return this.cells4(this.cell);else
var c=this.getRowById(row_id);var cell=(c._childIndexes?c.childNodes[c._childIndexes[col]]:c.childNodes[col]);if(!cell&&c._childIndexes)
cell=c.firstChild||{};return this.cells4(cell);},cellByIndex:function(row_index,col){return this.cells2(row_index,col);},cells2:function(row_index,col){var c=this.render_row(row_index);var cell=(c._childIndexes?c.childNodes[c._childIndexes[col]]:c.childNodes[col]);if(!cell&&c._childIndexes)
cell=c.firstChild||{};return this.cells4(cell);},cells3:function(row,col){var cell=(row._childIndexes?row.childNodes[row._childIndexes[col]]:row.childNodes[col]);return this.cells4(cell);},cells4:function(cell){var type=window["eXcell_"+(cell._cellType||this.cellType[cell._cellIndex])];if(type)
return new type(cell);},cells5:function(cell,type){var type=type||(cell._cellType||this.cellType[cell._cellIndex]);if(!this._ecache[type]){if(!window["eXcell_"+type])
var tex=eXcell_ro;else
var tex=window["eXcell_"+type];this._ecache[type]=new tex(cell);}
this._ecache[type].cell=cell;return this._ecache[type];},dma:function(mode){if(!this._ecache)
this._ecache={};if(mode&&!this._dma){this._dma=this.cells4;this.cells4=this.cells5;}else if(!mode&&this._dma){this.cells4=this._dma;this._dma=null;}},getRowsNum:function(){return this.rowsBuffer.length;},enableEditTabOnly:function(mode){if(arguments.length>0)
this.smartTabOrder=dhx4.s2b(mode);else
this.smartTabOrder=true;},setExternalTabOrder:function(start,end){var grid=this;this.tabStart=(typeof(start)=="object")?start:document.getElementById(start);var oldkeydown_start=this.tabStart.onkeydown;this.tabStart.onkeydown=function(e){if(oldkeydown_start)
oldkeydown_start.call(this,e);var ev=(e||window.event);if(ev.keyCode==9&&!ev.shiftKey){ev.cancelBubble=true;grid.selectCell(0,0,0,0,1);if(grid.smartTabOrder&&grid.cells2(0,0).isDisabled()){grid._key_events["k9_0_0"].call(grid);}
this.blur();return false;}};if(_isOpera)this.tabStart.onkeypress=this.tabStart.onkeydown;this.tabEnd=(typeof(end)=="object")?end:document.getElementById(end);var oldkeydown_end=this.tabEnd.onkeydown;this.tabEnd.onkeydown=this.tabEnd.onkeypress=function(e){if(oldkeydown_end)
oldkeydown_end.call(this,e);var ev=(e||window.event);if(ev.keyCode==9&&ev.shiftKey){ev.cancelBubble=true;grid.selectCell((grid.getRowsNum()-1),(grid.getColumnCount()-1),0,0,1);if(grid.smartTabOrder&&grid.cells2((grid.getRowsNum()-1),(grid.getColumnCount()-1)).isDisabled()){grid._key_events["k9_0_1"].call(grid);}
this.blur();return false;}};if(_isOpera)this.tabEnd.onkeypress=this.tabEnd.onkeydown;},uid:function(){if(!this._ui_seed)this._ui_seed=(new Date()).valueOf();return this._ui_seed++;},setIconset:function(name){this.iconset=name;},clearAndLoad:function(){if(this._last_load_request){var last=this._last_load_request.xmlDoc;if(last.readyState!=4){try{last.onreadystatechange=function(){};last.abort();}catch(e){}}};var t=this._pgn_skin;this._pgn_skin=null;this.clearAll();this._pgn_skin=t;this._last_load_request=this.load.apply(this,arguments);},getStateOfView:function(){if(this.pagingOn){var start=(this.currentPage-1)*this.rowsBufferOutSize;return[this.currentPage,start,Math.min(start+this.rowsBufferOutSize,this.rowsBuffer.length),this.rowsBuffer.length];}
return[Math.floor(this.objBox.scrollTop/this._srdh),Math.ceil(parseInt(this.objBox.offsetHeight)/this._srdh),this.rowsBuffer.length];}};(function(){function direct_set(name,value){this[name]=value;}
function direct_call(name,value){this[name].call(this,value);}
function joined_call(name,value){this[name].call(this,value.join(this.delim));}
function set_options(name,value){for(var i=0;i<value.length;i++)
if(typeof value[i]=="object"){var combo=this.getCombo(i);for(var key in value[i])
combo.put(key,value[i][key]);}}
function header_set(name,value,obj){var rows=1;var header=[];function add(i,j,value){if(!header[j])header[j]=[];if(typeof value=="object")value.toString=function(){return this.text;}
header[j][i]=value;}
for(var i=0;i<value.length;i++){if(typeof(value[i])=="object"&&value[i].length){for(var j=0;j<value[i].length;j++)
add(i,j,value[i][j]);}else
add(i,0,value[i]);}
for(var i=0;i<header.length;i++)
for(var j=0;j<header[0].length;j++){var h=header[i][j];header[i][j]=(h||"").toString()||"&nbsp;";if(h&&h.colspan)
for(var k=1;k<h.colspan;k++)add(j+k,i,"#cspan");if(h&&h.rowspan)
for(var k=1;k<h.rowspan;k++)add(j,i+k,"#rspan");}
this.setHeader(header[0]);for(var i=1;i<header.length;i++)
this.attachHeader(header[i]);}
var columns_map=[{name:"label",def:"&nbsp;",operation:"setHeader",type:header_set},{name:"id",def:"",operation:"columnIds",type:direct_set},{name:"width",def:"*",operation:"setInitWidths",type:joined_call},{name:"align",def:"left",operation:"cellAlign",type:direct_set},{name:"valign",def:"middle",operation:"cellVAlign",type:direct_set},{name:"sort",def:"na",operation:"fldSort",type:direct_set},{name:"type",def:"ro",operation:"setColTypes",type:joined_call},{name:"options",def:"",operation:"",type:set_options}];dhtmlx.extend_api("dhtmlXGridObject",{_init:function(obj){return[obj.parent];},image_path:"setImagePath",columns:"columns",rows:"rows",headers:"headers",skin:"setSkin",smart_rendering:"enableSmartRendering",css:"enableAlterCss",auto_height:"enableAutoHeight",save_hidden:"enableAutoHiddenColumnsSaving",save_cookie:"enableAutoSaving",save_size:"enableAutoSizeSaving",auto_width:"enableAutoWidth",block_selection:"enableBlockSelection",csv_id:"enableCSVAutoID",csv_header:"enableCSVHeader",cell_ids:"enableCellIds",colspan:"enableColSpan",column_move:"enableColumnMove",context_menu:"enableContextMenu",distributed:"enableDistributedParsing",drag:"enableDragAndDrop",drag_order:"enableDragOrder",tabulation:"enableEditTabOnly",header_images:"enableHeaderImages",header_menu:"enableHeaderMenu",keymap:"enableKeyboardSupport",mouse_navigation:"enableLightMouseNavigation",markers:"enableMarkedCells",math_editing:"enableMathEditing",math_serialization:"enableMathSerialization",drag_copy:"enableMercyDrag",multiline:"enableMultiline",multiselect:"enableMultiselect",save_column_order:"enableOrderSaving",hover:"enableRowsHover",rowspan:"enableRowspan",smart:"enableSmartRendering",save_sorting:"enableSortingSaving",stable_sorting:"enableStableSorting",undo:"enableUndoRedo",csv_cell:"setCSVDelimiter",date_format:"setDateFormat",drag_behavior:"setDragBehavior",editable:"setEditable",without_header:"setNoHeader",submit_changed:"submitOnlyChanged",submit_serialization:"submitSerialization",submit_selected:"submitOnlySelected",submit_id:"submitOnlyRowID",xml:"load"},{columns:function(obj){for(var j=0;j<columns_map.length;j++){var settings=[];for(var i=0;i<obj.length;i++)
settings[i]=obj[i][columns_map[j].name]||columns_map[j].def;var type=columns_map[j].type||direct_call;type.call(this,columns_map[j].operation,settings,obj);}
this.init();},rows:function(obj){},headers:function(obj){for(var i=0;i<obj.length;i++)
this.attachHeader(obj[i]);}});})();dhtmlXGridObject.prototype._dp_init=function(dp){dp.attachEvent("insertCallback",function(upd,id){if(this.obj._h2)
this.obj.addRow(id,row,null,parent);else
this.obj.addRow(id,[],0);var row=this.obj.getRowById(id);if(row){this.obj._process_xml_row(row,upd.firstChild);this.obj._postRowProcessing(row);}});dp.attachEvent("updateCallback",function(upd,id){var row=this.obj.getRowById(id);if(row){this.obj._process_xml_row(row,upd.firstChild);this.obj._postRowProcessing(row);}});dp.attachEvent("deleteCallback",function(upd,id){this.obj.setUserData(id,this.action_param,"true_deleted");this.obj.deleteRow(id);});dp._methods=["setRowTextStyle","setCellTextStyle","changeRowId","deleteRow"];this.attachEvent("onEditCell",function(state,id,index){if(dp._columns&&!dp._columns[index])return true;var cell=this.cells(id,index)
if(state==1){if(cell.isCheckbox()){dp.setUpdated(id,true)}}else if(state==2){if(cell.wasChanged()){dp.setUpdated(id,true)}}
return true;});this.attachEvent("onRowPaste",function(id){dp.setUpdated(id,true)});this.attachEvent("onUndo",function(id){dp.setUpdated(id,true)});this.attachEvent("onRowIdChange",function(id,newid){var ind=dp.findRow(id);if(ind<dp.updatedRows.length)
dp.updatedRows[ind]=newid;});this.attachEvent("onSelectStateChanged",function(rowId){if(dp.updateMode=="row")
dp.sendData();return true;});this.attachEvent("onEnter",function(rowId,celInd){if(dp.updateMode=="row")
dp.sendData();return true;});this.attachEvent("onBeforeRowDeleted",function(rowId){if(dp._silent_mode||(!this.rowsAr[rowId]))return true;if(this.dragContext&&dp.dnd){window.setTimeout(function(){dp.setUpdated(rowId,true);},1);return true;}
var z=dp.getState(rowId);if(this._h2){this._h2.forEachChild(rowId,function(el){dp.setUpdated(el.id,false);dp.markRow(el.id,true,"deleted");},this);}
if(z=="inserted"){dp.set_invalid(rowId,false);dp.setUpdated(rowId,false);return true;}
if(z=="deleted")return false;if(z=="true_deleted"){dp.setUpdated(rowId,false);return true;}
dp.setUpdated(rowId,true,"deleted");return false;});this.attachEvent("onBindUpdate",function(data,key,id){dp.setUpdated(id,true);});this.attachEvent("onRowAdded",function(rowId){if(this.dragContext&&dp.dnd)return true;dp.setUpdated(rowId,true,"inserted")
return true;});dp._getRowData=function(rowId,pref){var data=[];data["gr_id"]=rowId;if(this.obj.isTreeGrid())
data["gr_pid"]=this.obj.getParentId(rowId);var r=this.obj.getRowById(rowId);for(var i=0;i<this.obj._cCount;i++){if(this.obj._c_order)
var i_c=this.obj._c_order[i];else
var i_c=i;var c=this.obj.cells(r.idd,i);if(this._changed&&!c.wasChanged())continue;if(this._endnm)
data[this.obj.getColumnId(i)]=c.getValue();else
data["c"+i_c]=c.getValue();}
var udata=this.obj.UserData[rowId];if(udata){for(var j=0;j<udata.keys.length;j++)
if(udata.keys[j]&&udata.keys[j].indexOf("__")!=0)
data[udata.keys[j]]=udata.values[j];}
var udata=this.obj.UserData["gridglobaluserdata"];if(udata){for(var j=0;j<udata.keys.length;j++)
data[udata.keys[j]]=udata.values[j];}
return data;};dp._clearUpdateFlag=function(rowId){var row=this.obj.getRowById(rowId);if(row)
for(var j=0;j<this.obj._cCount;j++)
this.obj.cells(rowId,j).cell.wasChanged=false;};dp.checkBeforeUpdate=function(rowId){var valid=true;var c_invalid=[];for(var i=0;i<this.obj._cCount;i++)
if(this.mandatoryFields[i]){var res=this.mandatoryFields[i].call(this.obj,this.obj.cells(rowId,i).getValue(),rowId,i);if(typeof res=="string"){this.messages.push(res);valid=false;}else{valid&=res;c_invalid[i]=!res;}}
if(!valid){this.set_invalid(rowId,"invalid",c_invalid);this.setUpdated(rowId,false);}
return valid;};};dhx4.attachEvent("onGridCreated",function(grid){grid._con_f_used=[].concat(grid._con_f_used);dhtmlXGridObject.prototype._con_f_used=[];var clear_url=function(url){url=url.replace(/(\?|\&)connector[^\f]*/g,"");return url+(url.indexOf("?")!=-1?"&":"?")+"connector=true"+(this.hdr.rows.length>0?"&dhx_no_header=1":"");};var combine_urls=function(url){return clear_url.call(this,url)+(this._connector_sorting||"")+(this._connector_filter||"");};var sorting_url=function(url,ind,dir){this._connector_sorting="&dhx_sort["+ind+"]="+dir;return combine_urls.call(this,url);};var filtering_url=function(url,inds,vals){var chunks=[];for(var i=0;i<inds.length;i++)
chunks[i]="dhx_filter["+inds[i]+"]="+encodeURIComponent(vals[i]);this._connector_filter="&"+chunks.join("&");return combine_urls.call(this,url);};grid.attachEvent("onCollectValues",function(ind){if(this._con_f_used[ind]){if(typeof(this._con_f_used[ind])=="object")
return this._con_f_used[ind];else
return false;}
return true;});grid.attachEvent("onDynXLS",function(){if(this.xmlFileUrl)
this.xmlFileUrl=combine_urls.call(this,this.xmlFileUrl);return true;});grid.attachEvent("onBeforeSorting",function(ind,type,dir){if(type=="connector"){var self=this;this.clearAndLoad(sorting_url.call(this,this.xmlFileUrl,ind,dir),function(){self.setSortImgState(true,ind,dir);});return false;}
return true;});grid.attachEvent("onFilterStart",function(a,b){if(this._con_f_used.length){var ss=this.getSortingState();var self=this;this.clearAndLoad(filtering_url.call(this,this.xmlFileUrl,a,b));if(ss.length)
self.setSortImgState(true,ss[0],ss[1]);return false;}
return true;});});dhtmlXGridObject.prototype._con_f_used=[];dhtmlXGridObject.prototype._in_header_connector_text_filter=function(t,i){if(!this._con_f_used[i])
this._con_f_used[i]=1;return this._in_header_text_filter(t,i);};dhtmlXGridObject.prototype._in_header_connector_select_filter=function(t,i){if(!this._con_f_used[i])
this._con_f_used[i]=2;return this._in_header_select_filter(t,i);};if(!dhtmlXGridObject.prototype.load_connector){dhtmlXGridObject.prototype.load_connector=dhtmlXGridObject.prototype.load;dhtmlXGridObject.prototype.load=function(url,call,type){if(!this._colls_loaded&&this.cellType){var ar=[];for(var i=0;i<this.cellType.length;i++)
if(this.cellType[i].indexOf("co")==0||this.cellType[i].indexOf("clist")==0||this._con_f_used[i]==2)ar.push(i);if(ar.length)
arguments[0]+=(arguments[0].indexOf("?")!=-1?"&":"?")+"connector=true&dhx_colls="+ar.join(",");}
return this.load_connector.apply(this,arguments);};dhtmlXGridObject.prototype._parseHead_connector=dhtmlXGridObject.prototype._parseHead;dhtmlXGridObject.prototype._parseHead=function(url,call,type){this._parseHead_connector.apply(this,arguments);if(!this._colls_loaded){var cols=dhx4.ajax.xpath("./coll_options",arguments[0]);for(var i=0;i<cols.length;i++){var f=cols[i].getAttribute("for");var v=[];var combo=null;if(this.cellType[f]=="combo")
combo=this.getColumnCombo(f);else if(this.cellType[f].indexOf("co")==0)
combo=this.getCombo(f);var os=dhx4.ajax.xpath("./item",cols[i]);var opts=[];for(var j=0;j<os.length;j++){var val=os[j].getAttribute("value");if(combo){var lab=os[j].getAttribute("label")||val;if(combo.addOption)
opts.push([val,lab]);else
combo.put(val,lab);v[v.length]=lab;}else
v[v.length]=val;}
if(opts.length){if(combo)
combo.addOption(opts);}else if(v.length&&!combo)
if(this.registerCList)
this.registerCList(f*1,v);if(this._con_f_used[f*1])
this._con_f_used[f*1]=v;}
this._colls_loaded=true;}};}
function dhtmlXGridCellObject(obj){this.destructor=function(){this.cell.obj=null;this.cell=null;this.grid=null;this.base=null;return null;}
this.cell=obj;this.getValue=function(){if((this.cell.textContent)&&(this.cell.textContent.tagName=="TEXTAREA"))
return this.cell.textContent.value;else
return this.cell.innerHTML._dhx_trim();}
this.getMathValue=function(){if(this.cell.original)
return this.cell.original;else
return this.getValue();}
this.getFont=function(){arOut=new Array(3);if(this.cell.style.fontFamily)
arOut[0]=this.cell.style.fontFamily
if(this.cell.style.fontWeight=='bold'||this.cell.parentNode.style.fontWeight=='bold')
arOut[1]='bold';if(this.cell.style.fontStyle=='italic'||this.cell.parentNode.style.fontWeight=='italic')
arOut[1]+='italic';if(this.cell.style.fontSize)
arOut[2]=this.cell.style.fontSize
else
arOut[2]="";return arOut.join("-")}
this.getTextColor=function(){if(this.cell.style.color)
return this.cell.style.color
else
return"#000000";}
this.getBgColor=function(){return this.cell.style.backgroundColor||"#FFFFFF";}
this.getHorAlign=function(){if(this.cell.style.textAlign)
return this.cell.style.textAlign;else if(this.cell.style.textAlign)
return this.cell.style.textAlign;else
return"left";}
this.getWidth=function(){return this.cell.scrollWidth;}
this.setFont=function(val){fntAr=val.split("-");this.cell.style.fontFamily=fntAr[0];this.cell.style.fontSize=fntAr[fntAr.length-1]
if(fntAr.length==3){if(/bold/.test(fntAr[1]))
this.cell.style.fontWeight="bold";if(/italic/.test(fntAr[1]))
this.cell.style.fontStyle="italic";if(/underline/.test(fntAr[1]))
this.cell.style.textDecoration="underline";}}
this.setTextColor=function(val){this.cell.style.color=val;}
this.setBgColor=function(val){if(val=="")
val=null;this.cell.style.background=val;}
this.setHorAlign=function(val){if(val.length==1){if(val=='c')
this.cell.style.textAlign='center'
else if(val=='l')
this.cell.style.textAlign='left';else
this.cell.style.textAlign='right';}else
this.cell.style.textAlign=val}
this.wasChanged=function(){if(this.cell.wasChanged)
return true;else
return false;}
this.isCheckbox=function(){var ch=this.cell.firstChild;if(ch&&ch.tagName=='INPUT'){type=ch.type;if(type=='radio'||type=='checkbox')
return true;else
return false;}else
return false;}
this.isChecked=function(){if(this.isCheckbox()){return this.cell.firstChild.checked;}}
this.isDisabled=function(){return this.cell._disabled;}
this.setChecked=function(fl){if(this.isCheckbox()){if(fl!='true'&&fl!=1)
fl=false;this.cell.firstChild.checked=fl;}}
this.setDisabled=function(fl){if(fl!='true'&&fl!=1)
fl=false;if(this.isCheckbox()){this.cell.firstChild.disabled=fl;if(this.disabledF)
this.disabledF(fl);}
this.cell._disabled=fl;}}
dhtmlXGridCellObject.prototype={getAttribute:function(name){return this.cell._attrs[name];},setAttribute:function(name,value){this.cell._attrs[name]=value;},getInput:function(){if(this.obj&&(this.obj.tagName=="INPUT"||this.obj.tagName=="TEXTAREA"))return this.obj;var inps=(this.obj||this.cell).getElementsByTagName("TEXTAREA");if(!inps.length)
inps=(this.obj||this.cell).getElementsByTagName("INPUT");return inps[0];}}
dhtmlXGridCellObject.prototype.setValue=function(val){if((typeof(val)!="number")&&(!val||val.toString()._dhx_trim()=="")){val="&nbsp;"
this.cell._clearCell=true;}else
this.cell._clearCell=false;this.setCValue(val);}
dhtmlXGridCellObject.prototype.getTitle=function(){return(_isIE?this.cell.innerText:this.cell.textContent);}
dhtmlXGridCellObject.prototype.setCValue=function(val,val2){this.cell.innerHTML=val;this.grid.callEvent("onCellChanged",[this.cell.parentNode.idd,this.cell._cellIndex,(arguments.length>1?val2:val)]);}
dhtmlXGridCellObject.prototype.setCTxtValue=function(val){this.cell.innerHTML="";this.cell.appendChild(document.createTextNode(val));this.grid.callEvent("onCellChanged",[this.cell.parentNode.idd,this.cell._cellIndex,val]);}
dhtmlXGridCellObject.prototype.setLabel=function(val){this.cell.innerHTML=val;}
dhtmlXGridCellObject.prototype.getMath=function(){if(this._val)
return this.val;else
return this.getValue();}
function eXcell(){this.obj=null;this.val=null;this.changeState=function(){return false}
this.edit=function(){this.val=this.getValue()}
this.detach=function(){return false}
this.getPosition=function(oNode){var oCurrentNode=oNode;var iLeft=0;var iTop=0;while(oCurrentNode.tagName!="BODY"){iLeft+=oCurrentNode.offsetLeft;iTop+=oCurrentNode.offsetTop;oCurrentNode=oCurrentNode.offsetParent;}
return new Array(iLeft,iTop);}}
eXcell.prototype=new dhtmlXGridCellObject;function eXcell_ed(cell){if(cell){this.cell=cell;this.grid=this.cell.parentNode.grid;}
this.edit=function(){this.cell.atag=(!this.grid.multiLine)?"INPUT":"TEXTAREA";this.val=this.getValue();this.obj=document.createElement(this.cell.atag);this.obj.setAttribute("autocomplete","off");this.obj.style.height=(this.cell.offsetHeight-(this.grid.multiLine?9:4))+"px";this.obj.className="dhx_combo_edit";this.obj.wrap="soft";this.obj.style.textAlign=this.cell.style.textAlign;this.obj.onclick=function(e){(e||event).cancelBubble=true}
this.obj.onmousedown=function(e){(e||event).cancelBubble=true}
this.obj.value=this.val
this.cell.innerHTML="";this.cell.appendChild(this.obj);this.obj.onselectstart=function(e){if(!e)
e=event;e.cancelBubble=true;return true;};if(_isIE){this.obj.focus();this.obj.blur();}
this.obj.focus();}
this.getValue=function(){if((this.cell.firstChild)&&((this.cell.atag)&&(this.cell.firstChild.tagName==this.cell.atag)))
return this.cell.firstChild.value;if(this.cell._clearCell)
return"";return this.cell.innerHTML.toString()._dhx_trim();}
this.detach=function(){this.setValue(this.obj.value);return this.val!=this.getValue();}}
eXcell_ed.prototype=new eXcell;function eXcell_edtxt(cell){if(cell){this.cell=cell;this.grid=this.cell.parentNode.grid;}
this.getValue=function(){if((this.cell.firstChild)&&((this.cell.atag)&&(this.cell.firstChild.tagName==this.cell.atag)))
return this.cell.firstChild.value;if(this.cell._clearCell)
return"";return(_isIE?this.cell.innerText:this.cell.textContent);}
this.setValue=function(val){if(!val||val.toString()._dhx_trim()==""){val=" ";this.cell._clearCell=true;}else
this.cell._clearCell=false;this.setCTxtValue(val);}}
eXcell_edtxt.prototype=new eXcell_ed;function eXcell_edn(cell){if(cell){this.cell=cell;this.grid=this.cell.parentNode.grid;}
this.getValue=function(){if((this.cell.firstChild)&&(this.cell.firstChild.tagName=="TEXTAREA"))
return this.cell.firstChild.value;if(this.cell._clearCell)
return"";return this.cell._orig_value||this.grid._aplNFb(this.cell.innerHTML.toString()._dhx_trim(),this.cell._cellIndex);}
this.detach=function(){var tv=this.obj.value;this.setValue(tv);return this.val!=this.getValue();}}
eXcell_edn.prototype=new eXcell_ed;eXcell_edn.prototype.setValue=function(val){if(!val||val.toString()._dhx_trim()==""){this.cell._clearCell=true;return this.setCValue("&nbsp;",0);}else{this.cell._clearCell=false;this.cell._orig_value=val;}
this.setCValue(this.grid._aplNF(val,this.cell._cellIndex),val);}
function eXcell_ch(cell){if(cell){this.cell=cell;this.grid=this.cell.parentNode.grid;}
this.disabledF=function(fl){if((fl==true)||(fl==1))
this.cell.innerHTML=this.cell.innerHTML.replace("item_chk0.","item_chk0_dis.").replace("item_chk1.","item_chk1_dis.");else
this.cell.innerHTML=this.cell.innerHTML.replace("item_chk0_dis.","item_chk0.").replace("item_chk1_dis.","item_chk1.");}
this.changeState=function(fromClick){if(fromClick===true&&!this.grid.isActive){if(window.globalActiveDHTMLGridObject!=null&&window.globalActiveDHTMLGridObject!=this.grid&&window.globalActiveDHTMLGridObject.isActive)window.globalActiveDHTMLGridObject.setActive(false);this.grid.setActive(true);}
if((!this.grid.isEditable)||(this.cell.parentNode._locked)||(this.isDisabled()))
return;if(this.grid.callEvent("onEditCell",[0,this.cell.parentNode.idd,this.cell._cellIndex])){this.val=this.getValue()
if(this.val=="1")
this.setValue("0")
else
this.setValue("1")
this.cell.wasChanged=true;this.grid.callEvent("onEditCell",[1,this.cell.parentNode.idd,this.cell._cellIndex]);this.grid.callEvent("onCheckbox",[this.cell.parentNode.idd,this.cell._cellIndex,(this.val!='1')]);this.grid.callEvent("onCheck",[this.cell.parentNode.idd,this.cell._cellIndex,(this.val!='1')]);}else{this.editor=null;}}
this.getValue=function(){return this.cell.chstate?this.cell.chstate.toString():"0";}
this.isCheckbox=function(){return true;}
this.isChecked=function(){if(this.getValue()=="1")
return true;else
return false;}
this.setChecked=function(fl){this.setValue(fl.toString())}
this.detach=function(){return this.val!=this.getValue();}
this.edit=null;}
eXcell_ch.prototype=new eXcell;eXcell_ch.prototype.setValue=function(val){this.cell.style.verticalAlign="middle";if(val){val=val.toString()._dhx_trim();if((val=="false")||(val=="0"))
val="";}
if(val){val="1";this.cell.chstate="1";}else{val="0";this.cell.chstate="0"}
var obj=this;this.cell.setAttribute("excell","ch");this.setCValue("<img src='"+this.grid.imgURL+"item_chk"+val
+".gif' onclick='new eXcell_ch(this.parentNode).changeState(true); (arguments[0]||event).cancelBubble=true; '>",this.cell.chstate);}
function eXcell_ra(cell){this.base=eXcell_ch;this.base(cell)
this.grid=cell.parentNode.grid;this.disabledF=function(fl){if((fl==true)||(fl==1))
this.cell.innerHTML=this.cell.innerHTML.replace("radio_chk0.","radio_chk0_dis.").replace("radio_chk1.","radio_chk1_dis.");else
this.cell.innerHTML=this.cell.innerHTML.replace("radio_chk0_dis.","radio_chk0.").replace("radio_chk1_dis.","radio_chk1.");}
this.changeState=function(mode){if(mode===false&&this.getValue()==1)return;if((!this.grid.isEditable)||(this.cell.parentNode._locked)||(this.isDisabled()))
return;if(this.grid.callEvent("onEditCell",[0,this.cell.parentNode.idd,this.cell._cellIndex])!=false){this.val=this.getValue()
if(this.val=="1")
this.setValue("0")
else
this.setValue("1")
this.cell.wasChanged=true;this.grid.callEvent("onEditCell",[1,this.cell.parentNode.idd,this.cell._cellIndex]);this.grid.callEvent("onCheckbox",[this.cell.parentNode.idd,this.cell._cellIndex,(this.val!='1')]);this.grid.callEvent("onCheck",[this.cell.parentNode.idd,this.cell._cellIndex,(this.val!='1')]);}else{this.editor=null;}}
this.edit=null;}
eXcell_ra.prototype=new eXcell_ch;eXcell_ra.prototype.setValue=function(val){this.cell.style.verticalAlign="middle";if(val){val=val.toString()._dhx_trim();if((val=="false")||(val=="0"))
val="";}
if(val){if(!this.grid._RaSeCol)
this.grid._RaSeCol=[];if(this.grid._RaSeCol[this.cell._cellIndex]){var z=this.grid.cells(this.grid._RaSeCol[this.cell._cellIndex],this.cell._cellIndex);z.setValue("0")
if(this.grid.rowsAr[z.cell.parentNode.idd])
this.grid.callEvent("onEditCell",[1,z.cell.parentNode.idd,z.cell._cellIndex]);}
this.grid._RaSeCol[this.cell._cellIndex]=this.cell.parentNode.idd;val="1";this.cell.chstate="1";}else{val="0";this.cell.chstate="0"}
this.cell.setAttribute("excell","ra");this.setCValue("<img src='"+this.grid.imgURL+"radio_chk"+val+".gif' onclick='new eXcell_ra(this.parentNode).changeState(false);'>",this.cell.chstate);}
function eXcell_txt(cell){if(cell){this.cell=cell;this.grid=this.cell.parentNode.grid;}
this.edit=function(){this.val=this.getValue()
this.obj=document.createElement("TEXTAREA");this.obj.className="dhx_textarea";this.obj.onclick=function(e){(e||event).cancelBubble=true}
var arPos=this.grid.getPosition(this.cell);this.obj.value=this.val;this.obj.style.display="";this.obj.style.textAlign=this.cell.style.textAlign;document.body.appendChild(this.obj);if(_isOpera)this.obj.onkeypress=function(ev){if(ev.keyCode==9||ev.keyCode==27)return false;}
this.obj.onkeydown=function(e){var ev=(e||event);if(ev.keyCode==9||ev.keyCode==27){globalActiveDHTMLGridObject.entBox.focus();globalActiveDHTMLGridObject.doKey({keyCode:ev.keyCode,shiftKey:ev.shiftKey,srcElement:"0"});return false;}}
this.obj.style.left=arPos[0]+"px";this.obj.style.top=arPos[1]+this.cell.offsetHeight+"px";if(this.cell.offsetWidth<200)
var pw=200;else
var pw=this.cell.offsetWidth;this.obj.style.width=pw+16+"px"
if(_isIE){this.obj.select();this.obj.value=this.obj.value;}
this.obj.focus()}
this.detach=function(){var a_val="";a_val=this.obj.value;if(a_val==""){this.cell._clearCell=true;}
else
this.cell._clearCell=false;this.setValue(a_val);document.body.removeChild(this.obj);this.obj=null;return this.val!=this.getValue();}
this.getValue=function(){if(this.obj){return this.obj.value;}
if(this.cell._clearCell)
return"";if(typeof this.cell._brval!="undefined")return this.cell._brval;if((!this.grid.multiLine))
return this.cell._brval||this.cell.innerHTML;else
return this.cell._brval||this.cell.innerHTML.replace(/<br[^>]*>/gi,"\n")._dhx_trim();}}
eXcell_txt.prototype=new eXcell;function eXcell_txttxt(cell){if(cell){this.cell=cell;this.grid=this.cell.parentNode.grid;}
this.getValue=function(){if((this.cell.firstChild)&&(this.cell.firstChild.tagName=="TEXTAREA"))
return this.cell.firstChild.value;if(this.cell._clearCell)
return"";if((!this.grid.multiLine)&&this.cell._brval)
return this.cell._brval;return(_isIE?this.cell.innerText:this.cell.textContent);}
this.setValue=function(val){this.cell._brval=val;if(!val||val.toString()._dhx_trim()==""){val=" ";this.cell._clearCell=true;}else
this.cell._clearCell=false;this.setCTxtValue(val);}}
eXcell_txttxt.prototype=new eXcell_txt;eXcell_txt.prototype.setValue=function(val){this.cell._brval=val;if(!val||val.toString()._dhx_trim()==""){val="&nbsp;"
this.cell._clearCell=true;}else
this.cell._clearCell=false;if((!this.grid.multiLine)||this.cell._clearCell)
this.setCValue(val,this.cell._brval);else
this.setCValue(val.replace(/\n/g,"<br/>"),val);}
function eXcell_co(cell){if(cell){this.cell=cell;this.grid=this.cell.parentNode.grid;this.combo=(this.cell._combo||this.grid.getCombo(this.cell._cellIndex));this.editable=true}
this.shiftNext=function(){var z=this.list.options[this.list.selectedIndex+1];if(z)
z.selected=true;this.obj.value=this.list.options[this.list.selectedIndex].text;return true;}
this.shiftPrev=function(){if(this.list.selectedIndex!=0){var z=this.list.options[this.list.selectedIndex-1];if(z)
z.selected=true;this.obj.value=this.list.options[this.list.selectedIndex].text;}
return true;}
this.edit=function(){this.val=this.getValue();this.text=this.getText()._dhx_trim();var arPos=this.grid.getPosition(this.cell)
this.obj=document.createElement("TEXTAREA");this.obj.className="dhx_combo_edit";this.obj.style.height=(this.cell.offsetHeight-(this.grid.multiLine?9:4))+"px";this.obj.wrap="soft";this.obj.style.textAlign=this.cell.style.textAlign;this.obj.onclick=function(e){(e||event).cancelBubble=true}
this.obj.onmousedown=function(e){(e||event).cancelBubble=true}
this.obj.value=this.text
this.obj.onselectstart=function(e){if(!e)
e=event;e.cancelBubble=true;return true;};var editor_obj=this;this.obj.onkeyup=function(e){var key=(e||event).keyCode;if(key==38||key==40||key==9)return;var val=this.readonly?String.fromCharCode(key):this.value;var c=editor_obj.list.options;for(var i=0;i<c.length;i++)
if(c[i].text.indexOf(val)==0)
return c[i].selected=true;}
this.list=document.createElement("SELECT");this.list.className='dhx_combo_select';this.list.style.width=this.cell.offsetWidth+"px";this.list.style.left=arPos[0]+"px";this.list.style.top=arPos[1]+this.cell.offsetHeight+"px";this.list.onclick=function(e){var ev=e||window.event;var cell=ev.target||ev.srcElement
if(cell.tagName=="OPTION")
cell=cell.parentNode;editor_obj.editable=false;editor_obj.grid.editStop();ev.cancelBubble=true;}
var comboKeys=this.combo.getKeys();var fl=false
var selOptId=0;for(var i=0;i<comboKeys.length;i++){var val=this.combo.get(comboKeys[i])
this.list.options[this.list.options.length]=new Option(val,comboKeys[i]);if(comboKeys[i]==this.val){selOptId=this.list.options.length-1;fl=true;}}
if(fl==false){this.list.options[this.list.options.length]=new Option(this.text,this.val===null?"":this.val);selOptId=this.list.options.length-1;}
document.body.appendChild(this.list)
this.list.size="6";this.cstate=1;if(this.editable){this.cell.innerHTML="";}
else{this.obj.style.width="0px";this.obj.style.height="0px";}
this.cell.appendChild(this.obj);this.list.options[selOptId].selected=true;if(this.editable){this.obj.focus();this.obj.focus();}
if(!this.editable){this.obj.style.visibility="hidden";this.obj.style.position="absolute";this.list.focus();this.list.onkeydown=function(e){e=e||window.event;editor_obj.grid.setActive(true)
if(e.keyCode<30)
return editor_obj.grid.doKey({target:editor_obj.cell,keyCode:e.keyCode,shiftKey:e.shiftKey,ctrlKey:e.ctrlKey})}}}
this.getValue=function(){return((this.cell.combo_value==window.undefined)?"":this.cell.combo_value);}
this.detach=function(){if(this.val!=this.getValue()){this.cell.wasChanged=true;}
if(this.list.parentNode!=null){if(this.editable){var ind=this.list.options[this.list.selectedIndex]
if(ind&&ind.text==this.obj.value)
this.setValue(this.list.value)
else{var combo=(this.cell._combo||this.grid.getCombo(this.cell._cellIndex));var val=combo.values._dhx_find(this.obj.value);if(val!=-1)this.setValue(combo.keys[val]);else this.setValue(this.cell.combo_value=this.obj.value);}}
else
this.setValue(this.list.value)}
if(this.list.parentNode)
this.list.parentNode.removeChild(this.list);if(this.obj.parentNode)
this.obj.parentNode.removeChild(this.obj);return this.val!=this.getValue();}}
eXcell_co.prototype=new eXcell;eXcell_co.prototype.getText=function(){return this.cell.innerHTML;}
eXcell_co.prototype.setValue=function(val){if(typeof(val)=="object"){var optCol=dhx4.ajax.xpath("./option",val);if(optCol.length)
this.cell._combo=new dhtmlXGridComboObject();for(var j=0;j<optCol.length;j++)this.cell._combo.put(optCol[j].getAttribute("value"),optCol[j].firstChild?optCol[j].firstChild.data:"");val=val.firstChild.data;}
if((val||"").toString()._dhx_trim()=="")
val=null
this.cell.combo_value=val;if(val!==null){var label=(this.cell._combo||this.grid.getCombo(this.cell._cellIndex)).get(val);this.setCValue(label===null?val:label,val);}else
this.setCValue("&nbsp;",val);}
function eXcell_coro(cell){this.base=eXcell_co;this.base(cell)
this.editable=false;}
eXcell_coro.prototype=new eXcell_co;function eXcell_cotxt(cell){this.base=eXcell_co;this.base(cell)}
eXcell_cotxt.prototype=new eXcell_co;eXcell_cotxt.prototype.getText=function(){return(_isIE?this.cell.innerText:this.cell.textContent);}
eXcell_cotxt.prototype.setValue=function(val){if(typeof(val)=="object"){var optCol=dhx4.ajax.xpath("./option",val);if(optCol.length)
this.cell._combo=new dhtmlXGridComboObject();for(var j=0;j<optCol.length;j++)this.cell._combo.put(optCol[j].getAttribute("value"),optCol[j].firstChild?optCol[j].firstChild.data:"");val=val.firstChild.data;}
if((val||"").toString()._dhx_trim()=="")
val=null
if(val!==null)
this.setCTxtValue((this.cell._combo||this.grid.getCombo(this.cell._cellIndex)).get(val)||val,val);else
this.setCTxtValue(" ",val);this.cell.combo_value=val;}
function eXcell_corotxt(cell){this.base=eXcell_co;this.base(cell)
this.editable=false;}
eXcell_corotxt.prototype=new eXcell_cotxt;function eXcell_cp(cell){try{this.cell=cell;this.grid=this.cell.parentNode.grid;}
catch(er){}
this.edit=function(){this.val=this.getValue()
this.obj=document.createElement("SPAN");this.obj.style.border="1px solid black";this.obj.style.position="absolute";var arPos=this.grid.getPosition(this.cell);this.colorPanel(4,this.obj)
document.body.appendChild(this.obj);this.obj.style.left=arPos[0]+"px";this.obj.style.zIndex=1000;this.obj.style.top=arPos[1]+this.cell.offsetHeight+"px";}
this.toolDNum=function(value){if(value.length==1)
value='0'+value;return value;}
this.colorPanel=function(index,parent){var tbl=document.createElement("TABLE");parent.appendChild(tbl)
tbl.cellSpacing=0;tbl.editor_obj=this;tbl.style.cursor="default";tbl.onclick=function(e){var ev=e||window.event
var cell=ev.target||ev.srcElement;var ed=cell.parentNode.parentNode.parentNode.editor_obj
if(ed){ed.setValue(cell._bg);ed.grid.editStop();}}
var cnt=256/index;for(var j=0;j<=(256/cnt);j++){var r=tbl.insertRow(j);for(var i=0;i<=(256/cnt);i++){for(var n=0;n<=(256/cnt);n++){R=new Number(cnt*j)-(j==0?0:1)
G=new Number(cnt*i)-(i==0?0:1)
B=new Number(cnt*n)-(n==0?0:1)
var rgb=this.toolDNum(R.toString(16))+""+this.toolDNum(G.toString(16))+""+this.toolDNum(B.toString(16));var c=r.insertCell(i);c.width="10px";c.innerHTML="&nbsp;";c.title=rgb.toUpperCase()
c.style.backgroundColor="#"+rgb
c._bg="#"+rgb;if(this.val!=null&&"#"+rgb.toUpperCase()==this.val.toUpperCase()){c.style.border="2px solid white"}}}}}
this.getValue=function(){return this.cell.firstChild._bg||"";}
this.getRed=function(){return Number(parseInt(this.getValue().substr(1,2),16))}
this.getGreen=function(){return Number(parseInt(this.getValue().substr(3,2),16))}
this.getBlue=function(){return Number(parseInt(this.getValue().substr(5,2),16))}
this.detach=function(){if(this.obj.offsetParent!=null)
document.body.removeChild(this.obj);return this.val!=this.getValue();}}
eXcell_cp.prototype=new eXcell;eXcell_cp.prototype.setValue=function(val){this.setCValue("<div style='width:100%;height:"+((this.grid.multiLine?"100%":23))+";background-color:"+(val||"")
+";border:0px;'>&nbsp;</div>",val);this.cell.firstChild._bg=val;}
function eXcell_img(cell){try{this.cell=cell;this.grid=this.cell.parentNode.grid;}
catch(er){}
this.getValue=function(){if(this.cell.firstChild.tagName=="IMG")
return this.cell.firstChild.src+(this.cell.titFl!=null?"^"+this.cell._brval:"");else if(this.cell.firstChild.tagName=="A"){var out=this.cell.firstChild.firstChild.src+(this.cell.titFl!=null?"^"+this.cell._brval:"");out+="^"+this.cell.lnk;if(this.cell.trg)
out+="^"+this.cell.trg
return out;}}
this.isDisabled=function(){return true;}}
eXcell_img.prototype=new eXcell;eXcell_img.prototype.getTitle=function(){return this.cell._brval}
eXcell_img.prototype.setValue=function(val){var title=val;if((val||"").indexOf("^")!=-1){var ar=val.split("^");val=ar[0]
title=this.cell._attrs.title||ar[1];if(ar.length>2){this.cell.lnk=ar[2]
if(ar[3])
this.cell.trg=ar[3]}
this.cell.titFl="1";}
if(!this.grid.multiLine)
this.setCValue("<img src='"+this.grid.iconURL+(val||"")._dhx_trim()+"' border='0' style='max-height:"+(this.grid._srdh-4)+"px'>",val);else
this.setCValue("<img src='"+this.grid.iconURL+(val||"")._dhx_trim()+"' border='0'>",val);if(this.cell.lnk){this.cell.innerHTML="<a href='"+this.cell.lnk+"' target='"+this.cell.trg+"'>"+this.cell.innerHTML+"</a>"}
this.cell._brval=title;}
function eXcell_icon(cell){this.base=eXcell_ed;this.base(cell)
try{this.cell=cell;this.grid=this.cell.parentNode.grid;}
catch(er){}
this.setValue=function(val){this.cell._raw_value=val;this.setCValue('<div class="dhx_grid_icon"><i class="fa fa-'+val.toString()._dhx_trim()+'"></i></div>');}
this.getValue=function(){return this.cell._raw_value;}
this.isDisabled=function(){return true;}}
eXcell_icon.prototype=new eXcell_ed;function eXcell_price(cell){this.base=eXcell_ed;this.base(cell)
this.getValue=function(){if(this.cell.childNodes.length>1)
return this.cell.childNodes[1].innerHTML.toString()._dhx_trim()
else
return"0";}}
eXcell_price.prototype=new eXcell_ed;eXcell_price.prototype.setValue=function(val){if(isNaN(parseFloat(val))){val=this.val||0;}
var color="green";if(val<0)
color="red";this.setCValue("<span>$</span><span style='padding-right:2px;color:"+color+";'>"+val+"</span>",val);}
function eXcell_dyn(cell){this.base=eXcell_ed;this.base(cell)
this.getValue=function(){return this.cell.firstChild.childNodes[1].innerHTML.toString()._dhx_trim()}}
eXcell_dyn.prototype=new eXcell_ed;eXcell_dyn.prototype.setValue=function(val){if(!val||isNaN(Number(val))){if(val!=="")
val=0;}
if(val>0){var color="green";var img="dyn_up.gif";}else if(val==0){var color="black";var img="dyn_.gif";}else{var color="red";var img="dyn_down.gif";}
this.setCValue("<div class='grid_cell_dyn'><img src='"+this.grid.imgURL+""+img
+"'><span style='color:"+color+";'>"+val
+"</span></div>",val);}
function eXcell_ro(cell){if(cell){this.cell=cell;this.grid=this.cell.parentNode.grid;}
this.edit=function(){}
this.isDisabled=function(){return true;}
this.getValue=function(){return this.cell._clearCell?"":this.cell.innerHTML.toString()._dhx_trim();}}
eXcell_ro.prototype=new eXcell;window.eXcell_hidden=function(cell){if(cell){this.cell=cell;this.grid=this.cell.parentNode.grid;}
this.edit=function(){}
this.isDisabled=function(){return true;}
this.getValue=function(){return this.cell.val;}}
eXcell_hidden.prototype=new eXcell;eXcell_hidden.prototype.setValue=function(value){this.cell.val=value;}
function eXcell_ron(cell){this.cell=cell;this.grid=this.cell.parentNode.grid;this.edit=function(){}
this.isDisabled=function(){return true;}
this.getValue=function(){return this.cell._clearCell?"":this.cell._orig_value||this.grid._aplNFb(this.cell.innerHTML.toString()._dhx_trim(),this.cell._cellIndex).toString();}}
eXcell_ron.prototype=new eXcell;eXcell_ron.prototype.setValue=function(val){if(val===0){}
else if(!val||val.toString()._dhx_trim()==""){this.setCValue("&nbsp;");return this.cell._clearCell=true;}
this.cell._orig_value=val;this.cell._clearCell=false;this.setCValue(val?this.grid._aplNF(val,this.cell._cellIndex):"0");}
function eXcell_rotxt(cell){this.cell=cell;this.grid=this.cell.parentNode.grid;this.edit=function(){}
this.isDisabled=function(){return true;}
this.setValue=function(val){if(!val){val=" ";this.cell._clearCell=true;}
else
this.cell._clearCell=false;this.setCTxtValue(val);}
this.getValue=function(){if(this.cell._clearCell)
return"";return(_isIE?this.cell.innerText:this.cell.textContent);}}
eXcell_rotxt.prototype=new eXcell;function dhtmlXGridComboObject(){this.keys=new dhtmlxArray();this.values=new dhtmlxArray();this.put=function(key,value){for(var i=0;i<this.keys.length;i++){if(this.keys[i]==key){this.values[i]=value;return true;}}
this.values[this.values.length]=value;this.keys[this.keys.length]=key;}
this.get=function(key){for(var i=0;i<this.keys.length;i++){if(this.keys[i]==key){return this.values[i];}}
return null;}
this.clear=function(){this.keys=new dhtmlxArray();this.values=new dhtmlxArray();}
this.remove=function(key){for(var i=0;i<this.keys.length;i++){if(this.keys[i]==key){this.keys._dhx_removeAt(i);this.values._dhx_removeAt(i);return true;}}}
this.size=function(){var j=0;for(var i=0;i<this.keys.length;i++){if(this.keys[i]!=null)
j++;}
return j;}
this.getKeys=function(){var keyAr=new Array(0);for(var i=0;i<this.keys.length;i++){if(this.keys[i]!=null)
keyAr[keyAr.length]=this.keys[i];}
return keyAr;}
this.save=function(){this._save=new Array();for(var i=0;i<this.keys.length;i++)this._save[i]=[this.keys[i],this.values[i]];}
this.restore=function(){if(this._save){this.keys[i]=new Array();this.values[i]=new Array();for(var i=0;i<this._save.length;i++){this.keys[i]=this._save[i][0];this.values[i]=this._save[i][1];}}}
return this;}
function Hashtable(){this.keys=new dhtmlxArray();this.values=new dhtmlxArray();return this;}
Hashtable.prototype=new dhtmlXGridComboObject;if(typeof(window.dhtmlXCellObject)!="undefined"){dhtmlXCellObject.prototype.attachGrid=function(){this.callEvent("_onBeforeContentAttach",["grid"]);var obj=document.createElement("DIV");obj.style.width="100%";obj.style.height="100%";obj.style.position="relative";obj.style.overflow="hidden";this._attachObject(obj);this.dataType="grid";this.dataObj=new dhtmlXGridObject(obj);this.dataObj.setSkin(this.conf.skin);if(typeof(window.dhtmlXTabBarCell)=="function"&&this instanceof window.dhtmlXTabBarCell&&navigator.userAgent.match(/7[\.\d]* mobile/gi)!=null&&navigator.userAgent.match(/AppleWebKit/gi)!=null){this.dataObj.objBox.style.webkitOverflowScrolling="auto";}
if(this.conf.skin=="material"&&typeof(window.dhtmlXLayoutCell)=="function"&&this instanceof window.dhtmlXLayoutCell){this.cell.childNodes[this.conf.idx.cont].style.overflow="hidden";}
if(this.conf.skin=="dhx_skyblue"&&typeof(window.dhtmlXWindowsCell)=="function"&&this instanceof window.dhtmlXWindowsCell){this.dataObj.entBox.style.border="1px solid #a4bed4";this.dataObj._sizeFix=0;}else{this.dataObj.entBox.style.border="0px solid white";this.dataObj._sizeFix=2;}
obj=null;this.callEvent("_onContentAttach",[]);return this.dataObj;};}
dhtmlXGridObject.prototype.enableDragAndDrop=function(mode){if(mode=="temporary_disabled"){this.dADTempOff=false;mode=true;}
else
this.dADTempOff=true;this.dragAndDropOff=dhx4.s2b(mode);this._drag_validate=true;if(mode)
this.objBox.ondragstart=function(e){(e||event).cancelBubble=true;return false;}};dhtmlXGridObject.prototype.setDragBehavior=function(mode){this.dadmodec=this.dadmodefix=0;switch(mode){case"child":this.dadmode=0;this._sbmod=false;break;case"sibling":this.dadmode=1;this._sbmod=false;break;case"sibling-next":this.dadmode=1;this._sbmod=true;break;case"complex":this.dadmode=2;this._sbmod=false;break;case"complex-next":this.dadmode=2;this._sbmod=true;break;}};dhtmlXGridObject.prototype.enableDragOrder=function(mode){this._dndorder=dhx4.s2b(mode);};dhtmlXGridObject.prototype._checkParent=function(row,ids){var z=this._h2.get[row.idd].parent;if(!z.parent)return;for(var i=0;i<ids.length;i++)
if(ids[i]==z.id)return true;return this._checkParent(this.rowsAr[z.id],ids);}
dhtmlXGridObject.prototype._createDragNode=function(htmlObject,e){this.editStop();if(window.dhtmlDragAndDrop.dragNode)return null;if(!this.dADTempOff)return null;htmlObject.parentObject=new Object();htmlObject.parentObject.treeNod=this;var text=this.callEvent("onBeforeDrag",[htmlObject.parentNode.idd,htmlObject._cellIndex,e]);if(!text)return null;var z=new Array();z=this.getSelectedId();z=(((z)&&(z!=""))?z.split(this.delim):[]);var exst=false;for(var i=0;i<z.length;i++)
if(z[i]==htmlObject.parentNode.idd)exst=true;if(!exst){this.selectRow(this.rowsAr[htmlObject.parentNode.idd],false,e.ctrlKey,false);if(!e.ctrlKey){z=[];}
z[this.selMultiRows?z.length:0]=htmlObject.parentNode.idd;}
if(this.isTreeGrid()){for(var i=z.length-1;i>=0;i--)
if(this._checkParent(this.rowsAr[z[i]],z))z.splice(i,1);}
var self=this;if(z.length&&this._dndorder)
z.sort(function(a,b){return(self.rowsAr[a].rowIndex>self.rowsAr[b].rowIndex?1:-1);});var el=this.getFirstParentOfType(_isIE?e.srcElement:e.target,"TD");if(el)this._dndExtra=el._cellIndex;this._dragged=new Array();for(var i=0;i<z.length;i++)
if(this.rowsAr[z[i]]){this._dragged[this._dragged.length]=this.rowsAr[z[i]];this.rowsAr[z[i]].treeNod=this;}
htmlObject.parentObject.parentNode=htmlObject.parentNode;var dragSpan=document.createElement('div');dragSpan.innerHTML=(text!==true?text:this.rowToDragElement(htmlObject.parentNode.idd));dragSpan.style.position="absolute";dragSpan.className="dragSpanDiv";return dragSpan;}
dhtmlXGridObject.prototype._createSdrgc=function(){this._sdrgc=document.createElement("DIV");this._sdrgc.innerHTML="&nbsp;";this._sdrgc.className="gridDragLine";this.objBox.appendChild(this._sdrgc);}
function dragContext(a,b,c,d,e,f,j,h,k,l,m){this.source=a||"grid";this.target=b||"grid";this.mode=c||"move";this.dropmode=d||"child";this.sid=e||0;this.tid=f;this.sobj=j||null;this.tobj=h||null;this.sExtra=k||null;this.tExtra=l||null;this.before=m||false;return this;}
dragContext.prototype.valid=function(){if(this.sobj!=this.tobj)return true;if(this.sid==this.tid)return false;if(this.target=="treeGrid"){var z=this.tid
while(z=this.tobj.getParentId(z)){if(this.sid==z)return false;}}
return true;}
dragContext.prototype.close=function(){this.sobj=null;this.tobj=null;}
dragContext.prototype.copy=function(){return new dragContext(this.source,this.target,this.mode,this.dropmode,this.sid,this.tid,this.sobj,this.tobj,this.sExtra,this.tExtra,this.before);}
dragContext.prototype.set=function(a,b){this[a]=b;return this;}
dragContext.prototype.uid=function(a,b){this.nid=this.sid;while(this.tobj.rowsAr[this.nid])
this.nid=this.nid+((new Date()).valueOf());return this;}
dragContext.prototype.data=function(){if(this.sobj==this.tobj)
return this.sobj._getRowArray(this.sobj.rowsAr[this.sid]);if(this.source=="tree")
return this.tobj.treeToGridElement(this.sobj,this.sid,this.tid);else
return this.tobj.gridToGrid(this.sid,this.sobj,this.tobj);}
dragContext.prototype.attrs=function(){if(this.source=="tree")
return{};else
return this.sobj.rowsAr[this.sid]._attrs;}
dragContext.prototype.childs=function(){if(this.source=="treeGrid")
return this.sobj._h2.get[this.sid]._xml_await?this.sobj._h2.get[this.sid].has_kids:null;return null;}
dragContext.prototype.pid=function(){if(!this.tid)return 0;if(!this.tobj._h2)return 0;if(this.target=="treeGrid")
if(this.dropmode=="child")
return this.tid;else{var z=this.tobj.rowsAr[this.tid];var apid=this.tobj._h2.get[z.idd].parent.id;if((this.alfa)&&(this.tobj._sbmod)&&(z.nextSibling)){var zpid=this.tobj._h2.get[z.nextSibling.idd].parent.id;if(zpid==this.tid)
return this.tid;if(zpid!=apid)
return zpid;}
return apid;}}
dragContext.prototype.ind=function(){if(this.tid==window.unknown)return this.tobj.rowsBuffer.length;if(this.target=="treeGrid"){if(this.dropmode=="child")
this.tobj.openItem(this.tid);else
this.tobj.openItem(this.tobj.getParentId(this.tid));}
var ind=this.tobj.rowsBuffer._dhx_find(this.tobj.rowsAr[this.tid]);if((this.alfa)&&(this.tobj._sbmod)&&(this.dropmode=="sibling")){var z=this.tobj.rowsAr[this.tid];if((z.nextSibling)&&(this._h2.get[z.nextSibling.idd].parent.id==this.tid))
return ind+1;}
return(ind+1+((this.target=="treeGrid"&&ind>=0&&this.tobj._h2.get[this.tobj.rowsBuffer[ind].idd].state=="minus")?this.tobj._getOpenLenght(this.tobj.rowsBuffer[ind].idd,0):0));}
dragContext.prototype.img=function(){if((this.target!="grid")&&(this.sobj._h2))
return this.sobj.getItemImage(this.sid);else return null;}
dragContext.prototype.slist=function(){var res=new Array();for(var i=0;i<this.sid.length;i++)
res[res.length]=this.sid[i][(this.source=="tree")?"id":"idd"];return res.join(",");}
dhtmlXGridObject.prototype._drag=function(sourceHtmlObject,dhtmlObject,targetHtmlObject,lastLanding){if(this._realfake)return this._fake._drag();var z=(this.lastLanding)
if(this._autoOpenTimer)window.clearTimeout(this._autoOpenTimer);var r1=targetHtmlObject.parentNode;var r2=sourceHtmlObject.parentObject;if(!r1.idd){r1.grid=this;this.dadmodefix=0;}
var c=new dragContext(0,0,0,((r1.grid.dadmode==1||r1.grid.dadmodec)?"sibling":"child"));if(r2&&r2.childNodes)
c.set("source","tree").set("sobj",r2.treeNod).set("sid",c.sobj._dragged);else{if(!r2)return true;if(r2.treeNod.isTreeGrid&&r2.treeNod.isTreeGrid())
c.set("source","treeGrid");c.set("sobj",r2.treeNod).set("sid",c.sobj._dragged);}
if(r1.grid.isTreeGrid())
c.set("target","treeGrid");else
c.set("dropmode","sibling");c.set("tobj",r1.grid).set("tid",r1.idd);if(((c.tobj.dadmode==2)&&(c.tobj.dadmodec==1))&&(c.tobj.dadmodefix<0))
if(c.tobj.obj.rows[1].idd!=c.tid)c.tid=r1.previousSibling.idd;else{if(this._h2&&c.tid)
c.before=true;else c.tid=0;}
var el=this.getFirstParentOfType(lastLanding,"TD")
if(el)c.set("tExtra",el._cellIndex);if(el)c.set("sExtra",c.sobj._dndExtra);if(c.sobj.dpcpy)c.set("mode","copy");if(c.tobj._realfake)c.tobj=c.tobj._fake;if(c.sobj._realfake)c.sobj=c.sobj._fake;c.tobj._clearMove();if(r2&&r2.treeNod&&r2.treeNod._nonTrivialRow)
r2.treeNod._nonTrivialRow(this,c.tid,c.dropmode,r2);else{c.tobj.dragContext=c;if(!c.tobj.callEvent("onDrag",[c.slist(),c.tid,c.sobj,c.tobj,c.sExtra,c.tExtra]))return c.tobj.dragContext=null;var result=new Array();if(typeof(c.sid)=="object"){var nc=c.copy();for(var i=0;i<c.sid.length;i++){if(!nc.set("alfa",(!i)).set("sid",c.sid[i][(c.source=="tree"?"id":"idd")]).valid())continue;nc.tobj._dragRoutine(nc);if(nc.target=="treeGrid"&&nc.dropmode=="child")nc.tobj.openItem(nc.tid);result[result.length]=nc.nid;nc.set("dropmode","sibling").set("tid",nc.nid);}
nc.close();}
else
c.tobj._dragRoutine(c);if(c.tobj.laterLink)c.tobj.laterLink();c.tobj.callEvent("onDrop",[c.slist(),c.tid,result.join(","),c.sobj,c.tobj,c.sExtra,c.tExtra]);}
c.tobj.dragContext=null;c.close();}
dhtmlXGridObject.prototype._dragRoutine=function(c){if((c.sobj==c.tobj)&&(c.source=="grid")&&(c.mode=="move")&&!this._fake){if(c.sobj._dndProblematic)return;var fr=c.sobj.rowsAr[c.sid];var bind=c.sobj.rowsCol._dhx_find(fr);c.sobj.rowsCol._dhx_removeAt(c.sobj.rowsCol._dhx_find(fr));c.sobj.rowsBuffer._dhx_removeAt(c.sobj.rowsBuffer._dhx_find(fr));c.sobj.rowsBuffer._dhx_insertAt(c.ind(),fr);if(c.tobj._fake){c.tobj._fake.rowsCol._dhx_removeAt(bind);var tr=c.tobj._fake.rowsAr[c.sid];tr.parentNode.removeChild(tr);}
c.sobj._insertRowAt(fr,c.ind()-(this.pagingOn?((this.currentPage-1)*this.rowsBufferOutSize):0));c.nid=c.sid;c.sobj.callEvent("onGridReconstructed",[]);return;}
var new_row;if(this._h2&&typeof c.tid!="undefined"&&c.dropmode=="sibling"&&(this._sbmod||c.tid)){if(c.before)
new_row=c.uid().tobj.addRowBefore(c.nid,c.data(),c.tid,c.img(),c.childs());else if(c.alfa&&this._sbmod&&this._h2.get[c.tid].childs.length){this.openItem(c.tid)
new_row=c.uid().tobj.addRowBefore(c.nid,c.data(),this._h2.get[c.tid].childs[0].id,c.img(),c.childs());}
else
new_row=c.uid().tobj.addRowAfter(c.nid,c.data(),c.tid,c.img(),c.childs());}
else
new_row=c.uid().tobj.addRow(c.nid,c.data(),c.ind(),c.pid(),c.img(),c.childs());new_row._attrs=c.attrs();if(c.source=="tree"){this.callEvent("onRowAdded",[c.nid]);var sn=c.sobj._globalIdStorageFind(c.sid);if(sn.childsCount){var nc=c.copy().set("tid",c.nid).set("dropmode",c.target=="grid"?"sibling":"child");for(var j=0;j<sn.childsCount;j++){c.tobj._dragRoutine(nc.set("sid",sn.childNodes[j].id));if(c.mode=="move")j--;}
nc.close();}}
else{c.tobj._copyUserData(c);this.callEvent("onRowAdded",[c.nid]);if((c.source=="treeGrid")){if(c.sobj==c.tobj)new_row._xml=c.sobj.rowsAr[c.sid]._xml;var snc=c.sobj._h2.get[c.sid];if((snc)&&(snc.childs.length)){var nc=c.copy().set("tid",c.nid);if(c.target=="grid")
nc.set("dropmode","sibling");else{if(!nc.tobj.kidsXmlFile)
nc.tobj.openItem(c.tid);nc.set("dropmode","child");}
var l=snc.childs.length;if(!nc.tobj.kidsXmlFile)
for(var j=0;j<l;j++){c.sobj.render_row_tree(null,snc.childs[j].id);c.tobj._dragRoutine(nc.set("sid",snc.childs[j].id));if(l!=snc.childs.length){j--;l=snc.childs.length;}}
nc.close();}}}
if(c.mode=="move"){c.sobj[(c.source=="tree")?"deleteItem":"deleteRow"](c.sid);if((c.sobj==c.tobj)&&(!c.tobj.rowsAr[c.sid])){c.tobj.changeRowId(c.nid,c.sid);c.nid=c.sid;}}}
dhtmlXGridObject.prototype.gridToGrid=function(rowId,sgrid,tgrid){var z=new Array();for(var i=0;i<sgrid.hdr.rows[0].cells.length;i++)
z[i]=sgrid.cells(rowId,i).getValue();return z;}
dhtmlXGridObject.prototype.checkParentLine=function(node,id){if((!this._h2)||(!id)||(!node))return false;if(node.id==id)return true;else return this.checkParentLine(node.parent,id);}
dhtmlXGridObject.prototype._dragIn=function(htmlObject,shtmlObject,x,y){if(!this.dADTempOff)return 0;var tree=this.isTreeGrid();var obj=shtmlObject.parentNode.idd?shtmlObject.parentNode:shtmlObject.parentObject;if(this._drag_validate){if(htmlObject.parentNode==shtmlObject.parentNode)
return 0;if((tree)&&(this==obj.grid)&&((this.checkParentLine(this._h2.get[htmlObject.parentNode.idd],shtmlObject.parentNode.idd))))
return 0;}
if(!this.callEvent("onDragIn",[obj.idd||obj.id,htmlObject.parentNode.idd,obj.grid||obj.treeNod,(htmlObject.grid||htmlObject.parentNode.grid)]))
return this._setMove(htmlObject,x,y,true);this._setMove(htmlObject,x,y);if((tree)&&(htmlObject.parentNode.expand!="")){var self=this;this._autoOpenTimer=window.setTimeout(function(){self._autoOpenItem(null,self);self=null;},1000);this._autoOpenId=htmlObject.parentNode.idd;}
else
if(this._autoOpenTimer)window.clearTimeout(this._autoOpenTimer);return htmlObject;}
dhtmlXGridObject.prototype._autoOpenItem=function(e,gridObject){gridObject.openItem(gridObject._autoOpenId);}
dhtmlXGridObject.prototype._dragOut=function(htmlObject){this._clearMove();var obj=htmlObject.parentNode.parentObject?htmlObject.parentObject.id:htmlObject.parentNode.idd;this.callEvent("onDragOut",[obj]);if(this._autoOpenTimer)window.clearTimeout(this._autoOpenTimer);}
dhtmlXGridObject.prototype._setMove=function(htmlObject,x,y,skip){if(!htmlObject.parentNode.idd)return;var a1=dhx4.absTop(htmlObject);var a2=dhx4.absTop(this.objBox);if((a1-a2)>(parseInt(this.objBox.offsetHeight)-50))
this.objBox.scrollTop=parseInt(this.objBox.scrollTop)+20;if((a1-a2+parseInt(this.objBox.scrollTop))<(parseInt(this.objBox.scrollTop)+30))
this.objBox.scrollTop=parseInt(this.objBox.scrollTop)-20;if(skip)return 0;if(this.dadmode==2)
{var z=y-a1+(document.body.scrollTop||document.documentElement.scrollTop)-2-htmlObject.offsetHeight/2;if((Math.abs(z)-htmlObject.offsetHeight/6)>0)
{this.dadmodec=1;if(z<0)this.dadmodefix=-1;else this.dadmodefix=1;}
else this.dadmodec=0;}
else
this.dadmodec=this.dadmode;if(this.dadmodec){if(!this._sdrgc)this._createSdrgc();this._sdrgc.style.display="block";this._sdrgc.style.top=a1-a2+parseInt(this.objBox.scrollTop)+((this.dadmodefix>=0)?htmlObject.offsetHeight:0)+"px";}
else{this._llSelD=htmlObject;if(htmlObject.parentNode.tagName=="TR")
for(var i=0;i<htmlObject.parentNode.childNodes.length;i++)
{var z=htmlObject.parentNode.childNodes[i];z._bgCol=z.style.backgroundColor;z.style.backgroundColor="#FFCCCC";}}}
dhtmlXGridObject.prototype._clearMove=function(){if(this._sdrgc)this._sdrgc.style.display="none";if((this._llSelD)&&(this._llSelD.parentNode.tagName=="TR")){var coll=this._llSelD.parentNode.childNodes;for(var i=0;i<coll.length;i++)
coll[i].style.backgroundColor=coll[i]._bgCol;}
this._llSelD=null;}
dhtmlXGridObject.prototype.rowToDragElement=function(gridRowId){var out=this.cells(gridRowId,0).getValue();return out;}
dhtmlXGridObject.prototype._copyUserData=function(c){if(!c.tobj.UserData[c.nid]||c.tobj!=c.sobj)
c.tobj.UserData[c.nid]=new Hashtable();else return;var z1=c.sobj.UserData[c.sid];var z2=c.tobj.UserData[c.nid];if(z1){z2.keys=z2.keys.concat(z1.keys);z2.values=z2.values.concat(z1.values);}}
dhtmlXGridObject.prototype.moveRow=function(rowId,mode,targetId,targetGrid){switch(mode){case"row_sibling":this.moveRowTo(rowId,targetId,"move","sibling",this,targetGrid);break;case"up":this.moveRowUp(rowId);break;case"down":this.moveRowDown(rowId);break;}}
dhtmlXGridObject.prototype._nonTrivialNode=function(tree,targetObject,beforeNode,itemObject,z2)
{if((tree.callEvent)&&(!z2))
if(!tree.callEvent("onDrag",[itemObject.idd,targetObject.id,(beforeNode?beforeNode.id:null),this,tree]))return false;var gridRowId=itemObject.idd;var treeNodeId=gridRowId;while(tree._idpull[treeNodeId])treeNodeId+=(new Date()).getMilliseconds().toString();var img=(this.isTreeGrid()?this.getItemImage(gridRowId):"")
if(beforeNode){for(i=0;i<targetObject.childsCount;i++)
if(targetObject.childNodes[i]==beforeNode)break;if(i!=0)
beforeNode=targetObject.childNodes[i-1];else{st="TOP";beforeNode="";}}
var newone=tree._attachChildNode(targetObject,treeNodeId,this.gridToTreeElement(tree,treeNodeId,gridRowId),"",img,img,img,"","",beforeNode);if(this._h2){var akids=this._h2.get[gridRowId];if(akids.childs.length)
for(var i=0;i<akids.childs.length;i++){this._nonTrivialNode(tree,newone,0,this.rowsAr[akids.childs[i].id],1);if(!this.dpcpy)i--;}}
if(!this.dpcpy)this.deleteRow(gridRowId);if((tree.callEvent)&&(!z2))
tree.callEvent("onDrop",[treeNodeId,targetObject.id,(beforeNode?beforeNode.id:null),this,tree]);}
dhtmlXGridObject.prototype.gridToTreeElement=function(treeObj,treeNodeId,gridRowId){return this.cells(gridRowId,0).getValue();}
dhtmlXGridObject.prototype.treeToGridElement=function(treeObj,treeNodeId,gridRowId){var w=new Array();var z=this.cellType._dhx_find("tree");if(z==-1)z=0;for(var i=0;i<this.getColumnCount();i++)
w[w.length]=(i!=z)?(treeObj.getUserData(treeNodeId,this.getColumnId(i))||""):treeObj.getItemText(treeNodeId);return w;}
dhtmlXGridObject.prototype.moveRowTo=function(srowId,trowId,mode,dropmode,sourceGrid,targetGrid){var c=new dragContext((sourceGrid||this).isTreeGrid()?"treeGrid":"grid",(targetGrid||this).isTreeGrid()?"treeGrid":"grid",mode,dropmode||"sibling",srowId,trowId,sourceGrid||this,targetGrid||this);c.tobj._dragRoutine(c);c.close();return c.nid;}
dhtmlXGridObject.prototype.enableMercyDrag=function(mode){this.dpcpy=dhx4.s2b(mode);};dhtmlXGridObject.prototype.toPDF=function(url,mode,header,footer,rows,target){var save_sel={row:(this.getSelectedRowId()||"").split(this.delim),col:this.getSelectedCellIndex()};if(save_sel.row===null||save_sel.col===-1)
save_sel=false;else{if(save_sel.row){for(var i=0;i<save_sel.row.length;i++){if(save_sel.row[i]){var el=this.cells(save_sel.row[i],save_sel.col).cell;el.parentNode.className=el.parentNode.className.replace(' rowselected','');el.className=el.className.replace(' cellselected','');save_sel.row[i]=el;}}}else
save_sel=false;}
mode=mode||"color";var full_color=mode=="full_color";var grid=this;grid._asCDATA=true;if(typeof(target)==='undefined')
this.target=" target=\"_blank\"";else
this.target=target;eXcell_ch.prototype.getContent=function(){return this.getValue();};eXcell_ra.prototype.getContent=function(){return this.getValue();};function xml_top(profile){var spans=[];for(var i=1;i<grid.hdr.rows.length;i++){spans[i]=[];for(var j=0;j<grid._cCount;j++){var cell=grid.hdr.rows[i].childNodes[j];if(!spans[i][j])
spans[i][j]=[0,0];if(cell)
spans[i][cell._cellIndexS]=[cell.colSpan,cell.rowSpan];}}
var xml="<rows profile='"+profile+"'";if(header)
xml+=" header='"+header+"'";if(footer)
xml+=" footer='"+footer+"'";xml+="><head>"+grid._serialiseExportConfig(spans).replace(/^<head/,"<columns").replace(/head>$/,"columns>");for(var i=2;i<grid.hdr.rows.length;i++){var empty_cols=0;var row=grid.hdr.rows[i];var cxml="";for(var j=0;j<grid._cCount;j++){if((grid._srClmn&&!grid._srClmn[j])||(grid._hrrar[j]&&(!grid._fake||j>=grid._fake.hdrLabels.length))){empty_cols++;continue;}
var s=spans[i][j];var rspan=((s[0]&&s[0]>1)?' colspan="'+s[0]+'" ':"");if(s[1]&&s[1]>1){rspan+=' rowspan="'+s[1]+'" ';empty_cols=-1;}
var val="";var frow=row;if(grid._fake&&j<grid._fake._cCount)
frow=grid._fake.hdr.rows[i];for(var k=0;k<frow.cells.length;k++){if(frow.cells[k]._cellIndexS==j){if(frow.cells[k].getElementsByTagName("SELECT").length)
val="";else
val=_isIE?frow.cells[k].innerText:frow.cells[k].textContent;val=val.replace(/[ \n\r\t\xA0]+/," ");break;}}
if(!val||val==" ")empty_cols++;cxml+="<column"+rspan+"><![CDATA["+val+"]]></column>";};if(empty_cols!=grid._cCount)
xml+="\n<columns>"+cxml+"</columns>";};xml+="</head>\n";xml+=xml_footer();return xml;};function xml_body(){var xml=[];if(rows)
for(var i=0;i<rows.length;i++)
xml.push(xml_row(grid.getRowIndex(rows[i])));else
for(var i=0;i<grid.getRowsNum();i++)
xml.push(xml_row(i));return xml.join("\n");}
function xml_footer(){var xml=["<foot>"];if(!grid.ftr)return"";for(var i=1;i<grid.ftr.rows.length;i++){xml.push("<columns>");var row=grid.ftr.rows[i];for(var j=0;j<grid._cCount;j++){if(grid._srClmn&&!grid._srClmn[j])continue;if(grid._hrrar[j]&&(!grid._fake||j>=grid._fake.hdrLabels.length))continue;for(var k=0;k<row.cells.length;k++){var val="";var span="";if(row.cells[k]._cellIndexS==j){val=_isIE?row.cells[k].innerText:row.cells[k].textContent;val=val.replace(/[ \n\r\t\xA0]+/," ");if(row.cells[k].colSpan&&row.cells[k].colSpan!=1)
span=" colspan='"+row.cells[k].colSpan+"' ";if(row.cells[k].rowSpan&&row.cells[k].rowSpan!=1)
span=" rowspan='"+row.cells[k].rowSpan+"' ";break;}}
xml.push("<column"+span+"><![CDATA["+val+"]]></column>");}
xml.push("</columns>");};xml.push("</foot>");return xml.join("\n");};function get_style(node,style){return(window.getComputedStyle?(window.getComputedStyle(node,null)[style]):(node.currentStyle?node.currentStyle[style]:null))||"";};function xml_row(ind){if(!grid.rowsBuffer[ind])return"";var r=grid.render_row(ind);if(r.style.display=="none")return"";var level=grid.isTreeGrid()?' level="'+grid.getLevel(r.idd)+'"':'';var xml="<row"+level+">";for(var i=0;i<grid._cCount;i++){if(((!grid._srClmn)||(grid._srClmn[i]))&&(!grid._hrrar[i]||(grid._fake&&i<grid._fake.hdrLabels.length))){var cell=grid.cells(r.idd,i);if(full_color){var text_color=get_style(cell.cell,"color");var bg_color=get_style(cell.cell,"backgroundColor");var bold=get_style(cell.cell,"font-weight")||get_style(cell.cell,"fontWeight");var italic=get_style(cell.cell,"font-style")||get_style(cell.cell,"fontStyle");var align=get_style(cell.cell,"text-align")||get_style(cell.cell,"textAlign");var font=get_style(cell.cell,"font-family")||get_style(cell.cell,"fontFamily");if(bg_color=="transparent"||bg_color=="rgba(0, 0, 0, 0)")bg_color="rgb(255,255,255)";xml+="<cell bgColor='"+bg_color+"' textColor='"+text_color+"' bold='"+bold+"' italic='"+italic+"' align='"+align+"' font='"+font+"'>";}else
xml+="<cell>";xml+="<![CDATA["+(cell.getContent?cell.getContent():cell.getTitle())+"]]></cell>";}};return xml+"</row>";}
function xml_end(){var xml="</rows>";return xml;}
var d=document.createElement("div");d.style.display="none";document.body.appendChild(d);var uid="form_"+grid.uid();d.innerHTML='<form id="'+uid+'" method="post" action="'+url+'" accept-charset="utf-8"  enctype="application/x-www-form-urlencoded"'+this.target+'><input type="hidden" name="grid_xml" id="grid_xml"/> </form>';document.getElementById(uid).firstChild.value=encodeURIComponent(xml_top(mode).replace("\u2013","-")+xml_body()+xml_end());document.getElementById(uid).submit();d.parentNode.removeChild(d);grid=null;if(save_sel&&save_sel.row.length){for(var i=0;i<save_sel.row.length;i++){save_sel.row[i].parentNode.className+=' rowselected';if(save_sel.row.length==1)
save_sel.row[i].className+=' cellselected';}};save_sel=null;};dhtmlXGridObject.prototype._serialiseExportConfig=function(spans){function xmlentities(str){if(typeof(str)!=='string')return str;str=str.replace(/&/g,"&amp;");str=str.replace(/"/g,"&quot;");str=str.replace(/'/g,"&apos;");str=str.replace(/</g,"&lt;");str=str.replace(/>/g,"&gt;");return str;}
var out="<head>";for(var i=0;i<this.hdr.rows[0].cells.length;i++){if(this._srClmn&&!this._srClmn[i])continue;if(this._hrrar[i]&&(!this._fake||i>=this._fake.hdrLabels.length))continue;var sort=this.fldSort[i];if(sort=="cus"){sort=this._customSorts[i].toString();sort=sort.replace(/function[\ ]*/,"").replace(/\([^\f]*/,"");}
var s=spans[1][i];var rpans=((s[1]&&s[1]>1)?' rowspan="'+s[1]+'" ':"")+((s[0]&&s[0]>1)?' colspan="'+s[0]+'" ':"");out+="<column "+rpans+" width='"+this.getColWidth(i)+"' align='"+this.cellAlign[i]+"' type='"+this.cellType[i]+"' hidden='"+((this.isColumnHidden&&this.isColumnHidden(i))?'true':'false')
+"' sort='"+(sort||"na")+"' color='"+(this.columnColor[i]||"")+"'"
+(this.columnIds[i]?(" id='"+this.columnIds[i]+"'"):"")+">";if(this._asCDATA)
out+="<![CDATA["+this.getColumnLabel(i)+"]]>";else
out+=this.getColumnLabel(i);var z=this.combos[i]?this.getCombo(i):null;if(z)
for(var j=0;j<z.keys.length;j++)out+="<option value='"+xmlentities(z.keys[j])+"'><![CDATA["+z.values[j]+"]]></option>";out+="</column>";}
return out+="</head>";};if(window.eXcell_sub_row_grid)
window.eXcell_sub_row_grid.prototype.getContent=function(){return"";};dhtmlXGridObject.prototype.toExcel=function(url,mode,header,footer,rows){if(!document.getElementById('ifr')){var ifr=document.createElement('iframe');ifr.style.display='none';ifr.setAttribute('name','dhx_export_iframe');ifr.setAttribute('src','');ifr.setAttribute('id','dhx_export_iframe');document.body.appendChild(ifr);}
var target=" target=\"dhx_export_iframe\"";this.toPDF(url,mode,header,footer,rows,target);}
dhtmlXGridObject.prototype.filterBy=function(column,value,preserve){if(this.isTreeGrid())return this.filterTreeBy(column,value,preserve);if(this._f_rowsBuffer){if(!preserve){this.rowsBuffer=dhtmlxArray([].concat(this._f_rowsBuffer));if(this._fake)this._fake.rowsBuffer=this.rowsBuffer;}}else
this._f_rowsBuffer=[].concat(this.rowsBuffer);if(!this.rowsBuffer.length)return;var d=true;this.dma(true)
if(typeof(column)=="object")
for(var j=0;j<value.length;j++)
this._filterA(column[j],value[j]);else
this._filterA(column,value);this.dma(false)
if(this.pagingOn&&this.rowsBuffer.length/this.rowsBufferOutSize<(this.currentPage-1))this.changePage(0);this._reset_view();this.callEvent("onGridReconstructed",[])}
dhtmlXGridObject.prototype._filterA=function(column,value){if(value=="")return;var d=true;if(typeof(value)=="function")d=false;else value=(value||"").toString().toLowerCase();if(!this.rowsBuffer.length)return;for(var i=this.rowsBuffer.length-1;i>=0;i--)
if(d?(this._get_cell_value(this.rowsBuffer[i],column).toString().toLowerCase().indexOf(value)==-1):(!value.call(this,this._get_cell_value(this.rowsBuffer[i],column),this.rowsBuffer[i].idd)))
this.rowsBuffer.splice(i,1);}
dhtmlXGridObject.prototype.getFilterElement=function(index){if(!this.filters)return;for(var i=0;i<this.filters.length;i++){if(this.filters[i][1]==index)
return(this.filters[i][0].combo||this.filters[i][0]);};return null;}
dhtmlXGridObject.prototype.collectValues=function(column){var evs=this.dhxevs.data.oncollectvalues;if(evs){var value=true;for(var key in evs){var nextvalue=evs[key].call(this,column);if(nextvalue!==true)value=nextvalue||value;}
if(value!==true)
return value;}
if(this.isTreeGrid())return this.collectTreeValues(column);this.dma(true)
this._build_m_order();column=this._m_order?this._m_order[column]:column;var c={};var f=[];var col=this._f_rowsBuffer||this.rowsBuffer;for(var i=0;i<col.length;i++){var val=this._get_cell_value(col[i],column);if(val&&(!col[i]._childIndexes||col[i]._childIndexes[column]!=col[i]._childIndexes[column-1]))c[val]=true;}
this.dma(false);var vals=(this.combos[column]||(this._col_combos?this._col_combos[column]:((this._sub_trees&&this._sub_trees[column])?this._sub_trees[column][0]:false)));for(var d in c)
if(c[d]===true){if(vals){if(vals.get&&vals.get(d)){d=vals.get(d);}
else if(vals.getOption&&vals.getOption(d)){d=vals.getOption(d).text;}
else if(vals.getItemText){var text=vals.getItemText(d);var t=this._sub_trees[column][1]=this._sub_trees[column][1]||{};t[text]=d;d=text;}}
f.push(d);}
return f.sort();}
dhtmlXGridObject.prototype._build_m_order=function(){if(this._c_order){this._m_order=[]
for(var i=0;i<this._c_order.length;i++){this._m_order[this._c_order[i]]=i;};}}
dhtmlXGridObject.prototype.filterByAll=function(){var a=[];var b=[];this._build_m_order();for(var i=0;i<this.filters.length;i++){var ind=this._m_order?this._m_order[this.filters[i][1]]:this.filters[i][1];if(ind>=this._cCount)continue;b.push(ind);var val=this.filters[i][0].old_value=this.filters[i][0].value;if(this.filters[i][0]._filter)
val=this.filters[i][0]._filter();var vals;if(typeof val!="function"&&(vals=(this.combos[ind]||(this._col_combos?this._col_combos[ind]:((this._sub_trees&&this._sub_trees[ind])?this._sub_trees[ind][1]:false))))){if(vals.values){ind=vals.values._dhx_find(val);val=(ind==-1)?val:vals.keys[ind];}
else if(vals.getOptionByLabel){val=(vals.getOptionByLabel(val)?vals.getOptionByLabel(val).value:val);}else
val=vals[val];}
a.push(val);}
if(!this.callEvent("onFilterStart",[b,a]))return;this.filterBy(b,a);if(this._cssEven)this._fixAlterCss();this.callEvent("onFilterEnd",[this.filters]);if(this._f_rowsBuffer&&this.rowsBuffer.length==this._f_rowsBuffer.length)
this._f_rowsBuffer=null;}
dhtmlXGridObject.prototype.makeFilter=function(id,column,preserve){if(!this.filters)this.filters=[];if(typeof(id)!="object")
id=document.getElementById(id);if(!id)return;var self=this;if(!id.style.width)id.style.width="90%";if(id.tagName=='SELECT'){this.filters.push([id,column]);this._loadSelectOptins(id,column);id.onchange=function(){self.filterByAll();}
if(_isIE)
id.style.marginTop="1px";this.attachEvent("onEditCell",function(stage,a,ind){this._build_m_order();if(stage==2&&this.filters&&(this._m_order?(ind==this._m_order[column]):(ind==column)))
this._loadSelectOptins(id,column);return true;});}
else if(id.tagName=='INPUT'){this.filters.push([id,column]);id.old_value=id.value='';id.onkeydown=function(){if(this._timer)window.clearTimeout(this._timer);this._timer=window.setTimeout(function(){if(id.value!=id.old_value){self.filterByAll();id.old_value=id.value;}},500);};}
else if(id.tagName=='DIV'){this.filters.push([id,column]);id.style.padding="0px";id.style.margin="0px";if(!window.dhx_globalImgPath)window.dhx_globalImgPath=this.imgURL;var z=new dhtmlXCombo(id,"_filter","90%");z.filterSelfA=z.filterSelf;z.filterSelf=function(){if(this.getSelectedIndex()==0)this.setComboText("");this.filterSelfA.apply(this,arguments);this.optionsArr[0].hide(false);}
z.enableFilteringMode(true);id.combo=z;id.value="";this._loadComboOptins(id,column);z.attachEvent("onChange",function(){id.value=z.getSelectedValue();if(id.value===null)id.value="";self.filterByAll();});}
if(id.parentNode)
id.parentNode.className+=" filter";this._filters_ready();}
dhtmlXGridObject.prototype.findCell=function(value,c_ind,count,compare){var compare=compare||(function(master,check){return check.toString().toLowerCase().indexOf(master)!=-1;});if(compare===true)
compare=function(master,check){return check.toString().toLowerCase()==master;};var res=new Array();value=value.toString().toLowerCase();if(typeof count!="number")count=count?1:0;if(!this.rowsBuffer.length)
return res;for(var i=(c_ind||0);i<this._cCount;i++){if(this._h2)
this._h2.forEachChild(0,function(el){if(count&&res.length==count)return res;if(compare(value,this._get_cell_value(el.buff,i))){res.push([el.id,i]);}},this)
else
for(var j=0;j<this.rowsBuffer.length;j++)
if(compare(value,this._get_cell_value(this.rowsBuffer[j],i))){res.push([this.rowsBuffer[j].idd,i]);if(count&&res.length==count)return res;}
if(typeof(c_ind)!="undefined")
return res;}
return res;}
dhtmlXGridObject.prototype.makeSearch=function(id,column,strict){if(typeof(id)!="object")
id=document.getElementById(id);if(!id)return;var self=this;if(id.tagName=='INPUT'){id.onkeypress=function(){if(this._timer)window.clearTimeout(this._timer);this._timer=window.setTimeout(function(){if(id.value=="")return;var z=self.findCell(id.value,column,true,strict);if(z.length){if(self._h2)
self.openItem(z[0][0]);self.selectCell(self.getRowIndex(z[0][0]),(column||0))}},500);};}
if(id.parentNode)
id.parentNode.className+=" filter";}
dhtmlXGridObject.prototype._loadSelectOptins=function(t,c){var l=this.collectValues(c);var v=t.value;t.innerHTML="";t.options[0]=new Option("","");var f=this._filter_tr?this._filter_tr[c]:null;for(var i=0;i<l.length;i++)
t.options[t.options.length]=new Option(f?f(l[i]):l[i],l[i]);t.value=v;}
dhtmlXGridObject.prototype.setSelectFilterLabel=function(ind,fun){if(!this._filter_tr)this._filter_tr=[];this._filter_tr[ind]=fun;}
dhtmlXGridObject.prototype._loadComboOptins=function(t,c){if(!t.combo)return;var l=this.collectValues(c);t.combo.clearAll();var opts=[["",""]];for(var i=0;i<l.length;i++)opts.push([l[i],l[i]]);t.combo.addOption(opts);}
dhtmlXGridObject.prototype.refreshFilters=function(){if(!this.filters)return;for(var i=0;i<this.filters.length;i++){switch(this.filters[i][0].tagName.toLowerCase()){case"input":break;case"select":this._loadSelectOptins.apply(this,this.filters[i]);break;case"div":this._loadComboOptins.apply(this,this.filters[i]);break;}}}
dhtmlXGridObject.prototype._filters_ready=function(fl,code){this.attachEvent("onXLE",this.refreshFilters);this.attachEvent("onRowCreated",function(id,r){if(this._f_rowsBuffer)
for(var i=0;i<this._f_rowsBuffer.length;i++)
if(this._f_rowsBuffer[i].idd==id)
return this._f_rowsBuffer[i]=r;})
this.attachEvent("onClearAll",function(){this._f_rowsBuffer=null;if(!this.hdr.rows.length)
this.filters=[];});this.attachEvent("onSetSizes",this._filters_resize_combo);this.attachEvent("onResize",this._filters_resize_combo);this._filters_ready=function(){};}
dhtmlXGridObject.prototype._filters_resize_combo=function(){if(!this.filters)return;for(var q=0;q<this.filters.length;q++){if(this.filters[q][0].combo!=null){this.filters[q][0].combo.setSize(Math.round(this.filters[q][0].offsetWidth*90/100));}}
return true;}
dhtmlXGridObject.prototype._in_header_text_filter=function(t,i){t.innerHTML="<input type='text'>";t.onclick=t.onmousedown=function(e){(e||event).cancelBubble=true;return true;}
t.onselectstart=function(){return(event.cancelBubble=true);}
this.makeFilter(t.firstChild,i);}
dhtmlXGridObject.prototype._in_header_text_filter_inc=function(t,i){t.innerHTML="<input type='text'>";t.onclick=t.onmousedown=function(e){(e||event).cancelBubble=true;return true;}
t.onselectstart=function(){return(event.cancelBubble=true);}
this.makeFilter(t.firstChild,i);t.firstChild._filter=function(){if(t.firstChild.value=="")return"";return function(val){return(val.toString().toLowerCase().indexOf(t.firstChild.value.toLowerCase())==0);}}
this._filters_ready();}
dhtmlXGridObject.prototype._in_header_select_filter=function(t,i){t.innerHTML="<select></select>";t.onclick=function(e){(e||event).cancelBubble=true;return false;}
this.makeFilter(t.firstChild,i);}
dhtmlXGridObject.prototype._in_header_select_filter_strict=function(t,i){t.innerHTML="<select style='width:90%; font-size:8pt; font-family:Tahoma;'></select>";t.onclick=function(e){(e||event).cancelBubble=true;return false;}
this.makeFilter(t.firstChild,i);var combos=this.combos;t.firstChild._filter=function(){var value=t.firstChild.value;if(!value)return"";if(combos[i])
value=combos[i].keys[combos[i].values._dhx_find(value)];value=value.toLowerCase();return function(val){return(val.toString().toLowerCase()==value);};};this._filters_ready();}
dhtmlXGridObject.prototype._in_header_combo_filter=function(t,i){t.innerHTML="<div style='width:100%; padding-left:2px; overflow:hidden; ' class='combo'></div>";t.onselectstart=function(){return(event.cancelBubble=true);}
t.onclick=t.onmousedown=function(e){(e||event).cancelBubble=true;return true;}
this.makeFilter(t.firstChild,i);}
dhtmlXGridObject.prototype._search_common=function(t,i){t.innerHTML="<input type='text' style='width:90%; '>";t.onclick=t.onmousedown=function(e){(e||event).cancelBubble=true;return true;}
t.onselectstart=function(){return(event.cancelBubble=true);}}
dhtmlXGridObject.prototype._in_header_text_search=function(t,i,strict){this._search_common(t,i);this.makeSearch(t.firstChild,i);}
dhtmlXGridObject.prototype._in_header_text_search_strict=function(t,i){this._search_common(t,i);this.makeSearch(t.firstChild,i,true);}
dhtmlXGridObject.prototype._in_header_numeric_filter=function(t,i){this._in_header_text_filter.call(this,t,i);t.firstChild._filter=function(){var v=this.value;var r;var op="==";var num=parseFloat(v.replace("=",""));var num2=null;if(v){if(v.indexOf("..")!=-1){v=v.split("..");num=parseFloat(v[0]);num2=parseFloat(v[1]);return function(v){if(v>=num&&v<=num2)return true;return false;}}
r=v.match(/>=|<=|>|</)
if(r){op=r[0];num=parseFloat(v.replace(op,""));}
return Function("v"," if (v "+op+" "+num+" ) return true; return false;");}
return"";};}
dhtmlXGridObject.prototype._in_header_master_checkbox=function(t,i,c){t.innerHTML=c[0]+"<input type='checkbox' />"+c[1];var self=this;t.getElementsByTagName("input")[0].onclick=function(e){self._build_m_order();var j=self._m_order?self._m_order[i]:i;var val=this.checked?1:0;self.forEachRowA(function(id){var c=this.cells(id,j);if(c.isCheckbox()&&!c.isDisabled()){c.setValue(val);c.cell.wasChanged=true;}
this.callEvent("onEditCell",[1,id,j,val]);this.callEvent("onCheckbox",[id,j,val]);this.callEvent("onCheck",[id,j,val]);});(e||event).cancelBubble=true;}}
dhtmlXGridObject.prototype._in_header_stat_total=function(t,i,c){var calck=function(){var summ=0;this._build_m_order();var ii=this._m_order?this._m_order[i]:i;for(var j=0;j<this.rowsBuffer.length;j++){var v=parseFloat(this._get_cell_value(this.rowsBuffer[j],ii));summ+=isNaN(v)?0:v;}
return this._maskArr[ii]?this._aplNF(summ,ii):(Math.round(summ*100)/100);}
this._stat_in_header(t,calck,i,c,c);}
dhtmlXGridObject.prototype._in_header_stat_multi_total=function(t,i,c){var cols=c[1].split(":");c[1]="";for(var k=0;k<cols.length;k++){cols[k]=parseInt(cols[k]);}
var calck=function(){var summ=0;for(var j=0;j<this.rowsBuffer.length;j++){var v=1;for(var k=0;k<cols.length;k++){v*=parseFloat(this._get_cell_value(this.rowsBuffer[j],cols[k]))}
summ+=isNaN(v)?0:v;}
return this._maskArr[i]?this._aplNF(summ,i):(Math.round(summ*100)/100);}
var track=[];for(var ind=0;ind<cols.length;ind++){track[cols[ind]]=true;}
this._stat_in_header(t,calck,track,c,c);}
dhtmlXGridObject.prototype._in_header_stat_max=function(t,i,c){var calck=function(){this._build_m_order();var ii=this._m_order?this._m_order[i]:i;var summ=-999999999;if(this.getRowsNum()==0)return"&nbsp;";for(var j=0;j<this.rowsBuffer.length;j++)
summ=Math.max(summ,parseFloat(this._get_cell_value(this.rowsBuffer[j],ii)));return this._maskArr[i]?this._aplNF(summ,i):summ;}
this._stat_in_header(t,calck,i,c);}
dhtmlXGridObject.prototype._in_header_stat_min=function(t,i,c){var calck=function(){this._build_m_order();var ii=this._m_order?this._m_order[i]:i;var summ=999999999;if(this.getRowsNum()==0)return"&nbsp;";for(var j=0;j<this.rowsBuffer.length;j++)
summ=Math.min(summ,parseFloat(this._get_cell_value(this.rowsBuffer[j],ii)));return this._maskArr[i]?this._aplNF(summ,i):summ;}
this._stat_in_header(t,calck,i,c);}
dhtmlXGridObject.prototype._in_header_stat_average=function(t,i,c){var calck=function(){this._build_m_order();var ii=this._m_order?this._m_order[i]:i;var summ=0;var count=0;if(this.getRowsNum()==0)return"&nbsp;";for(var j=0;j<this.rowsBuffer.length;j++){var v=parseFloat(this._get_cell_value(this.rowsBuffer[j],ii));if(!isNaN(v)){summ+=v;count++;}}
return this._maskArr[i]?this._aplNF(summ/count,i):(Math.round(summ/count*100)/100);}
this._stat_in_header(t,calck,i,c);}
dhtmlXGridObject.prototype._in_header_stat_count=function(t,i,c){var calck=function(){return this.getRowsNum();}
this._stat_in_header(t,calck,i,c);}
dhtmlXGridObject.prototype._stat_in_header=function(t,calck,i,c){var that=this;var f=function(){this.dma(true)
t.innerHTML=(c[0]?c[0]:"")+calck.call(this)+(c[1]?c[1]:"");this.dma(false)
this.callEvent("onStatReady",[])}
if(!this._stat_events){this._stat_events=[];this.attachEvent("onClearAll",function(){if(!this.hdr.rows[1]){for(var i=0;i<this._stat_events.length;i++)
for(var j=0;j<4;j++)
this.detachEvent(this._stat_events[i][j]);this._stat_events=[];}})}
this._stat_events.push([this.attachEvent("onGridReconstructed",f),this.attachEvent("onXLE",f),this.attachEvent("onFilterEnd",f),this.attachEvent("onEditCell",function(stage,id,ind){if(stage==2&&(ind==i||(i&&i[ind])))f.call(this);return true;})]);t.innerHTML="";}
dhtmlXGridObject.prototype.loadCSVFile=function(path,afterCall){this.load(path,afterCall,"csv")}
dhtmlXGridObject.prototype.enableCSVAutoID=function(mode){this._csvAID=dhx4.s2b(mode);}
dhtmlXGridObject.prototype.enableCSVHeader=function(mode){this._csvHdr=dhx4.s2b(mode);}
dhtmlXGridObject.prototype.setCSVDelimiter=function(str){this.csv.cell=str;}
dhtmlXGridObject.prototype._csvAID=true;dhtmlXGridObject.prototype.loadCSVString=function(str){this.parse(str,"csv")}
dhtmlXGridObject.prototype.serializeToCSV=function(textmode){this.editStop()
if(this._mathSerialization)
this._agetm="getMathValue";else if(this._strictText||textmode)
this._agetm="getTitle";else this._agetm="getValue";var out=[];if(this._csvHdr){for(var j=1;j<this.hdr.rows.length;j++){var a=[];for(var i=0;i<this._cCount;i++)
if((!this._srClmn)||(this._srClmn[i]))
a.push(this.getColumnLabel(i,j-1));out.push(this.csvParser.str(a,this.csv.cell,this.csv.row));}}
var i=0;var leni=this.rowsBuffer.length;for(i;i<leni;i++){var temp=this._serializeRowToCVS(null,i)
if(temp!="")out.push(temp);}
return this.csvParser.block(out,this.csv.row);}
dhtmlXGridObject.prototype._serializeRowToCVS=function(r,i,start,end){var out=new Array();if(!r){r=this.render_row(i)
if(this._fake&&!this._fake.rowsAr[r.idd])this._fake.render_row(i);}
if(!this._csvAID)
out[out.length]=r.idd;start=start||0;end=end||this._cCount;var changeFl=false;var ind=start;while(r.childNodes[start]._cellIndex>ind&&start)start--;for(var jj=start;ind<end;jj++){if(!r.childNodes[jj])break;var real_ind=r.childNodes[jj]._cellIndex;if(((!this._srClmn)||(this._srClmn[real_ind]))&&(!this._serialize_visible||!this._hrrar[real_ind])){var cvx=r.childNodes[jj];var zx=this.cells(r.idd,real_ind);while(ind!=real_ind){ind++;out.push("")
if(ind>=end)break;}
if(ind>=end)break;ind++;if(zx.cell)
zxVal=zx[this._agetm]();else zxVal="";if((this._chAttr)&&(zx.wasChanged()))
changeFl=true;out[out.length]=((zxVal===null)?"":zxVal)
if(this._ecspn&&cvx.colSpan&&cvx.colSpan>1){cvx=cvx.colSpan-1;for(var u=0;u<cvx;u++){out[out.length]="";ind++;}}}else ind++;}
if((this._onlChAttr)&&(!changeFl))return"";return this.csvParser.str(out,this.csv.cell,this.csv.row);}
dhtmlXGridObject.prototype.toClipBoard=function(val){if(window.clipboardData)
window.clipboardData.setData("Text",val);else
(new Clipboard()).copy(val);}
dhtmlXGridObject.prototype.fromClipBoard=function(){if(window.clipboardData)
return window.clipboardData.getData("Text");else
return(new Clipboard()).paste();}
dhtmlXGridObject.prototype.cellToClipboard=function(rowId,cellInd){if((!rowId)||(!cellInd&&cellInd!==0)){if(!this.selectedRows[0])return;rowId=this.selectedRows[0].idd;cellInd=this.cell._cellIndex;}
var ed=this.cells(rowId,cellInd);this.toClipBoard(((ed.getLabel?ed.getLabel():ed.getValue())||"").toString());}
dhtmlXGridObject.prototype.updateCellFromClipboard=function(rowId,cellInd){if((!rowId)||(!cellInd)){if(!this.selectedRows[0])return;rowId=this.selectedRows[0].idd;cellInd=this.cell._cellIndex;}
var ed=this.cells(rowId,cellInd);ed[ed.setImage?"setLabel":"setValue"](this.fromClipBoard());}
dhtmlXGridObject.prototype.rowToClipboard=function(rowId){var out="";if(this._mathSerialization)
this._agetm="getMathValue";else if(this._strictText)
this._agetm="getTitle";else
this._agetm="getValue";this._serialize_visible=!this._fake;if(rowId)
out=this._serializeRowToCVS(this.getRowById(rowId));else{var data=[];for(var i=0;i<this.selectedRows.length;i++){data[data.length]=this._serializeRowToCVS(this.selectedRows[i]);out=this.csvParser.block(data,this.csv.row);}}
this._serialize_visible=false;this.toClipBoard(out);}
dhtmlXGridObject.prototype.updateRowFromClipboard=function(rowId){var csv=this.fromClipBoard();if(!csv)return;if(rowId)
var r=this.getRowById(rowId);else
var r=this.selectedRows[0];if(!r)return;var parser=this.csvParser;csv=parser.unblock(csv,this.csv.cell,this.csv.row)[0];if(!this._csvAID)csv.splice(0,1);for(var i=0;i<csv.length;i++){var ed=this.cells3(r,i);ed[ed.setImage?"setLabel":"setValue"](csv[i]);}}
dhtmlXGridObject.prototype.csvParser={block:function(data,row){return data.join(row);},unblock:function(str,cell,row){var data=(str||"").split(row);for(var i=0;i<data.length;i++)
data[i]=(data[i]||"").split(cell);var last=data.length-1;if(data[last].length==1&&data[last][0]=="")
data.splice(last,1);return data;},str:function(data,cell,row){return data.join(cell);}};dhtmlXGridObject.prototype.csvExtParser={_quote:RegExp('"',"g"),_quote_esc:RegExp("\"\"","g"),block:function(data,row){return data.join(row);},unblock:function(str,cell,row){var out=[[]];var ind=0;if(!str)return out;var quote_start=/^[ ]*"/;var quote_end=/"[ ]*$/;var row_exp=new RegExp(".*"+row+".*$");var data=str.split(cell);for(var i=0;i<data.length;i++){if(data[i].match(quote_start)){var buff=data[i].replace(quote_start,"");while(!data[i].match(quote_end)){i++;buff+=data[i];}
out[ind].push(buff.replace(quote_end,"").replace(this._quote_esc,'"'));}else if(data[i].match(row_exp)){var row_pos=data[i].indexOf(row);out[ind].push(data[i].substr(0,row_pos));ind++;out[ind]=[];data[i]=data[i].substr(row_pos+1);i--;}else{if(data[i]||i!=data.length-1)
out[ind].push(data[i]);}}
var last=out.length-1;if(last>0&&!out[last].length)
out.splice(last,1);return out;},str:function(data,cell,row){for(var i=0;i<data.length;i++)
data[i]='"'+data[i].replace(this._quote,"\"\"")+'"';return data.join(cell);}};dhtmlXGridObject.prototype.addRowFromClipboard=function(){var csv=this.fromClipBoard();if(!csv)return;var z=this.csvParser.unblock(csv,this.csv.cell,this.csv.row);for(var i=0;i<z.length;i++)
if(z[i]){csv=z[i];if(!csv.length)continue;if(this._csvAID)
this.addRow(this.getRowsNum()+2,csv);else{if(this.rowsAr[csv[0]])
csv[0]=this.uid();this.addRow(csv[0],csv.slice(1));}}}
dhtmlXGridObject.prototype.gridToClipboard=function(){this.toClipBoard(this.serializeToCSV());}
dhtmlXGridObject.prototype.gridFromClipboard=function(){var csv=this.fromClipBoard();if(!csv)return;this.loadCSVString(csv);}
dhtmlXGridObject.prototype.getXLS=function(path){if(!this.xslform){this.xslform=document.createElement("FORM");this.xslform.action=(path||"")+"xls.php";this.xslform.method="post";this.xslform.target=(_isIE?"_blank":"");document.body.appendChild(this.xslform);var i1=document.createElement("INPUT");i1.type="hidden";i1.name="csv";this.xslform.appendChild(i1);var i2=document.createElement("INPUT");i2.type="hidden";i2.name="csv_header";this.xslform.appendChild(i2);}
var cvs=this.serializeToCSV();this.xslform.childNodes[0].value=cvs;var cvs_header=[];var l=this._cCount;for(var i=0;i<l;i++){cvs_header.push(this.getHeaderCol(i));}
cvs_header=cvs_header.join(',');this.xslform.childNodes[1].value=cvs_header;this.xslform.submit();}
dhtmlXGridObject.prototype.printView=function(before,after){var html="<style>TD { font-family:Arial; text-align:center; padding-left:2px;padding-right:2px; } \n td.filter input, td.filter select { display:none; }	\n  </style>";var st_hr=null;if(this._fake){st_hr=[].concat(this._hrrar);for(var i=0;i<this._fake._cCount;i++)
this._hrrar[i]=null;}
var port=document.location.port;var hostname=document.location.hostname;html+="<base  href='"+(document.location.protocol+"//"+hostname+(port?(":"+port):"")+document.location.pathname)+"'></base>";if(!this.parentGrid)html+=(before||"");html+='<table width="100%" border="2px" cellpadding="0" cellspacing="0">';var row_length=Math.max(this.rowsBuffer.length,this.rowsCol.length);var col_length=this._cCount;var width=this._printWidth();html+='<tr class="header_row_1">';for(var i=0;i<col_length;i++){if(this._hrrar&&this._hrrar[i])continue;var hcell=this.hdr.rows[1].cells[this.hdr.rows[1]._childIndexes?this.hdr.rows[1]._childIndexes[parseInt(i)]:i];var colspan=(hcell.colSpan||1);var rowspan=(hcell.rowSpan||1);for(var j=1;j<colspan;j++)
width[i]+=width[j];html+='<td rowspan="'+rowspan+'" width="'+width[i]+'%" style="background-color:lightgrey;" colspan="'+colspan+'">'+this.getHeaderCol(i)+'</td>';i+=colspan-1;}
html+='</tr>';for(var i=2;i<this.hdr.rows.length;i++){if(_isIE){html+="<tr style='background-color:lightgrey' class='header_row_"+i+"'>";var cells=this.hdr.rows[i].childNodes;for(var j=0;j<cells.length;j++)
if(!this._hrrar||!this._hrrar[cells[j]._cellIndex]){html+=cells[j].outerHTML;}
html+="</tr>";}
else
html+="<tr class='header_row_"+i+"' style='background-color:lightgrey'>"+(this._fake?this._fake.hdr.rows[i].innerHTML:"")+this.hdr.rows[i].innerHTML+"</tr>";}
for(var i=0;i<row_length;i++){html+='<tr>';if(this.rowsCol[i]&&this.rowsCol[i]._cntr){html+=this.rowsCol[i].innerHTML.replace(/<img[^>]*>/gi,"")+'</tr>';continue;}
if(this.rowsCol[i]&&this.rowsCol[i].style.display=="none")continue;var row_id
if(this.rowsCol[i])
row_id=this.rowsCol[i].idd;else if(this.rowsBuffer[i])
row_id=this.rowsBuffer[i].idd;else continue;for(var j=0;j<col_length;j++){if(this._hrrar&&this._hrrar[j])continue;if(this.rowsAr[row_id]&&this.rowsAr[row_id].tagName=="TR"){var c=this.cells(row_id,j);if(c._setState)var value="";else if(c.getContent)value=c.getContent();else if(c.getImage||c.combo)var value=c.cell.innerHTML;else var value=c.getValue();}else
var value=this._get_cell_value(this.rowsBuffer[i],j);var color=this.columnColor[j]?'background-color:'+this.columnColor[j]+';':'';var align=this.cellAlign[j]?'text-align:'+this.cellAlign[j]+';':'';var cspan=c.getAttribute("colspan");html+='<td style="'+color+align+'" '+(cspan?'colSpan="'+cspan+'"':'')+'>'+(value===""?"&nbsp;":value)+'</td>';if(cspan)j+=cspan-1;}
html+='</tr>';if(this.rowsCol[i]&&this.rowsCol[i]._expanded){var sub=this.cells4(this.rowsCol[i]._expanded.ctrl);if(sub.getSubGrid)
html+='<tr><td colspan="'+col_length+'">'+sub.getSubGrid().printView()+'</td></tr>';else
html+='<tr><td colspan="'+col_length+'">'+this.rowsCol[i]._expanded.innerHTML+'</td></tr>';}}
if(this.ftr)
for(var i=1;i<this.ftr.childNodes[0].rows.length;i++)
html+="<tr style='background-color:lightgrey'>"+((this._fake)?this._fake.ftr.childNodes[0].rows[i].innerHTML:"")+this.ftr.childNodes[0].rows[i].innerHTML+"</tr>";html+='</table>';if(this.parentGrid)return html;html+=(after||"");var d=window.open('','_blank');d.document.write(html);d.document.write("<script>window.onerror=function(){return true;}</script>");d.document.close();if(this._fake){this._hrrar=st_hr;}}
dhtmlXGridObject.prototype._printWidth=function(){var width=[];var total_width=0;for(var i=0;i<this._cCount;i++){var w=this.getColWidth(i);width.push(w);total_width+=w;}
var percent_width=[];var total_percent_width=0;for(var i=0;i<width.length;i++){var p=Math.floor((width[i]/total_width)*100);total_percent_width+=p;percent_width.push(p);}
percent_width[percent_width.length-1]+=100-total_percent_width;return percent_width;}
dhtmlXGridObject.prototype.enableBlockSelection=function(mode)
{if(typeof this._bs_mode=="undefined"){var self=this;this.obj.onmousedown=function(e){if(self._bs_mode)self._OnSelectionStart((e||event),this);return true;}
this._CSVRowDelimiter=this.csv.row;this.attachEvent("onResize",function(){self._HideSelection();return true;});this.attachEvent("onGridReconstructed",function(){self._HideSelection();return true;});this.attachEvent("onFilterEnd",this._HideSelection);}
if(mode===false){this._bs_mode=false;return this._HideSelection();}else this._bs_mode=true;if(!window.dhx4.isIPad){var area=this._clip_area=document.createElement("textarea");area.style.cssText="position:absolute; width:1px; height:1px; overflow:hidden; color:transparent; background-color:transparent; bottom:1px; right:1px; border:none;";area.onkeydown=function(e){e=e||event;if(e.keyCode==86&&(e.ctrlKey||e.metaKey))
self.pasteBlockFromClipboard()};document.body.insertBefore(this._clip_area,document.body.firstChild);dhtmlxEvent(this.entBox,"click",function(){if(!self.editor&&self._clip_area)
self._clip_area.select();});}}
dhtmlXGridObject.prototype.forceLabelSelection=function(mode)
{this._strictText=dhx4.s2b(mode)}
dhtmlXGridObject.prototype.selectBlock=function(sx,sy,ex,ey)
{sy=this.getRowIndex(sy);ey=this.getRowIndex(ey);myGrid._CreateSelection(sy,sx);myGrid._selectionArea=myGrid._RedrawSelectionPos(myGrid.cells2(sy,sx).cell,myGrid.cells2(ey,ex).cell);myGrid._ShowSelection();}
dhtmlXGridObject.prototype._OnSelectionStart=function(event,obj)
{var self=this;if(event.button==2)return;var src=event.srcElement||event.target;if(this.editor){if(src.tagName&&(src.tagName=="INPUT"||src.tagName=="TEXTAREA"))return;this.editStop();}
self.setActive(true);var pos=this.getPosition(this.obj);var x=event.clientX-pos[0]+(document.body.scrollLeft||(document.documentElement?document.documentElement.scrollLeft:0));var y=event.clientY-pos[1]+(document.body.scrollTop||(document.documentElement?document.documentElement.scrollTop:0));this._CreateSelection(x-4,y-4);if(src==this._selectionObj){this._HideSelection();this._startSelectionCell=null;}else{while(src&&(!src.tagName||src.tagName.toLowerCase()!='td'))
src=src.parentNode;this._startSelectionCell=src;}
if(this._startSelectionCell){if(!this.callEvent("onBeforeBlockSelected",[this._startSelectionCell.parentNode.idd,this._startSelectionCell._cellIndex]))
return this._startSelectionCell=null;}
this.obj.onmousedown=null;this.obj[_isIE?"onmouseleave":"onmouseout"]=function(e){if(self._blsTimer)window.clearTimeout(self._blsTimer);};this.obj.onmmold=this.obj.onmousemove;this._init_pos=[x,y];this._selectionObj.onmousemove=this.obj.onmousemove=function(e){e=e||event;if(e.preventDefault)e.preventDefault();else e.returnValue=false;self._OnSelectionMove(e);}
this._oldDMP=document.body.onmouseup;document.body.onmouseup=function(e){e=e||event;self._OnSelectionStop(e,this);return true;}
this.callEvent("onBeforeBlockSelection",[]);document.body.onselectstart=function(){return false};}
dhtmlXGridObject.prototype._getCellByPos=function(x,y){x=x;if(this._fake)
x+=this._fake.objBox.scrollWidth;y=y;var _x=0;for(var i=0;i<this.obj.rows.length;i++){y-=this.obj.rows[i].offsetHeight;if(y<=0){_x=this.obj.rows[i];break;}}
if(!_x||!_x.idd)return null;for(var i=0;i<this._cCount;i++){x-=this.getColWidth(i);if(x<=0){while(true){if(_x._childIndexes&&_x._childIndexes[i+1]==_x._childIndexes[i])
_x=_x.previousSibling;else{return this.cells(_x.idd,i).cell;}}}}
return null;}
dhtmlXGridObject.prototype._OnSelectionMove=function(event)
{var self=this;this._ShowSelection();var pos=this.getPosition(this.obj);var X=event.clientX-pos[0]+(document.body.scrollLeft||(document.documentElement?document.documentElement.scrollLeft:0));var Y=event.clientY-pos[1]+(document.body.scrollTop||(document.documentElement?document.documentElement.scrollTop:0));if((Math.abs(this._init_pos[0]-X)<5)&&(Math.abs(this._init_pos[1]-Y)<5))return this._HideSelection();var temp=this._endSelectionCell;if(this._startSelectionCell==null)
this._endSelectionCell=this._startSelectionCell=this.getFirstParentOfType(event.srcElement||event.target,"TD");else
if(event.srcElement||event.target){if((event.srcElement||event.target).className=="dhtmlxGrid_selection")
this._endSelectionCell=(this._getCellByPos(X,Y)||this._endSelectionCell);else{var t=this.getFirstParentOfType(event.srcElement||event.target,"TD");if(t.parentNode.idd)this._endSelectionCell=t;}}
if(this._endSelectionCell){if(!this.callEvent("onBeforeBlockSelected",[this._endSelectionCell.parentNode.idd,this._endSelectionCell._cellIndex]))
this._endSelectionCell=temp;}
var BottomRightX=this.objBox.scrollLeft+this.objBox.clientWidth;var BottomRightY=this.objBox.scrollTop+this.objBox.clientHeight;var TopLeftX=this.objBox.scrollLeft;var TopLeftY=this.objBox.scrollTop;var nextCall=false;if(this._blsTimer)window.clearTimeout(this._blsTimer);if(X+20>=BottomRightX){this.objBox.scrollLeft=this.objBox.scrollLeft+20;nextCall=true;}else if(X-20<TopLeftX){this.objBox.scrollLeft=this.objBox.scrollLeft-20;nextCall=true;}
if(Y+20>=BottomRightY&&!this._realfake){this.objBox.scrollTop=this.objBox.scrollTop+20;nextCall=true;}else if(Y-20<TopLeftY&&!this._realfake){this.objBox.scrollTop=this.objBox.scrollTop-20;nextCall=true;}
this._selectionArea=this._RedrawSelectionPos(this._startSelectionCell,this._endSelectionCell);if(nextCall){var a=event.clientX;var b=event.clientY;this._blsTimer=window.setTimeout(function(){self._OnSelectionMove({clientX:a,clientY:b})},100);}}
dhtmlXGridObject.prototype._OnSelectionStop=function(event)
{var self=this;if(this._blsTimer)window.clearTimeout(this._blsTimer);this.obj.onmousedown=function(e){if(self._bs_mode)self._OnSelectionStart((e||event),this);return true;}
this.obj.onmousemove=this.obj.onmmold||null;this._selectionObj.onmousemove=null;document.body.onmouseup=this._oldDMP||null;if(parseInt(this._selectionObj.style.width)<2&&parseInt(this._selectionObj.style.height)<2){this._HideSelection();}else{var src=this.getFirstParentOfType(event.srcElement||event.target,"TD");if((!src)||(!src.parentNode.idd)){src=this._endSelectionCell;}
while(src&&(!src.tagName||src.tagName.toLowerCase()!='td'))
src=src.parentNode;if(!src)
return this._HideSelection();this._stopSelectionCell=src;this._selectionArea=this._RedrawSelectionPos(this._startSelectionCell,this._stopSelectionCell);this.callEvent("onBlockSelected",[]);}
document.body.onselectstart=function(){};}
dhtmlXGridObject.prototype._RedrawSelectionPos=function(LeftTop,RightBottom)
{if(LeftTop.parentNode.grid!=RightBottom.parentNode.grid)
return this._selectionArea;var pos={};pos.LeftTopCol=LeftTop._cellIndex;pos.LeftTopRow=this.getRowIndex(LeftTop.parentNode.idd);pos.RightBottomCol=RightBottom._cellIndex;pos.RightBottomRow=this.getRowIndex(RightBottom.parentNode.idd);var LeftTop_width=LeftTop.offsetWidth;var LeftTop_height=LeftTop.offsetHeight;LeftTop=this.getPosition(LeftTop,this.obj);var RightBottom_width=RightBottom.offsetWidth;var RightBottom_height=RightBottom.offsetHeight;RightBottom=this.getPosition(RightBottom,this.obj);if(LeftTop[0]<RightBottom[0]){var Left=LeftTop[0];var Right=RightBottom[0]+RightBottom_width;}else{var foo=pos.RightBottomCol;pos.RightBottomCol=pos.LeftTopCol;pos.LeftTopCol=foo;var Left=RightBottom[0];var Right=LeftTop[0]+LeftTop_width;}
if(LeftTop[1]<RightBottom[1]){var Top=LeftTop[1];var Bottom=RightBottom[1]+RightBottom_height;}else{var foo=pos.RightBottomRow;pos.RightBottomRow=pos.LeftTopRow;pos.LeftTopRow=foo;var Top=RightBottom[1];var Bottom=LeftTop[1]+LeftTop_height;}
var Width=Right-Left;var Height=Bottom-Top;this._selectionObj.style.left=Left+'px';this._selectionObj.style.top=Top+'px';this._selectionObj.style.width=Width+'px';this._selectionObj.style.height=Height+'px';return pos;}
dhtmlXGridObject.prototype._CreateSelection=function(x,y)
{if(this._selectionObj==null){var div=document.createElement('div');div.style.position='absolute';div.style.display='none';div.className='dhtmlxGrid_selection';this._selectionObj=div;this._selectionObj.onmousedown=function(e){e=e||event;if(e.button==2||(_isMacOS&&e.ctrlKey))
return this.parentNode.grid.callEvent("onBlockRightClick",["BLOCK",e]);}
this._selectionObj.oncontextmenu=function(e){(e||event).cancelBubble=true;return false;}
this.objBox.appendChild(this._selectionObj);}
this._selectionObj.style.width='0px';this._selectionObj.style.height='0px';this._selectionObj.style.left=x+'px';this._selectionObj.style.top=y+'px';this._selectionObj.startX=x;this._selectionObj.startY=y;}
dhtmlXGridObject.prototype._ShowSelection=function()
{if(this._selectionObj)
this._selectionObj.style.display='';}
dhtmlXGridObject.prototype._HideSelection=function()
{if(this._selectionObj)
this._selectionObj.style.display='none';this._selectionArea=null;if(this._clip_area){this._clip_area.value="";this._clip_area.blur();}}
dhtmlXGridObject.prototype.copyBlockToClipboard=function()
{if(!this._clip_area)return;if(this._selectionArea!=null){var serialized=new Array();if(this._mathSerialization)
this._agetm="getMathValue";else if(this._strictText)
this._agetm="getTitle";else this._agetm="getValue";this._serialize_visible=true;for(var i=this._selectionArea.LeftTopRow;i<=this._selectionArea.RightBottomRow;i++){var data=this._serializeRowToCVS(this.rowsBuffer[i],null,this._selectionArea.LeftTopCol,this._selectionArea.RightBottomCol+1);if(!this._csvAID)
serialized[serialized.length]=data.substr(data.indexOf(this.csv.cell)+1);else
serialized[serialized.length]=data;}
serialized=serialized.join(this._CSVRowDelimiter);this._clip_area.value=serialized;this._clip_area.select();this._serialize_visible=false;}}
dhtmlXGridObject.prototype.pasteBlockFromClipboard=function(){if(!this._clip_area)return;this._clip_area.select();var self=this;window.setTimeout(function(){self._pasteBlockFromClipboard();self=null;},1);}
dhtmlXGridObject.prototype._pasteBlockFromClipboard=function()
{var serialized=this._clip_area.value;if(!serialized)return;if(this._selectionArea!=null){var startRow=this._selectionArea.LeftTopRow;var startCol=this._selectionArea.LeftTopCol;}else if(this.cell!=null&&!this.editor){var startRow=this.getRowIndex(this.cell.parentNode.idd);var startCol=this.cell._cellIndex;}else{return false;}
serialized=this.csvParser.unblock(serialized,this.csv.cell,this.csv.row);var endRow=startRow+serialized.length;var endCol=startCol+serialized[0].length;if(endCol>this._cCount)
endCol=this._cCount;var k=0;for(var i=startRow;i<endRow;i++){var row=this.render_row(i);if(row==-1)continue;var l=0;for(var j=startCol;j<endCol;j++){if(this._hrrar[j]&&!this._fake){endCol=Math.min(endCol+1,this._cCount);continue;}
var ed=this.cells3(row,j);if(ed.isDisabled()){l++;continue;}
if(this._onEditUndoRedo)
this._onEditUndoRedo(2,row.idd,j,serialized[k][l],ed.getValue());if(ed.combo){var comboVa=ed.combo.values;for(var n=0;n<comboVa.length;n++)
if(serialized[k][l]==comboVa[n]){ed.setValue(ed.combo.keys[n]);comboVa=null;break;}
if(comboVa!=null&&ed.editable)ed.setValue(serialized[k][l++]);else l++;}else
ed[ed.setImage?"setLabel":"setValue"](serialized[k][l++]);ed.cell.wasChanged=true;}
this.callEvent("onRowPaste",[row.idd])
k++;}}
dhtmlXGridObject.prototype.getSelectedBlock=function(){if(this._selectionArea)
return this._selectionArea;else if(this.getSelectedRowId()!==null){return{LeftTopRow:this.getSelectedRowId(),LeftTopCol:this.getSelectedCellIndex(),RightBottomRow:this.getSelectedRowId(),RightBottomCol:this.getSelectedCellIndex()};}else
return null;};dhtmlXGridObject.prototype.enableSmartRendering=function(mode,buffer,reserved){if(arguments.length>2){if(buffer&&!this.rowsBuffer[buffer-1])this.rowsBuffer[buffer-1]=0;buffer=reserved;}
this._srnd=dhx4.s2b(mode);this._srdh=this._srdh||20;this._dpref=buffer||0;};dhtmlXGridObject.prototype.enablePreRendering=function(buffer){this._srnd_pr=parseInt(buffer||50);};dhtmlXGridObject.prototype.forceFullLoading=function(buffer,callback){for(var i=0;i<this.rowsBuffer.length;i++)
if(!this.rowsBuffer[i]){var usedbuffer=buffer||(this.rowsBuffer.length-i);if(this.callEvent("onDynXLS",[i,usedbuffer])){var self=this;this.load(this.xmlFileUrl+dhtmlx.url(this.xmlFileUrl)+"posStart="+i+"&count="+usedbuffer,function(){window.setTimeout(function(){self.forceFullLoading(buffer,callback);},100);},this._data_type);}
return;}
if(callback)callback.call(this);};dhtmlXGridObject.prototype.setAwaitedRowHeight=function(height){this._srdh=parseInt(height);};dhtmlXGridObject.prototype._get_view_size=function(){return Math.floor(parseInt(this.entBox.offsetHeight)/this._srdh)+2;};dhtmlXGridObject.prototype._add_filler=function(pos,len,fil,rsflag){if(!len)return null;var id="__filler__";var row=this._prepareRow(id);row.firstChild.style.width="1px";row.firstChild.style.borderWidth=row.firstChild.style.padding=row.firstChild.style.margin="0px";for(var i=1;i<row.childNodes.length;i++)
row.childNodes[i].style.display='none';row.firstChild.style.height=len*this._srdh+"px";fil=fil||this.rowsCol[pos];if(fil&&fil.nextSibling)
fil.parentNode.insertBefore(row,fil.nextSibling);else
if(_isKHTML)
this.obj.appendChild(row);else
this.obj.rows[0].parentNode.appendChild(row);this.callEvent("onAddFiller",[pos,len,row,fil,rsflag]);return[pos,len,row];};dhtmlXGridObject.prototype._update_srnd_view=function(){var min=Math.floor(this.objBox.scrollTop/this._srdh);var max=min+this._get_view_size();if(this.multiLine){var pxHeight=this.objBox.scrollTop;min=0;while(pxHeight>0){pxHeight-=this.rowsCol[min]?this.rowsCol[min].offsetHeight:this._srdh;min++;}
max=min+this._get_view_size();if(min>0)min--;}
max+=(this._srnd_pr||0);if(max>this.rowsBuffer.length)max=this.rowsBuffer.length;for(var j=min;j<max;j++){if(!this.rowsCol[j]){var res=this._add_from_buffer(j);if(res==-1){if(this.xmlFileUrl){if(this._dpref&&this.rowsBuffer[max-1]){var rows_count=this._dpref?this._dpref:(max-j)
var start_pos=Math.max(0,Math.min(j,max-this._dpref));this._current_load=[start_pos,max-start_pos];}else
this._current_load=[j,(this._dpref?this._dpref:(max-j))];if(this.callEvent("onDynXLS",this._current_load))
this.load(this.xmlFileUrl+dhtmlx.url(this.xmlFileUrl)+"posStart="+this._current_load[0]+"&count="+this._current_load[1],this._data_type);}
return;}else{if(this._tgle){this._updateLine(this._h2.get[this.rowsBuffer[j].idd],this.rowsBuffer[j]);this._updateParentLine(this._h2.get[this.rowsBuffer[j].idd],this.rowsBuffer[j]);}
if(j&&j==(this._realfake?this._fake:this)["_r_select"]){this.selectCell(j,this.cell?this.cell._cellIndex:0,true);}}}}
if(this._fake&&!this._realfake&&this.multiLine)
this._fake.objBox.scrollTop=this.objBox.scrollTop;}
dhtmlXGridObject.prototype._add_from_buffer=function(ind){var row=this.render_row(ind);if(row==-1)return-1;if(row._attrs["selected"]||row._attrs["select"]){this.selectRow(row,false,true);row._attrs["selected"]=row._attrs["select"]=null;}
if(!this._cssSP){if(this._cssEven&&ind%2==0)
row.className=this._cssEven+((row.className.indexOf("rowselected")!=-1)?" rowselected ":" ")+(row._css||"");else if(this._cssUnEven&&ind%2==1)
row.className=this._cssUnEven+((row.className.indexOf("rowselected")!=-1)?" rowselected ":" ")+(row._css||"");}else if(this._h2){var x=this._h2.get[row.idd];row.className+=" "+((x.level%2)?(this._cssUnEven+" "+this._cssUnEven):(this._cssEven+" "+this._cssEven))+"_"+x.level+(this.rowsAr[x.id]._css||"");}
for(var i=0;i<this._fillers.length;i++){var f=this._fillers[i];if(f&&f[0]<=ind&&(f[0]+f[1])>ind){var pos=ind-f[0];if(pos==0){this._insert_before(ind,row,f[2]);this._update_fillers(i,-1,1);}else if(pos==f[1]-1){this._insert_after(ind,row,f[2]);this._update_fillers(i,-1,0);}else{this._fillers.push(this._add_filler(ind+1,f[1]-pos-1,f[2],1));this._insert_after(ind,row,f[2]);this._update_fillers(i,-f[1]+pos,0);}
return;}}}
dhtmlXGridObject.prototype._update_fillers=function(ind,right,left){var f=this._fillers[ind];f[1]=f[1]+right;f[0]=f[0]+left;if(!f[1]){this.callEvent("onRemoveFiller",[f[2]]);f[2].parentNode.removeChild(f[2]);this._fillers.splice(ind,1);}else{f[2].firstChild.style.height=parseFloat(f[2].firstChild.style.height)+right*this._srdh+"px";this.callEvent("onUpdateFiller",[f[2]]);}}
dhtmlXGridObject.prototype._insert_before=function(ind,row,fil){fil.parentNode.insertBefore(row,fil);this.rowsCol[ind]=row;this.callEvent("onRowInserted",[row,null,fil,"before"]);}
dhtmlXGridObject.prototype._insert_after=function(ind,row,fil){if(fil.nextSibling)
fil.parentNode.insertBefore(row,fil.nextSibling);else
fil.parentNode.appendChild(row);this.rowsCol[ind]=row;this.callEvent("onRowInserted",[row,null,fil,"after"]);}
if(typeof(window.dhtmlxValidation)!="undefined"){dhtmlxValidation.trackInput=function(el,rule,callback_error,callback_correct){dhtmlxEvent(el,"keyup",function(e){if(dhtmlxValidation._timer){window.clearTimeout(dhtmlxValidation._timer);dhtmlxValidation._timer=null;}
dhtmlxValidation._timer=window.setTimeout(function(){if(!dhtmlxValidation.checkInput(el,rule)){if(!callback_error||callback_error(el,el.value,rule))el.className+=" dhtmlx_live_validation_error";}else{el.className=el.className.replace(/[ ]*dhtmlx_live_validation_error/g,"");if(callback_correct)callback_correct(el,el.value,rule);}},250);});};dhtmlxValidation.checkInput=function(input,rule){return dhtmlxValidation.checkValue(input.value,rule);};dhtmlxValidation.checkValue=function(value,rule){if(typeof rule=="string")rule=rule.split(",");var final_res=true;for(var i=0;i<rule.length;i++){if(!this["is"+rule[i]]){alert("Incorrect validation rule: "+rule[i]);}else{final_res=final_res&&this["is"+rule[i]](value);}}
return final_res;};};dhtmlXGridObject.prototype.enableValidation=function(mode,live){mode=dhx4.s2b(mode);if(mode)this._validators={data:[]};else this._validators=false;if(arguments.length>1)this._validators._live=live;if(!this._validators._event)this._validators._event=this.attachEvent("onEditCell",this.validationEvent);};dhtmlXGridObject.prototype.setColValidators=function(vals){if(!this._validators)this.enableValidation(true);if(typeof vals=="string")vals=vals.split(this.delim);this._validators.data=vals;};dhtmlXGridObject.prototype.validationEvent=function(stage,id,ind,newval,oldval){var v=this._validators;if(!v)return true;var rule=(v.data[ind]||this.cells(id,ind).getAttribute("validate"))||"";if(stage==1&&rule){var ed=this.editor||(this._fake||{}).editor;if(!ed)return true;ed.cell.className=ed.cell.className.replace(/[ ]*dhtmlx_validation_error/g,"");if(v._live){var grid=this;dhtmlxValidation.trackInput(ed.getInput(),rule,function(element,value,rule){return grid.callEvent("onLiveValidationError",[id,ind,value,element,rule]);},function(element,value,rule){return grid.callEvent("onLiveValidationCorrect",[id,ind,value,element,rule]);});}}
if(stage==2)this.validateCell(id,ind,rule,newval);return true;};dhtmlXGridObject.prototype.validateCell=function(id,ind,rule,value){rule=rule||(this._validators.data[ind]||this.cells(id,ind).getAttribute("validate"));value=value||this.cells(id,ind).getValue();if(!rule)return;var cell=this.cells(id,ind).cell;var result=true;if(typeof rule=="string")
rule=rule.split(this.delim);for(var i=0;i<rule.length;i++){if(!dhtmlxValidation.checkValue(value,rule[i])){if(this.callEvent("onValidationError",[id,ind,value,rule[i]]))
cell.className+=" dhtmlx_validation_error";result=false;}}
if(result){this.callEvent("onValidationCorrect",[id,ind,value,rule]);cell.className=cell.className.replace(/[ ]*dhtmlx_validation_error/g,"");}
return result;};function eXcell_stree(cell){if(cell){this.cell=cell;this.grid=this.cell.parentNode.grid;if(!this.grid._sub_trees)return;this._sub=this.grid._sub_trees[cell._cellIndex];if(!this._sub)return;this._sub=this._sub[0];}
this.getValue=function(){return this.cell._val;}
this.setValue=function(val){this.cell._val=val;val=this._sub.getItemText(this.cell._val);this.setCValue((val||"&nbsp;"),val);}
this.edit=function(){this._sub.parentObject.style.display='block';var arPos=this.grid.getPosition(this.cell);this._sub.parentObject.style.top=arPos[1]+"px";this._sub.parentObject.style.left=arPos[0]+"px";this._sub.parentObject.style.position="absolute";var a=this.grid.editStop;this.grid.editStop=function(){};this.grid.editStop=a;}
this.detach=function(){this._sub.parentObject.style.display='none';if(this.grid._sub_id!=null){var old=this.cell._val;this.setValue(this._sub.getSelectedItemId());this.grid._sub_id=null;return this.cell._val!=old;}}}
eXcell_stree.prototype=new eXcell;dhtmlXGridObject.prototype.setSubTree=function(tree,s_index){if(!this._sub_trees)
this._sub_trees=[];this._sub_trees[s_index]=[tree];tree.parentObject.style.display="none";var that=this;tree.parentObject.onclick=function(event){(event||window.event).cancelBubble=true;return false;}
tree.ev_onDblClick=null;tree.attachEvent("onDblClick",function(id){that._sub_id=id;that.editStop();return true;});tree._chRRS=true;};function eXcell_link(cell){this.cell=cell;this.grid=this.cell.parentNode.grid;this.isDisabled=function(){return true;}
this.edit=function(){}
this.getValue=function(){if(this.cell.firstChild.getAttribute){var target=this.cell.firstChild.getAttribute("target")
return this.cell.firstChild.innerHTML+"^"+this.cell.firstChild.getAttribute("href")+(target?("^"+target):"");}
else
return"";}
this.setValue=function(val){if((typeof(val)!="number")&&(!val||val.toString()._dhx_trim()=="")){this.setCValue("&nbsp;",valsAr);return(this.cell._clearCell=true);}
var valsAr=val.split("^");if(valsAr.length==1)
valsAr[1]="";else{if(valsAr.length>1){valsAr[1]="href='"+valsAr[1]+"'";if(valsAr.length==3)
valsAr[1]+=" target='"+valsAr[2]+"'";else
valsAr[1]+=" target='_blank'";}}
this.setCValue("<a "+valsAr[1]+" onclick='(_isIE?event:arguments[0]).cancelBubble = true;'>"+valsAr[0]+"</a>",valsAr);}}
eXcell_link.prototype=new eXcell;eXcell_link.prototype.getTitle=function(){var z=this.cell.firstChild;return((z&&z.tagName)?z.getAttribute("href"):"");}
eXcell_link.prototype.getContent=function(){var z=this.cell.firstChild;return((z&&z.tagName)?z.innerHTML:"");}
function eXcell_grid(cell){if(cell){this.cell=cell;this.grid=this.cell.parentNode.grid;if(!this.grid._sub_grids)return;this._sub=this.grid._sub_grids[cell._cellIndex];if(!this._sub)return;this._sindex=this._sub[1];this._sub=this._sub[0];}
this.getValue=function(){return this.cell.val;}
this.setValue=function(val){this.cell.val=val;if(this._sub.getRowById(val)){val=this._sub.cells(val,this._sindex);if(val)val=val.getValue();else val="";}
this.setCValue((val||"&nbsp;"),val);}
this.edit=function(){this.val=this.cell.val;this._sub.entBox.style.display='block';var arPos=this.grid.getPosition(this.cell);this._sub.entBox.style.top=arPos[1]+"px";this._sub.entBox.style.left=arPos[0]+"px";this._sub.entBox.style.position="absolute";this._sub.setSizes();var a=this.grid.editStop;this.grid.editStop=function(){};if(this._sub.getRowById(this.cell.val))
this._sub.setSelectedRow(this.cell.val);this._sub.setActive(true)
this.grid.editStop=a;}
this.detach=function(){var old=this.cell.val;this._sub.entBox.style.display='none';if(this._sub.getSelectedId()===null)return false;this.setValue(this._sub.getSelectedId());this.grid.setActive(true)
return this.cell.val!=old;}}
eXcell_grid.prototype=new eXcell;dhtmlXGridObject.prototype.setSubGrid=function(grid,s_index,t_index){if(!this._sub_grids)
this._sub_grids=[];this._sub_grids[s_index]=[grid,t_index];grid.entBox.style.display="none";var that=this;grid.entBox.onclick=function(event){(event||window.event).cancelBubble=true;return false;}
grid.attachEvent("onRowSelect",function(id){that.editStop();return true;});grid._chRRS=false;};function eXcell_dhxCalendar(cell){if(cell){this.cell=cell;this.grid=this.cell.parentNode.grid;if(!this.grid._grid_calendarA){var cal=this.grid._grid_calendarA=new dhtmlxCalendarObject();this.grid.callEvent("onDhxCalendarCreated",[cal]);var sgrid=this.grid;cal.attachEvent("onClick",function(){this._last_operation_calendar=true;window.setTimeout(function(){sgrid.editStop()},1);return true;});var zFunc=function(e){(e||event).cancelBubble=true;}
dhtmlxEvent(cal.base,"click",zFunc);cal=null;}}}
eXcell_dhxCalendar.prototype=new eXcell;eXcell_dhxCalendar.prototype.edit=function(){var arPos=this.grid.getPosition(this.cell);this.grid._grid_calendarA._show(false,false);this.grid._grid_calendarA.setPosition(arPos[0],arPos[1]+this.cell.offsetHeight);this.grid._grid_calendarA._last_operation_calendar=false;this.grid.callEvent("onCalendarShow",[this.grid._grid_calendarA,this.cell.parentNode.idd,this.cell._cellIndex]);this.cell._cediton=true;this.val=this.cell.val;this._val=this.cell.innerHTML;var t=this.grid._grid_calendarA.draw;this.grid._grid_calendarA.draw=function(){};this.grid._grid_calendarA.setDateFormat((this.grid._dtmask||"%d/%m/%Y"));this.grid._grid_calendarA.setDate(this.val||(new Date()));this.grid._grid_calendarA.draw=t;}
eXcell_dhxCalendar.prototype.getDate=function(){if(this.cell.val)return this.cell.val;return null;}
eXcell_dhxCalendar.prototype.getValue=function(){if(this.cell._clearCell)return"";if(this.grid._dtmask_inc&&this.cell.val)return this.grid._grid_calendarA.getFormatedDate(this.grid._dtmask_inc,this.cell.val).toString();return this.cell.innerHTML.toString()._dhx_trim()}
eXcell_dhxCalendar.prototype.detach=function(){if(!this.grid._grid_calendarA)return;this.grid._grid_calendarA.hide();if(this.cell._cediton)this.cell._cediton=false;else return;if(this.grid._grid_calendarA._last_operation_calendar){var z1=this.grid._grid_calendarA.getFormatedDate((this.grid._dtmask||"%d/%m/%Y"));var z2=this.grid._grid_calendarA.getDate();this.cell.val=new Date(z2);this.setCValue(z1,z2);this.cell._clearCell=!z1;var t=this.val;this.val=this._val;return(this.cell.val.valueOf()!=(t||"").valueOf());}
return false;}
eXcell_dhxCalendar.prototype.setValue=function(val){if(val&&typeof val=="object"){this.cell.val=val;this.cell._clearCell=false;this.setCValue(this.grid._grid_calendarA.getFormatedDate((this.grid._dtmask||"%d/%m/%Y"),val).toString(),this.cell.val);return;}
if(!val||val.toString()._dhx_trim()==""){val="&nbsp";this.cell._clearCell=true;this.cell.val="";}else{this.cell._clearCell=false;this.cell.val=new Date(this.grid._grid_calendarA.setFormatedDate((this.grid._dtmask_inc||this.grid._dtmask||"%d/%m/%Y"),val.toString(),null,true));if(this.grid._dtmask_inc)
val=this.grid._grid_calendarA.getFormatedDate((this.grid._dtmask||"%d/%m/%Y"),this.cell.val);}
if((this.cell.val=="NaN")||(this.cell.val=="Invalid Date")){this.cell._clearCell=true;this.cell.val=new Date();this.setCValue("&nbsp;",0);}else{this.setCValue((val||"").toString(),this.cell.val);}}
function eXcell_dhxCalendarA(cell){if(cell){this.cell=cell;this.grid=this.cell.parentNode.grid;if(!this.grid._grid_calendarA){var cal=this.grid._grid_calendarA=new dhtmlxCalendarObject();this.grid.callEvent("onDhxCalendarCreated",[cal]);var sgrid=this.grid;cal.attachEvent("onClick",function(){this._last_operation_calendar=true;window.setTimeout(function(){sgrid.editStop()},1);return true;});var zFunc=function(e){(e||event).cancelBubble=true;}
dhtmlxEvent(cal.base,"click",zFunc);}}}
eXcell_dhxCalendarA.prototype=new eXcell;eXcell_dhxCalendarA.prototype.edit=function(){var arPos=this.grid.getPosition(this.cell);this.grid._grid_calendarA._show(false,false);this.grid._grid_calendarA.setPosition(arPos[0]*1+this.cell.offsetWidth,arPos[1]*1);this.grid.callEvent("onCalendarShow",[this.grid._grid_calendarA,this.cell.parentNode.idd,this.cell._cellIndex]);this.grid._grid_calendarA._last_operation_calendar=false;this.cell._cediton=true;this.val=this.cell.val;this._val=this.cell.innerHTML;var t=this.grid._grid_calendarA.draw;this.grid._grid_calendarA.draw=function(){};this.grid._grid_calendarA.setDateFormat((this.grid._dtmask||"%d/%m/%Y"));this.grid._grid_calendarA.setDate(this.val);this.grid._grid_calendarA.draw=t;this.cell.atag=((!this.grid.multiLine)&&(_isKHTML||_isMacOS||_isFF))?"INPUT":"TEXTAREA";this.obj=document.createElement(this.cell.atag);this.obj.style.height=(this.cell.offsetHeight-4)+"px";this.obj.className="dhx_combo_edit";this.obj.wrap="soft";this.obj.style.textAlign=this.cell.align;this.obj.onclick=function(e){(e||event).cancelBubble=true}
this.obj.onmousedown=function(e){(e||event).cancelBubble=true}
this.obj.value=this.getValue();this.cell.innerHTML="";this.cell.appendChild(this.obj);if(window.dhx4.isIE){this.obj.style.overflow="visible";if((this.grid.multiLine)&&(this.obj.offsetHeight>=18)&&(this.obj.offsetHeight<40)){this.obj.style.height="36px";this.obj.style.overflow="scroll";}}
this.obj.onselectstart=function(e){if(!e)e=event;e.cancelBubble=true;return true;};this.obj.focus()
this.obj.focus()}
eXcell_dhxCalendarA.prototype.getDate=function(){if(this.cell.val)return this.cell.val;return null;}
eXcell_dhxCalendarA.prototype.getValue=function(){if(this.cell._clearCell)return"";if(this.grid._dtmask_inc&&this.cell.val)
return this.grid._grid_calendarA.getFormatedDate(this.grid._dtmask_inc,this.cell.val).toString();return this.cell.innerHTML.toString()._dhx_trim()}
eXcell_dhxCalendarA.prototype.detach=function(){if(!this.grid._grid_calendarA)return;this.grid._grid_calendarA.hide();if(this.cell._cediton)this.cell._cediton=false;else return;if(this.grid._grid_calendarA._last_operation_calendar){this.grid._grid_calendarA._last_operation_calendar=false;var z1=this.grid._grid_calendarA.getFormatedDate(this.grid._dtmask||"%d/%m/%Y");var z2=this.grid._grid_calendarA.getDate();this.cell.val=new Date(z2);this.setCValue(z1,z2);this.cell._clearCell=!z1;var t=this.val;this.val=this._val;return(this.cell.val.valueOf()!=(t||"").valueOf());}
this.setValue(this.obj.value);var t=this.val;this.val=this._val;return(this.cell.val.valueOf()!=(t||"").valueOf());}
eXcell_dhxCalendarA.prototype.setValue=function(val){if(val&&typeof val=="object"){this.cell.val=val;this.cell._clearCell=false;this.setCValue(this.grid._grid_calendarA.getFormatedDate((this.grid._dtmask||"%d/%m/%Y"),val).toString(),this.cell.val);return;}
if(!val||val.toString()._dhx_trim()==""){val="&nbsp";this.cell._clearCell=true;this.cell.val="";}else{this.cell._clearCell=false;this.cell.val=new Date(this.grid._grid_calendarA.setFormatedDate((this.grid._dtmask_inc||this.grid._dtmask||"%d/%m/%Y"),val.toString(),null,true));if(this.grid._dtmask_inc)
val=this.grid._grid_calendarA.getFormatedDate((this.grid._dtmask||"%d/%m/%Y"),this.cell.val);}
if((this.cell.val=="NaN")||(this.cell.val=="Invalid Date")){this.cell.val=new Date();this.cell._clearCell=true;this.setCValue("&nbsp;",0);}else{this.setCValue((val||"").toString(),this.cell.val);}}
function eXcell_cntr(cell){this.cell=cell;this.grid=this.cell.parentNode.grid;if(!this.grid._ex_cntr_ready&&!this._realfake){this.grid._ex_cntr_ready=true;if(this.grid._h2)
this.grid.attachEvent("onOpenEn",function(id){this.resetCounter(cell._cellIndex);});var fix_cnt=function(){var that=this;window.setTimeout(function(){if(!that.resetCounter)return;if(that._fake&&!that._realfake&&cell._cellIndex<that._fake._cCount)
that._fake.resetCounter(cell._cellIndex);else
that.resetCounter(cell._cellIndex);},1);return true;};this.grid.attachEvent("onBeforeSorting",fix_cnt);this.grid.attachEvent("onFilterEnd",fix_cnt);}
this.edit=function(){}
this.getValue=function(){return this.cell.innerHTML;}
this.setValue=function(val){this.cell.style.paddingRight="2px";var cell=this.cell;window.setTimeout(function(){if(!cell.parentNode)return;var val=cell.parentNode.rowIndex;if(cell.parentNode.grid.currentPage||val<0||cell.parentNode.grid._srnd)val=cell.parentNode.grid.rowsBuffer._dhx_find(cell.parentNode)+1;if(val<=0)return;cell.innerHTML=val;if(cell.parentNode.grid._fake&&cell._cellIndex<cell.parentNode.grid._fake._cCount&&cell.parentNode.grid._fake.rowsAr[cell.parentNode.idd])cell.parentNode.grid._fake.cells(cell.parentNode.idd,cell._cellIndex).setCValue(val);cell=null;},100);}}
dhtmlXGridObject.prototype.resetCounter=function(ind){if(this._fake&&!this._realfake&&ind<this._fake._cCount)this._fake.resetCounter(ind,this.currentPage);var i=arguments[0]||0;if(this.currentPage)
i=(this.currentPage-1)*this.rowsBufferOutSize;for(i=0;i<this.rowsBuffer.length;i++)
if(this.rowsBuffer[i]&&this.rowsBuffer[i].tagName=="TR"&&this.rowsAr[this.rowsBuffer[i].idd])
this.rowsAr[this.rowsBuffer[i].idd].childNodes[ind].innerHTML=i+1;}
eXcell_cntr.prototype=new eXcell;function eXcell_acheck(cell){try{this.cell=cell;this.grid=this.cell.parentNode.grid;this.cell.obj=this;}catch(er){}
this.changeState=function(){if((!this.grid.isEditable)||(this.cell.parentNode._locked)||(this.isDisabled()))return;if(this.grid.callEvent("onEditCell",[0,this.cell.parentNode.idd,this.cell._cellIndex])!=false){this.val=this.getValue()
if(this.val=="1")
this.setValue("<checkbox state='false'>")
else
this.setValue("<checkbox state='true'>")
this.cell.wasChanged=true;this.grid.callEvent("onEditCell",[1,this.cell.parentNode.idd,this.cell._cellIndex]);this.grid.callEvent("onCheck",[this.cell.parentNode.idd,this.cell._cellIndex,(this.val!='1')]);this.grid.callEvent("onCheckbox",[this.cell.parentNode.idd,this.cell._cellIndex,(this.val!='1')]);}else{this.editor=null;}}
this.getValue=function(){try{return this.cell.chstate.toString();}catch(er){return null;}}
this.isCheckbox=function(){return true;}
this.isChecked=function(){if(this.getValue()=="1")
return true;else
return false;}
this.setChecked=function(fl){this.setValue(fl.toString())}
this.detach=function(){return this.val!=this.getValue();}
this.drawCurrentState=function(){if(this.cell.chstate==1)
return"<div  onclick='(new eXcell_acheck(this.parentNode)).changeState(); (arguments[0]||event).cancelBubble=true;'  style='cursor:pointer; font-weight:bold; text-align:center; '><span style='height:8px; width:8px; background:green; display:inline-block;'></span>&nbsp;Yes</div>";else
return"<div  onclick='(new eXcell_acheck(this.parentNode)).changeState(); (arguments[0]||event).cancelBubble=true;' style='cursor:pointer;  text-align:center; '><span style='height:8px; width:8px; background:red; display:inline-block;'></span>&nbsp;No</div>";}}
eXcell_acheck.prototype=new eXcell;eXcell_acheck.prototype.setValue=function(val){val=(val||"").toString();if(val.indexOf("1")!=-1||val.indexOf("true")!=-1){val="1";this.cell.chstate="1";}else{val="0";this.cell.chstate="0"}
var obj=this;this.setCValue(this.drawCurrentState(),this.cell.chstate);}
function eXcell_context(cell){if(cell){this.cell=cell;this.grid=this.cell.parentNode.grid;if(!this.grid._sub_context)return;this._sub=this.grid._sub_context[cell._cellIndex];if(!this._sub)return;this._sindex=this._sub[1];this._sub=this._sub[0];}
this.getValue=function(){return _isIE?this.cell.innerText:this.cell.textContent;}
this.setValue=function(val){this.cell._val=val;var item=this._sub.itemPull[this._sub.idPrefix+this.cell._val];val=item?item.title:val;this.setCValue((val||"&nbsp;"),val);}
this.edit=function(){var arPos=this.grid.getPosition(this.cell);this._sub.showContextMenu(arPos[0]+this.cell.offsetWidth,arPos[1]);var a=this.grid.editStop;this.grid.editStop=function(){};this.grid.editStop=a;}
this.detach=function(){if(this.grid._sub_id!=null){var old=this.cell._val;this.setValue(this.grid._sub_id);this.grid._sub_id=null;return this.cell._val!=old;}
this._sub.hideContextMenu();}}
eXcell_context.prototype=new eXcell;dhtmlXGridObject.prototype.setSubContext=function(ctx,s_index,t_index){var that=this;ctx.attachEvent("onClick",function(id,value){that._sub_id=id;that.editStop();ctx.hideContextMenu();return true;});if(!this._sub_context)
this._sub_context=[];this._sub_context[s_index]=[ctx,t_index];ctx.hideContextMenu();};function dhtmlXGridFromTable(obj,init){if(typeof(obj)!='object')
obj=document.getElementById(obj);var w=document.createElement("DIV");w.setAttribute("width",obj.getAttribute("gridWidth")||(obj.offsetWidth?(obj.offsetWidth+"px"):0)||(window.getComputedStyle?window.getComputedStyle(obj,null)["width"]:(obj.currentStyle?obj.currentStyle["width"]:0)));w.setAttribute("height",obj.getAttribute("gridHeight")||(obj.offsetHeight?(obj.offsetHeight+"px"):0)||(window.getComputedStyle?window.getComputedStyle(obj,null)["height"]:(obj.currentStyle?obj.currentStyle["height"]:0)));w.className=obj.className;obj.className="";if(obj.id)w.id=obj.id;var mr=obj;var drag=obj.getAttribute("dragAndDrop");mr.parentNode.insertBefore(w,mr);var f=mr.getAttribute("name")||("name_"+(new Date()).valueOf());var windowf=new dhtmlXGridObject(w);window[f]=windowf;var acs=mr.getAttribute("onbeforeinit");var acs2=mr.getAttribute("oninit");if(acs)eval(acs);windowf.setImagePath(windowf.imgURL||(mr.getAttribute("imgpath")||mr.getAttribute("image_path")||""));var skin=mr.getAttribute("skin");if(skin)windowf.setSkin(skin);if(init)init(windowf);var hrow=mr.rows[0];var za=[];var zb="";var zc="";var zd="";var ze="";for(var i=0;i<hrow.cells.length;i++){za.push(hrow.cells[i].innerHTML);var width=hrow.cells[i].getAttribute("width")||hrow.cells[i].offsetWidth||(window.getComputedStyle?window.getComputedStyle(hrow.cells[i],null)["width"]:(hrow.cells[i].currentStyle?hrow.cells[i].currentStyle["width"]:0));zb+=(zb?",":"")+(width=="*"?width:parseInt(width));zc+=(zc?",":"")+(hrow.cells[i].getAttribute("align")||"left");zd+=(zd?",":"")+(hrow.cells[i].getAttribute("type")||"ed");ze+=(ze?",":"")+(hrow.cells[i].getAttribute("sort")||"str");var f_a=hrow.cells[i].getAttribute("format");if(f_a)
if(hrow.cells[i].getAttribute("type").toLowerCase().indexOf("calendar")!=-1)
windowf._dtmask=f_a;else
windowf.setNumberFormat(f_a,i);}
windowf.setHeader(za);windowf.setInitWidths(zb)
windowf.setColAlign(zc)
windowf.setColTypes(zd);windowf.setColSorting(ze);if(obj.getAttribute("gridHeight")=="auto")
windowf.enableAutoHeigth(true);if(obj.getAttribute("multiline"))windowf.enableMultiline(true);var lmn=mr.getAttribute("lightnavigation");if(lmn)windowf.enableLightMouseNavigation(lmn);var evr=mr.getAttribute("evenrow");var uevr=mr.getAttribute("unevenrow");if(evr||uevr)windowf.enableAlterCss(evr,uevr);if(drag)windowf.enableDragAndDrop(true);windowf.init();if(obj.getAttribute("split"))windowf.splitAt(obj.getAttribute("split"));windowf.callEvent("onXLS",[]);windowf._process_inner_html(mr,1);if(acs2)eval(acs2);if(obj.parentNode&&obj.parentNode.removeChild)
obj.parentNode.removeChild(obj);windowf.callEvent("onXLE",[]);return windowf;}
dhtmlXGridObject.prototype._process_html=function(xml){if(xml.tagName&&xml.tagName=="TABLE")return this._process_inner_html(xml,0);var temp=document.createElement("DIV");temp.innerHTML=xml.xmlDoc.responseText;var mr=temp.getElementsByTagName("TABLE")[0];this._process_inner_html(mr,0);}
dhtmlXGridObject.prototype._process_inner_html=function(mr,start){var n_l=mr.rows.length;for(var j=start;j<n_l;j++){var id=mr.rows[j].getAttribute("id")||j;this.rowsBuffer.push({idd:id,data:mr.rows[j],_parser:this._process_html_row,_locator:this._get_html_data});}
this.render_dataset();this.setSizes();}
dhtmlXGridObject.prototype._process_html_row=function(r,xml){var cellsCol=xml.getElementsByTagName('TD');var strAr=[];r._attrs=this._xml_attrs(xml);for(var j=0;j<cellsCol.length;j++){var cellVal=cellsCol[j];var exc=cellVal.getAttribute("type");if(r.childNodes[j]){if(exc)
r.childNodes[j]._cellType=exc;r.childNodes[j]._attrs=this._xml_attrs(cellsCol[j]);}
if(cellVal.firstChild)
strAr.push(cellVal.innerHTML);else strAr.push("");if(cellVal.colSpan>1){r.childNodes[j]._attrs["colspan"]=cellVal.colSpan;for(var k=1;k<cellVal.colSpan;k++){strAr.push("")}}}
for(j<cellsCol.length;j<r.childNodes.length;j++)
r.childNodes[j]._attrs={};this._fillRow(r,(this._c_order?this._swapColumns(strAr):strAr));return r;}
dhtmlXGridObject.prototype._get_html_data=function(data,ind){data=data.firstChild;while(true){if(!data)return"";if(data.tagName=="TD")ind--;if(ind<0)break;data=data.nextSibling;}
return(data.firstChild?data.firstChild.data:"");}
dhtmlxEvent(window,"load",function(){var z=document.getElementsByTagName("table");for(var a=0;a<z.length;a++)
if(z[a].className=="dhtmlxGrid"){dhtmlXGridFromTable(z[a]);}});dhtmlXGridObject.prototype._process_xmlA=function(xml){this._parsing=true;var top=dhx4.ajax.xmltop(this.xml.top,xml);this._parseHead(top);var rows=dhx4.ajax.xpath(this.xml.row,top)
var cr=parseInt(top.getAttribute("pos")||0);var total=parseInt(top.getAttribute("total_count")||0);if(total&&!this.rowsBuffer[total-1])this.rowsBuffer[total-1]=null;if(this.isTreeGrid()){this._get_xml_data=this._get_xml_dataA;this._process_xml_row=this._process_xml_rowA;return this._process_tree_xml(xml);}
for(var i=0;i<rows.length;i++){if(this.rowsBuffer[i+cr])continue;var id=rows[i].getAttribute("id")||this.uid();this.rowsBuffer[i+cr]={idd:id,data:rows[i],_parser:this._process_xml_rowA,_locator:this._get_xml_dataA};this.rowsAr[id]=rows[i];}
this.render_dataset();this._parsing=false;}
dhtmlXGridObject.prototype._process_xmlB=function(xml){this._parsing=true;var top=dhx4.ajax.xmltop(this.xml.top,xml);this._parseHead(top);var rows=dhx4.ajax.xpath(this.xml.row,top)
var cr=parseInt(top.getAttribute("pos")||0);var total=parseInt(top.getAttribute("total_count")||0);if(total&&!this.rowsBuffer[total-1])this.rowsBuffer[total-1]=null;if(this.isTreeGrid()){this._get_xml_data=this._get_xml_dataB;this._process_xml_row=this._process_xml_rowB;return this._process_tree_xml(xml);}
for(var i=0;i<rows.length;i++){if(this.rowsBuffer[i+cr])continue;var id=rows[i].getAttribute("id")||this.uid();this.rowsBuffer[i+cr]={idd:id,data:rows[i],_parser:this._process_xml_rowB,_locator:this._get_xml_dataB};this.rowsAr[id]=rows[i];}
this.render_dataset();this._parsing=false;}
dhtmlXGridObject.prototype._process_xml_rowA=function(r,xml){var strAr=[];r._attrs=this._xml_attrs(xml);for(var j=0;j<this.columnIds.length;j++){var cid=this.columnIds[j];var cellVal=r._attrs[cid]||"";if(r.childNodes[j])
r.childNodes[j]._attrs={};strAr.push(cellVal);}
this._fillRow(r,(this._c_order?this._swapColumns(strAr):strAr));return r;}
dhtmlXGridObject.prototype._get_xml_dataA=function(data,ind){return data.getAttribute(this.getColumnId(ind));}
dhtmlXGridObject.prototype._process_xml_rowB=function(r,xml){var strAr=[];r._attrs=this._xml_attrs(xml);if(this._ud_enabled){var udCol=dhx4.ajax.xpath("./userdata",xml);for(var i=udCol.length-1;i>=0;i--)
this.setUserData(udCol[i].getAttribute("name"),udCol[i].firstChild?udCol[i].firstChild.data:"");}
for(var jx=0;jx<xml.childNodes.length;jx++){var cellVal=xml.childNodes[jx];if(!cellVal.tagName)continue;var j=this.getColIndexById(cellVal.tagName);if(isNaN(j))continue;var exc=cellVal.getAttribute("type");if(exc)
r.childNodes[j]._cellType=exc;r.childNodes[j]._attrs=this._xml_attrs(cellVal);if(cellVal.getAttribute("xmlcontent"))
{}
else if(cellVal.firstChild)
cellVal=cellVal.firstChild.data;else cellVal="";strAr[j]=cellVal;}
for(var i=0;i<r.childNodes.length;i++){if(!r.childNodes[i]._attrs)r.childNodes[i]._attrs={};};this._fillRow(r,strAr);return r;}
dhtmlXGridObject.prototype._get_xml_dataB=function(data,ind){var id=this.getColumnId(ind);data=data.firstChild;while(true){if(!data)return"";if(data.tagName==id)return(data.firstChild?data.firstChild.data:"")
data=data.nextSibling;}
return"";}
dhtmlXGridObject.prototype.startFastOperations=function(){this._disF=["setSizes","callEvent","_fixAlterCss","cells4","forEachRow","_correctMonolite"];this._disA=[];for(var i=this._disF.length-1;i>=0;i--){this._disA[i]=this[this._disF[i]];this[this._disF[i]]=function(){return true};};this._cellCache=[];this.cells4=function(cell){var c=this._cellCache[cell._cellIndex]
if(!c){c=this._cellCache[cell._cellIndex]=this._disA[3].apply(this,[cell]);c.destructor=function(){return true;}
c.setCValue=function(val){c.cell.innerHTML=val;}}
c.cell=cell;c.combo=cell._combo||this.combos[cell._cellIndex];return c;}}
dhtmlXGridObject.prototype.stopFastOperations=function(){if(!this._disF)return;for(var i=this._disF.length-1;i>=0;i--){this[this._disF[i]]=this._disA[i];};if(this._correctMonolite)
this._correctMonolite();this.setSizes();this.callEvent("onGridReconstructed",[]);}
dhtmlXGridObject.prototype._in_header_number_filter=function(t,i){this._in_header_text_filter.call(this,t,i);var self=this;t.firstChild._filter=function(){var filters=self._get_filters(this.value,'num');return function(value){var result=filters.length>0?false:true;for(var i=0;i<filters.length;i++)
result=result||filters[i](value);return result;}};}
dhtmlXGridObject.prototype._in_header_string_filter=function(t,i){this._in_header_text_filter.call(this,t,i);var self=this;t.firstChild._filter=function(){var filters=self._get_filters(this.value,'str');return function(value){var result=filters.length>0?false:true;for(var i=0;i<filters.length;i++)
result=result||filters[i](value);return result;}};}
dhtmlXGridObject.prototype._get_filters=function(value,type){var fs=value.split(',');var filters=[];for(var i=0;i<fs.length;i++){if(fs[i]=='')continue;var f=this['_get_'+type+'_filter'](fs[i]);filters.push(f);}
return filters;}
dhtmlXGridObject.prototype._get_str_filter=function(value){if(value=='null'||value=='empty'){return new Function('value','if (value == null || value == "") return true; return false;');}
if(value=='!null'||value=='!empty'){return new Function('value','if (value == null || value == "") return false; return true;');}
if(value.substr(0,1)==='!'){var substr=value.substr(1);return new Function('value','if (value !== "'+substr+'") return true; return false;');}
if(value.substr(0,1)==='~'){var substr=value.substr(1);return new Function('value','if (value.indexOf("'+substr+'") !== -1) return true; return false;');}
if(value.substr(0,1)==='^'&&value.substr(value.length-1,1)==='&'){value='='+value.substr(1,value.length-2);}
if(value.substr(0,1)==='^'){var substr=value.substr(1);return new Function('value','if (value.substr(0, '+substr.length+') === "'+substr+'") return true; return false;');}
if(value.substr(value.length-1,1)==='&'){var substr=value.substr(0,value.length-1);return new Function('value','if (value.substr(value.length - '+substr.length+') === "'+substr+'") return true; return false;');}
if(value.substr(0,1)==='=')
var substr=value.substr(1);else
var substr=value;return new Function('value','if (value === "'+substr+'") return true; return false;');}
dhtmlXGridObject.prototype._get_num_filter=function(value){if(value=='null'||value=='empty'){return new Function('value','if (value == null || value == "") return true; return false;');}
if(value=='!null'||value=='!empty'){return new Function('value','if (value == null || value == "") return false; return true;');}
var range=value.split('..');if(range.length==2){var num1=parseFloat(range[0]);var num2=parseFloat(range[1]);return new Function('value','if (value >= '+num1+' && value <= '+num2+') return true; return false;');}
var r=value.match(/<>|>=|<=|>|<|=/);if(r){var op=r[0];var num=parseFloat(value.replace(op,""));}else{var op='==';num=parseFloat(value);}
if(op=='<>')op='!=';if(op=='=')op='==';return new Function("value"," if (value "+op+" "+num+" ) return true; return false;");}
dhtmlXGridObject.prototype.attachHeaderA=dhtmlXGridObject.prototype.attachHeader;dhtmlXGridObject.prototype.attachHeader=function()
{this.attachHeaderA.apply(this,arguments);if(this._realfake)return true;this.formAutoSubmit();if(typeof(this.FormSubmitOnlyChanged)=="undefined")
this.submitOnlyChanged(true);if(typeof(this._submitAR)=="undefined")
this.submitAddedRows(true);var that=this;this._added_rows=[];this._deleted_rows=[];this.attachEvent("onRowAdded",function(id){that._added_rows.push(id);that.forEachCell(id,function(a){a.cell.wasChanged=true;})
return true;});this.attachEvent("onBeforeRowDeleted",function(id){that._deleted_rows.push(id);return true;});this.attachHeader=this.attachHeaderA;}
dhtmlXGridObject.prototype.formAutoSubmit=function()
{this.parentForm=this.detectParentFormPresent();if(this.parentForm===false){return false;}
if(this.formEventAttached)
return;this.formInputs=new Array();var self=this;dhtmlxEvent(this.parentForm,'submit',function(){if(self.entBox)self.parentFormOnSubmit();});this.formEventAttached=true;}
dhtmlXGridObject.prototype.parentFormOnSubmit=function()
{this.formCreateInputCollection();if(!this.callEvent("onBeforeFormSubmit",[]))return false;}
dhtmlXGridObject.prototype.submitOnlyChanged=function(mode)
{this.FormSubmitOnlyChanged=dhx4.s2b(mode);}
dhtmlXGridObject.prototype.submitColumns=function(names){if(typeof names=="string")names=names.split(this.delim);this._submit_cols=names;}
dhtmlXGridObject.prototype.setFieldName=function(mask){mask=mask.replace(/\{GRID_ID\}/g,"'+a1+'");mask=mask.replace(/\{ROW_ID\}/g,"'+a2+'");mask=mask.replace(/\{ROW_INDEX\}/g,"'+this.getRowIndex(a2)+'");mask=mask.replace(/\{COLUMN_INDEX\}/g,"'+a3+'");mask=mask.replace(/\{COLUMN_ID\}/g,"'+this.getColumnId(a3)+'");this._input_mask=Function("a1","a2","a3","return '"+mask+"';");}
dhtmlXGridObject.prototype.submitSerialization=function(mode)
{this.FormSubmitSerialization=dhx4.s2b(mode);}
dhtmlXGridObject.prototype.submitAddedRows=function(mode)
{this._submitAR=dhx4.s2b(mode);}
dhtmlXGridObject.prototype.submitOnlySelected=function(mode)
{this.FormSubmitOnlySelected=dhx4.s2b(mode);}
dhtmlXGridObject.prototype.submitOnlyRowID=function(mode)
{this.FormSubmitOnlyRowID=dhx4.s2b(mode);}
dhtmlXGridObject.prototype.createFormInput=function(name,value){var input=document.createElement('input');input.type='hidden';if(this._input_mask&&(typeof name!="string"))
input.name=this._input_mask.apply(this,name);else
input.name=((this.globalBox||this.entBox).id||'dhtmlXGrid')+'_'+name;input.value=value;this.parentForm.appendChild(input);this.formInputs.push(input);}
dhtmlXGridObject.prototype.createFormInputRow=function(r){var id=(this.globalBox||this.entBox).id;for(var j=0;j<this._cCount;j++){var foo_cell=this.cells3(r,j);if(((!this.FormSubmitOnlyChanged)||foo_cell.wasChanged())&&(!this._submit_cols||this._submit_cols[j]))
this.createFormInput(this._input_mask?[id,r.idd,j]:(r.idd+'_'+j),foo_cell.getValue());}}
dhtmlXGridObject.prototype.formCreateInputCollection=function()
{if(this.parentForm==false){return false;}
for(var i=0;i<this.formInputs.length;i++){this.parentForm.removeChild(this.formInputs[i]);}
this.formInputs=new Array();if(this.FormSubmitSerialization){this.createFormInput("serialized",this.serialize());}else if(this.FormSubmitOnlySelected){if(this.FormSubmitOnlyRowID)
this.createFormInput("selected",this.getSelectedId());else
for(var i=0;i<this.selectedRows.length;i++)
this.createFormInputRow(this.selectedRows[i]);}
else{if(this._submitAR){if(this._added_rows.length)
this.createFormInput("rowsadded",this._added_rows.join(","));if(this._deleted_rows.length)
this.createFormInput("rowsdeleted",this._deleted_rows.join(","));}
this.forEachRow(function(id){if(this.getRowById(id)!==-1)
this.createFormInputRow(this.rowsAr[id]);})}}
dhtmlXGridObject.prototype.detectParentFormPresent=function()
{var parentForm=false;var parent=this.entBox;while(parent&&parent.tagName&&parent!=document.body){if(parent.tagName.toLowerCase()=='form'){parentForm=parent;break;}else{parent=parent.parentNode;}}
return parentForm;}
dhtmlXGridObject.prototype.unGroup=function(){if(!this._groups)return;this._dndProblematic=false;delete this._groups;delete this._gIndex;if(this._fake)this._mirror_rowsCol();this.forEachRow(function(id){this.rowsAr[id].style.display='';})
this._reset_view();this.callEvent("onGridReconstructed",[])
this.callEvent("onUnGroup",[]);}
dhtmlXGridObject.prototype._mirror_rowsCol=function(){this._fake._groups=this._groups;this._fake._gIndex=this._gIndex;this.rowsBuffer=dhtmlxArray();for(var i=0;i<this.rowsCol.length;i++)
if(!this.rowsCol[i]._cntr)
this.rowsBuffer.push(this.rowsCol[i]);this._fake.rowsBuffer=dhtmlxArray();for(var i=0;i<this._fake.rowsCol.length;i++)
if(!this._fake.rowsCol[i]._cntr)
this._fake.rowsBuffer.push(this._fake.rowsCol[i]);}
dhtmlXGridObject.prototype.groupBy=function(ind,mask){if(this._groups)this.unGroup();this._dndProblematic=true;this._groups={};if(!mask){mask=["#title"];for(var i=1;i<this._cCount;i++)mask.push("#cspan");}
this._gmask=document.createElement("TR");this._gmask.origin=mask;var ltd,rindex=0;for(var i=0;i<mask.length;i++){if(mask[i]=="#cspan")
ltd.colSpan=(parseInt(ltd.colSpan)||1)+1
else{ltd=document.createElement("TD");ltd._cellIndex=i;if(this._hrrar[i])ltd.style.display="none";ltd.className="group_row";ltd.innerHTML="&nbsp;";if(mask[i]=="#title")this._gmask._title=rindex;else ltd.align=this.cellAlign[i]||"left";this._gmask.appendChild(ltd);if(mask[i].indexOf("#stat")==0){this._gmask._math=true;ltd._counter=[this["_g_"+mask[i].replace("#","")],i,rindex];}
rindex++;}}
for(var a in this._groups)this._groups[a]=this.undefined;this._gIndex=ind;if(this._fake&&!this._realfake){this._fake._groups=[];this._fake._gIndex=this._gIndex;}
this._nextRow=function(ind,dir){var r=this.rowsCol[ind+dir];if(r&&(r.style.display=="none"||r._cntr))return this._nextRow(ind+dir,dir);return r;}
if(!this.__sortRowsBG){this._key_events=dhtmlx.extend({},this._key_events)
this._key_events.k38_0_0=function(){if(this.editor&&this.editor.combo)
this.editor.shiftPrev();else{var rowInd=this.row.rowIndex;if(!rowInd)return;var nrow=this._nextRow(rowInd-1,-1);if(nrow)
this.selectCell(nrow,this.cell._cellIndex,true);}}
this._key_events.k13_1_0=this._key_events.k13_0_1=function(){};this._key_events.k40_0_0=function(){if(this.editor&&this.editor.combo)
this.editor.shiftNext();else{var rowInd=this.row.rowIndex;if(!rowInd)return;var nrow=this._nextRow(rowInd-1,1);if(nrow)
this.selectCell(nrow,this.cell._cellIndex,true);}}
this.attachEvent("onFilterStart",function(){if(this._groups)this._groups=this.undefined;return true;});this.attachEvent("onFilterEnd",function(){if(typeof this._gIndex!="undefined")this.groupBy(this._gIndex,this._gmask.origin);});this.sortRows_bg=this.sortRows;this.sortRows=function(ind,type,dir){if(typeof(this._groups)=="undefined")
return this.sortRows_bg.apply(this,arguments);type=type||this.fldSort[ind]||"str";dir=dir||"asc";if(this.callEvent("onBeforeSorting",[ind,type,dir])){if(typeof(this._groups)=="undefined")return true;if(ind==this._gIndex)this._sortByGroup(ind,type,dir);else this._sortInGroup(ind,type,dir);this.setSortImgState(true,ind,dir)
if(this._fake){this._mirror_rowsCol();this._fake._groups=[];this._fake._reset_view();}
this.setSortImgState(true,ind,dir);this.callEvent("onAfterSorting",[ind,type,dir]);}
return false;};this.attachEvent("onClearAll",function(){this.unGroup();});this.attachEvent("onBeforeRowDeleted",function(id){if(!this._groups)return true;if(!this.rowsAr[id])return true;var val=this.cells(id,this._gIndex).getValue();if(val==="")val=" ";var z=this._groups[val];this._dec_group(z);return true;});this.attachEvent("onAfterRowDeleted",function(id){this.updateGroups();});this.attachEvent("onCheckbox",function(id,index,value){this.callEvent("onEditCell",[2,id,index,(value?1:0),(value?0:1)]);});this.attachEvent("onXLE",this.updateGroups);this.attachEvent("onColumnHidden",this.hideGroupColumn);this.attachEvent("onEditCell",function(stage,id,ind,val,oldval){if(!this._groups)return true;if(stage==2&&val!=oldval&&ind==this._gIndex){if(oldval==="")oldval=" ";this._dec_group(this._groups[oldval]);var r=this.rowsAr[id];var i=this.rowsCol._dhx_find(r)
var ni=this._inc_group(val);var n=this.rowsCol[ni];if(r==n)n=n.nextSibling;var p=r.parentNode;var o=r.rowIndex;p.removeChild(r);if(n)
p.insertBefore(r,n);else
p.appendChild(r);this.rowsCol._dhx_insertAt(ni,r);if(ni<i)i++;this.rowsCol._dhx_removeAt(i,r);this._fixAlterCss();}else if(stage==2&&val!=oldval){this.updateGroups();this._updateGroupView(this._groups[this.cells(id,this._gIndex).getValue()||" "]);}
return true;})
this.__sortRowsBG=true;}
this._groupExisting();if(this._hrrar)
for(var i=0;i<this._hrrar.length;i++)
if(this._hrrar[i])
this.hideGroupColumn(i,true);this.callEvent("onGroup",[]);if(this._ahgr||this._awdth)this.setSizes();}
dhtmlXGridObject.prototype._sortInGroup=function(col,type,order){var b=this._groups_get();b.reverse();for(var i=0;i<b.length;i++){var c=b[i]._cntr._childs;var a={};for(var j=0;j<c.length;j++){var cell=this.cells3(c[j],col);a[c[j].idd]=cell.getDate?cell.getDate():cell.getValue();}
this._sortCore(col,type,order,a,c);}
this._groups_put(b);this.setSizes();this.callEvent("onGridReconstructed",[])}
dhtmlXGridObject.prototype._sortByGroup=function(col,type,order){var b=this._groups_get();var a=[];for(var i=0;i<b.length;i++){b[i].idd="_sort_"+i;a["_sort_"+i]=b[i]._cntr.text;}
this._sortCore(col,type,order,a,b);this._groups_put(b);this.callEvent("onGridReconstructed",[])
this.setSizes();}
dhtmlXGridObject.prototype._inc_group=function(val,hidden,skip){if(val==="")val=" ";if(!this._groups[val]){this._groups[val]={text:val,row:this._addPseudoRow(),count:0,state:hidden?"plus":"minus"};}
var z=this._groups[val];z.row._cntr=z;var ind=this.rowsCol._dhx_find(z.row)+z.count+1;z.count++;if(!skip){this._updateGroupView(z);this.updateGroups();}
return ind;}
dhtmlXGridObject.prototype._dec_group=function(z){if(!z)return;z.count--;if(z.count==0){z.row.parentNode.removeChild(z.row);this.rowsCol._dhx_removeAt(this.rowsCol._dhx_find(z.row));delete this._groups[z.text];}
else
this._updateGroupView(z);if(this._fake&&!this._realfake)
this._fake._dec_group(this._fake._groups[z.text]);this.updateGroups();return true;}
dhtmlXGridObject.prototype._insertRowAt_gA=dhtmlXGridObject.prototype._insertRowAt;dhtmlXGridObject.prototype._insertRowAt=function(r,ind,skip){if(typeof(this._groups)!="undefined"){if(this._realfake)
var val=this._fake._bfs_cells(r.idd,this._gIndex).getValue();else
if(this._bfs_cells3)
var val=this._bfs_cells3(r,this._gIndex).getValue();else
var val=this.cells3(r,this._gIndex).getValue();if(!val)val=" ";ind=this._inc_group(val,r.style.display=="none");}
var res=this._insertRowAt_gA(r,ind,skip);if(typeof(this._groups)!="undefined"){this.expandGroup(val);this._updateGroupView(this._groups[val]);this.updateGroups();}
return res;}
dhtmlXGridObject.prototype._updateGroupView=function(z){if(this._fake&&!this._realfake)return z.row.firstChild.innerHTML="&nbsp;";var mask=this._gmask||this._fake._gmask;var html="<img style='margin-bottom:-4px' src='"+this.imgURL+z.state+".gif'> ";if(this.customGroupFormat)html+=this.customGroupFormat(z.text,z.count);else html+=z.text+" ( "+z.count+" ) ";z.row.childNodes[mask._title].innerHTML=html;}
dhtmlXGridObject.prototype._addPseudoRow=function(skip){var mask=this._gmask||this._fake._gmask;var r=mask.cloneNode(true)
for(var i=0;i<r.childNodes.length;i++){r.childNodes[i]._cellIndex=mask.childNodes[i]._cellIndex;if(this._realfake)r.childNodes[i].style.display="";}
var that=this;r.onclick=function(e){if(!that.callEvent("onGroupClick",[this._cntr.text]))
return;if(that._fake&&that._realfake)
that._fake._switchGroupState(that._fake._groups[this._cntr.text].row);else
that._switchGroupState(this);(e||event).cancelBubble="true";}
r.ondblclick=function(e){(e||event).cancelBubble="true";}
if(!skip){if(_isKHTML)
this.obj.appendChild(r)
else
this.obj.firstChild.appendChild(r)
this.rowsCol.push(r);}
return r;}
dhtmlXGridObject.prototype._groups_get=function(){var b=[];this._temp_par=this.obj.parentNode;this._temp_par.removeChild(this.obj);var a=[];for(var i=this.rowsCol.length-1;i>=0;i--){if(this.rowsCol[i]._cntr){this.rowsCol[i]._cntr._childs=a;a=[];b.push(this.rowsCol[i]);}else a.push(this.rowsCol[i]);this.rowsCol[i].parentNode.removeChild(this.rowsCol[i]);}
return b;}
dhtmlXGridObject.prototype._groups_put=function(b){var sts=this.rowsCol.stablesort;this.rowsCol=new dhtmlxArray(0);this.rowsCol.stablesort=sts;for(var i=0;i<b.length;i++){var gr=b[i]._cntr;this.obj.firstChild.appendChild(gr.row);this.rowsCol.push(gr.row)
gr.row.idd=null;for(var j=0;j<gr._childs.length;j++){this.obj.firstChild.appendChild(gr._childs[j]);this.rowsCol.push(gr._childs[j])}
delete gr._childs;}
this._temp_par.appendChild(this.obj);}
dhtmlXGridObject.prototype._groupExisting=function(b){if(!this.getRowsNum())return;var b=[];this._temp_par=this.obj.parentNode;this._temp_par.removeChild(this.obj);var a=[];var mlen=this.rowsCol.length;for(var i=0;i<mlen;i++){var val=this.cells4(this.rowsCol[i].childNodes[this._gIndex]).getValue();this.rowsCol[i].style.display="";if(!val)val=" ";if(!this._groups[val]){this._groups[val]={text:val,row:this._addPseudoRow(true),count:0,state:"minus"};var z=this._groups[val];z.row._cntr=z;this._groups[val]._childs=[];b.push(z.row)}
this._groups[val].count++;this._groups[val]._childs.push(this.rowsCol[i]);this.rowsCol[i].parentNode.removeChild(this.rowsCol[i]);}
for(var i=0;i<b.length;i++)
this._updateGroupView(b[i]._cntr)
this._groups_put(b);if(this._fake&&!this._realfake){this._mirror_rowsCol();this._fake._groups=[];this._fake._reset_view();}
this.callEvent("onGridReconstructed",[])
this.updateGroups();}
dhtmlXGridObject.prototype._switchGroupState=function(row){var z=row._cntr;if(this._fake&&!this._realfake){z.state=this._fake._groups[row._cntr.text].row._cntr.state;this._fake._switchGroupState(this._fake._groups[row._cntr.text].row)}
var ind=this.rowsCol._dhx_find(z.row)+1;z.state=z.state=="minus"?"plus":"minus";var st=z.state=="plus"?"none":"";while(this.rowsCol[ind]&&!this.rowsCol[ind]._cntr){this.rowsCol[ind].style.display=st;ind++;}
this._updateGroupView(z);this.callEvent("onGroupStateChanged",[z.text,(z.state=="minus")]);this.setSizes();}
dhtmlXGridObject.prototype.expandGroup=function(val){if(this._groups[val].state=="plus")
this._switchGroupState(this._groups[val].row);}
dhtmlXGridObject.prototype.collapseGroup=function(val){if(this._groups[val].state=="minus")
this._switchGroupState(this._groups[val].row);}
dhtmlXGridObject.prototype.expandAllGroups=function(){for(var i in this._groups)
if(this._groups[i]&&this._groups[i].state=="plus")
this._switchGroupState(this._groups[i].row);}
dhtmlXGridObject.prototype.collapseAllGroups=function(){for(var i in this._groups)
if(this._groups[i]&&this._groups[i].state=="minus")
this._switchGroupState(this._groups[i].row);}
dhtmlXGridObject.prototype.hideGroupColumn=function(ind,state){if(this._fake)return;var rind=-1;var row=this._gmask.childNodes;for(var i=0;i<row.length;i++)
if(row[i]._cellIndex==ind){rind=i;break;}
if(rind==-1)return;for(var a in this._groups)
this._groups[a].row.childNodes[rind].style.display=state?"none":"";};dhtmlXGridObject.prototype.groupStat=function(name,ind,math){math=this["_g_"+(math||"stat_total")];var summ=0;var index=0;this.forEachRowInGroup(name,function(id){summ=math(summ,this.cells(id,ind).getValue()*1,index)
index++;})
return summ;}
dhtmlXGridObject.prototype.forEachRowInGroup=function(name,code){var row=this._groups[name].row.nextSibling;if(row){while(row&&!row._cntr){code.call(this,row.idd);row=row.nextSibling;}}else{var cs=this._groups[name]._childs;if(cs)
for(var i=0;i<cs.length;i++)
code.call(this,cs[i].idd);}};dhtmlXGridObject.prototype.updateGroups=function(){if(!this._gmask||!this._gmask._math||this._parsing)return;var r=this._gmask.childNodes;for(var i=0;i<r.length;i++)
if(r[i]._counter)this._b_processing.apply(this,r[i]._counter)}
dhtmlXGridObject.prototype._b_processing=function(a,ind,rind){var c=0,j=0;if(!this._ecache[this.cellType[ind]])this.cells5({parentNode:{grid:this}},this.cellType[ind]);for(var i=this.rowsCol.length-1;i>=0;i--){if(!this.rowsCol[i]._cntr){c=a(c,this.cells3(this.rowsCol[i],ind).getValue()*1,j);j++;}else{this.cells5(this.rowsCol[i].childNodes[rind],this.cellType[ind]).setValue(c);j=c=0;}}}
dhtmlXGridObject.prototype._g_stat_total=function(c,n,i){return c+n;}
dhtmlXGridObject.prototype._g_stat_min=function(c,n,i){if(!i)c=Infinity;return Math.min(c,n);}
dhtmlXGridObject.prototype._g_stat_max=function(c,n,i){if(!i)c=-Infinity;return Math.max(c,n);}
dhtmlXGridObject.prototype._g_stat_average=function(c,n,i){return(c*i+n)/(i+1);}
dhtmlXGridObject.prototype._g_stat_count=function(c,n,i){return++c;}
dhtmlXGridObject.prototype._in_header_collapse=function(t,i,c){var rt=t.tagName=="TD"?t:t.parentNode;i=rt._cellIndexS;if(!this._column_groups)this._column_groups=[];var cols=c[1].split(":")
var cols=c[1].split(":");cols=[cols.shift(),cols.join(':')];var count=parseInt(cols[0]);t.innerHTML=c[0]+"<img src='"+this.imgURL+"minus.gif' style='padding-right:10px;height:16px'/><span style='position:relative; top:-6px;'>"+(cols[1]||"")+"<span>";t.style.paddingBottom='0px';var self=this;this._column_groups[i]=t.getElementsByTagName("IMG")[0];this._column_groups[i].onclick=function(e){(e||event).cancelBubble=true;this._cstate=!this._cstate;for(var j=i+1;j<(i+count);j++)
self.setColumnHidden(j,this._cstate)
if(this._cstate){if(rt.colSpan&&rt.colSpan>0){rt._exp_colspan=rt.colSpan;var delta=Math.max(1,rt.colSpan-count)
if(!_isFF)
for(var z=0;z<rt.colSpan-delta;z++){var td=document.createElement("TD");if(rt.nextSibling)
rt.parentNode.insertBefore(td,rt.nextSibling);else
rt.parentNode.appendChild(td);}
rt.colSpan=delta;}
self.callEvent("onColumnCollapse",[i,this._cstate]);}else
if(rt._exp_colspan){rt.colSpan=rt._exp_colspan;if(!_isFF)
for(var z=1;z<rt._exp_colspan;z++)
rt.parentNode.removeChild(rt.nextSibling);self.callEvent("onColumnCollapse",[i,this._cstate]);}
this.src=self.imgURL+(this._cstate?"plus.gif":"minus.gif");if(self.sortImg.style.display!="none")
self.setSortImgPos();}}
dhtmlXGridObject.prototype.collapseColumns=function(ind){if(!this._column_groups[ind]||this._column_groups[ind]._cstate)return;this._column_groups[ind].onclick({});}
dhtmlXGridObject.prototype.expandColumns=function(ind){if(!this._column_groups[ind]||!this._column_groups[ind]._cstate)return;this._column_groups[ind].onclick({});}
dhtmlXGridObject.prototype.enableHeaderMenu=function(columns)
{if(!window.dhtmlXMenuObject)
return dhtmlx.message("You need to include DHTMLX Menu");if(!this._header_menu){var menu=this._header_menu=new dhtmlXMenuObject();menu.renderAsContextMenu();var that=this;menu.attachEvent("onBeforeContextMenu",function(){that._showHContext(columns);return true;});menu.attachEvent("onClick",function(id){var checked=this.getCheckboxState(id);var row=that.hdr.rows[1];for(var j=0;j<row.cells.length;j++){var c=row.cells[j];if(c._cellIndexS==id){var len=c.colSpan||1;for(var i=0;i<len;i++)
that.setColumnHidden(id*1+i,!checked);}}});this.attachEvent("onInit",function(){menu.addContextZone(this.hdr);});if(this.hdr.rows.length)this.callEvent("onInit",[]);}};dhtmlXGridObject.prototype.getHeaderMenu=function(columns)
{return this._header_menu;};dhtmlXGridObject.prototype._hideHContext=function(){if(this._header_menu)
this._header_menu.hide();};dhtmlXGridObject.prototype._showHContext=function(columns)
{if(typeof columns=="string")
columns=columns.split(this.delim);var true_ind=0;var j=0;this._header_menu.clearAll();for(var i=0;i<this.hdr.rows[1].cells.length;i++){var c=this.hdr.rows[1].cells[i];if(!columns||(columns[true_ind]&&columns[true_ind]!="false")){if(c.firstChild&&c.firstChild.tagName=="DIV")var val=c.firstChild.innerHTML;else var val=c.innerHTML;val=val.replace(/<[^>]*>/gi,"");var visible=!(this.isColumnHidden(true_ind)||(this.getColWidth(true_ind)==0));this._header_menu.addCheckbox("child",this._header_menu.topId,j,true_ind,val,visible);j++;}
true_ind+=(c.colSpan||1);}}
dhtmlXGridObject.prototype._process_json_row=function(r,data){r._attrs=data;for(var j=0;j<r.childNodes.length;j++)r.childNodes[j]._attrs={};if(data.userdata)
for(var a in data.userdata)
this.setUserData(r.idd,a,data.userdata[a]);data=this._c_order?this._swapColumns(data.data):data.data;for(var i=0;i<data.length;i++)
if(typeof data[i]=="object"&&data[i]!=null){r.childNodes[i]._attrs=data[i];if(data[i].type)r.childNodes[i]._cellType=data[i].type;data[i]=data[i].value;}
this._fillRow(r,data);return r;};dhtmlXGridObject.prototype._process_js_row=function(r,data){r._attrs=data;for(var j=0;j<r.childNodes.length;j++)
r.childNodes[j]._attrs={};if(data.userdata)
for(var a in data.userdata)
this.setUserData(r.idd,a,data.userdata[a]);var arr=[];for(var i=0;i<this.columnIds.length;i++){arr[i]=data[this.columnIds[i]];if(typeof arr[i]=="object"&&arr[i]!=null){r.childNodes[i]._attrs=arr[i];if(arr[i].type)r.childNodes[i]._cellType=arr[i].type;arr[i]=arr[i].value;}
if(!arr[i]&&arr[i]!==0)
arr[i]="";}
this._fillRow(r,arr);return r;};dhtmlXGridObject.prototype.updateFromJSON=function(url,insert_new,del_missed,afterCall){if(typeof insert_new=="undefined")
insert_new=true;this._refresh_mode=[true,insert_new,del_missed];this.load(url,afterCall,"json");},dhtmlXGridObject.prototype._refreshFromJSON=function(data){if(this._f_rowsBuffer)this.filterBy(0,"");reset=false;if(window.eXcell_tree){eXcell_tree.prototype.setValueX=eXcell_tree.prototype.setValue;eXcell_tree.prototype.setValue=function(content){var r=this.grid._h2.get[this.cell.parentNode.idd]
if(r&&this.cell.parentNode.valTag){this.setLabel(content);}else
this.setValueX(content);};}
var tree=this.cellType._dhx_find("tree");var pid=data.parent||0;var del={};if(this._refresh_mode[2]){if(tree!=-1)
this._h2.forEachChild(pid,function(obj){del[obj.id]=true;},this);else
this.forEachRow(function(id){del[id]=true;});}
var rows=data.rows;for(var i=0;i<rows.length;i++){var row=rows[i];var id=row.id;del[id]=false;if(this.rowsAr[id]&&this.rowsAr[id].tagName!="TR"){if(this._h2)
this._h2.get[id].buff.data=row;else
this.rowsBuffer[this.getRowIndex(id)].data=row;this.rowsAr[id]=row;}else if(this.rowsAr[id]){this._process_json_row(this.rowsAr[id],row,-1);this._postRowProcessing(this.rowsAr[id],true)}else if(this._refresh_mode[1]){var dadd={idd:id,data:row,_parser:this._process_json_row,_locator:this._get_json_data};var render_index=this.rowsBuffer.length;if(this._refresh_mode[1]=="top"){this.rowsBuffer.unshift(dadd);render_index=0;}else
this.rowsBuffer.push(dadd);if(this._h2){reset=true;(this._h2.add(id,pid)).buff=this.rowsBuffer[this.rowsBuffer.length-1];}
this.rowsAr[id]=row;row=this.render_row(render_index);this._insertRowAt(row,render_index?-1:0)}}
if(this._refresh_mode[2])
for(id in del){if(del[id]&&this.rowsAr[id])
this.deleteRow(id);}
this._refresh_mode=null;if(window.eXcell_tree)
eXcell_tree.prototype.setValue=eXcell_tree.prototype.setValueX;if(reset)this._renderSort();if(this._f_rowsBuffer){this._f_rowsBuffer=null;this.filterByAll();}},dhtmlXGridObject.prototype._process_js=function(data){return this._process_json(data,"js");},dhtmlXGridObject.prototype._parseHeadJson=function(json){if(!json.head||!json.head.length)return;var headCol=json.head;var settings=json.settings;var awidthmet="setInitWidths";var split=false;if(settings&&settings.colwidth=="%")
awidthmet="setInitWidthsP";if(settings&&settings.splitat=="%")
split=settings.splitat;if(this.hdr.rows.length>0)
this.clearAll(true);var sets=[[],[],[],[],[],[],[]];var attrs=["value","width","type","align","sort","hidden","id"];var calls=["",awidthmet,"setColTypes","setColAlign","setColSorting","","setColumnIds"];for(var i=0;i<headCol.length;i++)
for(var j=0;j<attrs.length;j++)
sets[j].push(headCol[i][attrs[j]]);this.setHeader(sets[0]);for(var i=0;i<calls.length;i++)
if(calls[i])
this[calls[i]](sets[i].join(this.delim));for(var i=0;i<headCol.length;i++){var options=headCol[i].options
if(headCol[i].options)
if(this.cellType[i]=="clist"){this.registerCList(i,options);}else{var combo=this.getCombo(i);for(var j=0;j<options.length;j++)
combo.put(options[j].id,options[j].value);}}
this.init();var param=sets[5].join(this.delim);if(this.setColHidden&&param.replace(/,/g,"")!="")
this.setColHidden(param);if((split)&&(this.splitAt))
this.splitAt(split);};dhtmlXGridObject.prototype._process_json=function(data,mode){this._parsing=true;try{var data=data.responseText||data;if(typeof data=="string"){eval("dhtmlx.temp="+data+";");data=dhtmlx.temp;}}catch(e){dhx4.callEvent("onLoadXMLError",["Incorrect JSON",(data.xmlDoc||data),this]);data={rows:[]};}
if(this._refresh_mode)return this._refreshFromJSON(data);if(data.head)
this._parseHeadJson(data);var cr=parseInt(data.pos||0);var total=parseInt(data.total_count||0);var reset=false;if(total){if(!this.rowsBuffer[total-1]){if(this.rowsBuffer.length)
reset=true;this.rowsBuffer[total-1]=null;}
if(total<this.rowsBuffer.length){this.rowsBuffer.splice(total,this.rowsBuffer.length-total);reset=true;}}
var userdata=mode==="js"?data.userdata:data;for(var key in userdata){if(mode==="js"||key!="rows")
this.setUserData("",key,userdata[key]);}
if(mode=="js"&&data.collections){for(var colkey in data.collections){var index=this.getColIndexById(colkey);var colrecs=data.collections[colkey];if(index!==window.undefined){if(this.cellType[index]=="clist"){colplaindata=[];for(var j=0;j<colrecs.length;j++)
colplaindata.push(colrecs[j].label);this.registerCList(index,colplaindata);}else{var combo=this.getCombo(index);for(var j=0;j<colrecs.length;j++)
combo.put(colrecs[j].value,colrecs[j].label);}}}}
if(this.isTreeGrid())
return this._process_tree_json(data,null,null,mode);if(mode=="js"){if(data.data)
data=data.data;for(var i=0;i<data.length;i++){if(this.rowsBuffer[i+cr])
continue;var row=data[i];var id=row.id||(i+1);this.rowsBuffer[i+cr]={idd:id,data:row,_parser:this._process_js_row,_locator:this._get_js_data};this.rowsAr[id]=data[i];}}else{for(var i=0;i<data.rows.length;i++){if(this.rowsBuffer[i+cr])
continue;var id=data.rows[i].id;this.rowsBuffer[i+cr]={idd:id,data:data.rows[i],_parser:this._process_json_row,_locator:this._get_json_data};this.rowsAr[id]=data.rows[i];}}
this.callEvent("onDataReady",[]);if(reset&&this._srnd){var h=this.objBox.scrollTop;this._reset_view();this.objBox.scrollTop=h;}else{this.render_dataset();}
this._parsing=false;}
dhtmlXGridObject.prototype._get_json_data=function(data,ind){if(typeof data.data[ind]=="object")
return data.data[ind].value;else
return data.data[ind];};dhtmlXGridObject.prototype._process_tree_json=function(data,top,pid,mode){this._parsing=true;var main=false;if(!top){this.render_row=this.render_row_tree;main=true;top=data;pid=top.parent||0;if(pid=="0")pid=0;if(!this._h2)this._h2=this._createHierarchy();if(this._fake)this._fake._h2=this._h2;}
if(mode=="js"){if(top.data&&!pid)
data=top.data;if(top.rows)
top=top.rows;for(var i=0;i<top.length;i++){var id=top[i].id;var row=this._h2.add(id,pid);row.buff={idd:id,data:top[i],_parser:this._process_js_row,_locator:this._get_js_data};if(top[i].open)
row.state="minus";this.rowsAr[id]=row.buff;this._process_tree_json(top[i],top[i],id,mode);}}else{if(top.rows){for(var i=0;i<top.rows.length;i++){var id=top.rows[i].id;var row=this._h2.add(id,pid);row.buff={idd:id,data:top.rows[i],_parser:this._process_json_row,_locator:this._get_json_data};if(top.rows[i].open)
row.state="minus";this.rowsAr[id]=row.buff;this._process_tree_json(top.rows[i],top.rows[i],id,mode);}}}
if(main){if(pid!=0)this._h2.change(pid,"state","minus")
this._updateTGRState(this._h2.get[pid]);this._h2_to_buff();this.callEvent("onDataReady",[]);if(pid!=0&&(this._srnd||this.pagingOn))
this._renderSort();else
this.render_dataset();if(this._slowParse===false){this.forEachRow(function(id){this.render_row_tree(0,id)})}
this._parsing=false;if(pid!=0&&!this._srnd)
this.callEvent("onOpenEnd",[pid,1]);}}
dhtmlXGridObject.prototype.enableMarkedCells=function(fl){this.markedRowsArr=new dhtmlxArray(0);this.markedCellsArr=new Array(0);this.lastMarkedRow=null;this.lastMarkedColumn=null;this.markedCells=true;this.lastMarkMethod=0;if(arguments.length>0){if(!dhx4.s2b(fl))
this.markedCells=false;}};dhtmlXGridObject.prototype.doMark=function(el,markMethod){var _rowId=el.parentNode.idd;this.setActive(true);if(!_rowId)return;this.editStop();this.cell=el;this.row=el.parentNode;var _cellIndex=el._cellIndex;if(!markMethod)markMethod=0;if(markMethod==0){this.unmarkAll();}
else if(markMethod==1){if(this.lastMarkedRow){var r_start=Math.min(this.getRowIndex(_rowId),this.getRowIndex(this.lastMarkedRow));var r_end=Math.max(this.getRowIndex(_rowId),this.getRowIndex(this.lastMarkedRow));var c_start=Math.min(_cellIndex,this.lastMarkedColumn);var c_end=Math.max(_cellIndex,this.lastMarkedColumn);for(var i=r_start;i<r_end+1;i++){for(var j=c_start;j<c_end+1;j++){this.mark(this.getRowId(i),j,true);}}}}
else if(markMethod==2){if(this.markedRowsArr._dhx_find(_rowId)!=-1){for(var ci=0;ci<this.markedCellsArr[_rowId].length;ci++){if(this.markedCellsArr[_rowId][ci]==_cellIndex){this.mark(_rowId,_cellIndex,false);return true;}}}}
if(!this.markedCellsArr[_rowId])
this.markedCellsArr[_rowId]=new dhtmlxArray(0);if(markMethod!=1)
this.mark(_rowId,_cellIndex);this.moveToVisible(this.cells(_rowId,_cellIndex).cell);this.lastMarkedRow=_rowId;this.lastMarkedColumn=_cellIndex;this.lastMarkMethod=markMethod;}
dhtmlXGridObject.prototype.mark=function(rid,cindex,fl){if(arguments.length>2){if(!dhx4.s2b(fl)){this.cells(rid,cindex).cell.className=this.cells(rid,cindex).cell.className.replace(/cellselected/g,"");if(this.markedRowsArr._dhx_find(rid)!=-1){var ci=this.markedCellsArr[rid]._dhx_find(cindex);if(ci!=-1){this.markedCellsArr[rid]._dhx_removeAt(ci);if(this.markedCellsArr[rid].length==0){this.markedRowsArr._dhx_removeAt(this.markedRowsArr._dhx_find(rid));}
this.callEvent("onCellUnMarked",[rid,cindex]);}}
return true;}}
this.cells(rid,cindex).cell.className+=" cellselected";if(this.markedRowsArr._dhx_find(rid)==-1)
this.markedRowsArr[this.markedRowsArr.length]=rid;if(!this.markedCellsArr[rid])
this.markedCellsArr[rid]=new dhtmlxArray(0);if(this.markedCellsArr[rid]._dhx_find(cindex)==-1){this.markedCellsArr[rid][this.markedCellsArr[rid].length]=cindex;this.callEvent("onCellMarked",[rid,cindex]);}}
dhtmlXGridObject.prototype.unmarkAll=function(){if(this.markedRowsArr){for(var ri=0;ri<this.markedRowsArr.length;ri++){var rid=this.markedRowsArr[ri];if(this.rowsAr[rid])
for(var ci=0;ci<this.markedCellsArr[rid].length;ci++){this.callEvent("onCellUnMarked",[rid,this.markedCellsArr[rid][ci]])
this.cells(rid,this.markedCellsArr[rid][ci]).cell.className=this.cells(rid,this.markedCellsArr[rid][ci]).cell.className.replace(/cellselected/g,"");}}
this.markedRowsArr=new dhtmlxArray(0);this.markedCellsArr=new Array(0);}
return true;}
dhtmlXGridObject.prototype.getMarked=function(){var marked=new Array();if(this.markedRowsArr)
for(var ri=0;ri<this.markedRowsArr.length;ri++){var rid=this.markedRowsArr[ri];for(var ci=0;ci<this.markedCellsArr[rid].length;ci++){marked[marked.length]=[rid,this.markedCellsArr[rid][ci]];}}
return marked;}
function eXcell_math(cell){if(cell){this.cell=cell;this.grid=this.cell.parentNode.grid;}
this.edit=function(){this.grid.editor=new eXcell_ed(this.cell);this.grid.editor.fix_self=true;this.grid.editor.getValue=this.cell.original?(function(){return this.cell.original}):this.getValue;this.grid.editor.setValue=this.setValue;this.grid.editor.edit();}
this.isDisabled=function(){return!this.grid._mathEdit;}
this.setValue=function(val){val=this.grid._compileSCL(val,this.cell,this.fix_self);if(this.grid._strangeParams[this.cell._cellIndex])
this.grid.cells5(this.cell,this.grid._strangeParams[this.cell._cellIndex]).setValue(val);else{this.setCValue(val);this.cell._clearCell=false;}}
this.getValue=function(){if(this.grid._strangeParams[this.cell._cellIndex])
return this.grid.cells5(this.cell,this.grid._strangeParams[this.cell._cellIndex]).getValue();return this.cell.innerHTML;}}
eXcell_math.prototype=new eXcell;dhx4.attachEvent("onGridCreated",function(grid){grid._reset_math();grid.attachEvent("onClearAll",grid._reset_math);grid.attachEvent("onCellChanged",function(id,ind){if(this._mat_links[id]){var cell=this._mat_links[id][ind];if(cell){for(var i=0;i<cell.length;i++)
if(cell[i].parentNode)
this.cells5(cell[i]).setValue(this._calcSCL(cell[i]));}}
if(!this._parsing&&this._aggregators[ind]){var pid=this._h2.get[id].parent.id;if(pid!=0){var ed=this.cells(pid,ind);ed.setValue(this._calcSCL(ed.cell));}}})
grid.attachEvent("onAfterRowDeleted",function(id,pid){if(pid!=0)
if(!this._parsing&&this._aggregators.length){for(var ind=0;ind<this._aggregators.length;ind++){if(this._aggregators[ind]){var ed=this.cells(pid,ind);ed.setValue(this._calcSCL(ed.cell));}};}
return true;})
grid.attachEvent("onXLE",grid._refresh_math);});dhtmlXGridObject.prototype._reset_math=function(){this._mat_links={};this._aggregators=[];};dhtmlXGridObject.prototype._refresh_math=function(){for(var i=0;i<this._aggregators.length;i++){if(this._aggregators[i])
this._h2.forEachChild(0,function(el){if(el.childs.length!=0){var ed=this.cells(el.id,i);ed.setValue(this._calcSCL(ed.cell));}},this);};};dhtmlXGridObject.prototype.refreshMath=function(status){this._mat_links={};for(var i=0;i<this.getColumnsNum();i++){if(this.getColType(i)=="math"){this.forEachRow(function(id){var cell=this.cells(id,i);cell.setValue(cell.cell.original||cell.getValue());});}}};dhtmlXGridObject.prototype.enableMathSerialization=function(status){this._mathSerialization=dhx4.s2b(status);}
dhtmlXGridObject.prototype.setMathRound=function(digits){this._roundDl=digits;this._roundD=Math.pow(10,digits);}
dhtmlXGridObject.prototype.enableMathEditing=function(status){this._mathEdit=dhx4.s2b(status);}
dhtmlXGridObject.prototype._calcSCL=function(cell){if(!cell._code)return this.cells5(cell).getValue();try{dhtmlx.agrid=this;var z=eval(cell._code);}catch(e){return("#SCL");}
if(this._roundD)
{var pre=Math.abs(z)<1?"0":"";if(z<0)pre="-"+pre;z=Math.round(Math.abs(z)*this._roundD).toString();if(z==0)return 0;if(this._roundDl>0){var n=z.length-this._roundDl;if(n<0){z=("000000000"+z).substring(9+n);n=0;}
return(pre+z.substring(0,n)+"."+z.substring(n,z.length));}
return pre+z;}
return z;}
dhtmlXGridObject.prototype._countTotal=function(row,cell){var b=0;var z=this._h2.get[row];for(var i=0;i<z.childs.length;i++){if(!z.childs[i].buff)return b;if(z.childs[i].buff._parser){b=0;this._h2.forEachChild(row,function(el){if(el.childs.length==0){var value=parseFloat(this._get_cell_value(el.buff,cell),10);if(value)
b+=value;}},this)
return b;}
var value=parseFloat(this._get_cell_value(z.childs[i].buff,cell),10);if(value)
b+=value;}
return b;}
dhtmlXGridObject.prototype._compileSCL=function(code,cell,fix){if(code===null||code===window.undefined)return code;code=code.toString();if(code.indexOf("=")!=0||!cell.parentNode){this._reLink([],cell);if(fix)cell._code=cell.original=null;return code;}
cell.original=code;var linked=null;code=code.replace("=","");if(code.indexOf("sum")!=-1){code=code.replace("sum","(dhtmlx.agrid._countTotal('"+cell.parentNode.idd+"',"+cell._cellIndex+"))");if(!this._aggregators)this._aggregators=[];this._aggregators[cell._cellIndex]="sum";cell._code=code;return this._parsing?"":this._calcSCL(cell);}
if(code.indexOf("[[")!=-1){var test=/(\[\[([^\,]*)\,([^\]]*)]\])/g;dhtmlx.agrid=this;linked=linked||(new Array());code=code.replace(test,function($0,$1,$2,$3){if($2=="-")
$2=cell.parentNode.idd;if($2.indexOf("#")==0)
$2=dhtmlx.agrid.getRowId($2.replace("#",""));linked[linked.length]=[$2,$3];return"(parseFloat(dhtmlx.agrid.cells(\""+$2+"\","+$3+").getValue(),10))";});}
if(code.indexOf(":")!=-1){var test=/:(\w+)/g;dhtmlx.agrid=this;var id=cell.parentNode.idd;linked=linked||(new Array());code=code.replace(test,function($0,$1,$2,$3){linked[linked.length]=[id,dhtmlx.agrid.getColIndexById($1)];return'(parseFloat(dhtmlx.agrid.cells("'+id+'",dhtmlx.agrid.getColIndexById("'+$1+'")).getValue(),10))';});}
else{var test=/c([0-9]+)/g;dhtmlx.agrid=this;var id=cell.parentNode.idd;linked=linked||(new Array());code=code.replace(test,function($0,$1,$2,$3){linked[linked.length]=[id,$1];return"(parseFloat(dhtmlx.agrid.cells(\""+id+"\","+$1+").getValue(),10))";});}
this._reLink(linked,cell);cell._code=code;return this._calcSCL(cell);}
dhtmlXGridObject.prototype._reLink=function(ar,cell){if(!ar.length)return;for(var i=0;i<ar.length;i++){if(!this._mat_links[ar[i][0]])this._mat_links[ar[i][0]]={};var t=this._mat_links[ar[i][0]];if(!t[ar[i][1]])t[ar[i][1]]=[];t[ar[i][1]].push(cell);}}
if(_isKHTML){(function(){var default_replace=String.prototype.replace;String.prototype.replace=function(search,replace){if(typeof replace!="function"){return default_replace.apply(this,arguments)}
var str=""+this;var callback=replace;if(!(search instanceof RegExp)){var idx=str.indexOf(search);return(idx==-1?str:default_replace.apply(str,[search,callback(search,idx,str)]))}
var reg=search;var result=[];var lastidx=reg.lastIndex;var re;while((re=reg.exec(str))!=null){var idx=re.index;var args=re.concat(idx,str);result.push(str.slice(lastidx,idx),callback.apply(null,args).toString());if(!reg.global){lastidx+=RegExp.lastMatch.length;break}else{lastidx=reg.lastIndex;}}
result.push(str.slice(lastidx));return result.join("")}})();}
dhtmlXGridObject.prototype.insertColumn=function(ind,header,type,width,sort,align,valign,reserved,columnColor){ind=parseInt(ind);if(ind>this._cCount)ind=this._cCount;if(!this._cMod)this._cMod=this._cCount;this._processAllArrays(this._cCount,ind-1,[(header||"&nbsp;"),(width||100),(type||"ed"),(align||"left"),(valign||""),(sort||"na"),(columnColor||""),"",this._cMod,(width||100)]);this._processAllRows("_addColInRow",ind);if(typeof(header)=="object")
for(var i=1;i<this.hdr.rows.length;i++){if(header[i-1]=="#rspan"){var pind=i-1;var found=false;var pz=null;while(!found){var pz=this.hdr.rows[pind];for(var j=0;j<pz.cells.length;j++)
if(pz.cells[j]._cellIndex==ind){found=j;break;}
pind--;}
this.hdr.rows[pind+1].cells[j].rowSpan=(this.hdr.rows[pind].cells[j].rowSpan||1)+1;}
else
this.setHeaderCol(ind,(header[i-1]||"&nbsp;"),i);}
else
this.setHeaderCol(ind,(header||"&nbsp;"));this.hdr.rows[0].cells[ind]
this._cCount++;this._cMod++;this._master_row=null;this.setSizes();}
dhtmlXGridObject.prototype.deleteColumn=function(ind){ind=parseInt(ind);if(this._cCount==0)return;if(!this._cMod)this._cMod=this._cCount;if(ind>=this._cCount)return;this._processAllArrays(ind,this._cCount-1,[null,null,null,null,null,null,null,null,null,null,null]);this._processAllRows("_deleteColInRow",ind);this._cCount--;this._master_row=null;this.setSizes();}
dhtmlXGridObject.prototype._processAllRows=function(method,oldInd,newInd){this[method](this.obj.rows[0],oldInd,newInd,0);var z=this.hdr.rows.length;for(var i=0;i<z;i++)
this[method](this.hdr.rows[i],oldInd,newInd,i);if(this.ftr){var z=this.ftr.firstChild.rows.length;for(var i=0;i<z;i++)
this[method](this.ftr.firstChild.rows[i],oldInd,newInd,i);}
this.forEachRow(function(id){if(this.rowsAr[id]&&this.rowsAr[id].tagName=="TR")
this[method](this.rowsAr[id],oldInd,newInd,-1);});}
dhtmlXGridObject.prototype._processAllArrays=function(oldInd,newInd,vals){var ars=["hdrLabels","initCellWidth","cellType","cellAlign","cellVAlign","fldSort","columnColor","_hrrar","_c_order"];if(this.cellWidthPX.length)ars.push("cellWidthPX");if(this.cellWidthPC.length)ars.push("cellWidthPC");if(this._col_combos)ars.push("_col_combos");if(this._mCols)ars[ars.length]="_mCols";if(this.columnIds)ars[ars.length]="columnIds";if(this._maskArr)ars.push("_maskArr");if(this._drsclmW)ars.push("_drsclmW");if(this._RaSeCol)ars.push("_RaSeCol");if(this._hm_config)ars.push("_hm_config");if(this._drsclmn)ars.push("_drsclmn");if(this.clists)ars.push("clists");if(this._validators&&this._validators.data)ars.push(this._validators.data);ars.push("combos");if(this._customSorts)ars.push("_customSorts");if(this._aggregators)ars.push("_aggregators");var mode=(oldInd<=newInd);if(!this._c_order){this._c_order=new Array();var l=this._cCount;for(var i=0;i<l;i++)
this._c_order[i]=i;}
for(var i=0;i<ars.length;i++)
{var t=this[ars[i]]||ars[i];if(t){if(mode){var val=t[oldInd];for(var j=oldInd;j<newInd;j++)
t[j]=t[j+1];t[newInd]=val;}else{var val=t[oldInd];for(var j=oldInd;j>(newInd+1);j--)
t[j]=t[j-1];t[newInd+1]=val;}
if(vals)
t[newInd+(mode?0:1)]=vals[i];}}}
dhtmlXGridObject.prototype.moveColumn=function(oldInd,newInd){newInd--;oldInd=parseInt(oldInd);newInd=parseInt(newInd);if(newInd<oldInd)var tInd=newInd+1;else var tInd=newInd;if(!this.callEvent("onBeforeCMove",[oldInd,tInd]))return false;if(oldInd==tInd)return;this.editStop();this._processAllRows("_moveColInRow",oldInd,newInd);this._processAllArrays(oldInd,newInd);if(this.fldSorted)
this.setSortImgPos(this.fldSorted._cellIndex);this.callEvent("onAfterCMove",[oldInd,tInd]);};dhtmlXGridObject.prototype._swapColumns=function(cols){var z=new Array();for(var i=0;i<this._cCount;i++){var n=cols[this._c_order[i]];if(typeof(n)=="undefined")n="";z[i]=n;}
return z;}
dhtmlXGridObject.prototype._moveColInRow=function(row,oldInd,newInd){var c=row.childNodes[oldInd];var ci=row.childNodes[newInd+1];if(!c)return;if(ci)
row.insertBefore(c,ci);else
row.appendChild(c);for(var i=0;i<row.childNodes.length;i++)
row.childNodes[i]._cellIndex=row.childNodes[i]._cellIndexS=i;};dhtmlXGridObject.prototype._addColInRow=function(row,ind,old,mod){var cind=ind;if(row._childIndexes){if(row._childIndexes[ind-1]==row._childIndexes[ind]||!row.childNodes[row._childIndexes[ind-1]]){for(var i=row._childIndexes.length;i>=ind;i--)
row._childIndexes[i]=i?(row._childIndexes[i-1]+1):0;row._childIndexes[ind]--;}
else
for(var i=row._childIndexes.length;i>=ind;i--)
row._childIndexes[i]=i?(row._childIndexes[i-1]+1):0;var cind=row._childIndexes[ind];}
var c=row.childNodes[cind];var z=document.createElement((mod)?"TD":"TH");if(mod){z._attrs={};}
else z.style.width=(parseInt(this.cellWidthPX[ind])||"100")+"px";if(c)
row.insertBefore(z,c);else
row.appendChild(z);if(this.dragAndDropOff&&row.idd)this.dragger.addDraggableItem(row.childNodes[cind],this);for(var i=cind+1;i<row.childNodes.length;i++){row.childNodes[i]._cellIndex=row.childNodes[i]._cellIndexS=row.childNodes[i]._cellIndex+1;}
if(row.childNodes[cind])row.childNodes[cind]._cellIndex=row.childNodes[cind]._cellIndexS=ind;if(row.idd||typeof(row.idd)!="undefined"){this.cells3(row,ind).setValue("");z.align=this.cellAlign[ind];z.style.verticalAlign=this.cellVAlign[ind];z.bgColor=this.columnColor[ind];}
else if(z.tagName=="TD"){if(!row.idd&&this.forceDivInHeader)z.innerHTML="<div class='hdrcell'>&nbsp;</div>";else z.innerHTML="&nbsp;";}};dhtmlXGridObject.prototype._deleteColInRow=function(row,ind){var aind=ind;if(row._childIndexes)ind=row._childIndexes[ind];var c=row.childNodes[ind];if(!c)return;if(c.colSpan&&c.colSpan>1&&c.parentNode.idd){var t=c.colSpan-1;var v=this.cells4(c).getValue();this.setColspan(c.parentNode.idd,c._cellIndex,1)
if(t>1){var cind=c._cellIndex*1;this.setColspan(c.parentNode.idd,cind+1,t)
this.cells(c.parentNode.idd,c._cellIndex*1+1).setValue(v)
row._childIndexes.splice(cind,1)
for(var i=cind;i<row._childIndexes.length;i++)
row._childIndexes[i]-=1;}}else if(row._childIndexes){row._childIndexes.splice(aind,1);for(var i=aind;i<row._childIndexes.length;i++)row._childIndexes[i]--;}
if(c)
row.removeChild(c);for(var i=ind;i<row.childNodes.length;i++)
row.childNodes[i]._cellIndex=row.childNodes[i]._cellIndexS=row.childNodes[i]._cellIndex-1;};dhtmlXGridObject.prototype.enableColumnMove=function(mode,columns){this._mCol=dhx4.s2b(mode);if(typeof(columns)!="undefined")
this._mCols=columns.split(",");if(!this._mmevTrue){dhtmlxEvent(this.hdr,"mousedown",this._startColumnMove);dhtmlxEvent(document.body,"mousemove",this._onColumnMove);dhtmlxEvent(document.body,"mouseup",this._stopColumnMove);this._mmevTrue=true;}};dhtmlXGridObject.prototype._startColumnMove=function(e){e=e||event;var el=e.target||e.srcElement;var zel=el;while(zel.tagName!="TABLE")zel=zel.parentNode;var grid=zel.grid;if(!grid)return;grid.setActive();if(!grid._mCol||e.button==2)return;el=grid.getFirstParentOfType(el,"TD")
if(el.style.cursor!="default")return true;if((grid)&&(!grid._colInMove)){grid.resized=null;if((!grid._mCols)||(grid._mCols[el._cellIndex]=="true"))
grid._colInMove=el._cellIndex+1;}
grid._colInMovePos={x:e.clientX,y:e.clientY};return true;};dhtmlXGridObject.prototype._onColumnMove=function(e){e=e||event;var grid=window.globalActiveDHTMLGridObject;if((grid)&&(grid._colInMove)){var diff=Math.max(Math.abs(e.clientX-grid._colInMovePos.x),Math.abs(e.clientY-grid._colInMovePos.y));if(diff<20)return;if(grid._hideHContext)grid._hideHContext();if(typeof(grid._colInMove)!="object"){var z=document.createElement("DIV");z._aIndex=(grid._colInMove-1);z._bIndex=null;z.innerHTML=grid.getHeaderCol(z._aIndex);z.className="dhx_dragColDiv";z.style.position="absolute";document.body.appendChild(z);grid._colInMove=z;}
var cor=[];cor[0]=(document.body.scrollLeft||document.documentElement.scrollLeft);cor[1]=(document.body.scrollTop||document.documentElement.scrollTop);grid._colInMove.style.left=e.clientX+cor[0]+8+"px";grid._colInMove.style.top=e.clientY+cor[1]+8+"px";var el=e.target||e.srcElement;while((el)&&(typeof(el._cellIndexS)=="undefined"))
el=el.parentNode;if(grid._colInMove._oldHe){grid._colInMove._oldHe.className=grid._colInMove._oldHe.className.replace(/columnTarget(L|R)/g,"");grid._colInMove._oldHe=null;grid._colInMove._bIndex=null;}
if(el){if(grid.hdr.rows[1]._childIndexes)
var he=grid.hdr.rows[1].cells[grid.hdr.rows[1]._childIndexes[el._cellIndexS]];else
var he=grid.hdr.rows[1].cells[el._cellIndexS];var z=e.clientX-(dhx4.absLeft(he)-grid.hdrBox.scrollLeft);if(z/he.offsetWidth>0.5){he.className+=" columnTargetR";grid._colInMove._bIndex=el._cellIndexS;}
else{he.className+=" columnTargetL";grid._colInMove._bIndex=el._cellIndexS-1;}
if(he.offsetLeft<(grid.objBox.scrollLeft+20))
grid.objBox.scrollLeft=Math.max(0,he.offsetLeft-20);if((he.offsetLeft+he.offsetWidth-grid.objBox.scrollLeft)>(grid.objBox.offsetWidth-20))
grid.objBox.scrollLeft=Math.min(grid.objBox.scrollLeft+he.offsetWidth+20,grid.objBox.scrollWidth-grid.objBox.offsetWidth);grid._colInMove._oldHe=he;}
e.cancelBubble=true;return false;}
return true;};dhtmlXGridObject.prototype._stopColumnMove=function(e){e=e||event;var grid=window.globalActiveDHTMLGridObject;if((grid)&&(grid._colInMove)){if(typeof(grid._colInMove)=="object"){grid._colInMove.parentNode.removeChild(grid._colInMove);if(grid._colInMove._bIndex!=null)
grid.moveColumn(grid._colInMove._aIndex,grid._colInMove._bIndex+1);if(grid._colInMove._oldHe)
grid._colInMove._oldHe.className=grid._colInMove._oldHe.className.replace(/columnTarget(L|R)/g,"");grid._colInMove._oldHe=null;grid._colInMove.grid=null;grid.resized=true;}
grid._colInMove=0;}
return true;};dhtmlXGridObject.prototype.mouseOverHeader=function(func){var self=this;dhtmlxEvent(this.hdr,"mousemove",function(e){e=e||window.event;var el=e.target||e.srcElement;if(el.tagName!="TD")
el=self.getFirstParentOfType(el,"TD")
if(el&&(typeof(el._cellIndex)!="undefined"))
func(el.parentNode.rowIndex,el._cellIndex);});}
dhtmlXGridObject.prototype.mouseOver=function(func){var self=this;dhtmlxEvent(this.obj,"mousemove",function(e){e=e||window.event;var el=e.target||e.srcElement;if(el.tagName!="TD")
el=self.getFirstParentOfType(el,"TD")
if(el&&(typeof(el._cellIndex)!="undefined"))
func(el.parentNode.rowIndex,el._cellIndex);});}
dhtmlXGridObject.prototype.enablePaging=function(fl,pageSize,pagesInGrp,parentObj,showRecInfo,recInfoParentObj){this._pgn_parentObj=typeof(parentObj)=="string"?document.getElementById(parentObj):parentObj;this._pgn_recInfoParentObj=typeof(recInfoParentObj)=="string"?document.getElementById(recInfoParentObj):recInfoParentObj;this.pagingOn=fl;this.showRecInfo=showRecInfo;this.rowsBufferOutSize=parseInt(pageSize);this.currentPage=1;this.pagesInGroup=parseInt(pagesInGrp);this._init_pgn_events()
this.setPagingSkin("default");}
dhtmlXGridObject.prototype.setXMLAutoLoading=function(filePath,bufferSize){this.xmlFileUrl=filePath;this._dpref=bufferSize;}
dhtmlXGridObject.prototype.changePageRelative=function(ind){this.changePage(this.currentPage+ind);}
dhtmlXGridObject.prototype.changePage=function(pageNum){if(arguments.length==0)pageNum=this.currentPage||0;pageNum=parseInt(pageNum);pageNum=Math.max(1,Math.min(pageNum,Math.ceil(this.rowsBuffer.length/this.rowsBufferOutSize)));if(!this.callEvent("onBeforePageChanged",[this.currentPage,pageNum]))
return;this.currentPage=parseInt(pageNum);this._reset_view();this._fixAlterCss();this.callEvent("onPageChanged",this.getStateOfView());}
dhtmlXGridObject.prototype.setPagingSkin=function(name){this._pgn_skin=this["_pgn_"+name];if(name=="toolbar")this._pgn_skin_tlb=arguments[1];}
dhtmlXGridObject.prototype.setPagingTemplates=function(a,b){this._pgn_templateA=this._pgn_template_compile(a);this._pgn_templateB=this._pgn_template_compile(b);this._page_skin_update();}
dhtmlXGridObject.prototype._page_skin_update=function(name){if(!this.pagesInGroup)this.pagesInGroup=Math.ceil(Math.min(5,this.rowsBuffer.length/this.rowsBufferOutSize));var totalPages=Math.ceil(this.rowsBuffer.length/this.rowsBufferOutSize);if(totalPages&&totalPages<this.currentPage)
return this.changePage(totalPages);if(this.pagingOn&&this._pgn_skin)this._pgn_skin.apply(this,this.getStateOfView());}
dhtmlXGridObject.prototype._init_pgn_events=function(name){this.attachEvent("onXLE",this._page_skin_update)
this.attachEvent("onClearAll",this._page_skin_update)
this.attachEvent("onPageChanged",this._page_skin_update)
this.attachEvent("onGridReconstructed",this._page_skin_update)
this._init_pgn_events=function(){};}
dhtmlXGridObject.prototype._pgn_default=function(page,start,end){if(!this.pagingBlock){this.pagingBlock=document.createElement("DIV");this.pagingBlock.className="pagingBlock";this.recordInfoBlock=document.createElement("SPAN");this.recordInfoBlock.className="recordsInfoBlock";if(!this._pgn_parentObj)return;this._pgn_parentObj.appendChild(this.pagingBlock)
if(this._pgn_recInfoParentObj&&this.showRecInfo)
this._pgn_recInfoParentObj.appendChild(this.recordInfoBlock)
if(!this._pgn_templateA){this._pgn_templateA=this._pgn_template_compile("[prevpages:&lt;:&nbsp;] [currentpages:,&nbsp;] [nextpages:&gt;:&nbsp;]");this._pgn_templateB=this._pgn_template_compile("Results <b>[from]-[to]</b> of <b>[total]</b>");}}
var details=this.getStateOfView();this.pagingBlock.innerHTML=this._pgn_templateA.apply(this,details);this.recordInfoBlock.innerHTML=this._pgn_templateB.apply(this,details);this._pgn_template_active(this.pagingBlock);this._pgn_template_active(this.recordInfoBlock);this.callEvent("onPaging",[]);}
dhtmlXGridObject.prototype._pgn_block=function(sep){var start=Math.floor((this.currentPage-1)/this.pagesInGroup)*this.pagesInGroup;var max=Math.min(Math.ceil(this.rowsBuffer.length/this.rowsBufferOutSize),start+this.pagesInGroup);var str=[];for(var i=start+1;i<=max;i++)
if(i==this.currentPage)
str.push("<a class='dhx_not_active'><b>"+i+"</b></a>");else
str.push("<a onclick='this.grid.changePage("+i+"); return false;'>"+i+"</a>");return str.join(sep);}
dhtmlXGridObject.prototype._pgn_link=function(mode,ac,ds){if(mode=="prevpages"||mode=="prev"){if(this.currentPage==1)return ds;return'<a onclick=\'this.grid.changePageRelative(-1*'+(mode=="prev"?'1':'this.grid.pagesInGroup')+'); return false;\'>'+ac+'</a>'}
if(mode=="nextpages"||mode=="next"){if(this.rowsBuffer.length/this.rowsBufferOutSize<=this.currentPage)return ds;if(this.rowsBuffer.length/(this.rowsBufferOutSize*(mode=="next"?'1':this.pagesInGroup))<=1)return ds;return'<a onclick=\'this.grid.changePageRelative('+(mode=="next"?'1':'this.grid.pagesInGroup')+'); return false;\'>'+ac+'</a>'}
if(mode=="current"){var i=this.currentPage+(ac?parseInt(ac):0);if(i<1||Math.ceil(this.rowsBuffer.length/this.rowsBufferOutSize)<i)return ds;return'<a '+(i==this.currentPage?"class='dhx_active_page_link' ":"")+'onclick=\'this.grid.changePage('+i+'); return false;\'>'+i+'</a>'}
return ac;}
dhtmlXGridObject.prototype._pgn_template_active=function(block){var tags=block.getElementsByTagName("A");if(tags)
for(var i=0;i<tags.length;i++){tags[i].grid=this;};}
dhtmlXGridObject.prototype._pgn_template_compile=function(template){template=template.replace(/\[([^\]]*)\]/g,function(a,b){b=b.split(":");switch(b[0]){case"from":return'"+(arguments[1]*1+(arguments[2]*1?1:0))+"';case"total":return'"+arguments[3]+"';case"to":return'"+arguments[2]+"';case"current":case"prev":case"next":case"prevpages":case"nextpages":return'"+this._pgn_link(\''+b[0]+'\',\''+b[1]+'\',\''+b[2]+'\')+"'
case"currentpages":return'"+this._pgn_block(\''+b[1]+'\')+"'}})
return new Function('return "'+template+'";')}
dhtmlXGridObject.prototype.i18n.paging={results:"Results",records:"Records from ",to:" to ",page:"Page ",perpage:"rows per page",first:"To first Page",previous:"Previous Page",found:"Found records",next:"Next Page",last:"To last Page",of:" of ",notfound:"No Records Found"}
dhtmlXGridObject.prototype.setPagingWTMode=function(navButtons,navLabel,pageSelect,perPageSelect){this._WTDef=[navButtons,navLabel,pageSelect,perPageSelect];}
dhtmlXGridObject.prototype._pgn_bricks=function(page,start,end){var tmp=(this.skin_name||"").split("_")[1];var sfx="";if(tmp=="light"||tmp=="modern"||tmp=="skyblue")
sfx="_"+tmp;this.pagerElAr=new Array();this.pagerElAr["pagerCont"]=document.createElement("DIV");this.pagerElAr["pagerBord"]=document.createElement("DIV");this.pagerElAr["pagerLine"]=document.createElement("DIV");this.pagerElAr["pagerBox"]=document.createElement("DIV");this.pagerElAr["pagerInfo"]=document.createElement("DIV");this.pagerElAr["pagerInfoBox"]=document.createElement("DIV");var se=(this.globalBox||this.objBox);this.pagerElAr["pagerCont"].style.width=se.clientWidth+"px";this.pagerElAr["pagerCont"].style.overflow="hidden";this.pagerElAr["pagerCont"].style.clear="both";this.pagerElAr["pagerBord"].className="dhx_pbox"+sfx;this.pagerElAr["pagerLine"].className="dhx_pline"+sfx;this.pagerElAr["pagerBox"].style.clear="both";this.pagerElAr["pagerInfo"].className="dhx_pager_info"+sfx;this.pagerElAr["pagerCont"].appendChild(this.pagerElAr["pagerBord"]);this.pagerElAr["pagerCont"].appendChild(this.pagerElAr["pagerLine"]);this.pagerElAr["pagerCont"].appendChild(this.pagerElAr["pagerInfo"]);this.pagerElAr["pagerLine"].appendChild(this.pagerElAr["pagerBox"]);this.pagerElAr["pagerInfo"].appendChild(this.pagerElAr["pagerInfoBox"]);this._pgn_parentObj.innerHTML="";this._pgn_parentObj.appendChild(this.pagerElAr["pagerCont"]);if(this.rowsBuffer.length>0){var lineWidth=20;var lineWidthInc=22;if(page>this.pagesInGroup){var pageCont=document.createElement("DIV");var pageBox=document.createElement("DIV");pageCont.className="dhx_page"+sfx;pageBox.innerHTML="&larr;";pageCont.appendChild(pageBox);this.pagerElAr["pagerBox"].appendChild(pageCont);var self=this;pageCont.pgnum=(Math.ceil(page/this.pagesInGroup)-1)*this.pagesInGroup;pageCont.onclick=function(){self.changePage(this.pgnum);}
lineWidth+=lineWidthInc;}
for(var i=1;i<=this.pagesInGroup;i++){var pageCont=document.createElement("DIV");var pageBox=document.createElement("DIV");pageCont.className="dhx_page"+sfx;pageNumber=((Math.ceil(page/this.pagesInGroup)-1)*this.pagesInGroup)+i;if(pageNumber>Math.ceil(this.rowsBuffer.length/this.rowsBufferOutSize))
break;pageBox.innerHTML=pageNumber;pageCont.appendChild(pageBox);if(page==pageNumber){pageCont.className+=" dhx_page_active"+sfx;pageBox.className="dhx_page_active"+sfx;}else{var self=this;pageCont.pgnum=pageNumber;pageCont.onclick=function(){self.changePage(this.pgnum);}}
lineWidth+=(parseInt(lineWidthInc/3)*pageNumber.toString().length)+15;pageBox.style.width=(parseInt(lineWidthInc/3)*pageNumber.toString().length)+8+"px";this.pagerElAr["pagerBox"].appendChild(pageCont);}
if(Math.ceil(page/this.pagesInGroup)*this.pagesInGroup<Math.ceil(this.rowsBuffer.length/this.rowsBufferOutSize)){var pageCont=document.createElement("DIV");var pageBox=document.createElement("DIV");pageCont.className="dhx_page"+sfx;pageBox.innerHTML="&rarr;";pageCont.appendChild(pageBox);this.pagerElAr["pagerBox"].appendChild(pageCont);var self=this;pageCont.pgnum=(Math.ceil(page/this.pagesInGroup)*this.pagesInGroup)+1;pageCont.onclick=function(){self.changePage(this.pgnum);}
lineWidth+=lineWidthInc;}
this.pagerElAr["pagerLine"].style.width=lineWidth+"px";}
if(this.rowsBuffer.length>0&&this.showRecInfo)
this.pagerElAr["pagerInfoBox"].innerHTML=this.i18n.paging.records+(start+1)+this.i18n.paging.to+end+this.i18n.paging.of+this.rowsBuffer.length;else if(this.rowsBuffer.length==0){this.pagerElAr["pagerLine"].parentNode.removeChild(this.pagerElAr["pagerLine"]);this.pagerElAr["pagerInfoBox"].innerHTML=this.i18n.paging.notfound;}
this.pagerElAr["pagerBox"].appendChild(document.createElement("SPAN")).innerHTML="&nbsp;";this.pagerElAr["pagerBord"].appendChild(document.createElement("SPAN")).innerHTML="&nbsp;";this.pagerElAr["pagerCont"].appendChild(document.createElement("SPAN")).innerHTML="&nbsp;";this.callEvent("onPaging",[]);}
dhtmlXGridObject.prototype._pgn_toolbar=function(page,start,end){if(!this.aToolBar)this.aToolBar=this._pgn_createToolBar();var totalPages=Math.ceil(this.rowsBuffer.length/this.rowsBufferOutSize);if(this._WTDef[0]){this.aToolBar.enableItem("right");this.aToolBar.enableItem("rightabs");this.aToolBar.enableItem("left");this.aToolBar.enableItem("leftabs");if(this.currentPage>=totalPages){this.aToolBar.disableItem("right");this.aToolBar.disableItem("rightabs");}
if(this.currentPage==1){this.aToolBar.disableItem("left");this.aToolBar.disableItem("leftabs");}}
if(this._WTDef[2]){var that=this;this.aToolBar.forEachListOption("pages",function(id){that.aToolBar.removeListOption("pages",id);});var w={dhx_skyblue:4,dhx_web:0,dhx_terrace:14}[this.aToolBar.conf.skin];for(var i=0;i<totalPages;i++){this.aToolBar.addListOption("pages","pages_"+(i+1),NaN,"button","<span style='padding: 0px "+w+"px 0px 0px;'>"+this.i18n.paging.page+(i+1)+"</span>","paging_page.gif");}
this.aToolBar.setItemText("pages",this.i18n.paging.page+page);}
if(this._WTDef[1]){if(!this.getRowsNum())
this.aToolBar.setItemText('results',this.i18n.paging.notfound);else
this.aToolBar.setItemText('results',"<div style='width:100%; text-align:center'>"+this.i18n.paging.records+(start+1)+this.i18n.paging.to+end+"</div>");}
if(this._WTDef[3])
this.aToolBar.setItemText("perpagenum",this.rowsBufferOutSize.toString()+" "+this.i18n.paging.perpage);this.callEvent("onPaging",[]);}
dhtmlXGridObject.prototype._pgn_createToolBar=function(){this.aToolBar=new dhtmlXToolbarObject({parent:this._pgn_parentObj,skin:(this._pgn_skin_tlb||this.skin_name),icons_path:this.imgURL});if(!this._WTDef)this.setPagingWTMode(true,true,true,true);var self=this;this.aToolBar.attachEvent("onClick",function(val){val=val.split("_");switch(val[0]){case"leftabs":self.changePage(1);break;case"left":self.changePage(self.currentPage-1);break;case"rightabs":self.changePage(99999);break;case"right":self.changePage(self.currentPage+1);break;case"perpagenum":if(val[1]===this.undefined)return;self.rowsBufferOutSize=parseInt(val[1]);self.changePage();self.aToolBar.setItemText("perpagenum",val[1]+" "+self.i18n.paging.perpage);break;case"pages":if(val[1]===this.undefined)return;self.changePage(val[1]);self.aToolBar.setItemText("pages",self.i18n.paging.page+val[1]);break;}});if(this._WTDef[0]){this.aToolBar.addButton("leftabs",NaN,null,"ar_left_abs.gif","ar_left_abs_dis.gif");this.aToolBar.addButton("left",NaN,null,"ar_left.gif","ar_left_dis.gif");}
if(this._WTDef[1]){this.aToolBar.addText("results",NaN,this.i18n.paging.results);this.aToolBar.setWidth("results","150");this.aToolBar.disableItem("results");}
if(this._WTDef[0]){this.aToolBar.addButton("right",NaN,null,"ar_right.gif","ar_right_dis.gif");this.aToolBar.addButton("rightabs",NaN,null,"ar_right_abs.gif","ar_right_abs_dis.gif");}
if(this._WTDef[2]){if(this.aToolBar.conf.skin=="dhx_terrace")this.aToolBar.addSeparator();this.aToolBar.addButtonSelect("pages",NaN,"select page",[],"paging_pages.gif",null,false,true);}
var arr;if(arr=this._WTDef[3]){if(this.aToolBar.conf.skin=="dhx_terrace")this.aToolBar.addSeparator();this.aToolBar.addButtonSelect("perpagenum",NaN,"select size",[],"paging_rows.gif",null,false,true);if(typeof arr!="object")arr=[5,10,15,20,25,30];var w={dhx_skyblue:4,dhx_web:0,dhx_terrace:18}[this.aToolBar.conf.skin];for(var k=0;k<arr.length;k++){this.aToolBar.addListOption("perpagenum","perpagenum_"+arr[k],NaN,"button","<span style='padding: 0px "+w+"px 0px 0px;'>"+arr[k]+" "+this.i18n.paging.perpage+"</span>","paging_page.gif");}}
return this.aToolBar;}
dhtmlXGridObject.prototype.post=function(url,post,call,type){this.callEvent("onXLS",[this]);if(arguments.length==2&&typeof call!="function"){type=call;call=null;}
type=type||"xml";if(!this.xmlFileUrl)
this.xmlFileUrl=url;this._data_type=type;this.xmlLoader=this.doLoadDetails;var that=this;this.xmlLoader=function(xml){if(!that.callEvent)return;that["_process_"+type](xml.xmlDoc);if(!that._contextCallTimer)
that.callEvent("onXLE",[that,0,0,xml.xmlDoc]);if(call){call();call=null;}};dhx4.ajax.post(url,(post||""),this.xmlLoader);}
dhtmlXGridObject.prototype.setRowspan=function(rowID,colInd,length){var c=this[this._bfs_cells?"_bfs_cells":"cells"](rowID,colInd).cell;var r=this.rowsAr[rowID];if(c.rowSpan&&c.rowSpan!=1){var ur=r.nextSibling;for(var i=1;i<c.rowSpan;i++){var tc=ur.childNodes[ur._childIndexes[c._cellIndex+1]]
var ti=document.createElement("TD");ti.innerHTML="&nbsp;";ti._cellIndex=c._cellIndex;ti._clearCell=true;if(tc)
tc.parentNode.insertBefore(ti,tc);else
ur.parentNode.appendChild(ti);this._shiftIndexes(ur,c._cellIndex,-1);ur=ur.nextSibling;}}
c.rowSpan=length;if(!this._h2)
r=r.nextSibling||this.rowsCol[this.rowsCol._dhx_find(r)+1];else
r=this.rowsAr[this._h2.get[r.idd].parent.childs[this._h2.get[r.idd].index+1].id];var kids=[];for(var i=1;i<length;i++){var ct=null;if(this._fake&&!this._realfake)
ct=this._bfs_cells3(r,colInd).cell;else
ct=this.cells3(r,colInd).cell;this._shiftIndexes(r,c._cellIndex,1);if(ct)
ct.parentNode.removeChild(ct);kids.push(r);if(!this._h2)
r=r.nextSibling||this.rowsCol[this.rowsCol._dhx_find(r)+1];else{var r=this._h2.get[r.idd].parent.childs[this._h2.get[r.idd].index+1];if(r)r=this.rowsAr[r.id];}}
this.rowsAr[rowID]._rowSpan=this.rowsAr[rowID]._rowSpan||{};this.rowsAr[rowID]._rowSpan[colInd]=kids;if(this._fake&&!this._realfake&&colInd<this._fake._cCount)
this._fake.setRowspan(rowID,colInd,length)}
dhtmlXGridObject.prototype._shiftIndexes=function(r,pos,ind){if(!r._childIndexes){r._childIndexes=new Array();for(var z=0;z<r.childNodes.length;z++)
r._childIndexes[z]=z;}
for(var z=0;z<r._childIndexes.length;z++)
if(z>pos)
r._childIndexes[z]=r._childIndexes[z]-ind;}
dhtmlXGridObject.prototype.enableRowspan=function(){this._erspan=true;this.enableRowspan=function(){};this.attachEvent("onAfterSorting",function(){if(this._dload)return;for(var i=1;i<this.obj.rows.length;i++)
if(this.obj.rows[i]._rowSpan){var master=this.obj.rows[i];for(var kname in master._rowSpan){var row=master;var kids=row._rowSpan[kname];for(var j=0;j<kids.length;j++){if(row.nextSibling)
row.parentNode.insertBefore(kids[j],row.nextSibling);else
row.parentNode.appendChild(kids[j]);if(this._fake){var frow=this._fake.rowsAr[row.idd];var fkid=this._fake.rowsAr[kids[j].idd];if(frow.nextSibling)
frow.parentNode.insertBefore(fkid,frow.nextSibling);else
frow.parentNode.appendChild(fkid);this._correctRowHeight(row.idd);}
row=row.nextSibling;}}}
var t=this.rowsCol.stablesort;this.rowsCol=new dhtmlxArray();this.rowsCol.stablesort=t;for(var i=1;i<this.obj.rows.length;i++)
this.rowsCol.push(this.obj.rows[i]);})
this.attachEvent("onXLE",function(a,b,c,xml){for(var i=0;i<this.rowsBuffer.length;i++){var row=this.render_row(i);var childs=row.childNodes;for(var j=0;j<childs.length;j++){if(childs[j]._attrs["rowspan"]){this.setRowspan(row.idd,childs[j]._cellIndex,childs[j]._attrs["rowspan"]);}}}});}
dhx4.attachEvent("onGridCreated",function(grid){if(grid._split_later)
grid.splitAt(grid._split_later);});dhtmlXGridObject.prototype.splitAt=function(ind){if(!this.obj.rows[0])return this._split_later=ind;ind=parseInt(ind);var leftBox=document.createElement("DIV");this.entBox.appendChild(leftBox);var rightBox=document.createElement("DIV");this.entBox.appendChild(rightBox);for(var i=this.entBox.childNodes.length-3;i>=0;i--)
rightBox.insertBefore(this.entBox.childNodes[i],rightBox.firstChild);this.entBox.style.position="relative";this.globalBox=this.entBox;this.entBox=rightBox;rightBox.grid=this;leftBox.style.cssText+="border:0px solid red !important;";rightBox.style.cssText+="border:0px solid red !important;";rightBox.style.top="0px";rightBox.style.position="absolute";leftBox.style.position="absolute";leftBox.style.top="0px";leftBox.style.left="0px";leftBox.style.zIndex=11;rightBox.style.height=leftBox.style.height=this.globalBox.clientHeight;this._fake=new dhtmlXGridObject(leftBox);this.globalBox=this._fake.globalBox=this.globalBox;this._fake._fake=this;this._fake._realfake=true;this._treeC=this.cellType._dhx_find("tree");this._fake.delim=this.delim;this._fake.customGroupFormat=this.customGroupFormat;this._fake.setImagesPath(this._imgURL);this._fake.iconURL=this.iconURL;this._fake._customSorts=this._customSorts;this._fake.noHeader=this.noHeader;this._fake._enbTts=this._enbTts;this._fake._drsclmW=this._drsclmW;this._fake._htkebl=this._htkebl;this._fake.clists=this.clists;this._fake.fldSort=new Array();this._fake.selMultiRows=this.selMultiRows;this._fake.multiLine=this.multiLine;this._fake._key_events=this._key_events;this._fake.smartTabOrder=this.smartTabOrder;this._fake._RaSeCol=this._RaSeCol;if(this.multiLine||this._erspan){this.attachEvent("onCellChanged",this._correctRowHeight);this.attachEvent("onRowAdded",this._correctRowHeight);var corrector=function(){this.forEachRow(function(id){this._correctRowHeight(id);})};this.attachEvent("onPageChanged",corrector);this.attachEvent("onXLE",corrector);this.attachEvent("onResizeEnd",corrector);if(!this._ads_count)
this.attachEvent("onAfterSorting",corrector);if(this._srnd)
this.attachEvent("onFilterEnd",corrector);this.attachEvent("onDistributedEnd",corrector);}
this.attachEvent("onGridReconstructed",function(){this._fake.objBox.scrollTop=this.objBox.scrollTop;})
this._fake.loadedKidsHash=this.loadedKidsHash;if(this._h2)this._fake._h2=this._h2;this._fake._dInc=this._dInc;var b_ha=[[],[],[],[],[],[],[]];var b_ar=["hdrLabels","initCellWidth","cellType","cellAlign","cellVAlign","fldSort","columnColor"];var b_fu=["setHeader","setInitWidths","setColTypes","setColAlign","setColVAlign","setColSorting","setColumnColor"];this._fake.callEvent=function(){var result=true;this._fake._split_event=true;var hidden=(arguments[0]=="onScroll");if(arguments[0]=="onGridReconstructed"||hidden)
this._fake.callEvent.apply(this,arguments);if(!hidden)result=this._fake.callEvent.apply(this._fake,arguments);this._fake._split_event=false;return result;}
if(this._elmn)
this._fake.enableLightMouseNavigation(true);if(this._cssEven||this._cssUnEven)
this._fake.attachEvent("onGridReconstructed",function(){this._fixAlterCss();});this._fake._cssSP=this._cssSP;this._fake.isEditable=this.isEditable;this._fake._edtc=this._edtc;if(this._sst)this._fake.enableStableSorting(true);this._fake._sclE=this._sclE;this._fake._dclE=this._dclE;this._fake._f2kE=this._f2kE;this._fake._maskArr=this._maskArr;this._fake._dtmask=this._dtmask;this._fake.combos=this.combos;var width=0;var m_w=this.globalBox.offsetWidth;for(var i=0;i<ind;i++){for(var j=0;j<b_ar.length;j++){if(this[b_ar[j]])
b_ha[j][i]=this[b_ar[j]][i];if(typeof b_ha[j][i]=="string")b_ha[j][i]=b_ha[j][i].replace(new RegExp("\\"+this.delim,"g"),"\\"+this.delim);}
if(_isFF)b_ha[1][i]=b_ha[1][i]*1;if(this.cellWidthType=="%"){b_ha[1][i]=Math.round(parseInt(this[b_ar[1]][i])*m_w/100);width+=b_ha[1][i];}else
width+=parseInt(this[b_ar[1]][i]);this.setColumnHidden(i,true);}
for(var j=0;j<b_ar.length;j++){var str=b_ha[j].join(this.delim);if(b_fu[j]!="setHeader"){if(str!="")
this._fake[b_fu[j]](str);}else
this._fake[b_fu[j]](str,null,this._hstyles);}
this._fake._strangeParams=this._strangeParams;this._fake._drsclmn=this._drsclmn;width=Math.min(this.globalBox.offsetWidth,width);rightBox.style.left=width+"px";leftBox.style.width=width+"px";rightBox.style.width=Math.max(this.globalBox.offsetWidth-width,0);if(this._ecspn)this._fake._ecspn=true;this._fake.init();if(this.dragAndDropOff)
this.dragger.addDragLanding(this._fake.entBox,this);this._fake.objBox.style.overflow="hidden";if(!dhtmlx.$customScroll)
this._fake.objBox.style.overflowX="scroll";else
this._fake.objBox._custom_scroll_mode="";this._fake._srdh=this._srdh||20;this._fake._srnd=this._srnd;this._fake._cssEven=this._cssEven;this._fake._cssUnEven=this._cssUnEven;if(this.skin_name!=this._fake.skin_name)
this._fake.setSkin(this.skin_name);var selfmaster=this;function _on_wheel(e){var cont=selfmaster.objBox;if(cont.scrollHeight-cont.offsetHeight>2){var dir=e.wheelDelta/-40;if(e.wheelDelta===window.undefined)
dir=e.detail;cont.scrollTop+=dir*40;if(e.preventDefault)
e.preventDefault();}}
dhtmlxEvent(this._fake.objBox,"mousewheel",_on_wheel);dhtmlxEvent(this._fake.objBox,"DOMMouseScroll",_on_wheel);function change_td(a,b){b.style.whiteSpace="";var c=b.nextSibling;var cp=b.parentNode;a.parentNode.insertBefore(b,a);if(!c)
cp.appendChild(a);else
cp.insertBefore(a,c);var z=a.style.display;a.style.display=b.style.display;b.style.display=z;}
function proc_hf(i,rows,mode,frows){var temp_header=(new Array(ind)).join(this.delim);var temp_rspan=[];if(i==2)
for(var k=0;k<ind;k++){var r=rows[i-1].cells[rows[i-1]._childIndexes?rows[i-1]._childIndexes[k]:k];if(r.rowSpan&&r.rowSpan>1){temp_rspan[r._cellIndex]=r.rowSpan-1;frows[i-1].cells[frows[i-1]._childIndexes?frows[i-1]._childIndexes[k]:k].rowSpan=r.rowSpan;r.rowSpan=1;}}
for(i;i<rows.length;i++){this._fake.attachHeader(temp_header,null,mode);frows=frows||this._fake.ftr.childNodes[0].rows;var max_ind=ind;var r_cor=0;for(var j=0;j<max_ind;j++){if(temp_rspan[j]){temp_rspan[j]=temp_rspan[j]-1;if(_isIE||_isOpera){var td=document.createElement("TD");if(_isFF)td.style.display="none";rows[i].insertBefore(td,rows[i].cells[0])}
r_cor++;continue;}
var a=frows[i].cells[j-r_cor];var b=rows[i].cells[j-(_isIE?0:r_cor)];var t=b.rowSpan;change_td(a,b);if(t>1){temp_rspan[j]=t-1;b.rowSpan=t;}
if(frows[i].cells[j].colSpan>1){rows[i].cells[j].colSpan=frows[i].cells[j].colSpan;max_ind-=frows[i].cells[j].colSpan-1;for(var k=1;k<frows[i].cells[j].colSpan;k++)
frows[i].removeChild(frows[i].cells[j+1]);}}}}
if(this.hdr.rows.length>2)
proc_hf.call(this,2,this.hdr.rows,"_aHead",this._fake.hdr.rows);if(this.ftr){proc_hf.call(this,1,this.ftr.childNodes[0].rows,"_aFoot");this._fake.ftr.parentNode.style.bottom=(_isFF?2:1)+"px";}
if(this.saveSizeToCookie){this.saveSizeToCookie=function(name,cookie_param){if(this._realfake)
return this._fake.saveSizeToCookie.apply(this._fake,arguments);if(!name)name=this.entBox.id;var z=new Array();var n="cellWidthPX";for(var i=0;i<this[n].length;i++)
if(i<ind)
z[i]=this._fake[n][i];else
z[i]=this[n][i];z=z.join(",")
this.setCookie(name,cookie_param,0,z);var z=(this.initCellWidth||(new Array)).join(",");this.setCookie(name,cookie_param,1,z);return true;}
this.loadSizeFromCookie=function(name){if(!name)name=this.entBox.id;var z=this._getCookie(name,1);if(!z)return
this.initCellWidth=z.split(",");var z=this._getCookie(name,0);var n="cellWidthPX";this.cellWidthType="px";var summ2=0;if((z)&&(z.length)){z=z.split(",");for(var i=0;i<z.length;i++)
if(i<ind){this._fake[n][i]=z[i];summ2+=z[i]*1;}
else
this[n][i]=z[i];}
this._fake.entBox.style.width=summ2+"px";this._fake.objBox.style.width=summ2+"px";var pa=this.globalBox.childNodes[1];pa.style.left=summ2-(_isFF?0:0)+"px";if(this.ftr)
this.ftr.style.left=summ2-(_isFF?0:0)+"px";pa.style.width=this.globalBox.offsetWidth-summ2+"px";this.setSizes();return true;}
this._fake.onRSE=this.onRSE;}
this.setCellTextStyleA=this.setCellTextStyle;this.setCellTextStyle=function(row_id,i,styleString){if(i<ind)this._fake.setCellTextStyle(row_id,i,styleString);this.setCellTextStyleA(row_id,i,styleString);}
this.setRowTextBoldA=this.setRowTextBold;this.setRowTextBold=function(row_id){this.setRowTextBoldA(row_id);this._fake.setRowTextBold(row_id);}
this.setRowColorA=this.setRowColor;this.setRowColor=function(row_id,color){this.setRowColorA(row_id,color);this._fake.setRowColor(row_id,color);}
this.setRowHiddenA=this.setRowHidden;this.setRowHidden=function(id,state){this.setRowHiddenA(id,state);this._fake.setRowHidden(id,state);}
this.setRowTextNormalA=this.setRowTextNormal;this.setRowTextNormal=function(row_id){this.setRowTextNormalA(row_id);this._fake.setRowTextNormal(row_id);}
this.getChangedRows=function(and_added){var res=new Array();function test(row){for(var j=0;j<row.childNodes.length;j++)
if(row.childNodes[j].wasChanged)
return res[res.length]=row.idd;}
this.forEachRow(function(id){var row=this.rowsAr[id];var frow=this._fake.rowsAr[id];if(row.tagName!="TR"||!frow||frow.tagName!="TR")return;if(and_added&&row._added)
res[res.length]=row.idd;else{if(!test(row))test(frow);}});return res.join(this.delim);};this.setRowTextStyleA=this.setRowTextStyle;this.setRowTextStyle=function(row_id,styleString){this.setRowTextStyleA(row_id,styleString);if(this._fake.rowsAr[row_id])
this._fake.setRowTextStyle(row_id,styleString);}
this.lockRowA=this.lockRow;this.lockRow=function(id,mode){this.lockRowA(id,mode);this._fake.lockRow(id,mode);}
this.getColWidth=function(i){if(i<ind)return parseInt(this._fake.cellWidthPX[i]);else return parseInt(this.cellWidthPX[i]);};this.getColumnLabel=function(i){return this._fake.getColumnLabel.apply(((i<ind)?this._fake:this),arguments);};this.setColWidthA=this._fake.setColWidthA=this.setColWidth;this.setColWidth=function(i,value){i=i*1;if(i<ind)this._fake.setColWidthA(i,value);else this.setColWidthA(i,value);if((i+1)<=ind)this._fake._correctSplit(Math.min(this._fake.objBox.offsetWidth,this._fake.obj.offsetWidth));}
this.adjustColumnSizeA=this.adjustColumnSize;this.setColumnLabelA=this.setColumnLabel;this.setColumnLabel=function(a,b,c,d){var that=this;if(a<ind)that=this._fake;return this.setColumnLabelA.apply(that,[a,b,c,d]);}
this.adjustColumnSize=function(aind,c){if(aind<ind){if(_isIE)this._fake.obj.style.tableLayout="";this._fake.adjustColumnSize(aind,c);if(_isIE)this._fake.obj.style.tableLayout="fixed";this._fake._correctSplit();}
else return this.adjustColumnSizeA(aind,c);}
var zname="cells";this._bfs_cells=this[zname];this[zname]=function(){if(arguments[1]<ind){return this._fake.cells.apply(this._fake,arguments);}else
return this._bfs_cells.apply(this,arguments);}
this._bfs_isColumnHidden=this.isColumnHidden;this.isColumnHidden=function(){if(parseInt(arguments[0])<ind)
return this._fake.isColumnHidden.apply(this._fake,arguments);else
return this._bfs_isColumnHidden.apply(this,arguments);}
this._bfs_setColumnHidden=this.setColumnHidden;this.setColumnHidden=function(){if(parseInt(arguments[0])<ind){this._fake.setColumnHidden.apply(this._fake,arguments);return this._fake._correctSplit();}
else
return this._bfs_setColumnHidden.apply(this,arguments);}
var zname="cells2";this._bfs_cells2=this[zname];this[zname]=function(){if(arguments[1]<ind)
return this._fake.cells2.apply(this._fake,arguments);else
return this._bfs_cells2.apply(this,arguments);}
var zname="cells3";this._bfs_cells3=this[zname];this[zname]=function(a,b){if(arguments[1]<ind&&this._fake.rowsAr[arguments[0].idd]){if(this._fake.rowsAr[a.idd]&&this._fake.rowsAr[a.idd].childNodes.length==0)return this._bfs_cells3.apply(this,arguments);arguments[0]=arguments[0].idd;return this._fake.cells.apply(this._fake,arguments);}
else
return this._bfs_cells3.apply(this,arguments);}
var zname="changeRowId";this._bfs_changeRowId=this[zname];this[zname]=function(){this._bfs_changeRowId.apply(this,arguments);if(this._fake.rowsAr[arguments[0]])
this._fake.changeRowId.apply(this._fake,arguments);}
this._fake.getRowById=function(id){var row=this.rowsAr[id];if(!row&&this._fake.rowsAr[id])row=this._fake.getRowById(id);if(row){if(row.tagName!="TR"){for(var i=0;i<this.rowsBuffer.length;i++)
if(this.rowsBuffer[i]&&this.rowsBuffer[i].idd==id)
return this.render_row(i);if(this._h2)return this.render_row(null,row.idd);}
return row;}
return null;}
if(this.collapseKids){this._fake["_bfs_collapseKids"]=this.collapseKids;this._fake["collapseKids"]=function(){return this._fake["collapseKids"].apply(this._fake,[this._fake.rowsAr[arguments[0].idd]]);}
this["_bfs_collapseKids"]=this.collapseKids;this["collapseKids"]=function(){var z=this["_bfs_collapseKids"].apply(this,arguments);this._fake._h2syncModel();if(!this._cssSP)this._fake._fixAlterCss();}
this._fake["_bfs_expandKids"]=this.expandKids;this._fake["expandKids"]=function(){this._fake["expandKids"].apply(this._fake,[this._fake.rowsAr[arguments[0].idd]]);if(!this._cssSP)this._fake._fixAlterCss();}
this["_bfs_expandAll"]=this.expandAll;this["expandAll"]=function(){this._bfs_expandAll();this._fake._h2syncModel();if(!this._cssSP)this._fake._fixAlterCss();}
this["_bfs_collapseAll"]=this.collapseAll;this["collapseAll"]=function(){this._bfs_collapseAll();this._fake._h2syncModel();if(!this._cssSP)this._fake._fixAlterCss();}
this["_bfs_expandKids"]=this.expandKids;this["expandKids"]=function(){var z=this["_bfs_expandKids"].apply(this,arguments);this._fake._h2syncModel();if(!this._cssSP)this._fake._fixAlterCss();}
this._fake._h2syncModel=function(){if(this._fake.pagingOn)this._fake._renderSort();else this._renderSort();}
this._updateTGRState=function(a){return this._fake._updateTGRState(a);}}
if(this._elmnh){this._setRowHoverA=this._fake._setRowHoverA=this._setRowHover;this._unsetRowHoverA=this._fake._unsetRowHoverA=this._unsetRowHover;this._setRowHover=this._fake._setRowHover=function(){var that=this.grid;that._setRowHoverA.apply(this,arguments);var z=(_isIE?event.srcElement:arguments[0].target);z=that._fake.rowsAr[that.getFirstParentOfType(z,'TD').parentNode.idd];if(z){that._fake._setRowHoverA.apply(that._fake.obj,[{target:z.childNodes[0]},arguments[1]]);}};this._unsetRowHover=this._fake._unsetRowHover=function(){if(arguments[1])var that=this;else var that=this.grid;that._unsetRowHoverA.apply(this,arguments);that._fake._unsetRowHoverA.apply(that._fake.obj,arguments);};this._fake.enableRowsHover(true,this._hvrCss);this.enableRowsHover(false);this.enableRowsHover(true,this._fake._hvrCss);}
this._updateTGRState=function(z){if(!z.update||z.id==0)return;if(this.rowsAr[z.id].imgTag)
this.rowsAr[z.id].imgTag.src=this.iconTree+z.state+".gif";if(this._fake.rowsAr[z.id]&&this._fake.rowsAr[z.id].imgTag)
this._fake.rowsAr[z.id].imgTag.src=this.iconTree+z.state+".gif";z.update=false;}
this.copy_row=function(row){var x=row.cloneNode(true);x._skipInsert=row._skipInsert;var r_ind=ind;x._attrs={};x._css=row._css;if(this._ecspn){r_ind=0;for(var i=0;(r_ind<x.childNodes.length&&i<ind);i+=(x.childNodes[r_ind].colSpan||1))
r_ind++;}
while(x.childNodes.length>r_ind)
x.removeChild(x.childNodes[x.childNodes.length-1]);var zm=r_ind;for(var i=0;i<zm;i++){if(this.dragAndDropOff)
this.dragger.addDraggableItem(x.childNodes[i],this);x.childNodes[i].style.display=(this._fake._hrrar?(this._fake._hrrar[i]?"none":""):"");x.childNodes[i]._cellIndex=i;x.childNodes[i].combo_value=arguments[0].childNodes[i].combo_value;x.childNodes[i]._clearCell=arguments[0].childNodes[i]._clearCell;x.childNodes[i]._cellType=arguments[0].childNodes[i]._cellType;x.childNodes[i]._brval=arguments[0].childNodes[i]._brval;x.childNodes[i].val=arguments[0].childNodes[i].val;x.childNodes[i]._combo=arguments[0].childNodes[i]._combo;x.childNodes[i]._attrs=arguments[0].childNodes[i]._attrs;x.childNodes[i].chstate=arguments[0].childNodes[i].chstate;if(row._attrs['style'])x.childNodes[i].style.cssText=row._attrs['style']+";"+x.childNodes[i].style.cssText;if(x.childNodes[i].colSpan>1)
x._childIndexes=arguments[0]._childIndexes;}
if(this._h2&&this._treeC<ind){var trow=this._h2.get[arguments[0].idd];x.imgTag=x.childNodes[this._treeC].childNodes[0].childNodes[trow.level];x.valTag=x.childNodes[this._treeC].childNodes[0].childNodes[trow.level+2];}
x.idd=row.idd;x.grid=this._fake;return x;}
var zname="_insertRowAt";this._bfs_insertRowAt=this[zname];this[zname]=function(){var r=this["_bfs_insertRowAt"].apply(this,arguments);arguments[0]=this.copy_row(arguments[0]);var r2=this._fake["_insertRowAt"].apply(this._fake,arguments);if(r._fhd){r2.parentNode.removeChild(r2);this._fake.rowsCol._dhx_removeAt(this._fake.rowsCol._dhx_find(r2));r._fhd=false;}
return r;}
this._bfs_setSizes=this.setSizes;this.setSizes=function(){if(this._notresize)return;this._bfs_setSizes(this,arguments);this.sync_headers()
if(this.sync_scroll()&&this._ahgr)this.setSizes();var height=this.dontSetSizes?(this.entBox.offsetHeight+"px"):this.entBox.style.height;this._fake.entBox.style.height=height;this._fake.objBox.style.height=this.objBox.style.height;this._fake.hdrBox.style.height=this.hdrBox.style.height;this._fake.objBox.scrollTop=this.objBox.scrollTop;this._fake.setColumnSizes(this._fake.entBox.clientWidth);this.globalBox.style.width=parseInt(this.entBox.style.width)+parseInt(this._fake.entBox.style.width);if(!this.dontSetSizes)
this.globalBox.style.height=height;}
this.sync_scroll=this._fake.sync_scroll=function(end){var old=this.objBox.style.overflowX;if(this.obj.offsetWidth<=this.objBox.offsetWidth)
{if(!end)return this._fake.sync_scroll(true);this.objBox.style.overflowX="hidden";this._fake.objBox.style.overflowX="hidden";}
else if(!dhtmlx.$customScroll){this.objBox.style.overflowX="scroll";this._fake.objBox.style.overflowX="scroll";}
return old!=this.objBox.style.overflowX;}
this.sync_headers=this._fake.sync_headers=function(){if(this.noHeader||(this._fake.hdr.scrollHeight==this.hdr.offsetHeight)||this.noHeaderResize)return;for(var i=1;i<this.hdr.rows.length;i++){var td=ind;while(!this.hdr.rows[i].childNodes[td])td--;var ha=Math.min(this.hdr.rows[i].childNodes[td].scrollHeight+2,this.hdr.rows[i].scrollHeight);var hb=this._fake.hdr.rows[i].scrollHeight;if(ha!=hb)
this._fake.hdr.rows[i].style.height=this.hdr.rows[i].style.height=Math.max(ha,hb)+"px";if(window._KHTMLrv){var lindex=0;while(this._fake._hrrar[lindex])lindex++;this._fake.hdr.rows[i].childNodes[lindex].style.height=this.hdr.rows[i].childNodes[td].style.height=Math.max(ha,hb)+"px";}}
this._fake.sync_headers;}
this._fake._bfs_setSizes=this._fake.setSizes;this._fake.setSizes=function(){if(this._fake._notresize)return;this._fake.setSizes();}
var zname="_doOnScroll";this._bfs__doOnScroll=this[zname];this[zname]=function(){this._bfs__doOnScroll.apply(this,arguments);this._fake.objBox.scrollTop=this.objBox.scrollTop;this._fake["_doOnScroll"].apply(this._fake,arguments);}
var zname="selectAll";this._bfs__selectAll=this[zname];this[zname]=function(){this._bfs__selectAll.apply(this,arguments);this._bfs__selectAll.apply(this._fake,arguments);}
var zname="doClick";this._bfs_doClick=this[zname];this[zname]=function(){this["_bfs_doClick"].apply(this,arguments);if(arguments[0].tagName=="TD"){var fl=(arguments[0]._cellIndex>=ind);if(!arguments[0].parentNode.idd)return;if(!fl)
arguments[0].className=arguments[0].className.replace(/cellselected/g,"");if(!this._fake.rowsAr[arguments[0].parentNode.idd])
this._fake.render_row(this.getRowIndex(arguments[0].parentNode.idd));arguments[0]=this._fake.cells(arguments[0].parentNode.idd,(fl?0:arguments[0]._cellIndex)).cell;if(fl)this._fake.cell=null;this._fake["_bfs_doClick"].apply(this._fake,arguments);if(fl)this._fake.cell=this.cell;else this.cell=this._fake.cell;if(this._fake.onRowSelectTime)clearTimeout(this._fake.onRowSelectTime)
if(fl){arguments[0].className=arguments[0].className.replace(/cellselected/g,"");globalActiveDHTMLGridObject=this;this._fake.cell=this.cell;}
else{this.objBox.scrollTop=this._fake.objBox.scrollTop;}}}
this._fake._bfs_doClick=this._fake[zname];this._fake[zname]=function(){this["_bfs_doClick"].apply(this,arguments);if(arguments[0].tagName=="TD"){var fl=(arguments[0]._cellIndex<ind);if(!arguments[0].parentNode.idd)return;arguments[0]=this._fake._bfs_cells(arguments[0].parentNode.idd,(fl?ind:arguments[0]._cellIndex)).cell;this._fake.cell=null;this._fake["_bfs_doClick"].apply(this._fake,arguments);this._fake.cell=this.cell;if(this._fake.onRowSelectTime)clearTimeout(this._fake.onRowSelectTime)
if(fl){arguments[0].className=arguments[0].className.replace(/cellselected/g,"");globalActiveDHTMLGridObject=this;this._fake.cell=this.cell;this._fake.objBox.scrollTop=this.objBox.scrollTop;}}}
this.clearSelectionA=this.clearSelection;this.clearSelection=function(mode){if(mode)this._fake.clearSelection();this.clearSelectionA();}
this.moveRowUpA=this.moveRowUp;this.moveRowUp=function(row_id){if(!this._h2)
this._fake.moveRowUp(row_id);this.moveRowUpA(row_id);if(this._h2)this._fake._h2syncModel();}
this.moveRowDownA=this.moveRowDown;this.moveRowDown=function(row_id){if(!this._h2)
this._fake.moveRowDown(row_id);this.moveRowDownA(row_id);if(this._h2)this._fake._h2syncModel();}
this._fake.getUserData=function(){return this._fake.getUserData.apply(this._fake,arguments);}
this._fake.setUserData=function(){return this._fake.setUserData.apply(this._fake,arguments);}
this.getSortingStateA=this.getSortingState;this.getSortingState=function(){var z=this.getSortingStateA();if(z.length!=0)return z;return this._fake.getSortingState();}
this.setSortImgStateA=this._fake.setSortImgStateA=this.setSortImgState;this.setSortImgState=function(a,b,c,d){this.setSortImgStateA(a,b,c,d);if(b*1<ind){this._fake.setSortImgStateA(a,b,c,d);this.setSortImgStateA(false);}else
this._fake.setSortImgStateA(false);}
this._fake.doColResizeA=this._fake.doColResize;this._fake.doColResize=function(ev,el,startW,x,tabW){var a=-1;var z=0;if(arguments[1]._cellIndex==(ind-1)){a=this._initalSplR+(ev.clientX-x);if(!this._initalSplF)this._initalSplF=arguments[3]+this.objBox.scrollWidth-this.objBox.offsetWidth;if(this.objBox.scrollWidth==this.objBox.offsetWidth&&(this._fake.alter_split_resize||(ev.clientX-x)>0)){arguments[3]=(this._initalSplF||arguments[3]);z=this.doColResizeA.apply(this,arguments);}
else
z=this.doColResizeA.apply(this,arguments);}
else{if(this.obj.offsetWidth<this.entBox.offsetWidth)
a=this.obj.offsetWidth;z=this.doColResizeA.apply(this,arguments);}
if(z!==false){this._correctSplit(a);this.resized=this._fake.resized=1;}
return z;}
this._fake.changeCursorState=function(ev){var el=ev.target||ev.srcElement;if(el.tagName!="TD")
el=this.getFirstParentOfType(el,"TD")
if((el.tagName=="TD")&&(this._drsclmn)&&(!this._drsclmn[el._cellIndex]))return;var check=(ev.layerX||0)+(((!_isIE)&&(ev.target.tagName=="DIV"))?el.offsetLeft:0);var pos=parseInt(this.getPosition(el,this.hdrBox));if(((el.offsetWidth-(ev.offsetX||(pos-check)*-1))<(_isOpera?20:10))||((this.entBox.offsetWidth-(ev.offsetX?(ev.offsetX+el.offsetLeft):check)+this.objBox.scrollLeft-0)<(_isOpera?20:10))){el.style.cursor="E-resize";}else
el.style.cursor="default";if(_isOpera)this.hdrBox.scrollLeft=this.objBox.scrollLeft;}
this._fake.startColResizeA=this._fake.startColResize;this._fake.startColResize=function(ev){var z=this.startColResizeA(ev);this._initalSplR=this.entBox.offsetWidth;this._initalSplF=null;if(this.entBox.onmousemove){var m=this.entBox.parentNode;if(m._aggrid)return z;m._aggrid=m.grid;m.grid=this;this.entBox.parentNode.onmousemove=this.entBox.onmousemove;this.entBox.onmousemove=null;}
return z;}
this._fake.stopColResizeA=this._fake.stopColResize;this._fake.stopColResize=function(ev){if(this.entBox.parentNode.onmousemove){var m=this.entBox.parentNode;m.grid=m._aggrid;m._aggrid=null;this.entBox.onmousemove=this.entBox.parentNode.onmousemove;this.entBox.parentNode.onmousemove=null;if(this.obj.offsetWidth<this.entBox.offsetWidth)
this._correctSplit(this.obj.offsetWidth);}
return this.stopColResizeA(ev);}
this.doKeyA=this.doKey;this._fake.doKeyA=this._fake.doKey;function inner_runner(index,rindex,master,ev){var dir=ev.shiftKey?-1:1;var end=ev.shiftKey?-1:master._cCount;var next=false;for(var i=index+dir;i!=end;i+=dir){if(master.smartTabOrder){next=master.cells2(rindex,i).isDisabled()?false:i;}else
next=i;if(next!==false){var editmode=!master._key_events.k_other;master.selectCell(rindex,next,false,false,editmode,true);ev.cancelBubble=true;if(ev.preventDefault)ev.preventDefault();return true;}}}
this._fake.doKey=this.doKey=function(ev){if(!ev)return true;if(this._htkebl)return true;if((ev.target||ev.srcElement).value!==window.undefined){var zx=(ev.target||ev.srcElement);if((!zx.parentNode)||(zx.parentNode.className.indexOf("editable")==-1))
return true;}
switch(ev.keyCode){case 9:var master=this._realfake?this._fake:this;if(!master.callEvent("onTab",[true]))return true;if(this.cell){var index=this.cell._cellIndex;var rindex=master.getRowIndex(this.cell.parentNode.idd);while(!inner_runner(index,rindex,master,ev)){rindex+=(ev.shiftKey?-1:1);if(rindex<0||rindex>=master.rowsBuffer.length)return;index=ev.shiftKey?master._cCount:-1;}
return;}
break;}
return this.doKeyA(ev);}
this.editCellA=this.editCell;this.editCell=function(){if(this.cell&&this.cell.parentNode.grid!=this)return this._fake.editCell();return this.editCellA();}
this.deleteRowA=this.deleteRow;this.deleteRow=function(row_id,node){if(this.deleteRowA(row_id,node)===false)return false;if(this._fake.rowsAr[row_id])
this._fake.deleteRow(row_id);}
this.clearAllA=this.clearAll;this.clearAll=function(){this.clearAllA();this._fake.clearAll();}
this.editStopA=this.editStop;this.editStop=function(mode){if(this._fake.editor)
this._fake.editStop(mode);else
this.editStopA(mode);};this.attachEvent("onAfterSorting",function(i,b,c){if(i>=ind)
this._fake.setSortImgState(false)});this._fake.sortField=function(a,b,c){this._fake.sortField.call(this._fake,a,b,this._fake.hdr.rows[0].cells[a]);if(this.fldSort[a]!="na"&&this._fake.fldSorted){var mem=this._fake.getSortingState()[1];this._fake.setSortImgState(false);this.setSortImgState(true,arguments[0],mem)}}
this.sortTreeRowsA=this.sortTreeRows;this._fake.sortTreeRowsA=this._fake.sortTreeRows;this.sortTreeRows=this._fake.sortTreeRows=function(col,type,order,ar){if(this._realfake)return this._fake.sortTreeRows(col,type,order,ar)
this.sortTreeRowsA(col,type,order,ar);this._fake._h2syncModel();this._fake.setSortImgStateA(false);this._fake.fldSorted=null;}
this._fake._fillers=[];this._fake.rowsBuffer=this.rowsBuffer;this.attachEvent("onClearAll",function(){this._fake.rowsBuffer=this.rowsBuffer;})
this._add_filler_s=this._add_filler;this._add_filler=function(a,b,c,e){if(!this._fake._fillers)this._fake._fillers=[];if(this._realfake||!e){var d;if(c&&c.idd)d=this._fake.rowsAr[c.idd];else if(c&&c.nextSibling){d={};d.nextSibling=this._fake.rowsAr[c.nextSibling.idd];d.parentNode=d.nextSibling.parentNode;}else if(this._fake._fillers.length){d=this._fake._fillers[this._fake._fillers.length-1][2];}
this._fake._fillers.push(this._fake._add_filler(a,b,d));}
return this._add_filler_s.apply(this,arguments);}
this._add_from_buffer_s=this._add_from_buffer;this._add_from_buffer=function(){var res=this._add_from_buffer_s.apply(this,arguments);if(res!=-1){this._fake._add_from_buffer.apply(this._fake,arguments);if(this.multiLine)this._correctRowHeight(this.rowsBuffer[arguments[0]].idd);}
return res;}
this._fake.render_row=function(ind){var row=this._fake.render_row(ind);if(row==-1)return-1;if(row){return this.rowsAr[row.idd]=this.rowsAr[row.idd]||this._fake.copy_row(row);}
return null;}
this._reset_view_s=this._reset_view;this._reset_view=function(){this._fake._reset_view(true);this._fake._fillers=[];this._reset_view_s();}
this.moveColumn_s=this.moveColumn;this.moveColumn=function(a,b){if(b>=ind)return this.moveColumn_s(a,b);}
this.attachEvent("onCellChanged",function(id,i,val){if(this._split_event&&i<ind&&this.rowsAr[id]){var cell=this._fake.rowsAr[id];if(!cell)return;if(cell._childIndexes)
cell=cell.childNodes[cell._childIndexes[i]];else
cell=cell.childNodes[i];var tcell=this.rowsAr[id].childNodes[i];if(tcell._treeCell&&tcell.firstChild.lastChild)
tcell.firstChild.lastChild.innerHTML=val;else
tcell.innerHTML=cell.innerHTML;tcell._clearCell=false;tcell.combo_value=cell.combo_value;tcell.chstate=cell.chstate;}})
this._fake.combos=this.combos;this.setSizes();if(this.rowsBuffer[0])this._reset_view();this.attachEvent("onXLE",function(){this._fake._correctSplit()})
this._fake._correctSplit();}
dhtmlXGridObject.prototype._correctSplit=function(a){a=a||(this.obj.scrollWidth-this.objBox.scrollLeft);a=Math.min(this.globalBox.offsetWidth,a);if(a>-1){this.entBox.style.width=a+"px";this.objBox.style.width=a+"px";var outerBorder=(this.globalBox.offsetWidth-this.globalBox.clientWidth)/2;this._fake.entBox.style.left=a+"px";this._fake.entBox.style.width=Math.max(0,this.globalBox.offsetWidth-a-(this.quirks?0:2)*outerBorder)+"px";if(this._fake.ftr)
this._fake.ftr.parentNode.style.width=this._fake.entBox.style.width;if(_isIE){var quirks=_isIE&&!window.xmlHttpRequest;var outerBorder=(this.globalBox.offsetWidth-this.globalBox.clientWidth);this._fake.hdrBox.style.width=this._fake.objBox.style.width=Math.max(0,this.globalBox.offsetWidth-(quirks?outerBorder:0)-a)+"px";}}}
dhtmlXGridObject.prototype._correctRowHeight=function(id,ind){if(!this.rowsAr[id]||!this._fake.rowsAr[id])return;var h=parseInt(this.rowsAr[id].style.height)||this.rowsAr[id].offsetHeight;var h2=parseInt(this._fake.rowsAr[id].style.height)||this._fake.rowsAr[id].offsetHeight;var max=Math.max(h,h2)-(this.rowsAr[id].delta_fix||0);if(!max)return;this.rowsAr[id].style.height=this._fake.rowsAr[id].style.height=Math.round(max+1)+"px";this.rowsAr[id].delta_fix=1;if(window._KHTMLrv){var j=this._fake._cCount;var td;while(!td&&j>=0){td=this.rowsAr[id].childNodes[j];j-=1;}
var td2=this._fake.rowsAr[id].firstChild;if(td&&td2){td.style.height=td2.style.height=max+"px";}}}
dhtmlXGridObject.prototype.enableAutoSizeSaving=function(name,cookie_param){this.attachEvent("onResizeEnd",function(){this.saveSizeToCookie(name,cookie_param)});}
dhtmlXGridObject.prototype.saveOpenStates=function(name,cookie_param){if(!name)name=this.entBox.id;var t=[];this._h2.forEachChild(0,function(el){if(el.state=="minus")t.push(el.id);});var str="gridOpen"+(name||"")+"="+t.join("|")+(cookie_param?("; "+cookie_param):"");document.cookie=str;}
dhtmlXGridObject.prototype.loadOpenStates=function(name,cookie_param){var val=this.getCookie(name,"gridOpen");if(!val)return;val=val.split("|");for(var i=0;i<val.length;i++){var pid=this.getParentId(val[i]);if(!this.getOpenState(pid))continue;this.openItem(val[i]);}}
dhtmlXGridObject.prototype.enableAutoHiddenColumnsSaving=function(name,cookie_param){this.attachEvent("onColumnHidden",function(){this.saveHiddenColumnsToCookie(name,cookie_param);});}
dhtmlXGridObject.prototype.enableSortingSaving=function(name,cookie_param){this.attachEvent("onBeforeSorting",function(){var that=this;window.setTimeout(function(){that.saveSortingToCookie(name,cookie_param);},1);return true;});}
dhtmlXGridObject.prototype.enableOrderSaving=function(name,cookie_param){this.attachEvent("onAfterCMove",function(){this.saveOrderToCookie(name,cookie_param);this.saveSizeToCookie(name,cookie_param);});}
dhtmlXGridObject.prototype.enableAutoSaving=function(name,cookie_param){this.enableOrderSaving(name,cookie_param);this.enableAutoSizeSaving(name,cookie_param);this.enableSortingSaving(name,cookie_param);}
dhtmlXGridObject.prototype.saveSizeToCookie=function(name,cookie_param){if(this.cellWidthType=='px')
var z=this.cellWidthPX;else
var z=this.cellWidthPC;var z2=(this.initCellWidth||[]).join(",");if(this._hrrar)
for(var i=0;i<this._hrrar.length;i++)
if(this._hrrar[i])z[i]="";this.setCookie(name,cookie_param,0,z.join(","));this.setCookie(name,cookie_param,1,z2);}
dhtmlXGridObject.prototype.saveHiddenColumnsToCookie=function(name,cookie_param){var hs=[].concat(this._hrrar||[]);if(this._fake&&this._fake._hrrar)
for(var i=0;i<this._fake._cCount;i++)
hs[i]=this._fake._hrrar[i]?"1":"";this.setCookie(name,cookie_param,4,hs.join(",").replace(/display:none;/g,"1"));}
dhtmlXGridObject.prototype.loadHiddenColumnsFromCookie=function(name){var z=this._getCookie(name,4);var ar=(z||"").split(",");for(var i=0;i<this._cCount;i++)
this.setColumnHidden(i,(ar[i]?true:false));}
dhtmlXGridObject.prototype.saveSortingToCookie=function(name,cookie_param){this.setCookie(name,cookie_param,2,(this.getSortingState()||[]).join(","));}
dhtmlXGridObject.prototype.loadSortingFromCookie=function(name){var z=this._getCookie(name,2);z=(z||"").split(",");if(z.length>1&&z[0]<this._cCount){this.sortRows(z[0],null,z[1]);this.setSortImgState(true,z[0],z[1]);}}
dhtmlXGridObject.prototype.saveOrderToCookie=function(name,cookie_param){if(!this._c_order){this._c_order=[];var l=this._cCount;for(var i=0;i<l;i++)
this._c_order[i]=i;}
this.setCookie(name,cookie_param,3,((this._c_order||[]).slice(0,this._cCount)).join(","));this.saveSortingToCookie(name,cookie_param);}
dhtmlXGridObject.prototype.loadOrderFromCookie=function(name){var z=this._getCookie(name,3);z=(z||"").split(",");if(z.length>1&&z.length<=this._cCount){for(var i=0;i<z.length;i++)
if((!this._c_order&&z[i]!=i)||(this._c_order&&z[i]!=this._c_order[i])){var t=z[i];if(this._c_order)
for(var j=0;j<this._c_order.length;j++){if(this._c_order[j]==z[i]){t=j;break;}}
this.moveColumn(t*1,i);}}}
dhtmlXGridObject.prototype.loadSizeFromCookie=function(name){var z=this._getCookie(name,1);if(z)
this.initCellWidth=z.split(",");var z=this._getCookie(name,0);if((z)&&(z.length)){z=z.split(",");if(!this._fake&&this._hrrar)
for(var i=0;i<z.length;i++)
if(this._hrrar[i])z[i]=0;if(this.cellWidthType=='px')
this.cellWidthPX=z;else
this.cellWidthPC=z;}
for(var i=0;i<z.length;i++)
if(z[i]===""){z[i]=this.initCellWidth[i];this.setColumnHidden(i,true);}
this.setSizes();return true;}
dhtmlXGridObject.prototype.clearConfigCookie=function(name){if(!name)name=this.entBox.id;var str="gridSettings"+name+"=||||";document.cookie=str;}
dhtmlXGridObject.prototype.clearSizeCookie=dhtmlXGridObject.prototype.clearConfigCookie;dhtmlXGridObject.prototype.setCookie=function(name,cookie_param,pos,value){if(!name)name=this.entBox.id;var t=this.getCookie(name);t=(t||"||||").split("|");t[pos]=value;var str="gridSettings"+name+"="+t.join("|").replace(/,/g,"-")+(cookie_param?("; "+cookie_param):"");document.cookie=str;}
dhtmlXGridObject.prototype.getCookie=function(name,surname){if(!name)name=this.entBox.id;name=(surname||"gridSettings")+name;var search=name+"=";if(document.cookie.length>0){var offset=document.cookie.indexOf(search);if(offset!=-1){offset+=search.length;var end=document.cookie.indexOf(";",offset);if(end==-1)
end=document.cookie.length;return document.cookie.substring(offset,end);}}};dhtmlXGridObject.prototype._getCookie=function(name,pos){return((this.getCookie(name)||"||||").replace(/-/g,",").split("|"))[pos];}
dhtmlXGridObject.prototype.enableUndoRedo=function()
{var self=this;var func=function(){return self._onEditUndoRedo.apply(self,arguments);}
this.attachEvent("onEditCell",func);var func2=function(a,b,c){return self._onEditUndoRedo.apply(self,[2,a,b,(c?1:0),(c?0:1)]);}
this.attachEvent("onCheckbox",func2);this._IsUndoRedoEnabled=true;this._UndoRedoData=[];this._UndoRedoPos=-1;}
dhtmlXGridObject.prototype.disableUndoRedo=function()
{this._IsUndoRedoEnabled=false;this._UndoRedoData=[];this._UndoRedoPos=-1;}
dhtmlXGridObject.prototype._onEditUndoRedo=function(stage,row_id,cell_index,new_value,old_value)
{if(this._IsUndoRedoEnabled&&stage==2&&old_value!=new_value){if(this._UndoRedoPos!==-1&&this._UndoRedoPos!=(this._UndoRedoData.length-1)){this._UndoRedoData=this._UndoRedoData.slice(0,this._UndoRedoPos+1);}else if(this._UndoRedoPos===-1&&this._UndoRedoData.length>0){this._UndoRedoData=[];}
var obj={old_value:old_value,new_value:new_value,row_id:row_id,cell_index:cell_index};this._UndoRedoData.push(obj);this._UndoRedoPos++;}
return true;}
dhtmlXGridObject.prototype.doUndo=function()
{if(this._UndoRedoPos===-1)
return false;var obj=this._UndoRedoData[this._UndoRedoPos--];var c=this.cells(obj.row_id,obj.cell_index);if(this.getColType(obj.cell_index)=="tree")
c.setLabel(obj.old_value);else
c.setValue(obj.old_value);this.callEvent("onUndo",[obj.row_id]);}
dhtmlXGridObject.prototype.doRedo=function()
{if(this._UndoRedoPos==this._UndoRedoData.length-1)
return false;var obj=this._UndoRedoData[++this._UndoRedoPos];this.cells(obj.row_id,obj.cell_index).setValue(obj.new_value);this.callEvent("onUndo",[obj.row_id]);}
dhtmlXGridObject.prototype.getRedo=function()
{if(this._UndoRedoPos==this._UndoRedoData.length-1)
return[];return this._UndoRedoData.slice(this._UndoRedoPos+1);}
dhtmlXGridObject.prototype.getUndo=function()
{if(this._UndoRedoPos==-1)
return[];return this._UndoRedoData.slice(0,this._UndoRedoPos+1);}
dhtmlXGridObject.prototype.enableAccessKeyMap=function(){this._select_ifpossible=function(){if(this.editor&&this.editor.obj&&this.editor.obj.select)this.editor.obj.select();};this._key_events={k13_1_0:function(){this.editStop();},k13_0_1:function(){this._key_events.k9_0_1.call(this);},k13_0_0:function(){this._key_events.k9_0_0.call(this);},k9_0_0:function(){this.editStop();if(!this.callEvent("onTab",[true]))return true;var z=this._getNextCell(null,1);if(z){if(this.pagingOn)this.showRow(z.parentNode.idd);this.selectCell(z.parentNode,z._cellIndex,(this.row!=z.parentNode),false,true);this._still_active=true;}
this._select_ifpossible();},k9_0_1:function(){this.editStop();if(!this.callEvent("onTab",[false]))return true;var z=this._getNextCell(null,-1);if(z){this.selectCell(z.parentNode,z._cellIndex,(this.row!=z.parentNode),false,true);this._still_active=true;}
this._select_ifpossible();},k113_0_0:function(){if(this._f2kE)this.editCell();},k32_0_0:function(){var c=this.cells4(this.cell);if(!c.changeState||(c.changeState()===false))return false;},k27_0_0:function(){this.editStop(true);},k33_0_0:function(){if(this.pagingOn)
this.changePage(this.currentPage-1);else this.scrollPage(-1);},k34_0_0:function(){if(this.pagingOn)
this.changePage(this.currentPage+1);else this.scrollPage(1);},k37_0_0:function(){if(this.editor)return false;if(this.isTreeGrid())
this.collapseKids(this.row);else this._key_events.k9_0_1.call(this);},k39_0_0:function(){if(this.editor)return false;if(!this.editor&&this.isTreeGrid())
this.expandKids(this.row);else this._key_events.k9_0_0.call(this);},k37_1_0:function(){if(this.editor)return false;this.selectCell(this.row,0,false,false,true);this._select_ifpossible();},k39_1_0:function(){if(this.editor)return false;this.selectCell(this.row,this._cCount-1,false,false,true);this._select_ifpossible();},k38_1_0:function(){this.selectCell(this.rowsCol[0],this.cell._cellIndex,true,false,true);this._select_ifpossible();},k40_1_0:function(){this.selectCell(this.rowsCol[this.rowsCol.length-1],this.cell._cellIndex,true,false,true);this._select_ifpossible();},k38_0_1:function(){var rowInd=this.getRowIndex(this.row.idd);var nrow=this._nextRow(rowInd,-1);if(!nrow||nrow._sRow||nrow._rLoad)return false;this.selectCell(nrow,this.cell._cellIndex,true,false,true);this._select_ifpossible();},k40_0_1:function(){var rowInd=this.getRowIndex(this.row.idd);var nrow=this._nextRow(rowInd,1);if(!nrow||nrow._sRow||nrow._rLoad)return false;this.selectCell(nrow,this.cell._cellIndex,true,false,true);this._select_ifpossible();},k38_1_1:function(){var rowInd=this.getRowIndex(this.row.idd);for(var i=rowInd;i>=0;i--){this.selectCell(this.rowsCol[i],this.cell._cellIndex,true,false,true);}},k40_1_1:function(){var rowInd=this.getRowIndex(this.row.idd);for(var i=rowInd+1;i<this.rowsCol.length;i++){this.selectCell(this.rowsCol[i],this.cell._cellIndex,true,false,true);}},k40_0_0:function(){if(this.editor&&this.editor.combo)
this.editor.shiftNext();else{if(!this.row.idd)return;var rowInd=rowInd=this.getRowIndex(this.row.idd)+1;if(this.rowsBuffer[rowInd]){var nrow=this._nextRow(rowInd-1,1);if(this.pagingOn&&nrow)this.showRow(nrow.idd);this._Opera_stop=0;this.selectCell(nrow,this.cell._cellIndex,true,false,true);}
else{if(!this.callEvent("onLastRow",[]))return false;this._key_events.k34_0_0.apply(this,[]);}}
this._still_active=true;},k36_0_0:function(){return this._key_events.k37_1_0.call(this);},k35_0_0:function(){return this._key_events.k39_1_0.call(this);},k36_1_0:function(){if(this.editor||!this.rowsCol.length)return false;this.selectCell(this.rowsCol[0],0,true,false,true);this._select_ifpossible();},k35_1_0:function(){if(this.editor||!this.rowsCol.length)return false;this.selectCell(this.rowsCol[this.rowsCol.length-1],this._cCount-1,true,false,true);this._select_ifpossible();},k33_0_0:function(){if(this.pagingOn)
this.changePage(this.currentPage-1);else this.scrollPage(-1);},k34_0_0:function(){if(this.pagingOn)
this.changePage(this.currentPage+1);else this.scrollPage(1);},k38_0_0:function(){if(this.editor&&this.editor.combo)
this.editor.shiftPrev();else{if(!this.row.idd)return;var rowInd=rowInd=this.getRowIndex(this.row.idd)+1;if(rowInd!=-1){var nrow=this._nextRow(rowInd-1,-1);this._Opera_stop=0;if(this.pagingOn&&nrow)this.showRow(nrow.idd);this.selectCell(nrow,this.cell._cellIndex,true,false,true);}
else this._key_events.k33_0_0.apply(this,[]);}
this._still_active=true;}};};dhtmlXGridObject.prototype.enableExcelKeyMap=function(){this._key_events={k13_1_0:function(){this.editStop();},k13_0_1:function(){this.editStop();this._key_events.k38_0_0.call(this);},k13_0_0:function(){this.editStop();this.callEvent("onEnter",[(this.row?this.row.idd:null),(this.cell?this.cell._cellIndex:null)]);this._still_active=true;this._key_events.k40_0_0.call(this);},k9_0_0:function(){this.editStop();if(!this.callEvent("onTab",[true]))return true;if(this.cell&&(this.cell._cellIndex+1)>=this._cCount)return;var z=this._getNextCell(null,1);if(z&&this.row==z.parentNode){this.selectCell(z.parentNode,z._cellIndex,true);this._still_active=true;}},k9_0_1:function(){this.editStop();if(!this.callEvent("onTab",[false]))return true;if(this.cell&&(this.cell._cellIndex==0))return;var z=this._getNextCell(null,-1);if(z&&this.row==z.parentNode){this.selectCell(z.parentNode,z._cellIndex,true);this._still_active=true;}},k113_0_0:function(){if(this._f2kE)this.editCell();},k32_0_0:function(){var c=this.cells4(this.cell);if(!c.changeState||(c.changeState()===false))return false;},k27_0_0:function(){this.editStop(true);this._still_active=true;},k33_0_0:function(){if(this.pagingOn)
this.changePage(this.currentPage-1);else this.scrollPage(-1);},k34_0_0:function(){if(this.pagingOn)
this.changePage(this.currentPage+1);else this.scrollPage(1);},k37_0_0:function(){if(this.editor)return false;if(this.isTreeGrid())
this.collapseKids(this.row);else this._key_events.k9_0_1.call(this);},k39_0_0:function(){if(this.editor)return false;if(!this.editor&&this.isTreeGrid())
this.expandKids(this.row);else this._key_events.k9_0_0.call(this);},k37_1_0:function(){if(this.editor)return false;this.selectCell(this.row,0,true);},k39_1_0:function(){if(this.editor)return false;this.selectCell(this.row,this._cCount-1,true);},k38_1_0:function(){if(this.editor||!this.rowsCol.length)return false;this.selectCell(this.rowsCol[0],this.cell._cellIndex,true);},k40_1_0:function(){if(this.editor||!this.rowsCol.length)return false;this.selectCell(this.rowsCol[this.rowsCol.length-1],this.cell._cellIndex,true);},k38_0_1:function(){if(this.editor||!this.rowsCol.length)return false;var rowInd=this.row.rowIndex;var nrow=this._nextRow(rowInd-1,-1);if(!nrow||nrow._sRow||nrow._rLoad)return false;this.selectCell(nrow,this.cell._cellIndex,true,true);},k40_0_1:function(){if(this.editor||!this.rowsCol.length)return false;var rowInd=this.row.rowIndex;var nrow=this._nextRow(rowInd-1,1);if(!nrow||nrow._sRow||nrow._rLoad)return false;this.selectCell(nrow,this.cell._cellIndex,true,true);},k38_1_1:function(){if(this.editor||!this.rowsCol.length)return false;var rowInd=this.row.rowIndex;for(var i=rowInd-1;i>=0;i--){this.selectCell(this.rowsCol[i],this.cell._cellIndex,true,true);}},k40_1_1:function(){if(this.editor||!this.rowsCol.length)return false;var rowInd=this.row.rowIndex;for(var i=rowInd;i<this.rowsCol.length;i++){this.selectCell(this.rowsCol[i],this.cell._cellIndex,true,true);}},k40_0_0:function(){var master=this._realfake?this._fake:this;if(this.editor&&this.editor.combo)
this.editor.shiftNext();else{if(this.editor)return false;var rowInd=Math.max((master._r_select||0),this.getRowIndex(this.row.idd));var row=this._nextRow(rowInd,1);if(row){master._r_select=null;this.selectCell(row,this.cell._cellIndex,true);if(master.pagingOn)master.showRow(row.idd);}else{if(!this.callEvent("onLastRow",[]))return false;this._key_events.k34_0_0.apply(this,[]);}}},k36_0_0:function(){return this._key_events.k37_1_0.call(this);},k35_0_0:function(){return this._key_events.k39_1_0.call(this);},k36_1_0:function(){if(this.editor||!this.rowsCol.length)return false;this.selectCell(this.rowsCol[0],0,true);},k35_1_0:function(){if(this.editor||!this.rowsCol.length)return false;this.selectCell(this.rowsCol[this.rowsCol.length-1],this._cCount-1,true);},k33_0_0:function(){if(this.pagingOn)
this.changePage(this.currentPage-1);else this.scrollPage(-1);},k34_0_0:function(){if(this.pagingOn)
this.changePage(this.currentPage+1);else this.scrollPage(1);},k38_0_0:function(){var master=this._realfake?this._fake:this;if(this.editor&&this.editor.combo)
this.editor.shiftPrev();else{if(this.editor)return false;if(!this.row.idd)return;var rowInd=this.getRowIndex(this.row.idd)+1;if(rowInd!=-1&&(!this.pagingOn||(rowInd!=1))){var nrow=this._nextRow(rowInd-1,-1);this.selectCell(nrow,this.cell._cellIndex,true);if(master.pagingOn&&nrow)master.showRow(nrow.idd);}else{this._key_events.k33_0_0.apply(this,[]);}}},k_other:function(ev){if(this.editor)return false;if(!ev.ctrlKey&&ev.keyCode>=40&&(ev.keyCode<91||(ev.keyCode>95&&ev.keyCode<111)||ev.keyCode>187))
if(this.cell){var c=this.cells4(this.cell);if(c.isDisabled())return false;var t=c.getValue();if(c.editable!==false)c.setValue("");this.editCell();if(this.editor){this.editor.val=t;if(this.editor.obj&&this.editor.obj.select)
this.editor.obj.select();}
else c.setValue(t);}}};};function eXcell_time(cell){this.base=eXcell_ed;this.base(cell)
this.getValue=function(){return this.cell.innerHTML.toString();}
this.setValue=function(val){var re=new RegExp(" ","i")
val=val.replace(re,":")
if((val==""))val="00:00"
else
{var re=new RegExp("[a-zA-Z]","i")
var res=val.match(re)
if(res)val="00:00";else{var re=new RegExp("[0-9]+[\\.\\/;\\-,_\\]\\[\\?\\: ][0-9]+","i")
var res=val.search(re)
if(res!=-1){var re=new RegExp("[\\./\\;\\-\\,\\_\\]\\[ \\?]","i")
val=val.replace(re,":")}
else
{var re=new RegExp("[^0-9]","i")
res1=val.search(re)
if(res=val.match(re)){val="00:00";}
else
{if(val.length==1)
{val="00:0"+val;}
else
{if(parseInt(val)<60)val="00:"+val;else
if(val.length<5)
{var minutes=parseInt(val);var hours=Math.floor(minutes/60);minutes=minutes-60*hours;var hours=hours.toString();var minutes=minutes.toString();while(hours.length<2){hours="0"+hours;}
while(minutes.length<2){minutes="0"+minutes;}
val=hours+":"+minutes;}}}}}}
this.cell.innerHTML=val;}}
eXcell_time.prototype=new eXcell_ed;function eXcell_sub_row(cell){if(cell){this.cell=cell;this.grid=this.cell.parentNode.grid;}
this.getValue=function(){return this.grid.getUserData(this.cell.parentNode.idd,"__sub_row");}
this._setState=function(m,v){(v||this.cell).innerHTML="<img src='"+this.grid.imgURL+m+"' width='18' height='18' />";(v||this.cell).firstChild.onclick=this.grid._expandMonolite;}
this.open=function(){this.cell.firstChild.onclick(null,true)}
this.close=function(){this.cell.firstChild.onclick(null,false,true)}
this.isOpen=function(){return!!this.cell.parentNode._expanded;}
this.setValue=function(val){if(val)
this.grid.setUserData(this.cell.parentNode.idd,"__sub_row",val);this._setState(val?"plus.gif":"blank.gif");}
this.setContent=function(val){if(this.cell.parentNode._expanded){this.cell.parentNode._expanded.innerHTML=val;this.resize();}
else{this.cell._previous_content=null;this.setValue(val);this.cell._sub_row_type=null}}
this.resize=function(){this.grid._detectHeight(this.cell.parentNode._expanded,this.cell,this.cell.parentNode._expanded.scrollHeight);},this.isDisabled=function(){return true;}
this.getTitle=function(){return this.grid.getUserData(this.cell.parentNode.idd,"__sub_row")?"click to expand|collapse":"";}}
eXcell_sub_row.prototype=new eXcell;function eXcell_sub_row_ajax(cell){this.base=eXcell_sub_row;this.base(cell);this.setValue=function(val){if(val)
this.grid.setUserData(this.cell.parentNode.idd,"__sub_row",val);this.cell._sub_row_type="ajax";this.cell._previous_content=null;this._setState(val?"plus.gif":"blank.gif");}}
eXcell_sub_row_ajax.prototype=new eXcell_sub_row;function eXcell_sub_row_grid(cell){this.base=eXcell_sub_row;this.base(cell);this.setValue=function(val){if(val)
this.grid.setUserData(this.cell.parentNode.idd,"__sub_row",val);this.cell._sub_row_type="grid";this._setState(val?"plus.gif":"blank.gif");}
this.getSubGrid=function(){if(!cell._sub_grid)return null;return cell._sub_grid;}}
eXcell_sub_row_grid.prototype=new eXcell_sub_row;dhtmlXGridObject.prototype._expandMonolite=function(n,show,hide){var td=this.parentNode;var row=td.parentNode;var that=row.grid;if(n||window.event){if(!hide&&!row._expanded)that.editStop();(n||event).cancelBubble=true;}
var c=that.getUserData(row.idd,"__sub_row");if(!that._sub_row_editor)
that._sub_row_editor=new eXcell_sub_row(td);if(!c)return;if(row._expanded&&!show){that._sub_row_editor._setState("plus.gif",td);td._previous_content=row._expanded;that.objBox.removeChild(row._expanded);row._expanded=false;row.style.height=(row.oldHeight||20)+"px";td.style.height=(row.oldHeight||20)+"px";if(that._fake){that._fake.rowsAr[row.idd].style.height=(row.oldHeight||20)+"px";that._fake.rowsAr[row.idd].firstChild.style.height=(row.oldHeight||20)+"px";}
for(var i=0;i<row.cells.length;i++)
row.cells[i].style.verticalAlign="middle";delete that._flow[row.idd];that._correctMonolite();row._expanded.ctrl=null;}else if(!row._expanded&&!hide){that._sub_row_editor._setState("minus.gif",td);row.oldHeight=td.offsetHeight-4;if(td._previous_content){var d=td._previous_content;d.ctrl=td;that.objBox.appendChild(d);that._detectHeight(d,td,parseInt(d.style.height))}
else{var d=document.createElement("DIV");d.ctrl=td;if(td._sub_row_type)
that._sub_row_render[td._sub_row_type](that,d,td,c);else
d.innerHTML=c;d.style.cssText="position:absolute; left:0px; top:0px; overflow:auto; font-family:Tahoma; font-size:8pt; margin-top:2px; margin-left:4px;";d.className="dhx_sub_row";that.objBox.appendChild(d);that._detectHeight(d,td)}
if(!that._flow){that.attachEvent("onGridReconstructed",function(){if((this.pagingOn&&!this.parentGrid)||this._srnd)this._collapsMonolite();else this._correctMonolite();});that.attachEvent("onResizeEnd",function(){this._correctMonolite(true);});that.attachEvent("onAfterCMove",function(){this._correctMonolite(true);});that.attachEvent("onDrop",function(){this._correctMonolite(true);});that.attachEvent("onBeforePageChanged",function(){this._collapsMonolite();return true;});that.attachEvent("onGroupStateChanged",function(){this._correctMonolite();return true;});that.attachEvent("onFilterEnd",function(){this._collapsMonolite();});that.attachEvent("onUnGroup",function(){this._collapsMonolite();});that.attachEvent("onPageChanged",function(){this._collapsMonolite();});that.attachEvent("onXLE",function(){this._collapsMonolite();});that.attachEvent("onClearAll",function(){for(var i in this._flow){if(this._flow[i]&&this._flow[i].parentNode)this._flow[i].parentNode.removeChild(this._flow[i]);};this._flow=[];});that.attachEvent("onEditCell",function(a,b,c){if((a!==2)&&this._flow[b]&&this.cellType[c]!="ch"&&this.cellType[c]!="ra")this._expandMonolite.apply(this._flow[b].ctrl.firstChild,[0,false,true]);return true;});that.attachEvent("onCellChanged",function(id,ind){if(!this._flow[id])return;var c=this.cells(id,ind).cell;c.style.verticalAlign="top";});that._flow=[];}
that._flow[row.idd]=d;that._correctMonolite();var padtop=that._srdh>30?11:3;if(that.multiLine)padtop=0;for(var i=0;i<row.cells.length;i++)
row.cells[i].style.verticalAlign="top";if(that._fake){var frow=that._fake.rowsAr[row.idd];for(var i=0;i<frow.cells.length;i++){frow.cells[i].style.verticalAlign="top";}}
row._expanded=d;}
if(that._ahgr)
that.setSizes()
if(that.parentGrid)
that.callEvent("onGridReconstructed",[]);that.callEvent("onSubRowOpen",[row.idd,(!!row._expanded)]);}
dhtmlXGridObject.prototype._sub_row_render={"ajax":function(that,d,td,c){d.innerHTML="Loading...";dhx4.ajax.get(c,function(xml){d.innerHTML=xml.xmlDoc.responseText;var z=xml.xmlDoc.responseText.match(/<script[^>]*>([^\f]+?)<\/script>/g);if(z)
for(var i=0;i<z.length;i++)
eval(z[i].replace(/<([\/]{0,1})s[^>]*>/g,""));that._detectHeight(d,td)
that._correctMonolite();that.setUserData(td.parentNode.idd,"__sub_row",xml.xmlDoc.responseText);td._sub_row_type=null;if(that._ahgr)
that.setSizes()
that.callEvent("onSubAjaxLoad",[td.parentNode.idd,xml.xmlDoc.responseText]);});},"grid":function(that,d,td,c){td._sub_grid=new dhtmlXGridObject(d);if(that.skin_name)
td._sub_grid.setSkin(that.skin_name);td._sub_grid.parentGrid=that;td._sub_grid.imgURL=that.imgURL;td._sub_grid.iconURL=that.iconURL;td._sub_grid.enableAutoHeight(true);td._sub_grid._delta_x=td._sub_grid._delta_y=null;td._sub_grid.attachEvent("onGridReconstructed",function(){that._detectHeight(d,td,td._sub_grid.objBox.scrollHeight+td._sub_grid.hdr.offsetHeight+(this.ftr?this.ftr.offsetHeight:0));that._correctMonolite();this.setSizes();if(that.parentGrid)that.callEvent("onGridReconstructed",[]);})
if(!that.callEvent("onSubGridCreated",[td._sub_grid,td.parentNode.idd,td._cellIndex,c])){td._sub_grid.objBox.style.overflow="hidden";td._sub_row_type=null;}else{td._sub_grid.load(c,function(){that._detectHeight(d,td,td._sub_grid.objBox.scrollHeight+td._sub_grid.hdr.offsetHeight+(td._sub_grid.ftr?td._sub_grid.ftr.offsetHeight:0));td._sub_grid.objBox.style.overflow="hidden";that._correctMonolite();td._sub_row_type=null;if(!that.callEvent("onSubGridLoaded",[td._sub_grid,td.parentNode.idd,td._cellIndex,c]))return;if(that._ahgr)that.setSizes();if(that.parentGrid)that.callEvent("onGridReconstructed",[]);});}}}
dhtmlXGridObject.prototype._detectHeight=function(d,td,h){var l=td.offsetLeft+td.offsetWidth;d.style.left=l+"px";d.style.width=Math.max(0,td.parentNode.offsetWidth-l-4)+"px"
var h=h||d.scrollHeight;d.style.overflow="hidden";d.style.height=h+"px";var row=td.parentNode;td.parentNode.style.height=(row.oldHeight||20)+h*1+"px";td.style.height=(row.oldHeight||20)+h*1+"px";if(this._fake){var tr=this._fake.rowsAr[td.parentNode.idd];tr.style.height=(row.oldHeight||20)+h*1+"px";tr.firstChild.style.height=(row.oldHeight||20)+h*1+"px";}}
dhtmlXGridObject.prototype._correctMonolite=function(mode){if(this._in_correction)return;this._in_correction=true;for(var a in this._flow)
if(this._flow[a]&&this._flow[a].tagName=="DIV")
if(this.rowsAr[a]){if(this.rowsAr[a].style.display=="none"){this.cells4(this._flow[a].ctrl).close();continue;}
this._flow[a].style.top=this.rowsAr[a].offsetTop+(this.rowsAr[a].oldHeight||20)+"px";if(mode){var l=this._flow[a].ctrl.offsetLeft+this._flow[a].ctrl.offsetWidth;this._flow[a].style.left=l+"px";this._flow[a].style.width=this.rowsAr[a].offsetWidth-l-4+"px"}}
else{this._flow[a].ctrl=null;this.objBox.removeChild(this._flow[a]);delete this._flow[a];}
this._in_correction=false;}
dhtmlXGridObject.prototype._collapsMonolite=function(){for(var a in this._flow)
if(this._flow[a]&&this._flow[a].tagName=="DIV")
if(this.rowsAr[a])
this.cells4(this._flow[a].ctrl).close();}
function eXcell_ra_str(cell){if(cell){this.base=eXcell_ra;this.base(cell)
this.grid=cell.parentNode.grid;}}
eXcell_ra_str.prototype=new eXcell_ch;eXcell_ra_str.prototype.setValue=function(val){this.cell.style.verticalAlign="middle";if(val){val=val.toString()._dhx_trim();if((val=="false")||(val=="0"))val="";}
if(val){if(this.grid.rowsAr[this.cell.parentNode.idd])
for(var i=0;i<this.grid._cCount;i++){if(i!==this.cell._cellIndex){var cell=this.grid.cells(this.cell.parentNode.idd,i);if((cell.cell._cellType||this.grid.cellType[cell.cell._cellIndex])!="ra_str")continue;if(cell.getValue())
cell.setValue("0");}}
val="1";this.cell.chstate="1";}else{val="0";this.cell.chstate="0"}
this.setCValue("<img src='"+this.grid.imgURL+"radio_chk"+val+".gif' onclick='new eXcell_ra_str(this.parentNode).changeState()'>",this.cell.chstate);}
dhx4.attachEvent("onGridCreated",function(grid){if(!window.dhx_globalImgPath)window.dhx_globalImgPath=grid.imgURL;grid._col_combos=[];for(var i=0;i<grid._cCount;i++){if(grid.cellType[i].indexOf("combo")==0){grid._col_combos[i]=eXcell_combo.prototype.initCombo.call({grid:grid},i);}}
if(!grid._loading_handler_set){grid._loading_handler_set=grid.attachEvent("onXLE",function(a,b,c,xml,type){if(type!="xml")return;eXcell_combo.prototype.fillColumnCombos(this,xml);this.detachEvent(this._loading_handler_set);this._loading_handler_set=null;});}});function eXcell_combo(cell){if(!cell)return;this.cell=cell;this.grid=cell.parentNode.grid;this._combo_pre="";this.edit=function(){if(!window.dhx_globalImgPath)window.dhx_globalImgPath=this.grid.imgURL;this.val=this.getValue();var val=this.getText();if(this.cell._clearCell)val="";this.cell.innerHTML="";if(!this.cell._brval){this.combo=(this.grid._realfake?this.grid._fake:this.grid)._col_combos[this.cell._cellIndex];}else{this.combo=this.cell._brval;}
this.cell.appendChild(this.combo.DOMParent);this.combo.DOMParent.style.margin="0";this.combo.DOMelem_input.focus();this.combo.setSize(this.cell.offsetWidth-2);if(!this.combo._xml){if(this.combo.getIndexByValue(this.cell.combo_value)!=-1){this.combo.selectOption(this.combo.getIndexByValue(this.cell.combo_value));}else{if(this.combo.getOptionByLabel(val)){this.combo.selectOption(this.combo.getIndexByValue(this.combo.getOptionByLabel(val).value));}else{this.combo.setComboText(val);}}}else{this.combo.setComboText(val);}
this.combo.openSelect();}
this.selectComboOption=function(val,obj){obj.selectOption(obj.getIndexByValue(obj.getOptionByLabel(val).value));}
this.getValue=function(val){return this.cell.combo_value||"";}
this.getText=function(val){var c=this.cell;if(this._combo_pre==""&&c.childNodes[1]){c=c.childNodes[1];}else{c.childNodes[0].childNodes[1];}
return(_isIE?c.innerText:c.textContent);}
this.setValue=function(val){if(typeof(val)=="object"){this.cell._brval=this.initCombo();var index=this.cell._cellIndex;var idd=this.cell.parentNode.idd;if(!val.firstChild){this.cell.combo_value="&nbsp;";this.cell._clearCell=true;}else{this.cell.combo_value=val.firstChild.data;}
this.setComboOptions(this.cell._brval,val,this.grid,index,idd);}else{this.cell.combo_value=val;var cm=null;if((cm=this.cell._brval)&&(typeof(this.cell._brval)=="object")){val=(cm.getOption(val)||{}).text||val;}else if(cm=this.grid._col_combos[this.cell._cellIndex]||((this.grid._fake)&&(cm=this.grid._fake._col_combos[this.cell._cellIndex]))){val=(cm.getOption(val)||{}).text||val;}
if((val||"").toString()._dhx_trim()=="")val=null;if(val!==null){this.setComboCValue(val);}else{this.setComboCValue("&nbsp;","");this.cell._clearCell=true;}}}
this.detach=function(){var p=this.combo.getParent();if(p.parentNode==this.cell){this.cell.removeChild(p);}else{return false;}
var val=this.cell.combo_value;this.combo._confirmSelect("blur");if(!this.combo.getComboText()||this.combo.getComboText().toString()._dhx_trim()==""){this.setComboCValue("&nbsp;");this.cell._clearCell=true;}else{this.setComboCValue(this.combo.getComboText().replace(/\&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),this.combo.getActualValue());this.cell._clearCell=false;}
this.cell.combo_value=this.combo.getActualValue();this.combo.closeAll();this.grid._still_active=true;this.grid.setActive(1);return val!=this.cell.combo_value;}}
eXcell_combo.prototype=new eXcell;eXcell_combo_v=function(cell){var combo=new eXcell_combo(cell);combo._combo_pre="<img src='"+(window.dhx_globalImgPath?window.dhx_globalImgPath:this.grid.imgURL)+"combo_select"+(dhtmlx.skin?"_"+dhtmlx.skin:"")+".gif' class='dhxgrid_combo_icon'/>";return combo;};eXcell_combo.prototype.initCombo=function(index){var container=document.createElement("DIV");container.className="dhxcombo_in_grid_parent";var type=this.grid.defVal[arguments.length?index:this.cell._cellIndex];var combo=new dhtmlXCombo(container,"combo",0,type);this.grid.defVal[arguments.length?index:this.cell._cellIndex]="";var grid=this.grid;combo.DOMelem.onmousedown=combo.DOMelem.onclick=function(e){e=e||event;e.cancelBubble=true;};combo.DOMelem.onselectstart=function(e){e=e||event;e.cancelBubble=true;return true;};this.grid.attachEvent("onScroll",function(){if(combo._isListVisible())combo._hideList();});combo.attachEvent("onKeyPressed",function(ev){if(ev==13||ev==27){grid.editStop();if(grid._fake)grid._fake.editStop();}});return combo;};eXcell_combo.prototype.fillColumnCombos=function(grid,xml){if(!xml)return;var top=dhx4.ajax.xmltop("rows",xml,-1);if(top&&top.tagName!=="DIV"){grid.combo_columns=grid.combo_columns||[];columns=dhx4.ajax.xpath("//column",top);for(var i=0;i<columns.length;i++){if((columns[i].getAttribute("type")||"").indexOf("combo")==0){grid.combo_columns[grid.combo_columns.length]=i;this.setComboOptions(grid._col_combos[i],columns[i],grid,i);}}}};eXcell_combo.prototype.setComboCValue=function(value,value2){if(this._combo_pre!=""){var height=(this.cell.offsetHeight?this.cell.offsetHeight+"px":0);value="<div style='width:100%;position:relative;height:100%;overflow:hidden;'>"+this._combo_pre+"<span>"+value+"</span></div>";}
if(arguments.length>1){this.setCValue(value,value2);}else{this.setCValue(value);}};eXcell_combo.prototype.setComboOptions=function(combo,obj,grid,index,idd){if(window.dhx4.s2b(obj.getAttribute("xmlcontent"))){if(!obj.getAttribute("source")){options=obj.childNodes;var _optArr=[];for(var i=0;i<options.length;i++){if(options[i].tagName=="option"){var text_opt=options[i].firstChild?options[i].firstChild.data:"";_optArr[_optArr.length]=[options[i].getAttribute("value"),text_opt,(options[i].getAttribute("css")||"")];}}
combo.addOption(_optArr)
if(arguments.length==4){grid.forEachRowA(function(id){var c=grid.cells(id,index);if(!c.cell._brval&&!c.cell._cellType&&(c.cell._cellIndex==index)){if(c.cell.combo_value=="")c.setComboCValue("&nbsp;","");else{if(!combo.getOption(c.cell.combo_value))
c.setComboCValue(c.cell.combo_value);else c.setComboCValue(combo.getOption(c.cell.combo_value).text,c.cell.combo_value);}}});}
else{var c=(this.cell)?this:grid.cells(idd,index);if(obj.getAttribute("text")){if(obj.getAttribute("text")._dhx_trim()=="")c.setComboCValue("&nbsp;","");else c.setComboCValue(obj.getAttribute("text"));}
else{if((!c.cell.combo_value)||(c.cell.combo_value._dhx_trim()==""))c.setComboCValue("&nbsp;","");else{if(!combo.getOption(c.cell.combo_value))
c.setComboCValue(c.cell.combo_value);else c.setComboCValue(combo.getOption(c.cell.combo_value).text,c.cell.combo_value);}}}}}
if(obj.getAttribute("source")){if(obj.getAttribute("auto")&&window.dhx4.s2b(obj.getAttribute("auto"))){if(obj.getAttribute("xmlcontent")){var c=(this.cell)?this:grid.cells(idd,index);if(obj.getAttribute("text"))c.setComboCValue(obj.getAttribute("text"));}else{grid.forEachRowA(function(id){var c=grid.cells(id,index);if(!c.cell._brval&&!c.cell._cellType){var str=c.cell.combo_value.toString();if(str.indexOf("^")!=-1){var arr=str.split("^");c.cell.combo_value=arr[0];c.setComboCValue(arr[1]);}}});}
combo.enableFilteringMode(true,obj.getAttribute("source"),window.dhx4.s2b(obj.getAttribute("cache")||true),window.dhx4.s2b(obj.getAttribute("sub")||false));}else{var that=this;var length=arguments.length;combo.load(obj.getAttribute("source"),function(){if(length==4){grid.forEachRow(function(id){var c=grid.cells(id,index);if(!c.cell._brval&&!c.cell._cellType){if(combo.getOption(c.cell.combo_value)){c.setComboCValue(combo.getOption(c.cell.combo_value).text,c.cell.combo_value);}else{if((c.cell.combo_value||"").toString()._dhx_trim()==""){c.setComboCValue("&nbsp;","");c.cell._clearCell=true;}else{c.setComboCValue(c.cell.combo_value);}}}});}else{var c=grid.cells(idd,index);if(combo.getOption(c.cell.combo_value)){c.setComboCValue(combo.getOption(c.cell.combo_value).text,c.cell.combo_value);}else{c.setComboCValue(c.cell.combo_value);}}});}}
if(!obj.getAttribute("auto")||!window.dhx4.s2b(obj.getAttribute("auto"))){if(obj.getAttribute("editable")&&!window.dhx4.s2b(obj.getAttribute("editable")))combo.readonly(true);if(obj.getAttribute("filter")&&window.dhx4.s2b(obj.getAttribute("filter")))combo.enableFilteringMode(true);}};eXcell_combo.prototype.getCellCombo=function(){if(this.cell._brval)return this.cell._brval;this.cell._brval=this.initCombo();return this.cell._brval;};eXcell_combo.prototype.refreshCell=function(){this.setValue(this.getValue());};dhtmlXGridObject.prototype.getColumnCombo=function(index){if(this._col_combos&&this._col_combos[index])return this._col_combos[index];if(!this._col_combos)this._col_combos=[];this._col_combos[index]=eXcell_combo.prototype.initCombo.call({grid:this},index);return this._col_combos[index];};dhtmlXGridObject.prototype.refreshComboColumn=function(index){this.forEachRow(function(id){if(this.cells(id,index).refreshCell)this.cells(id,index).refreshCell();});};function eXcell_clist(cell){try{this.cell=cell;this.grid=this.cell.parentNode.grid;}catch(er){}
this.edit=function(){this.val=this.getValue();var a=(this.cell._combo||this.grid.clists[this.cell._cellIndex]);if(!a)return;this.obj=document.createElement("DIV");var b=this.val.split(",");var text="";for(var i=0;i<a.length;i++){var fl=false;for(var j=0;j<b.length;j++)
if(a[i]==b[j])fl=true;if(fl)
text+="<div><input type='checkbox' id='dhx_clist_"+i+"' checked='true' /><label for='dhx_clist_"+i+"'>"+a[i]+"</label></div>";else
text+="<div><input type='checkbox' id='dhx_clist_"+i+"'/><label for='dhx_clist_"+i+"'>"+a[i]+"</label></div>";}
text+="<div><input type='button' value='"+(this.grid.applyButtonText||"Apply")+"' style='width:100px; font-size:8pt;' onclick='this.parentNode.parentNode.editor.grid.editStop();'/></div>"
this.obj.editor=this;this.obj.innerHTML=text;document.body.appendChild(this.obj);this.obj.style.position="absolute";this.obj.className="dhx_clist";this.obj.onclick=function(e){(e||event).cancelBubble=true;return true;};var arPos=this.grid.getPosition(this.cell);this.obj.style.left=arPos[0]+"px";this.obj.style.top=arPos[1]+this.cell.offsetHeight+"px";this.obj.getValue=function(){var text="";for(var i=0;i<this.childNodes.length-1;i++)
if(this.childNodes[i].childNodes[0].checked){if(text)text+=", ";text+=this.childNodes[i].childNodes[1].innerHTML;}
return text.replace(/&amp;/g,"&");}}
this.getValue=function(){if(this.cell._clearCell)return"";return this.cell.innerHTML.toString()._dhx_trim().replace(/&amp;/g,"&").replace(/, /g,",");}
this.detach=function(val){if(this.obj){this.setValue(this.obj.getValue());this.obj.editor=null;this.obj.parentNode.removeChild(this.obj);this.obj=null;}
return this.val!=this.getValue();}}
eXcell_clist.prototype=new eXcell;eXcell_clist.prototype.setValue=function(val){if(typeof(val)=="object"){var optCol=dhx4.ajax.xpath("./option",val);if(optCol.length)
this.cell._combo=[];for(var j=0;j<optCol.length;j++)
this.cell._combo.push(optCol[j].firstChild?optCol[j].firstChild.data:"");val=val.firstChild.data;}
if(val===""||val===this.undefined){this.setCTxtValue(" ",val);this.cell._clearCell=true;}
else{val=val.replace(/,[ ]*/g,", ");this.setCTxtValue(val);this.cell._clearCell=false;}}
dhtmlXGridObject.prototype.registerCList=function(col,list){if(!this.clists)this.clists=new Array();if(typeof(list)!="object")list=list.split(",");this.clists[col]=list;}
function eXcell_calck(cell){try{this.cell=cell;this.grid=this.cell.parentNode.grid;}catch(er){}
this.edit=function(){this.val=this.getValue();var arPos=this.grid.getPosition(this.cell);this.obj=new calcX(arPos[0],arPos[1]+this.cell.offsetHeight,this,this.val);}
this.getValue=function(){return this.grid._aplNFb(this.cell.innerHTML.toString()._dhx_trim(),this.cell._cellIndex);}
this.detach=function(){if(this.obj){this.setValue(this.obj.inputZone.value);this.obj.removeSelf();}
this.obj=null;return this.val!=this.getValue();}}
eXcell_calck.prototype=new eXcell;eXcell_calck.prototype.setValue=function(val){if(!val||val.toString()._dhx_trim()=="")
val="0"
this.setCValue(this.grid._aplNF(val,this.cell._cellIndex),val);}
function calcX(left,top,onReturnSub,val){this.top=top||0;this.left=left||0;this.onReturnSub=onReturnSub||null;this.operandA=0;this.operandB=0;this.operatorA="";this.state=0;this.dotState=0;this.calckGo=function(){return(eval(this.operandA+"*1"+this.operatorA+this.operandB+"*1"));};this.isNumeric=function(str){return((str.search(/[^1234567890]/gi)==-1)?(true):(false));};this.isOperation=function(str){return((str.search(/[^\+\*\-\/]/gi)==-1)?(true):(false));}
this.onCalcKey=function(e)
{that=this.calk;var z=this.innerHTML;var rZone=that.inputZone;if(((that.state==0)||(that.state==2))&&(that.isNumeric(z)))if(rZone.value!="0")rZone.value+=z;else rZone.value=z;if((((that.state==0)||(that.state==2))&&(z=='.'))&&(that.dotState==0)){that.dotState=1;rZone.value+=z;}
if((z=="C")){rZone.value=0;that.dotState=0;that.state=0;}
if((that.state==0)&&(that.isOperation(z))){that.operatorA=z;that.operandA=rZone.value;that.state=1;}
if((that.state==2)&&(that.isOperation(z))){that.operandB=rZone.value;rZone.value=that.calckGo();that.operatorA=z;that.operandA=rZone.value;that.state=1;}
if((that.state==2)&&(z=="=")){that.operandB=rZone.value;rZone.value=that.calckGo();that.operatorA=z;that.operandA=rZone.value;that.state=3;}
if((that.state==1)&&(that.isNumeric(z))){rZone.value=z;that.state=2;that.dotState=0}
if((that.state==3)&&(that.isNumeric(z))){rZone.value=z;that.state=0;}
if((that.state==3)&&(that.isOperation(z))){that.operatorA=z;that.operandA=rZone.value;that.state=1;}
if(z=="e"){rZone.value=Math.E;if(that.state==1)that.state=2;that.dotState=0}
if(z=="p"){rZone.value=Math.PI;if(that.state==1)that.state=2;that.dotState=0}
if(z=="Off")that.topNod.parentNode.removeChild(that.topNod);if(e||event)(e||event).cancelBubble=true;}
this.sendResult=function(){that=this.calk;if(that.state==2){var rZone=that.inputZone;that.operandB=rZone.value;rZone.value=that.calckGo();that.operatorA=z;that.operandA=rZone.value;that.state=3;}
var z=that.inputZone.value;that.topNod.parentNode.removeChild(that.topNod);that.onReturnSub.grid.editStop(false);};this.removeSelf=function(){if(this.topNod.parentNode)
this.topNod.parentNode.removeChild(this.topNod);}
this.keyDown=function(){this.className="calcPressed";};this.keyUp=function(){this.className="calcButton";};this.init_table=function(){var table=this.topNod.childNodes[0];if((!table)||(table.tagName!="TABLE"))return;for(i=1;i<table.childNodes[0].childNodes.length;i++)
for(j=0;j<table.childNodes[0].childNodes[i].childNodes.length;j++)
{table.childNodes[0].childNodes[i].childNodes[j].onclick=this.onCalcKey;table.childNodes[0].childNodes[i].childNodes[j].onmousedown=this.keyDown;table.childNodes[0].childNodes[i].childNodes[j].onmouseout=this.keyUp;table.childNodes[0].childNodes[i].childNodes[j].onmouseup=this.keyUp;table.childNodes[0].childNodes[i].childNodes[j].calk=this;}
this.inputZone=this.topNod.childNodes[0].childNodes[0].childNodes[0].childNodes[0].childNodes[0].childNodes[0].childNodes[0].childNodes[0].childNodes[0];if(this.onReturnSub)
{this.topNod.childNodes[0].childNodes[0].childNodes[0].childNodes[0].childNodes[0].childNodes[0].childNodes[0].childNodes[1].onclick=this.sendResult;this.topNod.childNodes[0].childNodes[0].childNodes[0].childNodes[0].childNodes[0].childNodes[0].childNodes[0].childNodes[1].calk=this;}
else this.topNod.childNodes[0].childNodes[0].childNodes[0].childNodes[0].childNodes[0].childNodes[0].childNodes[0].childNodes[1].innerHTML="";}
this.drawSelf=function(){var div=document.createElement("div");div.className="calcTable";div.style.position="absolute";div.style.top=this.top+"px";div.style.left=this.left+"px";div.innerHTML="<table cellspacing='0' id='calc_01' class='calcTable'><tr><td colspan='4'><table cellpadding='1' cellspacing='0' width='100%'><tr><td width='100%' style='overflow:hidden;'><input style='width:100%' class='calcInput' value='0' align='right' readonly='true' style='text-align:right'></td><td class='calkSubmit'>=</td></tr></table></td></tr><tr><td class='calcButton' width='25%'>Off</td><td class='calcButton' width='25%'>p</td><td class='calcButton' width='25%'>e</td><td class='calcButton' width='25%'>/</td></tr><tr><td class='calcButton'>7</td><td class='calcButton'>8</td><td class='calcButton'>9</td><td class='calcButton'>*</td></tr><tr><td class='calcButton'>4</td><td class='calcButton'>5</td><td class='calcButton'>6</td><td class='calcButton'>+</td></tr><tr><td class='calcButton'>1</td><td class='calcButton'>2</td><td class='calcButton'>3</td><td class='calcButton'>-</td></tr><tr><td class='calcButton'>0</td><td class='calcButton'>.</td><td class='calcButton'>C</td><td class='calcButton'>=</td></tr></table>";div.onclick=function(e){(e||event).cancelBubble=true;};document.body.appendChild(div);this.topNod=div;}
this.drawSelf();this.init_table();if(val){var rZone=this.inputZone;rZone.value=val*1;this.operandA=val*1;this.state=3;}
return this;};dhtmlXGridObject.prototype._updateTGRState=function(z){if(!z.update||z.id==0)return;if(this.rowsAr[z.id].imgTag)
this.rowsAr[z.id].imgTag.src=this.iconTree+z.state+".gif";z.update=false;}
dhtmlXGridObject.prototype.doExpand=function(obj){this.editStop();var row=obj.parentNode.parentNode.parentNode;var r=this._h2.get[row.idd];if(!this.callEvent("onOpen",[row.idd,(r.state=="plus"?-1:1)]))return;if(r.state=="plus")
this.expandKids(row)
else
if((r.state=="minus")&&(!r._closeable))
this.collapseKids(row)}
dhtmlXGridObject.prototype._createHierarchy=function(){if(!this._emptyLineImg)
this._emptyLineImg="blank";return new dhtmlxHierarchy({_emptyLineImg:this._emptyLineImg});}
function dhtmlxHierarchy(config){var z={id:0,childs:[],level:-1,parent:null,index:0,state:config._emptyLineImg};this.order=[z];this.get={"0":z};this.swap=function(a,b){var p=a.parent;var z=a.index;p.childs[z]=b;p.childs[b.index]=a;a.index=b.index;b.index=z;}
this.forEachChildF=function(id,funct,that,funct2){var z=this.get[id];for(var i=0;i<z.childs.length;i++){if(!funct.apply((that||this),[z.childs[i]]))continue;if(z.childs[i].childs.length)this.forEachChildF(z.childs[i].id,funct,that,funct2);if(funct2)funct2.call((that||this),z.childs[i]);}}
this.forEachChild=function(id,funct,that){var z=this.get[id];for(var i=0;i<z.childs.length;i++){funct.apply((that||this),[z.childs[i]]);if(z.childs[i].childs.length)this.forEachChild(z.childs[i].id,funct,that);}}
this.change=function(id,name,val){var z=this.get[id];if(z[name]==val)return;z[name]=val;z.update=true;}
this.add=function(id,parentId){return this.addAfter(id,parentId);}
this.addAfter=function(id,parentId,afterId,fix){var z=this.get[parentId||0];if(afterId)
var ind=this.get[afterId].index+(fix?0:1);else var ind=z.childs.length;var x={id:id,childs:[],level:z.level+1,parent:z,index:ind,state:config._emptyLineImg}
if(z.state==config._emptyLineImg)this.change(parentId,"state",(parentId==0?"minus":"plus"));if(afterId){for(var i=ind;i<z.childs.length;i++)z.childs[i].index++;z.childs=z.childs.slice(0,ind).concat([x]).concat(z.childs.slice(ind,z.childs.length));}else
z.childs.push(x);this.get[id]=x;return x;}
this.addBefore=function(id,parentId,beforeId){return this.addAfter(id,parentId,beforeId,true)}
this.remove=function(id){var z=this.get[id||0];for(var i=0;i<z.childs.length;i++)
this.deleteAll(z.childs[i].id)
z.childs=[];z.parent.childs=z.parent.childs.slice(0,z.index).concat(z.parent.childs.slice(z.index+1));for(var i=z.index;i<z.parent.childs.length;i++)
z.parent.childs[i].index--;delete this.get[id];}
this.deleteAll=function(id){var z=this.get[id||0];for(var i=0;i<z.childs.length;i++)
this.deleteAll(z.childs[i].id)
z.childs=[];delete this.get[id];}
return this;}
dhtmlXGridObject.prototype._getOpenLenght=function(id,start){var z=this._h2.get[id].childs;start+=z.length;for(var i=0;i<z.length;i++)
if(z[i].childs.length&&z[i].state=='minus')
start+=this._getOpenLenght(z[i].id,0);return start;}
dhtmlXGridObject.prototype.collapseKids=function(curRow){var r=this._h2.get[curRow.idd];if(r.state!="minus")return;if(!this.callEvent("onOpenStart",[curRow.idd,1]))return;var start=curRow.rowIndex;if(start<0)start=this.rowsCol._dhx_find(curRow)+1;this._h2.change(r.id,"state","plus");this._updateTGRState(r);if(this._srnd||this.pagingOn){this._h2_to_buff();this._renderSort();}else{var len=this._getOpenLenght(this.rowsCol[start-1].idd,0);for(var i=0;i<len;i++)
this.rowsCol[start+i].parentNode.removeChild(this.rowsCol[start+i]);this.rowsCol.splice(start,len);}
this.callEvent("onGridReconstructed",[]);this.setSizes();this._h2_to_buff();this.callEvent("onOpenEnd",[curRow.idd,-1]);}
dhtmlXGridObject.prototype._massInsert=function(r,start,ind,skip){var anew=[];var par=(_isKHTML?this.obj:this.obj.rows[0].parentNode)
this._h2_to_buff();if(this._srnd||this.pagingOn)return this._renderSort();var len=this._getOpenLenght(r.id,0);for(var i=0;i<len;i++){var ra=this.render_row(ind+i);if(start)
start.parentNode.insertBefore(ra,start);else
par.appendChild(ra);anew.push(ra)}
this.rowsCol=dhtmlxArray(this.rowsCol.slice(0,ind).concat(anew).concat(this.rowsCol.slice(ind)));return r.childs.length+anew.length;}
dhtmlXGridObject.prototype.expandKids=function(curRow,sEv){var r=this._h2.get[curRow.idd];if((!r.childs.length)&&(!r._xml_await))return;if(r.state!="plus")return;if(!r._loading&&!sEv)
if(!this.callEvent("onOpenStart",[r.id,-1]))return;var start=this.getRowIndex(r.id)+1;if(r.childs.length){r._loading=false;this._h2.change(r.id,"state","minus")
this._updateTGRState(r);var len=this._massInsert(r,this.rowsCol[start],start);this.callEvent("onGridReconstructed",[]);}else{if(r._xml_await){r._loading=true;if(this.callEvent("onDynXLS",[r.id]))
this.load(this.kidsXmlFile+""+(this.kidsXmlFile.indexOf("?")!=-1?"&":"?")+"id="+encodeURIComponent(r.id),this._data_type);}}
this.setSizes();if(!r._loading)
this.callEvent("onOpenEnd",[r.id,1]);this._fixAlterCss();}
dhtmlXGridObject.prototype.kidsXmlFile="";dhtmlXGridObject.prototype.sortTreeRows=function(col,type,order){var amet="getValue";if(this.cells5({parentNode:{grid:this}},this.getColType(col)).getDate){amet="getDate";type="str";}
this.forEachRow(function(id){var z=this._h2.get[id];if(!z)return;var label=this._get_cell_value(z.buff,col,amet);if(type=='int'){z._sort=parseFloat(label);z._sort=isNaN(z._sort)?-99999999999999:z._sort;}else
z._sort=label;});var self=this;var pos=1;var neg=-1;if(order=="des"){pos=-1;neg=1;}
var funct=null;if(typeof type=="function")
funct=function(a,b){return type(a._sort,b._sort,order,a.id,b.id);}
else{if(type=='cus')
funct=function(a,b){return self._customSorts[col](a._sort,b._sort,order,a.id,b.id);};if(type=='str')
funct=function(a,b){return(a._sort<b._sort?neg:(a._sort==b._sort?0:pos))}
if(type=='int')
funct=function(a,b){return(a._sort<b._sort?neg:(a._sort==b._sort?0:pos))}
if(type=='date')
funct=function(a,b){return(Date.parse(new Date(a._sort||"01/01/1900"))-Date.parse(new Date(b._sort||"01/01/1900")))*pos}}
this._sortTreeRows(funct,0);this._renderSort(0,true);this.callEvent("onGridReconstructed",[]);}
dhtmlXGridObject.prototype._sortTreeRows=function(funct,id){var ar=this._h2.get[id].childs;if(this.rowsCol.stablesort)
this.rowsCol.stablesort.call(ar,funct);else
ar.sort(funct);for(var i=0;i<ar.length;i++){if(ar[i].childs.length)
this._sortTreeRows(funct,ar[i].id);ar[i].index=i;}};dhtmlXGridObject.prototype._renderSort=function(id,mode){this._h2_to_buff();var top=this.objBox.scrollTop;this._reset_view();this.objBox.scrollTop=top;};dhtmlXGridObject.prototype._fixAlterCssTGR=function(){if(!this._realfake)
this._h2.forEachChild(0,function(x){if(x.buff.tagName=="TR"){var cs=(this._cssSP?(x.level%2):(x.index%2))?this._cssUnEven:this._cssEven;this.rowsAr[x.id].className=(cs+(this._cssSU?(" "+cs+"_"+x.level):""))+" "+(this.rowsAr[x.id]._css||"")+((this.rowsAr[x.id].className.indexOf("rowselected")!=-1)?" rowselected":"");}},this);}
dhtmlXGridObject.prototype.moveRowUDTG=function(id,dir){var x=this._h2.get[id];var p=x.parent.childs[x.index+dir]
if((!p)||(p.parent!=x.parent))return;var state=[x.state,p.state];this.collapseKids(this.rowsAr[x.id]);this.collapseKids(this.rowsAr[p.id]);var ind=this.rowsCol._dhx_find(this.rowsAr[id]);var bInd=this.rowsBuffer._dhx_find(this.rowsAr[id]);var nod=this.obj.rows[0].parentNode.removeChild(this.rowsCol[ind]);var tar=this.rowsCol[ind+((dir==1)?2:dir)];if(tar)
tar.parentNode.insertBefore(nod,tar);else
this.obj.rows[0].parentNode.appendChild(nod);this.rowsCol._dhx_swapItems(ind,ind+dir)
this.rowsBuffer._dhx_swapItems(bInd,bInd+dir);this._h2.swap(p,x);if(state[0]=="minus")this.expandKids(this.rowsAr[x.id]);if(state[1]=="minus")this.expandKids(this.rowsAr[p.id]);this._fixAlterCss(Math.min(ind,ind+dir));}
function eXcell_tree(cell){if(cell){this.cell=cell;this.grid=this.cell.parentNode.grid;}
this.isDisabled=function(){return this.cell._disabled||this.grid._edtc;}
this.edit=function(){if((this.er)||(this.grid._edtc))return;this.er=this.cell.parentNode.valTag;this.val=this.getLabel();this.cell.atag=((!this.grid.multiLine)&&(_isKHTML||_isMacOS||_isFF))?"INPUT":"TEXTAREA";this.er.innerHTML="<"+this.cell.atag+" class='dhx_combo_edit' type='text' style='height:"+(this.cell.offsetHeight-4)+"px;line-height:"+(this.cell.offsetHeight-6)+"px; width:100%; border:0px; margin:0px; padding:0px; overflow:hidden;'></"+this.cell.atag+">";this.er.childNodes[0].onmousedown=function(e){(e||event).cancelBubble=true}
this.er.childNodes[0].onselectstart=function(e){if(!e)e=event;e.cancelBubble=true;return true;};this.er.className+=" editable";this.er.firstChild.onclick=function(e){(e||event).cancelBubble=true};this.er.firstChild.value=this.val;this.obj=this.er.firstChild;this.er.firstChild.style.width=Math.max(0,this.cell.offsetWidth-this.er.offsetLeft-2)+"px";this.er.firstChild.focus();if(_isIE)
this.er.firstChild.focus();}
this.detach=function(){if(!this.er)return;this.setLabel(this.er.firstChild.value);this.er.className=this.er.className.replace("editable","");var z=(this.val!=this.er.innerHTML);this.obj=this.er=null;return(z);}
this.getValue=function(){return this.getLabel();}
this.setImage=function(url){this.cell.parentNode.imgTag.nextSibling.src=this.grid.iconURL+url;this.grid._h2.get[this.cell.parentNode.idd].image=url;}
this.setIcon=function(icon){this.grid._h2.get[this.cell.parentNode.idd].icon=icon;this.cell.parentNode.imgTag.nextSibling.className="dhx_treegrid_icon fa fa-"+icon;}
this.getImage=function(){return this.grid._h2.get[this.cell.parentNode.idd].image;}
this.getIcon=function(){return this.grid._h2.get[this.cell.parentNode.idd].icon;}
this.setLabel=function(val){this.setValueA(val);}
this.getLabel=function(val){return this.cell.parentNode.valTag.innerHTML;}}
eXcell_tree.prototype=new eXcell;eXcell_tree.prototype.setValueA=function(content){this.cell.parentNode.valTag.innerHTML=content;this.grid.callEvent("onCellChanged",[this.cell.parentNode.idd,this.cell._cellIndex,content])}
eXcell_tree.prototype.setValue=function(valAr){if(this.cell.parentNode.imgTag)
return this.setLabel(valAr);if((this.grid._tgc.iconTree==null)||(this.grid._tgc.iconTree!=this.grid.iconTree)){var _tgc={};_tgc.spacer="<img src='"+this.grid.iconTree+"blank.gif'  align='top' class='space'>";_tgc.imst="<img class='grid_collapse_icon' src='"+this.grid.iconTree;_tgc.imsti="<img style='padding-top:2px;'  src='"+(this.grid.iconURL||this.grid.iconTree);_tgc.imact="' align='top' onclick='this."+(_isKHTML?"":"parentNode.")+"parentNode.parentNode.parentNode.parentNode.grid.doExpand(this);event.cancelBubble=true;'>"
_tgc.plus=_tgc.imst+"plus.gif"+_tgc.imact;_tgc.minus=_tgc.imst+"minus.gif"+_tgc.imact;_tgc.blank=_tgc.imst+"blank.gif"+_tgc.imact;_tgc.start="<div class='treegrid_cell' style='overflow:hidden; white-space : nowrap; line-height:23px; height:"+(_isIE?21:23)+"px;'>";_tgc.itemim="' align='top' "+(this.grid._img_height?(" height=\""+this.grid._img_height+"\""):"")+(this.grid._img_width?(" width=\""+this.grid._img_width+"\""):"")+" >";_tgc.itemne="<span id='nodeval'>";_tgc.close="</span></div>";this.grid._tgc=_tgc;}
var _h2=this.grid._h2;var _tgc=this.grid._tgc;var rid=this.cell.parentNode.idd;var row=this.grid._h2.get[rid];if(this.grid.kidsXmlFile||this.grid._slowParse){row.has_kids=(row.has_kids||(this.cell.parentNode._attrs["xmlkids"]&&(row.state!="minus")));row._xml_await=!!row.has_kids;}
row.image=row.image||(this.cell._attrs["image"]||"leaf.gif");row.icon=row.icon||(this.cell._attrs["icon"]||(this.grid.iconset?"file-o":""));row.label=valAr;var html=[_tgc.start];for(var i=0;i<row.level;i++)
html.push(_tgc.spacer);if(row.has_kids){html.push(_tgc.plus);row.state="plus"}
else
html.push(_tgc.imst+row.state+".gif"+_tgc.imact);if(!row.icon){html.push(_tgc.imsti);html.push(row.image);html.push(_tgc.itemim);}else{html.push("<i class='dhx_treegrid_icon fa fa-"+row.icon+"'></i>");}
html.push(_tgc.itemne);html.push(row.label);html.push(_tgc.close);this.cell.innerHTML=html.join("");this.cell._treeCell=true;this.cell.parentNode.imgTag=this.cell.childNodes[0].childNodes[row.level];this.cell.parentNode.valTag=this.cell.childNodes[0].childNodes[row.level+2];if(_isKHTML)this.cell.vAlign="top";if(row.parent.id!=0&&row.parent.state=="plus"){this.grid._updateTGRState(row.parent,false);this.cell.parentNode._skipInsert=true;}
this.grid.callEvent("onCellChanged",[rid,this.cell._cellIndex,valAr]);}
dhtmlXGridObject.prototype._process_tree_xml=function(top,pid){this._parsing=true;var main=false;if(!pid){this.render_row=this.render_row_tree;main=true;pid=top.getAttribute("parent")||0;if(pid=="0")pid=0;if(!this._h2)this._h2=this._createHierarchy();if(this._fake)this._fake._h2=this._h2;}
var rows=dhx4.ajax.xpath(this.xml.row,top);this._open=this._open||[];for(var i=0;i<rows.length;i++){var id=rows[i].getAttribute("id");if(!id){id=this.uid();rows[i].setAttribute("id",id);}
var row=this._h2.add(id,pid);row.buff={idd:id,data:rows[i],_parser:this._process_xml_row,_locator:this._get_xml_data};if(rows[i].getAttribute("open")){row.state="minus";this._open.push(id);}
this.rowsAr[id]=row.buff;this._process_tree_xml(rows[i],id);}
if(main){if(!rows.length)this._h2.change(pid,"state",this._emptyLineImg);else if(pid!=0&&!this._srnd){this._h2.change(pid,"state","minus");}
for(var i=0;i<this._open.length;i++){var r=this._h2.get[this._open[i]];if(!r.childs.length)
r.state=this._emptyLineImg;};this._updateTGRState(this._h2.get[pid]);this._h2_to_buff();if(pid!=0&&this._srnd)this.openItem(pid);else{if(this.pagingOn)
this._renderSort();else
this.render_dataset();}
if(this.kidsXmlFile){for(var i=0;i<this._open.length;i++){var r=this._h2.get[this._open[i]];if(r._xml_await)
this.expandKids({idd:r.id});}}
this._open=[];if(this._slowParse===false){this.forEachRow(function(id){this.render_row_tree(0,id)})}
this._parsing=false;if(pid!=0&&!this._srnd){this.callEvent("onOpenEnd",[pid,1]);}}}
dhtmlXGridObject.prototype._h2_to_buff=function(top){if(!top){top=this._h2.get[0];this.rowsBuffer=new dhtmlxArray();if(this._fake&&!this._realfake)this._fake.rowsBuffer=this.rowsBuffer;}
for(var i=0;i<top.childs.length;i++){this.rowsBuffer.push(top.childs[i].buff);if(top.childs[i].state=="minus")
this._h2_to_buff(top.childs[i]);}};dhtmlXGridObject.prototype.render_row_tree=function(ind,id){if(id){var r=this._h2.get[id];r=r?r.buff:r;}else
var r=this.rowsBuffer[ind];if(!r)
return-1;if(r._parser){if(this.rowsAr[r.idd]&&this.rowsAr[r.idd].tagName=="TR")
return this._h2.get[r.idd].buff=this.rowsBuffer[ind]=this.rowsAr[r.idd];var row=this._prepareRow(r.idd);this.rowsAr[r.idd]=row;if(!id)
this.rowsBuffer[ind]=row;this._h2.get[r.idd].buff=row;r._parser.call(this,row,r.data);this._postRowProcessing(row);return row;}
return r;}
dhtmlXGridObject.prototype._removeTrGrRow=function(node,x){if(x){this._h2.forEachChild(x.id,function(x){this._removeTrGrRow(null,x);delete this.rowsAr[x.id];},this);return;}
var ind=this.getRowIndex(node.idd);var x=this._h2.get[node.idd];if(ind!=-1&&ind!==this.undefined){var len=1;if(x&&x.state=="minus")len+=this._getOpenLenght(x.id,0)
for(var i=0;i<len;i++)
if(this.rowsCol[i+ind])
this.rowsCol[i+ind].parentNode.removeChild(this.rowsCol[i+ind]);if(this._fake){for(var i=0;i<len;i++)
if(this._fake.rowsCol[i+ind])
this._fake.rowsCol[i+ind].parentNode.removeChild(this._fake.rowsCol[i+ind]);if(len>1)
this._fake.rowsCol.splice(ind+1,len-1);}
this.rowsCol.splice(ind,len);this.rowsBuffer.splice(ind,len);}
if(!x)return;this._removeTrGrRow(null,x);delete this.rowsAr[x.id];if(x.parent.childs.length==1){this._h2.change(x.parent.id,"state",this._emptyLineImg);this._updateTGRState(x.parent);}
this._h2.remove(x.id);}
dhtmlXGridObject.prototype.openItem=function(rowId){var y=this._h2.get[rowId||0];var x=this.getRowById(rowId||0);if(!x)return;if(y.parent&&y.parent.id!=0)
this.openItem(y.parent.id);this.expandKids(x);}
dhtmlXGridObject.prototype._addRowClassic=dhtmlXGridObject.prototype.addRow;dhtmlXGridObject.prototype.addRow=function(new_id,text,ind,parent_id,img,child){if(!this._h2)return this._addRowClassic(new_id,text,ind);parent_id=parent_id||0;var trcol=this.cellType._dhx_find("tree");if(typeof(text)=="string")text=text.split(this.delim);var row=this._h2.get[new_id];if(!row){if(parent_id==0)ind=this.rowsBuffer.length;else{ind=this.getRowIndex(parent_id)+1;if(this._h2.get[parent_id].state=="minus")
ind+=this._getOpenLenght(parent_id,0);else
this._skipInsert=true;}}
row=row||this._h2.add(new_id,parent_id);row.image=img;row.has_kids=child;return row.buff=this._addRowClassic(new_id,text,ind);}
dhtmlXGridObject.prototype.addRowBefore=function(new_id,text,sibl_id,img,child){var sb=this.rowsAr[sibl_id];if(!sb)return;if(!this._h2)return this.addRow(new_id,text,this.getRowIndex(sibl_id));var pid=this._h2.get[sibl_id].parent.id;var ind=this.getRowIndex(sibl_id);if(ind==-1)this._skipInsert=true;this._h2.addBefore(new_id,pid,sibl_id);return this.addRow(new_id,text,ind,this._h2.get[sibl_id].parent.id,img,child);}
dhtmlXGridObject.prototype.addRowAfter=function(new_id,text,sibl_id,img,child){var sb=this.rowsAr[sibl_id];if(!sb)return;if(!this._h2)return this.addRow(new_id,text,this.getRowIndex(sibl_id)+1);var pid=this._h2.get[sibl_id].parent.id;var ind=this.getRowIndex(sibl_id);if(ind==-1)this._skipInsert=true;if(this._h2.get[sibl_id].state=="minus")ind+=this._getOpenLenght(sibl_id,0)+1;else ind++;this._h2.addAfter(new_id,pid,sibl_id);return this.addRow(new_id,text,ind,pid,img,child);}
dhtmlXGridObject.prototype.enableSmartXMLParsing=function(mode){this._slowParse=dhx4.s2b(mode);};dhtmlXGridObject.prototype._copyTreeGridRowContent=function(frRow,from_row_id,to_row_id){var z=this.cellType._dhx_find("tree");for(i=0;i<frRow.cells.length;i++){if(i!=z)
this.cells(to_row_id,i).setValue(this.cells(from_row_id,i).getValue())
else
this.cells(to_row_id,i).setValueA(this.cells(from_row_id,i).getValue())}}
dhtmlXGridObject.prototype.closeItem=function(rowId){var x=this.getRowById(rowId);if(!x)return;this.collapseKids(x);}
dhtmlXGridObject.prototype.deleteChildItems=function(rowId){var z=this._h2.get[rowId];if(!z)return;while(z.childs.length)
this.deleteRow(z.childs[0].id);}
dhtmlXGridObject.prototype.getAllSubItems=function(rowId){var str=[];var z=this._h2.get[rowId||0];if(z)
for(var i=0;i<z.childs.length;i++){str.push(z.childs[i].id);if(z.childs[i].childs.length)
str=str.concat(this.getAllSubItems(z.childs[i].id).split(this.delim));}
return str.join(this.delim);}
dhtmlXGridObject.prototype.getChildItemIdByIndex=function(rowId,ind){var z=this._h2.get[rowId||0];if(!z)return null;return(z.childs[ind]?z.childs[ind].id:null);}
dhtmlXGridObject.prototype.getItemText=function(rowId){return this.cells(rowId,this.cellType._dhx_find("tree")).getLabel();}
dhtmlXGridObject.prototype.getOpenState=function(rowId){var z=this._h2.get[rowId||0];if(!z)return;if(z.state=="minus")return true;return false;}
dhtmlXGridObject.prototype.getParentId=function(rowId){var z=this._h2.get[rowId||0];if((!z)||(!z.parent))return null;return z.parent.id;}
dhtmlXGridObject.prototype.getSubItems=function(rowId){var str=[];var z=this._h2.get[rowId||0];if(z)
for(var i=0;i<z.childs.length;i++)
str.push(z.childs[i].id);return str.join(this.delim);}
dhtmlXGridObject.prototype.expandAll=function(rowId){this._renderAllExpand(rowId||0);this._h2_to_buff();this._reset_view();this.setSizes();this.callEvent("onGridReconstructed",[]);if(this._redrawLines)this._redrawLines();}
dhtmlXGridObject.prototype._renderAllExpand=function(z){var x=this._h2.get[z].childs;for(var i=0;i<x.length;i++){if(x[i].childs.length){this._h2.change(x[i].id,"state","minus")
this._updateTGRState(x[i]);this._renderAllExpand(x[i].id)}}}
dhtmlXGridObject.prototype.collapseAll=function(rowId){this._h2.forEachChild((rowId||0),function(z){if(z&&z.state=="minus"){z.state="plus";z.update=true;this._updateTGRState(z);}},this);this._h2_to_buff();this._reset_view();this.setSizes();this.callEvent("onGridReconstructed",[]);if(this._redrawLines)this._redrawLines();}
dhtmlXGridObject.prototype.hasChildren=function(rowId){var x=this._h2.get[rowId];if(x&&x.childs.length)return x.childs.length;if(x._xml_await)return-1;return 0;}
dhtmlXGridObject.prototype.setItemCloseable=function(rowId,status){var x=this._h2.get[rowId];if(!x)return;x._closeable=(!dhx4.s2b(status));}
dhtmlXGridObject.prototype.setItemText=function(rowId,newtext){return this.cells(rowId,this.cellType._dhx_find("tree")).setLabel(newtext);}
dhtmlXGridObject.prototype.setItemImage=function(rowId,url){this._h2.get[rowId].image=url;this.rowsAr[rowId].imgTag.nextSibling.src=(this.iconURL||"")+url;}
dhtmlXGridObject.prototype.setItemIcon=function(rowId,icon){this._h2.get[rowId].icon=icon;this.rowsAr[rowId].imgTag.nextSibling.className="dhx_treegrid_icon fa fa-"+icon;}
dhtmlXGridObject.prototype.getItemImage=function(rowId){this.getRowById(rowId);return this._h2.get[rowId].image;}
dhtmlXGridObject.prototype.getItemIcon=function(rowId){this.getRowById(rowId);return this._h2.get[rowId].icon;}
dhtmlXGridObject.prototype.setImageSize=function(width,height){this._img_width=width;this._img_height=height;}
dhtmlXGridObject.prototype._getRowImage=function(row){return this._h2.get[row.idd].image;}
dhtmlXGridObject.prototype.setOnOpenStartHandler=function(func){this.attachEvent("onOpenStart",func);};dhtmlXGridObject.prototype.setOnOpenEndHandler=function(func){this.attachEvent("onOpenEnd",func);};dhtmlXGridObject.prototype.enableTreeCellEdit=function(mode){this._edtc=!dhx4.s2b(mode);};dhtmlXGridObject.prototype.getLevel=function(rowId){var z=this._h2.get[rowId||0];if(!z)return-1;return z.level;}
dhtmlXGridObject.prototype._fixHiddenRowsAllTG=function(ind,state){for(i in this.rowsAr){if((this.rowsAr[i])&&(this.rowsAr[i].childNodes))
this.rowsAr[i].childNodes[ind].style.display=state;}}
dhtmlXGridObject.prototype._updateLine=function(z,row){row=row||this.rowsAr[z.id];if(!row)return;var im=row.imgTag;if(!im)return;if(z.state=="blank")return im.src=this.iconTree+"blank.gif";var n=1;if(z.index==0){if(z.level==0){if((z.parent.childs.length-1)>z.index)
n=3;else n=1;}
else
{if((z.parent.childs.length-1)>z.index)
n=3;else
n=2;}}
else
if((z.parent.childs.length-1)>z.index)
n=3;else
n=2;im.src=this.iconTree+z.state+n+".gif";}
dhtmlXGridObject.prototype._updateParentLine=function(z,row){row=row||this.rowsAr[z.id];if(!row)return;var im=row.imgTag;if(!im)return;for(var i=z.level;i>0;i--){if(z.id==0)break;im=im.previousSibling;z=z.parent;if((z.parent.childs.length-1)>z.index)
im.src=this.iconTree+"line1.gif";else
im.src=this.iconTree+"blank.gif";}}
dhtmlXGridObject.prototype._renderSortA=dhtmlXGridObject.prototype._renderSort;dhtmlXGridObject.prototype._renderSort=function(){this._renderSortA.apply(this,arguments);this._redrawLines(0)}
dhtmlXGridObject.prototype._redrawLines=function(id){if(this._tgle)
this._h2.forEachChild((id||0),function(z){this._updateLine(z);this._updateParentLine(z);},this);}
dhtmlXGridObject.prototype.enableTreeGridLines=function(){this._emptyLineImg="line";this._updateTGRState=function(z,force){if(force||!z.update||z.id==0)return;if(this._tgle)
this._updateLine(z,this.rowsAr[z.id]);z.update=false;}
this._tgle=true;this.attachEvent("onXLE",function(a,b,id){this._redrawLines(id)});this.attachEvent("onOpenEnd",function(id){this._redrawLines(id)});this.attachEvent("onRowAdded",function(id){var z=this._h2.get[id];this._updateLine(z);this._updateParentLine(z);if(z.index<(z.parent.childs.length-1)){z=z.parent.childs[z.index+1];this._updateLine(z);this._updateParentLine(z);}
else if(z.index!=0){z=z.parent.childs[z.index-1];this._updateLine(z);this._updateParentLine(z);if(z.childs.length)
this._h2.forEachChild(z.id,function(c_el){this._updateParentLine(c_el)},this)}});this.attachEvent("onOpen",function(id,state){if(state){var z=this._h2.get[id];for(var i=0;i<z.childs.length;i++)
this._updateParentLine(z.childs[i]);}
return true;});this.attachEvent("onBeforeRowDeleted",function(id){var self=this;var z=this._h2.get[id];var w=null;if(z.index!=0)
w=z.parent.childs[z.index-1];z=z.parent;window.setTimeout(function(){z=self._h2.get[z.id];if(!z)return;self._updateLine(z);self._updateParentLine(z);if(w){self._updateLine(w);if(w.state=="minus")
self._h2.forEachChild(w.id,function(z){self._updateParentLine(z);},self);}},1);return true;});}
dhtmlXGridObject.prototype.setFiltrationLevel=function(level,show_lower,show_upper){this._tr_strfltr=level;this._tr_fltr_c=show_lower;this._tr_fltr_d=show_upper;this.refreshFilters();}
dhtmlXGridObject.prototype.filterTreeBy=function(column,value,preserve){var origin=this._h2;if(typeof this._tr_strfltr=="undefined")this._tr_strfltr=-1;if(this._f_rowsBuffer){if(!preserve){this._h2=this._f_rowsBuffer;if(this._fake)this._fake._h2=this._h2;}}else
this._f_rowsBuffer=this._h2;var d=true;this.dma(true)
this._fbf={};if(typeof(column)=="object")
for(var j=0;j<value.length;j++)
this._filterTreeA(column[j],value[j]);else
this._filterTreeA(column,value);this._fbf=null;this.dma(false)
this._fix_filtered_images(this._h2,origin);this._renderSort()
this.callEvent("onGridReconstructed",[])}
dhtmlXGridObject.prototype._filterTreeA=function(column,value){if(value=="")return;var d=true;if(typeof(value)=="function")d=false;else value=(value||"").toString().toLowerCase();var add_line=function(el,s,t){var z=t.get[el.parent.id];if(!z)z=add_line(el.parent,s,t)
var t=temp.get[el.id];if(!t){t={id:el.id,childs:[],level:el.level,parent:z,index:z.childs.length,image:el.image,state:el.state,buff:el.buff,has_kids:el.has_kids,_xml_await:el._xml_await};z.childs.push(t);temp.get[t.id]=t;}
return t;}
var fbf=this._fbf;var temp=this._createHierarchy();var check;var mode=this._tr_strfltr;var that=this;var temp_c=function(el){for(var i=0;i<el.childs.length;i++)
that.temp(el.childs[i]);}
switch(mode.toString()){case"-2":check=function(el){if(fbf[el.id])return false;temp_c(el);return true;};break;case"-1":check=function(el){return!el.childs.length;};break;default:check=function(el){return mode==el.level};break;}
this.temp=function(el){if(el.id!=0&&check(el)){if(d?(this._get_cell_value(el.buff,column).toString().toLowerCase().indexOf(value)==-1):(!value(this._get_cell_value(el.buff,column),el.id))){fbf[el.id]=true;if(this._tr_fltr_c)add_line(el.parent,this._h2,temp);return false;}else{add_line(el,this._h2,temp);if(el.childs&&mode!=-2)
this._h2.forEachChild(el.id,function(cel){add_line(cel,this._h2,temp);},this)
return true;}}else{if(this._tr_fltr_d&&this._tr_strfltr>el.level&&el.id!=0)add_line(el,this._h2,temp);temp_c(el);}}
this.temp(this._h2.get[0]);this._h2=temp;if(this._fake)this._fake._h2=this._h2;}
dhtmlXGridObject.prototype._fix_filtered_images=function(temp,origin){temp.forEachChild(0,function(el){if(!el.childs.length&&!el.has_kids){if(el.state!=this._emptyLineImg){el.state=this._emptyLineImg;el.update=true;this._updateTGRState(el);}}else{if(el.buff.tagName=="TR"){var prev=origin.get[el.id];if(prev&&prev.state!=this._emptyLineImg)
el.state=prev.state;el.update=true;this._updateTGRState(el);}}},this)}
dhtmlXGridObject.prototype.collectTreeValues=function(column){if(typeof this._tr_strfltr=="undefined")this._tr_strfltr=-1;this.dma(true)
this._build_m_order();column=this._m_order?this._m_order[column]:column;var c={};var f=[];var col=this._f_rowsBuffer||this._h2;col.forEachChild(0,function(el){if(this._tr_strfltr==-2||(this._tr_strfltr==-1&&!el.childs.length)||(this._tr_strfltr==el.level)){var val=this._get_cell_value(el.buff,column);if(val)c[val]=true;}},this);this.dma(false)
var vals=this.combos[column];for(var d in c)
if(c[d]===true)f.push(vals?(vals.get(d)||d):d);return f.sort();}
dhtmlXGridObject.prototype._in_header_stat_tree_total=function(t,i,c){var calck=function(){var summ=0;this._build_m_order();var ii=this._m_order?this._m_order[i]:i;this._h2.forEachChild(0,function(el){var v=parseFloat(this._get_cell_value((el.buff||this.rowsAr[el.id]),ii));summ+=isNaN(v)?0:v;},this)
return this._maskArr[i]?this._aplNF(summ,i):(Math.round(summ*100)/100);}
this._stat_in_header(t,calck,i,c,c);}
dhtmlXGridObject.prototype._in_header_stat_tree_total_leaf=function(t,i,c){var calck=function(){var summ=0;this._build_m_order();var ii=this._m_order?this._m_order[i]:i;this._h2.forEachChild(0,function(el){if(el.childs.length)return;var v=parseFloat(this._get_cell_value((el.buff||this.rowsAr[el.id]),ii));summ+=isNaN(v)?0:v;},this)
return this._maskArr[i]?this._aplNF(summ,i):(Math.round(summ*100)/100);}
this._stat_in_header(t,calck,i,c,c);}
dhtmlXGridObject.prototype._in_header_stat_tree_multi_total=function(t,i,c){var cols=c[1].split(":");c[1]="";var calck=function(){var summ=0;this._h2.forEachChild(0,function(el){var v=parseFloat(this._get_cell_value((el.buff||this.rowsAr[el.id]),cols[0]))*parseFloat(this._get_cell_value((el.buff||this.rowsAr[el.id]),cols[1]));summ+=isNaN(v)?0:v;},this)
return this._maskArr[i]?this._aplNF(summ,i):(Math.round(summ*100)/100);}
this._stat_in_header(t,calck,i,c,c);}
dhtmlXGridObject.prototype._in_header_stat_tree_multi_total_leaf=function(t,i,c){var cols=c[1].split(":");c[1]="";var calck=function(){var summ=0;this._h2.forEachChild(0,function(el){if(el.childs.length)return;var v=parseFloat(this._get_cell_value((el.buff||this.rowsAr[el.id]),cols[0]))*parseFloat(this._get_cell_value((el.buff||this.rowsAr[el.id]),cols[1]));summ+=isNaN(v)?0:v;},this)
return this._maskArr[i]?this._aplNF(summ,i):(Math.round(summ*100)/100);}
this._stat_in_header(t,calck,i,c,c);}
dhtmlXGridObject.prototype._in_header_stat_tree_max=function(t,i,c){var calck=function(){var summ=-999999999;this._build_m_order();var ii=this._m_order?this._m_order[i]:i;if(this.getRowsNum()==0)return"";this._h2.forEachChild(0,function(el){var d=parseFloat(this._get_cell_value((el.buff||this.rowsAr[el.id]),ii));if(!isNaN(d))
summ=Math.max(summ,d);},this)
return this._maskArr[i]?this._aplNF(summ,i):summ;}
this._stat_in_header(t,calck,i,c);}
dhtmlXGridObject.prototype._in_header_stat_tree_min=function(t,i,c){var calck=function(){var summ=999999999;this._build_m_order();var ii=this._m_order?this._m_order[i]:i;if(this.getRowsNum()==0)return"";this._h2.forEachChild(0,function(el){var d=parseFloat(this._get_cell_value((el.buff||this.rowsAr[el.id]),ii));if(!isNaN(d))
summ=Math.min(summ,d);},this)
return this._maskArr[i]?this._aplNF(summ,i):summ;}
this._stat_in_header(t,calck,i,c);}
dhtmlXGridObject.prototype._in_header_stat_tree_average=function(t,i,c){var calck=function(){var summ=0;var count=0;this._build_m_order();var ii=this._m_order?this._m_order[i]:i;this._h2.forEachChild(0,function(el){var v=parseFloat(this._get_cell_value((el.buff||this.rowsAr[el.id]),ii));summ+=isNaN(v)?0:v;count++;},this)
return this._maskArr[i]?this._aplNF(summ,i):(Math.round(summ/count*100)/100);}
this._stat_in_header(t,calck,i,c);}
dhtmlXGridObject.prototype._in_header_stat_tree_max_leaf=function(t,i,c){var calck=function(){var summ=-999999999;this._build_m_order();var ii=this._m_order?this._m_order[i]:i;if(this.getRowsNum()==0)return"";this._h2.forEachChild(0,function(el){if(el.childs.length)return;var d=parseFloat(this._get_cell_value((el.buff||this.rowsAr[el.id]),ii));if(!isNaN(d))
summ=Math.max(summ,d);},this)
return this._maskArr[i]?this._aplNF(summ,i):summ;}
this._stat_in_header(t,calck,i,c);}
dhtmlXGridObject.prototype._in_header_stat_tree_min_leaf=function(t,i,c){var calck=function(){var summ=999999999;this._build_m_order();var ii=this._m_order?this._m_order[i]:i;if(this.getRowsNum()==0)return"";this._h2.forEachChild(0,function(el){if(el.childs.length)return;var d=parseFloat(this._get_cell_value((el.buff||this.rowsAr[el.id]),ii));if(!isNaN(d))
summ=Math.min(summ,d);},this)
return this._maskArr[i]?this._aplNF(summ,i):summ;}
this._stat_in_header(t,calck,i,c);}
dhtmlXGridObject.prototype._in_header_stat_tree_average_leaf=function(t,i,c){var calck=function(){var summ=0;var count=0;this._build_m_order();var ii=this._m_order?this._m_order[i]:i;this._h2.forEachChild(0,function(el){if(el.childs.length)return;var v=parseFloat(this._get_cell_value((el.buff||this.rowsAr[el.id]),ii));summ+=isNaN(v)?0:v;count++;},this)
return this._maskArr[i]?this._aplNF(summ,i):(Math.round(summ/count*100)/100);}
this._stat_in_header(t,calck,i,c);}
dhtmlXGridObject.prototype._in_header_stat_tree_count=function(t,i,c){var calck=function(){var count=0;this._h2.forEachChild(0,function(el){count++;},this)
return count;}
this._stat_in_header(t,calck,i,c);}
dhtmlXGridObject.prototype._in_header_stat_tree_count_leaf=function(t,i,c){var calck=function(){var count=0;this._h2.forEachChild(0,function(el){if(!el.childs.length)count++;},this)
return count;}
this._stat_in_header(t,calck,i,c);}
dhtmlXGridObject.prototype._stat_in_header=function(t,calck,i,c){var that=this;var f=function(){this.dma(true)
t.innerHTML=(c[0]?c[0]:"")+calck.call(this)+(c[1]?c[1]:"");this.dma(false)
this.callEvent("onStatReady",[])}
if(!this._stat_events){this._stat_events=[];this.attachEvent("onClearAll",function(){if(!this.hdr.rows[1]){for(var i=0;i<this._stat_events.length;i++)
for(var j=0;j<4;j++)
this.detachEvent(this._stat_events[i][j]);this._stat_events=[];}})}
this._stat_events.push([this.attachEvent("onGridReconstructed",f),this.attachEvent("onXLE",f),this.attachEvent("onFilterEnd",f),this.attachEvent("onEditCell",function(stage,id,ind){if(stage==2&&ind==i)f.call(this);return true;})]);t.innerHTML="";}
dhtmlXGridObject.prototype._build_m_order=function(){if(this._c_order){this._m_order=[]
for(var i=0;i<this._c_order.length;i++){this._m_order[this._c_order[i]]=i;};}}
if(!window.dhtmlx)
window.dhtmlx={};(function(){var _dhx_msg_cfg=null;function callback(config,result){var usercall=config.callback;modality(false);config.box.parentNode.removeChild(config.box);_dhx_msg_cfg=config.box=null;if(usercall)
usercall(result);}
function modal_key(e){if(_dhx_msg_cfg){e=e||event;var code=e.which||event.keyCode;if(dhtmlx.message.keyboard){if(code==13||code==32)
callback(_dhx_msg_cfg,true);if(code==27)
callback(_dhx_msg_cfg,false);}
if(e.preventDefault)
e.preventDefault();return!(e.cancelBubble=true);}}
if(document.attachEvent)
document.attachEvent("onkeydown",modal_key);else
document.addEventListener("keydown",modal_key,true);function modality(mode){if(!modality.cover){modality.cover=document.createElement("DIV");modality.cover.onkeydown=modal_key;modality.cover.className="dhx_modal_cover";document.body.appendChild(modality.cover);}
var height=document.body.scrollHeight;modality.cover.style.display=mode?"inline-block":"none";}
function button(text,result){return"<div class='dhtmlx_popup_button' result='"+result+"' ><div>"+text+"</div></div>";}
function info(text){if(!t.area){t.area=document.createElement("DIV");t.area.className="dhtmlx_message_area";t.area.style[t.position]="15px";document.body.appendChild(t.area);}
t.hide(text.id);var message=document.createElement("DIV");message.innerHTML="<div>"+text.text+"</div>";message.className="dhtmlx-info dhtmlx-"+text.type;message.onclick=function(){if(text)t.hide(text.id);text=null;};if(t.position=="bottom"&&t.area.firstChild)
t.area.insertBefore(message,t.area.firstChild);else
t.area.appendChild(message);if(text.expire>0)
t.timers[text.id]=window.setTimeout(function(){t.hide(text.id);},text.expire);t.pull[text.id]=message;message=null;return text.id;}
function _boxStructure(config,ok,cancel){var box=document.createElement("DIV");box.className=" dhtmlx_modal_box dhtmlx-"+config.type;box.setAttribute("dhxbox",1);var inner='';if(config.width)
box.style.width=config.width;if(config.height)
box.style.height=config.height;if(config.title)
inner+='<div class="dhtmlx_popup_title">'+config.title+'</div>';inner+='<div class="dhtmlx_popup_text"><span>'+(config.content?'':config.text)+'</span></div><div  class="dhtmlx_popup_controls">';if(ok)
inner+=button(config.ok||"OK",true);if(cancel)
inner+=button(config.cancel||"Cancel",false);if(config.buttons){for(var i=0;i<config.buttons.length;i++)
inner+=button(config.buttons[i],i);}
inner+='</div>';box.innerHTML=inner;if(config.content){var node=config.content;if(typeof node=="string")
node=document.getElementById(node);if(node.style.display=='none')
node.style.display="";box.childNodes[config.title?1:0].appendChild(node);}
box.onclick=function(e){e=e||event;var source=e.target||e.srcElement;if(!source.className)source=source.parentNode;if(source.className=="dhtmlx_popup_button"){var result=source.getAttribute("result");result=(result=="true")||(result=="false"?false:result);callback(config,result);}};config.box=box;if(ok||cancel)
_dhx_msg_cfg=config;return box;}
function _createBox(config,ok,cancel){var box=config.tagName?config:_boxStructure(config,ok,cancel);if(!config.hidden)
modality(true);document.body.appendChild(box);var x=config.left||Math.abs(Math.floor(((window.innerWidth||document.documentElement.offsetWidth)-box.offsetWidth)/2));var y=config.top||Math.abs(Math.floor(((window.innerHeight||document.documentElement.offsetHeight)-box.offsetHeight)/2));if(config.position=="top")
box.style.top="-3px";else
box.style.top=y+'px';box.style.left=x+'px';box.onkeydown=modal_key;box.focus();if(config.hidden)
dhtmlx.modalbox.hide(box);return box;}
function alertPopup(config){return _createBox(config,true,false);}
function confirmPopup(config){return _createBox(config,true,true);}
function boxPopup(config){return _createBox(config);}
function box_params(text,type,callback){if(typeof text!="object"){if(typeof type=="function"){callback=type;type="";}
text={text:text,type:type,callback:callback};}
return text;}
function params(text,type,expire,id){if(typeof text!="object"||!text)
text={text:text,type:type,expire:expire,id:id};text.id=text.id||t.uid();text.expire=text.expire||t.expire;return text;}
dhtmlx.alert=function(){var text=box_params.apply(this,arguments);text.type=text.type||"confirm";return alertPopup(text);};dhtmlx.confirm=function(){var text=box_params.apply(this,arguments);text.type=text.type||"alert";return confirmPopup(text);};dhtmlx.modalbox=function(){var text=box_params.apply(this,arguments);text.type=text.type||"alert";return boxPopup(text);};dhtmlx.modalbox.hide=function(node){while(node&&node.getAttribute&&!node.getAttribute("dhxbox"))
node=node.parentNode;if(node){node.parentNode.removeChild(node);modality(false);_dhx_msg_cfg=null;}};var t=dhtmlx.message=function(text,type,expire,id){text=params.apply(this,arguments);text.type=text.type||"info";var subtype=text.type.split("-")[0];switch(subtype){case"alert":return alertPopup(text);case"confirm":return confirmPopup(text);case"modalbox":return boxPopup(text);default:return info(text);break;}};t.seed=(new Date()).valueOf();t.uid=function(){return t.seed++;};t.expire=4000;t.keyboard=true;t.position="top";t.pull={};t.timers={};t.hideAll=function(){for(var key in t.pull)
t.hide(key);};t.hide=function(id){var obj=t.pull[id];if(obj&&obj.parentNode){window.setTimeout(function(){obj.parentNode.removeChild(obj);obj=null;},2000);obj.className+=" hidden";if(t.timers[id])
window.clearTimeout(t.timers[id]);delete t.pull[id];}};})();;

/* /base_openprod/static/src/js/document_openprod.js defined in bundle 'web.assets_backend' */
"use strict"
odoo.define('document.openprod',function(require){var core=require('web.core');var View=require('web.View');var Model=require('web.Model');var time=require('web.time');var formats=require('web.formats');var _t=core._t;var DirectoryView=View.extend({display_name:'Directories',multi:false,searchable:false,multi_record:true,icon:'folder-o',view_type:'directory',view_loading:function(fvg){this.do_push_state({});return this.load_directories();},load_directories:function(){var self=this;var myMenu=new dhtmlXMenuObject();myMenu.setIconsPath("/base_openprod/static/lib/imgs/");myMenu.renderAsContextMenu();myMenu.attachEvent("onClick",function(menuId,type){return self.onButtonClick(menuId,type);});var myTreeGrid=this.grid=new dhtmlXGridObject(this.$el[0]);myTreeGrid.setImagePath("/base_openprod/static/lib/imgs/");myTreeGrid.setHeader(_t("Name")+","+_t("Type")+","+_t("Version")+","+_t("Status")+","+_t("User")+","+_t("Modif")+","+_t("Document")+","+_t("File"));myTreeGrid.setColTypes("tree,ro,ro,ro,ro,ro,link,link");myTreeGrid.setColSorting("str,str,str,str,str,str,na,na");myTreeGrid.setInitWidths("*,*,100,*");myTreeGrid.setStyle("background-color:#f0eeee;color:black; font-weight:bold;font-family:\"Lucida Grande\", Helvetica, Verdana, Arial, sans-serif","","","");myTreeGrid.enableAutoWidth(true);myTreeGrid.enableAutoHeight(true);myTreeGrid.enableContextMenu(myMenu);myTreeGrid.enableDragAndDrop(true);myTreeGrid.init();myMenu.addNewChild(myMenu.topId,null,'new_dir','New Dir');myMenu.addNewChild(myMenu.topId,null,'delete','Delete');this.menu=myMenu;this.grid=myTreeGrid;this.grid.attachEvent("onBeforeContextMenu",function(id,ind,obj){self.menu_target=id;if(id.indexOf('dir_')==0){self.menu.setItemEnabled('new_dir');if(self.grid.hasChildren(id)){self.menu.setItemDisabled('delete');}else{self.menu.setItemEnabled('delete');}}else{self.menu.setItemDisabled('new_dir');}
return true;});this.grid.attachEvent('onEditCell',function(stage,row_id,cell_id,new_value,old_value){if(stage==0){if(cell_id!=0){return false;}
return true;}else if(stage==1){}else if(stage==2){var model=(row_id.indexOf('dir_')==0)?'document.directory':'document.openprod';var dir_obj=new Model(model);var dir_id=parseInt(row_id.slice(4));dir_obj.call('write',[dir_id,{name:new_value,}]).then(null,function(){self.grid.setItemText(row_id,old_value)});return true;}});this.grid.attachEvent("onDrag",function(source_id,target_id){var source_parent_id=self.grid.getParentId(source_id);var model=(source_id.indexOf('dir_')==0)?'document.directory':'document.openprod';var dir_obj=new Model(model);var elem_id=parseInt(source_id.slice(4));var new_parent_id=(target_id!=undefined&&parseInt(target_id.slice(4)))||0;var vals={};if(source_id.indexOf('dir_')==0){vals['parent_id']=new_parent_id;}else{vals['directory_id']=new_parent_id;}
dir_obj.call('write',[elem_id,vals]).then(null,function(res){self.grid.moveRowTo(source_id,source_parent_id,'move','child');});return true;});this.grid.attachEvent("onDragIn",function(source_id,target_id){if(target_id==undefined){return true;}
if(target_id.indexOf('dir_')==0){return true;}else{return false;}});},onButtonClick:function(menuitemId,type){var dir_obj=new Model('document.directory');var parent_id=parseInt(this.menu_target.slice(4));var self=this;if(menuitemId=='new_dir'){var def=dir_obj.call('create',[{parent_id:parent_id,name:'New Dir',}]).then(function(res){dir_obj.query().filter([['id','=',res]]).first().then(function(row){self.grid.addRow('dir_'+res,row.name,null,'dir_'+row.parent_id[0],'folder.gif');});});}else if(menuitemId=='delete'){if(this.menu_target.indexOf('dir_')==0){var def=dir_obj.call('unlink',[parent_id]).then(function(res){self.grid.deleteRow(self.menu_target);});}else{(new Model('document.openprod')).call('unlink',[parent_id]).then(function(res){self.grid.deleteRow(self.menu_target);});}}},do_show:function(){var self=this;var directories=new Model('document.directory').query().all();var documents=new Model('document.openprod').query(['name','version','state','write_date','directory_id','fname']).filter([['directory_id','!=',false],['state','!=','obsolete']]).all();$.when(directories,documents).then(function(directories,documents){var res=directories.concat(documents);var rows=self.unflatten(res);self.grid.clearAll();self.grid.parse({rows:rows},'json');return true;});return this._super();},unflatten:function(array,parent){var self=this;var tree=[];parent=typeof parent!=='undefined'?parent:{id:0};if('directory_id'in parent){return[];}
var children=_.filter(array,function(child){if('parent_id'in child)
return(child.parent_id[0]||0)==parent.id;else
return(child.directory_id[0]||0)==parent.id;});return _.map(children,function(child){var directory=!('directory_id'in child);var val=directory?{"value":child.name,"image":"folder.gif"}:child.name;var document=directory?null:"Document^#id="+child.id+"&view_type=form&model=document.openprod^_self";var link=directory?null:child.fname+'^/web/content/document.openprod/'+child.id+'/attachment/'+child.fname+'^_blank';return{id:(directory?'dir_':'doc_')+child.id,rows:self.unflatten(array,child),data:[val,child.type_id&&child.type_id[1],child.version,_t(child.state),child.user_id&&child.user_id[1],formats.format_value(child.write_date,{type:'datetime'}),document,link,],}})},});core.view_registry.add('directory',DirectoryView);});;

/* /board/static/src/js/dashboard.js defined in bundle 'web.assets_backend' */
odoo.define('board.dashboard',function(require){"use strict";var ActionManager=require('web.ActionManager');var core=require('web.core');var data=require('web.data');var Dialog=require('web.Dialog');var FavoriteMenu=require('web.FavoriteMenu');var form_common=require('web.form_common');var Model=require('web.DataModel');var pyeval=require('web.pyeval');var ViewManager=require('web.ViewManager');var _t=core._t;var QWeb=core.qweb;var DashBoard=form_common.FormWidget.extend({events:{'click .oe_dashboard_link_change_layout':'on_change_layout','click h2.oe_header span.oe_header_txt':function(ev){if(ev.target===ev.currentTarget)
this.on_header_string($(ev.target).parent());},'click .oe_dashboard_column .oe_fold':'on_fold_action','click .oe_dashboard_column .oe_close':'on_close_action',},init:function(view,node){this._super(view,node);this.form_template='DashBoard';this.actions_attrs={};this.action_managers=[];},start:function(){var self=this;this._super.apply(this,arguments);this.$el.addClass('o_dashboard');this.$('.oe_dashboard_column').sortable({connectWith:'.oe_dashboard_column',handle:'.oe_header',scroll:false}).bind('sortstop',self.do_save_dashboard);var old_title=this.__parentedParent.get('title');this.__parentedParent.on('load_record',self,function(){self.__parentedParent.set({'title':old_title});});_.each(this.node.children,function(column,column_index){_.each(column.children,function(action,action_index){delete(action.attrs.width);delete(action.attrs.height);delete(action.attrs.colspan);var action_id=_.str.toNumber(action.attrs.name);if(!_.isNaN(action_id)){self.rpc('/web/action/load',{action_id:action_id}).done(function(result){self.on_load_action(result,column_index+'_'+action_index,action.attrs);});}});});},on_header_string:function(h2){var self=this;var span=h2.find('span:first').hide();var input=h2.find('.oe_header_text').css('visibility','visible');var attr=h2.closest(".oe_action").data('action_attrs');var change_string=function(new_name){attr['string']=new_name;span.text(new_name).show();input.css('visibility','hidden');self.do_save_dashboard();};input.unbind().val(span.text()).change(function(event){change_string($(this).val());}).keyup(function(event){if(event.keyCode==27){input.css('visibility','hidden');span.show();}});},on_change_layout:function(){var self=this;var qdict={current_layout:this.$el.find('.oe_dashboard').attr('data-layout')};var dialog=new Dialog(this,{title:_t("Edit Layout"),$content:QWeb.render('DashBoard.layouts',qdict)}).open();dialog.$el.find('li').click(function(){var layout=$(this).attr('data-layout');self.do_change_layout(layout);dialog.close();});},do_change_layout:function(new_layout){var $dashboard=this.$el.find('.oe_dashboard');var current_layout=$dashboard.attr('data-layout');if(current_layout!=new_layout){var clayout=current_layout.split('-').length,nlayout=new_layout.split('-').length,column_diff=clayout-nlayout;if(column_diff>0){var $last_column=$();$dashboard.find('.oe_dashboard_column').each(function(k,v){if(k>=nlayout){$(v).find('.oe_action').appendTo($last_column);}else{$last_column=$(v);}});}
$dashboard.toggleClass('oe_dashboard_layout_'+current_layout+' oe_dashboard_layout_'+new_layout);$dashboard.attr('data-layout',new_layout);this.do_save_dashboard();}},on_fold_action:function(e){var $e=$(e.currentTarget),$action=$e.parents('.oe_action:first'),id=parseInt($action.attr('data-id'),10);if($e.is('.oe_minimize')){$action.data('action_attrs').fold='1';}else{delete($action.data('action_attrs').fold);}
$e.toggleClass('oe_minimize oe_maximize');$action.find('.oe_content').toggle();this.do_save_dashboard();},on_close_action:function(e){if(confirm(_t("Are you sure you want to remove this item ?"))){$(e.currentTarget).parents('.oe_action:first').remove();this.do_save_dashboard();}},do_save_dashboard:function(){var board={form_title:this.view.fields_view.arch.attrs.string,style:this.$el.find('.oe_dashboard').attr('data-layout'),columns:[]};this.$el.find('.oe_dashboard_column').each(function(){var actions=[];$(this).find('.oe_action').each(function(){var action_id=$(this).attr('data-id'),new_attrs=_.clone($(this).data('action_attrs'));if(new_attrs.domain){new_attrs.domain=new_attrs.domain_string;delete(new_attrs.domain_string);}
if(new_attrs.context){new_attrs.context=new_attrs.context_string;delete(new_attrs.context_string);}
actions.push(new_attrs);});board.columns.push(actions);});var arch=QWeb.render('DashBoard.xml',board);this.rpc('/web/view/add_custom',{view_id:this.view.fields_view.view_id,arch:arch});},on_load_action:function(result,index,action_attrs){var self=this,action=result,view_mode=action_attrs.view_mode;action_attrs.context_string=action_attrs.context;action_attrs.context=pyeval.eval('context',action_attrs.context||{});action_attrs.domain_string=action_attrs.domain;action_attrs.domain=pyeval.eval('domain',action_attrs.domain||[],action_attrs.context);if(action_attrs.context['dashboard_merge_domains_contexts']===false){action.context=action_attrs.context||{};action.domain=action_attrs.domain||[];}else{action.context=pyeval.eval('contexts',[action.context||{},action_attrs.context]);action.domain=pyeval.eval('domains',[action_attrs.domain,action.domain||[]],action.context);}
var action_orig=_.extend({flags:{}},action);if(view_mode&&view_mode!=action.view_mode){action.views=_.map(view_mode.split(','),function(mode){mode=mode==='tree'?'list':mode;return _(action.views).find(function(view){return view[1]==mode;})||[false,mode];});}
action.flags={search_view:true,sidebar:false,views_switcher:false,action_buttons:false,pager:false,headless:true,low_profile:true,display_title:false,search_disable_custom_filters:true,list:{selectable:false}};var am=new ActionManager(this),$action=$('#'+this.view.element_id+'_action_'+index);$action.parent().data('action_attrs',action_attrs);this.action_managers.push(am);am.appendTo($action);am.do_action(action);am.do_action=function(action){self.do_action(action);};if(am.inner_widget){var new_form_action=function(id,editable){var new_views=[];_.each(action_orig.views,function(view){new_views[view[1]==='form'?'unshift':'push'](view);});if(!new_views.length||new_views[0][1]!=='form'){new_views.unshift([false,'form']);}
action_orig.views=new_views;action_orig.res_id=id;action_orig.flags={form:{"initial_mode":editable?"edit":"view",}};self.do_action(action_orig);};var list=am.inner_widget.views.list;if(list){list.created.done(function(){$(list.controller.groups).off('row_link').on('row_link',function(e,id){new_form_action(id);});});}
var kanban=am.inner_widget.views.kanban;if(kanban){kanban.created.done(function(){kanban.controller.open_record=function(event,editable){new_form_action(event.data.id,editable);};});}}},renderElement:function(){this._super();var check=_.detect(this.node.children,function(column,column_index){return _.detect(column.children,function(element){return element.tag==="action"?element:false;});});if(!check){return this.no_result();}
for(var i=this.node.children.length;i<3;i++){this.node.children.push({tag:'column',attrs:{},children:[]});}
var rendered=QWeb.render(this.form_template,this);this.$el.html(rendered);},no_result:function(){if(this.view.options.action.help){this.$el.append($('<div class="oe_view_nocontent">').append($('<div>').html(this.view.options.action.help||" ")));}},do_reload:function(){var view_manager=this.view.getParent(),action_manager=view_manager.getParent();this.view.destroy();action_manager.do_action(view_manager.action);}});var DashBoardLegacy=DashBoard.extend({renderElement:function(){if(this.node.tag=='hpaned'){this.node.attrs.layout='2-1';}else if(this.node.tag=='vpaned'){this.node.attrs.layout='1';}
this.node.tag='board';_.each(this.node.children,function(child){if(child.tag.indexOf('child')===0){child.tag='column';var actions=[],first_child=child.children[0];if(first_child&&first_child.tag=='vpaned'){_.each(first_child.children,function(subchild){actions.push.apply(actions,subchild.children);});child.children=actions;}}});this._super(this);}});core.form_tag_registry.add('hpaned',DashBoardLegacy).add('vpaned',DashBoardLegacy).add('board',DashBoard);FavoriteMenu.include({prepare_dropdown_menu:function(filters){var self=this;this._super(filters);var am=this.findAncestor(function(a){return a instanceof ActionManager;});if(am&&am.get_inner_widget()instanceof ViewManager){this.view_manager=am.get_inner_widget();this.add_to_dashboard_available=true;this.$('.o_favorites_menu').append(QWeb.render('SearchView.addtodashboard'));this.$add_to_dashboard=this.$('.o_add_to_dashboard');this.$add_dashboard_btn=this.$add_to_dashboard.eq(2).find('button');this.$add_dashboard_input=this.$add_to_dashboard.eq(0).find('input');this.$add_dashboard_link=this.$('.o_add_to_dashboard_link');this.$add_dashboard_select=this.$add_to_dashboard.eq(1).find('select');this.dashboard_list=new Model('ir.actions.act_window').query().filter([['res_model','=','board.board']]).all().then($.proxy(this.add_board_list,this));var title=this.searchview.get_title();this.$add_dashboard_input.val(title);this.$add_dashboard_link.click(function(e){e.preventDefault();self.toggle_dashboard_menu();});this.$add_dashboard_btn.click(this.proxy('add_dashboard'));}},toggle_dashboard_menu:function(is_open){this.$add_dashboard_link.toggleClass('o_closed_menu',!(_.isUndefined(is_open))?!is_open:undefined).toggleClass('o_open_menu',is_open);this.$add_to_dashboard.toggle(is_open);if(this.$add_dashboard_link.hasClass('o_open_menu')){this.$add_dashboard_input.focus();}},close_menus:function(){if(this.add_to_dashboard_available){this.toggle_dashboard_menu(false);}
this._super();},add_dashboard:function(){var self=this;var search_data=this.searchview.build_search_data(),context=new data.CompoundContext(this.searchview.dataset.get_context()||[]),domain=new data.CompoundDomain(this.searchview.dataset.get_domain()||[]);_.each(search_data.contexts,context.add,context);_.each(search_data.domains,domain.add,domain);context.add({group_by:pyeval.eval('groupbys',search_data.groupbys||[])});context.add(this.view_manager.active_view.controller.get_context());var c=pyeval.eval('context',context);for(var k in c){if(c.hasOwnProperty(k)&&/^search_default_/.test(k)){delete c[k];}}
this.toggle_dashboard_menu(false);c.dashboard_merge_domains_contexts=false;var d=pyeval.eval('domain',domain),board=new Model('board.board'),name=self.$add_dashboard_input.val();return self.rpc('/board/add_to_dashboard',{action_id:self.action_id,context_to_save:c,domain:d,view_mode:self.view_manager.active_view.type,name:name,dashboard_action_id:parseInt(self.$add_dashboard_select.val()),}).then(function(r){if(r){self.do_notify(_.str.sprintf(_t("'%s' added to dashboard"),name),'');}else{self.do_warn(_t("Could not add filter to dashboard"));}});},add_board_list:function(boards){var self=this;_.each(boards,function(board){var option=self.$add_dashboard_select.append('<option value="'+board.id+'">'+board.name+'</option>');option.data(board);});},});});;

/* /calendar/static/src/js/calendar.js defined in bundle 'web.assets_backend' */
odoo.define('calendar',function(require){"use strict";var CalendarView=require('web_calendar.CalendarView');var Model=require('web.DataModel');var widgets=require('web_calendar.widgets');var core=require('web.core');var _t=core._t;widgets.SidebarFilter.include({events_loaded:function(){var res=this._super();var self=this;var res2=new Model('mrp.resource').query().filter([['calendar_id','=',parseInt(Object.keys(this.view.all_filters)[0])]]).all().then(function(res){self.view.$('.resource_list').remove();self.view.$('.o_calendar_sidebar').append('\
                		<div class="resource_list">\
                			<h3>'+_t('Resources')+'</h3>\
                			<ul>'
+_.map(res,function(resource){return'<li>'+resource.name+'</li>';}).join('')+'</ul>\
                		</div>');});return res;}});});;

/* /calendar_event/static/src/js/base_calendar.js defined in bundle 'web.assets_backend' */
odoo.define('base_calendar.base_calendar',function(require){"use strict";var core=require('web.core');var CalendarView=require('web_calendar.CalendarView');var data=require('web.data');var Dialog=require('web.Dialog');var form_common=require('web.form_common');var Model=require('web.DataModel');var Notification=require('web.notification').Notification;var session=require('web.session');var WebClient=require('web.WebClient');var widgets=require('web_calendar.widgets');var FieldMany2ManyTags=core.form_widget_registry.get('many2many_tags');var _t=core._t;var _lt=core._lt;var QWeb=core.qweb;function reload_favorite_list(result){var self=result;var current=result;if(result.view){self=result.view;}
return new Model("res.users").query(["partner_id"]).filter([["id","=",self.dataset.context.uid]]).first().done(function(result){var sidebar_items={};var filter_value=result.partner_id[0];var filter_item={value:filter_value,label:result.partner_id[1]+_lt(" [Me]"),color:self.get_color(filter_value),avatar_model:self.avatar_model,is_checked:true,is_remove:false,};sidebar_items[filter_value]=filter_item;filter_item={value:-1,label:_lt("Everybody's calendars"),color:self.get_color(-1),avatar_model:self.avatar_model,is_checked:false};sidebar_items[-1]=filter_item;new Model("calendar.contacts").query(["partner_id"]).filter([["user_id","=",self.dataset.context.uid]]).all().then(function(result){_.each(result,function(item){filter_value=item.partner_id[0];filter_item={value:filter_value,label:item.partner_id[1],color:self.get_color(filter_value),avatar_model:self.avatar_model,is_checked:true};sidebar_items[filter_value]=filter_item;});self.all_filters=sidebar_items;self.now_filter_ids=$.map(self.all_filters,function(o){return o.value;});self.sidebar.filter.events_loaded(self.get_all_filters_ordered());self.sidebar.filter.set_filters();self.sidebar.filter.add_favorite_calendar();self.sidebar.filter.destroy_filter();}).done(function(){self.$calendar.fullCalendar('refetchEvents');if(current.ir_model_m2o){current.ir_model_m2o.set_value(false);}});});}
CalendarView.include({extraSideBar:function(){var result=this._super();if(this.useContacts){return result.then(reload_favorite_list(this));}
return result;},get_all_filters_ordered:function(){var filters=this._super();if(this.useContacts){var filter_me=_.first(_.values(this.all_filters));var filter_all=this.all_filters[-1];filters=[].concat(filter_me,_.difference(filters,[filter_me,filter_all]),filter_all);}
return filters;}});widgets.SidebarFilter.include({events_loaded:function(){this._super.apply(this,arguments);this.reinitialize_m2o();},add_favorite_calendar:function(){if(this.dfm)
return;this.initialize_m2o();},reinitialize_m2o:function(){if(this.dfm){this.dfm.destroy();this.dfm=undefined;}
this.initialize_m2o();},initialize_m2o:function(){var self=this;this.dfm=new form_common.DefaultFieldManager(self);this.dfm.extend_field_desc({partner_id:{relation:"res.users",},});var FieldMany2One=core.form_widget_registry.get('many2one');this.ir_model_m2o=new FieldMany2One(self.dfm,{attrs:{class:'o_add_favorite_calendar',name:"partner_id",type:"many2one",options:'{"no_open": True}',placeholder:_t("Add Favorite Calendar"),},});this.ir_model_m2o.appendTo(this.$el);this.ir_model_m2o.on('change:value',self,function(){self.add_filter();});},add_filter:function(){var self=this;var defs=[];defs.push(new Model("res.users").query(["partner_id"]).filter([["id","=",this.view.dataset.context.uid]]).first().done(function(result){$.map(self.ir_model_m2o.display_value,function(element,index){if(result.partner_id[0]!=index){self.ds_message=new data.DataSetSearch(self,'calendar.contacts');defs.push(self.ds_message.call("create",[{'partner_id':index}]));}});}));return $.when.apply(null,defs).then(function(){return reload_favorite_list(self);});},destroy_filter:function(e){var self=this;this.$(".oe_remove_follower").on('click',function(e){self.ds_message=new data.DataSetSearch(self,'calendar.contacts');var id=$(e.currentTarget)[0].dataset.id;Dialog.confirm(self,_t("Do you really want to delete this filter from favorite?"),{confirm_callback:function(){self.ds_message.call('search',[[['partner_id','=',parseInt(id)]]]).then(function(record){return self.ds_message.unlink(record);}).done(function(){reload_favorite_list(self);});},});});},});var CalendarNotification=Notification.extend({template:"CalendarNotification",init:function(parent,title,text,eid){this._super(parent,title,text,true);this.eid=eid;this.events=_.extend(this.events||{},{'click .link2event':function(){var self=this;this.rpc("/web/action/load",{action_id:"calendar_event.action_calendar_event_notify",}).then(function(r){r.res_id=self.eid;return self.do_action(r);});},'click .link2recall':function(){this.destroy(true);},'click .link2showed':function(){this.destroy(true);this.rpc("/calendar/notify_ack");},});},});WebClient.include({get_next_notif:function(){var self=this;this.rpc("/calendar/notify").done(function(result){_.each(result,function(res){setTimeout(function(){if(self.$(".eid_"+res.event_id).length===0){self.notification_manager.display(new CalendarNotification(self.notification_manager,res.title,res.message,res.event_id));}},res.timer*1000);});}).fail(function(err,ev){if(err.code===-32098){ev.preventDefault();}});},check_notifications:function(){var self=this;this.get_next_notif();this.intervalNotif=setInterval(function(){self.get_next_notif();},5*60*1000);},show_application:function(){this._super();this.check_notifications();},on_logout:function(){this._super();clearInterval(this.intervalNotif);},});var Many2ManyAttendee=FieldMany2ManyTags.extend({tag_template:"Many2ManyAttendeeTag",get_render_data:function(ids){return this.dataset.call('get_attendee_detail',[ids,this.getParent().dataset.ids[0]||false]).then(process_data);function process_data(data){return _.map(data,function(d){return _.object(['id','display_name','status','color'],d);});}},});function showCalendarInvitation(db,action,id,view,attendee_data){session.session_bind(session.origin).then(function(){if(session.session_is_valid(db)&&session.username!=="anonymous"){window.location.href=_.str.sprintf('/web?db=%s#id=%s&view_type=form&model=calendar.event',db,id);}else{$("body").prepend(QWeb.render('CalendarInvitation',{attendee_data:JSON.parse(attendee_data)}));}});}
core.form_widget_registry.add('many2manyattendee',Many2ManyAttendee);return{showCalendarInvitation:showCalendarInvitation,};});;

/* /document/static/src/js/document.js defined in bundle 'web.assets_backend' */
odoo.define('document.document',function(require){"use strict";var core=require('web.core');var Sidebar=require('web.Sidebar');var _t=core._t;Sidebar.include({init:function(){this._super.apply(this,arguments);if(this.getParent().view_type=="form"){this.sections.splice(1,0,{'name':'files','label':_t('Attachment(s)'),});this.items.files=[];}},on_attachments_loaded:function(attachments){var self=this;_.chain(attachments).groupBy(function(attachment){return attachment.name;}).each(function(attachment){if(attachment.length>1)
_.map(attachment,function(attachment,i){attachment.name=_.str.sprintf(_t("%s (%s)"),attachment.name,i+1);});});self._super(attachments);},});});;

/* /web_calendar/static/lib/fullcalendar/js/fullcalendar.js defined in bundle 'web.assets_backend' */
(function($,undefined){;;var defaults={defaultView:'month',aspectRatio:1.35,header:{left:'title',center:'',right:'today prev,next'},weekends:true,weekNumbers:false,weekNumberCalculation:'iso',weekNumberTitle:'W',allDayDefault:true,ignoreTimezone:true,lazyFetching:true,startParam:'start',endParam:'end',titleFormat:{month:'MMMM yyyy',week:"MMM d[ yyyy]{ '&#8212;'[ MMM] d yyyy}",day:'dddd, MMM d, yyyy'},columnFormat:{month:'ddd',week:'ddd M/d',day:'dddd M/d'},timeFormat:{'':'h(:mm)t'},isRTL:false,firstDay:0,monthNames:['January','February','March','April','May','June','July','August','September','October','November','December'],monthNamesShort:['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'],dayNames:['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'],dayNamesShort:['Sun','Mon','Tue','Wed','Thu','Fri','Sat'],buttonText:{prev:"<span class='fc-text-arrow'>&lsaquo;</span>",next:"<span class='fc-text-arrow'>&rsaquo;</span>",prevYear:"<span class='fc-text-arrow'>&laquo;</span>",nextYear:"<span class='fc-text-arrow'>&raquo;</span>",today:'today',month:'month',week:'week',day:'day'},theme:false,buttonIcons:{prev:'circle-triangle-w',next:'circle-triangle-e'},unselectAuto:true,dropAccept:'*',handleWindowResize:true};var rtlDefaults={header:{left:'next,prev today',center:'',right:'title'},buttonText:{prev:"<span class='fc-text-arrow'>&rsaquo;</span>",next:"<span class='fc-text-arrow'>&lsaquo;</span>",prevYear:"<span class='fc-text-arrow'>&raquo;</span>",nextYear:"<span class='fc-text-arrow'>&laquo;</span>"},buttonIcons:{prev:'circle-triangle-e',next:'circle-triangle-w'}};;;var fc=$.fullCalendar={version:"1.6.4"};var fcViews=fc.views={};$.fn.fullCalendar=function(options){if(typeof options=='string'){var args=Array.prototype.slice.call(arguments,1);var res;this.each(function(){var calendar=$.data(this,'fullCalendar');if(calendar&&$.isFunction(calendar[options])){var r=calendar[options].apply(calendar,args);if(res===undefined){res=r;}
if(options=='destroy'){$.removeData(this,'fullCalendar');}}});if(res!==undefined){return res;}
return this;}
options=options||{};var eventSources=options.eventSources||[];delete options.eventSources;if(options.events){eventSources.push(options.events);delete options.events;}
options=$.extend(true,{},defaults,(options.isRTL||options.isRTL===undefined&&defaults.isRTL)?rtlDefaults:{},options);this.each(function(i,_element){var element=$(_element);var calendar=new Calendar(element,options,eventSources);element.data('fullCalendar',calendar);calendar.render();});return this;};function setDefaults(d){$.extend(true,defaults,d);};;function Calendar(element,options,eventSources){var t=this;t.options=options;t.render=render;t.destroy=destroy;t.refetchEvents=refetchEvents;t.reportEvents=reportEvents;t.reportEventChange=reportEventChange;t.rerenderEvents=rerenderEvents;t.changeView=changeView;t.select=select;t.unselect=unselect;t.prev=prev;t.next=next;t.prevYear=prevYear;t.nextYear=nextYear;t.today=today;t.gotoDate=gotoDate;t.incrementDate=incrementDate;t.formatDate=function(format,date){return formatDate(format,date,options)};t.formatDates=function(format,date1,date2){return formatDates(format,date1,date2,options)};t.getDate=getDate;t.getView=getView;t.option=option;t.trigger=trigger;EventManager.call(t,options,eventSources);var isFetchNeeded=t.isFetchNeeded;var fetchEvents=t.fetchEvents;var _element=element[0];var header;var headerElement;var content;var tm;var currentView;var elementOuterWidth;var suggestedViewHeight;var resizeUID=0;var ignoreWindowResize=0;var date=new Date();var events=[];var _dragElement;setYMD(date,options.year,options.month,options.date);function render(inc){if(!content){initialRender();}
else if(elementVisible()){calcSize();_renderView(inc);}}
function initialRender(){tm=options.theme?'ui':'fc';element.addClass('fc');if(options.isRTL){element.addClass('fc-rtl');}
else{element.addClass('fc-ltr');}
if(options.theme){element.addClass('ui-widget');}
content=$("<div class='fc-content' style='position:relative'/>").prependTo(element);header=new Header(t,options);headerElement=header.render();if(headerElement){element.prepend(headerElement);}
changeView(options.defaultView);if(options.handleWindowResize){$(window).resize(windowResize);}
if(!bodyVisible()){lateRender();}}
function lateRender(){setTimeout(function(){if(!currentView.start&&bodyVisible()){renderView();}},0);}
function destroy(){if(currentView){trigger('viewDestroy',currentView,currentView,currentView.element);currentView.triggerEventDestroy();}
$(window).unbind('resize',windowResize);header.destroy();content.remove();element.removeClass('fc fc-rtl ui-widget');}
function elementVisible(){return element.is(':visible');}
function bodyVisible(){return $('body').is(':visible');}
function changeView(newViewName){if(!currentView||newViewName!=currentView.name){_changeView(newViewName);}}
function _changeView(newViewName){ignoreWindowResize++;if(currentView){trigger('viewDestroy',currentView,currentView,currentView.element);unselect();currentView.triggerEventDestroy();freezeContentHeight();currentView.element.remove();header.deactivateButton(currentView.name);}
header.activateButton(newViewName);currentView=new fcViews[newViewName]($("<div class='fc-view fc-view-"+newViewName+"' style='position:relative'/>").appendTo(content),t);renderView();unfreezeContentHeight();ignoreWindowResize--;}
function renderView(inc){if(!currentView.start||inc||date<currentView.start||date>=currentView.end){if(elementVisible()){_renderView(inc);}}}
function _renderView(inc){ignoreWindowResize++;if(currentView.start){trigger('viewDestroy',currentView,currentView,currentView.element);unselect();clearEvents();}
freezeContentHeight();currentView.render(date,inc||0);setSize();unfreezeContentHeight();(currentView.afterRender||noop)();updateTitle();updateTodayButton();trigger('viewRender',currentView,currentView,currentView.element);currentView.trigger('viewDisplay',_element);ignoreWindowResize--;getAndRenderEvents();}
function updateSize(){if(elementVisible()){unselect();clearEvents();calcSize();setSize();renderEvents();}}
function calcSize(){if(options.contentHeight){suggestedViewHeight=options.contentHeight;}
else if(options.height){suggestedViewHeight=options.height-(headerElement?headerElement.height():0)-vsides(content);}
else{suggestedViewHeight=Math.round(content.width()/Math.max(options.aspectRatio,.5));}}
function setSize(){if(suggestedViewHeight===undefined){calcSize();}
ignoreWindowResize++;currentView.setHeight(suggestedViewHeight);currentView.setWidth(content.width());ignoreWindowResize--;elementOuterWidth=element.outerWidth();}
function windowResize(){if(!ignoreWindowResize){if(currentView.start){var uid=++resizeUID;setTimeout(function(){if(uid==resizeUID&&!ignoreWindowResize&&elementVisible()){if(elementOuterWidth!=(elementOuterWidth=element.outerWidth())){ignoreWindowResize++;updateSize();currentView.trigger('windowResize',_element);ignoreWindowResize--;}}},200);}else{lateRender();}}}
function refetchEvents(){clearEvents();fetchAndRenderEvents();}
function rerenderEvents(modifiedEventID){clearEvents();renderEvents(modifiedEventID);}
function renderEvents(modifiedEventID){if(elementVisible()){currentView.setEventData(events);currentView.renderEvents(events,modifiedEventID);currentView.trigger('eventAfterAllRender');}}
function clearEvents(){currentView.triggerEventDestroy();currentView.clearEvents();currentView.clearEventData();}
function getAndRenderEvents(){if(!options.lazyFetching||isFetchNeeded(currentView.visStart,currentView.visEnd)){fetchAndRenderEvents();}
else{renderEvents();}}
function fetchAndRenderEvents(){fetchEvents(currentView.visStart,currentView.visEnd);}
function reportEvents(_events){events=_events;renderEvents();}
function reportEventChange(eventID){rerenderEvents(eventID);}
function updateTitle(){header.updateTitle(currentView.title);}
function updateTodayButton(){var today=new Date();if(today>=currentView.start&&today<currentView.end){header.disableButton('today');}
else{header.enableButton('today');}}
function select(start,end,allDay){currentView.select(start,end,allDay===undefined?true:allDay);}
function unselect(){if(currentView){currentView.unselect();}}
function prev(){renderView(-1);}
function next(){renderView(1);}
function prevYear(){addYears(date,-1);renderView();}
function nextYear(){addYears(date,1);renderView();}
function today(){date=new Date();renderView();}
function gotoDate(year,month,dateOfMonth){if(year instanceof Date){date=cloneDate(year);}else{setYMD(date,year,month,dateOfMonth);}
renderView();}
function incrementDate(years,months,days){if(years!==undefined){addYears(date,years);}
if(months!==undefined){addMonths(date,months);}
if(days!==undefined){addDays(date,days);}
renderView();}
function getDate(){return cloneDate(date);}
function freezeContentHeight(){content.css({width:'100%',height:content.height(),overflow:'hidden'});}
function unfreezeContentHeight(){content.css({width:'',height:'',overflow:''});}
function getView(){return currentView;}
function option(name,value){if(value===undefined){return options[name];}
if(name=='height'||name=='contentHeight'||name=='aspectRatio'){options[name]=value;updateSize();}}
function trigger(name,thisObj){if(options[name]){return options[name].apply(thisObj||_element,Array.prototype.slice.call(arguments,2));}}
if(options.droppable){$(document).bind('dragstart',function(ev,ui){var _e=ev.target;var e=$(_e);if(!e.parents('.fc').length){var accept=options.dropAccept;if($.isFunction(accept)?accept.call(_e,e):e.is(accept)){_dragElement=_e;currentView.dragStart(_dragElement,ev,ui);}}}).bind('dragstop',function(ev,ui){if(_dragElement){currentView.dragStop(_dragElement,ev,ui);_dragElement=null;}});}};;function Header(calendar,options){var t=this;t.render=render;t.destroy=destroy;t.updateTitle=updateTitle;t.activateButton=activateButton;t.deactivateButton=deactivateButton;t.disableButton=disableButton;t.enableButton=enableButton;var element=$([]);var tm;function render(){tm=options.theme?'ui':'fc';var sections=options.header;if(sections){element=$("<table class='fc-header' style='width:100%'/>").append($("<tr/>").append(renderSection('left')).append(renderSection('center')).append(renderSection('right')));return element;}}
function destroy(){element.remove();}
function renderSection(position){var e=$("<td class='fc-header-"+position+"'/>");var buttonStr=options.header[position];if(buttonStr){$.each(buttonStr.split(' '),function(i){if(i>0){e.append("<span class='fc-header-space'/>");}
var prevButton;$.each(this.split(','),function(j,buttonName){if(buttonName=='title'){e.append("<span class='fc-header-title'><h2>&nbsp;</h2></span>");if(prevButton){prevButton.addClass(tm+'-corner-right');}
prevButton=null;}else{var buttonClick;if(calendar[buttonName]){buttonClick=calendar[buttonName];}
else if(fcViews[buttonName]){buttonClick=function(){button.removeClass(tm+'-state-hover');calendar.changeView(buttonName);};}
if(buttonClick){var icon=options.theme?smartProperty(options.buttonIcons,buttonName):null;var text=smartProperty(options.buttonText,buttonName);var button=$("<span class='fc-button fc-button-"+buttonName+" "+tm+"-state-default'>"+
(icon?"<span class='fc-icon-wrap'>"+"<span class='ui-icon ui-icon-"+icon+"'/>"+"</span>":text)+"</span>").click(function(){if(!button.hasClass(tm+'-state-disabled')){buttonClick();}}).mousedown(function(){button.not('.'+tm+'-state-active').not('.'+tm+'-state-disabled').addClass(tm+'-state-down');}).mouseup(function(){button.removeClass(tm+'-state-down');}).hover(function(){button.not('.'+tm+'-state-active').not('.'+tm+'-state-disabled').addClass(tm+'-state-hover');},function(){button.removeClass(tm+'-state-hover').removeClass(tm+'-state-down');}).appendTo(e);disableTextSelection(button);if(!prevButton){button.addClass(tm+'-corner-left');}
prevButton=button;}}});if(prevButton){prevButton.addClass(tm+'-corner-right');}});}
return e;}
function updateTitle(html){element.find('h2').html(html);}
function activateButton(buttonName){element.find('span.fc-button-'+buttonName).addClass(tm+'-state-active');}
function deactivateButton(buttonName){element.find('span.fc-button-'+buttonName).removeClass(tm+'-state-active');}
function disableButton(buttonName){element.find('span.fc-button-'+buttonName).addClass(tm+'-state-disabled');}
function enableButton(buttonName){element.find('span.fc-button-'+buttonName).removeClass(tm+'-state-disabled');}};;fc.sourceNormalizers=[];fc.sourceFetchers=[];var ajaxDefaults={dataType:'json',cache:false};var eventGUID=1;function EventManager(options,_sources){var t=this;t.isFetchNeeded=isFetchNeeded;t.fetchEvents=fetchEvents;t.addEventSource=addEventSource;t.removeEventSource=removeEventSource;t.updateEvent=updateEvent;t.renderEvent=renderEvent;t.removeEvents=removeEvents;t.clientEvents=clientEvents;t.normalizeEvent=normalizeEvent;var trigger=t.trigger;var getView=t.getView;var reportEvents=t.reportEvents;var stickySource={events:[]};var sources=[stickySource];var rangeStart,rangeEnd;var currentFetchID=0;var pendingSourceCnt=0;var loadingLevel=0;var cache=[];for(var i=0;i<_sources.length;i++){_addEventSource(_sources[i]);}
function isFetchNeeded(start,end){return!rangeStart||start<rangeStart||end>rangeEnd;}
function fetchEvents(start,end){rangeStart=start;rangeEnd=end;cache=[];var fetchID=++currentFetchID;var len=sources.length;pendingSourceCnt=len;for(var i=0;i<len;i++){fetchEventSource(sources[i],fetchID);}}
function fetchEventSource(source,fetchID){_fetchEventSource(source,function(events){if(fetchID==currentFetchID){if(events){if(options.eventDataTransform){events=$.map(events,options.eventDataTransform);}
if(source.eventDataTransform){events=$.map(events,source.eventDataTransform);}
for(var i=0;i<events.length;i++){events[i].source=source;normalizeEvent(events[i]);}
cache=cache.concat(events);}
pendingSourceCnt--;if(!pendingSourceCnt){reportEvents(cache);}}});}
function _fetchEventSource(source,callback){var i;var fetchers=fc.sourceFetchers;var res;for(i=0;i<fetchers.length;i++){res=fetchers[i](source,rangeStart,rangeEnd,callback);if(res===true){return;}
else if(typeof res=='object'){_fetchEventSource(res,callback);return;}}
var events=source.events;if(events){if($.isFunction(events)){pushLoading();events(cloneDate(rangeStart),cloneDate(rangeEnd),function(events){callback(events);popLoading();});}
else if($.isArray(events)){callback(events);}
else{callback();}}else{var url=source.url;if(url){var success=source.success;var error=source.error;var complete=source.complete;var customData;if($.isFunction(source.data)){customData=source.data();}
else{customData=source.data;}
var data=$.extend({},customData||{});var startParam=firstDefined(source.startParam,options.startParam);var endParam=firstDefined(source.endParam,options.endParam);if(startParam){data[startParam]=Math.round(+rangeStart/1000);}
if(endParam){data[endParam]=Math.round(+rangeEnd/1000);}
pushLoading();$.ajax($.extend({},ajaxDefaults,source,{data:data,success:function(events){events=events||[];var res=applyAll(success,this,arguments);if($.isArray(res)){events=res;}
callback(events);},error:function(){applyAll(error,this,arguments);callback();},complete:function(){applyAll(complete,this,arguments);popLoading();}}));}else{callback();}}}
function addEventSource(source){source=_addEventSource(source);if(source){pendingSourceCnt++;fetchEventSource(source,currentFetchID);}}
function _addEventSource(source){if($.isFunction(source)||$.isArray(source)){source={events:source};}
else if(typeof source=='string'){source={url:source};}
if(typeof source=='object'){normalizeSource(source);sources.push(source);return source;}}
function removeEventSource(source){sources=$.grep(sources,function(src){return!isSourcesEqual(src,source);});cache=$.grep(cache,function(e){return!isSourcesEqual(e.source,source);});reportEvents(cache);}
function updateEvent(event){var i,len=cache.length,e,defaultEventEnd=getView().defaultEventEnd,startDelta=event.start-event._start,endDelta=event.end?(event.end-(event._end||defaultEventEnd(event))):0;for(i=0;i<len;i++){e=cache[i];if(e._id==event._id&&e!=event){e.start=new Date(+e.start+startDelta);if(event.end){if(e.end){e.end=new Date(+e.end+endDelta);}else{e.end=new Date(+defaultEventEnd(e)+endDelta);}}else{e.end=null;}
e.title=event.title;e.url=event.url;e.allDay=event.allDay;e.className=event.className;e.editable=event.editable;e.color=event.color;e.backgroundColor=event.backgroundColor;e.borderColor=event.borderColor;e.textColor=event.textColor;normalizeEvent(e);}}
normalizeEvent(event);reportEvents(cache);}
function renderEvent(event,stick){normalizeEvent(event);if(!event.source){if(stick){stickySource.events.push(event);event.source=stickySource;}
cache.push(event);}
reportEvents(cache);}
function removeEvents(filter){if(!filter){cache=[];for(var i=0;i<sources.length;i++){if($.isArray(sources[i].events)){sources[i].events=[];}}}else{if(!$.isFunction(filter)){var id=filter+'';filter=function(e){return e._id==id;};}
cache=$.grep(cache,filter,true);for(var i=0;i<sources.length;i++){if($.isArray(sources[i].events)){sources[i].events=$.grep(sources[i].events,filter,true);}}}
reportEvents(cache);}
function clientEvents(filter){if($.isFunction(filter)){return $.grep(cache,filter);}
else if(filter){filter+='';return $.grep(cache,function(e){return e._id==filter;});}
return cache;}
function pushLoading(){if(!loadingLevel++){trigger('loading',null,true,getView());}}
function popLoading(){if(!--loadingLevel){trigger('loading',null,false,getView());}}
function normalizeEvent(event){var source=event.source||{};var ignoreTimezone=firstDefined(source.ignoreTimezone,options.ignoreTimezone);event._id=event._id||(event.id===undefined?'_fc'+eventGUID++:event.id+'');if(event.date){if(!event.start){event.start=event.date;}
delete event.date;}
event._start=cloneDate(event.start=parseDate(event.start,ignoreTimezone));event.end=parseDate(event.end,ignoreTimezone);if(event.end&&event.end<=event.start){event.end=null;}
event._end=event.end?cloneDate(event.end):null;if(event.allDay===undefined){event.allDay=firstDefined(source.allDayDefault,options.allDayDefault);}
if(event.className){if(typeof event.className=='string'){event.className=event.className.split(/\s+/);}}else{event.className=[];}}
function normalizeSource(source){if(source.className){if(typeof source.className=='string'){source.className=source.className.split(/\s+/);}}else{source.className=[];}
var normalizers=fc.sourceNormalizers;for(var i=0;i<normalizers.length;i++){normalizers[i](source);}}
function isSourcesEqual(source1,source2){return source1&&source2&&getSourcePrimitive(source1)==getSourcePrimitive(source2);}
function getSourcePrimitive(source){return((typeof source=='object')?(source.events||source.url):'')||source;}};;fc.addDays=addDays;fc.cloneDate=cloneDate;fc.parseDate=parseDate;fc.parseISO8601=parseISO8601;fc.parseTime=parseTime;fc.formatDate=formatDate;fc.formatDates=formatDates;var dayIDs=['sun','mon','tue','wed','thu','fri','sat'],DAY_MS=86400000,HOUR_MS=3600000,MINUTE_MS=60000;function addYears(d,n,keepTime){d.setFullYear(d.getFullYear()+n);if(!keepTime){clearTime(d);}
return d;}
function addMonths(d,n,keepTime){if(+d){var m=d.getMonth()+n,check=cloneDate(d);check.setDate(1);check.setMonth(m);d.setMonth(m);if(!keepTime){clearTime(d);}
while(d.getMonth()!=check.getMonth()){d.setDate(d.getDate()+(d<check?1:-1));}}
return d;}
function addDays(d,n,keepTime){if(+d){var dd=d.getDate()+n,check=cloneDate(d);check.setHours(9);check.setDate(dd);d.setDate(dd);if(!keepTime){clearTime(d);}
fixDate(d,check);}
return d;}
function fixDate(d,check){if(+d){while(d.getDate()!=check.getDate()){d.setTime(+d+(d<check?1:-1)*HOUR_MS);}}}
function addMinutes(d,n){d.setMinutes(d.getMinutes()+n);return d;}
function clearTime(d){d.setHours(0);d.setMinutes(0);d.setSeconds(0);d.setMilliseconds(0);return d;}
function cloneDate(d,dontKeepTime){if(dontKeepTime){return clearTime(new Date(+d));}
return new Date(+d);}
function zeroDate(){var i=0,d;do{d=new Date(1970,i++,1);}while(d.getHours());return d;}
function dayDiff(d1,d2){return Math.round((cloneDate(d1,true)-cloneDate(d2,true))/DAY_MS);}
function setYMD(date,y,m,d){if(y!==undefined&&y!=date.getFullYear()){date.setDate(1);date.setMonth(0);date.setFullYear(y);}
if(m!==undefined&&m!=date.getMonth()){date.setDate(1);date.setMonth(m);}
if(d!==undefined){date.setDate(d);}}
function parseDate(s,ignoreTimezone){if(typeof s=='object'){return s;}
if(typeof s=='number'){return new Date(s*1000);}
if(typeof s=='string'){if(s.match(/^\d+(\.\d+)?$/)){return new Date(parseFloat(s)*1000);}
if(ignoreTimezone===undefined){ignoreTimezone=true;}
return parseISO8601(s,ignoreTimezone)||(s?new Date(s):null);}
return null;}
function parseISO8601(s,ignoreTimezone){var m=s.match(/^([0-9]{4})(-([0-9]{2})(-([0-9]{2})([T ]([0-9]{2}):([0-9]{2})(:([0-9]{2})(\.([0-9]+))?)?(Z|(([-+])([0-9]{2})(:?([0-9]{2}))?))?)?)?)?$/);if(!m){return null;}
var date=new Date(m[1],0,1);if(ignoreTimezone||!m[13]){var check=new Date(m[1],0,1,9,0);if(m[3]){date.setMonth(m[3]-1);check.setMonth(m[3]-1);}
if(m[5]){date.setDate(m[5]);check.setDate(m[5]);}
fixDate(date,check);if(m[7]){date.setHours(m[7]);}
if(m[8]){date.setMinutes(m[8]);}
if(m[10]){date.setSeconds(m[10]);}
if(m[12]){date.setMilliseconds(Number("0."+m[12])*1000);}
fixDate(date,check);}else{date.setUTCFullYear(m[1],m[3]?m[3]-1:0,m[5]||1);date.setUTCHours(m[7]||0,m[8]||0,m[10]||0,m[12]?Number("0."+m[12])*1000:0);if(m[14]){var offset=Number(m[16])*60+(m[18]?Number(m[18]):0);offset*=m[15]=='-'?1:-1;date=new Date(+date+(offset*60*1000));}}
return date;}
function parseTime(s){if(typeof s=='number'){return s*60;}
if(typeof s=='object'){return s.getHours()*60+s.getMinutes();}
var m=s.match(/(\d+)(?::(\d+))?\s*(\w+)?/);if(m){var h=parseInt(m[1],10);if(m[3]){h%=12;if(m[3].toLowerCase().charAt(0)=='p'){h+=12;}}
return h*60+(m[2]?parseInt(m[2],10):0);}}
function formatDate(date,format,options){return formatDates(date,null,format,options);}
function formatDates(date1,date2,format,options){options=options||defaults;var date=date1,otherDate=date2,i,len=format.length,c,i2,formatter,res='';for(i=0;i<len;i++){c=format.charAt(i);if(c=="'"){for(i2=i+1;i2<len;i2++){if(format.charAt(i2)=="'"){if(date){if(i2==i+1){res+="'";}else{res+=format.substring(i+1,i2);}
i=i2;}
break;}}}
else if(c=='('){for(i2=i+1;i2<len;i2++){if(format.charAt(i2)==')'){var subres=formatDate(date,format.substring(i+1,i2),options);if(parseInt(subres.replace(/\D/,''),10)){res+=subres;}
i=i2;break;}}}
else if(c=='['){for(i2=i+1;i2<len;i2++){if(format.charAt(i2)==']'){var subformat=format.substring(i+1,i2);var subres=formatDate(date,subformat,options);if(subres!=formatDate(otherDate,subformat,options)){res+=subres;}
i=i2;break;}}}
else if(c=='{'){date=date2;otherDate=date1;}
else if(c=='}'){date=date1;otherDate=date2;}
else{for(i2=len;i2>i;i2--){if(formatter=dateFormatters[format.substring(i,i2)]){if(date){res+=formatter(date,options);}
i=i2-1;break;}}
if(i2==i){if(date){res+=c;}}}}
return res;};var dateFormatters={s:function(d){return d.getSeconds()},ss:function(d){return zeroPad(d.getSeconds())},m:function(d){return d.getMinutes()},mm:function(d){return zeroPad(d.getMinutes())},h:function(d){return d.getHours()%12||12},hh:function(d){return zeroPad(d.getHours()%12||12)},H:function(d){return d.getHours()},HH:function(d){return zeroPad(d.getHours())},d:function(d){return d.getDate()},dd:function(d){return zeroPad(d.getDate())},ddd:function(d,o){return o.dayNamesShort[d.getDay()]},dddd:function(d,o){return o.dayNames[d.getDay()]},M:function(d){return d.getMonth()+1},MM:function(d){return zeroPad(d.getMonth()+1)},MMM:function(d,o){return o.monthNamesShort[d.getMonth()]},MMMM:function(d,o){return o.monthNames[d.getMonth()]},yy:function(d){return(d.getFullYear()+'').substring(2)},yyyy:function(d){return d.getFullYear()},t:function(d){return d.getHours()<12?'a':'p'},tt:function(d){return d.getHours()<12?'am':'pm'},T:function(d){return d.getHours()<12?'A':'P'},TT:function(d){return d.getHours()<12?'AM':'PM'},u:function(d){return formatDate(d,"yyyy-MM-dd'T'HH:mm:ss'Z'")},S:function(d){var date=d.getDate();if(date>10&&date<20){return'th';}
return['st','nd','rd'][date%10-1]||'th';},w:function(d,o){return o.weekNumberCalculation(d);},W:function(d){return iso8601Week(d);}};fc.dateFormatters=dateFormatters;function iso8601Week(date){var time;var checkDate=new Date(date.getTime());checkDate.setDate(checkDate.getDate()+4-(checkDate.getDay()||7));time=checkDate.getTime();checkDate.setMonth(0);checkDate.setDate(1);return Math.floor(Math.round((time-checkDate)/86400000)/7)+1;};;fc.applyAll=applyAll;function exclEndDay(event){if(event.end){return _exclEndDay(event.end,event.allDay);}else{return addDays(cloneDate(event.start),1);}}
function _exclEndDay(end,allDay){end=cloneDate(end);return allDay||end.getHours()||end.getMinutes()?addDays(end,1):clearTime(end);}
function lazySegBind(container,segs,bindHandlers){container.unbind('mouseover').mouseover(function(ev){var parent=ev.target,e,i,seg;while(parent!=this){e=parent;parent=parent.parentNode;}
if((i=e._fci)!==undefined){e._fci=undefined;seg=segs[i];bindHandlers(seg.event,seg.element,seg);$(ev.target).trigger(ev);}
ev.stopPropagation();});}
function setOuterWidth(element,width,includeMargins){for(var i=0,e;i<element.length;i++){e=$(element[i]);e.width(Math.max(0,width-hsides(e,includeMargins)));}}
function setOuterHeight(element,height,includeMargins){for(var i=0,e;i<element.length;i++){e=$(element[i]);e.height(Math.max(0,height-vsides(e,includeMargins)));}}
function hsides(element,includeMargins){return hpadding(element)+hborders(element)+(includeMargins?hmargins(element):0);}
function hpadding(element){return(parseFloat($.css(element[0],'paddingLeft',true))||0)+
(parseFloat($.css(element[0],'paddingRight',true))||0);}
function hmargins(element){return(parseFloat($.css(element[0],'marginLeft',true))||0)+
(parseFloat($.css(element[0],'marginRight',true))||0);}
function hborders(element){return(parseFloat($.css(element[0],'borderLeftWidth',true))||0)+
(parseFloat($.css(element[0],'borderRightWidth',true))||0);}
function vsides(element,includeMargins){return vpadding(element)+vborders(element)+(includeMargins?vmargins(element):0);}
function vpadding(element){return(parseFloat($.css(element[0],'paddingTop',true))||0)+
(parseFloat($.css(element[0],'paddingBottom',true))||0);}
function vmargins(element){return(parseFloat($.css(element[0],'marginTop',true))||0)+
(parseFloat($.css(element[0],'marginBottom',true))||0);}
function vborders(element){return(parseFloat($.css(element[0],'borderTopWidth',true))||0)+
(parseFloat($.css(element[0],'borderBottomWidth',true))||0);}
function noop(){}
function dateCompare(a,b){return a-b;}
function arrayMax(a){return Math.max.apply(Math,a);}
function zeroPad(n){return(n<10?'0':'')+n;}
function smartProperty(obj,name){if(obj[name]!==undefined){return obj[name];}
var parts=name.split(/(?=[A-Z])/),i=parts.length-1,res;for(;i>=0;i--){res=obj[parts[i].toLowerCase()];if(res!==undefined){return res;}}
return obj[''];}
function htmlEscape(s){return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/'/g,'&#039;').replace(/"/g,'&quot;').replace(/\n/g,'<br />');}
function disableTextSelection(element){element.attr('unselectable','on').css('MozUserSelect','none').bind('selectstart.ui',function(){return false;});}
function markFirstLast(e){e.children().removeClass('fc-first fc-last').filter(':first-child').addClass('fc-first').end().filter(':last-child').addClass('fc-last');}
function setDayID(cell,date){cell.each(function(i,_cell){_cell.className=_cell.className.replace(/^fc-\w*/,'fc-'+dayIDs[date.getDay()]);});}
function getSkinCss(event,opt){var source=event.source||{};var eventColor=event.color;var sourceColor=source.color;var optionColor=opt('eventColor');var backgroundColor=event.backgroundColor||eventColor||source.backgroundColor||sourceColor||opt('eventBackgroundColor')||optionColor;var borderColor=event.borderColor||eventColor||source.borderColor||sourceColor||opt('eventBorderColor')||optionColor;var textColor=event.textColor||source.textColor||opt('eventTextColor');var statements=[];if(backgroundColor){statements.push('background-color:'+backgroundColor);}
if(borderColor){statements.push('border-color:'+borderColor);}
if(textColor){statements.push('color:'+textColor);}
return statements.join(';');}
function applyAll(functions,thisObj,args){if($.isFunction(functions)){functions=[functions];}
if(functions){var i;var ret;for(i=0;i<functions.length;i++){ret=functions[i].apply(thisObj,args)||ret;}
return ret;}}
function firstDefined(){for(var i=0;i<arguments.length;i++){if(arguments[i]!==undefined){return arguments[i];}}};;fcViews.month=MonthView;function MonthView(element,calendar){var t=this;t.render=render;BasicView.call(t,element,calendar,'month');var opt=t.opt;var renderBasic=t.renderBasic;var skipHiddenDays=t.skipHiddenDays;var getCellsPerWeek=t.getCellsPerWeek;var formatDate=calendar.formatDate;function render(date,delta){if(delta){addMonths(date,delta);date.setDate(1);}
var firstDay=opt('firstDay');var start=cloneDate(date,true);start.setDate(1);var end=addMonths(cloneDate(start),1);var visStart=cloneDate(start);addDays(visStart,-((visStart.getDay()-firstDay+7)%7));skipHiddenDays(visStart);var visEnd=cloneDate(end);addDays(visEnd,(7-visEnd.getDay()+firstDay)%7);skipHiddenDays(visEnd,-1,true);var colCnt=getCellsPerWeek();var rowCnt=Math.round(dayDiff(visEnd,visStart)/7);if(opt('weekMode')=='fixed'){addDays(visEnd,(6-rowCnt)*7);rowCnt=6;}
t.title=formatDate(start,opt('titleFormat'));t.start=start;t.end=end;t.visStart=visStart;t.visEnd=visEnd;renderBasic(rowCnt,colCnt,true);}};;fcViews.basicWeek=BasicWeekView;function BasicWeekView(element,calendar){var t=this;t.render=render;BasicView.call(t,element,calendar,'basicWeek');var opt=t.opt;var renderBasic=t.renderBasic;var skipHiddenDays=t.skipHiddenDays;var getCellsPerWeek=t.getCellsPerWeek;var formatDates=calendar.formatDates;function render(date,delta){if(delta){addDays(date,delta*7);}
var start=addDays(cloneDate(date),-((date.getDay()-opt('firstDay')+7)%7));var end=addDays(cloneDate(start),7);var visStart=cloneDate(start);skipHiddenDays(visStart);var visEnd=cloneDate(end);skipHiddenDays(visEnd,-1,true);var colCnt=getCellsPerWeek();t.start=start;t.end=end;t.visStart=visStart;t.visEnd=visEnd;t.title=formatDates(visStart,addDays(cloneDate(visEnd),-1),opt('titleFormat'));renderBasic(1,colCnt,false);}};;fcViews.basicDay=BasicDayView;function BasicDayView(element,calendar){var t=this;t.render=render;BasicView.call(t,element,calendar,'basicDay');var opt=t.opt;var renderBasic=t.renderBasic;var skipHiddenDays=t.skipHiddenDays;var formatDate=calendar.formatDate;function render(date,delta){if(delta){addDays(date,delta);}
skipHiddenDays(date,delta<0?-1:1);var start=cloneDate(date,true);var end=addDays(cloneDate(start),1);t.title=formatDate(date,opt('titleFormat'));t.start=t.visStart=start;t.end=t.visEnd=end;renderBasic(1,1,false);}};;setDefaults({weekMode:'fixed'});function BasicView(element,calendar,viewName){var t=this;t.renderBasic=renderBasic;t.setHeight=setHeight;t.setWidth=setWidth;t.renderDayOverlay=renderDayOverlay;t.defaultSelectionEnd=defaultSelectionEnd;t.renderSelection=renderSelection;t.clearSelection=clearSelection;t.reportDayClick=reportDayClick;t.dragStart=dragStart;t.dragStop=dragStop;t.defaultEventEnd=defaultEventEnd;t.getHoverListener=function(){return hoverListener};t.colLeft=colLeft;t.colRight=colRight;t.colContentLeft=colContentLeft;t.colContentRight=colContentRight;t.getIsCellAllDay=function(){return true};t.allDayRow=allDayRow;t.getRowCnt=function(){return rowCnt};t.getColCnt=function(){return colCnt};t.getColWidth=function(){return colWidth};t.getDaySegmentContainer=function(){return daySegmentContainer};View.call(t,element,calendar,viewName);OverlayManager.call(t);SelectionManager.call(t);BasicEventRenderer.call(t);var opt=t.opt;var trigger=t.trigger;var renderOverlay=t.renderOverlay;var clearOverlays=t.clearOverlays;var daySelectionMousedown=t.daySelectionMousedown;var cellToDate=t.cellToDate;var dateToCell=t.dateToCell;var rangeToSegments=t.rangeToSegments;var formatDate=calendar.formatDate;var table;var head;var headCells;var body;var bodyRows;var bodyCells;var bodyFirstCells;var firstRowCellInners;var firstRowCellContentInners;var daySegmentContainer;var viewWidth;var viewHeight;var colWidth;var weekNumberWidth;var rowCnt,colCnt;var showNumbers;var coordinateGrid;var hoverListener;var colPositions;var colContentPositions;var tm;var colFormat;var showWeekNumbers;var weekNumberTitle;var weekNumberFormat;disableTextSelection(element.addClass('fc-grid'));function renderBasic(_rowCnt,_colCnt,_showNumbers){rowCnt=_rowCnt;colCnt=_colCnt;showNumbers=_showNumbers;updateOptions();if(!body){buildEventContainer();}
buildTable();}
function updateOptions(){tm=opt('theme')?'ui':'fc';colFormat=opt('columnFormat');showWeekNumbers=opt('weekNumbers');weekNumberTitle=opt('weekNumberTitle');if(opt('weekNumberCalculation')!='iso'){weekNumberFormat="w";}
else{weekNumberFormat="W";}}
function buildEventContainer(){daySegmentContainer=$("<div class='fc-event-container' style='position:absolute;z-index:8;top:0;left:0'/>").appendTo(element);}
function buildTable(){var html=buildTableHTML();if(table){table.remove();}
table=$(html).appendTo(element);head=table.find('thead');headCells=head.find('.fc-day-header');body=table.find('tbody');bodyRows=body.find('tr');bodyCells=body.find('.fc-day');bodyFirstCells=bodyRows.find('td:first-child');firstRowCellInners=bodyRows.eq(0).find('.fc-day > div');firstRowCellContentInners=bodyRows.eq(0).find('.fc-day-content > div');markFirstLast(head.add(head.find('tr')));markFirstLast(bodyRows);bodyRows.eq(0).addClass('fc-first');bodyRows.filter(':last').addClass('fc-last');bodyCells.each(function(i,_cell){var date=cellToDate(Math.floor(i/colCnt),i%colCnt);trigger('dayRender',t,date,$(_cell));});dayBind(bodyCells);}
function buildTableHTML(){var html="<table class='fc-border-separate' style='width:100%' cellspacing='0'>"+
buildHeadHTML()+
buildBodyHTML()+"</table>";return html;}
function buildHeadHTML(){var headerClass=tm+"-widget-header";var html='';var col;var date;html+="<thead><tr>";if(showWeekNumbers){html+="<th class='fc-week-number "+headerClass+"'>"+
htmlEscape(weekNumberTitle)+"</th>";}
for(col=0;col<colCnt;col++){date=cellToDate(0,col);html+="<th class='fc-day-header fc-"+dayIDs[date.getDay()]+" "+headerClass+"'>"+
htmlEscape(formatDate(date,colFormat))+"</th>";}
html+="</tr></thead>";return html;}
function buildBodyHTML(){var contentClass=tm+"-widget-content";var html='';var row;var col;var date;html+="<tbody>";for(row=0;row<rowCnt;row++){html+="<tr class='fc-week'>";if(showWeekNumbers){date=cellToDate(row,0);html+="<td class='fc-week-number "+contentClass+"'>"+"<div>"+
htmlEscape(formatDate(date,weekNumberFormat))+"</div>"+"</td>";}
for(col=0;col<colCnt;col++){date=cellToDate(row,col);html+=buildCellHTML(date);}
html+="</tr>";}
html+="</tbody>";return html;}
function buildCellHTML(date){var contentClass=tm+"-widget-content";var month=t.start.getMonth();var today=clearTime(new Date());var html='';var classNames=['fc-day','fc-'+dayIDs[date.getDay()],contentClass];if(date.getMonth()!=month){classNames.push('fc-other-month');}
if(+date==+today){classNames.push('fc-today',tm+'-state-highlight');}
else if(date<today){classNames.push('fc-past');}
else{classNames.push('fc-future');}
html+="<td"+" class='"+classNames.join(' ')+"'"+" data-date='"+formatDate(date,'yyyy-MM-dd')+"'"+">"+"<div>";if(showNumbers){html+="<div class='fc-day-number'>"+date.getDate()+"</div>";}
html+="<div class='fc-day-content'>"+"<div style='position:relative'>&nbsp;</div>"+"</div>"+"</div>"+"</td>";return html;}
function setHeight(height){viewHeight=height;var bodyHeight=viewHeight-head.height();var rowHeight;var rowHeightLast;var cell;if(opt('weekMode')=='variable'){rowHeight=rowHeightLast=Math.floor(bodyHeight/(rowCnt==1?2:6));}else{rowHeight=Math.floor(bodyHeight/rowCnt);rowHeightLast=bodyHeight-rowHeight*(rowCnt-1);}
bodyFirstCells.each(function(i,_cell){if(i<rowCnt){cell=$(_cell);cell.find('> div').css('min-height',(i==rowCnt-1?rowHeightLast:rowHeight)-vsides(cell));}});}
function setWidth(width){viewWidth=width;colPositions.clear();colContentPositions.clear();weekNumberWidth=0;if(showWeekNumbers){weekNumberWidth=head.find('th.fc-week-number').outerWidth();}
colWidth=Math.floor((viewWidth-weekNumberWidth)/colCnt);setOuterWidth(headCells.slice(0,-1),colWidth);}
function dayBind(days){days.click(dayClick).mousedown(daySelectionMousedown);}
function dayClick(ev){if(!opt('selectable')){var date=parseISO8601($(this).data('date'));trigger('dayClick',this,date,true,ev);}}
function renderDayOverlay(overlayStart,overlayEnd,refreshCoordinateGrid){if(refreshCoordinateGrid){coordinateGrid.build();}
var segments=rangeToSegments(overlayStart,overlayEnd);for(var i=0;i<segments.length;i++){var segment=segments[i];dayBind(renderCellOverlay(segment.row,segment.leftCol,segment.row,segment.rightCol));}}
function renderCellOverlay(row0,col0,row1,col1){var rect=coordinateGrid.rect(row0,col0,row1,col1,element);return renderOverlay(rect,element);}
function defaultSelectionEnd(startDate,allDay){return cloneDate(startDate);}
function renderSelection(startDate,endDate,allDay){renderDayOverlay(startDate,addDays(cloneDate(endDate),1),true);}
function clearSelection(){clearOverlays();}
function reportDayClick(date,allDay,ev){var cell=dateToCell(date);var _element=bodyCells[cell.row*colCnt+cell.col];trigger('dayClick',_element,date,allDay,ev);}
function dragStart(_dragElement,ev,ui){hoverListener.start(function(cell){clearOverlays();if(cell){renderCellOverlay(cell.row,cell.col,cell.row,cell.col);}},ev);}
function dragStop(_dragElement,ev,ui){var cell=hoverListener.stop();clearOverlays();if(cell){var d=cellToDate(cell);trigger('drop',_dragElement,d,true,ev,ui);}}
function defaultEventEnd(event){return cloneDate(event.start);}
coordinateGrid=new CoordinateGrid(function(rows,cols){var e,n,p;headCells.each(function(i,_e){e=$(_e);n=e.offset().left;if(i){p[1]=n;}
p=[n];cols[i]=p;});p[1]=n+e.outerWidth();bodyRows.each(function(i,_e){if(i<rowCnt){e=$(_e);n=e.offset().top;if(i){p[1]=n;}
p=[n];rows[i]=p;}});p[1]=n+e.outerHeight();});hoverListener=new HoverListener(coordinateGrid);colPositions=new HorizontalPositionCache(function(col){return firstRowCellInners.eq(col);});colContentPositions=new HorizontalPositionCache(function(col){return firstRowCellContentInners.eq(col);});function colLeft(col){return colPositions.left(col);}
function colRight(col){return colPositions.right(col);}
function colContentLeft(col){return colContentPositions.left(col);}
function colContentRight(col){return colContentPositions.right(col);}
function allDayRow(i){return bodyRows.eq(i);}};;function BasicEventRenderer(){var t=this;t.renderEvents=renderEvents;t.clearEvents=clearEvents;DayEventRenderer.call(t);function renderEvents(events,modifiedEventId){t.renderDayEvents(events,modifiedEventId);}
function clearEvents(){t.getDaySegmentContainer().empty();}};;fcViews.agendaWeek=AgendaWeekView;function AgendaWeekView(element,calendar){var t=this;t.render=render;AgendaView.call(t,element,calendar,'agendaWeek');var opt=t.opt;var renderAgenda=t.renderAgenda;var skipHiddenDays=t.skipHiddenDays;var getCellsPerWeek=t.getCellsPerWeek;var formatDates=calendar.formatDates;function render(date,delta){if(delta){addDays(date,delta*7);}
var start=addDays(cloneDate(date),-((date.getDay()-opt('firstDay')+7)%7));var end=addDays(cloneDate(start),7);var visStart=cloneDate(start);skipHiddenDays(visStart);var visEnd=cloneDate(end);skipHiddenDays(visEnd,-1,true);var colCnt=getCellsPerWeek();t.title=formatDates(visStart,addDays(cloneDate(visEnd),-1),opt('titleFormat'));t.start=start;t.end=end;t.visStart=visStart;t.visEnd=visEnd;renderAgenda(colCnt);}};;fcViews.agendaDay=AgendaDayView;function AgendaDayView(element,calendar){var t=this;t.render=render;AgendaView.call(t,element,calendar,'agendaDay');var opt=t.opt;var renderAgenda=t.renderAgenda;var skipHiddenDays=t.skipHiddenDays;var formatDate=calendar.formatDate;function render(date,delta){if(delta){addDays(date,delta);}
skipHiddenDays(date,delta<0?-1:1);var start=cloneDate(date,true);var end=addDays(cloneDate(start),1);t.title=formatDate(date,opt('titleFormat'));t.start=t.visStart=start;t.end=t.visEnd=end;renderAgenda(1);}};;setDefaults({allDaySlot:true,allDayText:'all-day',firstHour:6,slotMinutes:30,defaultEventMinutes:120,axisFormat:'h(:mm)tt',timeFormat:{agenda:'h:mm{ - h:mm}'},dragOpacity:{agenda:.5},minTime:0,maxTime:24,slotEventOverlap:true});function AgendaView(element,calendar,viewName){var t=this;t.renderAgenda=renderAgenda;t.setWidth=setWidth;t.setHeight=setHeight;t.afterRender=afterRender;t.defaultEventEnd=defaultEventEnd;t.timePosition=timePosition;t.getIsCellAllDay=getIsCellAllDay;t.allDayRow=getAllDayRow;t.getCoordinateGrid=function(){return coordinateGrid};t.getHoverListener=function(){return hoverListener};t.colLeft=colLeft;t.colRight=colRight;t.colContentLeft=colContentLeft;t.colContentRight=colContentRight;t.getDaySegmentContainer=function(){return daySegmentContainer};t.getSlotSegmentContainer=function(){return slotSegmentContainer};t.getMinMinute=function(){return minMinute};t.getMaxMinute=function(){return maxMinute};t.getSlotContainer=function(){return slotContainer};t.getRowCnt=function(){return 1};t.getColCnt=function(){return colCnt};t.getColWidth=function(){return colWidth};t.getSnapHeight=function(){return snapHeight};t.getSnapMinutes=function(){return snapMinutes};t.defaultSelectionEnd=defaultSelectionEnd;t.renderDayOverlay=renderDayOverlay;t.renderSelection=renderSelection;t.clearSelection=clearSelection;t.reportDayClick=reportDayClick;t.dragStart=dragStart;t.dragStop=dragStop;View.call(t,element,calendar,viewName);OverlayManager.call(t);SelectionManager.call(t);AgendaEventRenderer.call(t);var opt=t.opt;var trigger=t.trigger;var renderOverlay=t.renderOverlay;var clearOverlays=t.clearOverlays;var reportSelection=t.reportSelection;var unselect=t.unselect;var daySelectionMousedown=t.daySelectionMousedown;var slotSegHtml=t.slotSegHtml;var cellToDate=t.cellToDate;var dateToCell=t.dateToCell;var rangeToSegments=t.rangeToSegments;var formatDate=calendar.formatDate;var dayTable;var dayHead;var dayHeadCells;var dayBody;var dayBodyCells;var dayBodyCellInners;var dayBodyCellContentInners;var dayBodyFirstCell;var dayBodyFirstCellStretcher;var slotLayer;var daySegmentContainer;var allDayTable;var allDayRow;var slotScroller;var slotContainer;var slotSegmentContainer;var slotTable;var selectionHelper;var viewWidth;var viewHeight;var axisWidth;var colWidth;var gutterWidth;var slotHeight;var snapMinutes;var snapRatio;var snapHeight;var colCnt;var slotCnt;var coordinateGrid;var hoverListener;var colPositions;var colContentPositions;var slotTopCache={};var tm;var rtl;var minMinute,maxMinute;var colFormat;var showWeekNumbers;var weekNumberTitle;var weekNumberFormat;disableTextSelection(element.addClass('fc-agenda'));function renderAgenda(c){colCnt=c;updateOptions();if(!dayTable){buildSkeleton();}
else{buildDayTable();}}
function updateOptions(){tm=opt('theme')?'ui':'fc';rtl=opt('isRTL')
minMinute=parseTime(opt('minTime'));maxMinute=parseTime(opt('maxTime'));colFormat=opt('columnFormat');showWeekNumbers=opt('weekNumbers');weekNumberTitle=opt('weekNumberTitle');if(opt('weekNumberCalculation')!='iso'){weekNumberFormat="w";}
else{weekNumberFormat="W";}
snapMinutes=opt('snapMinutes')||opt('slotMinutes');}
function buildSkeleton(){var headerClass=tm+"-widget-header";var contentClass=tm+"-widget-content";var s;var d;var i;var maxd;var minutes;var slotNormal=opt('slotMinutes')%15==0;buildDayTable();slotLayer=$("<div style='position:absolute;z-index:2;left:0;width:100%'/>").appendTo(element);if(opt('allDaySlot')){daySegmentContainer=$("<div class='fc-event-container' style='position:absolute;z-index:8;top:0;left:0'/>").appendTo(slotLayer);s="<table style='width:100%' class='fc-agenda-allday' cellspacing='0'>"+"<tr>"+"<th class='"+headerClass+" fc-agenda-axis'>"+opt('allDayText')+"</th>"+"<td>"+"<div class='fc-day-content'><div style='position:relative'/></div>"+"</td>"+"<th class='"+headerClass+" fc-agenda-gutter'>&nbsp;</th>"+"</tr>"+"</table>";allDayTable=$(s).appendTo(slotLayer);allDayRow=allDayTable.find('tr');dayBind(allDayRow.find('td'));slotLayer.append("<div class='fc-agenda-divider "+headerClass+"'>"+"<div class='fc-agenda-divider-inner'/>"+"</div>");}else{daySegmentContainer=$([]);}
slotScroller=$("<div style='position:absolute;width:100%;overflow-x:hidden;overflow-y:auto'/>").appendTo(slotLayer);slotContainer=$("<div style='position:relative;width:100%;overflow:hidden'/>").appendTo(slotScroller);slotSegmentContainer=$("<div class='fc-event-container' style='position:absolute;z-index:8;top:0;left:0'/>").appendTo(slotContainer);s="<table class='fc-agenda-slots' style='width:100%' cellspacing='0'>"+"<tbody>";d=zeroDate();maxd=addMinutes(cloneDate(d),maxMinute);addMinutes(d,minMinute);slotCnt=0;for(i=0;d<maxd;i++){minutes=d.getMinutes();s+="<tr class='fc-slot"+i+' '+(!minutes?'':'fc-minor')+"'>"+"<th class='fc-agenda-axis "+headerClass+"'>"+
((!slotNormal||!minutes)?formatDate(d,opt('axisFormat')):'&nbsp;')+"</th>"+"<td class='"+contentClass+"'>"+"<div style='position:relative'>&nbsp;</div>"+"</td>"+"</tr>";addMinutes(d,opt('slotMinutes'));slotCnt++;}
s+="</tbody>"+"</table>";slotTable=$(s).appendTo(slotContainer);slotBind(slotTable.find('td'));}
function buildDayTable(){var html=buildDayTableHTML();if(dayTable){dayTable.remove();}
dayTable=$(html).appendTo(element);dayHead=dayTable.find('thead');dayHeadCells=dayHead.find('th').slice(1,-1);dayBody=dayTable.find('tbody');dayBodyCells=dayBody.find('td').slice(0,-1);dayBodyCellInners=dayBodyCells.find('> div');dayBodyCellContentInners=dayBodyCells.find('.fc-day-content > div');dayBodyFirstCell=dayBodyCells.eq(0);dayBodyFirstCellStretcher=dayBodyCellInners.eq(0);markFirstLast(dayHead.add(dayHead.find('tr')));markFirstLast(dayBody.add(dayBody.find('tr')));}
function buildDayTableHTML(){var html="<table style='width:100%' class='fc-agenda-days fc-border-separate' cellspacing='0'>"+
buildDayTableHeadHTML()+
buildDayTableBodyHTML()+"</table>";return html;}
function buildDayTableHeadHTML(){var headerClass=tm+"-widget-header";var date;var html='';var weekText;var col;html+="<thead>"+"<tr>";if(showWeekNumbers){date=cellToDate(0,0);weekText=formatDate(date,weekNumberFormat);if(rtl){weekText+=weekNumberTitle;}
else{weekText=weekNumberTitle+weekText;}
html+="<th class='fc-agenda-axis fc-week-number "+headerClass+"'>"+
htmlEscape(weekText)+"</th>";}
else{html+="<th class='fc-agenda-axis "+headerClass+"'>&nbsp;</th>";}
for(col=0;col<colCnt;col++){date=cellToDate(0,col);html+="<th class='fc-"+dayIDs[date.getDay()]+" fc-col"+col+' '+headerClass+"'>"+
htmlEscape(formatDate(date,colFormat))+"</th>";}
html+="<th class='fc-agenda-gutter "+headerClass+"'>&nbsp;</th>"+"</tr>"+"</thead>";return html;}
function buildDayTableBodyHTML(){var headerClass=tm+"-widget-header";var contentClass=tm+"-widget-content";var date;var today=clearTime(new Date());var col;var cellsHTML;var cellHTML;var classNames;var html='';html+="<tbody>"+"<tr>"+"<th class='fc-agenda-axis "+headerClass+"'>&nbsp;</th>";cellsHTML='';for(col=0;col<colCnt;col++){date=cellToDate(0,col);classNames=['fc-col'+col,'fc-'+dayIDs[date.getDay()],contentClass];if(+date==+today){classNames.push(tm+'-state-highlight','fc-today');}
else if(date<today){classNames.push('fc-past');}
else{classNames.push('fc-future');}
cellHTML="<td class='"+classNames.join(' ')+"'>"+"<div>"+"<div class='fc-day-content'>"+"<div style='position:relative'>&nbsp;</div>"+"</div>"+"</div>"+"</td>";cellsHTML+=cellHTML;}
html+=cellsHTML;html+="<td class='fc-agenda-gutter "+contentClass+"'>&nbsp;</td>"+"</tr>"+"</tbody>";return html;}
function setHeight(height){if(height===undefined){height=viewHeight;}
viewHeight=height;slotTopCache={};var headHeight=dayBody.position().top;var allDayHeight=slotScroller.position().top;var bodyHeight=Math.min(height-headHeight,slotTable.height()+allDayHeight+1);dayBodyFirstCellStretcher.height(bodyHeight-vsides(dayBodyFirstCell));slotLayer.css('top',headHeight);slotScroller.height(bodyHeight-allDayHeight-1);slotHeight=slotTable.find('tr:first').height()+1;snapRatio=opt('slotMinutes')/snapMinutes;snapHeight=slotHeight/snapRatio;}
function setWidth(width){viewWidth=width;colPositions.clear();colContentPositions.clear();var axisFirstCells=dayHead.find('th:first');if(allDayTable){axisFirstCells=axisFirstCells.add(allDayTable.find('th:first'));}
axisFirstCells=axisFirstCells.add(slotTable.find('th:first'));axisWidth=0;setOuterWidth(axisFirstCells.width('').each(function(i,_cell){axisWidth=Math.max(axisWidth,$(_cell).outerWidth());}),axisWidth);var gutterCells=dayTable.find('.fc-agenda-gutter');if(allDayTable){gutterCells=gutterCells.add(allDayTable.find('th.fc-agenda-gutter'));}
var slotTableWidth=slotScroller[0].clientWidth;gutterWidth=slotScroller.width()-slotTableWidth;if(gutterWidth){setOuterWidth(gutterCells,gutterWidth);gutterCells.show().prev().removeClass('fc-last');}else{gutterCells.hide().prev().addClass('fc-last');}
colWidth=Math.floor((slotTableWidth-axisWidth)/colCnt);setOuterWidth(dayHeadCells.slice(0,-1),colWidth);}
function resetScroll(){var d0=zeroDate();var scrollDate=cloneDate(d0);scrollDate.setHours(opt('firstHour'));var top=timePosition(d0,scrollDate)+1;function scroll(){slotScroller.scrollTop(top);}
scroll();setTimeout(scroll,0);}
function afterRender(){resetScroll();}
function dayBind(cells){cells.click(slotClick).mousedown(daySelectionMousedown);}
function slotBind(cells){cells.click(slotClick).mousedown(slotSelectionMousedown);}
function slotClick(ev){if(!opt('selectable')){var col=Math.min(colCnt-1,Math.floor((ev.pageX-dayTable.offset().left-axisWidth)/colWidth));var date=cellToDate(0,col);var rowMatch=this.parentNode.className.match(/fc-slot(\d+)/);if(rowMatch){var mins=parseInt(rowMatch[1])*opt('slotMinutes');var hours=Math.floor(mins/60);date.setHours(hours);date.setMinutes(mins%60+minMinute);trigger('dayClick',dayBodyCells[col],date,false,ev);}else{trigger('dayClick',dayBodyCells[col],date,true,ev);}}}
function renderDayOverlay(overlayStart,overlayEnd,refreshCoordinateGrid){if(refreshCoordinateGrid){coordinateGrid.build();}
var segments=rangeToSegments(overlayStart,overlayEnd);for(var i=0;i<segments.length;i++){var segment=segments[i];dayBind(renderCellOverlay(segment.row,segment.leftCol,segment.row,segment.rightCol));}}
function renderCellOverlay(row0,col0,row1,col1){var rect=coordinateGrid.rect(row0,col0,row1,col1,slotLayer);return renderOverlay(rect,slotLayer);}
function renderSlotOverlay(overlayStart,overlayEnd){for(var i=0;i<colCnt;i++){var dayStart=cellToDate(0,i);var dayEnd=addDays(cloneDate(dayStart),1);var stretchStart=new Date(Math.max(dayStart,overlayStart));var stretchEnd=new Date(Math.min(dayEnd,overlayEnd));if(stretchStart<stretchEnd){var rect=coordinateGrid.rect(0,i,0,i,slotContainer);var top=timePosition(dayStart,stretchStart);var bottom=timePosition(dayStart,stretchEnd);rect.top=top;rect.height=bottom-top;slotBind(renderOverlay(rect,slotContainer));}}}
coordinateGrid=new CoordinateGrid(function(rows,cols){var e,n,p;dayHeadCells.each(function(i,_e){e=$(_e);n=e.offset().left;if(i){p[1]=n;}
p=[n];cols[i]=p;});p[1]=n+e.outerWidth();if(opt('allDaySlot')){e=allDayRow;n=e.offset().top;rows[0]=[n,n+e.outerHeight()];}
var slotTableTop=slotContainer.offset().top;var slotScrollerTop=slotScroller.offset().top;var slotScrollerBottom=slotScrollerTop+slotScroller.outerHeight();function constrain(n){return Math.max(slotScrollerTop,Math.min(slotScrollerBottom,n));}
for(var i=0;i<slotCnt*snapRatio;i++){rows.push([constrain(slotTableTop+snapHeight*i),constrain(slotTableTop+snapHeight*(i+1))]);}});hoverListener=new HoverListener(coordinateGrid);colPositions=new HorizontalPositionCache(function(col){return dayBodyCellInners.eq(col);});colContentPositions=new HorizontalPositionCache(function(col){return dayBodyCellContentInners.eq(col);});function colLeft(col){return colPositions.left(col);}
function colContentLeft(col){return colContentPositions.left(col);}
function colRight(col){return colPositions.right(col);}
function colContentRight(col){return colContentPositions.right(col);}
function getIsCellAllDay(cell){return opt('allDaySlot')&&!cell.row;}
function realCellToDate(cell){var d=cellToDate(0,cell.col);var slotIndex=cell.row;if(opt('allDaySlot')){slotIndex--;}
if(slotIndex>=0){addMinutes(d,minMinute+slotIndex*snapMinutes);}
return d;}
function timePosition(day,time){day=cloneDate(day,true);if(time<addMinutes(cloneDate(day),minMinute)){return 0;}
if(time>=addMinutes(cloneDate(day),maxMinute)){return slotTable.height();}
var slotMinutes=opt('slotMinutes'),minutes=time.getHours()*60+time.getMinutes()-minMinute,slotI=Math.floor(minutes/slotMinutes),slotTop=slotTopCache[slotI];if(slotTop===undefined){slotTop=slotTopCache[slotI]=slotTable.find('tr').eq(slotI).find('td div')[0].offsetTop;}
return Math.max(0,Math.round(slotTop-1+slotHeight*((minutes%slotMinutes)/slotMinutes)));}
function getAllDayRow(index){return allDayRow;}
function defaultEventEnd(event){var start=cloneDate(event.start);if(event.allDay){return start;}
return addMinutes(start,opt('defaultEventMinutes'));}
function defaultSelectionEnd(startDate,allDay){if(allDay){return cloneDate(startDate);}
return addMinutes(cloneDate(startDate),opt('slotMinutes'));}
function renderSelection(startDate,endDate,allDay){if(allDay){if(opt('allDaySlot')){renderDayOverlay(startDate,addDays(cloneDate(endDate),1),true);}}else{renderSlotSelection(startDate,endDate);}}
function renderSlotSelection(startDate,endDate){var helperOption=opt('selectHelper');coordinateGrid.build();if(helperOption){var col=dateToCell(startDate).col;if(col>=0&&col<colCnt){var rect=coordinateGrid.rect(0,col,0,col,slotContainer);var top=timePosition(startDate,startDate);var bottom=timePosition(startDate,endDate);if(bottom>top){rect.top=top;rect.height=bottom-top;rect.left+=2;rect.width-=5;if($.isFunction(helperOption)){var helperRes=helperOption(startDate,endDate);if(helperRes){rect.position='absolute';selectionHelper=$(helperRes).css(rect).appendTo(slotContainer);}}else{rect.isStart=true;rect.isEnd=true;selectionHelper=$(slotSegHtml({title:'',start:startDate,end:endDate,className:['fc-select-helper'],editable:false},rect));selectionHelper.css('opacity',opt('dragOpacity'));}
if(selectionHelper){slotBind(selectionHelper);slotContainer.append(selectionHelper);setOuterWidth(selectionHelper,rect.width,true);setOuterHeight(selectionHelper,rect.height,true);}}}}else{renderSlotOverlay(startDate,endDate);}}
function clearSelection(){clearOverlays();if(selectionHelper){selectionHelper.remove();selectionHelper=null;}}
function slotSelectionMousedown(ev){if(ev.which==1&&opt('selectable')){unselect(ev);var dates;hoverListener.start(function(cell,origCell){clearSelection();if(cell&&cell.col==origCell.col&&!getIsCellAllDay(cell)){var d1=realCellToDate(origCell);var d2=realCellToDate(cell);dates=[d1,addMinutes(cloneDate(d1),snapMinutes),d2,addMinutes(cloneDate(d2),snapMinutes)].sort(dateCompare);renderSlotSelection(dates[0],dates[3]);}else{dates=null;}},ev);$(document).one('mouseup',function(ev){hoverListener.stop();if(dates){if(+dates[0]==+dates[1]){reportDayClick(dates[0],false,ev);}
reportSelection(dates[0],dates[3],false,ev);}});}}
function reportDayClick(date,allDay,ev){trigger('dayClick',dayBodyCells[dateToCell(date).col],date,allDay,ev);}
function dragStart(_dragElement,ev,ui){hoverListener.start(function(cell){clearOverlays();if(cell){if(getIsCellAllDay(cell)){renderCellOverlay(cell.row,cell.col,cell.row,cell.col);}else{var d1=realCellToDate(cell);var d2=addMinutes(cloneDate(d1),opt('defaultEventMinutes'));renderSlotOverlay(d1,d2);}}},ev);}
function dragStop(_dragElement,ev,ui){var cell=hoverListener.stop();clearOverlays();if(cell){trigger('drop',_dragElement,realCellToDate(cell),getIsCellAllDay(cell),ev,ui);}}};;function AgendaEventRenderer(){var t=this;t.renderEvents=renderEvents;t.clearEvents=clearEvents;t.slotSegHtml=slotSegHtml;DayEventRenderer.call(t);var opt=t.opt;var trigger=t.trigger;var isEventDraggable=t.isEventDraggable;var isEventResizable=t.isEventResizable;var eventEnd=t.eventEnd;var eventElementHandlers=t.eventElementHandlers;var setHeight=t.setHeight;var getDaySegmentContainer=t.getDaySegmentContainer;var getSlotSegmentContainer=t.getSlotSegmentContainer;var getHoverListener=t.getHoverListener;var getMaxMinute=t.getMaxMinute;var getMinMinute=t.getMinMinute;var timePosition=t.timePosition;var getIsCellAllDay=t.getIsCellAllDay;var colContentLeft=t.colContentLeft;var colContentRight=t.colContentRight;var cellToDate=t.cellToDate;var getColCnt=t.getColCnt;var getColWidth=t.getColWidth;var getSnapHeight=t.getSnapHeight;var getSnapMinutes=t.getSnapMinutes;var getSlotContainer=t.getSlotContainer;var reportEventElement=t.reportEventElement;var showEvents=t.showEvents;var hideEvents=t.hideEvents;var eventDrop=t.eventDrop;var eventResize=t.eventResize;var renderDayOverlay=t.renderDayOverlay;var clearOverlays=t.clearOverlays;var renderDayEvents=t.renderDayEvents;var calendar=t.calendar;var formatDate=calendar.formatDate;var formatDates=calendar.formatDates;t.draggableDayEvent=draggableDayEvent;function renderEvents(events,modifiedEventId){var i,len=events.length,dayEvents=[],slotEvents=[];for(i=0;i<len;i++){if(events[i].allDay){dayEvents.push(events[i]);}else{slotEvents.push(events[i]);}}
if(opt('allDaySlot')){renderDayEvents(dayEvents,modifiedEventId);setHeight();}
renderSlotSegs(compileSlotSegs(slotEvents),modifiedEventId);}
function clearEvents(){getDaySegmentContainer().empty();getSlotSegmentContainer().empty();}
function compileSlotSegs(events){var colCnt=getColCnt(),minMinute=getMinMinute(),maxMinute=getMaxMinute(),d,visEventEnds=$.map(events,slotEventEnd),i,j,seg,colSegs,segs=[];for(i=0;i<colCnt;i++){d=cellToDate(0,i);addMinutes(d,minMinute);colSegs=sliceSegs(events,visEventEnds,d,addMinutes(cloneDate(d),maxMinute-minMinute));colSegs=placeSlotSegs(colSegs);for(j=0;j<colSegs.length;j++){seg=colSegs[j];seg.col=i;segs.push(seg);}}
return segs;}
function sliceSegs(events,visEventEnds,start,end){var segs=[],i,len=events.length,event,eventStart,eventEnd,segStart,segEnd,isStart,isEnd;for(i=0;i<len;i++){event=events[i];eventStart=event.start;eventEnd=visEventEnds[i];if(eventEnd>start&&eventStart<end){if(eventStart<start){segStart=cloneDate(start);isStart=false;}else{segStart=eventStart;isStart=true;}
if(eventEnd>end){segEnd=cloneDate(end);isEnd=false;}else{segEnd=eventEnd;isEnd=true;}
segs.push({event:event,start:segStart,end:segEnd,isStart:isStart,isEnd:isEnd});}}
return segs.sort(compareSlotSegs);}
function slotEventEnd(event){if(event.end){return cloneDate(event.end);}else{return addMinutes(cloneDate(event.start),opt('defaultEventMinutes'));}}
function renderSlotSegs(segs,modifiedEventId){var i,segCnt=segs.length,seg,event,top,bottom,columnLeft,columnRight,columnWidth,width,left,right,html='',eventElements,eventElement,triggerRes,titleElement,height,slotSegmentContainer=getSlotSegmentContainer(),isRTL=opt('isRTL');for(i=0;i<segCnt;i++){seg=segs[i];event=seg.event;top=timePosition(seg.start,seg.start);bottom=timePosition(seg.start,seg.end);columnLeft=colContentLeft(seg.col);columnRight=colContentRight(seg.col);columnWidth=columnRight-columnLeft;columnRight-=columnWidth*.025;columnWidth=columnRight-columnLeft;width=columnWidth*(seg.forwardCoord-seg.backwardCoord);if(opt('slotEventOverlap')){width=Math.max((width-(20/2))*2,width);}
if(isRTL){right=columnRight-seg.backwardCoord*columnWidth;left=right-width;}
else{left=columnLeft+seg.backwardCoord*columnWidth;right=left+width;}
left=Math.max(left,columnLeft);right=Math.min(right,columnRight);width=right-left;seg.top=top;seg.left=left;seg.outerWidth=width;seg.outerHeight=bottom-top;html+=slotSegHtml(event,seg);}
slotSegmentContainer[0].innerHTML=html;eventElements=slotSegmentContainer.children();for(i=0;i<segCnt;i++){seg=segs[i];event=seg.event;eventElement=$(eventElements[i]);triggerRes=trigger('eventRender',event,event,eventElement);if(triggerRes===false){eventElement.remove();}else{if(triggerRes&&triggerRes!==true){eventElement.remove();eventElement=$(triggerRes).css({position:'absolute',top:seg.top,left:seg.left}).appendTo(slotSegmentContainer);}
seg.element=eventElement;if(event._id===modifiedEventId){bindSlotSeg(event,eventElement,seg);}else{eventElement[0]._fci=i;}
reportEventElement(event,eventElement);}}
lazySegBind(slotSegmentContainer,segs,bindSlotSeg);for(i=0;i<segCnt;i++){seg=segs[i];if(eventElement=seg.element){seg.vsides=vsides(eventElement,true);seg.hsides=hsides(eventElement,true);titleElement=eventElement.find('.fc-event-title');if(titleElement.length){seg.contentTop=titleElement[0].offsetTop;}}}
for(i=0;i<segCnt;i++){seg=segs[i];if(eventElement=seg.element){eventElement[0].style.width=Math.max(0,seg.outerWidth-seg.hsides)+'px';height=Math.max(0,seg.outerHeight-seg.vsides);eventElement[0].style.height=height+'px';event=seg.event;if(seg.contentTop!==undefined&&height-seg.contentTop<10){eventElement.find('div.fc-event-time').text(formatDate(event.start,opt('timeFormat'))+' - '+event.title);eventElement.find('div.fc-event-title').remove();}
trigger('eventAfterRender',event,event,eventElement);}}}
function slotSegHtml(event,seg){var html="<";var url=event.url;var skinCss=getSkinCss(event,opt);var classes=['fc-event','fc-event-vert'];if(isEventDraggable(event)){classes.push('fc-event-draggable');}
if(seg.isStart){classes.push('fc-event-start');}
if(seg.isEnd){classes.push('fc-event-end');}
classes=classes.concat(event.className);if(event.source){classes=classes.concat(event.source.className||[]);}
if(url){html+="a href='"+htmlEscape(event.url)+"'";}else{html+="div";}
html+=" class='"+classes.join(' ')+"'"+" style="+"'"+"position:absolute;"+"top:"+seg.top+"px;"+"left:"+seg.left+"px;"+
skinCss+"'"+">"+"<div class='fc-event-inner'>"+"<div class='fc-event-time'>"+
htmlEscape(formatDates(event.start,event.end,opt('timeFormat')))+"</div>"+"<div class='fc-event-title'>"+
htmlEscape(event.title||'')+"</div>"+"</div>"+"<div class='fc-event-bg'></div>";if(seg.isEnd&&isEventResizable(event)){html+="<div class='ui-resizable-handle ui-resizable-s'>=</div>";}
html+="</"+(url?"a":"div")+">";return html;}
function bindSlotSeg(event,eventElement,seg){var timeElement=eventElement.find('div.fc-event-time');if(isEventDraggable(event)){draggableSlotEvent(event,eventElement,timeElement);}
if(seg.isEnd&&isEventResizable(event)){resizableSlotEvent(event,eventElement,timeElement);}
eventElementHandlers(event,eventElement);}
function draggableDayEvent(event,eventElement,seg){var isStart=seg.isStart;var origWidth;var revert;var allDay=true;var dayDelta;var hoverListener=getHoverListener();var colWidth=getColWidth();var snapHeight=getSnapHeight();var snapMinutes=getSnapMinutes();var minMinute=getMinMinute();eventElement.draggable({opacity:opt('dragOpacity','month'),revertDuration:opt('dragRevertDuration'),start:function(ev,ui){trigger('eventDragStart',eventElement,event,ev,ui);hideEvents(event,eventElement);origWidth=eventElement.width();hoverListener.start(function(cell,origCell){clearOverlays();if(cell){revert=false;var origDate=cellToDate(0,origCell.col);var date=cellToDate(0,cell.col);dayDelta=dayDiff(date,origDate);if(!cell.row){renderDayOverlay(addDays(cloneDate(event.start),dayDelta),addDays(exclEndDay(event),dayDelta));resetElement();}else{if(isStart){if(allDay){eventElement.width(colWidth-10);setOuterHeight(eventElement,snapHeight*Math.round((event.end?((event.end-event.start)/MINUTE_MS):opt('defaultEventMinutes'))/snapMinutes));eventElement.draggable('option','grid',[colWidth,1]);allDay=false;}}else{revert=true;}}
revert=revert||(allDay&&!dayDelta);}else{resetElement();revert=true;}
eventElement.draggable('option','revert',revert);},ev,'drag');},stop:function(ev,ui){hoverListener.stop();clearOverlays();trigger('eventDragStop',eventElement,event,ev,ui);if(revert){resetElement();eventElement.css('filter','');showEvents(event,eventElement);}else{var minuteDelta=0;if(!allDay){minuteDelta=Math.round((eventElement.offset().top-getSlotContainer().offset().top)/snapHeight)*snapMinutes
+minMinute
-(event.start.getHours()*60+event.start.getMinutes());}
eventDrop(this,event,dayDelta,minuteDelta,allDay,ev,ui);}}});function resetElement(){if(!allDay){eventElement.width(origWidth).height('').draggable('option','grid',null);allDay=true;}}}
function draggableSlotEvent(event,eventElement,timeElement){var coordinateGrid=t.getCoordinateGrid();var colCnt=getColCnt();var colWidth=getColWidth();var snapHeight=getSnapHeight();var snapMinutes=getSnapMinutes();var origPosition;var origCell;var isInBounds,prevIsInBounds;var isAllDay,prevIsAllDay;var colDelta,prevColDelta;var dayDelta;var minuteDelta,prevMinuteDelta;eventElement.draggable({scroll:false,grid:[colWidth,snapHeight],axis:colCnt==1?'y':false,opacity:opt('dragOpacity'),revertDuration:opt('dragRevertDuration'),start:function(ev,ui){trigger('eventDragStart',eventElement,event,ev,ui);hideEvents(event,eventElement);coordinateGrid.build();origPosition=eventElement.position();origCell=coordinateGrid.cell(ev.pageX,ev.pageY);isInBounds=prevIsInBounds=true;isAllDay=prevIsAllDay=getIsCellAllDay(origCell);colDelta=prevColDelta=0;dayDelta=0;minuteDelta=prevMinuteDelta=0;},drag:function(ev,ui){var cell=coordinateGrid.cell(ev.pageX,ev.pageY);isInBounds=!!cell;if(isInBounds){isAllDay=getIsCellAllDay(cell);colDelta=Math.round((ui.position.left-origPosition.left)/colWidth);if(colDelta!=prevColDelta){var origDate=cellToDate(0,origCell.col);var col=origCell.col+colDelta;col=Math.max(0,col);col=Math.min(colCnt-1,col);var date=cellToDate(0,col);dayDelta=dayDiff(date,origDate);}
if(!isAllDay){minuteDelta=Math.round((ui.position.top-origPosition.top)/snapHeight)*snapMinutes;}}
if(isInBounds!=prevIsInBounds||isAllDay!=prevIsAllDay||colDelta!=prevColDelta||minuteDelta!=prevMinuteDelta){updateUI();prevIsInBounds=isInBounds;prevIsAllDay=isAllDay;prevColDelta=colDelta;prevMinuteDelta=minuteDelta;}
eventElement.draggable('option','revert',!isInBounds);},stop:function(ev,ui){clearOverlays();trigger('eventDragStop',eventElement,event,ev,ui);if(isInBounds&&(isAllDay||dayDelta||minuteDelta)){eventDrop(this,event,dayDelta,isAllDay?0:minuteDelta,isAllDay,ev,ui);}
else{isInBounds=true;isAllDay=false;colDelta=0;dayDelta=0;minuteDelta=0;updateUI();eventElement.css('filter','');eventElement.css(origPosition);showEvents(event,eventElement);}}});function updateUI(){clearOverlays();if(isInBounds){if(isAllDay){timeElement.hide();eventElement.draggable('option','grid',null);renderDayOverlay(addDays(cloneDate(event.start),dayDelta),addDays(exclEndDay(event),dayDelta));}
else{updateTimeText(minuteDelta);timeElement.css('display','');eventElement.draggable('option','grid',[colWidth,snapHeight]);}}}
function updateTimeText(minuteDelta){var newStart=addMinutes(cloneDate(event.start),minuteDelta);var newEnd;if(event.end){newEnd=addMinutes(cloneDate(event.end),minuteDelta);}
timeElement.text(formatDates(newStart,newEnd,opt('timeFormat')));}}
function resizableSlotEvent(event,eventElement,timeElement){var snapDelta,prevSnapDelta;var snapHeight=getSnapHeight();var snapMinutes=getSnapMinutes();eventElement.resizable({handles:{s:'.ui-resizable-handle'},grid:snapHeight,start:function(ev,ui){snapDelta=prevSnapDelta=0;hideEvents(event,eventElement);trigger('eventResizeStart',this,event,ev,ui);},resize:function(ev,ui){snapDelta=Math.round((Math.max(snapHeight,eventElement.height())-ui.originalSize.height)/snapHeight);if(snapDelta!=prevSnapDelta){timeElement.text(formatDates(event.start,(!snapDelta&&!event.end)?null:addMinutes(eventEnd(event),snapMinutes*snapDelta),opt('timeFormat')));prevSnapDelta=snapDelta;}},stop:function(ev,ui){trigger('eventResizeStop',this,event,ev,ui);if(snapDelta){eventResize(this,event,0,snapMinutes*snapDelta,ev,ui);}else{showEvents(event,eventElement);}}});}}
function placeSlotSegs(segs){var levels=buildSlotSegLevels(segs);var level0=levels[0];var i;computeForwardSlotSegs(levels);if(level0){for(i=0;i<level0.length;i++){computeSlotSegPressures(level0[i]);}
for(i=0;i<level0.length;i++){computeSlotSegCoords(level0[i],0,0);}}
return flattenSlotSegLevels(levels);}
function buildSlotSegLevels(segs){var levels=[];var i,seg;var j;for(i=0;i<segs.length;i++){seg=segs[i];for(j=0;j<levels.length;j++){if(!computeSlotSegCollisions(seg,levels[j]).length){break;}}
(levels[j]||(levels[j]=[])).push(seg);}
return levels;}
function computeForwardSlotSegs(levels){var i,level;var j,seg;var k;for(i=0;i<levels.length;i++){level=levels[i];for(j=0;j<level.length;j++){seg=level[j];seg.forwardSegs=[];for(k=i+1;k<levels.length;k++){computeSlotSegCollisions(seg,levels[k],seg.forwardSegs);}}}}
function computeSlotSegPressures(seg){var forwardSegs=seg.forwardSegs;var forwardPressure=0;var i,forwardSeg;if(seg.forwardPressure===undefined){for(i=0;i<forwardSegs.length;i++){forwardSeg=forwardSegs[i];computeSlotSegPressures(forwardSeg);forwardPressure=Math.max(forwardPressure,1+forwardSeg.forwardPressure);}
seg.forwardPressure=forwardPressure;}}
function computeSlotSegCoords(seg,seriesBackwardPressure,seriesBackwardCoord){var forwardSegs=seg.forwardSegs;var i;if(seg.forwardCoord===undefined){if(!forwardSegs.length){seg.forwardCoord=1;}
else{forwardSegs.sort(compareForwardSlotSegs);computeSlotSegCoords(forwardSegs[0],seriesBackwardPressure+1,seriesBackwardCoord);seg.forwardCoord=forwardSegs[0].backwardCoord;}
seg.backwardCoord=seg.forwardCoord-
(seg.forwardCoord-seriesBackwardCoord)/(seriesBackwardPressure+1);for(i=0;i<forwardSegs.length;i++){computeSlotSegCoords(forwardSegs[i],0,seg.forwardCoord);}}}
function flattenSlotSegLevels(levels){var segs=[];var i,level;var j;for(i=0;i<levels.length;i++){level=levels[i];for(j=0;j<level.length;j++){segs.push(level[j]);}}
return segs;}
function computeSlotSegCollisions(seg,otherSegs,results){results=results||[];for(var i=0;i<otherSegs.length;i++){if(isSlotSegCollision(seg,otherSegs[i])){results.push(otherSegs[i]);}}
return results;}
function isSlotSegCollision(seg1,seg2){return seg1.end>seg2.start&&seg1.start<seg2.end;}
function compareForwardSlotSegs(seg1,seg2){return seg2.forwardPressure-seg1.forwardPressure||(seg1.backwardCoord||0)-(seg2.backwardCoord||0)||compareSlotSegs(seg1,seg2);}
function compareSlotSegs(seg1,seg2){return seg1.start-seg2.start||(seg2.end-seg2.start)-(seg1.end-seg1.start)||(seg1.event.title||'').localeCompare(seg2.event.title);};;function View(element,calendar,viewName){var t=this;t.element=element;t.calendar=calendar;t.name=viewName;t.opt=opt;t.trigger=trigger;t.isEventDraggable=isEventDraggable;t.isEventResizable=isEventResizable;t.setEventData=setEventData;t.clearEventData=clearEventData;t.eventEnd=eventEnd;t.reportEventElement=reportEventElement;t.triggerEventDestroy=triggerEventDestroy;t.eventElementHandlers=eventElementHandlers;t.showEvents=showEvents;t.hideEvents=hideEvents;t.eventDrop=eventDrop;t.eventResize=eventResize;var defaultEventEnd=t.defaultEventEnd;var normalizeEvent=calendar.normalizeEvent;var reportEventChange=calendar.reportEventChange;var eventsByID={};var eventElementsByID={};var eventElementCouples=[];var options=calendar.options;function opt(name,viewNameOverride){var v=options[name];if($.isPlainObject(v)){return smartProperty(v,viewNameOverride||viewName);}
return v;}
function trigger(name,thisObj){return calendar.trigger.apply(calendar,[name,thisObj||t].concat(Array.prototype.slice.call(arguments,2),[t]));}
function isEventDraggable(event){var source=event.source||{};return firstDefined(event.startEditable,source.startEditable,opt('eventStartEditable'),event.editable,source.editable,opt('editable'))&&!opt('disableDragging');}
function isEventResizable(event){var source=event.source||{};return firstDefined(event.durationEditable,source.durationEditable,opt('eventDurationEditable'),event.editable,source.editable,opt('editable'))&&!opt('disableResizing');}
function setEventData(events){eventsByID={};var i,len=events.length,event;for(i=0;i<len;i++){event=events[i];if(eventsByID[event._id]){eventsByID[event._id].push(event);}else{eventsByID[event._id]=[event];}}}
function clearEventData(){eventsByID={};eventElementsByID={};eventElementCouples=[];}
function eventEnd(event){return event.end?cloneDate(event.end):defaultEventEnd(event);}
function reportEventElement(event,element){eventElementCouples.push({event:event,element:element});if(eventElementsByID[event._id]){eventElementsByID[event._id].push(element);}else{eventElementsByID[event._id]=[element];}}
function triggerEventDestroy(){$.each(eventElementCouples,function(i,couple){t.trigger('eventDestroy',couple.event,couple.event,couple.element);});}
function eventElementHandlers(event,eventElement){eventElement.click(function(ev){if(!eventElement.hasClass('ui-draggable-dragging')&&!eventElement.hasClass('ui-resizable-resizing')){return trigger('eventClick',this,event,ev);}}).hover(function(ev){trigger('eventMouseover',this,event,ev);},function(ev){trigger('eventMouseout',this,event,ev);});}
function showEvents(event,exceptElement){eachEventElement(event,exceptElement,'show');}
function hideEvents(event,exceptElement){eachEventElement(event,exceptElement,'hide');}
function eachEventElement(event,exceptElement,funcName){var elements=eventElementsByID[event._id],i,len=elements.length;for(i=0;i<len;i++){if(!exceptElement||elements[i][0]!=exceptElement[0]){elements[i][funcName]();}}}
function eventDrop(e,event,dayDelta,minuteDelta,allDay,ev,ui){var oldAllDay=event.allDay;var eventId=event._id;moveEvents(eventsByID[eventId],dayDelta,minuteDelta,allDay);trigger('eventDrop',e,event,dayDelta,minuteDelta,allDay,function(){moveEvents(eventsByID[eventId],-dayDelta,-minuteDelta,oldAllDay);reportEventChange(eventId);},ev,ui);reportEventChange(eventId);}
function eventResize(e,event,dayDelta,minuteDelta,ev,ui){var eventId=event._id;elongateEvents(eventsByID[eventId],dayDelta,minuteDelta);trigger('eventResize',e,event,dayDelta,minuteDelta,function(){elongateEvents(eventsByID[eventId],-dayDelta,-minuteDelta);reportEventChange(eventId);},ev,ui);reportEventChange(eventId);}
function moveEvents(events,dayDelta,minuteDelta,allDay){minuteDelta=minuteDelta||0;for(var e,len=events.length,i=0;i<len;i++){e=events[i];if(allDay!==undefined){e.allDay=allDay;}
addMinutes(addDays(e.start,dayDelta,true),minuteDelta);if(e.end){e.end=addMinutes(addDays(e.end,dayDelta,true),minuteDelta);}
normalizeEvent(e,options);}}
function elongateEvents(events,dayDelta,minuteDelta){minuteDelta=minuteDelta||0;for(var e,len=events.length,i=0;i<len;i++){e=events[i];e.end=addMinutes(addDays(eventEnd(e),dayDelta,true),minuteDelta);normalizeEvent(e,options);}}
t.isHiddenDay=isHiddenDay;t.skipHiddenDays=skipHiddenDays;t.getCellsPerWeek=getCellsPerWeek;t.dateToCell=dateToCell;t.dateToDayOffset=dateToDayOffset;t.dayOffsetToCellOffset=dayOffsetToCellOffset;t.cellOffsetToCell=cellOffsetToCell;t.cellToDate=cellToDate;t.cellToCellOffset=cellToCellOffset;t.cellOffsetToDayOffset=cellOffsetToDayOffset;t.dayOffsetToDate=dayOffsetToDate;t.rangeToSegments=rangeToSegments;var hiddenDays=opt('hiddenDays')||[];var isHiddenDayHash=[];var cellsPerWeek;var dayToCellMap=[];var cellToDayMap=[];var isRTL=opt('isRTL');(function(){if(opt('weekends')===false){hiddenDays.push(0,6);}
for(var dayIndex=0,cellIndex=0;dayIndex<7;dayIndex++){dayToCellMap[dayIndex]=cellIndex;isHiddenDayHash[dayIndex]=$.inArray(dayIndex,hiddenDays)!=-1;if(!isHiddenDayHash[dayIndex]){cellToDayMap[cellIndex]=dayIndex;cellIndex++;}}
cellsPerWeek=cellIndex;if(!cellsPerWeek){throw'invalid hiddenDays';}})();function isHiddenDay(day){if(typeof day=='object'){day=day.getDay();}
return isHiddenDayHash[day];}
function getCellsPerWeek(){return cellsPerWeek;}
function skipHiddenDays(date,inc,isExclusive){inc=inc||1;while(isHiddenDayHash[(date.getDay()+(isExclusive?inc:0)+7)%7]){addDays(date,inc);}}
function cellToDate(){var cellOffset=cellToCellOffset.apply(null,arguments);var dayOffset=cellOffsetToDayOffset(cellOffset);var date=dayOffsetToDate(dayOffset);return date;}
function cellToCellOffset(row,col){var colCnt=t.getColCnt();var dis=isRTL?-1:1;var dit=isRTL?colCnt-1:0;if(typeof row=='object'){col=row.col;row=row.row;}
var cellOffset=row*colCnt+(col*dis+dit);return cellOffset;}
function cellOffsetToDayOffset(cellOffset){var day0=t.visStart.getDay();cellOffset+=dayToCellMap[day0];return Math.floor(cellOffset/cellsPerWeek)*7
+cellToDayMap[(cellOffset%cellsPerWeek+cellsPerWeek)%cellsPerWeek]
-day0;}
function dayOffsetToDate(dayOffset){var date=cloneDate(t.visStart);addDays(date,dayOffset);return date;}
function dateToCell(date){var dayOffset=dateToDayOffset(date);var cellOffset=dayOffsetToCellOffset(dayOffset);var cell=cellOffsetToCell(cellOffset);return cell;}
function dateToDayOffset(date){return dayDiff(date,t.visStart);}
function dayOffsetToCellOffset(dayOffset){var day0=t.visStart.getDay();dayOffset+=day0;return Math.floor(dayOffset/7)*cellsPerWeek
+dayToCellMap[(dayOffset%7+7)%7]
-dayToCellMap[day0];}
function cellOffsetToCell(cellOffset){var colCnt=t.getColCnt();var dis=isRTL?-1:1;var dit=isRTL?colCnt-1:0;var row=Math.floor(cellOffset/colCnt);var col=((cellOffset%colCnt+colCnt)%colCnt)*dis+dit;return{row:row,col:col};}
function rangeToSegments(startDate,endDate){var rowCnt=t.getRowCnt();var colCnt=t.getColCnt();var segments=[];var rangeDayOffsetStart=dateToDayOffset(startDate);var rangeDayOffsetEnd=dateToDayOffset(endDate);var rangeCellOffsetFirst=dayOffsetToCellOffset(rangeDayOffsetStart);var rangeCellOffsetLast=dayOffsetToCellOffset(rangeDayOffsetEnd)-1;for(var row=0;row<rowCnt;row++){var rowCellOffsetFirst=row*colCnt;var rowCellOffsetLast=rowCellOffsetFirst+colCnt-1;var segmentCellOffsetFirst=Math.max(rangeCellOffsetFirst,rowCellOffsetFirst);var segmentCellOffsetLast=Math.min(rangeCellOffsetLast,rowCellOffsetLast);if(segmentCellOffsetFirst<=segmentCellOffsetLast){var segmentCellFirst=cellOffsetToCell(segmentCellOffsetFirst);var segmentCellLast=cellOffsetToCell(segmentCellOffsetLast);var cols=[segmentCellFirst.col,segmentCellLast.col].sort();var isStart=cellOffsetToDayOffset(segmentCellOffsetFirst)==rangeDayOffsetStart;var isEnd=cellOffsetToDayOffset(segmentCellOffsetLast)+1==rangeDayOffsetEnd;segments.push({row:row,leftCol:cols[0],rightCol:cols[1],isStart:isStart,isEnd:isEnd});}}
return segments;}};;function DayEventRenderer(){var t=this;t.renderDayEvents=renderDayEvents;t.draggableDayEvent=draggableDayEvent;t.resizableDayEvent=resizableDayEvent;var opt=t.opt;var trigger=t.trigger;var isEventDraggable=t.isEventDraggable;var isEventResizable=t.isEventResizable;var eventEnd=t.eventEnd;var reportEventElement=t.reportEventElement;var eventElementHandlers=t.eventElementHandlers;var showEvents=t.showEvents;var hideEvents=t.hideEvents;var eventDrop=t.eventDrop;var eventResize=t.eventResize;var getRowCnt=t.getRowCnt;var getColCnt=t.getColCnt;var getColWidth=t.getColWidth;var allDayRow=t.allDayRow;var colLeft=t.colLeft;var colRight=t.colRight;var colContentLeft=t.colContentLeft;var colContentRight=t.colContentRight;var dateToCell=t.dateToCell;var getDaySegmentContainer=t.getDaySegmentContainer;var formatDates=t.calendar.formatDates;var renderDayOverlay=t.renderDayOverlay;var clearOverlays=t.clearOverlays;var clearSelection=t.clearSelection;var getHoverListener=t.getHoverListener;var rangeToSegments=t.rangeToSegments;var cellToDate=t.cellToDate;var cellToCellOffset=t.cellToCellOffset;var cellOffsetToDayOffset=t.cellOffsetToDayOffset;var dateToDayOffset=t.dateToDayOffset;var dayOffsetToCellOffset=t.dayOffsetToCellOffset;function renderDayEvents(events,modifiedEventId){var segments=_renderDayEvents(events,false,true);segmentElementEach(segments,function(segment,element){reportEventElement(segment.event,element);});attachHandlers(segments,modifiedEventId);segmentElementEach(segments,function(segment,element){trigger('eventAfterRender',segment.event,segment.event,element);});}
function renderTempDayEvent(event,adjustRow,adjustTop){var segments=_renderDayEvents([event],true,false);var elements=[];segmentElementEach(segments,function(segment,element){if(segment.row===adjustRow){element.css('top',adjustTop);}
elements.push(element[0]);});return elements;}
function _renderDayEvents(events,doAppend,doRowHeights){var finalContainer=getDaySegmentContainer();var renderContainer=doAppend?$("<div/>"):finalContainer;var segments=buildSegments(events);var html;var elements;calculateHorizontals(segments);html=buildHTML(segments);renderContainer[0].innerHTML=html;elements=renderContainer.children();if(doAppend){finalContainer.append(elements);}
resolveElements(segments,elements);segmentElementEach(segments,function(segment,element){segment.hsides=hsides(element,true);});segmentElementEach(segments,function(segment,element){element.width(Math.max(0,segment.outerWidth-segment.hsides));});segmentElementEach(segments,function(segment,element){segment.outerHeight=element.outerHeight(true);});setVerticals(segments,doRowHeights);return segments;}
function buildSegments(events){var segments=[];for(var i=0;i<events.length;i++){var eventSegments=buildSegmentsForEvent(events[i]);segments.push.apply(segments,eventSegments);}
return segments;}
function buildSegmentsForEvent(event){var startDate=event.start;var endDate=exclEndDay(event);var segments=rangeToSegments(startDate,endDate);for(var i=0;i<segments.length;i++){segments[i].event=event;}
return segments;}
function calculateHorizontals(segments){var isRTL=opt('isRTL');for(var i=0;i<segments.length;i++){var segment=segments[i];var leftFunc=(isRTL?segment.isEnd:segment.isStart)?colContentLeft:colLeft;var rightFunc=(isRTL?segment.isStart:segment.isEnd)?colContentRight:colRight;var left=leftFunc(segment.leftCol);var right=rightFunc(segment.rightCol);segment.left=left;segment.outerWidth=right-left;}}
function buildHTML(segments){var html='';for(var i=0;i<segments.length;i++){html+=buildHTMLForSegment(segments[i]);}
return html;}
function buildHTMLForSegment(segment){var html='';var isRTL=opt('isRTL');var event=segment.event;var url=event.url;var classNames=['fc-event','fc-event-hori'];if(isEventDraggable(event)){classNames.push('fc-event-draggable');}
if(segment.isStart){classNames.push('fc-event-start');}
if(segment.isEnd){classNames.push('fc-event-end');}
classNames=classNames.concat(event.className);if(event.source){classNames=classNames.concat(event.source.className||[]);}
var skinCss=getSkinCss(event,opt);if(url){html+="<a href='"+htmlEscape(url)+"'";}else{html+="<div";}
html+=" class='"+classNames.join(' ')+"'"+" style="+"'"+"position:absolute;"+"left:"+segment.left+"px;"+
skinCss+"'"+">"+"<div class='fc-event-inner'>";if(!event.allDay&&segment.isStart){html+="<span class='fc-event-time'>"+
htmlEscape(formatDates(event.start,event.end,opt('timeFormat')))+"</span>";}
html+="<span class='fc-event-title'>"+
htmlEscape(event.title||'')+"</span>"+"</div>";if(segment.isEnd&&isEventResizable(event)){html+="<div class='ui-resizable-handle ui-resizable-"+(isRTL?'w':'e')+"'>"+"&nbsp;&nbsp;&nbsp;"+"</div>";}
html+="</"+(url?"a":"div")+">";return html;}
function resolveElements(segments,elements){for(var i=0;i<segments.length;i++){var segment=segments[i];var event=segment.event;var element=elements.eq(i);var triggerRes=trigger('eventRender',event,event,element);if(triggerRes===false){element.remove();}
else{if(triggerRes&&triggerRes!==true){triggerRes=$(triggerRes).css({position:'absolute',left:segment.left});element.replaceWith(triggerRes);element=triggerRes;}
segment.element=element;}}}
function setVerticals(segments,doRowHeights){var rowContentHeights=calculateVerticals(segments);var rowContentElements=getRowContentElements();var rowContentTops=[];if(doRowHeights){for(var i=0;i<rowContentElements.length;i++){rowContentElements[i].height(rowContentHeights[i]);}}
for(var i=0;i<rowContentElements.length;i++){rowContentTops.push(rowContentElements[i].position().top);}
segmentElementEach(segments,function(segment,element){element.css('top',rowContentTops[segment.row]+segment.top);});}
function calculateVerticals(segments){var rowCnt=getRowCnt();var colCnt=getColCnt();var rowContentHeights=[];var segmentRows=buildSegmentRows(segments);for(var rowI=0;rowI<rowCnt;rowI++){var segmentRow=segmentRows[rowI];var colHeights=[];for(var colI=0;colI<colCnt;colI++){colHeights.push(0);}
for(var segmentI=0;segmentI<segmentRow.length;segmentI++){var segment=segmentRow[segmentI];segment.top=arrayMax(colHeights.slice(segment.leftCol,segment.rightCol+1));for(var colI=segment.leftCol;colI<=segment.rightCol;colI++){colHeights[colI]=segment.top+segment.outerHeight;}}
rowContentHeights.push(arrayMax(colHeights));}
return rowContentHeights;}
function buildSegmentRows(segments){var rowCnt=getRowCnt();var segmentRows=[];var segmentI;var segment;var rowI;for(segmentI=0;segmentI<segments.length;segmentI++){segment=segments[segmentI];rowI=segment.row;if(segment.element){if(segmentRows[rowI]){segmentRows[rowI].push(segment);}
else{segmentRows[rowI]=[segment];}}}
for(rowI=0;rowI<rowCnt;rowI++){segmentRows[rowI]=sortSegmentRow(segmentRows[rowI]||[]);}
return segmentRows;}
function sortSegmentRow(segments){var sortedSegments=[];var subrows=buildSegmentSubrows(segments);for(var i=0;i<subrows.length;i++){sortedSegments.push.apply(sortedSegments,subrows[i]);}
return sortedSegments;}
function buildSegmentSubrows(segments){segments.sort(compareDaySegments);var subrows=[];for(var i=0;i<segments.length;i++){var segment=segments[i];for(var j=0;j<subrows.length;j++){if(!isDaySegmentCollision(segment,subrows[j])){break;}}
if(subrows[j]){subrows[j].push(segment);}
else{subrows[j]=[segment];}}
return subrows;}
function getRowContentElements(){var i;var rowCnt=getRowCnt();var rowDivs=[];for(i=0;i<rowCnt;i++){rowDivs[i]=allDayRow(i).find('div.fc-day-content > div');}
return rowDivs;}
function attachHandlers(segments,modifiedEventId){var segmentContainer=getDaySegmentContainer();segmentElementEach(segments,function(segment,element,i){var event=segment.event;if(event._id===modifiedEventId){bindDaySeg(event,element,segment);}else{element[0]._fci=i;}});lazySegBind(segmentContainer,segments,bindDaySeg);}
function bindDaySeg(event,eventElement,segment){if(isEventDraggable(event)){t.draggableDayEvent(event,eventElement,segment);}
if(segment.isEnd&&isEventResizable(event)){t.resizableDayEvent(event,eventElement,segment);}
eventElementHandlers(event,eventElement);}
function draggableDayEvent(event,eventElement){var hoverListener=getHoverListener();var dayDelta;eventElement.draggable({delay:50,opacity:opt('dragOpacity'),revertDuration:opt('dragRevertDuration'),start:function(ev,ui){trigger('eventDragStart',eventElement,event,ev,ui);hideEvents(event,eventElement);hoverListener.start(function(cell,origCell,rowDelta,colDelta){eventElement.draggable('option','revert',!cell||!rowDelta&&!colDelta);clearOverlays();if(cell){var origDate=cellToDate(origCell);var date=cellToDate(cell);dayDelta=dayDiff(date,origDate);renderDayOverlay(addDays(cloneDate(event.start),dayDelta),addDays(exclEndDay(event),dayDelta));}else{dayDelta=0;}},ev,'drag');},stop:function(ev,ui){hoverListener.stop();clearOverlays();trigger('eventDragStop',eventElement,event,ev,ui);if(dayDelta){eventDrop(this,event,dayDelta,0,event.allDay,ev,ui);}else{eventElement.css('filter','');showEvents(event,eventElement);}}});}
function resizableDayEvent(event,element,segment){var isRTL=opt('isRTL');var direction=isRTL?'w':'e';var handle=element.find('.ui-resizable-'+direction);var isResizing=false;disableTextSelection(element);element.mousedown(function(ev){ev.preventDefault();}).click(function(ev){if(isResizing){ev.preventDefault();ev.stopImmediatePropagation();}});handle.mousedown(function(ev){if(ev.which!=1){return;}
isResizing=true;var hoverListener=getHoverListener();var rowCnt=getRowCnt();var colCnt=getColCnt();var elementTop=element.css('top');var dayDelta;var helpers;var eventCopy=$.extend({},event);var minCellOffset=dayOffsetToCellOffset(dateToDayOffset(event.start));clearSelection();$('body').css('cursor',direction+'-resize').one('mouseup',mouseup);trigger('eventResizeStart',this,event,ev);hoverListener.start(function(cell,origCell){if(cell){var origCellOffset=cellToCellOffset(origCell);var cellOffset=cellToCellOffset(cell);cellOffset=Math.max(cellOffset,minCellOffset);dayDelta=cellOffsetToDayOffset(cellOffset)-
cellOffsetToDayOffset(origCellOffset);if(dayDelta){eventCopy.end=addDays(eventEnd(event),dayDelta,true);var oldHelpers=helpers;helpers=renderTempDayEvent(eventCopy,segment.row,elementTop);helpers=$(helpers);helpers.find('*').css('cursor',direction+'-resize');if(oldHelpers){oldHelpers.remove();}
hideEvents(event);}
else{if(helpers){showEvents(event);helpers.remove();helpers=null;}}
clearOverlays();renderDayOverlay(event.start,addDays(exclEndDay(event),dayDelta));}},ev);function mouseup(ev){trigger('eventResizeStop',this,event,ev);$('body').css('cursor','');hoverListener.stop();clearOverlays();if(dayDelta){eventResize(this,event,dayDelta,0,ev);}
setTimeout(function(){isResizing=false;},0);}});}}
function isDaySegmentCollision(segment,otherSegments){for(var i=0;i<otherSegments.length;i++){var otherSegment=otherSegments[i];if(otherSegment.leftCol<=segment.rightCol&&otherSegment.rightCol>=segment.leftCol){return true;}}
return false;}
function segmentElementEach(segments,callback){for(var i=0;i<segments.length;i++){var segment=segments[i];var element=segment.element;if(element){callback(segment,element,i);}}}
function compareDaySegments(a,b){return(b.rightCol-b.leftCol)-(a.rightCol-a.leftCol)||b.event.allDay-a.event.allDay||a.event.start-b.event.start||(a.event.title||'').localeCompare(b.event.title)};;function SelectionManager(){var t=this;t.select=select;t.unselect=unselect;t.reportSelection=reportSelection;t.daySelectionMousedown=daySelectionMousedown;var opt=t.opt;var trigger=t.trigger;var defaultSelectionEnd=t.defaultSelectionEnd;var renderSelection=t.renderSelection;var clearSelection=t.clearSelection;var selected=false;if(opt('selectable')&&opt('unselectAuto')){$(document).mousedown(function(ev){var ignore=opt('unselectCancel');if(ignore){if($(ev.target).parents(ignore).length){return;}}
unselect(ev);});}
function select(startDate,endDate,allDay){unselect();if(!endDate){endDate=defaultSelectionEnd(startDate,allDay);}
renderSelection(startDate,endDate,allDay);reportSelection(startDate,endDate,allDay);}
function unselect(ev){if(selected){selected=false;clearSelection();trigger('unselect',null,ev);}}
function reportSelection(startDate,endDate,allDay,ev){selected=true;trigger('select',null,startDate,endDate,allDay,ev);}
function daySelectionMousedown(ev){var cellToDate=t.cellToDate;var getIsCellAllDay=t.getIsCellAllDay;var hoverListener=t.getHoverListener();var reportDayClick=t.reportDayClick;if(ev.which==1&&opt('selectable')){unselect(ev);var _mousedownElement=this;var dates;hoverListener.start(function(cell,origCell){clearSelection();if(cell&&getIsCellAllDay(cell)){dates=[cellToDate(origCell),cellToDate(cell)].sort(dateCompare);renderSelection(dates[0],dates[1],true);}else{dates=null;}},ev);$(document).one('mouseup',function(ev){hoverListener.stop();if(dates){if(+dates[0]==+dates[1]){reportDayClick(dates[0],true,ev);}
reportSelection(dates[0],dates[1],true,ev);}});}}};;function OverlayManager(){var t=this;t.renderOverlay=renderOverlay;t.clearOverlays=clearOverlays;var usedOverlays=[];var unusedOverlays=[];function renderOverlay(rect,parent){var e=unusedOverlays.shift();if(!e){e=$("<div class='fc-cell-overlay' style='position:absolute;z-index:3'/>");}
if(e[0].parentNode!=parent[0]){e.appendTo(parent);}
usedOverlays.push(e.css(rect).show());return e;}
function clearOverlays(){var e;while(e=usedOverlays.shift()){unusedOverlays.push(e.hide().unbind());}}};;function CoordinateGrid(buildFunc){var t=this;var rows;var cols;t.build=function(){rows=[];cols=[];buildFunc(rows,cols);};t.cell=function(x,y){var rowCnt=rows.length;var colCnt=cols.length;var i,r=-1,c=-1;for(i=0;i<rowCnt;i++){if(y>=rows[i][0]&&y<rows[i][1]){r=i;break;}}
for(i=0;i<colCnt;i++){if(x>=cols[i][0]&&x<cols[i][1]){c=i;break;}}
return(r>=0&&c>=0)?{row:r,col:c}:null;};t.rect=function(row0,col0,row1,col1,originElement){var origin=originElement.offset();return{top:rows[row0][0]-origin.top,left:cols[col0][0]-origin.left,width:cols[col1][1]-cols[col0][0],height:rows[row1][1]-rows[row0][0]};};};;function HoverListener(coordinateGrid){var t=this;var bindType;var change;var firstCell;var cell;t.start=function(_change,ev,_bindType){change=_change;firstCell=cell=null;coordinateGrid.build();mouse(ev);bindType=_bindType||'mousemove';$(document).bind(bindType,mouse);};function mouse(ev){_fixUIEvent(ev);var newCell=coordinateGrid.cell(ev.pageX,ev.pageY);if(!newCell!=!cell||newCell&&(newCell.row!=cell.row||newCell.col!=cell.col)){if(newCell){if(!firstCell){firstCell=newCell;}
change(newCell,firstCell,newCell.row-firstCell.row,newCell.col-firstCell.col);}else{change(newCell,firstCell);}
cell=newCell;}}
t.stop=function(){$(document).unbind(bindType,mouse);return cell;};}
function _fixUIEvent(event){if(event.pageX===undefined){event.pageX=event.originalEvent.pageX;event.pageY=event.originalEvent.pageY;}};;function HorizontalPositionCache(getElement){var t=this,elements={},lefts={},rights={};function e(i){return elements[i]=elements[i]||getElement(i);}
t.left=function(i){return lefts[i]=lefts[i]===undefined?e(i).position().left:lefts[i];};t.right=function(i){return rights[i]=rights[i]===undefined?t.left(i)+e(i).width():rights[i];};t.clear=function(){elements={};lefts={};rights={};};};;})(jQuery);;

/* /web_calendar/static/src/js/widgets.js defined in bundle 'web.assets_backend' */
odoo.define('web_calendar.widgets',function(require){"use strict";var core=require('web.core');var data=require('web.data');var Dialog=require('web.Dialog');var form_common=require('web.form_common');var Widget=require('web.Widget');var _t=core._t;var QWeb=core.qweb;var QuickCreate=Dialog.extend({init:function(parent,dataset,buttons,options,data_template){this.dataset=dataset;this._buttons=buttons||false;this.options=options;this.data_template=data_template||{};this.$input=$();var self=this;this._super(parent,{title:this.get_title(),size:'small',buttons:this._buttons?[{text:_t("Create"),classes:'btn-primary',click:function(){if(!self.quick_add()){self.focus();}}},{text:_t("Edit"),click:function(){self.slow_add();}},{text:_t("Cancel"),close:true},]:[],$content:QWeb.render('CalendarView.quick_create',{widged:this})});},get_title:function(){var parent=this.getParent();if(_.isUndefined(parent)){return _t("Create");}
var title=(_.isUndefined(parent.field_widget))?(parent.title||parent.string||parent.name):(parent.field_widget.string||parent.field_widget.name||'');return _t("Create: ")+title;},start:function(){var self=this;if(this.options.disable_quick_create){this.slow_create();return;}
this.on('added',this,function(){self.close();});this.$input=this.$('input').keyup(function enterHandler(e){if(e.keyCode==$.ui.keyCode.ENTER){self.$input.off('keyup',enterHandler);if(!self.quick_add()){self.$input.on('keyup',enterHandler);}}else if(e.keyCode==$.ui.keyCode.ESCAPE&&self._buttons){self.close();}});return this._super();},focus:function(){this.$input.focus();},quick_add:function(){var val=this.$input.val().trim();return(val)?this.quick_create({'name':val}):false;},slow_add:function(){var val=this.$input.val().trim();this.slow_create(_.isEmpty(val)?{}:{'name':val});},quick_create:function(data,options){var self=this;return this.dataset.create($.extend({},this.data_template,data),options).then(function(id){self.trigger('added',id);self.$input.val("");},function(r,event){event.preventDefault();self.slow_create(data);});},get_form_popup_infos:function(){var parent=this.getParent();var infos={view_id:false,title:this.name,};if(!_.isUndefined(parent)&&!(_.isUndefined(parent.ViewManager))){infos.view_id=parent.ViewManager.get_view_id('form');}
return infos;},slow_create:function(_data){var self=this;var def=$.Deferred();var defaults={};var created=false;_.each($.extend({},this.data_template,_data),function(val,field_name){defaults['default_'+field_name]=val;});var pop_infos=self.get_form_popup_infos();var context=new data.CompoundContext(this.dataset.context,defaults);var pop=new form_common.FormViewDialog(this,{res_model:this.dataset.model,context:this.dataset.get_context(defaults),title:this.get_title(),disable_multiple_selection:true,view_id:pop_infos.view_id,create_function:function(data,options){return self.dataset.create(data,options).done(function(r){}).fail(function(r,event){if(!r.data.message){throw new Error(r);}});},read_function:function(id,fields,options){return self.dataset.read_ids.apply(self.dataset,arguments).done(function(){}).fail(function(r,event){if(!r.data.message){throw new Error(r);}});}}).open();pop.on('closed',self,function(){if(def.state()==="pending"){def.resolve();}});pop.on('create_completed',self,function(id){created=true;self.trigger('slowadded');});def.then(function(){if(created){var parent=self.getParent();parent.$calendar.fullCalendar('refetchEvents');}
self.close();self.trigger("closed");});return def;},});var Sidebar=Widget.extend({template:'CalendarView.sidebar',start:function(){this._super();this.filter=new SidebarFilter(this,this.getParent());this.filter.appendTo(this.$('.o_calendar_filter'));}});var SidebarFilter=Widget.extend({className:'o_calendar_all_responsibles',events:{'change input:checkbox':'filter_click','click span.color_filter':'select_previous',},init:function(parent,view){this._super(parent);this.view=view;},set_filters:function(){var self=this;_.forEach(self.view.all_filters,function(o){if(_.contains(self.view.now_filter_ids,o.value)){self.$('div.o_calendar_responsible input[value='+o.value+']').prop('checked',o.is_checked);}});},events_loaded:function(filters){var self=this;if(!filters){filters=[];_.forEach(self.view.get_all_filters_ordered(),function(o){if(_.contains(self.view.now_filter_ids,o.value)){filters.push(o);}});}
this.$el.html(QWeb.render('CalendarView.sidebar.responsible',{filters:filters}));},filter_click:function(e){var self=this;if(self.view.all_filters[0]&&e.target.value==self.view.all_filters[0].value){self.view.all_filters[0].is_checked=e.target.checked;}else{self.view.all_filters[e.target.value].is_checked=e.target.checked;}
self.view.$calendar.fullCalendar('refetchEvents');},select_previous:function(e){$(e.target).siblings('input').trigger('click');}});return{QuickCreate:QuickCreate,Sidebar:Sidebar,SidebarFilter:SidebarFilter};});;

/* /web_calendar/static/src/js/web_calendar.js defined in bundle 'web.assets_backend' */
odoo.define('web_calendar.CalendarView',function(require){"use strict";var core=require('web.core');var data=require('web.data');var form_common=require('web.form_common');var Model=require('web.DataModel');var time=require('web.time');var View=require('web.View');var widgets=require('web_calendar.widgets');var CompoundDomain=data.CompoundDomain;var _t=core._t;var _lt=core._lt;var QWeb=core.qweb;function get_fc_defaultOptions(){var dateFormat=time.strftime_to_moment_format(_t.database.parameters.date_format);var conversions=[['YYYY','yyyy'],['YY','y'],['DDDD','dddd'],['DD','dd']];_.each(conversions,function(conv){dateFormat=dateFormat.replace(conv[0],conv[1]);});return{weekNumberTitle:_t("W"),allDayText:_t("All day"),monthNames:moment.months(),monthNamesShort:moment.monthsShort(),dayNames:moment.weekdays(),dayNamesShort:moment.weekdaysShort(),firstDay:moment._locale._week.dow,weekNumbers:true,titleFormat:{month:'MMMM yyyy',week:"W",day:dateFormat,},columnFormat:{month:'ddd',week:'ddd '+dateFormat,day:'dddd '+dateFormat,},weekMode:'liquid',snapMinutes:15,};}
function is_virtual_id(id){return typeof id==="string"&&id.indexOf('-')>=0;}
function isNullOrUndef(value){return _.isUndefined(value)||_.isNull(value);}
var CalendarView=View.extend({template:"CalendarView",display_name:_lt('Calendar'),icon:'fa-calendar',quick_create_instance:widgets.QuickCreate,init:function(parent,dataset,view_id,options){this._super(parent);this.ready=$.Deferred();this.set_default_options(options);this.dataset=dataset;this.model=dataset.model;this.fields_view={};this.view_id=view_id;this.view_type='calendar';this.color_map={};this.range_start=null;this.range_stop=null;this.selected_filters=[];this.title=(this.options.action)?this.options.action.name:'';this.shown=$.Deferred();},set_default_options:function(options){this._super(options);_.defaults(this.options,{confirm_on_delete:true});},destroy:function(){if(this.$calendar){this.$calendar.fullCalendar('destroy');}
if(this.$small_calendar){this.$small_calendar.datepicker('destroy');}
this._super.apply(this,arguments);},view_loading:function(fv){var attrs=fv.arch.attrs,self=this;this.fields_view=fv;this.$calendar=this.$(".o_calendar_widget");this.info_fields=[];if(!attrs.date_start){throw new Error(_t("Calendar view has not defined 'date_start' attribute."));}
this.$el.addClass(attrs['class']);this.name=fv.name||attrs.string;this.view_id=fv.view_id;this.mode=attrs.mode;this.date_start=attrs.date_start;this.date_delay=attrs.date_delay;this.date_stop=attrs.date_stop;this.all_day=attrs.all_day;this.how_display_event='';this.attendee_people=attrs.attendee;this.editable=!this.options.read_only_mode&&!this.fields_view.fields[this.date_start].readonly;this.quick_add_pop=(isNullOrUndef(attrs.quick_add)||_.str.toBoolElse(attrs.quick_add,true));if(!isNullOrUndef(attrs.display)){this.how_display_event=attrs.display;}
if(isNullOrUndef(attrs.event_open_popup)||!_.str.toBoolElse(attrs.event_open_popup,true)){this.open_popup_action=false;}else{this.open_popup_action=attrs.event_open_popup;}
this.useContacts=!isNullOrUndef(attrs.use_contacts)&&_.str.toBool(attrs.use_contacts);this.colorIsAttendee=!(isNullOrUndef(attrs.color_is_attendee)||!_.str.toBoolElse(attrs.color_is_attendee,true));if(isNullOrUndef(self.options.sidebar)){this.useContacts=false;this.colorIsAttendee=false;this.attendee_people=undefined;}
if(isNullOrUndef(attrs.avatar_model)){this.avatar_model=null;}else{this.avatar_model=attrs.avatar_model;}
if(isNullOrUndef(attrs.avatar_title)){this.avatar_title=this.avatar_model;}else{this.avatar_title=attrs.avatar_title;}
if(isNullOrUndef(attrs.avatar_filter)){this.avatar_filter=this.avatar_model;}else{this.avatar_filter=attrs.avatar_filter;}
this.color_field=attrs.color;if(this.color_field&&this.selected_filters.length===0){var default_filter;if((default_filter=this.dataset.context['calendar_default_'+this.color_field])){this.selected_filters.push(default_filter+'');}}
this.fields=fv.fields;for(var fld=0;fld<fv.arch.children.length;fld++){this.info_fields.push(fv.arch.children[fld].attrs.name);}
self.shown.done(this._do_show_init.bind(this));var edit_check=new Model(this.dataset.model).call("check_access_rights",["write",false]).then(function(write_right){self.write_right=write_right;});var init=new Model(this.dataset.model).call("check_access_rights",["create",false]).then(function(create_right){self.create_right=create_right;self.ready.resolve();self.trigger('calendar_view_loaded',fv);});return $.when(edit_check,init);},_do_show_init:function(){var self=this;this.init_calendar().then(function(){$(window).trigger('resize');self.trigger('calendar_view_loaded',self.fields_view);});},render_buttons:function($node){var self=this;this.$buttons=$(QWeb.render("CalendarView.buttons",{'widget':this}));this.$buttons.on('click','button.o_calendar_button_new',function(){self.dataset.index=null;self.do_switch_view('form');});var bindCalendarButton=function(selector,arg1,arg2){self.$buttons.on('click',selector,_.bind(self.$calendar.fullCalendar,self.$calendar,arg1,arg2));}
bindCalendarButton('.o_calendar_button_prev','prev');bindCalendarButton('.o_calendar_button_today','today');bindCalendarButton('.o_calendar_button_next','next');bindCalendarButton('.o_calendar_button_day','changeView','agendaDay');bindCalendarButton('.o_calendar_button_week','changeView','agendaWeek');bindCalendarButton('.o_calendar_button_month','changeView','month');this.$buttons.find('.o_calendar_button_'+this.mode).addClass('active');$node=$node||this.options.$buttons;if($node){this.$buttons.appendTo($node);}else{this.$('.o_calendar_buttons').replaceWith(this.$buttons);}},get_fc_init_options:function(){var self=this;return $.extend({},get_fc_defaultOptions(),{defaultView:(this.mode=="month")?"month":((this.mode=="week")?"agendaWeek":((this.mode=="day")?"agendaDay":"agendaWeek")),header:false,selectable:!this.options.read_only_mode&&this.create_right,selectHelper:true,editable:this.editable,droppable:true,viewRender:function(view){var mode=(view.name=="month")?"month":((view.name=="agendaWeek")?"week":"day");if(self.$buttons!==undefined){self.$buttons.find('.active').removeClass('active');self.$buttons.find('.o_calendar_button_'+mode).addClass('active');}
var title=self.title+' ('+((mode==="week")?_t("Week "):"")+view.title+")";self.set({'title':title});self.$calendar.fullCalendar('option','height',Math.max(290,parseInt(self.$('.o_calendar_view').height())));setTimeout(function(){var $fc_view=self.$calendar.find('.fc-view');var width=$fc_view.find('> table').width();$fc_view.find('> div').css('width',(width>$fc_view.width())?width:'100%');},0);},windowResize:function(){self.$calendar.fullCalendar('render');},eventDrop:function(event,_day_delta,_minute_delta,_all_day,_revertFunc){var data=self.get_event_data(event);self.proxy('update_record')(event._id,data);},eventResize:function(event,_day_delta,_minute_delta,_revertFunc){var data=self.get_event_data(event);self.proxy('update_record')(event._id,data);},eventRender:function(event,element,view){element.find('.fc-event-title').html(event.title);},eventAfterRender:function(event,element,view){if((view.name!=='month')&&(((event.end-event.start)/60000)<=30)){var current_title=$(element.find('.fc-event-time')).text();var new_title=current_title.substr(0,current_title.indexOf("<img")>0?current_title.indexOf("<img"):current_title.length);element.find('.fc-event-time').html(new_title);}},eventClick:function(event){self.open_event(event._id,event.title);},select:function(start_date,end_date,all_day,_js_event,_view){var data_template=self.get_event_data({start:start_date,end:end_date,allDay:all_day,});self.open_quick_create(data_template);},unselectAuto:false,});},calendarMiniChanged:function(context){return function(datum,obj){var curView=context.$calendar.fullCalendar('getView');var curDate=new Date(obj.currentYear,obj.currentMonth,obj.currentDay);if(curView.name=="agendaWeek"){if(curDate<=curView.end&&curDate>=curView.start){context.$calendar.fullCalendar('changeView','agendaDay');}}
else if(curView.name!="agendaDay"||(curView.name=="agendaDay"&&moment(curDate).diff(moment(curView.start))===0)){context.$calendar.fullCalendar('changeView','agendaWeek');}
context.$calendar.fullCalendar('gotoDate',obj.currentYear,obj.currentMonth,obj.currentDay);};},init_calendar:function(){if(!this.sidebar){var translate=get_fc_defaultOptions();this.sidebar=new widgets.Sidebar(this);this.sidebar.appendTo(this.$('.o_calendar_sidebar_container'));this.$small_calendar=this.$(".o_calendar_mini");this.$small_calendar.datepicker({onSelect:this.calendarMiniChanged(this),dayNamesMin:translate.dayNamesShort,monthNames:translate.monthNamesShort,firstDay:translate.firstDay,});this.extraSideBar();}
this.$calendar.fullCalendar(this.get_fc_init_options());return $.when();},extraSideBar:function(){return $.when();},get_quick_create_class:function(){return widgets.QuickCreate;},open_quick_create:function(data_template){if(!isNullOrUndef(this.quick)){return this.quick.close();}
var QuickCreate=this.get_quick_create_class();this.options.disable_quick_create=this.options.disable_quick_create||!this.quick_add_pop;this.quick=new QuickCreate(this,this.dataset,true,this.options,data_template);this.quick.on('added',this,this.quick_created).on('slowadded',this,this.slow_created).on('closed',this,function(){delete this.quick;this.$calendar.fullCalendar('unselect');});if(!this.options.disable_quick_create){this.quick.open();this.quick.focus();}else{this.quick.start();}},refresh_event:function(id){var self=this;if(is_virtual_id(id)){console.warn("Unwise use of refresh_event on a virtual ID.");}
this.dataset.read_ids([id],_.keys(this.fields)).done(function(incomplete_records){self.perform_necessary_name_gets(incomplete_records).then(function(records){var new_event=self.event_data_transform(records[0]);var event_objs=self.$calendar.fullCalendar('clientEvents',id);if(event_objs.length==1){var event_obj=event_objs[0];_(new_event).each(function(value,key){event_obj[key]=value;});self.$calendar.fullCalendar('updateEvent',event_obj);}else{var $fc_view=self.$calendar.find('.fc-view');var scrollPosition=$fc_view.scrollLeft();$fc_view.scrollLeft(0);self.$calendar.fullCalendar('renderEvent',new_event);$fc_view.scrollLeft(scrollPosition);self.$calendar.fullCalendar('clientEvents',id)[0].source=self.event_source;}});});},get_color:function(key){if(this.color_map[key]){return this.color_map[key];}
var index=(((_.keys(this.color_map).length+1)*5)%24)+1;this.color_map[key]=index;return index;},perform_necessary_name_gets:function(evts){var def=$.Deferred();var self=this;var to_get={};_(this.info_fields).each(function(fieldname){if(!_(["many2one","one2one"]).contains(self.fields[fieldname].type))
return;to_get[fieldname]=[];_(evts).each(function(evt){var value=evt[fieldname];if(value===false||(value instanceof Array)){return;}
to_get[fieldname].push(value);});if(to_get[fieldname].length===0){delete to_get[fieldname];}});var defs=_(to_get).map(function(ids,fieldname){return(new Model(self.fields[fieldname].relation)).call('name_get',ids).then(function(vals){return[fieldname,vals];});});$.when.apply(this,defs).then(function(){var values=arguments;_(values).each(function(value){var fieldname=value[0];var name_gets=value[1];_(name_gets).each(function(name_get){_(evts).chain().filter(function(e){return e[fieldname]==name_get[0];}).each(function(evt){evt[fieldname]=name_get;});});});def.resolve(evts);});return def;},event_data_transform:function(evt){var self=this;var date_start;var date_stop;var date_delay=evt[this.date_delay]||1.0,all_day=this.all_day?evt[this.all_day]:false,res_computed_text='',the_title='',attendees=[];if(!all_day){date_start=time.auto_str_to_date(evt[this.date_start]);date_stop=this.date_stop?time.auto_str_to_date(evt[this.date_stop]):null;}else{date_start=time.auto_str_to_date(evt[this.date_start].split(' ')[0],'start');date_stop=this.date_stop?time.auto_str_to_date(evt[this.date_stop].split(' ')[0],'start'):null;}
if(this.info_fields){var temp_ret={};res_computed_text=this.how_display_event;_.each(this.info_fields,function(fieldname){var value=evt[fieldname];if(_.contains(["many2one","one2one"],self.fields[fieldname].type)){if(value===false){temp_ret[fieldname]=null;}
else if(value instanceof Array){temp_ret[fieldname]=value[1];}
else if(_.contains(["date","datetime"],self.fields[fieldname].type)){temp_ret[fieldname]=instance.web.format_value(value,self.fields[fieldname]);}
else{throw new Error("Incomplete data received from dataset for record "+evt.id);}}
else if(_.contains(["one2many","many2many"],self.fields[fieldname].type)){if(value===false){temp_ret[fieldname]=null;}
else if(value instanceof Array){temp_ret[fieldname]=value;}
else{throw new Error("Incomplete data received from dataset for record "+evt.id);}}
else{temp_ret[fieldname]=value;}
res_computed_text=res_computed_text.replace("["+fieldname+"]",temp_ret[fieldname]);});if(res_computed_text.length){the_title=res_computed_text;}
else{var res_text=[];_.each(temp_ret,function(val,key){if(typeof(val)==='boolean'&&val===false){}
else{res_text.push(val);}});the_title=res_text.join(', ');}
the_title=_.escape(the_title);var the_title_avatar='';if(!_.isUndefined(this.attendee_people)){var MAX_ATTENDEES=3;var attendee_showed=0;var attendee_other='';_.each(temp_ret[this.attendee_people],function(the_attendee_people){attendees.push(the_attendee_people);attendee_showed+=1;if(attendee_showed<=MAX_ATTENDEES){if(self.avatar_model!==null){the_title_avatar+='<img title="'+_.escape(self.all_attendees[the_attendee_people])+'" class="o_attendee_head"  \
                                                        src="/web/image/'+self.avatar_model+'/'+the_attendee_people+'/image_small"></img>';}
else{if(!self.colorIsAttendee||the_attendee_people!=temp_ret[self.color_field]){var tempColor=(self.all_filters[the_attendee_people]!==undefined)?self.all_filters[the_attendee_people].color:(self.all_filters[-1]?self.all_filters[-1].color:1);the_title_avatar+='<i class="fa fa-user o_attendee_head o_underline_color_'+tempColor+'" title="'+_.escape(self.all_attendees[the_attendee_people])+'" ></i>';}}}
else{attendee_other+=_.escape(self.all_attendees[the_attendee_people])+", ";}});if(attendee_other.length>2){the_title_avatar+='<span class="o_attendee_head" title="'+attendee_other.slice(0,-2)+'">+</span>';}
the_title=the_title_avatar+the_title;}}
if(!date_stop&&date_delay){var m_start=moment(date_start).add(date_delay,'hours');date_stop=m_start.toDate();}
var r={'start':moment(date_start).format('YYYY-MM-DD HH:mm:ss'),'end':moment(date_stop).format('YYYY-MM-DD HH:mm:ss'),'title':the_title,'allDay':(this.fields[this.date_start].type=='date'||(this.all_day&&evt[this.all_day])||false),'id':evt.id,'attendees':attendees};var color_key=evt[this.color_field];if(!self.useContacts||self.all_filters[color_key]!==undefined){if(color_key){if(typeof color_key==="object"){color_key=color_key[0];}
r.className='o_calendar_color_'+this.get_color(color_key);}}else{r.className='o_calendar_color_'+(self.all_filters[-1]?self.all_filters[-1].color:1);}
return r;},get_event_data:function(event){var date_start_day;var date_stop_day;var diff_seconds;var data={name:event.title};var event_end=event.end;if(event_end===null){var m_date=moment(event.start).add(2,'hours');event_end=m_date.toDate();}
if(event.allDay){if(event_end===null||_.isUndefined(event_end)){event_end=new Date(event.start);}
if(this.all_day){date_start_day=new Date(Date.UTC(event.start.getFullYear(),event.start.getMonth(),event.start.getDate()));date_stop_day=new Date(Date.UTC(event_end.getFullYear(),event_end.getMonth(),event_end.getDate()));}
else{date_start_day=new Date(event.start.getFullYear(),event.start.getMonth(),event.start.getDate(),7);date_stop_day=new Date(event_end.getFullYear(),event_end.getMonth(),event_end.getDate(),19);}
data[this.date_start]=time.datetime_to_str(date_start_day);if(this.date_stop){data[this.date_stop]=time.datetime_to_str(date_stop_day);}
diff_seconds=Math.round((date_stop_day.getTime()-date_start_day.getTime())/1000);}
else{data[this.date_start]=time.datetime_to_str(event.start);if(this.date_stop){data[this.date_stop]=time.datetime_to_str(event_end);}
diff_seconds=Math.round((event_end.getTime()-event.start.getTime())/1000);}
if(this.all_day){data[this.all_day]=event.allDay;}
if(this.date_delay){data[this.date_delay]=diff_seconds/3600;}
return data;},do_search:function(domain,context,_group_by){var self=this;this.shown.done(function(){self._do_search(domain,context,_group_by);});},_do_search:function(domain,context,_group_by){var self=this;if(!self.all_filters){self.all_filters={};}
if(!_.isUndefined(this.event_source)){this.$calendar.fullCalendar('removeEventSource',this.event_source);}
this.event_source={events:function(start,end,callback){if(isNaN(start)||isNaN(end)){return;}
var current_event_source=self.event_source;var event_domain=self.get_range_domain(domain,start,end);if(self.useContacts&&(!self.all_filters[-1]||!self.all_filters[-1].is_checked)){var partner_ids=$.map(self.all_filters,function(o){if(o.is_checked){return o.value;}});if(!_.isEmpty(partner_ids)){event_domain=new data.CompoundDomain(event_domain,[[self.attendee_people,'in',partner_ids]]);}}
self.dataset.read_slice(_.keys(self.fields),{offset:0,domain:event_domain,context:context,}).done(function(events){if(self.dataset.index===null){if(events.length){self.dataset.index=0;}}else if(self.dataset.index>=events.length){self.dataset.index=events.length?0:null;}
if(self.event_source!==current_event_source){console.log("Consecutive ``do_search`` called. Cancelling.");return;}
if(!self.useContacts){var filter_item;self.now_filter_ids=self.now_filter_ids||[];var color_field=self.fields[self.color_field];_.each(events,function(e){var key,val=null;if(color_field.type=="selection"){key=e[self.color_field];val=_.find(color_field.selection,function(name){return name[0]===key;});}else{key=e[self.color_field][0];val=e[self.color_field];}
if(!self.all_filters[key]){filter_item={value:key,label:val[1],color:self.get_color(key),avatar_model:(_.str.toBoolElse(self.avatar_filter,true)?self.avatar_filter:false),is_checked:true};self.all_filters[key]=filter_item;}
if(!_.contains(self.now_filter_ids,key)){self.now_filter_ids.push(key);}});if(self.sidebar){self.sidebar.filter.events_loaded();self.sidebar.filter.set_filters();events=$.map(events,function(e){var key=color_field.type=="selection"?e[self.color_field]:e[self.color_field][0];if(_.contains(self.now_filter_ids,key)&&self.all_filters[key].is_checked){return e;}
return null;});}}
var all_attendees=$.map(events,function(e){return e[self.attendee_people];});all_attendees=_.chain(all_attendees).flatten().uniq().value();self.all_attendees={};if(self.avatar_title!==null){new Model(self.avatar_title).query(["name"]).filter([["id","in",all_attendees]]).all().then(function(result){_.each(result,function(item){self.all_attendees[item.id]=item.name;});}).done(function(){return self.perform_necessary_name_gets(events).then(callback);});}
else{_.each(all_attendees,function(item){self.all_attendees[item]='';});return self.perform_necessary_name_gets(events).then(callback);}});},eventDataTransform:function(event){return self.event_data_transform(event);},};this.$calendar.fullCalendar('addEventSource',this.event_source);},get_range_domain:function(domain,start,end){var format=time.date_to_str;var extend_domain=[[this.date_start,'<=',format(end)]];if(this.date_stop){extend_domain.push([this.date_stop,'>=',format(start)]);}
return new CompoundDomain(domain,extend_domain);},get_all_filters_ordered:function(){return _.values(this.all_filters).sort(function(f1,f2){return _.string.naturalCmp(f1.label,f2.label);});},update_record:function(id,data){var self=this;var event_id;delete(data.name);var index=this.dataset.get_id_index(id);if(index!==null){event_id=this.dataset.ids[index];this.dataset.write(event_id,data,{}).always(function(){if(is_virtual_id(event_id)){self.$calendar.fullCalendar('refetchEvents');}else{self.refresh_event(event_id);}});}
return false;},open_event:function(id,title){var self=this;if(!this.open_popup_action){var index=this.dataset.get_id_index(id);this.dataset.index=index;if(this.write_right){this.do_switch_view('form',null,{mode:"edit"});}else{this.do_switch_view('form',null,{mode:"view"});}}
else{var dialog=new form_common.FormViewDialog(this,{res_model:this.dataset.model,res_id:parseInt(id).toString()==id?parseInt(id):id,context:this.dataset.get_context(),title:title,view_id:+this.open_popup_action,readonly:true,buttons:[{text:_t("Edit"),classes:'btn-primary',close:true,click:function(){self.dataset.index=self.dataset.get_id_index(id);self.do_switch_view('form',null,{mode:"edit"});}},{text:_t("Delete"),close:true,click:function(){self.remove_event(id);}},{text:_t("Close"),close:true}]}).open();}
return false;},do_show:function(){this.do_push_state({});this.shown.resolve();return this._super();},is_action_enabled:function(action){if(action==='create'&&!this.options.creatable){return false;}
return this._super(action);},quick_created:function(id){this.dataset.ids=this.dataset.ids.concat([id]);this.dataset.trigger("dataset_changed",id);this.refresh_event(id);},slow_created:function(){var self=this;if(self.sidebar){self.sidebar.filter.is_loaded=false;}
self.$calendar.fullCalendar('refetchEvents');},remove_event:function(id){var self=this;function do_it(){return $.when(self.dataset.unlink([id])).then(function(){self.$calendar.fullCalendar('removeEvents',id);});}
if(this.options.confirm_on_delete){if(confirm(_t("Are you sure you want to delete this record ?"))){return do_it();}}else
return do_it();},});core.view_registry.add('calendar',CalendarView);return CalendarView;});;

/* /web_charts/static/src/js/web_charts.js defined in bundle 'web.assets_backend' */
odoo.define('web_charts',function(require){"use strict";var core=require('web.core');var View=require('web.View');var Model=require('web.DataModel');var session=require('web.session');var _t=core._t;var _lt=core._lt;var ChartView=View.extend({view_type:'chart',display_name:'chart',icon:'fa-bar-chart',init:function(parent,dataset,view_id,options){this._super(parent,dataset,view_id,options);this.model=new Model(dataset.model,{group_by_no_leaf:true});this.start_date=moment().format('YYYY-MM-DD');this.end_date=moment().add(3,'w').format('YYYY-MM-DD');this.tempo='week';this.when_loaded=$.Deferred();},view_loading:function(fvg){var self=this;this.name=this.ViewManager.title;this.columns=[];this.column_colors=[];this.endpoint=fvg.arch.attrs.action;_.each(fvg.arch.children,function(field){if(field.attrs.type=='measure'){self.columns.push(field.attrs.name);}
if('color'in field.attrs){self.column_colors[field.attrs.name]=field.attrs.color;}});this.rows=[];_.each(fvg.arch.children,function(field){if(field.attrs.type=='row'){self.rows.push(field.attrs.name);}});},do_search:function(domain,context){this.domain=domain;this.context=context;this.load_data(domain,context);},events:{'click .group_day':'group_day','click .group_week':'group_week','click .group_month':'group_month','click .validate_date':'validate_date','change .start_date':'change_start_date','change .end_date':'change_end_date',},load_data:function(domain,context){domain=domain.slice();var group_by=this.rows.slice();group_by[0]+=':'+this.tempo;this.when_loaded=session.rpc(this.endpoint,{start_date:this.start_date,end_date:this.end_date,domain:domain,group_period:this.tempo,})
this.do_show();},do_show:function(){var self=this;this.when_loaded.then(function(calendar){self.do_push_state({});self.$el.empty();var controls=$("<div>\
						<h4>"+_t('Group by')+"</h4>\
						<button class='group_day btn oe_button'>"+_t('Day')+"</button>\
						<button class='group_week btn oe_button'>"+_t('Week')+"</button>\
						<button class='group_month btn oe_button'>"+_t('Month')+"</button>\
						<span>"+_t('Start')+" :</span><input type='date' class='start_date' />\
						<span>"+_t('End')+" :</span><input type='date' class='end_date' />\
						<button class=\"validate_date\">"+_t('Ok')+"</button>\
				</div>");var chart=$("<div></div>");controls.appendTo(self.$el);chart.appendTo(self.$el);self.$('.start_date').val(self.start_date);self.$('.end_date').val(self.end_date);var aggregated_dates=_.uniq(_.keys(_.values(calendar)[0]));var series=self.get_series(calendar);chart.highcharts({chart:{type:'column'},xAxis:{categories:aggregated_dates},yAxis:[{min:0,title:''}],plotOptions:{column:{grouping:false,shadow:false,borderWidth:0}},series:series,title:{text:self.name,style:{fontSize:'24px',fontWeight:'bold',},},legend:{enabled:false,},})})},get_series:function(cal){var data={};var self=this;var second_keys=[];for(var col_k in this.columns){var col=this.columns[col_k];for(var res in cal){var key=res+' / '+col;if(!(key in data)){data[key]={};}
for(var period in cal[res]){data[key][period]=cal[res][period][col]||0;second_keys.push(res);}}}
second_keys=_.uniq(second_keys);var series=_.map(data,function(val,key,l){var measure=key.split(' / ')[1];var second_unit=key.split(' / ')[0];var l=second_keys.length;var serie={name:key,pointPadding:0.5*(1-1/(l*(1+_.indexOf(self.columns,measure)/self.columns.length))),pointPlacement:-0.5+_.indexOf(second_keys,second_unit)/l+0.5/l,data:_.values(val),}
if(measure in self.column_colors){serie.color=self.column_colors[measure];};return serie;})
return series;},group_day:function(ev){this.tempo='day';this.load_data(this.domain,this.context);},group_week:function(ev){this.tempo='week';this.load_data(this.domain,this.context);},group_month:function(ev){this.tempo='month';this.load_data(this.domain,this.context);},validate_date:function(ev){this.load_data(this.domain,this.context);},aggregate_dates:function(calendar,period){var format="";switch(period){case'day':format="DD MMM YYYY";break;case'week':format="[W]w YYYY";break;case'month':format="MMMM YYYY";break;}
var ret=_.uniq(_.map(calendar,function(day){return moment(day[0]).format(format);}),true);return ret;},change_start_date:function(){this.start_date=this.$('.start_date').val();},change_end_date:function(){this.end_date=this.$('.end_date').val();},});var QualityChartView=View.extend({display_name:'qualitychart',icon:'fa-area-chart',multi_record:false,searchable:false,view_type:'form',events:{"change #prod_select":"on_filters_change","change #graph_start_date":"on_filters_change","change #graph_end_date":"on_filters_change",},form_template:function(){return _t("Product")+":\
			<select id='prod_select'>\
				<option>&nbsp</option>\
				<% _.each(products, function(prod) { %><option value='<%= prod[0] %>'><%= prod[1] %></option><% }); %>\
			</select>"+
_t("Start date")+":<input type='date' id='graph_start_date'/>"+
_t("End date")+":<input type='date' id='graph_end_date' />"},init:function(parent,dataset,view_id,options){var self=this;this._super(parent,dataset,view_id,options);this.has_been_loaded=$.Deferred();Highcharts.setOptions({global:{useUTC:false}});},view_loading:function(r){this.has_been_loaded.resolve();},do_show:function(options,product_id,sdate,edate,no_del_products){var self=this;options=options||{};this._super();var shown=this.has_been_loaded;if(options.reload!==false){shown=shown.then(function(){var Lines=new Model('quality.control.declaration.line.result');var domain=[['control_id','=',self.dataset.ids[self.dataset.index]]];if(product_id){domain.push(['product_id','=',product_id])}
if(sdate){domain.push(['date','>=',sdate])}
if(edate){domain.push(['date','<=',edate])}
var query=Lines.query([]).filter(domain).all();query.then(function(res){self.do_push_state({});self.$el.empty();if(!no_del_products){delete self.products;}
self.$el.append(self.get_form(res));self.$('#prod_select option[value='+product_id+']').prop('selected',true);self.$('#graph_start_date').val(sdate);self.$('#graph_end_date').val(edate);var chart=$("<div></div>");chart.appendTo(self.$el);var values={},minmax=[];_.each(res,function(line){var date=openerp.web.str_to_datetime(line.date).getTime();if(!values.hasOwnProperty(line.product_id[0])){values[line.product_id[0]]=[]}
values[line.product_id[0]].push([date,parseInt(line.value_target)])
minmax.push([date,parseInt(line.min),parseInt(line.max)])});var series=_.map(values,function(el){return{name:_t('Values'),data:el,type:'scatter',}});series.push({name:'MinMax',data:minmax,type:'arearange',linkedTo:':previous',});chart.highcharts({series:series,xAxis:{type:'datetime',},title:{text:'',},plotOptions:{arearange:{fillOpacity:0.1,}}});})});}},get_form:function(data){if(!('products'in this)){var products=_.uniq(_.map(data,function(line){return line.product_id}),function(el){return el[0]});this.products=products;}else{var products=this.products;}
return _.template(this.form_template())({products:products});},on_filters_change:function(ev){var product_id=parseInt(this.$('#prod_select').val());var start_date=this.$('#graph_start_date').val();var end_date=this.$('#graph_end_date').val();this.do_show({},product_id,start_date,end_date,true)},});core.view_registry.add('chart',ChartView);core.view_registry.add('qualitychart',QualityChartView);});;

/* /web_diagram/static/lib/js/jquery.mousewheel.js defined in bundle 'web.assets_backend' */
(function($){var types=['DOMMouseScroll','mousewheel'];if($.event.fixHooks){for(var i=types.length;i;){$.event.fixHooks[types[--i]]=$.event.mouseHooks;}}
$.event.special.mousewheel={setup:function(){if(this.addEventListener){for(var i=types.length;i;){this.addEventListener(types[--i],handler,false);}}else{this.onmousewheel=handler;}},teardown:function(){if(this.removeEventListener){for(var i=types.length;i;){this.removeEventListener(types[--i],handler,false);}}else{this.onmousewheel=null;}}};$.fn.extend({mousewheel:function(fn){return fn?this.bind("mousewheel",fn):this.trigger("mousewheel");},unmousewheel:function(fn){return this.unbind("mousewheel",fn);}});function handler(event){var orgEvent=event||window.event,args=[].slice.call(arguments,1),delta=0,returnValue=true,deltaX=0,deltaY=0;event=$.event.fix(orgEvent);event.type="mousewheel";if(orgEvent.wheelDelta){delta=orgEvent.wheelDelta/120;}
if(orgEvent.detail){delta=-orgEvent.detail/3;}
deltaY=delta;if(orgEvent.axis!==undefined&&orgEvent.axis===orgEvent.HORIZONTAL_AXIS){deltaY=0;deltaX=-1*delta;}
if(orgEvent.wheelDeltaY!==undefined){deltaY=orgEvent.wheelDeltaY/120;}
if(orgEvent.wheelDeltaX!==undefined){deltaX=-1*orgEvent.wheelDeltaX/120;}
args.unshift(event,delta,deltaX,deltaY);return($.event.dispatch||$.event.handle).apply(this,args);}})(jQuery);;

/* /web_diagram/static/lib/js/raphael.js defined in bundle 'web.assets_backend' */
(function(glob){var version="0.3.4",has="hasOwnProperty",separator=/[\.\/]/,wildcard="*",fun=function(){},numsort=function(a,b){return a-b;},current_event,stop,events={n:{}},eve=function(name,scope){var e=events,oldstop=stop,args=Array.prototype.slice.call(arguments,2),listeners=eve.listeners(name),z=0,f=false,l,indexed=[],queue={},out=[],ce=current_event,errors=[];current_event=name;stop=0;for(var i=0,ii=listeners.length;i<ii;i++)if("zIndex"in listeners[i]){indexed.push(listeners[i].zIndex);if(listeners[i].zIndex<0){queue[listeners[i].zIndex]=listeners[i];}}
indexed.sort(numsort);while(indexed[z]<0){l=queue[indexed[z++]];out.push(l.apply(scope,args));if(stop){stop=oldstop;return out;}}
for(i=0;i<ii;i++){l=listeners[i];if("zIndex"in l){if(l.zIndex==indexed[z]){out.push(l.apply(scope,args));if(stop){break;}
do{z++;l=queue[indexed[z]];l&&out.push(l.apply(scope,args));if(stop){break;}}while(l)}else{queue[l.zIndex]=l;}}else{out.push(l.apply(scope,args));if(stop){break;}}}
stop=oldstop;current_event=ce;return out.length?out:null;};eve.listeners=function(name){var names=name.split(separator),e=events,item,items,k,i,ii,j,jj,nes,es=[e],out=[];for(i=0,ii=names.length;i<ii;i++){nes=[];for(j=0,jj=es.length;j<jj;j++){e=es[j].n;items=[e[names[i]],e[wildcard]];k=2;while(k--){item=items[k];if(item){nes.push(item);out=out.concat(item.f||[]);}}}
es=nes;}
return out;};eve.on=function(name,f){var names=name.split(separator),e=events;for(var i=0,ii=names.length;i<ii;i++){e=e.n;!e[names[i]]&&(e[names[i]]={n:{}});e=e[names[i]];}
e.f=e.f||[];for(i=0,ii=e.f.length;i<ii;i++)if(e.f[i]==f){return fun;}
e.f.push(f);return function(zIndex){if(+zIndex==+zIndex){f.zIndex=+zIndex;}};};eve.stop=function(){stop=1;};eve.nt=function(subname){if(subname){return new RegExp("(?:\\.|\\/|^)"+subname+"(?:\\.|\\/|$)").test(current_event);}
return current_event;};eve.off=eve.unbind=function(name,f){var names=name.split(separator),e,key,splice,i,ii,j,jj,cur=[events];for(i=0,ii=names.length;i<ii;i++){for(j=0;j<cur.length;j+=splice.length-2){splice=[j,1];e=cur[j].n;if(names[i]!=wildcard){if(e[names[i]]){splice.push(e[names[i]]);}}else{for(key in e)if(e[has](key)){splice.push(e[key]);}}
cur.splice.apply(cur,splice);}}
for(i=0,ii=cur.length;i<ii;i++){e=cur[i];while(e.n){if(f){if(e.f){for(j=0,jj=e.f.length;j<jj;j++)if(e.f[j]==f){e.f.splice(j,1);break;}
!e.f.length&&delete e.f;}
for(key in e.n)if(e.n[has](key)&&e.n[key].f){var funcs=e.n[key].f;for(j=0,jj=funcs.length;j<jj;j++)if(funcs[j]==f){funcs.splice(j,1);break;}
!funcs.length&&delete e.n[key].f;}}else{delete e.f;for(key in e.n)if(e.n[has](key)&&e.n[key].f){delete e.n[key].f;}}
e=e.n;}}};eve.once=function(name,f){var f2=function(){var res=f.apply(this,arguments);eve.unbind(name,f2);return res;};return eve.on(name,f2);};eve.version=version;eve.toString=function(){return"You are running Eve "+version;};(typeof module!="undefined"&&module.exports)?(module.exports=eve):(typeof define!="undefined"?(define("eve",[],function(){return eve;})):(glob.eve=eve));})(this);(function(){function R(first){if(R.is(first,"function")){return loaded?first():eve.on("DOMload",first);}else if(R.is(first,array)){return R._engine.create[apply](R,first.splice(0,3+R.is(first[0],nu))).add(first);}else{var args=Array.prototype.slice.call(arguments,0);if(R.is(args[args.length-1],"function")){var f=args.pop();return loaded?f.call(R._engine.create[apply](R,args)):eve.on("DOMload",function(){f.call(R._engine.create[apply](R,args));});}else{return R._engine.create[apply](R,arguments);}}}
R.version="2.0.2";R.eve=eve;var loaded,separator=/[, ]+/,elements={circle:1,rect:1,path:1,ellipse:1,text:1,image:1},formatrg=/\{(\d+)\}/g,proto="prototype",has="hasOwnProperty",g={doc:document,win:window},oldRaphael={was:Object.prototype[has].call(g.win,"Raphael"),is:g.win.Raphael},Paper=function(){this.ca=this.customAttributes={};},paperproto,appendChild="appendChild",apply="apply",concat="concat",supportsTouch="createTouch"in g.doc,E="",S=" ",Str=String,split="split",events="click dblclick mousedown mousemove mouseout mouseover mouseup touchstart touchmove touchend touchcancel"[split](S),touchMap={mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend"},lowerCase=Str.prototype.toLowerCase,math=Math,mmax=math.max,mmin=math.min,abs=math.abs,pow=math.pow,PI=math.PI,nu="number",string="string",array="array",toString="toString",fillString="fill",objectToString=Object.prototype.toString,paper={},push="push",ISURL=R._ISURL=/^url\(['"]?([^\)]+?)['"]?\)$/i,colourRegExp=/^\s*((#[a-f\d]{6})|(#[a-f\d]{3})|rgba?\(\s*([\d\.]+%?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+%?(?:\s*,\s*[\d\.]+%?)?)\s*\)|hsba?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\)|hsla?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\))\s*$/i,isnan={"NaN":1,"Infinity":1,"-Infinity":1},bezierrg=/^(?:cubic-)?bezier\(([^,]+),([^,]+),([^,]+),([^\)]+)\)/,round=math.round,setAttribute="setAttribute",toFloat=parseFloat,toInt=parseInt,upperCase=Str.prototype.toUpperCase,availableAttrs=R._availableAttrs={"arrow-end":"none","arrow-start":"none",blur:0,"clip-rect":"0 0 1e9 1e9",cursor:"default",cx:0,cy:0,fill:"#fff","fill-opacity":1,font:'10px "Arial"',"font-family":'"Arial"',"font-size":"10","font-style":"normal","font-weight":400,gradient:0,height:0,href:"http://raphaeljs.com/","letter-spacing":0,opacity:1,path:"M0,0",r:0,rx:0,ry:0,src:"",stroke:"#000","stroke-dasharray":"","stroke-linecap":"butt","stroke-linejoin":"butt","stroke-miterlimit":0,"stroke-opacity":1,"stroke-width":1,target:"_blank","text-anchor":"middle",title:"Raphael",transform:"",width:0,x:0,y:0},availableAnimAttrs=R._availableAnimAttrs={blur:nu,"clip-rect":"csv",cx:nu,cy:nu,fill:"colour","fill-opacity":nu,"font-size":nu,height:nu,opacity:nu,path:"path",r:nu,rx:nu,ry:nu,stroke:"colour","stroke-opacity":nu,"stroke-width":nu,transform:"transform",width:nu,x:nu,y:nu},whitespace=/[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]/g,commaSpaces=/[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/,hsrg={hs:1,rg:1},p2s=/,?([achlmqrstvxz]),?/gi,pathCommand=/([achlmrqstvz])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/ig,tCommand=/([rstm])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/ig,pathValues=/(-?\d*\.?\d*(?:e[\-+]?\d+)?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/ig,radial_gradient=R._radial_gradient=/^r(?:\(([^,]+?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*([^\)]+?)\))?/,eldata={},sortByKey=function(a,b){return a.key-b.key;},sortByNumber=function(a,b){return toFloat(a)-toFloat(b);},fun=function(){},pipe=function(x){return x;},rectPath=R._rectPath=function(x,y,w,h,r){if(r){return[["M",x+r,y],["l",w-r*2,0],["a",r,r,0,0,1,r,r],["l",0,h-r*2],["a",r,r,0,0,1,-r,r],["l",r*2-w,0],["a",r,r,0,0,1,-r,-r],["l",0,r*2-h],["a",r,r,0,0,1,r,-r],["z"]];}
return[["M",x,y],["l",w,0],["l",0,h],["l",-w,0],["z"]];},ellipsePath=function(x,y,rx,ry){if(ry==null){ry=rx;}
return[["M",x,y],["m",0,-ry],["a",rx,ry,0,1,1,0,2*ry],["a",rx,ry,0,1,1,0,-2*ry],["z"]];},getPath=R._getPath={path:function(el){return el.attr("path");},circle:function(el){var a=el.attrs;return ellipsePath(a.cx,a.cy,a.r);},ellipse:function(el){var a=el.attrs;return ellipsePath(a.cx,a.cy,a.rx,a.ry);},rect:function(el){var a=el.attrs;return rectPath(a.x,a.y,a.width,a.height,a.r);},image:function(el){var a=el.attrs;return rectPath(a.x,a.y,a.width,a.height);},text:function(el){var bbox=el._getBBox();return rectPath(bbox.x,bbox.y,bbox.width,bbox.height);}},mapPath=R.mapPath=function(path,matrix){if(!matrix){return path;}
var x,y,i,j,ii,jj,pathi;path=path2curve(path);for(i=0,ii=path.length;i<ii;i++){pathi=path[i];for(j=1,jj=pathi.length;j<jj;j+=2){x=matrix.x(pathi[j],pathi[j+1]);y=matrix.y(pathi[j],pathi[j+1]);pathi[j]=x;pathi[j+1]=y;}}
return path;};R._g=g;R.type=(g.win.SVGAngle||g.doc.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")?"SVG":"VML");if(R.type=="VML"){var d=g.doc.createElement("div"),b;d.innerHTML='<v:shape adj="1"/>';b=d.firstChild;b.style.behavior="url(#default#VML)";if(!(b&&typeof b.adj=="object")){return(R.type=E);}
d=null;}
R.svg=!(R.vml=R.type=="VML");R._Paper=Paper;R.fn=paperproto=Paper.prototype=R.prototype;R._id=0;R._oid=0;R.is=function(o,type){type=lowerCase.call(type);if(type=="finite"){return!isnan[has](+o);}
if(type=="array"){return o instanceof Array;}
return(type=="null"&&o===null)||(type==typeof o&&o!==null)||(type=="object"&&o===Object(o))||(type=="array"&&Array.isArray&&Array.isArray(o))||objectToString.call(o).slice(8,-1).toLowerCase()==type;};R.angle=function(x1,y1,x2,y2,x3,y3){if(x3==null){var x=x1-x2,y=y1-y2;if(!x&&!y){return 0;}
return(180+math.atan2(-y,-x)*180/PI+360)%360;}else{return R.angle(x1,y1,x3,y3)-R.angle(x2,y2,x3,y3);}};R.rad=function(deg){return deg%360*PI/180;};R.deg=function(rad){return rad*180/PI%360;};R.snapTo=function(values,value,tolerance){tolerance=R.is(tolerance,"finite")?tolerance:10;if(R.is(values,array)){var i=values.length;while(i--)if(abs(values[i]-value)<=tolerance){return values[i];}}else{values=+values;var rem=value%values;if(rem<tolerance){return value-rem;}
if(rem>values-tolerance){return value-rem+values;}}
return value;};var createUUID=R.createUUID=(function(uuidRegEx,uuidReplacer){return function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(uuidRegEx,uuidReplacer).toUpperCase();};})(/[xy]/g,function(c){var r=math.random()*16|0,v=c=="x"?r:(r&3|8);return v.toString(16);});R.setWindow=function(newwin){eve("setWindow",R,g.win,newwin);g.win=newwin;g.doc=g.win.document;if(R._engine.initWin){R._engine.initWin(g.win);}};var toHex=function(color){if(R.vml){var trim=/^\s+|\s+$/g;var bod;try{var docum=new ActiveXObject("htmlfile");docum.write("<body>");docum.close();bod=docum.body;}catch(e){bod=createPopup().document.body;}
var range=bod.createTextRange();toHex=cacher(function(color){try{bod.style.color=Str(color).replace(trim,E);var value=range.queryCommandValue("ForeColor");value=((value&255)<<16)|(value&65280)|((value&16711680)>>>16);return"#"+("000000"+value.toString(16)).slice(-6);}catch(e){return"none";}});}else{var i=g.doc.createElement("i");i.title="Rapha\xebl Colour Picker";i.style.display="none";g.doc.body.appendChild(i);toHex=cacher(function(color){i.style.color=color;return g.doc.defaultView.getComputedStyle(i,E).getPropertyValue("color");});}
return toHex(color);},hsbtoString=function(){return"hsb("+[this.h,this.s,this.b]+")";},hsltoString=function(){return"hsl("+[this.h,this.s,this.l]+")";},rgbtoString=function(){return this.hex;},prepareRGB=function(r,g,b){if(g==null&&R.is(r,"object")&&"r"in r&&"g"in r&&"b"in r){b=r.b;g=r.g;r=r.r;}
if(g==null&&R.is(r,string)){var clr=R.getRGB(r);r=clr.r;g=clr.g;b=clr.b;}
if(r>1||g>1||b>1){r/=255;g/=255;b/=255;}
return[r,g,b];},packageRGB=function(r,g,b,o){r*=255;g*=255;b*=255;var rgb={r:r,g:g,b:b,hex:R.rgb(r,g,b),toString:rgbtoString};R.is(o,"finite")&&(rgb.opacity=o);return rgb;};R.color=function(clr){var rgb;if(R.is(clr,"object")&&"h"in clr&&"s"in clr&&"b"in clr){rgb=R.hsb2rgb(clr);clr.r=rgb.r;clr.g=rgb.g;clr.b=rgb.b;clr.hex=rgb.hex;}else if(R.is(clr,"object")&&"h"in clr&&"s"in clr&&"l"in clr){rgb=R.hsl2rgb(clr);clr.r=rgb.r;clr.g=rgb.g;clr.b=rgb.b;clr.hex=rgb.hex;}else{if(R.is(clr,"string")){clr=R.getRGB(clr);}
if(R.is(clr,"object")&&"r"in clr&&"g"in clr&&"b"in clr){rgb=R.rgb2hsl(clr);clr.h=rgb.h;clr.s=rgb.s;clr.l=rgb.l;rgb=R.rgb2hsb(clr);clr.v=rgb.b;}else{clr={hex:"none"};clr.r=clr.g=clr.b=clr.h=clr.s=clr.v=clr.l=-1;}}
clr.toString=rgbtoString;return clr;};R.hsb2rgb=function(h,s,v,o){if(this.is(h,"object")&&"h"in h&&"s"in h&&"b"in h){v=h.b;s=h.s;h=h.h;o=h.o;}
h*=360;var R,G,B,X,C;h=(h%360)/60;C=v*s;X=C*(1-abs(h%2-1));R=G=B=v-C;h=~~h;R+=[C,X,0,0,X,C][h];G+=[X,C,C,X,0,0][h];B+=[0,0,X,C,C,X][h];return packageRGB(R,G,B,o);};R.hsl2rgb=function(h,s,l,o){if(this.is(h,"object")&&"h"in h&&"s"in h&&"l"in h){l=h.l;s=h.s;h=h.h;}
if(h>1||s>1||l>1){h/=360;s/=100;l/=100;}
h*=360;var R,G,B,X,C;h=(h%360)/60;C=2*s*(l<.5?l:1-l);X=C*(1-abs(h%2-1));R=G=B=l-C/2;h=~~h;R+=[C,X,0,0,X,C][h];G+=[X,C,C,X,0,0][h];B+=[0,0,X,C,C,X][h];return packageRGB(R,G,B,o);};R.rgb2hsb=function(r,g,b){b=prepareRGB(r,g,b);r=b[0];g=b[1];b=b[2];var H,S,V,C;V=mmax(r,g,b);C=V-mmin(r,g,b);H=(C==0?null:V==r?(g-b)/C:V==g?(b-r)/C+2:(r-g)/C+4);H=((H+360)%6)*60/360;S=C==0?0:C/V;return{h:H,s:S,b:V,toString:hsbtoString};};R.rgb2hsl=function(r,g,b){b=prepareRGB(r,g,b);r=b[0];g=b[1];b=b[2];var H,S,L,M,m,C;M=mmax(r,g,b);m=mmin(r,g,b);C=M-m;H=(C==0?null:M==r?(g-b)/C:M==g?(b-r)/C+2:(r-g)/C+4);H=((H+360)%6)*60/360;L=(M+m)/2;S=(C==0?0:L<.5?C/(2*L):C/(2-2*L));return{h:H,s:S,l:L,toString:hsltoString};};R._path2string=function(){return this.join(",").replace(p2s,"$1");};function repush(array,item){for(var i=0,ii=array.length;i<ii;i++)if(array[i]===item){return array.push(array.splice(i,1)[0]);}}
function cacher(f,scope,postprocessor){function newf(){var arg=Array.prototype.slice.call(arguments,0),args=arg.join("\u2400"),cache=newf.cache=newf.cache||{},count=newf.count=newf.count||[];if(cache[has](args)){repush(count,args);return postprocessor?postprocessor(cache[args]):cache[args];}
count.length>=1e3&&delete cache[count.shift()];count.push(args);cache[args]=f[apply](scope,arg);return postprocessor?postprocessor(cache[args]):cache[args];}
return newf;}
var preload=R._preload=function(src,f){var img=g.doc.createElement("img");img.style.cssText="position:absolute;left:-9999em;top:-9999em";img.onload=function(){f.call(this);this.onload=null;g.doc.body.removeChild(this);};img.onerror=function(){g.doc.body.removeChild(this);};g.doc.body.appendChild(img);img.src=src;};function clrToString(){return this.hex;}
R.getRGB=cacher(function(colour){if(!colour||!!((colour=Str(colour)).indexOf("-")+1)){return{r:-1,g:-1,b:-1,hex:"none",error:1,toString:clrToString};}
if(colour=="none"){return{r:-1,g:-1,b:-1,hex:"none",toString:clrToString};}
!(hsrg[has](colour.toLowerCase().substring(0,2))||colour.charAt()=="#")&&(colour=toHex(colour));var res,red,green,blue,opacity,t,values,rgb=colour.match(colourRegExp);if(rgb){if(rgb[2]){blue=toInt(rgb[2].substring(5),16);green=toInt(rgb[2].substring(3,5),16);red=toInt(rgb[2].substring(1,3),16);}
if(rgb[3]){blue=toInt((t=rgb[3].charAt(3))+t,16);green=toInt((t=rgb[3].charAt(2))+t,16);red=toInt((t=rgb[3].charAt(1))+t,16);}
if(rgb[4]){values=rgb[4][split](commaSpaces);red=toFloat(values[0]);values[0].slice(-1)=="%"&&(red*=2.55);green=toFloat(values[1]);values[1].slice(-1)=="%"&&(green*=2.55);blue=toFloat(values[2]);values[2].slice(-1)=="%"&&(blue*=2.55);rgb[1].toLowerCase().slice(0,4)=="rgba"&&(opacity=toFloat(values[3]));values[3]&&values[3].slice(-1)=="%"&&(opacity/=100);}
if(rgb[5]){values=rgb[5][split](commaSpaces);red=toFloat(values[0]);values[0].slice(-1)=="%"&&(red*=2.55);green=toFloat(values[1]);values[1].slice(-1)=="%"&&(green*=2.55);blue=toFloat(values[2]);values[2].slice(-1)=="%"&&(blue*=2.55);(values[0].slice(-3)=="deg"||values[0].slice(-1)=="\xb0")&&(red/=360);rgb[1].toLowerCase().slice(0,4)=="hsba"&&(opacity=toFloat(values[3]));values[3]&&values[3].slice(-1)=="%"&&(opacity/=100);return R.hsb2rgb(red,green,blue,opacity);}
if(rgb[6]){values=rgb[6][split](commaSpaces);red=toFloat(values[0]);values[0].slice(-1)=="%"&&(red*=2.55);green=toFloat(values[1]);values[1].slice(-1)=="%"&&(green*=2.55);blue=toFloat(values[2]);values[2].slice(-1)=="%"&&(blue*=2.55);(values[0].slice(-3)=="deg"||values[0].slice(-1)=="\xb0")&&(red/=360);rgb[1].toLowerCase().slice(0,4)=="hsla"&&(opacity=toFloat(values[3]));values[3]&&values[3].slice(-1)=="%"&&(opacity/=100);return R.hsl2rgb(red,green,blue,opacity);}
rgb={r:red,g:green,b:blue,toString:clrToString};rgb.hex="#"+(16777216|blue|(green<<8)|(red<<16)).toString(16).slice(1);R.is(opacity,"finite")&&(rgb.opacity=opacity);return rgb;}
return{r:-1,g:-1,b:-1,hex:"none",error:1,toString:clrToString};},R);R.hsb=cacher(function(h,s,b){return R.hsb2rgb(h,s,b).hex;});R.hsl=cacher(function(h,s,l){return R.hsl2rgb(h,s,l).hex;});R.rgb=cacher(function(r,g,b){return"#"+(16777216|b|(g<<8)|(r<<16)).toString(16).slice(1);});R.getColor=function(value){var start=this.getColor.start=this.getColor.start||{h:0,s:1,b:value||.75},rgb=this.hsb2rgb(start.h,start.s,start.b);start.h+=.075;if(start.h>1){start.h=0;start.s-=.2;start.s<=0&&(this.getColor.start={h:0,s:1,b:start.b});}
return rgb.hex;};R.getColor.reset=function(){delete this.start;};function catmullRom2bezier(crp,z){var d=[];for(var i=0,iLen=crp.length;iLen-2*!z>i;i+=2){var p=[{x:+crp[i-2],y:+crp[i-1]},{x:+crp[i],y:+crp[i+1]},{x:+crp[i+2],y:+crp[i+3]},{x:+crp[i+4],y:+crp[i+5]}];if(z){if(!i){p[0]={x:+crp[iLen-2],y:+crp[iLen-1]};}else if(iLen-4==i){p[3]={x:+crp[0],y:+crp[1]};}else if(iLen-2==i){p[2]={x:+crp[0],y:+crp[1]};p[3]={x:+crp[2],y:+crp[3]};}}else{if(iLen-4==i){p[3]=p[2];}else if(!i){p[0]={x:+crp[i],y:+crp[i+1]};}}
d.push(["C",(-p[0].x+6*p[1].x+p[2].x)/6,(-p[0].y+6*p[1].y+p[2].y)/6,(p[1].x+6*p[2].x-p[3].x)/6,(p[1].y+6*p[2].y-p[3].y)/6,p[2].x,p[2].y]);}
return d;}
R.parsePathString=cacher(function(pathString){if(!pathString){return null;}
var paramCounts={a:7,c:6,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,z:0},data=[];if(R.is(pathString,array)&&R.is(pathString[0],array)){data=pathClone(pathString);}
if(!data.length){Str(pathString).replace(pathCommand,function(a,b,c){var params=[],name=b.toLowerCase();c.replace(pathValues,function(a,b){b&&params.push(+b);});if(name=="m"&&params.length>2){data.push([b][concat](params.splice(0,2)));name="l";b=b=="m"?"l":"L";}
if(name=="r"){data.push([b][concat](params));}else while(params.length>=paramCounts[name]){data.push([b][concat](params.splice(0,paramCounts[name])));if(!paramCounts[name]){break;}}});}
data.toString=R._path2string;return data;});R.parseTransformString=cacher(function(TString){if(!TString){return null;}
var paramCounts={r:3,s:4,t:2,m:6},data=[];if(R.is(TString,array)&&R.is(TString[0],array)){data=pathClone(TString);}
if(!data.length){Str(TString).replace(tCommand,function(a,b,c){var params=[],name=lowerCase.call(b);c.replace(pathValues,function(a,b){b&&params.push(+b);});data.push([b][concat](params));});}
data.toString=R._path2string;return data;});R.findDotsAtSegment=function(p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y,t){var t1=1-t,t13=pow(t1,3),t12=pow(t1,2),t2=t*t,t3=t2*t,x=t13*p1x+t12*3*t*c1x+t1*3*t*t*c2x+t3*p2x,y=t13*p1y+t12*3*t*c1y+t1*3*t*t*c2y+t3*p2y,mx=p1x+2*t*(c1x-p1x)+t2*(c2x-2*c1x+p1x),my=p1y+2*t*(c1y-p1y)+t2*(c2y-2*c1y+p1y),nx=c1x+2*t*(c2x-c1x)+t2*(p2x-2*c2x+c1x),ny=c1y+2*t*(c2y-c1y)+t2*(p2y-2*c2y+c1y),ax=t1*p1x+t*c1x,ay=t1*p1y+t*c1y,cx=t1*c2x+t*p2x,cy=t1*c2y+t*p2y,alpha=(90-math.atan2(mx-nx,my-ny)*180/PI);(mx>nx||my<ny)&&(alpha+=180);return{x:x,y:y,m:{x:mx,y:my},n:{x:nx,y:ny},start:{x:ax,y:ay},end:{x:cx,y:cy},alpha:alpha};};R._removedFactory=function(methodname){return function(){throw new Error("Rapha\xebl: you are calling to method \u201c"+methodname+"\u201d of removed object");};};var pathDimensions=cacher(function(path){if(!path){return{x:0,y:0,width:0,height:0};}
path=path2curve(path);var x=0,y=0,X=[],Y=[],p;for(var i=0,ii=path.length;i<ii;i++){p=path[i];if(p[0]=="M"){x=p[1];y=p[2];X.push(x);Y.push(y);}else{var dim=curveDim(x,y,p[1],p[2],p[3],p[4],p[5],p[6]);X=X[concat](dim.min.x,dim.max.x);Y=Y[concat](dim.min.y,dim.max.y);x=p[5];y=p[6];}}
var xmin=mmin[apply](0,X),ymin=mmin[apply](0,Y);return{x:xmin,y:ymin,width:mmax[apply](0,X)-xmin,height:mmax[apply](0,Y)-ymin};},null,function(o){return{x:o.x,y:o.y,width:o.width,height:o.height};}),pathClone=function(pathArray){var res=[];if(!R.is(pathArray,array)||!R.is(pathArray&&pathArray[0],array)){pathArray=R.parsePathString(pathArray);}
for(var i=0,ii=pathArray.length;i<ii;i++){res[i]=[];for(var j=0,jj=pathArray[i].length;j<jj;j++){res[i][j]=pathArray[i][j];}}
res.toString=R._path2string;return res;},pathToRelative=R._pathToRelative=cacher(function(pathArray){if(!R.is(pathArray,array)||!R.is(pathArray&&pathArray[0],array)){pathArray=R.parsePathString(pathArray);}
var res=[],x=0,y=0,mx=0,my=0,start=0;if(pathArray[0][0]=="M"){x=pathArray[0][1];y=pathArray[0][2];mx=x;my=y;start++;res.push(["M",x,y]);}
for(var i=start,ii=pathArray.length;i<ii;i++){var r=res[i]=[],pa=pathArray[i];if(pa[0]!=lowerCase.call(pa[0])){r[0]=lowerCase.call(pa[0]);switch(r[0]){case"a":r[1]=pa[1];r[2]=pa[2];r[3]=pa[3];r[4]=pa[4];r[5]=pa[5];r[6]=+(pa[6]-x).toFixed(3);r[7]=+(pa[7]-y).toFixed(3);break;case"v":r[1]=+(pa[1]-y).toFixed(3);break;case"m":mx=pa[1];my=pa[2];default:for(var j=1,jj=pa.length;j<jj;j++){r[j]=+(pa[j]-((j%2)?x:y)).toFixed(3);}}}else{r=res[i]=[];if(pa[0]=="m"){mx=pa[1]+x;my=pa[2]+y;}
for(var k=0,kk=pa.length;k<kk;k++){res[i][k]=pa[k];}}
var len=res[i].length;switch(res[i][0]){case"z":x=mx;y=my;break;case"h":x+=+res[i][len-1];break;case"v":y+=+res[i][len-1];break;default:x+=+res[i][len-2];y+=+res[i][len-1];}}
res.toString=R._path2string;return res;},0,pathClone),pathToAbsolute=R._pathToAbsolute=cacher(function(pathArray){if(!R.is(pathArray,array)||!R.is(pathArray&&pathArray[0],array)){pathArray=R.parsePathString(pathArray);}
if(!pathArray||!pathArray.length){return[["M",0,0]];}
var res=[],x=0,y=0,mx=0,my=0,start=0;if(pathArray[0][0]=="M"){x=+pathArray[0][1];y=+pathArray[0][2];mx=x;my=y;start++;res[0]=["M",x,y];}
var crz=pathArray.length==3&&pathArray[0][0]=="M"&&pathArray[1][0].toUpperCase()=="R"&&pathArray[2][0].toUpperCase()=="Z";for(var r,pa,i=start,ii=pathArray.length;i<ii;i++){res.push(r=[]);pa=pathArray[i];if(pa[0]!=upperCase.call(pa[0])){r[0]=upperCase.call(pa[0]);switch(r[0]){case"A":r[1]=pa[1];r[2]=pa[2];r[3]=pa[3];r[4]=pa[4];r[5]=pa[5];r[6]=+(pa[6]+x);r[7]=+(pa[7]+y);break;case"V":r[1]=+pa[1]+y;break;case"H":r[1]=+pa[1]+x;break;case"R":var dots=[x,y][concat](pa.slice(1));for(var j=2,jj=dots.length;j<jj;j++){dots[j]=+dots[j]+x;dots[++j]=+dots[j]+y;}
res.pop();res=res[concat](catmullRom2bezier(dots,crz));break;case"M":mx=+pa[1]+x;my=+pa[2]+y;default:for(j=1,jj=pa.length;j<jj;j++){r[j]=+pa[j]+((j%2)?x:y);}}}else if(pa[0]=="R"){dots=[x,y][concat](pa.slice(1));res.pop();res=res[concat](catmullRom2bezier(dots,crz));r=["R"][concat](pa.slice(-2));}else{for(var k=0,kk=pa.length;k<kk;k++){r[k]=pa[k];}}
switch(r[0]){case"Z":x=mx;y=my;break;case"H":x=r[1];break;case"V":y=r[1];break;case"M":mx=r[r.length-2];my=r[r.length-1];default:x=r[r.length-2];y=r[r.length-1];}}
res.toString=R._path2string;return res;},null,pathClone),l2c=function(x1,y1,x2,y2){return[x1,y1,x2,y2,x2,y2];},q2c=function(x1,y1,ax,ay,x2,y2){var _13=1/3,_23=2/3;return[_13*x1+_23*ax,_13*y1+_23*ay,_13*x2+_23*ax,_13*y2+_23*ay,x2,y2];},a2c=function(x1,y1,rx,ry,angle,large_arc_flag,sweep_flag,x2,y2,recursive){var _120=PI*120/180,rad=PI/180*(+angle||0),res=[],xy,rotate=cacher(function(x,y,rad){var X=x*math.cos(rad)-y*math.sin(rad),Y=x*math.sin(rad)+y*math.cos(rad);return{x:X,y:Y};});if(!recursive){xy=rotate(x1,y1,-rad);x1=xy.x;y1=xy.y;xy=rotate(x2,y2,-rad);x2=xy.x;y2=xy.y;var cos=math.cos(PI/180*angle),sin=math.sin(PI/180*angle),x=(x1-x2)/2,y=(y1-y2)/2;var h=(x*x)/(rx*rx)+(y*y)/(ry*ry);if(h>1){h=math.sqrt(h);rx=h*rx;ry=h*ry;}
var rx2=rx*rx,ry2=ry*ry,k=(large_arc_flag==sweep_flag?-1:1)*math.sqrt(abs((rx2*ry2-rx2*y*y-ry2*x*x)/(rx2*y*y+ry2*x*x))),cx=k*rx*y/ry+(x1+x2)/2,cy=k*-ry*x/rx+(y1+y2)/2,f1=math.asin(((y1-cy)/ry).toFixed(9)),f2=math.asin(((y2-cy)/ry).toFixed(9));f1=x1<cx?PI-f1:f1;f2=x2<cx?PI-f2:f2;f1<0&&(f1=PI*2+f1);f2<0&&(f2=PI*2+f2);if(sweep_flag&&f1>f2){f1=f1-PI*2;}
if(!sweep_flag&&f2>f1){f2=f2-PI*2;}}else{f1=recursive[0];f2=recursive[1];cx=recursive[2];cy=recursive[3];}
var df=f2-f1;if(abs(df)>_120){var f2old=f2,x2old=x2,y2old=y2;f2=f1+_120*(sweep_flag&&f2>f1?1:-1);x2=cx+rx*math.cos(f2);y2=cy+ry*math.sin(f2);res=a2c(x2,y2,rx,ry,angle,0,sweep_flag,x2old,y2old,[f2,f2old,cx,cy]);}
df=f2-f1;var c1=math.cos(f1),s1=math.sin(f1),c2=math.cos(f2),s2=math.sin(f2),t=math.tan(df/4),hx=4/3*rx*t,hy=4/3*ry*t,m1=[x1,y1],m2=[x1+hx*s1,y1-hy*c1],m3=[x2+hx*s2,y2-hy*c2],m4=[x2,y2];m2[0]=2*m1[0]-m2[0];m2[1]=2*m1[1]-m2[1];if(recursive){return[m2,m3,m4][concat](res);}else{res=[m2,m3,m4][concat](res).join()[split](",");var newres=[];for(var i=0,ii=res.length;i<ii;i++){newres[i]=i%2?rotate(res[i-1],res[i],rad).y:rotate(res[i],res[i+1],rad).x;}
return newres;}},findDotAtSegment=function(p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y,t){var t1=1-t;return{x:pow(t1,3)*p1x+pow(t1,2)*3*t*c1x+t1*3*t*t*c2x+pow(t,3)*p2x,y:pow(t1,3)*p1y+pow(t1,2)*3*t*c1y+t1*3*t*t*c2y+pow(t,3)*p2y};},curveDim=cacher(function(p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y){var a=(c2x-2*c1x+p1x)-(p2x-2*c2x+c1x),b=2*(c1x-p1x)-2*(c2x-c1x),c=p1x-c1x,t1=(-b+math.sqrt(b*b-4*a*c))/2/a,t2=(-b-math.sqrt(b*b-4*a*c))/2/a,y=[p1y,p2y],x=[p1x,p2x],dot;abs(t1)>"1e12"&&(t1=.5);abs(t2)>"1e12"&&(t2=.5);if(t1>0&&t1<1){dot=findDotAtSegment(p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y,t1);x.push(dot.x);y.push(dot.y);}
if(t2>0&&t2<1){dot=findDotAtSegment(p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y,t2);x.push(dot.x);y.push(dot.y);}
a=(c2y-2*c1y+p1y)-(p2y-2*c2y+c1y);b=2*(c1y-p1y)-2*(c2y-c1y);c=p1y-c1y;t1=(-b+math.sqrt(b*b-4*a*c))/2/a;t2=(-b-math.sqrt(b*b-4*a*c))/2/a;abs(t1)>"1e12"&&(t1=.5);abs(t2)>"1e12"&&(t2=.5);if(t1>0&&t1<1){dot=findDotAtSegment(p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y,t1);x.push(dot.x);y.push(dot.y);}
if(t2>0&&t2<1){dot=findDotAtSegment(p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y,t2);x.push(dot.x);y.push(dot.y);}
return{min:{x:mmin[apply](0,x),y:mmin[apply](0,y)},max:{x:mmax[apply](0,x),y:mmax[apply](0,y)}};}),path2curve=R._path2curve=cacher(function(path,path2){var p=pathToAbsolute(path),p2=path2&&pathToAbsolute(path2),attrs={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},attrs2={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},processPath=function(path,d){var nx,ny;if(!path){return["C",d.x,d.y,d.x,d.y,d.x,d.y];}
!(path[0]in{T:1,Q:1})&&(d.qx=d.qy=null);switch(path[0]){case"M":d.X=path[1];d.Y=path[2];break;case"A":path=["C"][concat](a2c[apply](0,[d.x,d.y][concat](path.slice(1))));break;case"S":nx=d.x+(d.x-(d.bx||d.x));ny=d.y+(d.y-(d.by||d.y));path=["C",nx,ny][concat](path.slice(1));break;case"T":d.qx=d.x+(d.x-(d.qx||d.x));d.qy=d.y+(d.y-(d.qy||d.y));path=["C"][concat](q2c(d.x,d.y,d.qx,d.qy,path[1],path[2]));break;case"Q":d.qx=path[1];d.qy=path[2];path=["C"][concat](q2c(d.x,d.y,path[1],path[2],path[3],path[4]));break;case"L":path=["C"][concat](l2c(d.x,d.y,path[1],path[2]));break;case"H":path=["C"][concat](l2c(d.x,d.y,path[1],d.y));break;case"V":path=["C"][concat](l2c(d.x,d.y,d.x,path[1]));break;case"Z":path=["C"][concat](l2c(d.x,d.y,d.X,d.Y));break;}
return path;},fixArc=function(pp,i){if(pp[i].length>7){pp[i].shift();var pi=pp[i];while(pi.length){pp.splice(i++,0,["C"][concat](pi.splice(0,6)));}
pp.splice(i,1);ii=mmax(p.length,p2&&p2.length||0);}},fixM=function(path1,path2,a1,a2,i){if(path1&&path2&&path1[i][0]=="M"&&path2[i][0]!="M"){path2.splice(i,0,["M",a2.x,a2.y]);a1.bx=0;a1.by=0;a1.x=path1[i][1];a1.y=path1[i][2];ii=mmax(p.length,p2&&p2.length||0);}};for(var i=0,ii=mmax(p.length,p2&&p2.length||0);i<ii;i++){p[i]=processPath(p[i],attrs);fixArc(p,i);p2&&(p2[i]=processPath(p2[i],attrs2));p2&&fixArc(p2,i);fixM(p,p2,attrs,attrs2,i);fixM(p2,p,attrs2,attrs,i);var seg=p[i],seg2=p2&&p2[i],seglen=seg.length,seg2len=p2&&seg2.length;attrs.x=seg[seglen-2];attrs.y=seg[seglen-1];attrs.bx=toFloat(seg[seglen-4])||attrs.x;attrs.by=toFloat(seg[seglen-3])||attrs.y;attrs2.bx=p2&&(toFloat(seg2[seg2len-4])||attrs2.x);attrs2.by=p2&&(toFloat(seg2[seg2len-3])||attrs2.y);attrs2.x=p2&&seg2[seg2len-2];attrs2.y=p2&&seg2[seg2len-1];}
return p2?[p,p2]:p;},null,pathClone),parseDots=R._parseDots=cacher(function(gradient){var dots=[];for(var i=0,ii=gradient.length;i<ii;i++){var dot={},par=gradient[i].match(/^([^:]*):?([\d\.]*)/);dot.color=R.getRGB(par[1]);if(dot.color.error){return null;}
dot.color=dot.color.hex;par[2]&&(dot.offset=par[2]+"%");dots.push(dot);}
for(i=1,ii=dots.length-1;i<ii;i++){if(!dots[i].offset){var start=toFloat(dots[i-1].offset||0),end=0;for(var j=i+1;j<ii;j++){if(dots[j].offset){end=dots[j].offset;break;}}
if(!end){end=100;j=ii;}
end=toFloat(end);var d=(end-start)/(j-i+1);for(;i<j;i++){start+=d;dots[i].offset=start+"%";}}}
return dots;}),tear=R._tear=function(el,paper){el==paper.top&&(paper.top=el.prev);el==paper.bottom&&(paper.bottom=el.next);el.next&&(el.next.prev=el.prev);el.prev&&(el.prev.next=el.next);},tofront=R._tofront=function(el,paper){if(paper.top===el){return;}
tear(el,paper);el.next=null;el.prev=paper.top;paper.top.next=el;paper.top=el;},toback=R._toback=function(el,paper){if(paper.bottom===el){return;}
tear(el,paper);el.next=paper.bottom;el.prev=null;paper.bottom.prev=el;paper.bottom=el;},insertafter=R._insertafter=function(el,el2,paper){tear(el,paper);el2==paper.top&&(paper.top=el);el2.next&&(el2.next.prev=el);el.next=el2.next;el.prev=el2;el2.next=el;},insertbefore=R._insertbefore=function(el,el2,paper){tear(el,paper);el2==paper.bottom&&(paper.bottom=el);el2.prev&&(el2.prev.next=el);el.prev=el2.prev;el2.prev=el;el.next=el2;},extractTransform=R._extractTransform=function(el,tstr){if(tstr==null){return el._.transform;}
tstr=Str(tstr).replace(/\.{3}|\u2026/g,el._.transform||E);var tdata=R.parseTransformString(tstr),deg=0,dx=0,dy=0,sx=1,sy=1,_=el._,m=new Matrix;_.transform=tdata||[];if(tdata){for(var i=0,ii=tdata.length;i<ii;i++){var t=tdata[i],tlen=t.length,command=Str(t[0]).toLowerCase(),absolute=t[0]!=command,inver=absolute?m.invert():0,x1,y1,x2,y2,bb;if(command=="t"&&tlen==3){if(absolute){x1=inver.x(0,0);y1=inver.y(0,0);x2=inver.x(t[1],t[2]);y2=inver.y(t[1],t[2]);m.translate(x2-x1,y2-y1);}else{m.translate(t[1],t[2]);}}else if(command=="r"){if(tlen==2){bb=bb||el.getBBox(1);m.rotate(t[1],bb.x+bb.width/2,bb.y+bb.height/2);deg+=t[1];}else if(tlen==4){if(absolute){x2=inver.x(t[2],t[3]);y2=inver.y(t[2],t[3]);m.rotate(t[1],x2,y2);}else{m.rotate(t[1],t[2],t[3]);}
deg+=t[1];}}else if(command=="s"){if(tlen==2||tlen==3){bb=bb||el.getBBox(1);m.scale(t[1],t[tlen-1],bb.x+bb.width/2,bb.y+bb.height/2);sx*=t[1];sy*=t[tlen-1];}else if(tlen==5){if(absolute){x2=inver.x(t[3],t[4]);y2=inver.y(t[3],t[4]);m.scale(t[1],t[2],x2,y2);}else{m.scale(t[1],t[2],t[3],t[4]);}
sx*=t[1];sy*=t[2];}}else if(command=="m"&&tlen==7){m.add(t[1],t[2],t[3],t[4],t[5],t[6]);}
_.dirtyT=1;el.matrix=m;}}
el.matrix=m;_.sx=sx;_.sy=sy;_.deg=deg;_.dx=dx=m.e;_.dy=dy=m.f;if(sx==1&&sy==1&&!deg&&_.bbox){_.bbox.x+=+dx;_.bbox.y+=+dy;}else{_.dirtyT=1;}},getEmpty=function(item){var l=item[0];switch(l.toLowerCase()){case"t":return[l,0,0];case"m":return[l,1,0,0,1,0,0];case"r":if(item.length==4){return[l,0,item[2],item[3]];}else{return[l,0];}
case"s":if(item.length==5){return[l,1,1,item[3],item[4]];}else if(item.length==3){return[l,1,1];}else{return[l,1];}}},equaliseTransform=R._equaliseTransform=function(t1,t2){t2=Str(t2).replace(/\.{3}|\u2026/g,t1);t1=R.parseTransformString(t1)||[];t2=R.parseTransformString(t2)||[];var maxlength=mmax(t1.length,t2.length),from=[],to=[],i=0,j,jj,tt1,tt2;for(;i<maxlength;i++){tt1=t1[i]||getEmpty(t2[i]);tt2=t2[i]||getEmpty(tt1);if((tt1[0]!=tt2[0])||(tt1[0].toLowerCase()=="r"&&(tt1[2]!=tt2[2]||tt1[3]!=tt2[3]))||(tt1[0].toLowerCase()=="s"&&(tt1[3]!=tt2[3]||tt1[4]!=tt2[4]))){return;}
from[i]=[];to[i]=[];for(j=0,jj=mmax(tt1.length,tt2.length);j<jj;j++){j in tt1&&(from[i][j]=tt1[j]);j in tt2&&(to[i][j]=tt2[j]);}}
return{from:from,to:to};};R._getContainer=function(x,y,w,h){var container;container=h==null&&!R.is(x,"object")?g.doc.getElementById(x):x;if(container==null){return;}
if(container.tagName){if(y==null){return{container:container,width:container.style.pixelWidth||container.offsetWidth,height:container.style.pixelHeight||container.offsetHeight};}else{return{container:container,width:y,height:w};}}
return{container:1,x:x,y:y,width:w,height:h};};R.pathToRelative=pathToRelative;R._engine={};R.path2curve=path2curve;R.matrix=function(a,b,c,d,e,f){return new Matrix(a,b,c,d,e,f);};function Matrix(a,b,c,d,e,f){if(a!=null){this.a=+a;this.b=+b;this.c=+c;this.d=+d;this.e=+e;this.f=+f;}else{this.a=1;this.b=0;this.c=0;this.d=1;this.e=0;this.f=0;}}
(function(matrixproto){matrixproto.add=function(a,b,c,d,e,f){var out=[[],[],[]],m=[[this.a,this.c,this.e],[this.b,this.d,this.f],[0,0,1]],matrix=[[a,c,e],[b,d,f],[0,0,1]],x,y,z,res;if(a&&a instanceof Matrix){matrix=[[a.a,a.c,a.e],[a.b,a.d,a.f],[0,0,1]];}
for(x=0;x<3;x++){for(y=0;y<3;y++){res=0;for(z=0;z<3;z++){res+=m[x][z]*matrix[z][y];}
out[x][y]=res;}}
this.a=out[0][0];this.b=out[1][0];this.c=out[0][1];this.d=out[1][1];this.e=out[0][2];this.f=out[1][2];};matrixproto.invert=function(){var me=this,x=me.a*me.d-me.b*me.c;return new Matrix(me.d/x,-me.b/x,-me.c/x,me.a/x,(me.c*me.f-me.d*me.e)/x,(me.b*me.e-me.a*me.f)/x);};matrixproto.clone=function(){return new Matrix(this.a,this.b,this.c,this.d,this.e,this.f);};matrixproto.translate=function(x,y){this.add(1,0,0,1,x,y);};matrixproto.scale=function(x,y,cx,cy){y==null&&(y=x);(cx||cy)&&this.add(1,0,0,1,cx,cy);this.add(x,0,0,y,0,0);(cx||cy)&&this.add(1,0,0,1,-cx,-cy);};matrixproto.rotate=function(a,x,y){a=R.rad(a);x=x||0;y=y||0;var cos=+math.cos(a).toFixed(9),sin=+math.sin(a).toFixed(9);this.add(cos,sin,-sin,cos,x,y);this.add(1,0,0,1,-x,-y);};matrixproto.x=function(x,y){return x*this.a+y*this.c+this.e;};matrixproto.y=function(x,y){return x*this.b+y*this.d+this.f;};matrixproto.get=function(i){return+this[Str.fromCharCode(97+i)].toFixed(4);};matrixproto.toString=function(){return R.svg?"matrix("+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)].join()+")":[this.get(0),this.get(2),this.get(1),this.get(3),0,0].join();};matrixproto.toFilter=function(){return"progid:DXImageTransform.Microsoft.Matrix(M11="+this.get(0)+", M12="+this.get(2)+", M21="+this.get(1)+", M22="+this.get(3)+", Dx="+this.get(4)+", Dy="+this.get(5)+", sizingmethod='auto expand')";};matrixproto.offset=function(){return[this.e.toFixed(4),this.f.toFixed(4)];};function norm(a){return a[0]*a[0]+a[1]*a[1];}
function normalize(a){var mag=math.sqrt(norm(a));a[0]&&(a[0]/=mag);a[1]&&(a[1]/=mag);}
matrixproto.split=function(){var out={};out.dx=this.e;out.dy=this.f;var row=[[this.a,this.c],[this.b,this.d]];out.scalex=math.sqrt(norm(row[0]));normalize(row[0]);out.shear=row[0][0]*row[1][0]+row[0][1]*row[1][1];row[1]=[row[1][0]-row[0][0]*out.shear,row[1][1]-row[0][1]*out.shear];out.scaley=math.sqrt(norm(row[1]));normalize(row[1]);out.shear/=out.scaley;var sin=-row[0][1],cos=row[1][1];if(cos<0){out.rotate=R.deg(math.acos(cos));if(sin<0){out.rotate=360-out.rotate;}}else{out.rotate=R.deg(math.asin(sin));}
out.isSimple=!+out.shear.toFixed(9)&&(out.scalex.toFixed(9)==out.scaley.toFixed(9)||!out.rotate);out.isSuperSimple=!+out.shear.toFixed(9)&&out.scalex.toFixed(9)==out.scaley.toFixed(9)&&!out.rotate;out.noRotation=!+out.shear.toFixed(9)&&!out.rotate;return out;};matrixproto.toTransformString=function(shorter){var s=shorter||this[split]();if(s.isSimple){s.scalex=+s.scalex.toFixed(4);s.scaley=+s.scaley.toFixed(4);s.rotate=+s.rotate.toFixed(4);return(s.dx||s.dy?"t"+[s.dx,s.dy]:E)+
(s.scalex!=1||s.scaley!=1?"s"+[s.scalex,s.scaley,0,0]:E)+
(s.rotate?"r"+[s.rotate,0,0]:E);}else{return"m"+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)];}};})(Matrix.prototype);var version=navigator.userAgent.match(/Version\/(.*?)\s/)||navigator.userAgent.match(/Chrome\/(\d+)/);if((navigator.vendor=="Apple Computer, Inc.")&&(version&&version[1]<4||navigator.platform.slice(0,2)=="iP")||(navigator.vendor=="Google Inc."&&version&&version[1]<8)){paperproto.safari=function(){var rect=this.rect(-99,-99,this.width+99,this.height+99).attr({stroke:"none"});setTimeout(function(){rect.remove();});};}else{paperproto.safari=fun;}
var preventDefault=function(){this.returnValue=false;},preventTouch=function(){return this.originalEvent.preventDefault();},stopPropagation=function(){this.cancelBubble=true;},stopTouch=function(){return this.originalEvent.stopPropagation();},addEvent=(function(){if(g.doc.addEventListener){return function(obj,type,fn,element){var realName=supportsTouch&&touchMap[type]?touchMap[type]:type,f=function(e){var scrollY=g.doc.documentElement.scrollTop||g.doc.body.scrollTop,scrollX=g.doc.documentElement.scrollLeft||g.doc.body.scrollLeft,x=e.clientX+scrollX,y=e.clientY+scrollY;if(supportsTouch&&touchMap[has](type)){for(var i=0,ii=e.targetTouches&&e.targetTouches.length;i<ii;i++){if(e.targetTouches[i].target==obj){var olde=e;e=e.targetTouches[i];e.originalEvent=olde;e.preventDefault=preventTouch;e.stopPropagation=stopTouch;break;}}}
return fn.call(element,e,x,y);};obj.addEventListener(realName,f,false);return function(){obj.removeEventListener(realName,f,false);return true;};};}else if(g.doc.attachEvent){return function(obj,type,fn,element){var f=function(e){e=e||g.win.event;var scrollY=g.doc.documentElement.scrollTop||g.doc.body.scrollTop,scrollX=g.doc.documentElement.scrollLeft||g.doc.body.scrollLeft,x=e.clientX+scrollX,y=e.clientY+scrollY;e.preventDefault=e.preventDefault||preventDefault;e.stopPropagation=e.stopPropagation||stopPropagation;return fn.call(element,e,x,y);};obj.attachEvent("on"+type,f);var detacher=function(){obj.detachEvent("on"+type,f);return true;};return detacher;};}})(),drag=[],dragMove=function(e){var x=e.clientX,y=e.clientY,scrollY=g.doc.documentElement.scrollTop||g.doc.body.scrollTop,scrollX=g.doc.documentElement.scrollLeft||g.doc.body.scrollLeft,dragi,j=drag.length;while(j--){dragi=drag[j];if(supportsTouch){var i=e.touches.length,touch;while(i--){touch=e.touches[i];if(touch.identifier==dragi.el._drag.id){x=touch.clientX;y=touch.clientY;(e.originalEvent?e.originalEvent:e).preventDefault();break;}}}else{e.preventDefault();}
var node=dragi.el.node,o,next=node.nextSibling,parent=node.parentNode,display=node.style.display;g.win.opera&&parent.removeChild(node);node.style.display="none";o=dragi.el.paper.getElementByPoint(x,y);node.style.display=display;g.win.opera&&(next?parent.insertBefore(node,next):parent.appendChild(node));o&&eve("drag.over."+dragi.el.id,dragi.el,o);x+=scrollX;y+=scrollY;eve("drag.move."+dragi.el.id,dragi.move_scope||dragi.el,x-dragi.el._drag.x,y-dragi.el._drag.y,x,y,e);}},dragUp=function(e){R.unmousemove(dragMove).unmouseup(dragUp);var i=drag.length,dragi;while(i--){dragi=drag[i];dragi.el._drag={};eve("drag.end."+dragi.el.id,dragi.end_scope||dragi.start_scope||dragi.move_scope||dragi.el,e);}
drag=[];},elproto=R.el={};for(var i=events.length;i--;){(function(eventName){R[eventName]=elproto[eventName]=function(fn,scope){if(R.is(fn,"function")){this.events=this.events||[];this.events.push({name:eventName,f:fn,unbind:addEvent(this.shape||this.node||g.doc,eventName,fn,scope||this)});}
return this;};R["un"+eventName]=elproto["un"+eventName]=function(fn){var events=this.events||[],l=events.length;while(l--)if(events[l].name==eventName&&events[l].f==fn){events[l].unbind();events.splice(l,1);!events.length&&delete this.events;return this;}
return this;};})(events[i]);}
elproto.data=function(key,value){var data=eldata[this.id]=eldata[this.id]||{};if(arguments.length==1){if(R.is(key,"object")){for(var i in key)if(key[has](i)){this.data(i,key[i]);}
return this;}
eve("data.get."+this.id,this,data[key],key);return data[key];}
data[key]=value;eve("data.set."+this.id,this,value,key);return this;};elproto.removeData=function(key){if(key==null){eldata[this.id]={};}else{eldata[this.id]&&delete eldata[this.id][key];}
return this;};elproto.hover=function(f_in,f_out,scope_in,scope_out){return this.mouseover(f_in,scope_in).mouseout(f_out,scope_out||scope_in);};elproto.unhover=function(f_in,f_out){return this.unmouseover(f_in).unmouseout(f_out);};var draggable=[];elproto.drag=function(onmove,onstart,onend,move_scope,start_scope,end_scope){function start(e){(e.originalEvent||e).preventDefault();var scrollY=g.doc.documentElement.scrollTop||g.doc.body.scrollTop,scrollX=g.doc.documentElement.scrollLeft||g.doc.body.scrollLeft;this._drag.x=e.clientX+scrollX;this._drag.y=e.clientY+scrollY;this._drag.id=e.identifier;!drag.length&&R.mousemove(dragMove).mouseup(dragUp);drag.push({el:this,move_scope:move_scope,start_scope:start_scope,end_scope:end_scope});onstart&&eve.on("drag.start."+this.id,onstart);onmove&&eve.on("drag.move."+this.id,onmove);onend&&eve.on("drag.end."+this.id,onend);eve("drag.start."+this.id,start_scope||move_scope||this,e.clientX+scrollX,e.clientY+scrollY,e);}
this._drag={};draggable.push({el:this,start:start});this.mousedown(start);return this;};elproto.onDragOver=function(f){f?eve.on("drag.over."+this.id,f):eve.unbind("drag.over."+this.id);};elproto.undrag=function(){var i=draggable.length;while(i--)if(draggable[i].el==this){this.unmousedown(draggable[i].start);draggable.splice(i,1);eve.unbind("drag.*."+this.id);}
!draggable.length&&R.unmousemove(dragMove).unmouseup(dragUp);};paperproto.circle=function(x,y,r){var out=R._engine.circle(this,x||0,y||0,r||0);this.__set__&&this.__set__.push(out);return out;};paperproto.rect=function(x,y,w,h,r){var out=R._engine.rect(this,x||0,y||0,w||0,h||0,r||0);this.__set__&&this.__set__.push(out);return out;};paperproto.ellipse=function(x,y,rx,ry){var out=R._engine.ellipse(this,x||0,y||0,rx||0,ry||0);this.__set__&&this.__set__.push(out);return out;};paperproto.path=function(pathString){pathString&&!R.is(pathString,string)&&!R.is(pathString[0],array)&&(pathString+=E);var out=R._engine.path(R.format[apply](R,arguments),this);this.__set__&&this.__set__.push(out);return out;};paperproto.image=function(src,x,y,w,h){var out=R._engine.image(this,src||"about:blank",x||0,y||0,w||0,h||0);this.__set__&&this.__set__.push(out);return out;};paperproto.text=function(x,y,text){var out=R._engine.text(this,x||0,y||0,Str(text));this.__set__&&this.__set__.push(out);return out;};paperproto.set=function(itemsArray){!R.is(itemsArray,"array")&&(itemsArray=Array.prototype.splice.call(arguments,0,arguments.length));var out=new Set(itemsArray);this.__set__&&this.__set__.push(out);return out;};paperproto.setStart=function(set){this.__set__=set||this.set();};paperproto.setFinish=function(set){var out=this.__set__;delete this.__set__;return out;};paperproto.setSize=function(width,height){return R._engine.setSize.call(this,width,height);};paperproto.setViewBox=function(x,y,w,h,fit){return R._engine.setViewBox.call(this,x,y,w,h,fit);};paperproto.top=paperproto.bottom=null;paperproto.raphael=R;var getOffset=function(elem){var box=elem.getBoundingClientRect(),doc=elem.ownerDocument,body=doc.body,docElem=doc.documentElement,clientTop=docElem.clientTop||body.clientTop||0,clientLeft=docElem.clientLeft||body.clientLeft||0,top=box.top+(g.win.pageYOffset||docElem.scrollTop||body.scrollTop)-clientTop,left=box.left+(g.win.pageXOffset||docElem.scrollLeft||body.scrollLeft)-clientLeft;return{y:top,x:left};};paperproto.getElementByPoint=function(x,y){var paper=this,svg=paper.canvas,target=g.doc.elementFromPoint(x,y);if(g.win.opera&&target.tagName=="svg"){var so=getOffset(svg),sr=svg.createSVGRect();sr.x=x-so.x;sr.y=y-so.y;sr.width=sr.height=1;var hits=svg.getIntersectionList(sr,null);if(hits.length){target=hits[hits.length-1];}}
if(!target){return null;}
while(target.parentNode&&target!=svg.parentNode&&!target.raphael){target=target.parentNode;}
target==paper.canvas.parentNode&&(target=svg);target=target&&target.raphael?paper.getById(target.raphaelid):null;return target;};paperproto.getById=function(id){var bot=this.bottom;while(bot){if(bot.id==id){return bot;}
bot=bot.next;}
return null;};paperproto.forEach=function(callback,thisArg){var bot=this.bottom;while(bot){if(callback.call(thisArg,bot)===false){return this;}
bot=bot.next;}
return this;};function x_y(){return this.x+S+this.y;}
function x_y_w_h(){return this.x+S+this.y+S+this.width+" \xd7 "+this.height;}
elproto.getBBox=function(isWithoutTransform){if(this.removed){return{};}
var _=this._;if(isWithoutTransform){if(_.dirty||!_.bboxwt){this.realPath=getPath[this.type](this);_.bboxwt=pathDimensions(this.realPath);_.bboxwt.toString=x_y_w_h;_.dirty=0;}
return _.bboxwt;}
if(_.dirty||_.dirtyT||!_.bbox){if(_.dirty||!this.realPath){_.bboxwt=0;this.realPath=getPath[this.type](this);}
_.bbox=pathDimensions(mapPath(this.realPath,this.matrix));_.bbox.toString=x_y_w_h;_.dirty=_.dirtyT=0;}
return _.bbox;};elproto.clone=function(){if(this.removed){return null;}
var out=this.paper[this.type]().attr(this.attr());this.__set__&&this.__set__.push(out);return out;};elproto.glow=function(glow){if(this.type=="text"){return null;}
glow=glow||{};var s={width:(glow.width||10)+(+this.attr("stroke-width")||1),fill:glow.fill||false,opacity:glow.opacity||.5,offsetx:glow.offsetx||0,offsety:glow.offsety||0,color:glow.color||"#000"},c=s.width/2,r=this.paper,out=r.set(),path=this.realPath||getPath[this.type](this);path=this.matrix?mapPath(path,this.matrix):path;for(var i=1;i<c+1;i++){out.push(r.path(path).attr({stroke:s.color,fill:s.fill?s.color:"none","stroke-linejoin":"round","stroke-linecap":"round","stroke-width":+(s.width/c*i).toFixed(3),opacity:+(s.opacity/c).toFixed(3)}));}
return out.insertBefore(this).translate(s.offsetx,s.offsety);};var curveslengths={},getPointAtSegmentLength=function(p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y,length){var len=0,precision=100,name=[p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y].join(),cache=curveslengths[name],old,dot;!cache&&(curveslengths[name]=cache={data:[]});cache.timer&&clearTimeout(cache.timer);cache.timer=setTimeout(function(){delete curveslengths[name];},2e3);if(length!=null&&!cache.precision){var total=getPointAtSegmentLength(p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y);cache.precision=~~total*10;cache.data=[];}
precision=cache.precision||precision;for(var i=0;i<precision+1;i++){if(cache.data[i*precision]){dot=cache.data[i*precision];}else{dot=R.findDotsAtSegment(p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y,i/precision);cache.data[i*precision]=dot;}
i&&(len+=pow(pow(old.x-dot.x,2)+pow(old.y-dot.y,2),.5));if(length!=null&&len>=length){return dot;}
old=dot;}
if(length==null){return len;}},getLengthFactory=function(istotal,subpath){return function(path,length,onlystart){path=path2curve(path);var x,y,p,l,sp="",subpaths={},point,len=0;for(var i=0,ii=path.length;i<ii;i++){p=path[i];if(p[0]=="M"){x=+p[1];y=+p[2];}else{l=getPointAtSegmentLength(x,y,p[1],p[2],p[3],p[4],p[5],p[6]);if(len+l>length){if(subpath&&!subpaths.start){point=getPointAtSegmentLength(x,y,p[1],p[2],p[3],p[4],p[5],p[6],length-len);sp+=["C"+point.start.x,point.start.y,point.m.x,point.m.y,point.x,point.y];if(onlystart){return sp;}
subpaths.start=sp;sp=["M"+point.x,point.y+"C"+point.n.x,point.n.y,point.end.x,point.end.y,p[5],p[6]].join();len+=l;x=+p[5];y=+p[6];continue;}
if(!istotal&&!subpath){point=getPointAtSegmentLength(x,y,p[1],p[2],p[3],p[4],p[5],p[6],length-len);return{x:point.x,y:point.y,alpha:point.alpha};}}
len+=l;x=+p[5];y=+p[6];}
sp+=p.shift()+p;}
subpaths.end=sp;point=istotal?len:subpath?subpaths:R.findDotsAtSegment(x,y,p[0],p[1],p[2],p[3],p[4],p[5],1);point.alpha&&(point={x:point.x,y:point.y,alpha:point.alpha});return point;};};var getTotalLength=getLengthFactory(1),getPointAtLength=getLengthFactory(),getSubpathsAtLength=getLengthFactory(0,1);R.getTotalLength=getTotalLength;R.getPointAtLength=getPointAtLength;R.getSubpath=function(path,from,to){if(this.getTotalLength(path)-to<1e-6){return getSubpathsAtLength(path,from).end;}
var a=getSubpathsAtLength(path,to,1);return from?getSubpathsAtLength(a,from).end:a;};elproto.getTotalLength=function(){if(this.type!="path"){return;}
if(this.node.getTotalLength){return this.node.getTotalLength();}
return getTotalLength(this.attrs.path);};elproto.getPointAtLength=function(length){if(this.type!="path"){return;}
return getPointAtLength(this.attrs.path,length);};elproto.getSubpath=function(from,to){if(this.type!="path"){return;}
return R.getSubpath(this.attrs.path,from,to);};var ef=R.easing_formulas={linear:function(n){return n;},"<":function(n){return pow(n,1.7);},">":function(n){return pow(n,.48);},"<>":function(n){var q=.48-n/1.04,Q=math.sqrt(.1734+q*q),x=Q-q,X=pow(abs(x),1/3)*(x<0?-1:1),y=-Q-q,Y=pow(abs(y),1/3)*(y<0?-1:1),t=X+Y+.5;return(1-t)*3*t*t+t*t*t;},backIn:function(n){var s=1.70158;return n*n*((s+1)*n-s);},backOut:function(n){n=n-1;var s=1.70158;return n*n*((s+1)*n+s)+1;},elastic:function(n){if(n==!!n){return n;}
return pow(2,-10*n)*math.sin((n-.075)*(2*PI)/.3)+1;},bounce:function(n){var s=7.5625,p=2.75,l;if(n<(1/p)){l=s*n*n;}else{if(n<(2/p)){n-=(1.5/p);l=s*n*n+.75;}else{if(n<(2.5/p)){n-=(2.25/p);l=s*n*n+.9375;}else{n-=(2.625/p);l=s*n*n+.984375;}}}
return l;}};ef.easeIn=ef["ease-in"]=ef["<"];ef.easeOut=ef["ease-out"]=ef[">"];ef.easeInOut=ef["ease-in-out"]=ef["<>"];ef["back-in"]=ef.backIn;ef["back-out"]=ef.backOut;var animationElements=[],requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(callback){setTimeout(callback,16);},animation=function(){var Now=+new Date,l=0;for(;l<animationElements.length;l++){var e=animationElements[l];if(e.el.removed||e.paused){continue;}
var time=Now-e.start,ms=e.ms,easing=e.easing,from=e.from,diff=e.diff,to=e.to,t=e.t,that=e.el,set={},now,init={},key;if(e.initstatus){time=(e.initstatus*e.anim.top-e.prev)/(e.percent-e.prev)*ms;e.status=e.initstatus;delete e.initstatus;e.stop&&animationElements.splice(l--,1);}else{e.status=(e.prev+(e.percent-e.prev)*(time/ms))/e.anim.top;}
if(time<0){continue;}
if(time<ms){var pos=easing(time/ms);for(var attr in from)if(from[has](attr)){switch(availableAnimAttrs[attr]){case nu:now=+from[attr]+pos*ms*diff[attr];break;case"colour":now="rgb("+[upto255(round(from[attr].r+pos*ms*diff[attr].r)),upto255(round(from[attr].g+pos*ms*diff[attr].g)),upto255(round(from[attr].b+pos*ms*diff[attr].b))].join(",")+")";break;case"path":now=[];for(var i=0,ii=from[attr].length;i<ii;i++){now[i]=[from[attr][i][0]];for(var j=1,jj=from[attr][i].length;j<jj;j++){now[i][j]=+from[attr][i][j]+pos*ms*diff[attr][i][j];}
now[i]=now[i].join(S);}
now=now.join(S);break;case"transform":if(diff[attr].real){now=[];for(i=0,ii=from[attr].length;i<ii;i++){now[i]=[from[attr][i][0]];for(j=1,jj=from[attr][i].length;j<jj;j++){now[i][j]=from[attr][i][j]+pos*ms*diff[attr][i][j];}}}else{var get=function(i){return+from[attr][i]+pos*ms*diff[attr][i];};now=[["m",get(0),get(1),get(2),get(3),get(4),get(5)]];}
break;case"csv":if(attr=="clip-rect"){now=[];i=4;while(i--){now[i]=+from[attr][i]+pos*ms*diff[attr][i];}}
break;default:var from2=[][concat](from[attr]);now=[];i=that.paper.customAttributes[attr].length;while(i--){now[i]=+from2[i]+pos*ms*diff[attr][i];}
break;}
set[attr]=now;}
that.attr(set);(function(id,that,anim){setTimeout(function(){eve("anim.frame."+id,that,anim);});})(that.id,that,e.anim);}else{(function(f,el,a){setTimeout(function(){eve("anim.frame."+el.id,el,a);eve("anim.finish."+el.id,el,a);R.is(f,"function")&&f.call(el);});})(e.callback,that,e.anim);that.attr(to);animationElements.splice(l--,1);if(e.repeat>1&&!e.next){for(key in to)if(to[has](key)){init[key]=e.totalOrigin[key];}
e.el.attr(init);runAnimation(e.anim,e.el,e.anim.percents[0],null,e.totalOrigin,e.repeat-1);}
if(e.next&&!e.stop){runAnimation(e.anim,e.el,e.next,null,e.totalOrigin,e.repeat);}}}
R.svg&&that&&that.paper&&that.paper.safari();animationElements.length&&requestAnimFrame(animation);},upto255=function(color){return color>255?255:color<0?0:color;};elproto.animateWith=function(el,anim,params,ms,easing,callback){var element=this;if(element.removed){callback&&callback.call(element);return element;}
var a=params instanceof Animation?params:R.animation(params,ms,easing,callback),x,y;runAnimation(a,element,a.percents[0],null,element.attr());for(var i=0,ii=animationElements.length;i<ii;i++){if(animationElements[i].anim==anim&&animationElements[i].el==el){animationElements[ii-1].start=animationElements[i].start;break;}}
return element;};function CubicBezierAtTime(t,p1x,p1y,p2x,p2y,duration){var cx=3*p1x,bx=3*(p2x-p1x)-cx,ax=1-cx-bx,cy=3*p1y,by=3*(p2y-p1y)-cy,ay=1-cy-by;function sampleCurveX(t){return((ax*t+bx)*t+cx)*t;}
function solve(x,epsilon){var t=solveCurveX(x,epsilon);return((ay*t+by)*t+cy)*t;}
function solveCurveX(x,epsilon){var t0,t1,t2,x2,d2,i;for(t2=x,i=0;i<8;i++){x2=sampleCurveX(t2)-x;if(abs(x2)<epsilon){return t2;}
d2=(3*ax*t2+2*bx)*t2+cx;if(abs(d2)<1e-6){break;}
t2=t2-x2/d2;}
t0=0;t1=1;t2=x;if(t2<t0){return t0;}
if(t2>t1){return t1;}
while(t0<t1){x2=sampleCurveX(t2);if(abs(x2-x)<epsilon){return t2;}
if(x>x2){t0=t2;}else{t1=t2;}
t2=(t1-t0)/2+t0;}
return t2;}
return solve(t,1/(200*duration));}
elproto.onAnimation=function(f){f?eve.on("anim.frame."+this.id,f):eve.unbind("anim.frame."+this.id);return this;};function Animation(anim,ms){var percents=[],newAnim={};this.ms=ms;this.times=1;if(anim){for(var attr in anim)if(anim[has](attr)){newAnim[toFloat(attr)]=anim[attr];percents.push(toFloat(attr));}
percents.sort(sortByNumber);}
this.anim=newAnim;this.top=percents[percents.length-1];this.percents=percents;}
Animation.prototype.delay=function(delay){var a=new Animation(this.anim,this.ms);a.times=this.times;a.del=+delay||0;return a;};Animation.prototype.repeat=function(times){var a=new Animation(this.anim,this.ms);a.del=this.del;a.times=math.floor(mmax(times,0))||1;return a;};function runAnimation(anim,element,percent,status,totalOrigin,times){percent=toFloat(percent);var params,isInAnim,isInAnimSet,percents=[],next,prev,timestamp,ms=anim.ms,from={},to={},diff={};if(status){for(i=0,ii=animationElements.length;i<ii;i++){var e=animationElements[i];if(e.el.id==element.id&&e.anim==anim){if(e.percent!=percent){animationElements.splice(i,1);isInAnimSet=1;}else{isInAnim=e;}
element.attr(e.totalOrigin);break;}}}else{status=+to;}
for(var i=0,ii=anim.percents.length;i<ii;i++){if(anim.percents[i]==percent||anim.percents[i]>status*anim.top){percent=anim.percents[i];prev=anim.percents[i-1]||0;ms=ms/anim.top*(percent-prev);next=anim.percents[i+1];params=anim.anim[percent];break;}else if(status){element.attr(anim.anim[anim.percents[i]]);}}
if(!params){return;}
if(!isInAnim){for(var attr in params)if(params[has](attr)){if(availableAnimAttrs[has](attr)||element.paper.customAttributes[has](attr)){from[attr]=element.attr(attr);(from[attr]==null)&&(from[attr]=availableAttrs[attr]);to[attr]=params[attr];switch(availableAnimAttrs[attr]){case nu:diff[attr]=(to[attr]-from[attr])/ms;break;case"colour":from[attr]=R.getRGB(from[attr]);var toColour=R.getRGB(to[attr]);diff[attr]={r:(toColour.r-from[attr].r)/ms,g:(toColour.g-from[attr].g)/ms,b:(toColour.b-from[attr].b)/ms};break;case"path":var pathes=path2curve(from[attr],to[attr]),toPath=pathes[1];from[attr]=pathes[0];diff[attr]=[];for(i=0,ii=from[attr].length;i<ii;i++){diff[attr][i]=[0];for(var j=1,jj=from[attr][i].length;j<jj;j++){diff[attr][i][j]=(toPath[i][j]-from[attr][i][j])/ms;}}
break;case"transform":var _=element._,eq=equaliseTransform(_[attr],to[attr]);if(eq){from[attr]=eq.from;to[attr]=eq.to;diff[attr]=[];diff[attr].real=true;for(i=0,ii=from[attr].length;i<ii;i++){diff[attr][i]=[from[attr][i][0]];for(j=1,jj=from[attr][i].length;j<jj;j++){diff[attr][i][j]=(to[attr][i][j]-from[attr][i][j])/ms;}}}else{var m=(element.matrix||new Matrix),to2={_:{transform:_.transform},getBBox:function(){return element.getBBox(1);}};from[attr]=[m.a,m.b,m.c,m.d,m.e,m.f];extractTransform(to2,to[attr]);to[attr]=to2._.transform;diff[attr]=[(to2.matrix.a-m.a)/ms,(to2.matrix.b-m.b)/ms,(to2.matrix.c-m.c)/ms,(to2.matrix.d-m.d)/ms,(to2.matrix.e-m.e)/ms,(to2.matrix.e-m.f)/ms];}
break;case"csv":var values=Str(params[attr])[split](separator),from2=Str(from[attr])[split](separator);if(attr=="clip-rect"){from[attr]=from2;diff[attr]=[];i=from2.length;while(i--){diff[attr][i]=(values[i]-from[attr][i])/ms;}}
to[attr]=values;break;default:values=[][concat](params[attr]);from2=[][concat](from[attr]);diff[attr]=[];i=element.paper.customAttributes[attr].length;while(i--){diff[attr][i]=((values[i]||0)-(from2[i]||0))/ms;}
break;}}}
var easing=params.easing,easyeasy=R.easing_formulas[easing];if(!easyeasy){easyeasy=Str(easing).match(bezierrg);if(easyeasy&&easyeasy.length==5){var curve=easyeasy;easyeasy=function(t){return CubicBezierAtTime(t,+curve[1],+curve[2],+curve[3],+curve[4],ms);};}else{easyeasy=pipe;}}
timestamp=params.start||anim.start||+new Date;e={anim:anim,percent:percent,timestamp:timestamp,start:timestamp+(anim.del||0),status:0,initstatus:status||0,stop:false,ms:ms,easing:easyeasy,from:from,diff:diff,to:to,el:element,callback:params.callback,prev:prev,next:next,repeat:times||anim.times,origin:element.attr(),totalOrigin:totalOrigin};animationElements.push(e);if(status&&!isInAnim&&!isInAnimSet){e.stop=true;e.start=new Date-ms*status;if(animationElements.length==1){return animation();}}
if(isInAnimSet){e.start=new Date-e.ms*status;}
animationElements.length==1&&requestAnimFrame(animation);}else{isInAnim.initstatus=status;isInAnim.start=new Date-isInAnim.ms*status;}
eve("anim.start."+element.id,element,anim);}
R.animation=function(params,ms,easing,callback){if(params instanceof Animation){return params;}
if(R.is(easing,"function")||!easing){callback=callback||easing||null;easing=null;}
params=Object(params);ms=+ms||0;var p={},json,attr;for(attr in params)if(params[has](attr)&&toFloat(attr)!=attr&&toFloat(attr)+"%"!=attr){json=true;p[attr]=params[attr];}
if(!json){return new Animation(params,ms);}else{easing&&(p.easing=easing);callback&&(p.callback=callback);return new Animation({100:p},ms);}};elproto.animate=function(params,ms,easing,callback){var element=this;if(element.removed){callback&&callback.call(element);return element;}
var anim=params instanceof Animation?params:R.animation(params,ms,easing,callback);runAnimation(anim,element,anim.percents[0],null,element.attr());return element;};elproto.setTime=function(anim,value){if(anim&&value!=null){this.status(anim,mmin(value,anim.ms)/anim.ms);}
return this;};elproto.status=function(anim,value){var out=[],i=0,len,e;if(value!=null){runAnimation(anim,this,-1,mmin(value,1));return this;}else{len=animationElements.length;for(;i<len;i++){e=animationElements[i];if(e.el.id==this.id&&(!anim||e.anim==anim)){if(anim){return e.status;}
out.push({anim:e.anim,status:e.status});}}
if(anim){return 0;}
return out;}};elproto.pause=function(anim){for(var i=0;i<animationElements.length;i++)if(animationElements[i].el.id==this.id&&(!anim||animationElements[i].anim==anim)){if(eve("anim.pause."+this.id,this,animationElements[i].anim)!==false){animationElements[i].paused=true;}}
return this;};elproto.resume=function(anim){for(var i=0;i<animationElements.length;i++)if(animationElements[i].el.id==this.id&&(!anim||animationElements[i].anim==anim)){var e=animationElements[i];if(eve("anim.resume."+this.id,this,e.anim)!==false){delete e.paused;this.status(e.anim,e.status);}}
return this;};elproto.stop=function(anim){for(var i=0;i<animationElements.length;i++)if(animationElements[i].el.id==this.id&&(!anim||animationElements[i].anim==anim)){if(eve("anim.stop."+this.id,this,animationElements[i].anim)!==false){animationElements.splice(i--,1);}}
return this;};elproto.toString=function(){return"Rapha\xebl\u2019s object";};var Set=function(items){this.items=[];this.length=0;this.type="set";if(items){for(var i=0,ii=items.length;i<ii;i++){if(items[i]&&(items[i].constructor==elproto.constructor||items[i].constructor==Set)){this[this.items.length]=this.items[this.items.length]=items[i];this.length++;}}}},setproto=Set.prototype;setproto.push=function(){var item,len;for(var i=0,ii=arguments.length;i<ii;i++){item=arguments[i];if(item&&(item.constructor==elproto.constructor||item.constructor==Set)){len=this.items.length;this[len]=this.items[len]=item;this.length++;}}
return this;};setproto.pop=function(){this.length&&delete this[this.length--];return this.items.pop();};setproto.forEach=function(callback,thisArg){for(var i=0,ii=this.items.length;i<ii;i++){if(callback.call(thisArg,this.items[i],i)===false){return this;}}
return this;};for(var method in elproto)if(elproto[has](method)){setproto[method]=(function(methodname){return function(){var arg=arguments;return this.forEach(function(el){el[methodname][apply](el,arg);});};})(method);}
setproto.attr=function(name,value){if(name&&R.is(name,array)&&R.is(name[0],"object")){for(var j=0,jj=name.length;j<jj;j++){this.items[j].attr(name[j]);}}else{for(var i=0,ii=this.items.length;i<ii;i++){this.items[i].attr(name,value);}}
return this;};setproto.clear=function(){while(this.length){this.pop();}};setproto.splice=function(index,count,insertion){index=index<0?mmax(this.length+index,0):index;count=mmax(0,mmin(this.length-index,count));var tail=[],todel=[],args=[],i;for(i=2;i<arguments.length;i++){args.push(arguments[i]);}
for(i=0;i<count;i++){todel.push(this[index+i]);}
for(;i<this.length-index;i++){tail.push(this[index+i]);}
var arglen=args.length;for(i=0;i<arglen+tail.length;i++){this.items[index+i]=this[index+i]=i<arglen?args[i]:tail[i-arglen];}
i=this.items.length=this.length-=count-arglen;while(this[i]){delete this[i++];}
return new Set(todel);};setproto.exclude=function(el){for(var i=0,ii=this.length;i<ii;i++)if(this[i]==el){this.splice(i,1);return true;}};setproto.animate=function(params,ms,easing,callback){(R.is(easing,"function")||!easing)&&(callback=easing||null);var len=this.items.length,i=len,item,set=this,collector;if(!len){return this;}
callback&&(collector=function(){!--len&&callback.call(set);});easing=R.is(easing,string)?easing:collector;var anim=R.animation(params,ms,easing,collector);item=this.items[--i].animate(anim);while(i--){this.items[i]&&!this.items[i].removed&&this.items[i].animateWith(item,anim,anim);}
return this;};setproto.insertAfter=function(el){var i=this.items.length;while(i--){this.items[i].insertAfter(el);}
return this;};setproto.getBBox=function(){var x=[],y=[],w=[],h=[];for(var i=this.items.length;i--;)if(!this.items[i].removed){var box=this.items[i].getBBox();x.push(box.x);y.push(box.y);w.push(box.x+box.width);h.push(box.y+box.height);}
x=mmin[apply](0,x);y=mmin[apply](0,y);return{x:x,y:y,width:mmax[apply](0,w)-x,height:mmax[apply](0,h)-y};};setproto.clone=function(s){s=new Set;for(var i=0,ii=this.items.length;i<ii;i++){s.push(this.items[i].clone());}
return s;};setproto.toString=function(){return"Rapha\xebl\u2018s set";};R.registerFont=function(font){if(!font.face){return font;}
this.fonts=this.fonts||{};var fontcopy={w:font.w,face:{},glyphs:{}},family=font.face["font-family"];for(var prop in font.face)if(font.face[has](prop)){fontcopy.face[prop]=font.face[prop];}
if(this.fonts[family]){this.fonts[family].push(fontcopy);}else{this.fonts[family]=[fontcopy];}
if(!font.svg){fontcopy.face["units-per-em"]=toInt(font.face["units-per-em"],10);for(var glyph in font.glyphs)if(font.glyphs[has](glyph)){var path=font.glyphs[glyph];fontcopy.glyphs[glyph]={w:path.w,k:{},d:path.d&&"M"+path.d.replace(/[mlcxtrv]/g,function(command){return{l:"L",c:"C",x:"z",t:"m",r:"l",v:"c"}[command]||"M";})+"z"};if(path.k){for(var k in path.k)if(path[has](k)){fontcopy.glyphs[glyph].k[k]=path.k[k];}}}}
return font;};paperproto.getFont=function(family,weight,style,stretch){stretch=stretch||"normal";style=style||"normal";weight=+weight||{normal:400,bold:700,lighter:300,bolder:800}[weight]||400;if(!R.fonts){return;}
var font=R.fonts[family];if(!font){var name=new RegExp("(^|\\s)"+family.replace(/[^\w\d\s+!~.:_-]/g,E)+"(\\s|$)","i");for(var fontName in R.fonts)if(R.fonts[has](fontName)){if(name.test(fontName)){font=R.fonts[fontName];break;}}}
var thefont;if(font){for(var i=0,ii=font.length;i<ii;i++){thefont=font[i];if(thefont.face["font-weight"]==weight&&(thefont.face["font-style"]==style||!thefont.face["font-style"])&&thefont.face["font-stretch"]==stretch){break;}}}
return thefont;};paperproto.print=function(x,y,string,font,size,origin,letter_spacing){origin=origin||"middle";letter_spacing=mmax(mmin(letter_spacing||0,1),-1);var out=this.set(),letters=Str(string)[split](E),shift=0,path=E,scale;R.is(font,string)&&(font=this.getFont(font));if(font){scale=(size||16)/font.face["units-per-em"];var bb=font.face.bbox[split](separator),top=+bb[0],height=+bb[1]+(origin=="baseline"?bb[3]-bb[1]+(+font.face.descent):(bb[3]-bb[1])/2);for(var i=0,ii=letters.length;i<ii;i++){var prev=i&&font.glyphs[letters[i-1]]||{},curr=font.glyphs[letters[i]];shift+=i?(prev.w||font.w)+(prev.k&&prev.k[letters[i]]||0)+(font.w*letter_spacing):0;curr&&curr.d&&out.push(this.path(curr.d).attr({fill:"#000",stroke:"none",transform:[["t",shift*scale,0]]}));}
out.transform(["...s",scale,scale,top,height,"t",(x-top)/scale,(y-height)/scale]);}
return out;};paperproto.add=function(json){if(R.is(json,"array")){var res=this.set(),i=0,ii=json.length,j;for(;i<ii;i++){j=json[i]||{};elements[has](j.type)&&res.push(this[j.type]().attr(j));}}
return res;};R.format=function(token,params){var args=R.is(params,array)?[0][concat](params):arguments;token&&R.is(token,string)&&args.length-1&&(token=token.replace(formatrg,function(str,i){return args[++i]==null?E:args[i];}));return token||E;};R.fullfill=(function(){var tokenRegex=/\{([^\}]+)\}/g,objNotationRegex=/(?:(?:^|\.)(.+?)(?=\[|\.|$|\()|\[('|")(.+?)\2\])(\(\))?/g,replacer=function(all,key,obj){var res=obj;key.replace(objNotationRegex,function(all,name,quote,quotedName,isFunc){name=name||quotedName;if(res){if(name in res){res=res[name];}
typeof res=="function"&&isFunc&&(res=res());}});res=(res==null||res==obj?all:res)+"";return res;};return function(str,obj){return String(str).replace(tokenRegex,function(all,key){return replacer(all,key,obj);});};})();R.ninja=function(){oldRaphael.was?(g.win.Raphael=oldRaphael.is):delete Raphael;return R;};R.st=setproto;(function(doc,loaded,f){if(doc.readyState==null&&doc.addEventListener){doc.addEventListener(loaded,f=function(){doc.removeEventListener(loaded,f,false);doc.readyState="complete";},false);doc.readyState="loading";}
function isLoaded(){(/in/).test(doc.readyState)?setTimeout(isLoaded,9):R.eve("DOMload");}
isLoaded();})(document,"DOMContentLoaded");oldRaphael.was?(g.win.Raphael=R):(Raphael=R);eve.on("DOMload",function(){loaded=true;});})();window.Raphael.svg&&function(R){var has="hasOwnProperty",Str=String,toFloat=parseFloat,toInt=parseInt,math=Math,mmax=math.max,abs=math.abs,pow=math.pow,separator=/[, ]+/,eve=R.eve,E="",S=" ";var xlink="http://www.w3.org/1999/xlink",markers={block:"M5,0 0,2.5 5,5z",classic:"M5,0 0,2.5 5,5 3.5,3 3.5,2z",diamond:"M2.5,0 5,2.5 2.5,5 0,2.5z",open:"M6,1 1,3.5 6,6",oval:"M2.5,0A2.5,2.5,0,0,1,2.5,5 2.5,2.5,0,0,1,2.5,0z"},markerCounter={};R.toString=function(){return"Your browser supports SVG.\nYou are running Rapha\xebl "+this.version;};var $=function(el,attr){if(attr){if(typeof el=="string"){el=$(el);}
for(var key in attr)if(attr[has](key)){if(key.substring(0,6)=="xlink:"){el.setAttributeNS(xlink,key.substring(6),Str(attr[key]));}else{el.setAttribute(key,Str(attr[key]));}}}else{el=R._g.doc.createElementNS("http://www.w3.org/2000/svg",el);el.style&&(el.style.webkitTapHighlightColor="rgba(0,0,0,0)");}
return el;},addGradientFill=function(element,gradient){var type="linear",id=element.id+gradient,fx=.5,fy=.5,o=element.node,SVG=element.paper,s=o.style,el=R._g.doc.getElementById(id);if(!el){gradient=Str(gradient).replace(R._radial_gradient,function(all,_fx,_fy){type="radial";if(_fx&&_fy){fx=toFloat(_fx);fy=toFloat(_fy);var dir=((fy>.5)*2-1);pow(fx-.5,2)+pow(fy-.5,2)>.25&&(fy=math.sqrt(.25-pow(fx-.5,2))*dir+.5)&&fy!=.5&&(fy=fy.toFixed(5)-1e-5*dir);}
return E;});gradient=gradient.split(/\s*\-\s*/);if(type=="linear"){var angle=gradient.shift();angle=-toFloat(angle);if(isNaN(angle)){return null;}
var vector=[0,0,math.cos(R.rad(angle)),math.sin(R.rad(angle))],max=1/(mmax(abs(vector[2]),abs(vector[3]))||1);vector[2]*=max;vector[3]*=max;if(vector[2]<0){vector[0]=-vector[2];vector[2]=0;}
if(vector[3]<0){vector[1]=-vector[3];vector[3]=0;}}
var dots=R._parseDots(gradient);if(!dots){return null;}
id=id.replace(/[\(\)\s,\xb0#]/g,"_");if(element.gradient&&id!=element.gradient.id){SVG.defs.removeChild(element.gradient);delete element.gradient;}
if(!element.gradient){el=$(type+"Gradient",{id:id});element.gradient=el;$(el,type=="radial"?{fx:fx,fy:fy}:{x1:vector[0],y1:vector[1],x2:vector[2],y2:vector[3],gradientTransform:element.matrix.invert()});SVG.defs.appendChild(el);for(var i=0,ii=dots.length;i<ii;i++){el.appendChild($("stop",{offset:dots[i].offset?dots[i].offset:i?"100%":"0%","stop-color":dots[i].color||"#fff"}));}}}
$(o,{fill:"url(#"+id+")",opacity:1,"fill-opacity":1});s.fill=E;s.opacity=1;s.fillOpacity=1;return 1;},updatePosition=function(o){var bbox=o.getBBox(1);$(o.pattern,{patternTransform:o.matrix.invert()+" translate("+bbox.x+","+bbox.y+")"});},addArrow=function(o,value,isEnd){if(o.type=="path"){var values=Str(value).toLowerCase().split("-"),p=o.paper,se=isEnd?"end":"start",node=o.node,attrs=o.attrs,stroke=attrs["stroke-width"],i=values.length,type="classic",from,to,dx,refX,attr,w=3,h=3,t=5;while(i--){switch(values[i]){case"block":case"classic":case"oval":case"diamond":case"open":case"none":type=values[i];break;case"wide":h=5;break;case"narrow":h=2;break;case"long":w=5;break;case"short":w=2;break;}}
if(type=="open"){w+=2;h+=2;t+=2;dx=1;refX=isEnd?4:1;attr={fill:"none",stroke:attrs.stroke};}else{refX=dx=w/2;attr={fill:attrs.stroke,stroke:"none"};}
if(o._.arrows){if(isEnd){o._.arrows.endPath&&markerCounter[o._.arrows.endPath]--;o._.arrows.endMarker&&markerCounter[o._.arrows.endMarker]--;}else{o._.arrows.startPath&&markerCounter[o._.arrows.startPath]--;o._.arrows.startMarker&&markerCounter[o._.arrows.startMarker]--;}}else{o._.arrows={};}
if(type!="none"){var pathId="raphael-marker-"+type,markerId="raphael-marker-"+se+type+w+h+o.id;if(!R._g.doc.getElementById(pathId)){p.defs.appendChild($($("path"),{"stroke-linecap":"round",d:markers[type],id:pathId}));markerCounter[pathId]=1;}else{markerCounter[pathId]++;}
var marker=R._g.doc.getElementById(markerId),use;if(!marker){marker=$($("marker"),{id:markerId,markerHeight:h,markerWidth:w,orient:"auto",refX:refX,refY:h/2});use=$($("use"),{"xlink:href":"#"+pathId,transform:(isEnd?"rotate(180 "+w/2+" "+h/2+") ":E)+"scale("+w/t+","+h/t+")","stroke-width":(1/((w/t+h/t)/2)).toFixed(4)});marker.appendChild(use);p.defs.appendChild(marker);markerCounter[markerId]=1;}else{markerCounter[markerId]++;use=marker.getElementsByTagName("use")[0];}
$(use,attr);var delta=dx*(type!="diamond"&&type!="oval");if(isEnd){from=o._.arrows.startdx*stroke||0;to=R.getTotalLength(attrs.path)-delta*stroke;}else{from=delta*stroke;to=R.getTotalLength(attrs.path)-(o._.arrows.enddx*stroke||0);}
attr={};attr["marker-"+se]="url(#"+markerId+")";if(to||from){attr.d=Raphael.getSubpath(attrs.path,from,to);}
$(node,attr);o._.arrows[se+"Path"]=pathId;o._.arrows[se+"Marker"]=markerId;o._.arrows[se+"dx"]=delta;o._.arrows[se+"Type"]=type;o._.arrows[se+"String"]=value;}else{if(isEnd){from=o._.arrows.startdx*stroke||0;to=R.getTotalLength(attrs.path)-from;}else{from=0;to=R.getTotalLength(attrs.path)-(o._.arrows.enddx*stroke||0);}
o._.arrows[se+"Path"]&&$(node,{d:Raphael.getSubpath(attrs.path,from,to)});delete o._.arrows[se+"Path"];delete o._.arrows[se+"Marker"];delete o._.arrows[se+"dx"];delete o._.arrows[se+"Type"];delete o._.arrows[se+"String"];}
for(attr in markerCounter)if(markerCounter[has](attr)&&!markerCounter[attr]){var item=R._g.doc.getElementById(attr);item&&item.parentNode.removeChild(item);}}},dasharray={"":[0],"none":[0],"-":[3,1],".":[1,1],"-.":[3,1,1,1],"-..":[3,1,1,1,1,1],". ":[1,3],"- ":[4,3],"--":[8,3],"- .":[4,3,1,3],"--.":[8,3,1,3],"--..":[8,3,1,3,1,3]},addDashes=function(o,value,params){value=dasharray[Str(value).toLowerCase()];if(value){var width=o.attrs["stroke-width"]||"1",butt={round:width,square:width,butt:0}[o.attrs["stroke-linecap"]||params["stroke-linecap"]]||0,dashes=[],i=value.length;while(i--){dashes[i]=value[i]*width+((i%2)?1:-1)*butt;}
$(o.node,{"stroke-dasharray":dashes.join(",")});}},setFillAndStroke=function(o,params){var node=o.node,attrs=o.attrs,vis=node.style.visibility;node.style.visibility="hidden";for(var att in params){if(params[has](att)){if(!R._availableAttrs[has](att)){continue;}
var value=params[att];attrs[att]=value;switch(att){case"blur":o.blur(value);break;case"href":case"title":case"target":var pn=node.parentNode;if(pn.tagName.toLowerCase()!="a"){var hl=$("a");pn.insertBefore(hl,node);hl.appendChild(node);pn=hl;}
if(att=="target"){pn.setAttributeNS(xlink,"show",value=="blank"?"new":value);}else{pn.setAttributeNS(xlink,att,value);}
break;case"cursor":node.style.cursor=value;break;case"transform":o.transform(value);break;case"arrow-start":addArrow(o,value);break;case"arrow-end":addArrow(o,value,1);break;case"clip-rect":var rect=Str(value).split(separator);if(rect.length==4){o.clip&&o.clip.parentNode.parentNode.removeChild(o.clip.parentNode);var el=$("clipPath"),rc=$("rect");el.id=R.createUUID();$(rc,{x:rect[0],y:rect[1],width:rect[2],height:rect[3]});el.appendChild(rc);o.paper.defs.appendChild(el);$(node,{"clip-path":"url(#"+el.id+")"});o.clip=rc;}
if(!value){var path=node.getAttribute("clip-path");if(path){var clip=R._g.doc.getElementById(path.replace(/(^url\(#|\)$)/g,E));clip&&clip.parentNode.removeChild(clip);$(node,{"clip-path":E});delete o.clip;}}
break;case"path":if(o.type=="path"){$(node,{d:value?attrs.path=R._pathToAbsolute(value):"M0,0"});o._.dirty=1;if(o._.arrows){"startString"in o._.arrows&&addArrow(o,o._.arrows.startString);"endString"in o._.arrows&&addArrow(o,o._.arrows.endString,1);}}
break;case"width":node.setAttribute(att,value);o._.dirty=1;if(attrs.fx){att="x";value=attrs.x;}else{break;}
case"x":if(attrs.fx){value=-attrs.x-(attrs.width||0);}
case"rx":if(att=="rx"&&o.type=="rect"){break;}
case"cx":node.setAttribute(att,value);o.pattern&&updatePosition(o);o._.dirty=1;break;case"height":node.setAttribute(att,value);o._.dirty=1;if(attrs.fy){att="y";value=attrs.y;}else{break;}
case"y":if(attrs.fy){value=-attrs.y-(attrs.height||0);}
case"ry":if(att=="ry"&&o.type=="rect"){break;}
case"cy":node.setAttribute(att,value);o.pattern&&updatePosition(o);o._.dirty=1;break;case"r":if(o.type=="rect"){$(node,{rx:value,ry:value});}else{node.setAttribute(att,value);}
o._.dirty=1;break;case"src":if(o.type=="image"){node.setAttributeNS(xlink,"href",value);}
break;case"stroke-width":if(o._.sx!=1||o._.sy!=1){value/=mmax(abs(o._.sx),abs(o._.sy))||1;}
if(o.paper._vbSize){value*=o.paper._vbSize;}
node.setAttribute(att,value);if(attrs["stroke-dasharray"]){addDashes(o,attrs["stroke-dasharray"],params);}
if(o._.arrows){"startString"in o._.arrows&&addArrow(o,o._.arrows.startString);"endString"in o._.arrows&&addArrow(o,o._.arrows.endString,1);}
break;case"stroke-dasharray":addDashes(o,value,params);break;case"fill":var isURL=Str(value).match(R._ISURL);if(isURL){el=$("pattern");var ig=$("image");el.id=R.createUUID();$(el,{x:0,y:0,patternUnits:"userSpaceOnUse",height:1,width:1});$(ig,{x:0,y:0,"xlink:href":isURL[1]});el.appendChild(ig);(function(el){R._preload(isURL[1],function(){var w=this.offsetWidth,h=this.offsetHeight;$(el,{width:w,height:h});$(ig,{width:w,height:h});o.paper.safari();});})(el);o.paper.defs.appendChild(el);$(node,{fill:"url(#"+el.id+")"});o.pattern=el;o.pattern&&updatePosition(o);break;}
var clr=R.getRGB(value);if(!clr.error){delete params.gradient;delete attrs.gradient;!R.is(attrs.opacity,"undefined")&&R.is(params.opacity,"undefined")&&$(node,{opacity:attrs.opacity});!R.is(attrs["fill-opacity"],"undefined")&&R.is(params["fill-opacity"],"undefined")&&$(node,{"fill-opacity":attrs["fill-opacity"]});}else if((o.type=="circle"||o.type=="ellipse"||Str(value).charAt()!="r")&&addGradientFill(o,value)){if("opacity"in attrs||"fill-opacity"in attrs){var gradient=R._g.doc.getElementById(node.getAttribute("fill").replace(/^url\(#|\)$/g,E));if(gradient){var stops=gradient.getElementsByTagName("stop");$(stops[stops.length-1],{"stop-opacity":("opacity"in attrs?attrs.opacity:1)*("fill-opacity"in attrs?attrs["fill-opacity"]:1)});}}
attrs.gradient=value;attrs.fill="none";break;}
clr[has]("opacity")&&$(node,{"fill-opacity":clr.opacity>1?clr.opacity/100:clr.opacity});case"stroke":clr=R.getRGB(value);node.setAttribute(att,clr.hex);att=="stroke"&&clr[has]("opacity")&&$(node,{"stroke-opacity":clr.opacity>1?clr.opacity/100:clr.opacity});if(att=="stroke"&&o._.arrows){"startString"in o._.arrows&&addArrow(o,o._.arrows.startString);"endString"in o._.arrows&&addArrow(o,o._.arrows.endString,1);}
break;case"gradient":(o.type=="circle"||o.type=="ellipse"||Str(value).charAt()!="r")&&addGradientFill(o,value);break;case"opacity":if(attrs.gradient&&!attrs[has]("stroke-opacity")){$(node,{"stroke-opacity":value>1?value/100:value});}
case"fill-opacity":if(attrs.gradient){gradient=R._g.doc.getElementById(node.getAttribute("fill").replace(/^url\(#|\)$/g,E));if(gradient){stops=gradient.getElementsByTagName("stop");$(stops[stops.length-1],{"stop-opacity":value});}
break;}
default:att=="font-size"&&(value=toInt(value,10)+"px");var cssrule=att.replace(/(\-.)/g,function(w){return w.substring(1).toUpperCase();});node.style[cssrule]=value;o._.dirty=1;node.setAttribute(att,value);break;}}}
tuneText(o,params);node.style.visibility=vis;},leading=1.2,tuneText=function(el,params){if(el.type!="text"||!(params[has]("text")||params[has]("font")||params[has]("font-size")||params[has]("x")||params[has]("y"))){return;}
var a=el.attrs,node=el.node,fontSize=node.firstChild?toInt(R._g.doc.defaultView.getComputedStyle(node.firstChild,E).getPropertyValue("font-size"),10):10;if(params[has]("text")){a.text=params.text;while(node.firstChild){node.removeChild(node.firstChild);}
var texts=Str(params.text).split("\n"),tspans=[],tspan;for(var i=0,ii=texts.length;i<ii;i++){tspan=$("tspan");i&&$(tspan,{dy:fontSize*leading,x:a.x});tspan.appendChild(R._g.doc.createTextNode(texts[i]));node.appendChild(tspan);tspans[i]=tspan;}}else{tspans=node.getElementsByTagName("tspan");for(i=0,ii=tspans.length;i<ii;i++)if(i){$(tspans[i],{dy:fontSize*leading,x:a.x});}else{$(tspans[0],{dy:0});}}
$(node,{x:a.x,y:a.y});el._.dirty=1;var bb=el._getBBox(),dif=a.y-(bb.y+bb.height/2);dif&&R.is(dif,"finite")&&$(tspans[0],{dy:dif});},Element=function(node,svg){var X=0,Y=0;this[0]=this.node=node;node.raphael=true;this.id=R._oid++;node.raphaelid=this.id;this.matrix=R.matrix();this.realPath=null;this.paper=svg;this.attrs=this.attrs||{};this._={transform:[],sx:1,sy:1,deg:0,dx:0,dy:0,dirty:1};!svg.bottom&&(svg.bottom=this);this.prev=svg.top;svg.top&&(svg.top.next=this);svg.top=this;this.next=null;},elproto=R.el;Element.prototype=elproto;elproto.constructor=Element;R._engine.path=function(pathString,SVG){var el=$("path");SVG.canvas&&SVG.canvas.appendChild(el);var p=new Element(el,SVG);p.type="path";setFillAndStroke(p,{fill:"none",stroke:"#000",path:pathString});return p;};elproto.rotate=function(deg,cx,cy){if(this.removed){return this;}
deg=Str(deg).split(separator);if(deg.length-1){cx=toFloat(deg[1]);cy=toFloat(deg[2]);}
deg=toFloat(deg[0]);(cy==null)&&(cx=cy);if(cx==null||cy==null){var bbox=this.getBBox(1);cx=bbox.x+bbox.width/2;cy=bbox.y+bbox.height/2;}
this.transform(this._.transform.concat([["r",deg,cx,cy]]));return this;};elproto.scale=function(sx,sy,cx,cy){if(this.removed){return this;}
sx=Str(sx).split(separator);if(sx.length-1){sy=toFloat(sx[1]);cx=toFloat(sx[2]);cy=toFloat(sx[3]);}
sx=toFloat(sx[0]);(sy==null)&&(sy=sx);(cy==null)&&(cx=cy);if(cx==null||cy==null){var bbox=this.getBBox(1);}
cx=cx==null?bbox.x+bbox.width/2:cx;cy=cy==null?bbox.y+bbox.height/2:cy;this.transform(this._.transform.concat([["s",sx,sy,cx,cy]]));return this;};elproto.translate=function(dx,dy){if(this.removed){return this;}
dx=Str(dx).split(separator);if(dx.length-1){dy=toFloat(dx[1]);}
dx=toFloat(dx[0])||0;dy=+dy||0;this.transform(this._.transform.concat([["t",dx,dy]]));return this;};elproto.transform=function(tstr){var _=this._;if(tstr==null){return _.transform;}
R._extractTransform(this,tstr);this.clip&&$(this.clip,{transform:this.matrix.invert()});this.pattern&&updatePosition(this);this.node&&$(this.node,{transform:this.matrix});if(_.sx!=1||_.sy!=1){var sw=this.attrs[has]("stroke-width")?this.attrs["stroke-width"]:1;this.attr({"stroke-width":sw});}
return this;};elproto.hide=function(){!this.removed&&this.paper.safari(this.node.style.display="none");return this;};elproto.show=function(){!this.removed&&this.paper.safari(this.node.style.display="");return this;};elproto.remove=function(){if(this.removed){return;}
var paper=this.paper;paper.__set__&&paper.__set__.exclude(this);eve.unbind("*.*."+this.id);if(this.gradient){paper.defs.removeChild(this.gradient);}
R._tear(this,paper);if(this.node.parentNode.tagName.toLowerCase()=="a"){this.node.parentNode.parentNode.removeChild(this.node.parentNode);}else{this.node.parentNode.removeChild(this.node);}
for(var i in this){this[i]=typeof this[i]=="function"?R._removedFactory(i):null;}
this.removed=true;};elproto._getBBox=function(){if(this.node.style.display=="none"){this.show();var hide=true;}
var bbox={};try{bbox=this.node.getBBox();}catch(e){}finally{bbox=bbox||{};}
hide&&this.hide();return bbox;};elproto.attr=function(name,value){if(this.removed){return this;}
if(name==null){var res={};for(var a in this.attrs)if(this.attrs[has](a)){res[a]=this.attrs[a];}
res.gradient&&res.fill=="none"&&(res.fill=res.gradient)&&delete res.gradient;res.transform=this._.transform;return res;}
if(value==null&&R.is(name,"string")){if(name=="fill"&&this.attrs.fill=="none"&&this.attrs.gradient){return this.attrs.gradient;}
if(name=="transform"){return this._.transform;}
var names=name.split(separator),out={};for(var i=0,ii=names.length;i<ii;i++){name=names[i];if(name in this.attrs){out[name]=this.attrs[name];}else if(R.is(this.paper.customAttributes[name],"function")){out[name]=this.paper.customAttributes[name].def;}else{out[name]=R._availableAttrs[name];}}
return ii-1?out:out[names[0]];}
if(value==null&&R.is(name,"array")){out={};for(i=0,ii=name.length;i<ii;i++){out[name[i]]=this.attr(name[i]);}
return out;}
if(value!=null){var params={};params[name]=value;}else if(name!=null&&R.is(name,"object")){params=name;}
for(var key in params){eve("attr."+key+"."+this.id,this,params[key]);}
for(key in this.paper.customAttributes)if(this.paper.customAttributes[has](key)&&params[has](key)&&R.is(this.paper.customAttributes[key],"function")){var par=this.paper.customAttributes[key].apply(this,[].concat(params[key]));this.attrs[key]=params[key];for(var subkey in par)if(par[has](subkey)){params[subkey]=par[subkey];}}
setFillAndStroke(this,params);return this;};elproto.toFront=function(){if(this.removed){return this;}
if(this.node.parentNode.tagName.toLowerCase()=="a"){this.node.parentNode.parentNode.appendChild(this.node.parentNode);}else{this.node.parentNode.appendChild(this.node);}
var svg=this.paper;svg.top!=this&&R._tofront(this,svg);return this;};elproto.toBack=function(){if(this.removed){return this;}
var parent=this.node.parentNode;if(parent.tagName.toLowerCase()=="a"){parent.parentNode.insertBefore(this.node.parentNode,this.node.parentNode.parentNode.firstChild);}else if(parent.firstChild!=this.node){parent.insertBefore(this.node,this.node.parentNode.firstChild);}
R._toback(this,this.paper);var svg=this.paper;return this;};elproto.insertAfter=function(element){if(this.removed){return this;}
var node=element.node||element[element.length-1].node;if(node.nextSibling){node.parentNode.insertBefore(this.node,node.nextSibling);}else{node.parentNode.appendChild(this.node);}
R._insertafter(this,element,this.paper);return this;};elproto.insertBefore=function(element){if(this.removed){return this;}
var node=element.node||element[0].node;node.parentNode.insertBefore(this.node,node);R._insertbefore(this,element,this.paper);return this;};elproto.blur=function(size){var t=this;if(+size!==0){var fltr=$("filter"),blur=$("feGaussianBlur");t.attrs.blur=size;fltr.id=R.createUUID();$(blur,{stdDeviation:+size||1.5});fltr.appendChild(blur);t.paper.defs.appendChild(fltr);t._blur=fltr;$(t.node,{filter:"url(#"+fltr.id+")"});}else{if(t._blur){t._blur.parentNode.removeChild(t._blur);delete t._blur;delete t.attrs.blur;}
t.node.removeAttribute("filter");}};R._engine.circle=function(svg,x,y,r){var el=$("circle");svg.canvas&&svg.canvas.appendChild(el);var res=new Element(el,svg);res.attrs={cx:x,cy:y,r:r,fill:"none",stroke:"#000"};res.type="circle";$(el,res.attrs);return res;};R._engine.rect=function(svg,x,y,w,h,r){var el=$("rect");svg.canvas&&svg.canvas.appendChild(el);var res=new Element(el,svg);res.attrs={x:x,y:y,width:w,height:h,r:r||0,rx:r||0,ry:r||0,fill:"none",stroke:"#000"};res.type="rect";$(el,res.attrs);return res;};R._engine.ellipse=function(svg,x,y,rx,ry){var el=$("ellipse");svg.canvas&&svg.canvas.appendChild(el);var res=new Element(el,svg);res.attrs={cx:x,cy:y,rx:rx,ry:ry,fill:"none",stroke:"#000"};res.type="ellipse";$(el,res.attrs);return res;};R._engine.image=function(svg,src,x,y,w,h){var el=$("image");$(el,{x:x,y:y,width:w,height:h,preserveAspectRatio:"none"});el.setAttributeNS(xlink,"href",src);svg.canvas&&svg.canvas.appendChild(el);var res=new Element(el,svg);res.attrs={x:x,y:y,width:w,height:h,src:src};res.type="image";return res;};R._engine.text=function(svg,x,y,text){var el=$("text");svg.canvas&&svg.canvas.appendChild(el);var res=new Element(el,svg);res.attrs={x:x,y:y,"text-anchor":"middle",text:text,font:R._availableAttrs.font,stroke:"none",fill:"#000"};res.type="text";setFillAndStroke(res,res.attrs);return res;};R._engine.setSize=function(width,height){this.width=width||this.width;this.height=height||this.height;this.canvas.setAttribute("width",this.width);this.canvas.setAttribute("height",this.height);if(this._viewBox){this.setViewBox.apply(this,this._viewBox);}
return this;};R._engine.create=function(){var con=R._getContainer.apply(0,arguments),container=con&&con.container,x=con.x,y=con.y,width=con.width,height=con.height;if(!container){throw new Error("SVG container not found.");}
var cnvs=$("svg"),css="overflow:hidden;",isFloating;x=x||0;y=y||0;width=width||512;height=height||342;$(cnvs,{height:height,version:1.1,width:width,xmlns:"http://www.w3.org/2000/svg"});if(container==1){cnvs.style.cssText=css+"position:absolute;left:"+x+"px;top:"+y+"px";R._g.doc.body.appendChild(cnvs);isFloating=1;}else{cnvs.style.cssText=css+"position:relative";if(container.firstChild){container.insertBefore(cnvs,container.firstChild);}else{container.appendChild(cnvs);}}
container=new R._Paper;container.width=width;container.height=height;container.canvas=cnvs;container.clear();container._left=container._top=0;isFloating&&(container.renderfix=function(){});container.renderfix();return container;};R._engine.setViewBox=function(x,y,w,h,fit){eve("setViewBox",this,this._viewBox,[x,y,w,h,fit]);var size=mmax(w/this.width,h/this.height),top=this.top,aspectRatio=fit?"meet":"xMinYMin",vb,sw;if(x==null){if(this._vbSize){size=1;}
delete this._vbSize;vb="0 0 "+this.width+S+this.height;}else{this._vbSize=size;vb=x+S+y+S+w+S+h;}
$(this.canvas,{viewBox:vb,preserveAspectRatio:aspectRatio});while(size&&top){sw="stroke-width"in top.attrs?top.attrs["stroke-width"]:1;top.attr({"stroke-width":sw});top._.dirty=1;top._.dirtyT=1;top=top.prev;}
this._viewBox=[x,y,w,h,!!fit];return this;};R.prototype.renderfix=function(){var cnvs=this.canvas,s=cnvs.style,pos;try{pos=cnvs.getScreenCTM()||cnvs.createSVGMatrix();}catch(e){pos=cnvs.createSVGMatrix();}
var left=-pos.e%1,top=-pos.f%1;if(left||top){if(left){this._left=(this._left+left)%1;s.left=this._left+"px";}
if(top){this._top=(this._top+top)%1;s.top=this._top+"px";}}};R.prototype.clear=function(){R.eve("clear",this);var c=this.canvas;while(c.firstChild){c.removeChild(c.firstChild);}
this.bottom=this.top=null;(this.desc=$("desc")).appendChild(R._g.doc.createTextNode("Created with Rapha\xebl "+R.version));c.appendChild(this.desc);c.appendChild(this.defs=$("defs"));};R.prototype.remove=function(){eve("remove",this);this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas);for(var i in this){this[i]=typeof this[i]=="function"?R._removedFactory(i):null;}};var setproto=R.st;for(var method in elproto)if(elproto[has](method)&&!setproto[has](method)){setproto[method]=(function(methodname){return function(){var arg=arguments;return this.forEach(function(el){el[methodname].apply(el,arg);});};})(method);}}(window.Raphael);window.Raphael.vml&&function(R){var has="hasOwnProperty",Str=String,toFloat=parseFloat,math=Math,round=math.round,mmax=math.max,mmin=math.min,abs=math.abs,fillString="fill",separator=/[, ]+/,eve=R.eve,ms=" progid:DXImageTransform.Microsoft",S=" ",E="",map={M:"m",L:"l",C:"c",Z:"x",m:"t",l:"r",c:"v",z:"x"},bites=/([clmz]),?([^clmz]*)/gi,blurregexp=/ progid:\S+Blur\([^\)]+\)/g,val=/-?[^,\s-]+/g,cssDot="position:absolute;left:0;top:0;width:1px;height:1px",zoom=21600,pathTypes={path:1,rect:1,image:1},ovalTypes={circle:1,ellipse:1},path2vml=function(path){var total=/[ahqstv]/ig,command=R._pathToAbsolute;Str(path).match(total)&&(command=R._path2curve);total=/[clmz]/g;if(command==R._pathToAbsolute&&!Str(path).match(total)){var res=Str(path).replace(bites,function(all,command,args){var vals=[],isMove=command.toLowerCase()=="m",res=map[command];args.replace(val,function(value){if(isMove&&vals.length==2){res+=vals+map[command=="m"?"l":"L"];vals=[];}
vals.push(round(value*zoom));});return res+vals;});return res;}
var pa=command(path),p,r;res=[];for(var i=0,ii=pa.length;i<ii;i++){p=pa[i];r=pa[i][0].toLowerCase();r=="z"&&(r="x");for(var j=1,jj=p.length;j<jj;j++){r+=round(p[j]*zoom)+(j!=jj-1?",":E);}
res.push(r);}
return res.join(S);},compensation=function(deg,dx,dy){var m=R.matrix();m.rotate(-deg,.5,.5);return{dx:m.x(dx,dy),dy:m.y(dx,dy)};},setCoords=function(p,sx,sy,dx,dy,deg){var _=p._,m=p.matrix,fillpos=_.fillpos,o=p.node,s=o.style,y=1,flip="",dxdy,kx=zoom/sx,ky=zoom/sy;s.visibility="hidden";if(!sx||!sy){return;}
o.coordsize=abs(kx)+S+abs(ky);s.rotation=deg*(sx*sy<0?-1:1);if(deg){var c=compensation(deg,dx,dy);dx=c.dx;dy=c.dy;}
sx<0&&(flip+="x");sy<0&&(flip+=" y")&&(y=-1);s.flip=flip;o.coordorigin=(dx*-kx)+S+(dy*-ky);if(fillpos||_.fillsize){var fill=o.getElementsByTagName(fillString);fill=fill&&fill[0];o.removeChild(fill);if(fillpos){c=compensation(deg,m.x(fillpos[0],fillpos[1]),m.y(fillpos[0],fillpos[1]));fill.position=c.dx*y+S+c.dy*y;}
if(_.fillsize){fill.size=_.fillsize[0]*abs(sx)+S+_.fillsize[1]*abs(sy);}
o.appendChild(fill);}
s.visibility="visible";};R.toString=function(){return"Your browser doesn\u2019t support SVG. Falling down to VML.\nYou are running Rapha\xebl "+this.version;};var addArrow=function(o,value,isEnd){var values=Str(value).toLowerCase().split("-"),se=isEnd?"end":"start",i=values.length,type="classic",w="medium",h="medium";while(i--){switch(values[i]){case"block":case"classic":case"oval":case"diamond":case"open":case"none":type=values[i];break;case"wide":case"narrow":h=values[i];break;case"long":case"short":w=values[i];break;}}
var stroke=o.node.getElementsByTagName("stroke")[0];stroke[se+"arrow"]=type;stroke[se+"arrowlength"]=w;stroke[se+"arrowwidth"]=h;},setFillAndStroke=function(o,params){o.attrs=o.attrs||{};var node=o.node,a=o.attrs,s=node.style,xy,newpath=pathTypes[o.type]&&(params.x!=a.x||params.y!=a.y||params.width!=a.width||params.height!=a.height||params.cx!=a.cx||params.cy!=a.cy||params.rx!=a.rx||params.ry!=a.ry||params.r!=a.r),isOval=ovalTypes[o.type]&&(a.cx!=params.cx||a.cy!=params.cy||a.r!=params.r||a.rx!=params.rx||a.ry!=params.ry),res=o;for(var par in params)if(params[has](par)){a[par]=params[par];}
if(newpath){a.path=R._getPath[o.type](o);o._.dirty=1;}
params.href&&(node.href=params.href);params.title&&(node.title=params.title);params.target&&(node.target=params.target);params.cursor&&(s.cursor=params.cursor);"blur"in params&&o.blur(params.blur);if(params.path&&o.type=="path"||newpath){node.path=path2vml(~Str(a.path).toLowerCase().indexOf("r")?R._pathToAbsolute(a.path):a.path);if(o.type=="image"){o._.fillpos=[a.x,a.y];o._.fillsize=[a.width,a.height];setCoords(o,1,1,0,0,0);}}"transform"in params&&o.transform(params.transform);if(isOval){var cx=+a.cx,cy=+a.cy,rx=+a.rx||+a.r||0,ry=+a.ry||+a.r||0;node.path=R.format("ar{0},{1},{2},{3},{4},{1},{4},{1}x",round((cx-rx)*zoom),round((cy-ry)*zoom),round((cx+rx)*zoom),round((cy+ry)*zoom),round(cx*zoom));}
if("clip-rect"in params){var rect=Str(params["clip-rect"]).split(separator);if(rect.length==4){rect[2]=+rect[2]+(+rect[0]);rect[3]=+rect[3]+(+rect[1]);var div=node.clipRect||R._g.doc.createElement("div"),dstyle=div.style;dstyle.clip=R.format("rect({1}px {2}px {3}px {0}px)",rect);if(!node.clipRect){dstyle.position="absolute";dstyle.top=0;dstyle.left=0;dstyle.width=o.paper.width+"px";dstyle.height=o.paper.height+"px";node.parentNode.insertBefore(div,node);div.appendChild(node);node.clipRect=div;}}
if(!params["clip-rect"]){node.clipRect&&(node.clipRect.style.clip="auto");}}
if(o.textpath){var textpathStyle=o.textpath.style;params.font&&(textpathStyle.font=params.font);params["font-family"]&&(textpathStyle.fontFamily='"'+params["font-family"].split(",")[0].replace(/^['"]+|['"]+$/g,E)+'"');params["font-size"]&&(textpathStyle.fontSize=params["font-size"]);params["font-weight"]&&(textpathStyle.fontWeight=params["font-weight"]);params["font-style"]&&(textpathStyle.fontStyle=params["font-style"]);}
if("arrow-start"in params){addArrow(res,params["arrow-start"]);}
if("arrow-end"in params){addArrow(res,params["arrow-end"],1);}
if(params.opacity!=null||params["stroke-width"]!=null||params.fill!=null||params.src!=null||params.stroke!=null||params["stroke-width"]!=null||params["stroke-opacity"]!=null||params["fill-opacity"]!=null||params["stroke-dasharray"]!=null||params["stroke-miterlimit"]!=null||params["stroke-linejoin"]!=null||params["stroke-linecap"]!=null){var fill=node.getElementsByTagName(fillString),newfill=false;fill=fill&&fill[0];!fill&&(newfill=fill=createNode(fillString));if(o.type=="image"&&params.src){fill.src=params.src;}
params.fill&&(fill.on=true);if(fill.on==null||params.fill=="none"||params.fill===null){fill.on=false;}
if(fill.on&&params.fill){var isURL=Str(params.fill).match(R._ISURL);if(isURL){fill.parentNode==node&&node.removeChild(fill);fill.rotate=true;fill.src=isURL[1];fill.type="tile";var bbox=o.getBBox(1);fill.position=bbox.x+S+bbox.y;o._.fillpos=[bbox.x,bbox.y];R._preload(isURL[1],function(){o._.fillsize=[this.offsetWidth,this.offsetHeight];});}else{fill.color=R.getRGB(params.fill).hex;fill.src=E;fill.type="solid";if(R.getRGB(params.fill).error&&(res.type in{circle:1,ellipse:1}||Str(params.fill).charAt()!="r")&&addGradientFill(res,params.fill,fill)){a.fill="none";a.gradient=params.fill;fill.rotate=false;}}}
if("fill-opacity"in params||"opacity"in params){var opacity=((+a["fill-opacity"]+1||2)-1)*((+a.opacity+1||2)-1)*((+R.getRGB(params.fill).o+1||2)-1);opacity=mmin(mmax(opacity,0),1);fill.opacity=opacity;if(fill.src){fill.color="none";}}
node.appendChild(fill);var stroke=(node.getElementsByTagName("stroke")&&node.getElementsByTagName("stroke")[0]),newstroke=false;!stroke&&(newstroke=stroke=createNode("stroke"));if((params.stroke&&params.stroke!="none")||params["stroke-width"]||params["stroke-opacity"]!=null||params["stroke-dasharray"]||params["stroke-miterlimit"]||params["stroke-linejoin"]||params["stroke-linecap"]){stroke.on=true;}
(params.stroke=="none"||params.stroke===null||stroke.on==null||params.stroke==0||params["stroke-width"]==0)&&(stroke.on=false);var strokeColor=R.getRGB(params.stroke);stroke.on&&params.stroke&&(stroke.color=strokeColor.hex);opacity=((+a["stroke-opacity"]+1||2)-1)*((+a.opacity+1||2)-1)*((+strokeColor.o+1||2)-1);var width=(toFloat(params["stroke-width"])||1)*.75;opacity=mmin(mmax(opacity,0),1);params["stroke-width"]==null&&(width=a["stroke-width"]);params["stroke-width"]&&(stroke.weight=width);width&&width<1&&(opacity*=width)&&(stroke.weight=1);stroke.opacity=opacity;params["stroke-linejoin"]&&(stroke.joinstyle=params["stroke-linejoin"]||"miter");stroke.miterlimit=params["stroke-miterlimit"]||8;params["stroke-linecap"]&&(stroke.endcap=params["stroke-linecap"]=="butt"?"flat":params["stroke-linecap"]=="square"?"square":"round");if(params["stroke-dasharray"]){var dasharray={"-":"shortdash",".":"shortdot","-.":"shortdashdot","-..":"shortdashdotdot",". ":"dot","- ":"dash","--":"longdash","- .":"dashdot","--.":"longdashdot","--..":"longdashdotdot"};stroke.dashstyle=dasharray[has](params["stroke-dasharray"])?dasharray[params["stroke-dasharray"]]:E;}
newstroke&&node.appendChild(stroke);}
if(res.type=="text"){res.paper.canvas.style.display=E;var span=res.paper.span,m=100,fontSize=a.font&&a.font.match(/\d+(?:\.\d*)?(?=px)/);s=span.style;a.font&&(s.font=a.font);a["font-family"]&&(s.fontFamily=a["font-family"]);a["font-weight"]&&(s.fontWeight=a["font-weight"]);a["font-style"]&&(s.fontStyle=a["font-style"]);fontSize=toFloat(a["font-size"]||fontSize&&fontSize[0])||10;s.fontSize=fontSize*m+"px";res.textpath.string&&(span.innerHTML=Str(res.textpath.string).replace(/</g,"&#60;").replace(/&/g,"&#38;").replace(/\n/g,"<br>"));var brect=span.getBoundingClientRect();res.W=a.w=(brect.right-brect.left)/m;res.H=a.h=(brect.bottom-brect.top)/m;res.X=a.x;res.Y=a.y+res.H/2;("x"in params||"y"in params)&&(res.path.v=R.format("m{0},{1}l{2},{1}",round(a.x*zoom),round(a.y*zoom),round(a.x*zoom)+1));var dirtyattrs=["x","y","text","font","font-family","font-weight","font-style","font-size"];for(var d=0,dd=dirtyattrs.length;d<dd;d++)if(dirtyattrs[d]in params){res._.dirty=1;break;}
switch(a["text-anchor"]){case"start":res.textpath.style["v-text-align"]="left";res.bbx=res.W/2;break;case"end":res.textpath.style["v-text-align"]="right";res.bbx=-res.W/2;break;default:res.textpath.style["v-text-align"]="center";res.bbx=0;break;}
res.textpath.style["v-text-kern"]=true;}},addGradientFill=function(o,gradient,fill){o.attrs=o.attrs||{};var attrs=o.attrs,pow=Math.pow,opacity,oindex,type="linear",fxfy=".5 .5";o.attrs.gradient=gradient;gradient=Str(gradient).replace(R._radial_gradient,function(all,fx,fy){type="radial";if(fx&&fy){fx=toFloat(fx);fy=toFloat(fy);pow(fx-.5,2)+pow(fy-.5,2)>.25&&(fy=math.sqrt(.25-pow(fx-.5,2))*((fy>.5)*2-1)+.5);fxfy=fx+S+fy;}
return E;});gradient=gradient.split(/\s*\-\s*/);if(type=="linear"){var angle=gradient.shift();angle=-toFloat(angle);if(isNaN(angle)){return null;}}
var dots=R._parseDots(gradient);if(!dots){return null;}
o=o.shape||o.node;if(dots.length){o.removeChild(fill);fill.on=true;fill.method="none";fill.color=dots[0].color;fill.color2=dots[dots.length-1].color;var clrs=[];for(var i=0,ii=dots.length;i<ii;i++){dots[i].offset&&clrs.push(dots[i].offset+S+dots[i].color);}
fill.colors=clrs.length?clrs.join():"0% "+fill.color;if(type=="radial"){fill.type="gradientTitle";fill.focus="100%";fill.focussize="0 0";fill.focusposition=fxfy;fill.angle=0;}else{fill.type="gradient";fill.angle=(270-angle)%360;}
o.appendChild(fill);}
return 1;},Element=function(node,vml){this[0]=this.node=node;node.raphael=true;this.id=R._oid++;node.raphaelid=this.id;this.X=0;this.Y=0;this.attrs={};this.paper=vml;this.matrix=R.matrix();this._={transform:[],sx:1,sy:1,dx:0,dy:0,deg:0,dirty:1,dirtyT:1};!vml.bottom&&(vml.bottom=this);this.prev=vml.top;vml.top&&(vml.top.next=this);vml.top=this;this.next=null;};var elproto=R.el;Element.prototype=elproto;elproto.constructor=Element;elproto.transform=function(tstr){if(tstr==null){return this._.transform;}
var vbs=this.paper._viewBoxShift,vbt=vbs?"s"+[vbs.scale,vbs.scale]+"-1-1t"+[vbs.dx,vbs.dy]:E,oldt;if(vbs){oldt=tstr=Str(tstr).replace(/\.{3}|\u2026/g,this._.transform||E);}
R._extractTransform(this,vbt+tstr);var matrix=this.matrix.clone(),skew=this.skew,o=this.node,split,isGrad=~Str(this.attrs.fill).indexOf("-"),isPatt=!Str(this.attrs.fill).indexOf("url(");matrix.translate(-.5,-.5);if(isPatt||isGrad||this.type=="image"){skew.matrix="1 0 0 1";skew.offset="0 0";split=matrix.split();if((isGrad&&split.noRotation)||!split.isSimple){o.style.filter=matrix.toFilter();var bb=this.getBBox(),bbt=this.getBBox(1),dx=bb.x-bbt.x,dy=bb.y-bbt.y;o.coordorigin=(dx*-zoom)+S+(dy*-zoom);setCoords(this,1,1,dx,dy,0);}else{o.style.filter=E;setCoords(this,split.scalex,split.scaley,split.dx,split.dy,split.rotate);}}else{o.style.filter=E;skew.matrix=Str(matrix);skew.offset=matrix.offset();}
oldt&&(this._.transform=oldt);return this;};elproto.rotate=function(deg,cx,cy){if(this.removed){return this;}
if(deg==null){return;}
deg=Str(deg).split(separator);if(deg.length-1){cx=toFloat(deg[1]);cy=toFloat(deg[2]);}
deg=toFloat(deg[0]);(cy==null)&&(cx=cy);if(cx==null||cy==null){var bbox=this.getBBox(1);cx=bbox.x+bbox.width/2;cy=bbox.y+bbox.height/2;}
this._.dirtyT=1;this.transform(this._.transform.concat([["r",deg,cx,cy]]));return this;};elproto.translate=function(dx,dy){if(this.removed){return this;}
dx=Str(dx).split(separator);if(dx.length-1){dy=toFloat(dx[1]);}
dx=toFloat(dx[0])||0;dy=+dy||0;if(this._.bbox){this._.bbox.x+=dx;this._.bbox.y+=dy;}
this.transform(this._.transform.concat([["t",dx,dy]]));return this;};elproto.scale=function(sx,sy,cx,cy){if(this.removed){return this;}
sx=Str(sx).split(separator);if(sx.length-1){sy=toFloat(sx[1]);cx=toFloat(sx[2]);cy=toFloat(sx[3]);isNaN(cx)&&(cx=null);isNaN(cy)&&(cy=null);}
sx=toFloat(sx[0]);(sy==null)&&(sy=sx);(cy==null)&&(cx=cy);if(cx==null||cy==null){var bbox=this.getBBox(1);}
cx=cx==null?bbox.x+bbox.width/2:cx;cy=cy==null?bbox.y+bbox.height/2:cy;this.transform(this._.transform.concat([["s",sx,sy,cx,cy]]));this._.dirtyT=1;return this;};elproto.hide=function(){!this.removed&&(this.node.style.display="none");return this;};elproto.show=function(){!this.removed&&(this.node.style.display=E);return this;};elproto._getBBox=function(){if(this.removed){return{};}
return{x:this.X+(this.bbx||0)-this.W/2,y:this.Y-this.H,width:this.W,height:this.H};};elproto.remove=function(){if(this.removed){return;}
this.paper.__set__&&this.paper.__set__.exclude(this);R.eve.unbind("*.*."+this.id);R._tear(this,this.paper);this.node.parentNode.removeChild(this.node);this.shape&&this.shape.parentNode.removeChild(this.shape);for(var i in this){this[i]=typeof this[i]=="function"?R._removedFactory(i):null;}
this.removed=true;};elproto.attr=function(name,value){if(this.removed){return this;}
if(name==null){var res={};for(var a in this.attrs)if(this.attrs[has](a)){res[a]=this.attrs[a];}
res.gradient&&res.fill=="none"&&(res.fill=res.gradient)&&delete res.gradient;res.transform=this._.transform;return res;}
if(value==null&&R.is(name,"string")){if(name==fillString&&this.attrs.fill=="none"&&this.attrs.gradient){return this.attrs.gradient;}
var names=name.split(separator),out={};for(var i=0,ii=names.length;i<ii;i++){name=names[i];if(name in this.attrs){out[name]=this.attrs[name];}else if(R.is(this.paper.customAttributes[name],"function")){out[name]=this.paper.customAttributes[name].def;}else{out[name]=R._availableAttrs[name];}}
return ii-1?out:out[names[0]];}
if(this.attrs&&value==null&&R.is(name,"array")){out={};for(i=0,ii=name.length;i<ii;i++){out[name[i]]=this.attr(name[i]);}
return out;}
var params;if(value!=null){params={};params[name]=value;}
value==null&&R.is(name,"object")&&(params=name);for(var key in params){eve("attr."+key+"."+this.id,this,params[key]);}
if(params){for(key in this.paper.customAttributes)if(this.paper.customAttributes[has](key)&&params[has](key)&&R.is(this.paper.customAttributes[key],"function")){var par=this.paper.customAttributes[key].apply(this,[].concat(params[key]));this.attrs[key]=params[key];for(var subkey in par)if(par[has](subkey)){params[subkey]=par[subkey];}}
if(params.text&&this.type=="text"){this.textpath.string=params.text;}
setFillAndStroke(this,params);}
return this;};elproto.toFront=function(){!this.removed&&this.node.parentNode.appendChild(this.node);this.paper&&this.paper.top!=this&&R._tofront(this,this.paper);return this;};elproto.toBack=function(){if(this.removed){return this;}
if(this.node.parentNode.firstChild!=this.node){this.node.parentNode.insertBefore(this.node,this.node.parentNode.firstChild);R._toback(this,this.paper);}
return this;};elproto.insertAfter=function(element){if(this.removed){return this;}
if(element.constructor==R.st.constructor){element=element[element.length-1];}
if(element.node.nextSibling){element.node.parentNode.insertBefore(this.node,element.node.nextSibling);}else{element.node.parentNode.appendChild(this.node);}
R._insertafter(this,element,this.paper);return this;};elproto.insertBefore=function(element){if(this.removed){return this;}
if(element.constructor==R.st.constructor){element=element[0];}
element.node.parentNode.insertBefore(this.node,element.node);R._insertbefore(this,element,this.paper);return this;};elproto.blur=function(size){var s=this.node.runtimeStyle,f=s.filter;f=f.replace(blurregexp,E);if(+size!==0){this.attrs.blur=size;s.filter=f+S+ms+".Blur(pixelradius="+(+size||1.5)+")";s.margin=R.format("-{0}px 0 0 -{0}px",round(+size||1.5));}else{s.filter=f;s.margin=0;delete this.attrs.blur;}};R._engine.path=function(pathString,vml){var el=createNode("shape");el.style.cssText=cssDot;el.coordsize=zoom+S+zoom;el.coordorigin=vml.coordorigin;var p=new Element(el,vml),attr={fill:"none",stroke:"#000"};pathString&&(attr.path=pathString);p.type="path";p.path=[];p.Path=E;setFillAndStroke(p,attr);vml.canvas.appendChild(el);var skew=createNode("skew");skew.on=true;el.appendChild(skew);p.skew=skew;p.transform(E);return p;};R._engine.rect=function(vml,x,y,w,h,r){var path=R._rectPath(x,y,w,h,r),res=vml.path(path),a=res.attrs;res.X=a.x=x;res.Y=a.y=y;res.W=a.width=w;res.H=a.height=h;a.r=r;a.path=path;res.type="rect";return res;};R._engine.ellipse=function(vml,x,y,rx,ry){var res=vml.path(),a=res.attrs;res.X=x-rx;res.Y=y-ry;res.W=rx*2;res.H=ry*2;res.type="ellipse";setFillAndStroke(res,{cx:x,cy:y,rx:rx,ry:ry});return res;};R._engine.circle=function(vml,x,y,r){var res=vml.path(),a=res.attrs;res.X=x-r;res.Y=y-r;res.W=res.H=r*2;res.type="circle";setFillAndStroke(res,{cx:x,cy:y,r:r});return res;};R._engine.image=function(vml,src,x,y,w,h){var path=R._rectPath(x,y,w,h),res=vml.path(path).attr({stroke:"none"}),a=res.attrs,node=res.node,fill=node.getElementsByTagName(fillString)[0];a.src=src;res.X=a.x=x;res.Y=a.y=y;res.W=a.width=w;res.H=a.height=h;a.path=path;res.type="image";fill.parentNode==node&&node.removeChild(fill);fill.rotate=true;fill.src=src;fill.type="tile";res._.fillpos=[x,y];res._.fillsize=[w,h];node.appendChild(fill);setCoords(res,1,1,0,0,0);return res;};R._engine.text=function(vml,x,y,text){var el=createNode("shape"),path=createNode("path"),o=createNode("textpath");x=x||0;y=y||0;text=text||"";path.v=R.format("m{0},{1}l{2},{1}",round(x*zoom),round(y*zoom),round(x*zoom)+1);path.textpathok=true;o.string=Str(text);o.on=true;el.style.cssText=cssDot;el.coordsize=zoom+S+zoom;el.coordorigin="0 0";var p=new Element(el,vml),attr={fill:"#000",stroke:"none",font:R._availableAttrs.font,text:text};p.shape=el;p.path=path;p.textpath=o;p.type="text";p.attrs.text=Str(text);p.attrs.x=x;p.attrs.y=y;p.attrs.w=1;p.attrs.h=1;setFillAndStroke(p,attr);el.appendChild(o);el.appendChild(path);vml.canvas.appendChild(el);var skew=createNode("skew");skew.on=true;el.appendChild(skew);p.skew=skew;p.transform(E);return p;};R._engine.setSize=function(width,height){var cs=this.canvas.style;this.width=width;this.height=height;width==+width&&(width+="px");height==+height&&(height+="px");cs.width=width;cs.height=height;cs.clip="rect(0 "+width+" "+height+" 0)";if(this._viewBox){R._engine.setViewBox.apply(this,this._viewBox);}
return this;};R._engine.setViewBox=function(x,y,w,h,fit){R.eve("setViewBox",this,this._viewBox,[x,y,w,h,fit]);var width=this.width,height=this.height,size=1/mmax(w/width,h/height),H,W;if(fit){H=height/h;W=width/w;if(w*H<width){x-=(width-w*H)/2/H;}
if(h*W<height){y-=(height-h*W)/2/W;}}
this._viewBox=[x,y,w,h,!!fit];this._viewBoxShift={dx:-x,dy:-y,scale:size};this.forEach(function(el){el.transform("...");});return this;};var createNode;R._engine.initWin=function(win){var doc=win.document;doc.createStyleSheet().addRule(".rvml","behavior:url(#default#VML)");try{!doc.namespaces.rvml&&doc.namespaces.add("rvml","urn:schemas-microsoft-com:vml");createNode=function(tagName){return doc.createElement('<rvml:'+tagName+' class="rvml">');};}catch(e){createNode=function(tagName){return doc.createElement('<'+tagName+' xmlns="urn:schemas-microsoft.com:vml" class="rvml">');};}};R._engine.initWin(R._g.win);R._engine.create=function(){var con=R._getContainer.apply(0,arguments),container=con.container,height=con.height,s,width=con.width,x=con.x,y=con.y;if(!container){throw new Error("VML container not found.");}
var res=new R._Paper,c=res.canvas=R._g.doc.createElement("div"),cs=c.style;x=x||0;y=y||0;width=width||512;height=height||342;res.width=width;res.height=height;width==+width&&(width+="px");height==+height&&(height+="px");res.coordsize=zoom*1e3+S+zoom*1e3;res.coordorigin="0 0";res.span=R._g.doc.createElement("span");res.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;";c.appendChild(res.span);cs.cssText=R.format("top:0;left:0;width:{0};height:{1};display:inline-block;position:relative;clip:rect(0 {0} {1} 0);overflow:hidden",width,height);if(container==1){R._g.doc.body.appendChild(c);cs.left=x+"px";cs.top=y+"px";cs.position="absolute";}else{if(container.firstChild){container.insertBefore(c,container.firstChild);}else{container.appendChild(c);}}
res.renderfix=function(){};return res;};R.prototype.clear=function(){R.eve("clear",this);this.canvas.innerHTML=E;this.span=R._g.doc.createElement("span");this.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;display:inline;";this.canvas.appendChild(this.span);this.bottom=this.top=null;};R.prototype.remove=function(){R.eve("remove",this);this.canvas.parentNode.removeChild(this.canvas);for(var i in this){this[i]=typeof this[i]=="function"?R._removedFactory(i):null;}
return true;};var setproto=R.st;for(var method in elproto)if(elproto[has](method)&&!setproto[has](method)){setproto[method]=(function(methodname){return function(){var arg=arguments;return this.forEach(function(el){el[methodname].apply(el,arg);});};})(method);}}(window.Raphael);;

/* /web_diagram/static/src/js/vec2.js defined in bundle 'web.assets_backend' */
(function(window){function Vec2(x,y){this.x=x;this.y=y;}
window.Vec2=Vec2;var rad2deg=57.29577951308232;var deg2rad=0.017453292519943295;var epsilon=0.0000001;Vec2.new_polar_deg=function(len,angle){var v=new Vec2(len,0);return v.rotate_deg(angle);};Vec2.new_polar=function(len,angle){var v=new Vec2(len,0);v.rotate(angle);return v;};Vec2.prototype.len=function(){return Math.sqrt(this.x*this.x+this.y*this.y);};Vec2.prototype.len_sq=function(){return this.x*this.x+this.y*this.y;};Vec2.prototype.dist=function(v){var dx=this.x-v.x;var dy=this.y-v.y;return Math.sqrt(dx*dx+dy*dy);};Vec2.prototype.dist_xy=function(x,y){var dx=this.x-x;var dy=this.y-y;return Math.sqrt(dx*dx+dy*dy);};Vec2.prototype.dist_sq=function(v){var dx=this.x-v.x;var dy=this.y-v.y;return dx*dx+dy*dy;};Vec2.prototype.dist_sq_xy=function(x,y){var dx=this.x-x;var dy=this.y-y;return dx*dx+dy*dy;};Vec2.prototype.dot=function(v){return this.x*v.x+this.y*v.y;};Vec2.prototype.dot_xy=function(x,y){return this.x*x+this.y*y;};Vec2.prototype.clone=function(){return new Vec2(this.x,this.y);};Vec2.prototype.add=function(v){return new Vec2(this.x+v.x,this.y+v.y);};Vec2.prototype.add_xy=function(x,y){return new Vec2(this.x+x,this.y+y);};Vec2.prototype.sub=function(v){return new Vec2(this.x-v.x,this.y-v.y);};Vec2.prototype.sub_xy=function(x,y){return new Vec2(this.x-x,this.y-y);};Vec2.prototype.mult=function(v){return new Vec2(this.x*v.x,this.y*v.y);};Vec2.prototype.mult_xy=function(x,y){return new Vec2(this.x*x,this.y*y);};Vec2.prototype.scale=function(f){return new Vec2(this.x*f,this.y*f);};Vec2.prototype.neg=function(f){return new Vec2(-this.x,-this.y);};Vec2.prototype.normalize=function(){var len=this.len();if(len==0){return new Vec2(0,1);}else if(len!=1){return this.scale(1.0/len);}
return new Vec2(this.x,this.y);};Vec2.prototype.set_len=function(l){return this.normalize().scale(l);};Vec2.prototype.project=function(v){return v.set_len(this.dot(v));};Vec2.prototype.toString=function(){var str="";str+="[";str+=this.x;str+=",";str+=this.y;str+="]";return str;};Vec2.prototype.rotate=function(rad){var c=Math.cos(rad);var s=Math.sin(rad);var px=this.x*c-this.y*s;var py=this.x*s+this.y*c;return new Vec2(px,py);};Vec2.prototype.rotate_deg=function(deg){return this.rotate(deg*deg2rad);};Vec2.prototype.lerp=function(v,alpha){var inv_alpha=1-alpha;return new Vec2(this.x*inv_alpha+v.x*alpha,this.y*inv_alpha+v.y*alpha);};Vec2.prototype.angle=function(){return Math.atan2(this.y,this.x);};Vec2.prototype.angle_deg=function(){return Math.atan2(this.y,this.x)*rad2deg;};Vec2.prototype.equals=function(v){if(Math.abs(this.x-v.x)>epsilon){return false;}else if(Math.abs(this.y-v.y)>epsilon){return false;}
return true;};Vec2.prototype.equals_xy=function(x,y){if(Math.abs(this.x-x)>epsilon){return false;}else if(Math.abs(this.y-y)>epsilon){return false;}
return true;};})(window);(function(window){function BEllipse(cx,cy,rx,ry){this.type='ellipse';this.x=cx-rx;this.y=cy-ry;this.sx=2*rx;this.sy=2*ry;this.hx=rx;this.hy=ry;this.cx=cx;this.cy=cy;this.mx=cx+rx;this.my=cy+ry;}
window.BEllipse=BEllipse;BEllipse.prototype.collide_segment=function(a,b){var collisions=[];if(a.equals(b)){return collisions;}
var c=new Vec2(this.cx,this.cy);a=a.sub(c).mult_xy(1/this.hx,1/this.hy);b=b.sub(c).mult_xy(1/this.hx,1/this.hy);if(a.len_sq()<1&&b.len_sq()<1){return collisions;}
var ab=b.sub(a);var A=(ab.x*ab.x+ab.y*ab.y);var B=2*(ab.x*a.x+ab.y*a.y);var C=a.x*a.x+a.y*a.y-1;var u=B*B-4*A*C;if(u<0){return collisions;}
u=Math.sqrt(u);var u1=(-B+u)/(2*A);var u2=(-B-u)/(2*A);if(u1>=0&&u1<=1){var pos=a.add(ab.scale(u1));collisions.push(pos);}
if(u1!=u2&&u2>=0&&u2<=1){var pos=a.add(ab.scale(u2));collisions.push(pos);}
for(var i=0;i<collisions.length;i++){collisions[i]=collisions[i].mult_xy(this.hx,this.hy);collisions[i]=collisions[i].add_xy(this.cx,this.cy);}
return collisions;};function BRect(x,y,sx,sy){this.type='rect';this.x=x;this.y=y;this.sx=sx;this.sy=sy;this.hx=sx/2;this.hy=sy/2;this.cx=x+this.hx;this.cy=y+this.hy;this.mx=x+sx;this.my=y+sy;}
window.BRect=BRect;BRect.new_centered=function(cx,cy,sx,sy){return new BRect(cx-sx/2,cy-sy/2,sx,sy);};function line_intersect(a,b,c,d){var f=((d.y-c.y)*(b.x-a.x)-(d.x-c.x)*(b.y-a.y));if(f==0){return null;}
f=1/f;var fab=((d.x-c.x)*(a.y-c.y)-(d.y-c.y)*(a.x-c.x))*f;if(fab<0||fab>1){return null;}
var fcd=((b.x-a.x)*(a.y-c.y)-(b.y-a.y)*(a.x-c.x))*f;if(fcd<0||fcd>1){return null;}
return new Vec2(a.x+fab*(b.x-a.x),a.y+fab*(b.y-a.y));}
BRect.prototype.collide_segment=function(a,b){var collisions=[];var corners=[new Vec2(this.x,this.y),new Vec2(this.x,this.my),new Vec2(this.mx,this.my),new Vec2(this.mx,this.y)];var pos=line_intersect(a,b,corners[0],corners[1]);if(pos)collisions.push(pos);pos=line_intersect(a,b,corners[1],corners[2]);if(pos)collisions.push(pos);pos=line_intersect(a,b,corners[2],corners[3]);if(pos)collisions.push(pos);pos=line_intersect(a,b,corners[3],corners[0]);if(pos)collisions.push(pos);return collisions;};BRect.prototype.contains_vec=function(vec){return(vec.x>=this.x&&vec.x<=this.mx&&vec.y>=this.y&&vec.y<=this.my);};BRect.prototype.contains_xy=function(x,y){return(x>=this.x&&x<=this.mx&&y>=this.y&&y<=this.my);};BEllipse.prototype.contains_vec=function(v){v=v.mult_xy(this.hx,this.hy);return v.len_sq()<=1;};BEllipse.prototype.contains_xy=function(x,y){return this.contains(new Vec2(x,y));};})(window);;

/* /web_diagram/static/src/js/graph.js defined in bundle 'web.assets_backend' */
(function(window){function EdgeEnd(pos_x,pos_y){this.x=pos_x;this.y=pos_y;this.get_pos=function(){return new Vec2(this.x,this.y);}}
function CloseButton(graph,entity,entity_type,pos_x,pos_y){var self=this;var visible=false;var close_button_radius=graph.style.close_button_radius||8;var close_circle=graph.r.circle(entity.get_pos().x+pos_x,entity.get_pos().y+pos_y,close_button_radius);close_circle.attr({'opacity':0,'fill':graph.style.close_button_color||"black",'cursor':'pointer','stroke':'none'});close_circle.transform(graph.get_transform());graph.set_scrolling(close_circle);var close_label=graph.r.text(entity.get_pos().x+pos_x,entity.get_pos().y+pos_y,"x");close_label.attr({'fill':graph.style.close_button_x_color||"white",'font-size':close_button_radius,'cursor':'pointer'});close_label.transform(graph.get_transform());graph.set_scrolling(close_label);var dummy_circle=graph.r.circle(entity.get_pos().x+pos_x,entity.get_pos().y+pos_y,close_button_radius);dummy_circle.attr({'opacity':1,'fill':'transparent','stroke':'none','cursor':'pointer'});dummy_circle.transform(graph.get_transform());graph.set_scrolling(dummy_circle);this.get_pos=function(){return entity.get_pos().add_xy(pos_x,pos_y);};this.update_pos=function(){var pos=self.get_pos();close_circle.attr({'cx':pos.x,'cy':pos.y});dummy_circle.attr({'cx':pos.x,'cy':pos.y});close_label.attr({'x':pos.x,'y':pos.y});};function hover_in(){if(!visible){return;}
close_circle.animate({'r':close_button_radius*1.5},300,'elastic');dummy_circle.animate({'r':close_button_radius*1.5},300,'elastic');}
function hover_out(){if(!visible){return;}
close_circle.animate({'r':close_button_radius},400,'linear');dummy_circle.animate({'r':close_button_radius},400,'linear');}
dummy_circle.hover(hover_in,hover_out);close_circle.hover(hover_in,hover_out);close_label.hover(hover_in,hover_out);function click_action(){if(!visible){return;}
close_circle.attr({'r':close_button_radius*2});dummy_circle.attr({'r':close_button_radius*2});close_circle.animate({'r':close_button_radius},400,'linear');dummy_circle.animate({'r':close_button_radius},400,'linear');if(entity_type=="node"){$.when(GraphNode.destruction_callback(entity)).done(function(){entity.remove();});}else if(entity_type=="edge"){$.when(GraphEdge.destruction_callback(entity)).done(function(){entity.remove();});}}
dummy_circle.click(click_action);close_circle.click(click_action);close_label.click(click_action);this.show=function(){if(!visible){close_circle.animate({'opacity':1},100,'linear');close_label.animate({'opacity':1},100,'linear');visible=true;}}
this.hide=function(){if(visible){close_circle.animate({'opacity':0},100,'linear');close_label.animate({'opacity':0},100,'linear');visible=false;}}
this.remove=function(){if(visible){visible=false;close_circle.animate({'opacity':0},100,'linear');close_label.animate({'opacity':0},100,'linear',self.remove);}else{close_circle.remove();close_label.remove();dummy_circle.remove();}}}
function Connector(graph,node,pos_x,pos_y){var visible=false;var conn_circle=graph.r.circle(node.get_pos().x+pos_x,node.get_pos().y+pos_y,4);conn_circle.attr({'opacity':0,'fill':graph.style.node_outline_color,'stroke':'none'});conn_circle.transform(graph.get_transform());graph.set_scrolling(conn_circle);var self=this;this.update_pos=function(){conn_circle.attr({'cx':node.get_pos().x+pos_x,'cy':node.get_pos().y+pos_y});};this.get_pos=function(){return new node.get_pos().add_xy(pos_x,pos_y);};this.remove=function(){conn_circle.remove();}
function hover_in(){if(!visible){return;}
conn_circle.animate({'r':8},300,'elastic');if(graph.creating_edge){graph.target_node=node;conn_circle.animate({'fill':graph.style.connector_active_color,'stroke':graph.style.node_outline_color,'stroke-width':graph.style.node_selected_width,},100,'linear');}}
function hover_out(){if(!visible){return;}
conn_circle.animate({'r':graph.style.connector_radius,'fill':graph.style.node_outline_color,'stroke':'none'},400,'linear');graph.target_node=null;}
conn_circle.hover(hover_in,hover_out);var drag_down=function(){if(!visible){return;}
self.ox=conn_circle.attr("cx");self.oy=conn_circle.attr("cy");self.edge_start=new EdgeEnd(self.ox,self.oy);self.edge_end=new EdgeEnd(self.ox,self.oy);self.edge_tmp=new GraphEdge(graph,'',self.edge_start,self.edge_end,true);graph.creating_edge=true;};var drag_move=function(dx,dy){if(!visible){return;}
self.edge_end.x=self.ox+dx;self.edge_end.y=self.oy+dy;self.edge_tmp.update();};var drag_up=function(){if(!visible){return;}
graph.creating_edge=false;self.edge_tmp.remove();if(graph.target_node){var edge_prop=GraphEdge.creation_callback(node,graph.target_node);if(edge_prop){var new_edge=new GraphEdge(graph,edge_prop.label,node,graph.target_node);GraphEdge.new_edge_callback(new_edge);}}};conn_circle.drag(drag_move,drag_down,drag_up);function show(){if(!visible){conn_circle.animate({'opacity':1},100,'linear');visible=true;}}
function hide(){if(visible){conn_circle.animate({'opacity':0},100,'linear');visible=false;}}
this.show=show;this.hide=hide;}
function Graph(r,style,viewport){var self=this;var nodes=[];var edges=[];var graph={};var links={};var uid=1;var selected_entity=null;self.creating_edge=false;self.target_node=null;self.r=r;self.style=style;var tr_x=0,tr_y=0;var background=r.rect(0,0,'100%','100%').attr({'fill':'white','stroke':'none','opacity':0,'cursor':'move'});this.get_transform=function(){return"T"+tr_x+","+tr_y};var translate_all=function(dx,dy){tr_x+=dx;tr_y+=dy;var tstr=self.get_transform();r.forEach(function(el){if(el!=background){el.transform(tstr);}});};var get_bounds=function(){var minx=Number.MAX_VALUE;var miny=Number.MAX_VALUE;var maxx=Number.MIN_VALUE;var maxy=Number.MIN_VALUE;for(var i=0;i<nodes.length;i++){var pos=nodes[i].get_pos();minx=Math.min(minx,pos.x);miny=Math.min(miny,pos.y);maxx=Math.max(maxx,pos.x);maxy=Math.max(maxy,pos.y);}
minx=minx-style.node_size_x/2+tr_x;miny=miny-style.node_size_y/2+tr_y;maxx=maxx+style.node_size_x/2+tr_x;maxy=maxy+style.node_size_y/2+tr_y;return{minx:minx,miny:miny,maxx:maxx,maxy:maxy};};var translation_respects_viewport=function(dx,dy,margin){if(!viewport){return true;}
margin=margin||0;var b=get_bounds();var width=viewport.offsetWidth;var height=viewport.offsetHeight;if((dy<0&&b.maxy+dy<margin)||(dy>0&&b.miny+dy>height-margin)||(dx<0&&b.maxx+dx<margin)||(dx>0&&b.minx+dx>width-margin)){return false;}
return true;}
this.set_scrolling=function(raph_element){$(raph_element.node).bind('mousewheel',function(event,delta){var dy=delta*20;if(translation_respects_viewport(0,dy,style.viewport_margin)){translate_all(0,dy);}});};var px,py;var bg_drag_down=function(){px=py=0;};var bg_drag_move=function(x,y){var dx=x-px;var dy=y-py;px=x;py=y;if(translation_respects_viewport(dx,dy,style.viewport_margin)){translate_all(dx,dy);}};var bg_drag_up=function(){};background.drag(bg_drag_move,bg_drag_down,bg_drag_up);this.set_scrolling(background);this.add_node=function(n){nodes.push(n);n.uid=uid++;};this.get_node_list=function(){return nodes;};this.add_edge=function(n1,n2,e){edges.push(e);e.uid=uid++;if(!graph[n1.uid])graph[n1.uid]={};if(!graph[n1.uid][n2.uid])graph[n1.uid][n2.uid]=[];if(!links[n1.uid])links[n1.uid]=[];if(!links[n2.uid])links[n2.uid]=[];graph[n1.uid][n2.uid].push(e);links[n1.uid].push(e);if(n1!=n2){links[n2.uid].push(e);}};this.remove_edge=function(edge){edges=_.without(edges,edge);var n1=edge.get_start();var n2=edge.get_end();links[n1.uid]=_.without(links[n1.uid],edge);links[n2.uid]=_.without(links[n2.uid],edge);graph[n1.uid][n2.uid]=_.without(graph[n1.uid][n2.uid],edge);if(selected_entity==edge){selected_entity=null;}};this.remove_node=function(node){var linked_edges=self.get_linked_edge_list(node);for(var i=0;i<linked_edges.length;i++){linked_edges[i].remove();}
nodes=_.without(nodes,node);if(selected_entity==node){selected_entity=null;}}
this.get_edge_list=function(n1,n2){var list=[];if(!graph[n1.uid])return list;if(!graph[n1.uid][n2.uid])return list;return graph[n1.uid][n2.uid];};this.get_linked_edge_list=function(n){if(!links[n.uid])return[];return links[n.uid];};this.get_edge_curvature=function(n1,n2,e){var el_12=this.get_edge_list(n1,n2);var c12=el_12.length;var el_21=this.get_edge_list(n2,n1);var c21=el_21.length;if(c12+c21==1){return 0;}else{var index=0;for(var i=0;i<c12;i++){if(el_12[i].uid<e.uid){index++;}}
if(c21==0){return index-(c12-1)/2.0;}else{return index+0.5;}}};this.get_loop_angle=function(n,e){var loop_list=this.get_edge_list(n,n);var slots=[];for(var angle=0;angle<360;angle+=45){slots.push(Vec2.new_polar_deg(1,angle));}
var links=this.get_linked_edge_list(n);for(var i=0;i<links.length;i++){var edge=links[i];if(!edge.is_loop||edge.is_loop()){continue;}
var end=edge.get_end();if(end==n){end=edge.get_start();}
var dir=end.get_pos().sub(n.get_pos()).normalize();for(var s=0;s<slots.length;s++){var score=slots[s].dot(dir);if(score<0){score=-0.2*Math.pow(score,2);}else{score=Math.pow(score,2);}
if(!slots[s].score){slots[s].score=score;}else{slots[s].score+=score;}}}
slots.sort(function(a,b){return a.score<b.score?-1:1;});var index=0;for(var i=0;i<links.length;i++){var edge=links[i];if(!edge.is_loop||!edge.is_loop()){continue;}
if(edge.uid<e.uid){index++;}}
index%=slots.length;return slots[index].angle_deg();}
this.select=function(entity){if(selected_entity){if(selected_entity==entity){return;}else{if(selected_entity.set_not_selected){selected_entity.set_not_selected();}
selected_entity=null;}}
selected_entity=entity;if(entity&&entity.set_selected){entity.set_selected();}};}
function GraphNode(graph,pos_x,pos_y,label,type,color){var self=this;var r=graph.r;var sy=graph.style.node_size_y;var sx=graph.style.node_size_x;var node_fig=null;var selected=false;this.connectors=[];this.close_button=null;this.uid=0;graph.add_node(this);if(type=='circle'){node_fig=r.ellipse(pos_x,pos_y,sx/2,sy/2);}else{node_fig=r.rect(pos_x-sx/2,pos_y-sy/2,sx,sy);}
node_fig.attr({'fill':color,'stroke':graph.style.node_outline_color,'stroke-width':graph.style.node_outline_width,'cursor':'pointer'});node_fig.transform(graph.get_transform());graph.set_scrolling(node_fig);var node_label=r.text(pos_x,pos_y,label);node_label.attr({'fill':graph.style.node_label_color,'font-size':graph.style.node_label_font_size,'cursor':'pointer'});node_label.transform(graph.get_transform());graph.set_scrolling(node_label);var update_linked_edges=function(){var edges=graph.get_linked_edge_list(self);for(var i=0;i<edges.length;i++){edges[i].update();}};var set_pos=function(pos){if(type=='circle'){node_fig.attr({'cx':pos.x,'cy':pos.y});}else{node_fig.attr({'x':pos.x-sx/2,'y':pos.y-sy/2});}
node_label.attr({'x':pos.x,'y':pos.y});for(var i=0;i<self.connectors.length;i++){self.connectors[i].update_pos();}
if(self.close_button){self.close_button.update_pos();}
update_linked_edges();};var get_fig=function(){return node_fig;};var get_pos=function(){if(type=='circle'){return new Vec2(node_fig.attr('cx'),node_fig.attr('cy'));}else{return new Vec2(node_fig.attr('x')+sx/2,node_fig.attr('y')+sy/2);}};var get_label=function(){return node_label.attr("text");};var set_label=function(text){node_label.attr({'text':text});};var get_bound=function(){if(type=='circle'){return new BEllipse(get_pos().x,get_pos().y,sx/2,sy/2);}else{return BRect.new_centered(get_pos().x,get_pos().y,sx,sy);}};var set_selected=function(){if(!selected){selected=true;node_fig.attr({'stroke':graph.style.node_selected_color,'stroke-width':graph.style.node_selected_width});if(!self.close_button){self.close_button=new CloseButton(graph,self,"node",sx/2,-sy/2);self.close_button.show();}
for(var i=0;i<self.connectors.length;i++){self.connectors[i].show();}}};var set_not_selected=function(){if(selected){node_fig.animate({'stroke':graph.style.node_outline_color,'stroke-width':graph.style.node_outline_width},100,'linear');if(self.close_button){self.close_button.remove();self.close_button=null;}
selected=false;}
for(var i=0;i<self.connectors.length;i++){self.connectors[i].hide();}};var remove=function(){if(self.close_button){self.close_button.remove();}
for(var i=0;i<self.connectors.length;i++){self.connectors[i].remove();}
graph.remove_node(self);node_fig.remove();node_label.remove();}
this.set_pos=set_pos;this.get_pos=get_pos;this.set_label=set_label;this.get_label=get_label;this.get_bound=get_bound;this.get_fig=get_fig;this.set_selected=set_selected;this.set_not_selected=set_not_selected;this.update_linked_edges=update_linked_edges;this.remove=remove;var click_action=function(){if(type=='circle'){node_fig.attr({'rx':sx/2+3,'ry':sy/2+3});node_fig.animate({'rx':sx/2,'ry':sy/2},500,'elastic');}else{var cx=get_pos().x;var cy=get_pos().y;node_fig.attr({'x':cx-(sx/2)-3,'y':cy-(sy/2)-3,'ẃidth':sx+6,'height':sy+6});node_fig.animate({'x':cx-sx/2,'y':cy-sy/2,'ẃidth':sx,'height':sy},500,'elastic');}
graph.select(self);};node_fig.click(click_action);node_label.click(click_action);var drag_down=function(){this.opos=get_pos();};var drag_move=function(dx,dy){var edges=graph.get_linked_edge_list(self);for(var i=0;i<edges.length;i++){edges[i].label_disable();}
if(self.close_button){self.close_button.hide();}
set_pos(this.opos.add_xy(dx,dy));};var drag_up=function(){var edges=graph.get_linked_edge_list(self);for(var i=0;i<edges.length;i++){edges[i].label_enable();}
if(self.close_button){self.close_button.show();}};node_fig.drag(drag_move,drag_down,drag_up);node_label.drag(drag_move,drag_down,drag_up);function hover_in(){if(graph.creating_edge){graph.target_node=self;}}
function hover_out(){graph.target_node=null;}
node_fig.hover(hover_in,hover_out);node_label.hover(hover_in,hover_out);function double_click(){GraphNode.double_click_callback(self);}
node_fig.dblclick(double_click);node_label.dblclick(double_click);this.connectors.push(new Connector(graph,this,-sx/2,0));this.connectors.push(new Connector(graph,this,sx/2,0));this.connectors.push(new Connector(graph,this,0,-sy/2));this.connectors.push(new Connector(graph,this,0,sy/2));this.close_button=new CloseButton(graph,this,"node",sx/2,-sy/2);}
GraphNode.double_click_callback=function(node){console.log("double click from node:",node);};GraphNode.destruction_callback=function(node){return true;};function GraphEdge(graph,label,start,end,tmp,color){var self=this;var r=graph.r;var curvature=0;var s,e;var mc;var mc1,mc2;var elfs=graph.style.edge_label_font_size||10;var label_enabled=true;this.uid=0;var edge_path="";var selected=false;if(!tmp){graph.add_edge(start,end,this);}
function get_label_pos(path){var cpos=path.getTotalLength()*0.5;var cindex=Math.abs(Math.floor(curvature));var mod=((cindex%3))*(elfs*3.1)-(elfs*0.5);var verticality=Math.abs(end.get_pos().sub(start.get_pos()).normalize().dot_xy(0,1));verticality=Math.max(verticality-0.5,0)*2;var lpos=path.getPointAtLength(cpos+mod*verticality);return new Vec2(lpos.x,lpos.y-elfs*(1-verticality));}
this.get_pos=function(){if(!edge){return start.get_pos().lerp(end.get_pos(),0.5);}
return get_label_pos(edge);}
function make_line(){return"M"+s.x+","+s.y+"L"+e.x+","+e.y;}
function make_curve(){return"M"+s.x+","+s.y+"Q"+mc.x+","+mc.y+" "+e.x+","+e.y;}
function make_loop(){return"M"+s.x+" "+s.y+"C"+mc1.x+" "+mc1.y+" "+mc2.x+" "+mc2.y+" "+e.x+" "+e.y;}
function update_curve(){if(start!=end){if(!tmp){curvature=graph.get_edge_curvature(start,end,self);}else{curvature=0;}
s=start.get_pos();e=end.get_pos();mc=s.lerp(e,0.5);var se=e.sub(s);se=se.normalize();se=se.rotate_deg(-90);se=se.scale(curvature*graph.style.edge_spacing);mc=mc.add(se);if(start.get_bound){var col=start.get_bound().collide_segment(s,mc);if(col.length>0){s=col[0];}}
if(end.get_bound){var col=end.get_bound().collide_segment(mc,e);if(col.length>0){e=col[0];}}
if(curvature!=0){edge_path=make_curve();}else{edge_path=make_line();}}else{var rad=graph.style.edge_loop_radius||100;s=start.get_pos();e=end.get_pos();var r=Vec2.new_polar_deg(rad,graph.get_loop_angle(start,self));mc=s.add(r);var p=r.rotate_deg(90);mc1=mc.add(p.set_len(rad*0.5));mc2=mc.add(p.set_len(-rad*0.5));if(start.get_bound){var col=start.get_bound().collide_segment(s,mc1);if(col.length>0){s=col[0];}
var col=start.get_bound().collide_segment(e,mc2);if(col.length>0){e=col[0];}}
edge_path=make_loop();}}
update_curve();var edge=r.path(edge_path).attr({'stroke':color||graph.style.edge_color,'stroke-width':graph.style.edge_width,'arrow-end':'block-wide-long','cursor':'pointer'}).insertBefore(graph.get_node_list()[0].get_fig());var labelpos=get_label_pos(edge);var edge_label=r.text(labelpos.x,labelpos.y-elfs,label).attr({'fill':graph.style.edge_label_color,'cursor':'pointer','font-size':elfs});edge.transform(graph.get_transform());graph.set_scrolling(edge);edge_label.transform(graph.get_transform());graph.set_scrolling(edge_label);if(!tmp){var edges_start=graph.get_linked_edge_list(start);var edges_end=graph.get_linked_edge_list(end);var edges=edges_start.length<edges_end.length?edges_start:edges_end;for(var i=0;i<edges.length;i++){if(edges[i]!=self){edges[i].update();}}}
function label_enable(){if(!label_enabled){label_enabled=true;edge_label.animate({'opacity':1},100,'linear');if(self.close_button){self.close_button.show();}
self.update();}}
function label_disable(){if(label_enabled){label_enabled=false;edge_label.animate({'opacity':0},100,'linear');if(self.close_button){self.close_button.hide();}}}
function update(){update_curve();edge.attr({'path':edge_path});if(label_enabled){var labelpos=get_label_pos(edge);edge_label.attr({'x':labelpos.x,'y':labelpos.y-14});}}
function remove(){edge.remove();edge_label.remove();if(!tmp){graph.remove_edge(self);}
if(start.update_linked_edges){start.update_linked_edges();}
if(start!=end&&end.update_linked_edges){end.update_linked_edges();}
if(self.close_button){self.close_button.remove();}}
this.set_selected=function(){if(!selected){selected=true;edge.attrs.old_stroke=edge.attrs.stroke;edge.attr({'stroke':graph.style.node_selected_color,'stroke-width':graph.style.node_selected_width});edge_label.attr({'fill':graph.style.node_selected_color});if(!self.close_button){self.close_button=new CloseButton(graph,self,"edge",0,30);self.close_button.show();}}};this.set_not_selected=function(){if(selected){selected=false;edge.animate({'stroke':edge.attrs.old_stroke||graph.style.edge_color,'stroke-width':graph.style.edge_width},100,'linear');edge_label.animate({'fill':graph.style.edge_label_color},100,'linear');if(self.close_button){self.close_button.remove();self.close_button=null;}}};function click_action(){graph.select(self);}
edge.click(click_action);edge_label.click(click_action);function double_click_action(){GraphEdge.double_click_callback(self);}
edge.dblclick(double_click_action);edge_label.dblclick(double_click_action);this.label_enable=label_enable;this.label_disable=label_disable;this.update=update;this.remove=remove;this.is_loop=function(){return start==end;};this.get_start=function(){return start;};this.get_end=function(){return end;};}
GraphEdge.double_click_callback=function(edge){console.log("double click from edge:",edge);};GraphEdge.creation_callback=function(start,end){var edge_prop={};edge_prop.label='new edge!';return edge_prop;};GraphEdge.new_edge_callback=function(new_edge){};GraphEdge.destruction_callback=function(edge){return true;};function wordwrap(str,width){width=width||32;var cut=true;var brk='\n';if(!str){return str;}
var regex='.{1,'+width+'}(\\s|$)'+(cut?'|.{'+width+'}|.+$':'|\\S+?(\\s|$)');return str.match(new RegExp(regex,'g')).join(brk);}
window.CuteGraph=Graph;window.CuteNode=GraphNode;window.CuteEdge=GraphEdge;window.CuteGraph.wordwrap=wordwrap;})(window);;

/* /web_diagram/static/src/js/diagram.js defined in bundle 'web.assets_backend' */
odoo.define('web_diagram.DiagramView',function(require){"use strict";var core=require('web.core');var data=require('web.data');var form_common=require('web.form_common');var Pager=require('web.Pager');var View=require('web.View');var Model=require('web.DataModel')
var _t=core._t;var _lt=core._lt;var QWeb=core.qweb;var DiagramView=View.extend({display_name:_lt('Diagram'),icon:'fa-code-fork',view_type:'diagram',searchable:false,multi_record:false,edge_colors:['#000','#F00','#00F','#080'],init:function(parent,dataset,view_id,options){this._super(parent);this.set_default_options(options);this.view_manager=parent;this.dataset=dataset;this.model=this.dataset.model;this.view_id=view_id;this.domain=this.dataset._domain||[];this.context={};this.ids=this.dataset.ids;this.filter_group=[];this.all_filter_groups=[];},view_loading:function(r){return this.load_diagram(r);},toTitleCase:function(str){return str.replace(/\w\S*/g,function(txt){return txt.charAt(0).toUpperCase()+txt.substr(1).toLowerCase();});},load_diagram:function(result){var self=this;if(this.ids&&this.ids.length){this.id=this.ids[self.dataset.index||0];}
this.fields_view=result;this.view_id=this.fields_view.view_id;this.fields=this.fields_view.fields;this.nodes=this.fields_view.arch.children[0];this.connectors=this.fields_view.arch.children[1];this.node=this.nodes.attrs.object;this.connector=this.connectors.attrs.object;this.labels=_.filter(this.fields_view.arch.children,function(label){return label.tag==="label";});this.$el.html(QWeb.render("DiagramView",{'widget':self}));this.$el.addClass('o_diagram_view').addClass(this.fields_view.arch.attrs['class']);this.$('#filter_group').select2({width:'200px',formatResultCssClass:function(data){var classes=['black','red','blue','green'];return'o_diagram_'+classes[self.all_filter_groups.indexOf(parseInt(data.id))];}});this.$('#filter_group').on('change',function(){self.filter_group=_.map($(this).val(),function(el){return!!el&&parseInt(el);});self.reload();});_.each(self.labels,function(label){self.$('.o_diagram_header').append($('<span>').html(label.attrs.string));});if(this.id){self.get_diagram_info();}
this.trigger('diagram_view_loaded',result);},get_diagram_info:function(){var self=this;var params={'id':this.id,'model':this.model,'node':this.node,'connector':this.connector,'bgcolor':this.nodes.attrs.bgcolor,'shape':this.nodes.attrs.shape,'src_node':this.connectors.attrs.source,'des_node':this.connectors.attrs.destination,'label':this.connectors.attrs.label||false,'visible_nodes':[],'invisible_nodes':[],'node_fields':[],'connectors':[],'connectors_fields':[]};_.each(this.nodes.children,function(child){if(child.attrs.invisible==='1')
params.invisible_nodes.push(child.attrs.name);else{params.visible_nodes.push(child.attrs.name);params.node_fields.push(self.fields[child.attrs.name]['string']||this.toTitleCase(child.attrs.name));}});_.each(this.connectors.children,function(conn){params.connectors_fields.push(self.fields[conn.attrs.name]['string']||this.toTitleCase(conn.attrs.name));params.connectors.push(conn.attrs.name);});this.rpc('/web_diagram/diagram/get_diagram_info',params).done(function(result){self.draw_diagram(result);});},on_diagram_loaded:function(record){this.set({'title':record.id?record.name:_t("New")});this.load_group_list();var id_record=record['id'];if(id_record){this.id=id_record;this.get_diagram_info();this.do_push_state({id:id_record});}else{this.do_push_state({});}},do_load_state:function(state,warm){if(state&&state.id){if(!this.dataset.get_id_index(state.id)){this.dataset.ids.push(state.id);}
this.dataset.select_id(state.id);if(warm){this.do_show();}}},draw_diagram:function(result){var self=this;var res_nodes=result['nodes'];var res_edges=result['conn'];this.parent_field=result.parent_field;var id_to_node={};var style={edge_color:"#A0A0A0",edge_label_color:"#555",edge_label_font_size:10,edge_width:2,edge_spacing:100,edge_loop_radius:100,node_label_color:"#333",node_label_font_size:12,node_outline_color:"#333",node_outline_width:1,node_selected_color:"#0097BE",node_selected_width:2,node_size_x:110,node_size_y:80,connector_active_color:"#FFF",connector_radius:4,close_button_radius:8,close_button_color:"#333",close_button_x_color:"#FFF",gray:"#DCDCDC",white:"#FFF",viewport_margin:50};var canvas=self.$('.o_diagram').empty().get(0);var r=new Raphael(canvas,'100%','100%');var graph=new CuteGraph(r,style,canvas.parentNode);_.each(res_nodes,function(node){var n=new CuteNode(graph,node.x+50,node.y+50,CuteGraph.wordwrap(node.name,14),node.shape==='rectangle'?'rect':'circle',node.color==='white'?style.white:style.gray);n.id=node.id;id_to_node[node.id]=n;});this.$('#save_position').off('click');this.$('#save_position').on('click',function(){var positions=_.mapObject(id_to_node,function(node,id){return node.get_pos();});var Node=new Model(self.node);Node.call('save_position',[positions]);});_.each(res_edges,function(edge){var filter_group_id=edge.options.filter_group_id&&edge.options.filter_group_id[0]||0;if(!self.filter_group.length||self.filter_group.indexOf(filter_group_id)>-1){if(self.all_filter_groups.length){var color=self.edge_colors[self.all_filter_groups.indexOf(filter_group_id)];}else{var color=undefined;}
var e=new CuteEdge(graph,CuteGraph.wordwrap(edge.signal,32),id_to_node[edge.s_id],id_to_node[edge.d_id]||id_to_node[edge.s_id],undefined,color);e.id=edge.id;}});CuteNode.double_click_callback=function(cutenode){self.edit_node(cutenode.id);};CuteNode.destruction_callback=function(cutenode){if(!confirm(_t("Deleting this node cannot be undone.\nIt will also delete all connected transitions.\n\nAre you sure ?"))){return $.Deferred().reject().promise();}
return new data.DataSet(self,self.node).unlink([cutenode.id]);};CuteEdge.double_click_callback=function(cuteedge){self.edit_connector(cuteedge.id);};CuteEdge.creation_callback=function(node_start,node_end){return{label:''};};CuteEdge.new_edge_callback=function(cuteedge){self.add_connector(cuteedge.get_start().id,cuteedge.get_end().id,cuteedge);};CuteEdge.destruction_callback=function(cuteedge){if(!confirm(_t("Deleting this transition cannot be undone.\n\nAre you sure ?"))){return $.Deferred().reject().promise();}
return new data.DataSet(self,self.connector).unlink([cuteedge.id]);};},edit_node:function(node_id){var self=this;var title=_t('Activity');var pop=new form_common.FormViewDialog(self,{res_model:self.node,res_id:node_id,context:self.context||self.dataset.context,title:_t("Open: ")+title}).open();pop.on('write_completed',self,function(){self.dataset.read_index(_.keys(self.fields_view.fields)).then(self.on_diagram_loaded);});var form_fields=[self.parent_field];var form_controller=pop.view_form;form_controller.on("load_record",self,function(){_.each(form_fields,function(fld){if(!(fld in form_controller.fields)){return;}
var field=form_controller.fields[fld];field.$input.prop('disabled',true);field.$dropdown.unbind();});});},add_node:function(){var self=this;var title=_t('Activity');var pop=new form_common.FormViewDialog(self,{res_model:self.node,domain:self.dataset.domain,context:self.context||self.dataset.context,title:_t("Create:")+title,disable_multiple_selection:true,on_selected:function(element_ids){self.dataset.read_index(_.keys(self.fields_view.fields)).then(self.on_diagram_loaded);}}).open();var form_controller=pop.view_form;var form_fields=[this.parent_field];form_controller.on("load_record",self,function(){_.each(form_fields,function(fld){if(!(fld in form_controller.fields)){return;}
var field=form_controller.fields[fld];field.set_value(self.id);field.dirty=true;});});},edit_connector:function(connector_id){var self=this;var title=_t('Transition');var pop=new form_common.FormViewDialog(self,{res_model:self.connector,res_id:parseInt(connector_id,10),context:self.context||self.dataset.context,title:_t("Open: ")+title}).open();pop.on('write_completed',self,function(){self.dataset.read_index(_.keys(self.fields_view.fields)).then(self.on_diagram_loaded);});},add_connector:function(node_source_id,node_dest_id,dummy_cuteedge){var self=this;var title=_t('Transition');var pop=new form_common.FormViewDialog(self,{res_model:self.connector,domain:this.dataset.domain,context:this.context||this.dataset.context,title:_t("Create:")+title,disable_multiple_selection:true,on_selected:function(element_ids){self.dataset.read_index(_.keys(self.fields_view.fields)).then(self.on_diagram_loaded);}}).open();pop.$el.parents('.modal').on('hidden.bs.modal',function(e){if(dummy_cuteedge){dummy_cuteedge.remove();}});var form_controller=pop.view_form;form_controller.on("load_record",self,function(){form_controller.fields[self.connectors.attrs.source].set_value(node_source_id);form_controller.fields[self.connectors.attrs.source].dirty=true;form_controller.fields[self.connectors.attrs.destination].set_value(node_dest_id);form_controller.fields[self.connectors.attrs.destination].dirty=true;});},render_buttons:function($node){var self=this;this.$buttons=$(QWeb.render("DiagramView.buttons",{'widget':this}));this.$buttons.on('click','.o_diagram_new_button',function(){self.add_node();});$node=$node||this.options.$buttons;this.$buttons.appendTo($node);},render_pager:function($node){var self=this;this.pager=new Pager(this,this.dataset.ids.length,this.dataset.index+1,1);this.pager.appendTo($node||this.options.$pager);this.pager.on('pager_changed',this,function(new_state){this.pager.disable();this.dataset.index=new_state.current_min-1;$.when(this.reload()).then(function(){self.pager.enable();});});},update_pager:function(){if(this.pager){this.pager.update_state({size:this.dataset.ids.length,current_min:this.dataset.index+1,});}},reload:function(){return this.dataset.read_index(_.keys(this.fields_view.fields)).then(this.on_diagram_loaded).then(this.proxy('update_pager'));},do_show:function(){this.do_push_state({});return $.when(this._super(),this.reload());},load_group_list:function(){var self=this;var Group=new Model('workflow.transition.group');Group.query().all().then(function(res){self.all_filter_groups=_.pluck(res,'id');var select=self.$('#filter_group');select.empty();_.each(res,function(group){select.append('<option style="color:'+self.edge_colors[self.all_filter_groups.indexOf(res.id)]+'" value="'+group.id+'"'+(self.filter_group.indexOf(group.id)>-1?' selected="selected"':'')+'>'+group.name+'</option>');});});},});core.view_registry.add('diagram',DiagramView);return DiagramView;});;

/* <inline asset> defined in bundle 'web.assets_backend' */
(function(){"use strict";odoo.define('jquery',function(){return $;});var uniqId=0;odoo.__define__=window.define;window.define=function(id){var args=Array.prototype.slice.call(arguments);var factorie=args.pop();var id=args[0];if(id instanceof Array){var name="summernote_factorie_"+(++uniqId);odoo[name]=factorie;var head='';var fn='var fn = odoo.'+name+';\ndelete odoo.'+name+';\n';fn+='return fn(';for(var k=0;k<id.length;k++){head+='var a'+(++uniqId)+' = require("'+id[k]+'");\n';fn+='a'+uniqId+', ';}
fn+='null);';odoo.define(odoo.website_next_define,new Function('require',head+fn));}else{odoo.define(id,factorie);}};})();;

/* <inline asset> defined in bundle 'web.assets_backend' */
odoo.website_next_define='summernote/core/async';;

/* /web_editor/static/lib/summernote/src/js/core/async.js defined in bundle 'web.assets_backend' */
define('summernote/core/async',function(){var async=(function(){var readFileAsDataURL=function(file){return $.Deferred(function(deferred){$.extend(new FileReader(),{onload:function(e){var sDataURL=e.target.result;deferred.resolve(sDataURL);},onerror:function(){deferred.reject(this);}}).readAsDataURL(file);}).promise();};var createImage=function(sUrl,filename){return $.Deferred(function(deferred){var $img=$('<img>');$img.one('load',function(){$img.off('error abort');deferred.resolve($img);}).one('error abort',function(){$img.off('load').detach();deferred.reject($img);}).css({display:'none'}).appendTo(document.body).attr({'src':sUrl,'data-filename':filename});}).promise();};return{readFileAsDataURL:readFileAsDataURL,createImage:createImage};})();return async;});;

/* <inline asset> defined in bundle 'web.assets_backend' */
odoo.website_next_define='summernote/core/func';;

/* /web_editor/static/lib/summernote/src/js/core/func.js defined in bundle 'web.assets_backend' */
define('summernote/core/func',function(){var func=(function(){var eq=function(itemA){return function(itemB){return itemA===itemB;};};var eq2=function(itemA,itemB){return itemA===itemB;};var peq2=function(propName){return function(itemA,itemB){return itemA[propName]===itemB[propName];};};var ok=function(){return true;};var fail=function(){return false;};var not=function(f){return function(){return!f.apply(f,arguments);};};var and=function(fA,fB){return function(item){return fA(item)&&fB(item);};};var self=function(a){return a;};var idCounter=0;var uniqueId=function(prefix){var id=++idCounter+'';return prefix?prefix+id:id;};var rect2bnd=function(rect){var $document=$(document);return{top:rect.top+$document.scrollTop(),left:rect.left+$document.scrollLeft(),width:rect.right-rect.left,height:rect.bottom-rect.top};};var invertObject=function(obj){var inverted={};for(var key in obj){if(obj.hasOwnProperty(key)){inverted[obj[key]]=key;}}
return inverted;};var namespaceToCamel=function(namespace,prefix){prefix=prefix||'';return prefix+namespace.split('.').map(function(name){return name.substring(0,1).toUpperCase()+name.substring(1);}).join('');};return{eq:eq,eq2:eq2,peq2:peq2,ok:ok,fail:fail,self:self,not:not,and:and,uniqueId:uniqueId,rect2bnd:rect2bnd,invertObject:invertObject,namespaceToCamel:namespaceToCamel};})();return func;});;

/* <inline asset> defined in bundle 'web.assets_backend' */
odoo.website_next_define='summernote/core/agent';;

/* /web_editor/static/lib/summernote/src/js/core/agent.js defined in bundle 'web.assets_backend' */
define(['jquery'],function($){if(!Array.prototype.reduce){Array.prototype.reduce=function(callback){var t=Object(this),len=t.length>>>0,k=0,value;if(arguments.length===2){value=arguments[1];}else{while(k<len&&!(k in t)){k++;}
if(k>=len){throw new TypeError('Reduce of empty array with no initial value');}
value=t[k++];}
for(;k<len;k++){if(k in t){value=callback(value,t[k],k,t);}}
return value;};}
if('function'!==typeof Array.prototype.filter){Array.prototype.filter=function(func){var t=Object(this),len=t.length>>>0;var res=[];var thisArg=arguments.length>=2?arguments[1]:void 0;for(var i=0;i<len;i++){if(i in t){var val=t[i];if(func.call(thisArg,val,i,t)){res.push(val);}}}
return res;};}
if(!Array.prototype.map){Array.prototype.map=function(callback,thisArg){var T,A,k;if(this===null){throw new TypeError(' this is null or not defined');}
var O=Object(this);var len=O.length>>>0;if(typeof callback!=='function'){throw new TypeError(callback+' is not a function');}
if(arguments.length>1){T=thisArg;}
A=new Array(len);k=0;while(k<len){var kValue,mappedValue;if(k in O){kValue=O[k];mappedValue=callback.call(T,kValue,k,O);A[k]=mappedValue;}
k++;}
return A;};}
var isSupportAmd=typeof define==='function'&&define.amd;var isFontInstalled=function(fontName){var testFontName=fontName==='Comic Sans MS'?'Courier New':'Comic Sans MS';var $tester=$('<div>').css({position:'absolute',left:'-9999px',top:'-9999px',fontSize:'200px'}).text('mmmmmmmmmwwwwwww').appendTo(document.body);var originalWidth=$tester.css('fontFamily',testFontName).width();var width=$tester.css('fontFamily',fontName+','+testFontName).width();$tester.remove();return originalWidth!==width;};var userAgent=navigator.userAgent;var isMSIE=/MSIE|Trident/i.test(userAgent);var browserVersion;if(isMSIE){var matches=/MSIE (\d+[.]\d+)/.exec(userAgent);if(matches){browserVersion=parseFloat(matches[1]);}
matches=/Trident\/.*rv:([0-9]{1,}[\.0-9]{0,})/.exec(userAgent);if(matches){browserVersion=parseFloat(matches[1]);}}
var agent={isMac:navigator.appVersion.indexOf('Mac')>-1,isMSIE:isMSIE,isFF:/firefox/i.test(userAgent),isWebkit:/webkit/i.test(userAgent),isSafari:/safari/i.test(userAgent),browserVersion:browserVersion,jqueryVersion:parseFloat($.fn.jquery),isSupportAmd:isSupportAmd,hasCodeMirror:isSupportAmd?require.specified('CodeMirror'):!!window.CodeMirror,isFontInstalled:isFontInstalled,isW3CRangeSupport:!!document.createRange};return agent;});;

/* <inline asset> defined in bundle 'web.assets_backend' */
odoo.website_next_define='summernote/core/list';;

/* /web_editor/static/lib/summernote/src/js/core/list.js defined in bundle 'web.assets_backend' */
define(['summernote/core/func'],function(func){var list=(function(){var head=function(array){return array[0];};var last=function(array){return array[array.length-1];};var initial=function(array){return array.slice(0,array.length-1);};var tail=function(array){return array.slice(1);};var find=function(array,pred){for(var idx=0,len=array.length;idx<len;idx++){var item=array[idx];if(pred(item)){return item;}}};var all=function(array,pred){for(var idx=0,len=array.length;idx<len;idx++){if(!pred(array[idx])){return false;}}
return true;};var indexOf=function(array,item){return $.inArray(item,array);};var contains=function(array,item){return indexOf(array,item)!==-1;};var sum=function(array,fn){fn=fn||func.self;return array.reduce(function(memo,v){return memo+fn(v);},0);};var from=function(collection){var result=[],idx=-1,length=collection.length;while(++idx<length){result[idx]=collection[idx];}
return result;};var clusterBy=function(array,fn){if(!array.length){return[];}
var aTail=tail(array);return aTail.reduce(function(memo,v){var aLast=last(memo);if(fn(last(aLast),v)){aLast[aLast.length]=v;}else{memo[memo.length]=[v];}
return memo;},[[head(array)]]);};var compact=function(array){var aResult=[];for(var idx=0,len=array.length;idx<len;idx++){if(array[idx]){aResult.push(array[idx]);}}
return aResult;};var unique=function(array){var results=[];for(var idx=0,len=array.length;idx<len;idx++){if(!contains(results,array[idx])){results.push(array[idx]);}}
return results;};var next=function(array,item){var idx=indexOf(array,item);if(idx===-1){return null;}
return array[idx+1];};var prev=function(array,item){var idx=indexOf(array,item);if(idx===-1){return null;}
return array[idx-1];};return{head:head,last:last,initial:initial,tail:tail,prev:prev,next:next,find:find,contains:contains,all:all,sum:sum,from:from,clusterBy:clusterBy,compact:compact,unique:unique};})();return list;});;

/* <inline asset> defined in bundle 'web.assets_backend' */
odoo.website_next_define='summernote/core/dom';;

/* /web_editor/static/lib/summernote/src/js/core/dom.js defined in bundle 'web.assets_backend' */
define(['summernote/core/func','summernote/core/list','summernote/core/agent'],function(func,list,agent){var NBSP_CHAR=String.fromCharCode(160);var ZERO_WIDTH_NBSP_CHAR='\ufeff';var dom=(function(){var isEditable=function(node){return node&&$(node).hasClass('note-editable');};var isControlSizing=function(node){return node&&$(node).hasClass('note-control-sizing');};var buildLayoutInfo=function($editor){var makeFinder;if($editor.hasClass('note-air-editor')){var id=list.last($editor.attr('data-note-id').split('-'));makeFinder=function(sIdPrefix){return function(){return $(sIdPrefix+id);};};return{editor:function(){return $editor;},holder:function(){return $editor.data('holder');},editable:function(){return $editor;},popover:makeFinder('#note-popover-'),handle:makeFinder('#note-handle-'),dialog:makeFinder('#note-dialog-')};}else{makeFinder=function(className,$base){$base=$base||$editor;return function(){return $base.find(className);};};var options=$editor.data('options');var $dialogHolder=(options&&options.dialogsInBody)?$(document.body):null;return{editor:function(){return $editor;},holder:function(){return $editor.data('holder');},dropzone:makeFinder('.note-dropzone'),toolbar:makeFinder('.note-toolbar'),editable:makeFinder('.note-editable'),codable:makeFinder('.note-codable'),statusbar:makeFinder('.note-statusbar'),popover:makeFinder('.note-popover'),handle:makeFinder('.note-handle'),dialog:makeFinder('.note-dialog',$dialogHolder)};}};var makeLayoutInfo=function(descendant){var $target=$(descendant).closest('.note-editor, .note-air-editor, .note-air-layout');if(!$target.length){return null;}
var $editor;if($target.is('.note-editor, .note-air-editor')){$editor=$target;}else{$editor=$('[data-note-id="'+list.last($target.attr('id'))+'"]');}
return buildLayoutInfo($editor);};var makePredByNodeName=function(nodeName){nodeName=nodeName.toUpperCase();return function(node){return node&&node.nodeName.toUpperCase()===nodeName;};};var isText=function(node){return node&&node.nodeType===3;};var isVoid=function(node){return node&&/^BR|^IMG|^HR|^IFRAME|^BUTTON/.test(node.nodeName.toUpperCase());};var isPara=function(node){if(isEditable(node)){return false;}
return node&&/^DIV|^P|^LI|^H[1-7]/.test(node.nodeName.toUpperCase());};var isLi=makePredByNodeName('LI');var isPurePara=function(node){return isPara(node)&&!isLi(node);};var isTable=makePredByNodeName('TABLE');var isInline=function(node){return!isBodyContainer(node)&&!isList(node)&&!isHr(node)&&!isPara(node)&&!isTable(node)&&!isBlockquote(node);};var isList=function(node){return node&&/^UL|^OL/.test(node.nodeName.toUpperCase());};var isHr=makePredByNodeName('HR');var isCell=function(node){return node&&/^TD|^TH/.test(node.nodeName.toUpperCase());};var isBlockquote=makePredByNodeName('BLOCKQUOTE');var isBodyContainer=function(node){return isCell(node)||isBlockquote(node)||isEditable(node);};var isAnchor=makePredByNodeName('A');var isParaInline=function(node){return isInline(node)&&!!ancestor(node,isPara);};var isBodyInline=function(node){return isInline(node)&&!ancestor(node,isPara);};var isBody=makePredByNodeName('BODY');var isClosestSibling=function(nodeA,nodeB){return nodeA.nextSibling===nodeB||nodeA.previousSibling===nodeB;};var withClosestSiblings=function(node,pred){pred=pred||func.ok;var siblings=[];if(node.previousSibling&&pred(node.previousSibling)){siblings.push(node.previousSibling);}
siblings.push(node);if(node.nextSibling&&pred(node.nextSibling)){siblings.push(node.nextSibling);}
return siblings;};var blankHTML=agent.isMSIE&&agent.browserVersion<11?'&nbsp;':'<br>';var nodeLength=function(node){if(isText(node)){return node.nodeValue.length;}
return node.childNodes.length;};var isEmpty=function(node){var len=nodeLength(node);if(len===0){return true;}else if(!isText(node)&&len===1&&node.innerHTML===blankHTML){return true;}else if(list.all(node.childNodes,isText)&&node.innerHTML===''){return true;}
return false;};var paddingBlankHTML=function(node){if(!isVoid(node)&&!nodeLength(node)){node.innerHTML=blankHTML;}};var ancestor=function(node,pred){while(node){if(pred(node)){return node;}
if(isEditable(node)){break;}
node=node.parentNode;}
return null;};var singleChildAncestor=function(node,pred){node=node.parentNode;while(node){if(nodeLength(node)!==1){break;}
if(pred(node)){return node;}
if(isEditable(node)){break;}
node=node.parentNode;}
return null;};var listAncestor=function(node,pred){pred=pred||func.fail;var ancestors=[];ancestor(node,function(el){if(!isEditable(el)){ancestors.push(el);}
return pred(el);});return ancestors;};var lastAncestor=function(node,pred){var ancestors=listAncestor(node);return list.last(ancestors.filter(pred));};var commonAncestor=function(nodeA,nodeB){var ancestors=listAncestor(nodeA);for(var n=nodeB;n;n=n.parentNode){if($.inArray(n,ancestors)>-1){return n;}}
return null;};var listPrev=function(node,pred){pred=pred||func.fail;var nodes=[];while(node){if(pred(node)){break;}
nodes.push(node);node=node.previousSibling;}
return nodes;};var listNext=function(node,pred){pred=pred||func.fail;var nodes=[];while(node){if(pred(node)){break;}
nodes.push(node);node=node.nextSibling;}
return nodes;};var listDescendant=function(node,pred){var descendents=[];pred=pred||func.ok;(function fnWalk(current){if(node!==current&&pred(current)){descendents.push(current);}
for(var idx=0,len=current.childNodes.length;idx<len;idx++){fnWalk(current.childNodes[idx]);}})(node);return descendents;};var wrap=function(node,wrapperName){var parent=node.parentNode;var wrapper=$('<'+wrapperName+'>')[0];parent.insertBefore(wrapper,node);wrapper.appendChild(node);return wrapper;};var insertAfter=function(node,preceding){var next=preceding.nextSibling,parent=preceding.parentNode;if(next){parent.insertBefore(node,next);}else{parent.appendChild(node);}
return node;};var appendChildNodes=function(node,aChild){$.each(aChild,function(idx,child){node.appendChild(child);});return node;};var isLeftEdgePoint=function(point){return point.offset===0;};var isRightEdgePoint=function(point){return point.offset===nodeLength(point.node);};var isEdgePoint=function(point){return isLeftEdgePoint(point)||isRightEdgePoint(point);};var isLeftEdgeOf=function(node,ancestor){while(node&&node!==ancestor){if(position(node)!==0){return false;}
node=node.parentNode;}
return true;};var isRightEdgeOf=function(node,ancestor){while(node&&node!==ancestor){if(position(node)!==nodeLength(node.parentNode)-1){return false;}
node=node.parentNode;}
return true;};var isLeftEdgePointOf=function(point,ancestor){return isLeftEdgePoint(point)&&isLeftEdgeOf(point.node,ancestor);};var isRightEdgePointOf=function(point,ancestor){return isRightEdgePoint(point)&&isRightEdgeOf(point.node,ancestor);};var position=function(node){var offset=0;while((node=node.previousSibling)){offset+=1;}
return offset;};var hasChildren=function(node){return!!(node&&node.childNodes&&node.childNodes.length);};var prevPoint=function(point,isSkipInnerOffset){var node,offset;if(point.offset===0){if(isEditable(point.node)){return null;}
node=point.node.parentNode;offset=position(point.node);}else if(hasChildren(point.node)){node=point.node.childNodes[point.offset-1];offset=nodeLength(node);}else{node=point.node;offset=isSkipInnerOffset?0:point.offset-1;}
return{node:node,offset:offset};};var nextPoint=function(point,isSkipInnerOffset){var node,offset;if(nodeLength(point.node)===point.offset){if(isEditable(point.node)){return null;}
node=point.node.parentNode;offset=position(point.node)+1;}else if(hasChildren(point.node)){node=point.node.childNodes[point.offset];offset=0;}else{node=point.node;offset=isSkipInnerOffset?nodeLength(point.node):point.offset+1;}
return{node:node,offset:offset};};var isSamePoint=function(pointA,pointB){return pointA.node===pointB.node&&pointA.offset===pointB.offset;};var isVisiblePoint=function(point){if(isText(point.node)||!hasChildren(point.node)||isEmpty(point.node)){return true;}
var leftNode=point.node.childNodes[point.offset-1];var rightNode=point.node.childNodes[point.offset];if((!leftNode||isVoid(leftNode))&&(!rightNode||isVoid(rightNode))){return true;}
return false;};var prevPointUntil=function(point,pred){while(point){if(pred(point)){return point;}
point=prevPoint(point);}
return null;};var nextPointUntil=function(point,pred){while(point){if(pred(point)){return point;}
point=nextPoint(point);}
return null;};var isCharPoint=function(point){if(!isText(point.node)){return false;}
var ch=point.node.nodeValue.charAt(point.offset-1);return ch&&(ch!==' '&&ch!==NBSP_CHAR);};var walkPoint=function(startPoint,endPoint,handler,isSkipInnerOffset){var point=startPoint;while(point){handler(point);if(isSamePoint(point,endPoint)){break;}
var isSkipOffset=isSkipInnerOffset&&startPoint.node!==point.node&&endPoint.node!==point.node;point=nextPoint(point,isSkipOffset);}};var makeOffsetPath=function(ancestor,node){var ancestors=listAncestor(node,func.eq(ancestor));return ancestors.map(position).reverse();};var fromOffsetPath=function(ancestor,offsets){var current=ancestor;for(var i=0,len=offsets.length;i<len;i++){if(current.childNodes.length<=offsets[i]){current=current.childNodes[current.childNodes.length-1];}else{current=current.childNodes[offsets[i]];}}
return current;};var splitNode=function(point,options){var isSkipPaddingBlankHTML=options&&options.isSkipPaddingBlankHTML;var isNotSplitEdgePoint=options&&options.isNotSplitEdgePoint;if(isEdgePoint(point)&&(isText(point.node)||isNotSplitEdgePoint)){if(isLeftEdgePoint(point)){return point.node;}else if(isRightEdgePoint(point)){return point.node.nextSibling;}}
if(isText(point.node)){return point.node.splitText(point.offset);}else{var childNode=point.node.childNodes[point.offset];var clone=insertAfter(point.node.cloneNode(false),point.node);appendChildNodes(clone,listNext(childNode));if(!isSkipPaddingBlankHTML){paddingBlankHTML(point.node);paddingBlankHTML(clone);}
return clone;}};var splitTree=function(root,point,options){var ancestors=listAncestor(point.node,func.eq(root));if(!ancestors.length){return null;}else if(ancestors.length===1){return splitNode(point,options);}
return ancestors.reduce(function(node,parent){if(node===point.node){node=splitNode(point,options);}
return splitNode({node:parent,offset:node?dom.position(node):nodeLength(parent)},options);});};var splitPoint=function(point,isInline){var pred=isInline?isPara:isBodyContainer;var ancestors=listAncestor(point.node,pred);var topAncestor=list.last(ancestors)||point.node;var splitRoot,container;if(pred(topAncestor)){splitRoot=ancestors[ancestors.length-2];container=topAncestor;}else{splitRoot=topAncestor;container=splitRoot.parentNode;}
var pivot=splitRoot&&splitTree(splitRoot,point,{isSkipPaddingBlankHTML:isInline,isNotSplitEdgePoint:isInline});if(!pivot&&container===point.node){pivot=point.node.childNodes[point.offset];}
return{rightNode:pivot,container:container};};var create=function(nodeName){return document.createElement(nodeName);};var createText=function(text){return document.createTextNode(text);};var remove=function(node,isRemoveChild){if(!node||!node.parentNode){return;}
if(node.removeNode){return node.removeNode(isRemoveChild);}
var parent=node.parentNode;if(!isRemoveChild){var nodes=[];var i,len;for(i=0,len=node.childNodes.length;i<len;i++){nodes.push(node.childNodes[i]);}
for(i=0,len=nodes.length;i<len;i++){parent.insertBefore(nodes[i],node);}}
parent.removeChild(node);};var removeWhile=function(node,pred){while(node){if(isEditable(node)||!pred(node)){break;}
var parent=node.parentNode;remove(node);node=parent;}};var replace=function(node,nodeName){if(node.nodeName.toUpperCase()===nodeName.toUpperCase()){return node;}
var newNode=create(nodeName);if(node.style.cssText){newNode.style.cssText=node.style.cssText;}
appendChildNodes(newNode,list.from(node.childNodes));insertAfter(newNode,node);remove(node);return newNode;};var isTextarea=makePredByNodeName('TEXTAREA');var value=function($node,stripLinebreaks){var val=isTextarea($node[0])?$node.val():$node.html();if(stripLinebreaks){return val.replace(/[\n\r]/g,'');}
return val;};var html=function($node,isNewlineOnBlock){var markup=value($node);if(isNewlineOnBlock){var regexTag=/<(\/?)(\b(?!!)[^>\s]*)(.*?)(\s*\/?>)/g;markup=markup.replace(regexTag,function(match,endSlash,name){name=name.toUpperCase();var isEndOfInlineContainer=/^DIV|^TD|^TH|^P|^LI|^H[1-7]/.test(name)&&!!endSlash;var isBlockNode=/^BLOCKQUOTE|^TABLE|^TBODY|^TR|^HR|^UL|^OL/.test(name);return match+((isEndOfInlineContainer||isBlockNode)?'\n':'');});markup=$.trim(markup);}
return markup;};return{NBSP_CHAR:NBSP_CHAR,ZERO_WIDTH_NBSP_CHAR:ZERO_WIDTH_NBSP_CHAR,blank:blankHTML,emptyPara:'<p>'+blankHTML+'</p>',makePredByNodeName:makePredByNodeName,isEditable:isEditable,isControlSizing:isControlSizing,buildLayoutInfo:buildLayoutInfo,makeLayoutInfo:makeLayoutInfo,isText:isText,isVoid:isVoid,isPara:isPara,isPurePara:isPurePara,isInline:isInline,isBlock:func.not(isInline),isBodyInline:isBodyInline,isBody:isBody,isParaInline:isParaInline,isList:isList,isTable:isTable,isCell:isCell,isBlockquote:isBlockquote,isBodyContainer:isBodyContainer,isAnchor:isAnchor,isDiv:makePredByNodeName('DIV'),isLi:isLi,isBR:makePredByNodeName('BR'),isSpan:makePredByNodeName('SPAN'),isB:makePredByNodeName('B'),isU:makePredByNodeName('U'),isS:makePredByNodeName('S'),isI:makePredByNodeName('I'),isImg:makePredByNodeName('IMG'),isTextarea:isTextarea,isEmpty:isEmpty,isEmptyAnchor:func.and(isAnchor,isEmpty),isClosestSibling:isClosestSibling,withClosestSiblings:withClosestSiblings,nodeLength:nodeLength,isLeftEdgePoint:isLeftEdgePoint,isRightEdgePoint:isRightEdgePoint,isEdgePoint:isEdgePoint,isLeftEdgeOf:isLeftEdgeOf,isRightEdgeOf:isRightEdgeOf,isLeftEdgePointOf:isLeftEdgePointOf,isRightEdgePointOf:isRightEdgePointOf,prevPoint:prevPoint,nextPoint:nextPoint,isSamePoint:isSamePoint,isVisiblePoint:isVisiblePoint,prevPointUntil:prevPointUntil,nextPointUntil:nextPointUntil,isCharPoint:isCharPoint,walkPoint:walkPoint,ancestor:ancestor,singleChildAncestor:singleChildAncestor,listAncestor:listAncestor,lastAncestor:lastAncestor,listNext:listNext,listPrev:listPrev,listDescendant:listDescendant,commonAncestor:commonAncestor,wrap:wrap,insertAfter:insertAfter,appendChildNodes:appendChildNodes,position:position,hasChildren:hasChildren,makeOffsetPath:makeOffsetPath,fromOffsetPath:fromOffsetPath,splitTree:splitTree,splitPoint:splitPoint,create:create,createText:createText,remove:remove,removeWhile:removeWhile,replace:replace,html:html,value:value};})();return dom;});;

/* <inline asset> defined in bundle 'web.assets_backend' */
odoo.website_next_define='summernote/core/key';;

/* /web_editor/static/lib/summernote/src/js/core/key.js defined in bundle 'web.assets_backend' */
define(['summernote/core/list','summernote/core/func'],function(list,func){var key=(function(){var keyMap={'BACKSPACE':8,'TAB':9,'ENTER':13,'SPACE':32,'LEFT':37,'UP':38,'RIGHT':39,'DOWN':40,'NUM0':48,'NUM1':49,'NUM2':50,'NUM3':51,'NUM4':52,'NUM5':53,'NUM6':54,'NUM7':55,'NUM8':56,'B':66,'E':69,'I':73,'J':74,'K':75,'L':76,'R':82,'S':83,'U':85,'V':86,'Y':89,'Z':90,'SLASH':191,'LEFTBRACKET':219,'BACKSLASH':220,'RIGHTBRACKET':221};return{isEdit:function(keyCode){return list.contains([keyMap.BACKSPACE,keyMap.TAB,keyMap.ENTER,keyMap.SPACe],keyCode);},isMove:function(keyCode){return list.contains([keyMap.LEFT,keyMap.UP,keyMap.RIGHT,keyMap.DOWN],keyCode);},nameFromCode:func.invertObject(keyMap),code:keyMap};})();return key;});;

/* <inline asset> defined in bundle 'web.assets_backend' */
odoo.website_next_define='summernote/core/range';;

/* /web_editor/static/lib/summernote/src/js/core/range.js defined in bundle 'web.assets_backend' */
define(['summernote/core/agent','summernote/core/func','summernote/core/list','summernote/core/dom'],function(agent,func,list,dom){var range=(function(){var textRangeToPoint=function(textRange,isStart){var container=textRange.parentElement(),offset;var tester=document.body.createTextRange(),prevContainer;var childNodes=list.from(container.childNodes);for(offset=0;offset<childNodes.length;offset++){if(dom.isText(childNodes[offset])){continue;}
tester.moveToElementText(childNodes[offset]);if(tester.compareEndPoints('StartToStart',textRange)>=0){break;}
prevContainer=childNodes[offset];}
if(offset!==0&&dom.isText(childNodes[offset-1])){var textRangeStart=document.body.createTextRange(),curTextNode=null;textRangeStart.moveToElementText(prevContainer||container);textRangeStart.collapse(!prevContainer);curTextNode=prevContainer?prevContainer.nextSibling:container.firstChild;var pointTester=textRange.duplicate();pointTester.setEndPoint('StartToStart',textRangeStart);var textCount=pointTester.text.replace(/[\r\n]/g,'').length;while(textCount>curTextNode.nodeValue.length&&curTextNode.nextSibling){textCount-=curTextNode.nodeValue.length;curTextNode=curTextNode.nextSibling;}
var dummy=curTextNode.nodeValue;if(isStart&&curTextNode.nextSibling&&dom.isText(curTextNode.nextSibling)&&textCount===curTextNode.nodeValue.length){textCount-=curTextNode.nodeValue.length;curTextNode=curTextNode.nextSibling;}
container=curTextNode;offset=textCount;}
return{cont:container,offset:offset};};var pointToTextRange=function(point){var textRangeInfo=function(container,offset){var node,isCollapseToStart;if(dom.isText(container)){var prevTextNodes=dom.listPrev(container,func.not(dom.isText));var prevContainer=list.last(prevTextNodes).previousSibling;node=prevContainer||container.parentNode;offset+=list.sum(list.tail(prevTextNodes),dom.nodeLength);isCollapseToStart=!prevContainer;}else{node=container.childNodes[offset]||container;if(dom.isText(node)){return textRangeInfo(node,0);}
offset=0;isCollapseToStart=false;}
return{node:node,collapseToStart:isCollapseToStart,offset:offset};};var textRange=document.body.createTextRange();var info=textRangeInfo(point.node,point.offset);textRange.moveToElementText(info.node);textRange.collapse(info.collapseToStart);textRange.moveStart('character',info.offset);return textRange;};var WrappedRange=function(sc,so,ec,eo){this.sc=sc;this.so=so;this.ec=ec;this.eo=eo;var nativeRange=function(){if(agent.isW3CRangeSupport){var w3cRange=document.createRange();w3cRange.setStart(sc,so);w3cRange.setEnd(ec,eo);return w3cRange;}else{var textRange=pointToTextRange({node:sc,offset:so});textRange.setEndPoint('EndToEnd',pointToTextRange({node:ec,offset:eo}));return textRange;}};this.getPoints=function(){return{sc:sc,so:so,ec:ec,eo:eo};};this.getStartPoint=function(){return{node:sc,offset:so};};this.getEndPoint=function(){return{node:ec,offset:eo};};this.select=function(){var nativeRng=nativeRange();if(agent.isW3CRangeSupport){var selection=document.getSelection();if(selection.rangeCount>0){selection.removeAllRanges();}
selection.addRange(nativeRng);}else{nativeRng.select();}
return this;};this.normalize=function(){var getVisiblePoint=function(point,isLeftToRight){if((dom.isVisiblePoint(point)&&!dom.isEdgePoint(point))||(dom.isVisiblePoint(point)&&dom.isRightEdgePoint(point)&&!isLeftToRight)||(dom.isVisiblePoint(point)&&dom.isLeftEdgePoint(point)&&isLeftToRight)||(dom.isVisiblePoint(point)&&dom.isBlock(point.node)&&dom.isEmpty(point.node))){return point;}
var block=dom.ancestor(point.node,dom.isBlock);if(((dom.isLeftEdgePointOf(point,block)||dom.isVoid(dom.prevPoint(point).node))&&!isLeftToRight)||((dom.isRightEdgePointOf(point,block)||dom.isVoid(dom.nextPoint(point).node))&&isLeftToRight)){if(dom.isVisiblePoint(point)){return point;}
isLeftToRight=!isLeftToRight;}
var nextPoint=isLeftToRight?dom.nextPointUntil(dom.nextPoint(point),dom.isVisiblePoint):dom.prevPointUntil(dom.prevPoint(point),dom.isVisiblePoint);return nextPoint||point;};var endPoint=getVisiblePoint(this.getEndPoint(),false);var startPoint=this.isCollapsed()?endPoint:getVisiblePoint(this.getStartPoint(),true);return new WrappedRange(startPoint.node,startPoint.offset,endPoint.node,endPoint.offset);};this.nodes=function(pred,options){pred=pred||func.ok;var includeAncestor=options&&options.includeAncestor;var fullyContains=options&&options.fullyContains;var startPoint=this.getStartPoint();var endPoint=this.getEndPoint();var nodes=[];var leftEdgeNodes=[];dom.walkPoint(startPoint,endPoint,function(point){if(dom.isEditable(point.node)){return;}
var node;if(fullyContains){if(dom.isLeftEdgePoint(point)){leftEdgeNodes.push(point.node);}
if(dom.isRightEdgePoint(point)&&list.contains(leftEdgeNodes,point.node)){node=point.node;}}else if(includeAncestor){node=dom.ancestor(point.node,pred);}else{node=point.node;}
if(node&&pred(node)){nodes.push(node);}},true);return list.unique(nodes);};this.commonAncestor=function(){return dom.commonAncestor(sc,ec);};this.expand=function(pred){var startAncestor=dom.ancestor(sc,pred);var endAncestor=dom.ancestor(ec,pred);if(!startAncestor&&!endAncestor){return new WrappedRange(sc,so,ec,eo);}
var boundaryPoints=this.getPoints();if(startAncestor){boundaryPoints.sc=startAncestor;boundaryPoints.so=0;}
if(endAncestor){boundaryPoints.ec=endAncestor;boundaryPoints.eo=dom.nodeLength(endAncestor);}
return new WrappedRange(boundaryPoints.sc,boundaryPoints.so,boundaryPoints.ec,boundaryPoints.eo);};this.collapse=function(isCollapseToStart){if(isCollapseToStart){return new WrappedRange(sc,so,sc,so);}else{return new WrappedRange(ec,eo,ec,eo);}};this.splitText=function(){var isSameContainer=sc===ec;var boundaryPoints=this.getPoints();if(dom.isText(ec)&&!dom.isEdgePoint(this.getEndPoint())){ec.splitText(eo);}
if(dom.isText(sc)&&!dom.isEdgePoint(this.getStartPoint())){boundaryPoints.sc=sc.splitText(so);boundaryPoints.so=0;if(isSameContainer){boundaryPoints.ec=boundaryPoints.sc;boundaryPoints.eo=eo-so;}}
return new WrappedRange(boundaryPoints.sc,boundaryPoints.so,boundaryPoints.ec,boundaryPoints.eo);};if(_.isUndefined(this.deleteContents))
this.deleteContents=function(){if(this.isCollapsed()){return this;}
var rng=this.splitText();var nodes=rng.nodes(null,{fullyContains:true});var point=dom.prevPointUntil(rng.getStartPoint(),function(point){return!list.contains(nodes,point.node);});var emptyParents=[];$.each(nodes,function(idx,node){var parent=node.parentNode;if(point.node!==parent&&dom.nodeLength(parent)===1){emptyParents.push(parent);}
dom.remove(node,false);});$.each(emptyParents,function(idx,node){dom.remove(node,false);});return new WrappedRange(point.node,point.offset,point.node,point.offset).normalize();};var makeIsOn=function(pred){return function(){var ancestor=dom.ancestor(sc,pred);return!!ancestor&&(ancestor===dom.ancestor(ec,pred));};};this.isOnEditable=makeIsOn(dom.isEditable);this.isOnList=makeIsOn(dom.isList);this.isOnAnchor=makeIsOn(dom.isAnchor);this.isOnCell=makeIsOn(dom.isCell);this.isLeftEdgeOf=function(pred){if(!dom.isLeftEdgePoint(this.getStartPoint())){return false;}
var node=dom.ancestor(this.sc,pred);return node&&dom.isLeftEdgeOf(this.sc,node);};this.isCollapsed=function(){return sc===ec&&so===eo;};this.wrapBodyInlineWithPara=function(){if(dom.isBodyContainer(sc)&&dom.isEmpty(sc)){sc.innerHTML=dom.emptyPara;return new WrappedRange(sc.firstChild,0,sc.firstChild,0);}
var rng=this.normalize();if(dom.isParaInline(sc)||dom.isPara(sc)){return rng;}
if(dom.isText(sc)){var node=sc;while(node.parentNode!==document){node=node.parentNode;if(/^(P|LI|H[1-7]|BUTTON|A|SPAN)/.test(node.nodeName.toUpperCase())){return this.normalize();}}}
var topAncestor;if(dom.isInline(rng.sc)){var ancestors=dom.listAncestor(rng.sc,func.not(dom.isInline));topAncestor=list.last(ancestors);if(!dom.isInline(topAncestor)){topAncestor=ancestors[ancestors.length-2]||rng.sc.childNodes[rng.so];}}else{topAncestor=rng.sc.childNodes[rng.so>0?rng.so-1:0];}
var inlineSiblings=dom.listPrev(topAncestor,dom.isParaInline).reverse();inlineSiblings=inlineSiblings.concat(dom.listNext(topAncestor.nextSibling,dom.isParaInline));if(inlineSiblings.length){var para=dom.wrap(list.head(inlineSiblings),'p');dom.appendChildNodes(para,list.tail(inlineSiblings));}
return this.normalize();};this.insertNode=function(node){var rng=this.wrapBodyInlineWithPara().deleteContents();var info=dom.splitPoint(rng.getStartPoint(),!dom.isBodyContainer(dom.ancestor(rng.sc,function(node){return dom.isBodyContainer(node)||dom.isPara(node)})));if(info.rightNode){info.rightNode.parentNode.insertBefore(node,info.rightNode);}else{info.container.appendChild(node);}
return node;};this.pasteHTML=function(markup){var contentsContainer=$('<div></div>').html(markup)[0];var childNodes=list.from(contentsContainer.childNodes);var rng=this.wrapBodyInlineWithPara().deleteContents();return childNodes.reverse().map(function(childNode){return rng.insertNode(childNode);}).reverse();};this.toString=function(){var nativeRng=nativeRange();return agent.isW3CRangeSupport?nativeRng.toString():nativeRng.text;};this.getWordRange=function(findAfter){var endPoint=this.getEndPoint();if(!dom.isCharPoint(endPoint)){return this;}
var startPoint=dom.prevPointUntil(endPoint,function(point){return!dom.isCharPoint(point);});if(findAfter){endPoint=dom.nextPointUntil(endPoint,function(point){return!dom.isCharPoint(point);});}
return new WrappedRange(startPoint.node,startPoint.offset,endPoint.node,endPoint.offset);};this.bookmark=function(editable){return{s:{path:dom.makeOffsetPath(editable,sc),offset:so},e:{path:dom.makeOffsetPath(editable,ec),offset:eo}};};this.paraBookmark=function(paras){return{s:{path:list.tail(dom.makeOffsetPath(list.head(paras),sc)),offset:so},e:{path:list.tail(dom.makeOffsetPath(list.last(paras),ec)),offset:eo}};};this.getClientRects=function(){var nativeRng=nativeRange();return nativeRng.getClientRects();};};return{WrappedRange:WrappedRange,create:function(sc,so,ec,eo){if(!arguments.length){if(agent.isW3CRangeSupport){var selection=document.getSelection();if(!selection||selection.rangeCount===0){return null;}else if(dom.isBody(selection.anchorNode)){return null;}
var nativeRng=selection.getRangeAt(0);sc=nativeRng.startContainer;so=nativeRng.startOffset;ec=nativeRng.endContainer;eo=nativeRng.endOffset;}else{var textRange=document.selection.createRange();var textRangeEnd=textRange.duplicate();textRangeEnd.collapse(false);var textRangeStart=textRange;textRangeStart.collapse(true);var startPoint=textRangeToPoint(textRangeStart,true),endPoint=textRangeToPoint(textRangeEnd,false);if(dom.isText(startPoint.node)&&dom.isLeftEdgePoint(startPoint)&&dom.isTextNode(endPoint.node)&&dom.isRightEdgePoint(endPoint)&&endPoint.node.nextSibling===startPoint.node){startPoint=endPoint;}
sc=startPoint.cont;so=startPoint.offset;ec=endPoint.cont;eo=endPoint.offset;}}else if(arguments.length===2){ec=sc;eo=so;}
return new WrappedRange(sc,so,ec,eo);},createFromNode:function(node){var sc=node;var so=0;var ec=node;var eo=dom.nodeLength(ec);if(dom.isVoid(sc)){so=dom.listPrev(sc).length-1;sc=sc.parentNode;}
if(dom.isBR(ec)){eo=dom.listPrev(ec).length-1;ec=ec.parentNode;}else if(dom.isVoid(ec)){eo=dom.listPrev(ec).length;ec=ec.parentNode;}
return this.create(sc,so,ec,eo);},createFromNodeBefore:function(node){return this.createFromNode(node).collapse(true);},createFromNodeAfter:function(node){return this.createFromNode(node).collapse();},createFromBookmark:function(editable,bookmark){var sc=dom.fromOffsetPath(editable,bookmark.s.path);var so=bookmark.s.offset;var ec=dom.fromOffsetPath(editable,bookmark.e.path);var eo=bookmark.e.offset;return new WrappedRange(sc,so,ec,eo);},createFromParaBookmark:function(bookmark,paras){var so=bookmark.s.offset;var eo=bookmark.e.offset;var sc=dom.fromOffsetPath(list.head(paras),bookmark.s.path);var ec=dom.fromOffsetPath(list.last(paras),bookmark.e.path);return new WrappedRange(sc,so,ec,eo);}};})();return range;});;

/* <inline asset> defined in bundle 'web.assets_backend' */
odoo.website_next_define='summernote/editing/Bullet';;

/* /web_editor/static/lib/summernote/src/js/editing/Bullet.js defined in bundle 'web.assets_backend' */
define(['summernote/core/list','summernote/core/func','summernote/core/dom','summernote/core/range'],function(list,func,dom,range){var Bullet=function(){this.insertOrderedList=function(){this.toggleList('OL');};this.insertUnorderedList=function(){this.toggleList('UL');};this.indent=function(){var self=this;var rng=range.create().wrapBodyInlineWithPara();var paras=rng.nodes(dom.isPara,{includeAncestor:true});var clustereds=list.clusterBy(paras,func.peq2('parentNode'));$.each(clustereds,function(idx,paras){var head=list.head(paras);if(dom.isLi(head)){self.wrapList(paras,head.parentNode.nodeName);}else{$.each(paras,function(idx,para){$(para).css('marginLeft',function(idx,val){return(parseInt(val,10)||0)+25;});});}});rng.select();};this.outdent=function(){var self=this;var rng=range.create().wrapBodyInlineWithPara();var paras=rng.nodes(dom.isPara,{includeAncestor:true});var clustereds=list.clusterBy(paras,func.peq2('parentNode'));$.each(clustereds,function(idx,paras){var head=list.head(paras);if(dom.isLi(head)){self.releaseList([paras]);}else{$.each(paras,function(idx,para){$(para).css('marginLeft',function(idx,val){val=(parseInt(val,10)||0);return val>25?val-25:'';});});}});rng.select();};this.toggleList=function(listName){var self=this;var rng=range.create().wrapBodyInlineWithPara();var paras=rng.nodes(dom.isPara,{includeAncestor:true});var bookmark=rng.paraBookmark(paras);var clustereds=list.clusterBy(paras,func.peq2('parentNode'));if(list.find(paras,dom.isPurePara)){var wrappedParas=[];$.each(clustereds,function(idx,paras){wrappedParas=wrappedParas.concat(self.wrapList(paras,listName));});paras=wrappedParas;}else{var diffLists=rng.nodes(dom.isList,{includeAncestor:true}).filter(function(listNode){return!$.nodeName(listNode,listName);});if(diffLists.length){$.each(diffLists,function(idx,listNode){dom.replace(listNode,listName);});}else{paras=this.releaseList(clustereds,true);}}
range.createFromParaBookmark(bookmark,paras).select();};this.wrapList=function(paras,listName){var head=list.head(paras);var last=list.last(paras);var prevList=dom.isList(head.previousSibling)&&head.previousSibling;var nextList=dom.isList(last.nextSibling)&&last.nextSibling;var listNode=prevList||dom.insertAfter(dom.create(listName||'UL'),last);paras=paras.map(function(para){return dom.isPurePara(para)?dom.replace(para,'LI'):para;});dom.appendChildNodes(listNode,paras);if(nextList){dom.appendChildNodes(listNode,list.from(nextList.childNodes));dom.remove(nextList);}
return paras;};this.releaseList=function(clustereds,isEscapseToBody){var releasedParas=[];$.each(clustereds,function(idx,paras){var head=list.head(paras);var last=list.last(paras);var headList=isEscapseToBody?dom.lastAncestor(head,dom.isList):head.parentNode;var lastList=headList.childNodes.length>1?dom.splitTree(headList,{node:last.parentNode,offset:dom.position(last)+1},{isSkipPaddingBlankHTML:true}):null;var middleList=dom.splitTree(headList,{node:head.parentNode,offset:dom.position(head)},{isSkipPaddingBlankHTML:true});paras=isEscapseToBody?dom.listDescendant(middleList,dom.isLi):list.from(middleList.childNodes).filter(dom.isLi);if(isEscapseToBody||!dom.isList(headList.parentNode)){paras=paras.map(function(para){return dom.replace(para,'P');});}
$.each(list.from(paras).reverse(),function(idx,para){dom.insertAfter(para,headList);});var rootLists=list.compact([headList,middleList,lastList]);$.each(rootLists,function(idx,rootList){var listNodes=[rootList].concat(dom.listDescendant(rootList,dom.isList));$.each(listNodes.reverse(),function(idx,listNode){if(!dom.nodeLength(listNode)){dom.remove(listNode,true);}});});releasedParas=releasedParas.concat(paras);});return releasedParas;};};return Bullet;});;

/* <inline asset> defined in bundle 'web.assets_backend' */
odoo.website_next_define='summernote/editing/History';;

/* /web_editor/static/lib/summernote/src/js/editing/History.js defined in bundle 'web.assets_backend' */
define(['summernote/core/range','summernote/core/dom'],function(range,dom){var History=function($editable){var stack=[],stackOffset=-1;var editable=$editable[0];var makeSnapshot=function(){var rng=range.create();var emptyBookmark={s:{path:[],offset:0},e:{path:[],offset:0}};return{contents:$editable.html(),bookmark:(rng&&dom.ancestor(rng.sc,dom.isEditable)?rng.bookmark(editable):emptyBookmark)};};var applySnapshot=function(snapshot){if(snapshot.contents!==null){$editable.html(snapshot.contents);}
if(snapshot.bookmark!==null){range.createFromBookmark(editable,snapshot.bookmark).select();}};this.undo=function(){if($editable.html()!==stack[stackOffset].contents){this.recordUndo();}
if(0<stackOffset){stackOffset--;applySnapshot(stack[stackOffset]);}};this.hasUndo=function(){return 0<stackOffset;};this.redo=function(){if(stack.length-1>stackOffset){stackOffset++;applySnapshot(stack[stackOffset]);}};this.hasRedo=function(){return stack.length-1>stackOffset;};var last;this.recordUndo=function(){var key=typeof event!=='undefined'?event:false;if(key&&!event.metaKey&&!event.ctrlKey&&!event.altKey&&event.type==="keydown"){key=event.type+"-";if(event.which===8||event.which===46)key+='delete';else if(event.which===13)key+='enter';else key+='other';if(key===last)return;hasUndo=true;}
last=key;if(stack.length>stackOffset+1){stack=stack.slice(0,stackOffset+1);}
if(stack[stackOffset]&&stack[stackOffset].contents===$editable.html()){return;}
stackOffset++;stack.push(makeSnapshot());};this.splitNext=function(){last=false;};this.reset=function(){last=false;stack=[];stackOffset=-1;this.recordUndo();};this.recordUndo();};return History;});;

/* <inline asset> defined in bundle 'web.assets_backend' */
odoo.website_next_define='summernote/editing/Style';;

/* /web_editor/static/lib/summernote/src/js/editing/Style.js defined in bundle 'web.assets_backend' */
define(['summernote/core/agent','summernote/core/func','summernote/core/list','summernote/core/dom'],function(agent,func,list,dom){var Style=function(){var jQueryCSS=function($obj,propertyNames){if(agent.jqueryVersion<1.9){var result={};$.each(propertyNames,function(idx,propertyName){result[propertyName]=$obj.css(propertyName);});return result;}
return $obj.css.call($obj,propertyNames);};this.fromNode=function($node){var properties=['font-family','font-size','text-align','list-style-type','line-height'];var styleInfo=jQueryCSS($node,properties)||{};styleInfo['font-size']=parseInt(styleInfo['font-size'],10);return styleInfo;};this.stylePara=function(rng,styleInfo){$.each(rng.nodes(dom.isPara,{includeAncestor:true}),function(idx,para){$(para).css(styleInfo);});};this.styleNodes=function(rng,options){rng=rng.splitText();var nodeName=options&&options.nodeName||'SPAN';var expandClosestSibling=!!(options&&options.expandClosestSibling);var onlyPartialContains=!!(options&&options.onlyPartialContains);if(rng.isCollapsed()){return[rng.insertNode(dom.create(nodeName))];}
var pred=dom.makePredByNodeName(nodeName);var nodes=rng.nodes(dom.isText,{fullyContains:true}).map(function(text){return dom.singleChildAncestor(text,pred)||dom.wrap(text,nodeName);});if(expandClosestSibling){if(onlyPartialContains){var nodesInRange=rng.nodes();pred=func.and(pred,function(node){return list.contains(nodesInRange,node);});}
return nodes.map(function(node){var siblings=dom.withClosestSiblings(node,pred);var head=list.head(siblings);var tails=list.tail(siblings);$.each(tails,function(idx,elem){dom.appendChildNodes(head,elem.childNodes);dom.remove(elem);});return list.head(siblings);});}else{return nodes;}};this.current=function(rng){var $cont=$(dom.isText(rng.sc)?rng.sc.parentNode:rng.sc);var styleInfo=this.fromNode($cont);styleInfo['font-bold']=document.queryCommandState('bold')?'bold':'normal';styleInfo['font-italic']=document.queryCommandState('italic')?'italic':'normal';styleInfo['font-underline']=document.queryCommandState('underline')?'underline':'normal';styleInfo['font-strikethrough']=document.queryCommandState('strikeThrough')?'strikethrough':'normal';styleInfo['font-superscript']=document.queryCommandState('superscript')?'superscript':'normal';styleInfo['font-subscript']=document.queryCommandState('subscript')?'subscript':'normal';if(!rng.isOnList()){styleInfo['list-style']='none';}else{var aOrderedType=['circle','disc','disc-leading-zero','square'];var isUnordered=$.inArray(styleInfo['list-style-type'],aOrderedType)>-1;styleInfo['list-style']=isUnordered?'unordered':'ordered';}
var para=dom.ancestor(rng.sc,dom.isPara);if(para&&para.style['line-height']){styleInfo['line-height']=para.style.lineHeight;}else{var lineHeight=parseInt(styleInfo['line-height'],10)/parseInt(styleInfo['font-size'],10);styleInfo['line-height']=lineHeight.toFixed(1);}
styleInfo.anchor=rng.isOnAnchor()&&dom.ancestor(rng.sc,dom.isAnchor);styleInfo.ancestors=dom.listAncestor(rng.sc,dom.isEditable);styleInfo.range=rng;return styleInfo;};};return Style;});;

/* <inline asset> defined in bundle 'web.assets_backend' */
odoo.website_next_define='summernote/editing/Table';;

/* /web_editor/static/lib/summernote/src/js/editing/Table.js defined in bundle 'web.assets_backend' */
define(['summernote/core/dom','summernote/core/range','summernote/core/list'],function(dom,range,list){var Table=function(){this.tab=function(rng,isShift){var cell=dom.ancestor(rng.commonAncestor(),dom.isCell);var table=dom.ancestor(cell,dom.isTable);var cells=dom.listDescendant(table,dom.isCell);var nextCell=list[isShift?'prev':'next'](cells,cell);if(nextCell){range.create(nextCell,0).select();}};this.createTable=function(colCount,rowCount){var tds=[],tdHTML;for(var idxCol=0;idxCol<colCount;idxCol++){tds.push('<td>'+dom.blank+'</td>');}
tdHTML=tds.join('');var trs=[],trHTML;for(var idxRow=0;idxRow<rowCount;idxRow++){trs.push('<tr>'+tdHTML+'</tr>');}
trHTML=trs.join('');return $('<table class="table table-bordered">'+trHTML+'</table>')[0];};};return Table;});;

/* <inline asset> defined in bundle 'web.assets_backend' */
odoo.website_next_define='summernote/editing/Typing';;

/* /web_editor/static/lib/summernote/src/js/editing/Typing.js defined in bundle 'web.assets_backend' */
define(['summernote/core/dom','summernote/core/range','summernote/editing/Bullet'],function(dom,range,Bullet){var Typing=function(){var bullet=new Bullet();this.insertTab=function($editable,rng,tabsize){var tab=dom.createText(new Array(tabsize+1).join(dom.NBSP_CHAR));rng=rng.deleteContents();rng.insertNode(tab,true);rng=range.create(tab,tabsize);rng.select();};this.insertParagraph=function(){var rng=range.create();rng=rng.deleteContents();rng=rng.wrapBodyInlineWithPara();var splitRoot=dom.ancestor(rng.sc,dom.isPara);var nextPara;if(splitRoot){if(dom.isEmpty(splitRoot)&&dom.isLi(splitRoot)){bullet.toggleList(splitRoot.parentNode.nodeName);return;}else{nextPara=dom.splitTree(splitRoot,rng.getStartPoint());var emptyAnchors=dom.listDescendant(splitRoot,dom.isEmptyAnchor);emptyAnchors=emptyAnchors.concat(dom.listDescendant(nextPara,dom.isEmptyAnchor));$.each(emptyAnchors,function(idx,anchor){dom.remove(anchor);});}}else{var next=rng.sc.childNodes[rng.so];nextPara=$(dom.emptyPara)[0];if(next){rng.sc.insertBefore(nextPara,next);}else{rng.sc.appendChild(nextPara);}}
range.create(nextPara,0).normalize().select();};};return Typing;});;

/* <inline asset> defined in bundle 'web.assets_backend' */
odoo.website_next_define='summernote/module/Editor';;

/* /web_editor/static/lib/summernote/src/js/module/Editor.js defined in bundle 'web.assets_backend' */
define(['summernote/core/agent','summernote/core/func','summernote/core/list','summernote/core/dom','summernote/core/range','summernote/core/async','summernote/editing/Style','summernote/editing/Typing','summernote/editing/Table','summernote/editing/Bullet'],function(agent,func,list,dom,range,async,Style,Typing,Table,Bullet){var KEY_BOGUS='bogus';var Editor=function(handler){var self=this;var style=new Style();var table=new Table();var typing=new Typing();var bullet=new Bullet();this.style=style;this.table=table;this.typing=typing;this.bullet=bullet;this.createRange=function($editable){this.focus($editable);return range.create();};this.saveRange=function($editable,thenCollapse){var r=range.create();if(!r||($editable[0]!==r.sc&&!$.contains($editable[0],r.sc))){$editable.focus();}
$editable.data('range',range.create());if(thenCollapse){range.create().collapse().select();}};this.saveNode=function($editable){var copy=[];for(var key=0,len=$editable[0].childNodes.length;key<len;key++){copy.push($editable[0].childNodes[key]);}
$editable.data('childNodes',copy);};this.restoreRange=function($editable){var rng=$editable.data('range');if(rng){rng.select();this.focus($editable);}};this.restoreNode=function($editable){$editable.html('');var child=$editable.data('childNodes');for(var index=0,len=child.length;index<len;index++){$editable[0].appendChild(child[index]);}};this.currentStyle=function(target){var rng=range.create();var styleInfo=rng&&rng.isOnEditable()?style.current(rng.normalize()):{};if(dom.isImg(target)){styleInfo.image=target;}
return styleInfo;};this.styleFromNode=function($node){return style.fromNode($node);};var triggerOnBeforeChange=function($editable){var $holder=dom.makeLayoutInfo($editable).holder();handler.bindCustomEvent($holder,$editable.data('callbacks'),'before.command')($editable.html(),$editable);};var triggerOnChange=function($editable){var $holder=dom.makeLayoutInfo($editable).holder();handler.bindCustomEvent($holder,$editable.data('callbacks'),'change')($editable.html(),$editable);};this.undo=function($editable){triggerOnBeforeChange($editable);$editable.data('NoteHistory').undo();triggerOnChange($editable);};this.redo=function($editable){triggerOnBeforeChange($editable);$editable.data('NoteHistory').redo();triggerOnChange($editable);};var beforeCommand=this.beforeCommand=function($editable){triggerOnBeforeChange($editable);self.focus($editable);};var afterCommand=this.afterCommand=function($editable,isPreventTrigger){$editable.data('NoteHistory').recordUndo();if(!isPreventTrigger){triggerOnChange($editable);}};var commands=['bold','italic','underline','strikethrough','superscript','subscript','justifyLeft','justifyCenter','justifyRight','justifyFull','formatBlock','removeFormat','backColor','foreColor','fontName'];for(var idx=0,len=commands.length;idx<len;idx++){this[commands[idx]]=(function(sCmd){return function($editable,value){beforeCommand($editable);document.execCommand(sCmd,false,value);afterCommand($editable,true);};})(commands[idx]);}
this.tab=function($editable,options){var rng=this.createRange($editable);if(rng.isCollapsed()&&rng.isOnCell()){table.tab(rng);}else{beforeCommand($editable);typing.insertTab($editable,rng,options.tabsize);afterCommand($editable);}};this.untab=function($editable){var rng=this.createRange($editable);if(rng.isCollapsed()&&rng.isOnCell()){table.tab(rng,true);}};this.insertParagraph=function($editable){beforeCommand($editable);typing.insertParagraph($editable);afterCommand($editable);};this.insertOrderedList=function($editable){beforeCommand($editable);bullet.insertOrderedList($editable);afterCommand($editable);};this.insertUnorderedList=function($editable){beforeCommand($editable);bullet.insertUnorderedList($editable);afterCommand($editable);};this.indent=function($editable){beforeCommand($editable);bullet.indent($editable);afterCommand($editable);};this.outdent=function($editable){beforeCommand($editable);bullet.outdent($editable);afterCommand($editable);};this.insertImage=function($editable,sUrl,filename){async.createImage(sUrl,filename).then(function($image){beforeCommand($editable);$image.css({display:'',width:Math.min($editable.width(),$image.width())});range.create().insertNode($image[0]);range.createFromNodeAfter($image[0]).select();afterCommand($editable);}).fail(function(){var $holder=dom.makeLayoutInfo($editable).holder();handler.bindCustomEvent($holder,$editable.data('callbacks'),'image.upload.error')();});};this.insertNode=function($editable,node){beforeCommand($editable);range.create().insertNode(node);range.createFromNodeAfter(node).select();afterCommand($editable);};this.insertText=function($editable,text){beforeCommand($editable);var textNode=range.create().insertNode(dom.createText(text));range.create(textNode,dom.nodeLength(textNode)).select();afterCommand($editable);};this.pasteHTML=function($editable,markup){beforeCommand($editable);var contents=range.create().pasteHTML(markup);range.createFromNodeAfter(list.last(contents)).select();afterCommand($editable);};this.formatBlock=function($editable,tagName){beforeCommand($editable);tagName=agent.isMSIE?'<'+tagName+'>':tagName;document.execCommand('FormatBlock',false,tagName);afterCommand($editable);};this.formatPara=function($editable){beforeCommand($editable);this.formatBlock($editable,'P');afterCommand($editable);};for(var idx=1;idx<=6;idx++){this['formatH'+idx]=function(idx){return function($editable){this.formatBlock($editable,'H'+idx);};}(idx);};this.fontSize=function($editable,value){var rng=range.create();if(rng.isCollapsed()){var spans=style.styleNodes(rng);var firstSpan=list.head(spans);$(spans).css({'font-size':value+'px'});if(firstSpan&&!dom.nodeLength(firstSpan)){firstSpan.innerHTML=dom.ZERO_WIDTH_NBSP_CHAR;range.createFromNodeAfter(firstSpan.firstChild).select();$editable.data(KEY_BOGUS,firstSpan);}}else{beforeCommand($editable);$(style.styleNodes(rng)).css({'font-size':value+'px'});afterCommand($editable);}};this.insertHorizontalRule=function($editable){beforeCommand($editable);var rng=range.create();var hrNode=rng.insertNode($('<HR/>')[0]);if(hrNode.nextSibling){range.create(hrNode.nextSibling,0).normalize().select();}
afterCommand($editable);};this.removeBogus=function($editable){var bogusNode=$editable.data(KEY_BOGUS);if(!bogusNode){return;}
var textNode=list.find(list.from(bogusNode.childNodes),dom.isText);var bogusCharIdx=textNode.nodeValue.indexOf(dom.ZERO_WIDTH_NBSP_CHAR);if(bogusCharIdx!==-1){textNode.deleteData(bogusCharIdx,1);}
if(dom.isEmpty(bogusNode)){dom.remove(bogusNode);}
$editable.removeData(KEY_BOGUS);};this.lineHeight=function($editable,value){beforeCommand($editable);style.stylePara(range.create(),{lineHeight:value});afterCommand($editable);};this.unlink=function($editable){var rng=this.createRange($editable);if(rng.isOnAnchor()){var anchor=dom.ancestor(rng.sc,dom.isAnchor);rng=range.createFromNode(anchor);rng.select();beforeCommand($editable);document.execCommand('unlink');afterCommand($editable);}};this.createLink=function($editable,linkInfo,options){var linkUrl=linkInfo.url;var linkText=linkInfo.text;var isNewWindow=linkInfo.isNewWindow;var className=linkInfo.className||null;var rng=linkInfo.range||this.createRange($editable);var isTextChanged=rng.toString()!==linkText;options=options||dom.makeLayoutInfo($editable).editor().data('options');beforeCommand($editable);if(options.onCreateLink){linkUrl=options.onCreateLink(linkUrl);}
var anchors=[];var ancestor_anchor=dom.ancestor(rng.sc,dom.isAnchor);if(ancestor_anchor){anchors.push($(ancestor_anchor).html(linkText).get(0));}else if(isTextChanged){var anchor=rng.insertNode($('<A>'+linkText+'</A>')[0]);anchors.push(anchor);}else{anchors=style.styleNodes(rng,{nodeName:'A',expandClosestSibling:true,onlyPartialContains:true});}
$.each(anchors,function(idx,anchor){$(anchor).attr('href',linkUrl);$(anchor).attr('class',className);if(isNewWindow){$(anchor).attr('target','_blank');}else{$(anchor).removeAttr('target');}});var startRange=range.createFromNodeBefore(list.head(anchors));var startPoint=startRange.getStartPoint();var endRange=range.createFromNodeAfter(list.last(anchors));var endPoint=endRange.getEndPoint();range.create(startPoint.node,startPoint.offset,endPoint.node,endPoint.offset).select();afterCommand($editable);};this.getLinkInfo=function($editable){this.focus($editable);var rng=range.create().expand(dom.isAnchor);var $anchor=$(list.head(rng.nodes(dom.isAnchor)));return{range:rng,text:rng.toString(),isNewWindow:$anchor.length?$anchor.attr('target')==='_blank':false,url:$anchor.length?$anchor.attr('href'):''};};this.color=function($editable,sObjColor){var oColor=JSON.parse(sObjColor);var foreColor=oColor.foreColor,backColor=oColor.backColor;beforeCommand($editable);if(foreColor){document.execCommand('foreColor',false,foreColor);}
if(backColor){document.execCommand('backColor',false,backColor);}
afterCommand($editable);};this.insertTable=function($editable,sDim){var dimension=sDim.split('x');beforeCommand($editable);var rng=range.create().deleteContents();rng.insertNode(table.createTable(dimension[0],dimension[1]));afterCommand($editable);};this.floatMe=function($editable,value,$target){beforeCommand($editable);$target.removeClass('pull-left pull-right');if(value&&value!=='none'){$target.addClass('pull-'+value);}
$target.css('float',value);afterCommand($editable);};this.imageShape=function($editable,value,$target){beforeCommand($editable);$target.removeClass('img-rounded img-circle img-thumbnail');if(value){$target.addClass(value);}
afterCommand($editable);};this.resize=function($editable,value,$target){beforeCommand($editable);$target.css({width:value*100+'%',height:''});afterCommand($editable);};this.resizeTo=function(pos,$target,bKeepRatio){var imageSize;if(bKeepRatio){var newRatio=pos.y/pos.x;var ratio=$target.data('ratio');imageSize={width:ratio>newRatio?pos.x:pos.y/ratio,height:ratio>newRatio?pos.x*ratio:pos.y};}else{imageSize={width:pos.x,height:pos.y};}
$target.css(imageSize);};this.removeMedia=function($editable,value,$target){beforeCommand($editable);$target.detach();handler.bindCustomEvent($(),$editable.data('callbacks'),'media.delete')($target,$editable);afterCommand($editable);};this.focus=function($editable){$editable.focus();if(agent.isFF){var rng=range.create();if(!rng||rng.isOnEditable()){return;}
range.createFromNode($editable[0]).normalize().collapse().select();}};this.isEmpty=function($editable){return dom.isEmpty($editable[0])||dom.emptyPara===$editable.html();};};return Editor;});;

/* <inline asset> defined in bundle 'web.assets_backend' */
odoo.website_next_define='summernote/module/Button';;

/* /web_editor/static/lib/summernote/src/js/module/Button.js defined in bundle 'web.assets_backend' */
define(['summernote/core/list','summernote/core/agent'],function(list,agent){var Button=function(){this.update=function($container,styleInfo){var checkDropdownMenu=function($btn,value){$btn.find('.dropdown-menu li a').each(function(){var isChecked=($(this).data('value')+'')===(value+'');this.className=isChecked?'checked':'';});};var btnState=function(selector,pred){var $btn=$container.find(selector);$btn.toggleClass('active',pred());};if(styleInfo.image){var $img=$(styleInfo.image);btnState('button[data-event="imageShape"][data-value="img-rounded"]',function(){return $img.hasClass('img-rounded');});btnState('button[data-event="imageShape"][data-value="img-circle"]',function(){return $img.hasClass('img-circle');});btnState('button[data-event="imageShape"][data-value="img-thumbnail"]',function(){return $img.hasClass('img-thumbnail');});btnState('button[data-event="imageShape"]:not([data-value])',function(){return!$img.is('.img-rounded, .img-circle, .img-thumbnail');});var imgFloat=$img.css('float');btnState('button[data-event="floatMe"][data-value="left"]',function(){return imgFloat==='left';});btnState('button[data-event="floatMe"][data-value="right"]',function(){return imgFloat==='right';});btnState('button[data-event="floatMe"][data-value="none"]',function(){return imgFloat!=='left'&&imgFloat!=='right';});var style=$img.attr('style');btnState('button[data-event="resize"][data-value="1"]',function(){return!!/(^|\s)(max-)?width\s*:\s*100%/.test(style);});btnState('button[data-event="resize"][data-value="0.5"]',function(){return!!/(^|\s)(max-)?width\s*:\s*50%/.test(style);});btnState('button[data-event="resize"][data-value="0.25"]',function(){return!!/(^|\s)(max-)?width\s*:\s*25%/.test(style);});return;}
var $fontname=$container.find('.note-fontname');if($fontname.length){var selectedFont=styleInfo['font-family'];if(!!selectedFont){var list=selectedFont.split(',');for(var i=0,len=list.length;i<len;i++){selectedFont=list[i].replace(/[\'\"]/g,'').replace(/\s+$/,'').replace(/^\s+/,'');if(agent.isFontInstalled(selectedFont)){break;}}
$fontname.find('.note-current-fontname').text(selectedFont);checkDropdownMenu($fontname,selectedFont);}}
var $fontsize=$container.find('.note-fontsize');$fontsize.find('.note-current-fontsize').text(styleInfo['font-size']);checkDropdownMenu($fontsize,parseFloat(styleInfo['font-size']));var $lineHeight=$container.find('.note-height');checkDropdownMenu($lineHeight,parseFloat(styleInfo['line-height']));btnState('button[data-event="bold"]',function(){return styleInfo['font-bold']==='bold';});btnState('button[data-event="italic"]',function(){return styleInfo['font-italic']==='italic';});btnState('button[data-event="underline"]',function(){return styleInfo['font-underline']==='underline';});btnState('button[data-event="strikethrough"]',function(){return styleInfo['font-strikethrough']==='strikethrough';});btnState('button[data-event="superscript"]',function(){return styleInfo['font-superscript']==='superscript';});btnState('button[data-event="subscript"]',function(){return styleInfo['font-subscript']==='subscript';});btnState('button[data-event="justifyLeft"]',function(){return styleInfo['text-align']==='left'||styleInfo['text-align']==='start';});btnState('button[data-event="justifyCenter"]',function(){return styleInfo['text-align']==='center';});btnState('button[data-event="justifyRight"]',function(){return styleInfo['text-align']==='right';});btnState('button[data-event="justifyFull"]',function(){return styleInfo['text-align']==='justify';});btnState('button[data-event="insertUnorderedList"]',function(){return styleInfo['list-style']==='unordered';});btnState('button[data-event="insertOrderedList"]',function(){return styleInfo['list-style']==='ordered';});};this.updateRecentColor=function(button,eventName,value){var $color=$(button).closest('.note-color');var $recentColor=$color.find('.note-recent-color');var colorInfo=JSON.parse($recentColor.attr('data-value'));colorInfo[eventName]=value;$recentColor.attr('data-value',JSON.stringify(colorInfo));var sKey=eventName==='backColor'?'background-color':'color';$recentColor.find('i').css(sKey,value);};};return Button;});;

/* <inline asset> defined in bundle 'web.assets_backend' */
odoo.website_next_define='summernote/module/Clipboard';;

/* /web_editor/static/lib/summernote/src/js/module/Clipboard.js defined in bundle 'web.assets_backend' */
define(['summernote/core/list','summernote/core/dom','summernote/core/key','summernote/core/agent','summernote/core/range'],function(list,dom,key,agent,range){var Clipboard=function(handler){var $paste;this.attach=function(layoutInfo){if(agent.isMSIE&&agent.browserVersion>10){$paste=$('<div />').attr('contenteditable',true).css({position:'absolute',left:-100000,opacity:0});layoutInfo.editable().on('keydown',function(e){if(e.ctrlKey&&e.keyCode===key.code.V){handler.invoke('saveRange',layoutInfo.editable());$paste.focus();setTimeout(function(){pasteByHook(layoutInfo);},0);}});layoutInfo.editable().before($paste);}else{layoutInfo.editable().on('paste',pasteByEvent);}};var pasteByHook=function(layoutInfo){var $editable=layoutInfo.editable();var node=$paste[0].firstChild;if(dom.isImg(node)){var dataURI=node.src;var decodedData=atob(dataURI.split(',')[1]);var array=new Uint8Array(decodedData.length);for(var i=0;i<decodedData.length;i++){array[i]=decodedData.charCodeAt(i);}
var blob=new Blob([array],{type:'image/png'});blob.name='clipboard.png';handler.invoke('restoreRange',$editable);handler.invoke('focus',$editable);handler.insertImages(layoutInfo,[blob]);}else{var pasteContent=$('<div />').html($paste.html()).html();handler.invoke('restoreRange',$editable);handler.invoke('focus',$editable);if(pasteContent){handler.invoke('pasteHTML',$editable,pasteContent);}}
$paste.empty();};var pasteByEvent=function(event){var clipboardData=event.originalEvent.clipboardData;var layoutInfo=dom.makeLayoutInfo(event.currentTarget||event.target);var $editable=layoutInfo.editable();if(["INPUT","TEXTAREA"].indexOf(event.target.tagName)!==-1){return;}
if(clipboardData&&clipboardData.items&&clipboardData.items.length){var item=list.head(clipboardData.items);if(item.kind==='file'&&item.type.indexOf('image/')!==-1){handler.insertImages(layoutInfo,[item.getAsFile()]);}
handler.invoke('editor.afterCommand',$editable);}
event.preventDefault();var html=clipboardData.getData("text/html");var $node=$('<div/>').html(html);if(!html){$node.text(clipboardData.getData("text/plain")).html(function(_,html){return html.replace(/\r?\n/g,'<br>');});}
pasteContent($node,layoutInfo,$editable);};var filter_tag=function($nodes,$editable){return $nodes.each(function(){var $node=$(this);if($node.attr('style')){var style=_.filter(_.compact($node.attr('style').split(/\s*;\s*/)),function(style){style=style.split(/\s*:\s*/);return/width|height|color|background-color|font-weight|text-align|font-style|text-decoration/i.test(style[0])&&!(style[1]==='initial'||style[1]==='inherit'||$node.css(style[0])===$editable.css(style[0])||(style[0]==='background-color'&&style[1]==='rgb(255, 255, 255)')||(style[0]==='color'&&style[1]==='rgb(0, 0, 0)'));}).join(';');if(style.length){$node.attr('style',style);}else{$node.removeAttr('style');}}
if($node.attr('class')){var classes=_.filter($node.attr('class').split(/\s+/),function(style){return/(^|\s)(fa|pull|text|bg)(\s|-|$)/.test(style);}).join(' ');if(classes.length){$node.attr('class',classes);}else{$node.removeAttr('class');}}});};var pasteContent=function($node,layoutInfo,$editable){$node.find('meta, script, style').remove();filter_tag($node.find('*'),$editable).removeAttr('title','alt','id','contenteditable');$node.find('span, font').filter(':not([class]):not([style])').each(function(){$(this).replaceWith($(this).contents());});$node.find('span + span').each(function(){if(dom.isText(this.previousSibling)){if(dom.isVisibleText(this.previousSibling)){return;}else{$(this).prev().append(this.previousSibling);}}
if($(this).attr('class')===$(this).prev().attr('class')&&$(this).attr('style')===$(this).prev().attr('style')){$(this).prev().append($(this).contents());$(this).remove();}});var $tdr;while(($tdr=$node.find('tr:empty, td:empty, th:empty, tbody:empty, t-head:empty, table:empty'))&&$tdr.length){$tdr.remove();}
var $arch=$('<div/>');var $last=$arch;$node.contents().each(function(){if(dom.isBR(this)){$(this).remove();$last=$('<p/>');$arch.append($last);}else if(/h[0-9]+|li|table|p/i.test(this.tagName)){$last=$('<p/>');$arch.append(this).append($last);}else if($arch.is(':empty')&&dom.isText(this)){$last=$('<p/>').append(this);$arch.append($last);}else if(this.nodeType!==Node.COMMENT_NODE){$last.append(this);}});$arch.find(':not([class]):not([style]):empty, p:empty').remove();$editable.data('NoteHistory').recordUndo($editable,"paste");var r=range.create();if(!r.isCollapsed()){r=r.deleteContents();r.select();}
var $nodes=$();$editable.on('DOMNodeInserted',function(event){$nodes=$nodes.add(event.originalEvent.target);});window.document.execCommand('insertHTML',false,$arch.html());$editable.off('DOMNodeInserted');var $span=$nodes.filter('span');$span=$span.first().add($span.last());$span=$span.add($span.prev('span'));$span=$span.add($span.next('span'));filter_tag($span,$editable);$span.not('[span], [style]').each(function(){_.each(this.childNodes,function(node){$(node.parentNode).after(node);});$(this).remove();});r=range.create();if(!dom.isText(r.ec)){r=range.create(r.sc.childNodes[r.so],dom.nodeLength(r.sc.childNodes[r.so]));}
r.clean().select();$editable.trigger('content_changed');};};return Clipboard;});;

/* <inline asset> defined in bundle 'web.assets_backend' */
odoo.website_next_define='summernote/module/Codeview';;

/* /web_editor/static/lib/summernote/src/js/module/Codeview.js defined in bundle 'web.assets_backend' */
define(['summernote/core/agent','summernote/core/dom'],function(agent,dom){var CodeMirror;if(agent.hasCodeMirror){if(agent.isSupportAmd){require(['CodeMirror'],function(cm){CodeMirror=cm;});}else{CodeMirror=window.CodeMirror;}}
var Codeview=function(handler){this.sync=function(layoutInfo){var isCodeview=handler.invoke('codeview.isActivated',layoutInfo);if(isCodeview&&agent.hasCodeMirror){layoutInfo.codable().data('cmEditor').save();}};this.isActivated=function(layoutInfo){var $editor=layoutInfo.editor();return $editor.hasClass('codeview');};this.toggle=function(layoutInfo){if(this.isActivated(layoutInfo)){this.deactivate(layoutInfo);}else{this.activate(layoutInfo);}};this.activate=function(layoutInfo){var $editor=layoutInfo.editor(),$toolbar=layoutInfo.toolbar(),$editable=layoutInfo.editable(),$codable=layoutInfo.codable(),$popover=layoutInfo.popover(),$handle=layoutInfo.handle();var options=$editor.data('options');$codable.val(dom.html($editable,options.prettifyHtml));$codable.height($editable.height());handler.invoke('toolbar.updateCodeview',$toolbar,true);handler.invoke('popover.hide',$popover);handler.invoke('handle.hide',$handle);$editor.addClass('codeview');$codable.focus();if(agent.hasCodeMirror){var cmEditor=CodeMirror.fromTextArea($codable[0],options.codemirror);if(options.codemirror.tern){var server=new CodeMirror.TernServer(options.codemirror.tern);cmEditor.ternServer=server;cmEditor.on('cursorActivity',function(cm){server.updateArgHints(cm);});}
cmEditor.setSize(null,$editable.outerHeight());$codable.data('cmEditor',cmEditor);}};this.deactivate=function(layoutInfo){var $holder=layoutInfo.holder(),$editor=layoutInfo.editor(),$toolbar=layoutInfo.toolbar(),$editable=layoutInfo.editable(),$codable=layoutInfo.codable();var options=$editor.data('options');if(agent.hasCodeMirror){var cmEditor=$codable.data('cmEditor');$codable.val(cmEditor.getValue());cmEditor.toTextArea();}
var value=dom.value($codable,options.prettifyHtml)||dom.emptyPara;var isChange=$editable.html()!==value;$editable.html(value);$editable.height(options.height?$codable.height():'auto');$editor.removeClass('codeview');if(isChange){handler.bindCustomEvent($holder,$editable.data('callbacks'),'change')($editable.html(),$editable);}
$editable.focus();handler.invoke('toolbar.updateCodeview',$toolbar,false);};};return Codeview;});;

/* <inline asset> defined in bundle 'web.assets_backend' */
odoo.website_next_define='summernote/module/DragAndDrop';;

/* /web_editor/static/lib/summernote/src/js/module/DragAndDrop.js defined in bundle 'web.assets_backend' */
define(['summernote/core/dom'],function(dom){var DragAndDrop=function(handler){var $document=$(document);this.attach=function(layoutInfo,options){if(options.airMode||options.disableDragAndDrop){$document.on('drop',function(e){e.preventDefault();});}else{this.attachDragAndDropEvent(layoutInfo,options);}};this.attachDragAndDropEvent=function(layoutInfo,options){var collection=$(),$editor=layoutInfo.editor(),$dropzone=layoutInfo.dropzone(),$dropzoneMessage=$dropzone.find('.note-dropzone-message');$document.on('dragenter',function(e){var isCodeview=handler.invoke('codeview.isActivated',layoutInfo);var hasEditorSize=$editor.width()>0&&$editor.height()>0;if(!isCodeview&&!collection.length&&hasEditorSize){$editor.addClass('dragover');$dropzone.width($editor.width());$dropzone.height($editor.height());$dropzoneMessage.text(options.langInfo.image.dragImageHere);}
collection=collection.add(e.target);}).on('dragleave',function(e){collection=collection.not(e.target);if(!collection.length){$editor.removeClass('dragover');}}).on('drop',function(){collection=$();$editor.removeClass('dragover');});$dropzone.on('dragenter',function(){$dropzone.addClass('hover');$dropzoneMessage.text(options.langInfo.image.dropImage);}).on('dragleave',function(){$dropzone.removeClass('hover');$dropzoneMessage.text(options.langInfo.image.dragImageHere);});$dropzone.on('drop',function(event){var dataTransfer=event.originalEvent.dataTransfer;var layoutInfo=dom.makeLayoutInfo(event.currentTarget||event.target);if(dataTransfer&&dataTransfer.files&&dataTransfer.files.length){event.preventDefault();layoutInfo.editable().focus();handler.insertImages(layoutInfo,dataTransfer.files);}else{var insertNodefunc=function(){layoutInfo.holder().summernote('insertNode',this);};for(var i=0,len=dataTransfer.types.length;i<len;i++){var type=dataTransfer.types[i];var content=dataTransfer.getData(type);if(type.toLowerCase().indexOf('text')>-1){layoutInfo.holder().summernote('pasteHTML',content);}else{$(content).each(insertNodefunc);}}}}).on('dragover',false);};};return DragAndDrop;});;

/* <inline asset> defined in bundle 'web.assets_backend' */
odoo.website_next_define='summernote/module/Fullscreen';;

/* /web_editor/static/lib/summernote/src/js/module/Fullscreen.js defined in bundle 'web.assets_backend' */
define([],function(){var Fullscreen=function(handler){var $window=$(window);var $scrollbar=$('html, body');this.toggle=function(layoutInfo){var $editor=layoutInfo.editor(),$toolbar=layoutInfo.toolbar(),$editable=layoutInfo.editable(),$codable=layoutInfo.codable();var resize=function(size){$editable.css('height',size.h);$codable.css('height',size.h);if($codable.data('cmeditor')){$codable.data('cmeditor').setsize(null,size.h);}};$editor.toggleClass('fullscreen');var isFullscreen=$editor.hasClass('fullscreen');if(isFullscreen){$editable.data('orgheight',$editable.css('height'));$window.on('resize',function(){resize({h:$window.height()-$toolbar.outerHeight()});}).trigger('resize');$scrollbar.css('overflow','hidden');}else{$window.off('resize');resize({h:$editable.data('orgheight')});$scrollbar.css('overflow','visible');}
handler.invoke('toolbar.updateFullscreen',$toolbar,isFullscreen);};};return Fullscreen;});;

/* <inline asset> defined in bundle 'web.assets_backend' */
odoo.website_next_define='summernote/module/Handle';;

/* /web_editor/static/lib/summernote/src/js/module/Handle.js defined in bundle 'web.assets_backend' */
define(['summernote/core/dom'],function(dom){var Handle=function(handler){var $document=$(document);var hHandleMousedown=function(event){if(dom.isControlSizing(event.target)){event.preventDefault();event.stopPropagation();var layoutInfo=dom.makeLayoutInfo(event.target),$handle=layoutInfo.handle(),$popover=layoutInfo.popover(),$editable=layoutInfo.editable(),$editor=layoutInfo.editor();var target=$handle.find('.note-control-selection').data('target'),$target=$(target),posStart=$target.offset(),scrollTop=$document.scrollTop();var isAirMode=$editor.data('options').airMode;$document.on('mousemove',function(event){handler.invoke('editor.resizeTo',{x:event.clientX-posStart.left,y:event.clientY-(posStart.top-scrollTop)},$target,!event.shiftKey);handler.invoke('handle.update',$handle,{image:target},isAirMode);handler.invoke('popover.update',$popover,{image:target},isAirMode);}).one('mouseup',function(){$document.off('mousemove');handler.invoke('editor.afterCommand',$editable);});if(!$target.data('ratio')){$target.data('ratio',$target.height()/$target.width());}}};this.attach=function(layoutInfo){layoutInfo.handle().on('mousedown',hHandleMousedown);};this.update=function($handle,styleInfo,isAirMode){var $selection=$handle.find('.note-control-selection');if(styleInfo.image){var $image=$(styleInfo.image);var pos=isAirMode?$image.offset():$image.position();var imageSize={w:$image.outerWidth(true),h:$image.outerHeight(true)};$selection.css({display:'block',left:pos.left,top:pos.top,width:imageSize.w,height:imageSize.h}).data('target',styleInfo.image);var sizingText=imageSize.w+'x'+imageSize.h;$selection.find('.note-control-selection-info').text(sizingText);}else{$selection.hide();}};this.hide=function($handle){$handle.children().hide();};};return Handle;});;

/* <inline asset> defined in bundle 'web.assets_backend' */
odoo.website_next_define='summernote/module/HelpDialog';;

/* /web_editor/static/lib/summernote/src/js/module/HelpDialog.js defined in bundle 'web.assets_backend' */
define([],function(){var HelpDialog=function(handler){this.showHelpDialog=function($editable,$dialog){return $.Deferred(function(deferred){var $helpDialog=$dialog.find('.note-help-dialog');$helpDialog.one('hidden.bs.modal',function(){deferred.resolve();}).modal('show');}).promise();};this.show=function(layoutInfo){var $dialog=layoutInfo.dialog(),$editable=layoutInfo.editable();handler.invoke('editor.saveRange',$editable,true);this.showHelpDialog($editable,$dialog).then(function(){handler.invoke('editor.restoreRange',$editable);});};};return HelpDialog;});;

/* <inline asset> defined in bundle 'web.assets_backend' */
odoo.website_next_define='summernote/module/ImageDialog';;

/* /web_editor/static/lib/summernote/src/js/module/ImageDialog.js defined in bundle 'web.assets_backend' */
define(['summernote/core/key'],function(key){var ImageDialog=function(handler){var toggleBtn=function($btn,isEnable){$btn.toggleClass('disabled',!isEnable);$btn.attr('disabled',!isEnable);};var bindEnterKey=function($input,$btn){$input.on('keypress',function(event){if(event.keyCode===key.code.ENTER){$btn.trigger('click');}});};this.show=function(layoutInfo){var $dialog=layoutInfo.dialog(),$editable=layoutInfo.editable();handler.invoke('editor.saveRange',$editable);this.showImageDialog($editable,$dialog).then(function(data){handler.invoke('editor.restoreRange',$editable);if(typeof data==='string'){handler.invoke('editor.insertImage',$editable,data);}else{handler.insertImages(layoutInfo,data);}}).fail(function(){handler.invoke('editor.restoreRange',$editable);});};this.showImageDialog=function($editable,$dialog){return $.Deferred(function(deferred){var $imageDialog=$dialog.find('.note-image-dialog');var $imageInput=$dialog.find('.note-image-input'),$imageUrl=$dialog.find('.note-image-url'),$imageBtn=$dialog.find('.note-image-btn');$imageDialog.one('shown.bs.modal',function(){$imageInput.replaceWith($imageInput.clone().on('change',function(){deferred.resolve(this.files||this.value);$imageDialog.modal('hide');}).val(''));$imageBtn.click(function(event){event.preventDefault();deferred.resolve($imageUrl.val());$imageDialog.modal('hide');});$imageUrl.on('keyup paste',function(event){var url;if(event.type==='paste'){url=event.originalEvent.clipboardData.getData('text');}else{url=$imageUrl.val();}
toggleBtn($imageBtn,url);}).val('').trigger('focus');bindEnterKey($imageUrl,$imageBtn);}).one('hidden.bs.modal',function(){$imageInput.off('change');$imageUrl.off('keyup paste keypress');$imageBtn.off('click');if(deferred.state()==='pending'){deferred.reject();}}).modal('show');});};};return ImageDialog;});;

/* <inline asset> defined in bundle 'web.assets_backend' */
odoo.website_next_define='summernote/module/LinkDialog';;

/* /web_editor/static/lib/summernote/src/js/module/LinkDialog.js defined in bundle 'web.assets_backend' */
define(['summernote/core/key'],function(key){var LinkDialog=function(handler){var toggleBtn=function($btn,isEnable){$btn.toggleClass('disabled',!isEnable);$btn.attr('disabled',!isEnable);};var bindEnterKey=function($input,$btn){$input.on('keypress',function(event){if(event.keyCode===key.code.ENTER){$btn.trigger('click');}});};this.showLinkDialog=function($editable,$dialog,linkInfo){return $.Deferred(function(deferred){var $linkDialog=$dialog.find('.note-link-dialog');var $linkText=$linkDialog.find('.note-link-text'),$linkUrl=$linkDialog.find('.note-link-url'),$linkBtn=$linkDialog.find('.note-link-btn'),$openInNewWindow=$linkDialog.find('input[type=checkbox]');$linkDialog.one('shown.bs.modal',function(){$linkText.val(linkInfo.text);$linkText.on('input',function(){toggleBtn($linkBtn,$linkText.val()&&$linkUrl.val());linkInfo.text=$linkText.val();});if(!linkInfo.url){linkInfo.url=linkInfo.text||'http://';toggleBtn($linkBtn,linkInfo.text);}
$linkUrl.on('input',function(){toggleBtn($linkBtn,$linkText.val()&&$linkUrl.val());if(!linkInfo.text){$linkText.val($linkUrl.val());}}).val(linkInfo.url).trigger('focus').trigger('select');bindEnterKey($linkUrl,$linkBtn);bindEnterKey($linkText,$linkBtn);$openInNewWindow.prop('checked',linkInfo.isNewWindow);$linkBtn.one('click',function(event){event.preventDefault();deferred.resolve({range:linkInfo.range,url:$linkUrl.val(),text:$linkText.val(),isNewWindow:$openInNewWindow.is(':checked')});$linkDialog.modal('hide');});}).one('hidden.bs.modal',function(){$linkText.off('input keypress');$linkUrl.off('input keypress');$linkBtn.off('click');if(deferred.state()==='pending'){deferred.reject();}}).modal('show');}).promise();};this.show=function(layoutInfo){var $editor=layoutInfo.editor(),$dialog=layoutInfo.dialog(),$editable=layoutInfo.editable(),$popover=layoutInfo.popover(),linkInfo=handler.invoke('editor.getLinkInfo',$editable);var options=$editor.data('options');handler.invoke('editor.saveRange',$editable);this.showLinkDialog($editable,$dialog,linkInfo).then(function(linkInfo){handler.invoke('editor.restoreRange',$editable);handler.invoke('editor.createLink',$editable,linkInfo,options);handler.invoke('popover.hide',$popover);}).fail(function(){handler.invoke('editor.restoreRange',$editable);});};};return LinkDialog;});;

/* <inline asset> defined in bundle 'web.assets_backend' */
odoo.website_next_define='summernote/module/Popover';;

/* /web_editor/static/lib/summernote/src/js/module/Popover.js defined in bundle 'web.assets_backend' */
define(['summernote/core/func','summernote/core/list','summernote/module/Button'],function(func,list,Button){var Popover=function(){var button=new Button();this.button=button;var posFromPlaceholder=function(placeholder,options){var isAirMode=options&&options.isAirMode;var isLeftTop=options&&options.isLeftTop;var $placeholder=$(placeholder);var pos=isAirMode?$placeholder.offset():$placeholder.position();var height=isLeftTop?0:$placeholder.outerHeight(true);return{left:pos.left,top:pos.top+height};};var showPopover=function($popover,pos){$popover.css({display:'block',left:pos.left,top:pos.top});};var PX_POPOVER_ARROW_OFFSET_X=20;this.update=function($popover,styleInfo,isAirMode){button.update($popover,styleInfo);var $linkPopover=$popover.find('.note-link-popover');if(styleInfo.anchor){var $anchor=$linkPopover.find('a');var href=$(styleInfo.anchor).attr('href');var target=$(styleInfo.anchor).attr('target');$anchor.attr('href',href).html(href);if(!target){$anchor.removeAttr('target');}else{$anchor.attr('target','_blank');}
showPopover($linkPopover,posFromPlaceholder(styleInfo.anchor,{isAirMode:isAirMode}));}else{$linkPopover.hide();}
var $imagePopover=$popover.find('.note-image-popover');if(styleInfo.image){showPopover($imagePopover,posFromPlaceholder(styleInfo.image,{isAirMode:isAirMode,isLeftTop:true}));}else{$imagePopover.hide();}
var $airPopover=$popover.find('.note-air-popover');if(isAirMode&&styleInfo.range&&!styleInfo.range.isCollapsed()){var rect=list.last(styleInfo.range.getClientRects());if(rect){var bnd=func.rect2bnd(rect);showPopover($airPopover,{left:Math.max(bnd.left+bnd.width/2-PX_POPOVER_ARROW_OFFSET_X,0),top:bnd.top+bnd.height});}}else{$airPopover.hide();}};this.updateRecentColor=function(button,eventName,value){button.updateRecentColor(button,eventName,value);};this.hide=function($popover){$popover.children().hide();};};return Popover;});;

/* <inline asset> defined in bundle 'web.assets_backend' */
odoo.website_next_define='summernote/module/Statusbar';;

/* /web_editor/static/lib/summernote/src/js/module/Statusbar.js defined in bundle 'web.assets_backend' */
define(['summernote/core/dom'],function(dom){var EDITABLE_PADDING=24;var Statusbar=function(){var $document=$(document);this.attach=function(layoutInfo,options){if(!options.disableResizeEditor){layoutInfo.statusbar().on('mousedown',hStatusbarMousedown);}};var hStatusbarMousedown=function(event){event.preventDefault();event.stopPropagation();var $editable=dom.makeLayoutInfo(event.target).editable();var editableTop=$editable.offset().top-$document.scrollTop();var layoutInfo=dom.makeLayoutInfo(event.currentTarget||event.target);var options=layoutInfo.editor().data('options');$document.on('mousemove',function(event){var nHeight=event.clientY-(editableTop+EDITABLE_PADDING);nHeight=(options.minHeight>0)?Math.max(nHeight,options.minHeight):nHeight;nHeight=(options.maxHeight>0)?Math.min(nHeight,options.maxHeight):nHeight;$editable.height(nHeight);}).one('mouseup',function(){$document.off('mousemove');});};};return Statusbar;});;

/* <inline asset> defined in bundle 'web.assets_backend' */
odoo.website_next_define='summernote/module/Toolbar';;

/* /web_editor/static/lib/summernote/src/js/module/Toolbar.js defined in bundle 'web.assets_backend' */
define(['summernote/core/list','summernote/core/dom','summernote/module/Button'],function(list,dom,Button){var Toolbar=function(){var button=new Button();this.button=button;this.update=function($toolbar,styleInfo){button.update($toolbar,styleInfo);};this.updateRecentColor=function(buttonNode,eventName,value){button.updateRecentColor(buttonNode,eventName,value);};this.activate=function($toolbar){$toolbar.find('button').not('button[data-event="codeview"]').removeClass('disabled');};this.deactivate=function($toolbar){$toolbar.find('button').not('button[data-event="codeview"]').addClass('disabled');};this.updateFullscreen=function($container,bFullscreen){var $btn=$container.find('button[data-event="fullscreen"]');$btn.toggleClass('active',bFullscreen);};this.updateCodeview=function($container,isCodeview){var $btn=$container.find('button[data-event="codeview"]');$btn.toggleClass('active',isCodeview);if(isCodeview){this.deactivate($container);}else{this.activate($container);}};this.get=function($editable,name){var $toolbar=dom.makeLayoutInfo($editable).toolbar();return $toolbar.find('[data-name='+name+']');};this.setButtonState=function($editable,name,isActive){isActive=(isActive===false)?false:true;var $button=this.get($editable,name);$button.toggleClass('active',isActive);};};return Toolbar;});;

/* <inline asset> defined in bundle 'web.assets_backend' */
odoo.website_next_define='summernote/Renderer';;

/* /web_editor/static/lib/summernote/src/js/Renderer.js defined in bundle 'web.assets_backend' */
define(['summernote/core/agent','summernote/core/dom','summernote/core/func','summernote/core/list'],function(agent,dom,func,list){var Renderer=function(){var tplButton=function(label,options){var event=options.event;var value=options.value;var title=options.title;var className=options.className;var dropdown=options.dropdown;var hide=options.hide;return(dropdown?'<div class="btn-group'+
(className?' '+className:'')+'">':'')+'<button type="button"'+' class="btn btn-default btn-sm'+
((!dropdown&&className)?' '+className:'')+
(dropdown?' dropdown-toggle':'')+'"'+
(dropdown?' data-toggle="dropdown"':'')+
(title?' title="'+title+'"':'')+
(event?' data-event="'+event+'"':'')+
(value?' data-value=\''+value+'\'':'')+
(hide?' data-hide=\''+hide+'\'':'')+' tabindex="-1">'+
label+
(dropdown?' <span class="caret"></span>':'')+'</button>'+
(dropdown||'')+
(dropdown?'</div>':'');};var tplIconButton=function(iconClassName,options){var label='<i class="'+iconClassName+'"></i>';return tplButton(label,options);};var tplPopover=function(className,content){var $popover=$('<div class="'+className+' popover bottom in" style="display: none;">'+'<div class="arrow"></div>'+'<div class="popover-content">'+'</div>'+'</div>');$popover.find('.popover-content').append(content);return $popover;};var tplDialog=function(className,title,body,footer){return'<div class="'+className+' modal" aria-hidden="false">'+'<div class="modal-dialog">'+'<div class="modal-content">'+
(title?'<div class="modal-header">'+'<button type="button" class="close" aria-hidden="true" tabindex="-1">&times;</button>'+'<h4 class="modal-title">'+title+'</h4>'+'</div>':'')+'<div class="modal-body">'+body+'</div>'+
(footer?'<div class="modal-footer">'+footer+'</div>':'')+'</div>'+'</div>'+'</div>';};var tplDropdown=function(contents,className,nodeName){var classes='dropdown-menu'+(className?' '+className:'');nodeName=nodeName||'ul';if(contents instanceof Array){contents=contents.join('');}
return'<'+nodeName+' class="'+classes+'">'+contents+'</'+nodeName+'>';};var tplButtonInfo={picture:function(lang,options){return tplIconButton(options.iconPrefix+options.icons.image.image,{event:'showImageDialog',title:lang.image.image,hide:true});},link:function(lang,options){return tplIconButton(options.iconPrefix+options.icons.link.link,{event:'showLinkDialog',title:lang.link.link,hide:true});},table:function(lang,options){var dropdown=['<div class="note-dimension-picker">','<div class="note-dimension-picker-mousecatcher" data-event="insertTable" data-value="1x1"></div>','<div class="note-dimension-picker-highlighted"></div>','<div class="note-dimension-picker-unhighlighted"></div>','</div>','<div class="note-dimension-display"> 1 x 1 </div>'];return tplIconButton(options.iconPrefix+options.icons.table.table,{title:lang.table.table,dropdown:tplDropdown(dropdown,'note-table')});},style:function(lang,options){var items=options.styleTags.reduce(function(memo,v){var label=lang.style[v==='p'?'normal':v];return memo+'<li><a data-event="formatBlock" href="#" data-value="'+v+'">'+
((v==='p'||v==='pre')?label:'<'+v+'>'+label+'</'+v+'>')+'</a></li>';},'');return tplIconButton(options.iconPrefix+options.icons.style.style,{title:lang.style.style,dropdown:tplDropdown(items)});},fontname:function(lang,options){var realFontList=[];var items=options.fontNames.reduce(function(memo,v){if(!agent.isFontInstalled(v)&&!list.contains(options.fontNamesIgnoreCheck,v)){return memo;}
realFontList.push(v);return memo+'<li><a data-event="fontName" href="#" data-value="'+v+'" style="font-family:\''+v+'\'">'+'<i class="'+options.iconPrefix+options.icons.misc.check+'"></i> '+v+'</a></li>';},'');var hasDefaultFont=agent.isFontInstalled(options.defaultFontName);var defaultFontName=(hasDefaultFont)?options.defaultFontName:realFontList[0];var label='<span class="note-current-fontname">'+
defaultFontName+'</span>';return tplButton(label,{title:lang.font.name,className:'note-fontname',dropdown:tplDropdown(items,'note-check')});},fontsize:function(lang,options){var items=options.fontSizes.reduce(function(memo,v){return memo+'<li><a data-event="fontSize" href="#" data-value="'+v+'">'+'<i class="'+options.iconPrefix+options.icons.misc.check+'"></i> '+v+'</a></li>';},'');var label='<span class="note-current-fontsize">11</span>';return tplButton(label,{title:lang.font.size,className:'note-fontsize',dropdown:tplDropdown(items,'note-check')});},color:function(lang,options){var colorButtonLabel='<i class="'+
options.iconPrefix+options.icons.color.recent+'" style="color:black;background-color:yellow;"></i>';var colorButton=tplButton(colorButtonLabel,{className:'note-recent-color',title:lang.color.recent,event:'color',value:'{"backColor":"yellow"}'});var items=['<li><div class="btn-group">','<div class="note-palette-title">'+lang.color.background+'</div>','<div class="note-color-reset" data-event="backColor"',' data-value="inherit" title="'+lang.color.transparent+'">'+lang.color.setTransparent+'</div>','<div class="note-color-palette" data-target-event="backColor"></div>','</div><div class="btn-group">','<div class="note-palette-title">'+lang.color.foreground+'</div>','<div class="note-color-reset" data-event="foreColor" data-value="inherit" title="'+lang.color.reset+'">',lang.color.resetToDefault,'</div>','<div class="note-color-palette" data-target-event="foreColor"></div>','</div></li>'];var moreButton=tplButton('',{title:lang.color.more,dropdown:tplDropdown(items)});return colorButton+moreButton;},bold:function(lang,options){return tplIconButton(options.iconPrefix+options.icons.font.bold,{event:'bold',title:lang.font.bold});},italic:function(lang,options){return tplIconButton(options.iconPrefix+options.icons.font.italic,{event:'italic',title:lang.font.italic});},underline:function(lang,options){return tplIconButton(options.iconPrefix+options.icons.font.underline,{event:'underline',title:lang.font.underline});},strikethrough:function(lang,options){return tplIconButton(options.iconPrefix+options.icons.font.strikethrough,{event:'strikethrough',title:lang.font.strikethrough});},superscript:function(lang,options){return tplIconButton(options.iconPrefix+options.icons.font.superscript,{event:'superscript',title:lang.font.superscript});},subscript:function(lang,options){return tplIconButton(options.iconPrefix+options.icons.font.subscript,{event:'subscript',title:lang.font.subscript});},clear:function(lang,options){return tplIconButton(options.iconPrefix+options.icons.font.clear,{event:'removeFormat',title:lang.font.clear});},height:function(lang,options){var items=options.lineHeights.reduce(function(memo,v){return memo+'<li><a data-event="lineHeight" href="#" data-value="'+parseFloat(v)+'">'+'<i class="'+options.iconPrefix+options.icons.misc.check+'"></i> '+v+'</a></li>';},'');return tplIconButton(options.iconPrefix+options.icons.font.height,{title:lang.font.height,dropdown:tplDropdown(items,'note-check')});},help:function(lang,options){return tplIconButton(options.iconPrefix+options.icons.options.help,{event:'showHelpDialog',title:lang.options.help,hide:true});},fullscreen:function(lang,options){return tplIconButton(options.iconPrefix+options.icons.options.fullscreen,{event:'fullscreen',title:lang.options.fullscreen});},codeview:function(lang,options){return tplIconButton(options.iconPrefix+options.icons.options.codeview,{event:'codeview',title:lang.options.codeview});},undo:function(lang,options){return tplIconButton(options.iconPrefix+options.icons.history.undo,{event:'undo',title:lang.history.undo});},redo:function(lang,options){return tplIconButton(options.iconPrefix+options.icons.history.redo,{event:'redo',title:lang.history.redo});},hr:function(lang,options){return tplIconButton(options.iconPrefix+options.icons.hr.insert,{event:'insertHorizontalRule',title:lang.hr.insert});}};var tplPopovers=function(lang,options){var tplLinkPopover=function(){var linkButton=tplIconButton(options.iconPrefix+options.icons.link.edit,{title:lang.link.edit,event:'showLinkDialog',hide:true});var unlinkButton=tplIconButton(options.iconPrefix+options.icons.link.unlink,{title:lang.link.unlink,event:'unlink'});var content='<a href="http://www.google.com" target="_blank">www.google.com</a>&nbsp;&nbsp;'+'<div class="note-insert btn-group">'+
linkButton+unlinkButton+'</div>';return tplPopover('note-link-popover',content);};var tplImagePopover=function(){var fullButton=tplButton('<span class="note-fontsize-10">100%</span>',{title:lang.image.resizeFull,event:'resize',value:'1'});var halfButton=tplButton('<span class="note-fontsize-10">50%</span>',{title:lang.image.resizeHalf,event:'resize',value:'0.5'});var quarterButton=tplButton('<span class="note-fontsize-10">25%</span>',{title:lang.image.resizeQuarter,event:'resize',value:'0.25'});var leftButton=tplIconButton(options.iconPrefix+options.icons.image.floatLeft,{title:lang.image.floatLeft,event:'floatMe',value:'left'});var rightButton=tplIconButton(options.iconPrefix+options.icons.image.floatRight,{title:lang.image.floatRight,event:'floatMe',value:'right'});var justifyButton=tplIconButton(options.iconPrefix+options.icons.image.floatNone,{title:lang.image.floatNone,event:'floatMe',value:'none'});var roundedButton=tplIconButton(options.iconPrefix+options.icons.image.shapeRounded,{title:lang.image.shapeRounded,event:'imageShape',value:'img-rounded'});var circleButton=tplIconButton(options.iconPrefix+options.icons.image.shapeCircle,{title:lang.image.shapeCircle,event:'imageShape',value:'img-circle'});var thumbnailButton=tplIconButton(options.iconPrefix+options.icons.image.shapeThumbnail,{title:lang.image.shapeThumbnail,event:'imageShape',value:'img-thumbnail'});var noneButton=tplIconButton(options.iconPrefix+options.icons.image.shapeNone,{title:lang.image.shapeNone,event:'imageShape',value:''});var removeButton=tplIconButton(options.iconPrefix+options.icons.image.remove,{title:lang.image.remove,event:'removeMedia',value:'none'});var content=(options.disableResizeImage?'':'<div class="btn-group">'+fullButton+halfButton+quarterButton+'</div>')+'<div class="btn-group">'+leftButton+rightButton+justifyButton+'</div>'+'<div class="btn-group">'+roundedButton+circleButton+thumbnailButton+noneButton+'</div>'+'<div class="btn-group">'+removeButton+'</div>';return tplPopover('note-image-popover',content);};var tplAirPopover=function(){var $content=$('<div />');for(var idx=0,len=options.airPopover.length;idx<len;idx++){var group=options.airPopover[idx];var $group=$('<div class="note-'+group[0]+' btn-group">');for(var i=0,lenGroup=group[1].length;i<lenGroup;i++){var $button=$(tplButtonInfo[group[1][i]](lang,options));$button.attr('data-name',group[1][i]);$group.append($button);}
$content.append($group);}
return tplPopover('note-air-popover',$content.children());};var $notePopover=$('<div class="note-popover" />');$notePopover.append(tplLinkPopover());$notePopover.append(tplImagePopover());if(options.airMode){$notePopover.append(tplAirPopover());}
return $notePopover;};this.tplButtonInfo=tplButtonInfo;this.tplPopovers=tplPopovers;var tplHandles=function(options){return'<div class="note-handle">'+'<div class="note-control-selection">'+'<div class="note-control-selection-bg"></div>'+'<div class="note-control-holder note-control-nw"></div>'+'<div class="note-control-holder note-control-ne"></div>'+'<div class="note-control-holder note-control-sw"></div>'+'<div class="'+
(options.disableResizeImage?'note-control-holder':'note-control-sizing')+' note-control-se"></div>'+
(options.disableResizeImage?'':'<div class="note-control-selection-info"></div>')+'</div>'+'</div>';};var tplShortcut=function(title,keys){var keyClass='note-shortcut-col col-xs-6 note-shortcut-';var body=[];for(var i in keys){if(keys.hasOwnProperty(i)){body.push('<div class="'+keyClass+'key">'+keys[i].kbd+'</div>'+'<div class="'+keyClass+'name">'+keys[i].text+'</div>');}}
return'<div class="note-shortcut-row row"><div class="'+keyClass+'title col-xs-offset-6">'+title+'</div></div>'+'<div class="note-shortcut-row row">'+body.join('</div><div class="note-shortcut-row row">')+'</div>';};var tplShortcutText=function(lang){var keys=[{kbd:'⌘ + B',text:lang.font.bold},{kbd:'⌘ + I',text:lang.font.italic},{kbd:'⌘ + U',text:lang.font.underline},{kbd:'⌘ + \\',text:lang.font.clear}];return tplShortcut(lang.shortcut.textFormatting,keys);};var tplShortcutAction=function(lang){var keys=[{kbd:'⌘ + Z',text:lang.history.undo},{kbd:'⌘ + ⇧ + Z',text:lang.history.redo},{kbd:'⌘ + ]',text:lang.paragraph.indent},{kbd:'⌘ + [',text:lang.paragraph.outdent},{kbd:'⌘ + ENTER',text:lang.hr.insert}];return tplShortcut(lang.shortcut.action,keys);};var tplShortcutPara=function(lang){var keys=[{kbd:'⌘ + ⇧ + L',text:lang.paragraph.left},{kbd:'⌘ + ⇧ + E',text:lang.paragraph.center},{kbd:'⌘ + ⇧ + R',text:lang.paragraph.right},{kbd:'⌘ + ⇧ + J',text:lang.paragraph.justify},{kbd:'⌘ + ⇧ + NUM7',text:lang.lists.ordered},{kbd:'⌘ + ⇧ + NUM8',text:lang.lists.unordered}];return tplShortcut(lang.shortcut.paragraphFormatting,keys);};var tplShortcutStyle=function(lang){var keys=[{kbd:'⌘ + NUM0',text:lang.style.normal},{kbd:'⌘ + NUM1',text:lang.style.h1},{kbd:'⌘ + NUM2',text:lang.style.h2},{kbd:'⌘ + NUM3',text:lang.style.h3},{kbd:'⌘ + NUM4',text:lang.style.h4},{kbd:'⌘ + NUM5',text:lang.style.h5},{kbd:'⌘ + NUM6',text:lang.style.h6}];return tplShortcut(lang.shortcut.documentStyle,keys);};var tplExtraShortcuts=function(lang,options){var extraKeys=options.extraKeys;var keys=[];for(var key in extraKeys){if(extraKeys.hasOwnProperty(key)){keys.push({kbd:key,text:extraKeys[key]});}}
return tplShortcut(lang.shortcut.extraKeys,keys);};var tplShortcutTable=function(lang,options){var colClass='class="note-shortcut note-shortcut-col col-sm-6 col-xs-12"';var template=['<div '+colClass+'>'+tplShortcutAction(lang,options)+'</div>'+'<div '+colClass+'>'+tplShortcutText(lang,options)+'</div>','<div '+colClass+'>'+tplShortcutStyle(lang,options)+'</div>'+'<div '+colClass+'>'+tplShortcutPara(lang,options)+'</div>'];if(options.extraKeys){template.push('<div '+colClass+'>'+tplExtraShortcuts(lang,options)+'</div>');}
return'<div class="note-shortcut-row row">'+
template.join('</div><div class="note-shortcut-row row">')+'</div>';};var replaceMacKeys=function(sHtml){return sHtml.replace(/⌘/g,'Ctrl').replace(/⇧/g,'Shift');};var tplDialogInfo={image:function(lang,options){var imageLimitation='';if(options.maximumImageFileSize){var unit=Math.floor(Math.log(options.maximumImageFileSize)/Math.log(1024));var readableSize=(options.maximumImageFileSize/Math.pow(1024,unit)).toFixed(2)*1+' '+' KMGTP'[unit]+'B';imageLimitation='<small>'+lang.image.maximumFileSize+' : '+readableSize+'</small>';}
var body='<div class="form-group row note-group-select-from-files">'+'<label>'+lang.image.selectFromFiles+'</label>'+'<input class="note-image-input form-control" type="file" name="files" accept="image/*" multiple="multiple" />'+
imageLimitation+'</div>'+'<div class="form-group row">'+'<label>'+lang.image.url+'</label>'+'<input class="note-image-url form-control col-md-12" type="text" />'+'</div>';var footer='<button href="#" class="btn btn-primary note-image-btn disabled" disabled>'+lang.image.insert+'</button>';return tplDialog('note-image-dialog',lang.image.insert,body,footer);},link:function(lang,options){var body='<div class="form-group row">'+'<label>'+lang.link.textToDisplay+'</label>'+'<input class="note-link-text form-control col-md-12" type="text" />'+'</div>'+'<div class="form-group row">'+'<label>'+lang.link.url+'</label>'+'<input class="note-link-url form-control col-md-12" type="text" value="http://" />'+'</div>'+
(!options.disableLinkTarget?'<div class="checkbox">'+'<label>'+'<input type="checkbox" checked> '+
lang.link.openInNewWindow+'</label>'+'</div>':'');var footer='<button href="#" class="btn btn-primary note-link-btn disabled" disabled>'+lang.link.insert+'</button>';return tplDialog('note-link-dialog',lang.link.insert,body,footer);},help:function(lang,options){var body='<a class="modal-close pull-right" aria-hidden="true" tabindex="-1">'+lang.shortcut.close+'</a>'+'<div class="title">'+lang.shortcut.shortcuts+'</div>'+
(agent.isMac?tplShortcutTable(lang,options):replaceMacKeys(tplShortcutTable(lang,options)))+'<p class="text-center">'+'<a href="//summernote.org/" target="_blank">Summernote @VERSION</a> · '+'<a href="//github.com/summernote/summernote" target="_blank">Project</a> · '+'<a href="//github.com/summernote/summernote/issues" target="_blank">Issues</a>'+'</p>';return tplDialog('note-help-dialog','',body,'');}};var tplDialogs=function(lang,options){var dialogs='';$.each(tplDialogInfo,function(idx,tplDialog){dialogs+=tplDialog(lang,options);});return'<div class="note-dialog">'+dialogs+'</div>';};var tplStatusbar=function(){return'<div class="note-resizebar">'+'<div class="note-icon-bar"></div>'+'<div class="note-icon-bar"></div>'+'<div class="note-icon-bar"></div>'+'</div>';};var representShortcut=function(str){if(agent.isMac){str=str.replace('CMD','⌘').replace('SHIFT','⇧');}
return str.replace('BACKSLASH','\\').replace('SLASH','/').replace('LEFTBRACKET','[').replace('RIGHTBRACKET',']');};var createTooltip=function($container,keyMap,sPlacement){var invertedKeyMap=func.invertObject(keyMap);var $buttons=$container.find('button');$buttons.each(function(i,elBtn){var $btn=$(elBtn);var sShortcut=invertedKeyMap[$btn.data('event')];if(sShortcut){$btn.attr('title',function(i,v){return v+' ('+representShortcut(sShortcut)+')';});}}).tooltip({container:'body',trigger:'hover',placement:sPlacement||'top'}).on('click',function(){$(this).tooltip('hide');});};var createPalette=function($container,options){var colorInfo=options.colors;$container.find('.note-color-palette').each(function(){var $palette=$(this),eventName=$palette.attr('data-target-event');var paletteContents=[];for(var row=0,lenRow=colorInfo.length;row<lenRow;row++){var colors=colorInfo[row];var buttons=[];for(var col=0,lenCol=colors.length;col<lenCol;col++){var color=colors[col];buttons.push(['<button type="button" class="note-color-btn" style="background-color:',color,';" data-event="',eventName,'" data-value="',color,'" title="',color,'" data-toggle="button" tabindex="-1"></button>'].join(''));}
paletteContents.push('<div class="note-color-row">'+buttons.join('')+'</div>');}
$palette.html(paletteContents.join(''));});};this.createPalette=createPalette;this.createLayoutByAirMode=function($holder,options){var langInfo=options.langInfo;var keyMap=options.keyMap[agent.isMac?'mac':'pc'];var id=func.uniqueId();$holder.addClass('note-air-editor note-editable');$holder.attr({'data-note-id':id,'contentEditable':true});var body=document.body;var $popover=$(this.tplPopovers(langInfo,options));$popover.addClass('note-air-layout');$popover.attr('id','note-popover-'+id);$popover.appendTo(body);createTooltip($popover,keyMap);this.createPalette($popover,options);var $handle=$(tplHandles(options));$handle.addClass('note-air-layout');$handle.attr('id','note-handle-'+id);$handle.appendTo(body);var $dialog=$(tplDialogs(langInfo,options));$dialog.addClass('note-air-layout');$dialog.attr('id','note-dialog-'+id);$dialog.find('button.close, a.modal-close').click(function(){$(this).closest('.modal').modal('hide');});$dialog.appendTo(body);};this.createLayoutByFrame=function($holder,options){var langInfo=options.langInfo;var $editor=$('<div class="note-editor panel panel-default" />');if(options.width){$editor.width(options.width);}
if(options.height>0){$('<div class="note-statusbar">'+(options.disableResizeEditor?'':tplStatusbar())+'</div>').prependTo($editor);}
var $editingArea=$('<div class="note-editing-area" />');var isContentEditable=!$holder.is(':disabled');var $editable=$('<div class="note-editable panel-body" contentEditable="'+isContentEditable+'"></div>').prependTo($editingArea);if(options.height){$editable.height(options.height);}
if(options.direction){$editable.attr('dir',options.direction);}
var placeholder=$holder.attr('placeholder')||options.placeholder;if(placeholder){$editable.attr('data-placeholder',placeholder);}
$editable.html(dom.html($holder)||dom.emptyPara);$('<textarea class="note-codable"></textarea>').prependTo($editingArea);var $popover=$(this.tplPopovers(langInfo,options)).prependTo($editingArea);this.createPalette($popover,options);createTooltip($popover,keyMap);$(tplHandles(options)).prependTo($editingArea);$editingArea.prependTo($editor);var $toolbar=$('<div class="note-toolbar panel-heading" />');for(var idx=0,len=options.toolbar.length;idx<len;idx++){var groupName=options.toolbar[idx][0];var groupButtons=options.toolbar[idx][1];var $group=$('<div class="note-'+groupName+' btn-group" />');for(var i=0,btnLength=groupButtons.length;i<btnLength;i++){var buttonInfo=tplButtonInfo[groupButtons[i]];if(!$.isFunction(buttonInfo)){continue;}
var $button=$(buttonInfo(langInfo,options));$button.attr('data-name',groupButtons[i]);$group.append($button);}
$toolbar.append($group);}
var keyMap=options.keyMap[agent.isMac?'mac':'pc'];this.createPalette($toolbar,options);createTooltip($toolbar,keyMap,'bottom');$toolbar.prependTo($editor);$('<div class="note-dropzone"><div class="note-dropzone-message"></div></div>').prependTo($editor);var $dialogContainer=options.dialogsInBody?$(document.body):$editor;var $dialog=$(tplDialogs(langInfo,options)).prependTo($dialogContainer);$dialog.find('button.close, a.modal-close').click(function(){$(this).closest('.modal').modal('hide');});$editor.insertAfter($holder);$holder.hide();};this.hasNoteEditor=function($holder){return this.noteEditorFromHolder($holder).length>0;};this.noteEditorFromHolder=function($holder){if($holder.hasClass('note-air-editor')){return $holder;}else if($holder.next().hasClass('note-editor')){return $holder.next();}else{return $();}};this.createLayout=function($holder,options){if(options.airMode){this.createLayoutByAirMode($holder,options);}else{this.createLayoutByFrame($holder,options);}};this.layoutInfoFromHolder=function($holder){var $editor=this.noteEditorFromHolder($holder);if(!$editor.length){return;}
$editor.data('holder',$holder);return dom.buildLayoutInfo($editor);};this.removeLayout=function($holder,layoutInfo,options){if(options.airMode){$holder.removeClass('note-air-editor note-editable').removeAttr('contentEditable');layoutInfo.popover().remove();layoutInfo.handle().remove();layoutInfo.dialog().remove();}else{$holder.html(layoutInfo.editable().html());if(options.dialogsInBody){layoutInfo.dialog().remove();}
layoutInfo.editor().remove();$holder.show();}};this.getTemplate=function(){return{button:tplButton,iconButton:tplIconButton,dialog:tplDialog,dropdown:tplDropdown};};this.addButtonInfo=function(name,buttonInfo){tplButtonInfo[name]=buttonInfo;};this.addDialogInfo=function(name,dialogInfo){tplDialogInfo[name]=dialogInfo;};};return Renderer;});;

/* <inline asset> defined in bundle 'web.assets_backend' */
odoo.website_next_define='summernote/EventHandler';;

/* /web_editor/static/lib/summernote/src/js/EventHandler.js defined in bundle 'web.assets_backend' */
define(['summernote/core/agent','summernote/core/func','summernote/core/dom','summernote/core/async','summernote/core/key','summernote/core/list','summernote/editing/History','summernote/module/Editor','summernote/module/Toolbar','summernote/module/Statusbar','summernote/module/Popover','summernote/module/Handle','summernote/module/Fullscreen','summernote/module/Codeview','summernote/module/DragAndDrop','summernote/module/Clipboard','summernote/module/LinkDialog','summernote/module/ImageDialog','summernote/module/HelpDialog'],function(agent,func,dom,async,key,list,History,Editor,Toolbar,Statusbar,Popover,Handle,Fullscreen,Codeview,DragAndDrop,Clipboard,LinkDialog,ImageDialog,HelpDialog){var EventHandler=function(){var self=this;var modules=this.modules={editor:new Editor(this),toolbar:new Toolbar(this),statusbar:new Statusbar(this),popover:new Popover(this),handle:new Handle(this),fullscreen:new Fullscreen(this),codeview:new Codeview(this),dragAndDrop:new DragAndDrop(this),clipboard:new Clipboard(this),linkDialog:new LinkDialog(this),imageDialog:new ImageDialog(this),helpDialog:new HelpDialog(this)};this.invoke=function(){var moduleAndMethod=list.head(list.from(arguments));var args=list.tail(list.from(arguments));var splits=moduleAndMethod.split('.');var hasSeparator=splits.length>1;var moduleName=hasSeparator&&list.head(splits);var methodName=hasSeparator?list.last(splits):list.head(splits);var module=this.getModule(moduleName);var method=module[methodName];return method&&method.apply(module,args);};this.getModule=function(moduleName){return this.modules[moduleName]||this.modules.editor;};var bindCustomEvent=this.bindCustomEvent=function($holder,callbacks,eventNamespace){return function(){var callback=callbacks[func.namespaceToCamel(eventNamespace,'on')];if(callback){callback.apply($holder[0],arguments);}
return $holder.trigger('summernote.'+eventNamespace,arguments);};};this.insertImages=function(layoutInfo,files){var $editor=layoutInfo.editor(),$editable=layoutInfo.editable(),$holder=layoutInfo.holder();var callbacks=$editable.data('callbacks');var options=$editor.data('options');if(callbacks.onImageUpload){bindCustomEvent($holder,callbacks,'image.upload')(files);}else{$.each(files,function(idx,file){var filename=file.name;if(options.maximumImageFileSize&&options.maximumImageFileSize<file.size){bindCustomEvent($holder,callbacks,'image.upload.error')(options.langInfo.image.maximumFileSizeError);}else{async.readFileAsDataURL(file).then(function(sDataURL){modules.editor.insertImage($editable,sDataURL,filename);}).fail(function(){bindCustomEvent($holder,callbacks,'image.upload.error')(options.langInfo.image.maximumFileSizeError);});}});}};var commands={showLinkDialog:function(layoutInfo){modules.linkDialog.show(layoutInfo);},showImageDialog:function(layoutInfo){modules.imageDialog.show(layoutInfo);},showHelpDialog:function(layoutInfo){modules.helpDialog.show(layoutInfo);},fullscreen:function(layoutInfo){modules.fullscreen.toggle(layoutInfo);},codeview:function(layoutInfo){modules.codeview.toggle(layoutInfo);}};var hMousedown=function(event){if(dom.isImg(event.target)){event.preventDefault();}};var hKeyupAndMouseup=function(event){var layoutInfo=dom.makeLayoutInfo(event.currentTarget||event.target);modules.editor.removeBogus(layoutInfo.editable());hToolbarAndPopoverUpdate(event);};this.updateStyleInfo=function(styleInfo,layoutInfo){if(!styleInfo){return;}
var isAirMode=layoutInfo.editor().data('options').airMode;if(!isAirMode){modules.toolbar.update(layoutInfo.toolbar(),styleInfo);}
modules.popover.update(layoutInfo.popover(),styleInfo,isAirMode);modules.handle.update(layoutInfo.handle(),styleInfo,isAirMode);};var hToolbarAndPopoverUpdate=function(event){var target=event.target;setTimeout(function(){var layoutInfo=dom.makeLayoutInfo(target);var $editable=layoutInfo.editable();if(!event.isDefaultPrevented()){modules.editor.saveRange($editable);}
var styleInfo=modules.editor.currentStyle(target);self.updateStyleInfo(styleInfo,layoutInfo);},0);};var hScroll=function(event){var layoutInfo=dom.makeLayoutInfo(event.currentTarget||event.target);modules.popover.hide(layoutInfo.popover());modules.handle.hide(layoutInfo.handle());};var hToolbarAndPopoverMousedown=function(event){var $btn=$(event.target).closest('[data-event]');if($btn.length){event.preventDefault();}};var hToolbarAndPopoverClick=function(event){var $btn=$(event.target).closest('[data-event]');if(!$btn.length){return;}
var eventName=$btn.attr('data-event'),value=$btn.attr('data-value'),hide=$btn.attr('data-hide');var layoutInfo=dom.makeLayoutInfo(event.target);var $target;if($.inArray(eventName,['resize','floatMe','removeMedia','imageShape'])!==-1){var $selection=layoutInfo.handle().find('.note-control-selection');$target=$($selection.data('target'));}
if(hide){$btn.parents('.popover').hide();}
if($.isFunction($.summernote.pluginEvents[eventName])){$.summernote.pluginEvents[eventName](event,modules.editor,layoutInfo,value);}else if(modules.editor[eventName]){var $editable=layoutInfo.editable();$editable.focus();modules.editor[eventName]($editable,value,$target);event.preventDefault();}else if(commands[eventName]){commands[eventName].call(this,layoutInfo);event.preventDefault();}
if($.inArray(eventName,['backColor','foreColor'])!==-1){var options=layoutInfo.editor().data('options',options);var module=options.airMode?modules.popover:modules.toolbar;module.updateRecentColor(list.head($btn),eventName,value);}
hToolbarAndPopoverUpdate(event);};var PX_PER_EM=18;var hDimensionPickerMove=function(event,options){var $picker=$(event.target.parentNode);var $dimensionDisplay=$picker.next();var $catcher=$picker.find('.note-dimension-picker-mousecatcher');var $highlighted=$picker.find('.note-dimension-picker-highlighted');var $unhighlighted=$picker.find('.note-dimension-picker-unhighlighted');var posOffset;if(event.offsetX===undefined){var posCatcher=$(event.target).offset();posOffset={x:event.pageX-posCatcher.left,y:event.pageY-posCatcher.top};}else{posOffset={x:event.offsetX,y:event.offsetY};}
var dim={c:Math.ceil(posOffset.x/PX_PER_EM)||1,r:Math.ceil(posOffset.y/PX_PER_EM)||1};$highlighted.css({width:dim.c+'em',height:dim.r+'em'});$catcher.attr('data-value',dim.c+'x'+dim.r);if(3<dim.c&&dim.c<options.insertTableMaxSize.col){$unhighlighted.css({width:dim.c+1+'em'});}
if(3<dim.r&&dim.r<options.insertTableMaxSize.row){$unhighlighted.css({height:dim.r+1+'em'});}
$dimensionDisplay.html(dim.c+' x '+dim.r);};this.bindKeyMap=function(layoutInfo,keyMap){var $editor=layoutInfo.editor();var $editable=layoutInfo.editable();$editable.on('keydown',function(event){var keys=[];if(event.metaKey){keys.push('CMD');}
if(event.ctrlKey&&!event.altKey){keys.push('CTRL');}
if(event.shiftKey){keys.push('SHIFT');}
var keyName=key.nameFromCode[event.keyCode];if(keyName){keys.push(keyName);}
var pluginEvent;var keyString=keys.join('+');var eventName=keyMap[keyString];var keycode=event.keyCode;if(!eventName&&!event.ctrlKey&&!event.metaKey&&((keycode>47&&keycode<58)||keycode==32||keycode==13||(keycode>64&&keycode<91)||(keycode>95&&keycode<112)||(keycode>185&&keycode<193)||(keycode>218&&keycode<223))){eventName='visible';}else if(!keycode){self.invoke('restoreRange',$editable);}
if(eventName){pluginEvent=$.summernote.pluginEvents[keyString];if($.isFunction(pluginEvent)){if(pluginEvent(event,modules.editor,layoutInfo)){return false;}}
pluginEvent=$.summernote.pluginEvents[eventName];if($.isFunction(pluginEvent)){pluginEvent(event,modules.editor,layoutInfo);}else if(modules.editor[eventName]){modules.editor[eventName]($editable,$editor.data('options'));event.preventDefault();}else if(commands[eventName]){commands[eventName].call(this,layoutInfo);event.preventDefault();}}else if(key.isEdit(event.keyCode)){modules.editor.afterCommand($editable);}});};this.attach=function(layoutInfo,options){if(options.shortcuts){this.bindKeyMap(layoutInfo,options.keyMap[agent.isMac?'mac':'pc']);}
layoutInfo.editable().on('mousedown',hMousedown);layoutInfo.editable().on('keyup mouseup',hKeyupAndMouseup);layoutInfo.editable().on('scroll',hScroll);modules.clipboard.attach(layoutInfo,options);modules.handle.attach(layoutInfo,options);layoutInfo.popover().on('click',hToolbarAndPopoverClick);layoutInfo.popover().on('mousedown',hToolbarAndPopoverMousedown);modules.dragAndDrop.attach(layoutInfo,options);if(!options.airMode){layoutInfo.toolbar().on('click',hToolbarAndPopoverClick);layoutInfo.toolbar().on('mousedown',hToolbarAndPopoverMousedown);modules.statusbar.attach(layoutInfo,options);}
var $catcherContainer=options.airMode?layoutInfo.popover():layoutInfo.toolbar();var $catcher=$catcherContainer.find('.note-dimension-picker-mousecatcher');$catcher.css({width:options.insertTableMaxSize.col+'em',height:options.insertTableMaxSize.row+'em'}).on('mousemove',function(event){hDimensionPickerMove(event,options);});layoutInfo.editor().data('options',options);if(!agent.isMSIE){setTimeout(function(){document.execCommand('styleWithCSS',0,options.styleWithSpan);},0);}
var history=new History(layoutInfo.editable());layoutInfo.editable().data('NoteHistory',history);layoutInfo.editable().data('callbacks',{onInit:options.onInit,onFocus:options.onFocus,onBlur:options.onBlur,onKeydown:options.onKeydown,onKeyup:options.onKeyup,onMousedown:options.onMousedown,onEnter:options.onEnter,onPaste:options.onPaste,onBeforeCommand:options.onBeforeCommand,onChange:options.onChange,onImageUpload:options.onImageUpload,onImageUploadError:options.onImageUploadError,onMediaDelete:options.onMediaDelete,onToolbarClick:options.onToolbarClick});var styleInfo=modules.editor.styleFromNode(layoutInfo.editable());this.updateStyleInfo(styleInfo,layoutInfo);};this.attachCustomEvent=function(layoutInfo,options){var $holder=layoutInfo.holder();var $editable=layoutInfo.editable();var callbacks=$editable.data('callbacks');$editable.focus(bindCustomEvent($holder,callbacks,'focus'));$editable.blur(bindCustomEvent($holder,callbacks,'blur'));$editable.keydown(function(event){if(event.keyCode===key.code.ENTER){bindCustomEvent($holder,callbacks,'enter').call(this,event);}
bindCustomEvent($holder,callbacks,'keydown').call(this,event);});$editable.keyup(bindCustomEvent($holder,callbacks,'keyup'));$editable.on('mousedown',bindCustomEvent($holder,callbacks,'mousedown'));$editable.on('mouseup',bindCustomEvent($holder,callbacks,'mouseup'));$editable.on('scroll',bindCustomEvent($holder,callbacks,'scroll'));$editable.on('paste',bindCustomEvent($holder,callbacks,'paste'));var changeEventName=agent.isMSIE?'DOMCharacterDataModified DOMSubtreeModified DOMNodeInserted':'input';$editable.on(changeEventName,function(){bindCustomEvent($holder,callbacks,'change')($editable.html(),$editable);});if(!options.airMode){layoutInfo.toolbar().click(bindCustomEvent($holder,callbacks,'toolbar.click'));layoutInfo.popover().click(bindCustomEvent($holder,callbacks,'popover.click'));}
if(dom.isTextarea(list.head($holder))){$holder.closest('form').submit(function(e){layoutInfo.holder().val(layoutInfo.holder().code());bindCustomEvent($holder,callbacks,'submit').call(this,e,$holder.code());});}
if(dom.isTextarea(list.head($holder))&&options.textareaAutoSync){$holder.on('summernote.change',function(){layoutInfo.holder().val(layoutInfo.holder().code());});}
bindCustomEvent($holder,callbacks,'init')(layoutInfo);for(var i=0,len=$.summernote.plugins.length;i<len;i++){if($.isFunction($.summernote.plugins[i].init)){$.summernote.plugins[i].init(layoutInfo);}}};this.detach=function(layoutInfo,options){layoutInfo.holder().off();layoutInfo.editable().off();layoutInfo.popover().off();layoutInfo.handle().off();layoutInfo.dialog().off();if(!options.airMode){layoutInfo.dropzone().off();layoutInfo.toolbar().off();layoutInfo.statusbar().off();}};};return EventHandler;});;

/* <inline asset> defined in bundle 'web.assets_backend' */
odoo.website_next_define='summernote/defaults';;

/* /web_editor/static/lib/summernote/src/js/defaults.js defined in bundle 'web.assets_backend' */
define('summernote/defaults',function(){var defaults={version:'@VERSION',options:{width:null,height:null,minHeight:null,maxHeight:null,focus:false,tabsize:4,styleWithSpan:true,disableLinkTarget:false,disableDragAndDrop:false,disableResizeEditor:false,disableResizeImage:false,shortcuts:true,textareaAutoSync:true,placeholder:false,prettifyHtml:true,iconPrefix:'fa fa-',icons:{font:{bold:'bold',italic:'italic',underline:'underline',clear:'eraser',height:'text-height',strikethrough:'strikethrough',superscript:'superscript',subscript:'subscript'},image:{image:'picture-o',floatLeft:'align-left',floatRight:'align-right',floatNone:'align-justify',shapeRounded:'square',shapeCircle:'circle-o',shapeThumbnail:'picture-o',shapeNone:'times',remove:'trash-o'},link:{link:'link',unlink:'unlink',edit:'edit'},table:{table:'table'},hr:{insert:'minus'},style:{style:'magic'},lists:{unordered:'list-ul',ordered:'list-ol'},options:{help:'question',fullscreen:'arrows-alt',codeview:'code'},paragraph:{paragraph:'align-left',outdent:'outdent',indent:'indent',left:'align-left',center:'align-center',right:'align-right',justify:'align-justify'},color:{recent:'font'},history:{undo:'undo',redo:'repeat'},misc:{check:'check'}},dialogsInBody:false,codemirror:{mode:'text/html',htmlMode:true,lineNumbers:true},lang:'en-US',direction:null,toolbar:[['style',['style']],['font',['bold','italic','underline','clear']],['fontname',['fontname']],['fontsize',['fontsize']],['color',['color']],['para',['ul','ol','paragraph']],['height',['height']],['table',['table']],['insert',['link','picture','hr']],['view',['fullscreen','codeview']],['help',['help']]],plugin:{},airMode:false,airPopover:[['color',['color']],['font',['bold','underline','clear']],['para',['ul','paragraph']],['table',['table']],['insert',['link','picture']]],styleTags:['p','blockquote','pre','h1','h2','h3','h4','h5','h6'],defaultFontName:'Helvetica Neue',fontNames:['Arial','Arial Black','Comic Sans MS','Courier New','Helvetica Neue','Helvetica','Impact','Lucida Grande','Tahoma','Times New Roman','Verdana'],fontNamesIgnoreCheck:[],fontSizes:['8','9','10','11','12','14','18','24','36'],colors:[['#000000','#424242','#636363','#9C9C94','#CEC6CE','#EFEFEF','#F7F7F7','#FFFFFF'],['#FF0000','#FF9C00','#FFFF00','#00FF00','#00FFFF','#0000FF','#9C00FF','#FF00FF'],['#F7C6CE','#FFE7CE','#FFEFC6','#D6EFD6','#CEDEE7','#CEE7F7','#D6D6E7','#E7D6DE'],['#E79C9C','#FFC69C','#FFE79C','#B5D6A5','#A5C6CE','#9CC6EF','#B5A5D6','#D6A5BD'],['#E76363','#F7AD6B','#FFD663','#94BD7B','#73A5AD','#6BADDE','#8C7BC6','#C67BA5'],['#CE0000','#E79439','#EFC631','#6BA54A','#4A7B8C','#3984C6','#634AA5','#A54A7B'],['#9C0000','#B56308','#BD9400','#397B21','#104A5A','#085294','#311873','#731842'],['#630000','#7B3900','#846300','#295218','#083139','#003163','#21104A','#4A1031']],lineHeights:['1.0','1.2','1.4','1.5','1.6','1.8','2.0','3.0'],insertTableMaxSize:{col:10,row:10},maximumImageFileSize:null,oninit:null,onfocus:null,onblur:null,onenter:null,onkeyup:null,onkeydown:null,onImageUpload:null,onImageUploadError:null,onMediaDelete:null,onToolbarClick:null,onsubmit:null,onCreateLink:function(sLinkUrl){if(sLinkUrl.indexOf('@')!==-1&&sLinkUrl.indexOf(':')===-1){sLinkUrl='mailto:'+sLinkUrl;}
return sLinkUrl;},keyMap:{pc:{'ENTER':'insertParagraph','CTRL+Z':'undo','CTRL+Y':'redo','TAB':'tab','SHIFT+TAB':'untab','CTRL+B':'bold','CTRL+I':'italic','CTRL+U':'underline','CTRL+SHIFT+S':'strikethrough','CTRL+BACKSLASH':'removeFormat','CTRL+SHIFT+L':'justifyLeft','CTRL+SHIFT+E':'justifyCenter','CTRL+SHIFT+R':'justifyRight','CTRL+SHIFT+J':'justifyFull','CTRL+SHIFT+NUM7':'insertUnorderedList','CTRL+SHIFT+NUM8':'insertOrderedList','CTRL+LEFTBRACKET':'outdent','CTRL+RIGHTBRACKET':'indent','CTRL+NUM0':'formatPara','CTRL+NUM1':'formatH1','CTRL+NUM2':'formatH2','CTRL+NUM3':'formatH3','CTRL+NUM4':'formatH4','CTRL+NUM5':'formatH5','CTRL+NUM6':'formatH6','CTRL+ENTER':'insertHorizontalRule','CTRL+K':'showLinkDialog'},mac:{'ENTER':'insertParagraph','CMD+Z':'undo','CMD+SHIFT+Z':'redo','TAB':'tab','SHIFT+TAB':'untab','CMD+B':'bold','CMD+I':'italic','CMD+U':'underline','CMD+SHIFT+S':'strikethrough','CMD+BACKSLASH':'removeFormat','CMD+SHIFT+L':'justifyLeft','CMD+SHIFT+E':'justifyCenter','CMD+SHIFT+R':'justifyRight','CMD+SHIFT+J':'justifyFull','CMD+SHIFT+NUM7':'insertUnorderedList','CMD+SHIFT+NUM8':'insertOrderedList','CMD+LEFTBRACKET':'outdent','CMD+RIGHTBRACKET':'indent','CMD+NUM0':'formatPara','CMD+NUM1':'formatH1','CMD+NUM2':'formatH2','CMD+NUM3':'formatH3','CMD+NUM4':'formatH4','CMD+NUM5':'formatH5','CMD+NUM6':'formatH6','CMD+ENTER':'insertHorizontalRule','CMD+K':'showLinkDialog'}}},lang:{'en-US':{font:{bold:'Bold',italic:'Italic',underline:'Underline',clear:'Remove Font Style',height:'Line Height',name:'Font Family',strikethrough:'Strikethrough',subscript:'Subscript',superscript:'Superscript',size:'Font Size'},image:{image:'Picture',insert:'Insert Image',resizeFull:'Resize Full',resizeHalf:'Resize Half',resizeQuarter:'Resize Quarter',floatLeft:'Float Left',floatRight:'Float Right',floatNone:'Float None',shapeRounded:'Shape: Rounded',shapeCircle:'Shape: Circle',shapeThumbnail:'Shape: Thumbnail',shapeNone:'Shape: None',dragImageHere:'Drag image or text here',dropImage:'Drop image or Text',selectFromFiles:'Select from files',maximumFileSize:'Maximum file size',maximumFileSizeError:'Maximum file size exceeded.',url:'Image URL',remove:'Remove Image'},link:{link:'Link',insert:'Insert Link',unlink:'Unlink',edit:'Edit',textToDisplay:'Text to display',url:'To what URL should this link go?',openInNewWindow:'Open in new window'},table:{table:'Table'},hr:{insert:'Insert Horizontal Rule'},style:{style:'Style',normal:'Normal',blockquote:'Quote',pre:'Code',h1:'Header 1',h2:'Header 2',h3:'Header 3',h4:'Header 4',h5:'Header 5',h6:'Header 6'},lists:{unordered:'Unordered list',ordered:'Ordered list'},options:{help:'Help',fullscreen:'Full Screen',codeview:'Code View'},paragraph:{paragraph:'Paragraph',outdent:'Outdent',indent:'Indent',left:'Align left',center:'Align center',right:'Align right',justify:'Justify full'},color:{recent:'Recent Color',more:'More Color',background:'Background Color',foreground:'Foreground Color',transparent:'Transparent',setTransparent:'Set transparent',reset:'Reset',resetToDefault:'Reset to default'},shortcut:{shortcuts:'Keyboard shortcuts',close:'Close',textFormatting:'Text formatting',action:'Action',paragraphFormatting:'Paragraph formatting',documentStyle:'Document Style',extraKeys:'Extra keys'},history:{undo:'Undo',redo:'Redo'}}}};return defaults;});;

/* <inline asset> defined in bundle 'web.assets_backend' */
odoo.website_next_define='summernote/summernote';;

/* /web_editor/static/lib/summernote/src/js/summernote.js defined in bundle 'web.assets_backend' */
define(['summernote/core/agent','summernote/core/list','summernote/core/dom','summernote/core/range','summernote/defaults','summernote/EventHandler','summernote/Renderer','summernote/core/key'],function(agent,list,dom,range,defaults,EventHandler,Renderer,key){$.summernote=$.summernote||{};$.extend($.summernote,defaults);var renderer=new Renderer();var eventHandler=new EventHandler();$.extend($.summernote,{renderer:renderer,eventHandler:eventHandler,core:{agent:agent,list:list,dom:dom,range:range,key:key},pluginEvents:{},plugins:[]});$.summernote.addPlugin=function(plugin){$.summernote.plugins.push(plugin);if(plugin.buttons){$.each(plugin.buttons,function(name,button){renderer.addButtonInfo(name,button);});}
if(plugin.dialogs){$.each(plugin.dialogs,function(name,dialog){renderer.addDialogInfo(name,dialog);});}
if(plugin.events){$.each(plugin.events,function(name,event){$.summernote.pluginEvents[name]=event;});}
if(plugin.langs){$.each(plugin.langs,function(locale,lang){if($.summernote.lang[locale]){$.extend($.summernote.lang[locale],lang);}});}
if(plugin.options){$.extend($.summernote.options,plugin.options);}};$.fn.extend({summernote:function(){var type=$.type(list.head(arguments));var isExternalAPICalled=type==='string';var hasInitOptions=type==='object';var options=hasInitOptions?list.head(arguments):{};options=$.extend({},$.summernote.options,options);options.icons=$.extend({},$.summernote.options.icons,options.icons);options.langInfo=$.extend(true,{},$.summernote.lang['en-US'],$.summernote.lang[options.lang]);if(!isExternalAPICalled&&hasInitOptions){for(var i=0,len=$.summernote.plugins.length;i<len;i++){var plugin=$.summernote.plugins[i];if(options.plugin[plugin.name]){$.summernote.plugins[i]=$.extend(true,plugin,options.plugin[plugin.name]);}}}
this.each(function(idx,holder){var $holder=$(holder);if(!renderer.hasNoteEditor($holder)){renderer.createLayout($holder,options);var layoutInfo=renderer.layoutInfoFromHolder($holder);$holder.data('layoutInfo',layoutInfo);eventHandler.attach(layoutInfo,options);eventHandler.attachCustomEvent(layoutInfo,options);}});var $first=this.first();if($first.length){var layoutInfo=renderer.layoutInfoFromHolder($first);if(isExternalAPICalled){var moduleAndMethod=list.head(list.from(arguments));var args=list.tail(list.from(arguments));var params=[moduleAndMethod,layoutInfo.editable()].concat(args);return eventHandler.invoke.apply(eventHandler,params);}else if(options.focus){layoutInfo.editable().focus();}}
return this;},code:function(html){if(html===undefined){var $holder=this.first();if(!$holder.length){return;}
var layoutInfo=renderer.layoutInfoFromHolder($holder);var $editable=layoutInfo&&layoutInfo.editable();if($editable&&$editable.length){var isCodeview=eventHandler.invoke('codeview.isActivated',layoutInfo);eventHandler.invoke('codeview.sync',layoutInfo);return isCodeview?layoutInfo.codable().val():layoutInfo.editable().html();}
return dom.value($holder);}
this.each(function(i,holder){var layoutInfo=renderer.layoutInfoFromHolder($(holder));var $editable=layoutInfo&&layoutInfo.editable();if($editable){$editable.html(html);}});return this;},destroy:function(){this.each(function(idx,holder){var $holder=$(holder);if(!renderer.hasNoteEditor($holder)){return;}
var info=renderer.layoutInfoFromHolder($holder);var options=info.editor().data('options');eventHandler.detach(info,options);renderer.removeLayout($holder,info,options);});return this;}});});;

/* /web_editor/static/src/js/summernote.js defined in bundle 'web.assets_backend' */
odoo.define('web_editor.summernote',function(require){'use strict';var core=require('web.core');require('summernote/summernote');var _t=core._t;var agent=$.summernote.core.agent;var dom=$.summernote.core.dom;var range=$.summernote.core.range;var list=$.summernote.core.list;var key=$.summernote.core.key;var eventHandler=$.summernote.eventHandler;var editor=eventHandler.modules.editor;var renderer=$.summernote.renderer;var options=$.summernote.options;dom.hasContentAfter=function(node){var next;if(dom.isEditable(node))return;while(node.nextSibling){next=node.nextSibling;if(next.tagName||dom.isVisibleText(next)||dom.isBR(next))return next;node=next;}};dom.hasContentBefore=function(node){var prev;if(dom.isEditable(node))return;while(node.previousSibling){prev=node.previousSibling;if(prev.tagName||dom.isVisibleText(prev)||dom.isBR(prev))return prev;node=prev;}};dom.ancestorHaveNextSibling=function(node,pred){pred=pred||dom.hasContentAfter;while(!dom.isEditable(node)&&(!node.nextSibling||!pred(node))){node=node.parentNode;}
return node;};dom.ancestorHavePreviousSibling=function(node,pred){pred=pred||dom.hasContentBefore;while(!dom.isEditable(node)&&(!node.previousSibling||!pred(node))){node=node.parentNode;}
return node;};dom.nextElementSibling=function(node){while(node){node=node.nextSibling;if(node&&node.tagName){break;}}
return node;};dom.previousElementSibling=function(node){while(node){node=node.previousSibling;if(node&&node.tagName){break;}}
return node;};dom.lastChild=function(node){while(node.lastChild){node=node.lastChild;}
return node;};dom.firstChild=function(node){while(node.firstChild){node=node.firstChild;}
return node;};dom.lastElementChild=function(node,deep){node=deep?dom.lastChild(node):node.lastChild;return!node||node.tagName?node:dom.previousElementSibling(node);};dom.firstElementChild=function(node,deep){node=deep?dom.firstChild(node):node.firstChild;return!node||node.tagName?node:dom.nextElementSibling(node);};dom.isEqual=function(prev,cur){if(prev.tagName!==cur.tagName){return false;}
if((prev.attributes?prev.attributes.length:0)!==(cur.attributes?cur.attributes.length:0)){return false;}
function strip(text){return text&&text.replace(/^\s+|\s+$/g,'').replace(/\s+/g,' ');}
var att,att2;loop_prev:for(var a in prev.attributes){att=prev.attributes[a];for(var b in cur.attributes){att2=cur.attributes[b];if(att.name===att2.name){if(strip(att.value)!=strip(att2.value))return false;continue loop_prev;}}
return false;}
return true;};dom.hasOnlyStyle=function(node){for(var i=0;i<node.attributes.length;i++){var attr=node.attributes[i];if(attr.attributeName!=='style'){return false;}}
return true;};dom.hasProgrammaticStyle=function(node){var styles=["float","display","position","top","left","right","bottom"];for(var i=0;i<node.style.length;i++){var style=node.style[i];if(styles.indexOf(style)!==-1){return true;}}
return false;};dom.mergeFilter=function(prev,cur,parent){if(prev&&(dom.isText(prev)||("H1 H2 H3 H4 H5 H6 LI P".indexOf(prev.tagName)!==-1&&prev!==cur.parentNode))&&dom.isText(cur)){return true;}
if(prev&&prev.tagName==="P"&&dom.isText(cur)){return true;}
if(prev&&dom.isText(cur)&&!dom.isVisibleText(cur)&&(dom.isText(prev)||dom.isVisibleText(prev))){return true;}
if(prev&&!dom.isBR(prev)&&dom.isEqual(prev,cur)&&((prev.tagName&&dom.getComputedStyle(prev).display==="inline"&&cur.tagName&&dom.getComputedStyle(cur).display==="inline"))){return true;}
if(dom.isEqual(parent,cur)&&((parent.tagName&&dom.getComputedStyle(parent).display==="inline"&&cur.tagName&&dom.getComputedStyle(cur).display==="inline"))){return true;}
if(parent&&cur.tagName==="FONT"&&(!cur.firstChild||(!cur.attributes.getNamedItem('style')&&!cur.className.length))){return true;}
if(parent&&cur.tagName==="SPAN"&&dom.hasOnlyStyle(cur)&&!dom.hasProgrammaticStyle(cur)){return true;}};dom.doMerge=function(prev,cur){if(prev.tagName){if(prev.childNodes.length&&!prev.textContent.match(/\S/)&&dom.firstElementChild(prev)&&dom.isBR(dom.firstElementChild(prev))){prev.removeChild(dom.firstElementChild(prev));}
if(cur.tagName){while(cur.firstChild){prev.appendChild(cur.firstChild);}
cur.parentNode.removeChild(cur);}else{prev.appendChild(cur);}}else{if(cur.tagName){var deep=cur;while(deep.tagName&&deep.firstChild){deep=deep.firstChild;}
prev.appendData(deep.textContent);cur.parentNode.removeChild(cur);}else{prev.appendData(cur.textContent);cur.parentNode.removeChild(cur);}}};dom.merge=function(node,begin,so,end,eo,mergeFilter,all){mergeFilter=mergeFilter||dom.mergeFilter;var _merged=false;var add=all||false;if(!begin){begin=node;while(begin.firstChild){begin=begin.firstChild;}
so=0;}else if(begin.tagName&&begin.childNodes[so]){begin=begin.childNodes[so];so=0;}
if(!end){end=node;while(end.lastChild){end=end.lastChild;}
eo=end.textContent.length-1;}else if(end.tagName){}else if(end.tagName&&end.childNodes[so]){end=end.childNodes[so];so=0;}
begin=dom.firstChild(begin);if(dom.isText(begin)&&so>begin.textContent.length){so=0;}
end=dom.firstChild(end);if(dom.isText(end)&&eo>end.textContent.length){eo=0;}
function __merge(node){var merged=false;var prev;for(var k=0;k<node.childNodes.length;k++){var cur=node.childNodes[k];if(cur===begin){if(!all)add=true;}
__merge(cur);dom.orderClass(dom.node(cur));if(!add||!cur)continue;if(cur===end){if(!all)add=false;}
if(!prev){if(mergeFilter.call(dom,prev,cur,node)){prev=prev||cur.previousSibling;dom.moveTo(cur,cur.parentNode,cur);k--;}else{prev=cur;}
continue;}else if(mergeFilter.call(dom,null,cur,node)){prev=prev||cur.previousSibling;dom.moveTo(cur,cur.parentNode,cur);k--;continue;}
if(mergeFilter.call(dom,prev,cur,node)){var p=prev;var c=cur;if(prev.tagName){if(cur.tagName){if(cur===begin)begin=prev;if(cur===end)end=prev;}}else{if(cur.tagName){var deep=cur;while(deep.tagName&&deep.lastChild){deep=deep.lastChild;}
if(deep===begin){so+=prev.textContent.length;begin=prev;}
if(deep===end){eo+=prev.textContent.length;end=prev;}}else{if(cur===begin){so+=prev.textContent.length;begin=prev;}
if(cur===end){eo+=prev.textContent.length;end=prev;}}}
dom.doMerge(p,c);merged=true;k--;continue;}
prev=cur;}
if(merged){_merged=true;__merge(node);}}
if(node){__merge(node);}
return{merged:_merged,sc:begin,ec:end,so:so,eo:eo};};dom.autoMerge=function(target,previous){var node=dom.lastChild(target);var nodes=[];var temp;while(node){nodes.push(node);if(temp=(previous?dom.hasContentBefore(node):dom.hasContentAfter(node))){if(!dom.isText(node)&&!dom.isMergable(node)&&temp.tagName!==node.tagName){nodes=[];}
break;}
node=node.parentNode;}
while(nodes.length){node=nodes.pop();if(node&&(temp=(previous?dom.hasContentBefore(node):dom.hasContentAfter(node)))&&temp.tagName===node.tagName&&!dom.isText(node)&&dom.isMergable(node)&&!dom.isNotBreakable(node)&&!dom.isNotBreakable(previous?dom.previousElementSibling(node):dom.nextElementSibling(node))){if(previous){dom.doMerge(temp,node);}else{dom.doMerge(node,temp);}}}};dom.removeSpace=function(node,begin,so,end,eo){var removed=false;var add=node===begin;if(node===begin&&begin===end&&dom.isBR(node)){return{removed:removed,sc:begin,ec:end,so:so,eo:eo};}
(function __remove_space(node){if(!node)return;var t_begin,t_end;for(var k=0;k<node.childNodes.length;k++){var cur=node.childNodes[k];if(cur===begin)add=true;if(cur.tagName&&cur.tagName!=="SCRIPT"&&cur.tagName!=="STYLE"&&dom.getComputedStyle(cur).whiteSpace!=="pre"){__remove_space(cur);}
if(!add)continue;if(cur===end)add=false;if(node.childNodes.length>1&&dom.isText(cur)&&!dom.isVisibleText(cur)){removed=true;if(cur===begin){t_begin=dom.hasContentBefore(dom.ancestorHavePreviousSibling(cur));if(t_begin){so=0;begin=dom.lastChild(t_begin);}}
if(cur===end){t_end=dom.hasContentAfter(dom.ancestorHaveNextSibling(cur));if(t_end){eo=1;end=dom.firstChild(t_end);if(dom.isText(end)){eo=end.textContent.length;}}}
cur.parentNode.removeChild(cur);begin=dom.lastChild(begin);end=dom.lastChild(end);k--;continue;}
if(dom.isText(cur)){var text;var exp1=/[\t\n\r ]+/g;var exp2=/(?!([ ]|\u00A0)|^)\u00A0(?!([ ]|\u00A0)|$)/g;if(cur===begin){var temp=cur.textContent.substr(0,so);var _temp=temp.replace(exp1,' ').replace(exp2,' ');so-=temp.length-_temp.length;}
if(cur===end){var temp=cur.textContent.substr(0,eo);var _temp=temp.replace(exp1,' ').replace(exp2,' ');eo-=temp.length-_temp.length;}
var text=cur.textContent.replace(exp1,' ').replace(exp2,' ');removed=removed||cur.textContent.length!==text.length;cur.textContent=text;}}})(node);return{removed:removed,sc:begin,ec:end,so:!dom.isBR(begin)&&so>0?so:0,eo:dom.isBR(end)?0:eo};};dom.node=function(node){return node.tagName?node:node.parentNode;};dom.removeBetween=function(sc,so,ec,eo,towrite){if(ec.tagName){if(ec.childNodes[eo]){ec=ec.childNodes[eo];eo=0;}else{ec=dom.lastChild(ec);eo=dom.nodeLength(ec);}}
if(sc.tagName){sc=sc.childNodes[so]||dom.firstChild(ec);so=0;if(!dom.hasContentBefore(sc)&&towrite){sc.parentNode.insertBefore(document.createTextNode('\u00A0'),sc);}}
if(!eo&&sc!==ec){ec=dom.lastChild(dom.hasContentBefore(dom.ancestorHavePreviousSibling(ec))||ec);eo=ec.textContent.length;}
var ancestor=dom.commonAncestor(sc.tagName?sc.parentNode:sc,ec.tagName?ec.parentNode:ec)||dom.ancestor(sc,dom.isEditable);if(!dom.isContentEditable(ancestor)){return{sc:sc,so:so,ec:sc,eo:eo};}
if(ancestor.tagName){var ancestor_sc=sc;var ancestor_ec=ec;while(ancestor!==ancestor_sc&&ancestor!==ancestor_sc.parentNode){ancestor_sc=ancestor_sc.parentNode;}
while(ancestor!==ancestor_ec&&ancestor!==ancestor_ec.parentNode){ancestor_ec=ancestor_ec.parentNode;}
var node=dom.node(sc);if(!dom.isNotBreakable(node)&&!dom.isVoid(sc)){sc=dom.splitTree(ancestor_sc,{'node':sc,'offset':so});}
var before=dom.hasContentBefore(dom.ancestorHavePreviousSibling(sc));var after;if(ec.textContent.slice(eo,Infinity).match(/\S|\u00A0/)){after=dom.splitTree(ancestor_ec,{'node':ec,'offset':eo});}else{after=dom.hasContentAfter(dom.ancestorHaveNextSibling(ec));}
var nodes=dom.listBetween(sc,ec);var ancestor_first_last=function(node){return node===before||node===after;};for(var i=0;i<nodes.length;i++){if(!dom.ancestor(nodes[i],ancestor_first_last)&&!$.contains(nodes[i],before)&&!$.contains(nodes[i],after)){nodes[i].parentNode.removeChild(nodes[i]);}}
if(dom.listAncestor(after).length<=dom.listAncestor(before).length){sc=dom.lastChild(before||ancestor);so=dom.nodeLength(sc);}else{sc=dom.firstChild(after);so=0;}
if(dom.isVoid(node)){}else if(towrite&&!node.firstChild&&node.parentNode&&!dom.isNotBreakable(node)){var br=$("<br/>")[0];node.appendChild(sc);sc=br;so=0;}else if(!ancestor.children.length&&!ancestor.textContent.match(/\S|\u00A0/)){sc=$("<br/>")[0];so=0;$(ancestor).prepend(sc);}else if(dom.isText(sc)){var text=sc.textContent.replace(/[ \t\n\r]+$/,'\u00A0');so=Math.min(so,text.length);sc.textContent=text;}}else{var text=ancestor.textContent;ancestor.textContent=text.slice(0,so)+text.slice(eo,Infinity).replace(/^[ \t\n\r]+/,'\u00A0');}
eo=so;if(!dom.isBR(sc)&&!dom.isVisibleText(sc)&&!dom.isText(dom.hasContentBefore(sc))&&!dom.isText(dom.hasContentAfter(sc))){ancestor=dom.node(sc);var text=document.createTextNode('\u00A0');$(sc).before(text);sc=text;so=0;eo=1;}
return{sc:sc,so:so,ec:sc,eo:eo};};dom.indent=function(node){var style=dom.isCell(node)?'paddingLeft':'marginLeft';var margin=parseFloat(node.style[style]||0)+1.5;node.style[style]=margin+"em";return margin;};dom.outdent=function(node){var style=dom.isCell(node)?'paddingLeft':'marginLeft';var margin=parseFloat(node.style[style]||0)-1.5;node.style[style]=margin>0?margin+"em":"";return margin;};dom.scrollIntoViewIfNeeded=function(node){var node=dom.node(node);var $span;if(dom.isBR(node)){$span=$('<span/>').text('\u00A0');$(node).after($span);node=$span[0];}
if(node.scrollIntoViewIfNeeded){node.scrollIntoViewIfNeeded(false);}else{var offsetParent=node.offsetParent;while(offsetParent){var elY=0;var elH=node.offsetHeight;var parent=node;while(offsetParent&&parent){elY+=node.offsetTop;parent=node.parentNode;while(parent!=offsetParent&&(parent.tagName==="BODY"||["auto","scroll"].indexOf(dom.getComputedStyle(parent).overflowY)===-1)){parent=parent.parentNode;}
node=parent;if(parent!==offsetParent){elY-=parent.offsetTop;parent=null;}
offsetParent=node.offsetParent;}
if((node.tagName==="BODY"||["auto","scroll"].indexOf(dom.getComputedStyle(node).overflowY)!==-1)&&(node.scrollTop+node.clientHeight)<(elY+elH)){node.scrollTop=(elY+elH)-node.clientHeight;}}}
if($span){$span.remove();}
return;};dom.moveTo=function(node,target,before){var nodes=[];while(node.firstChild){nodes.push(node.firstChild);if(before){target.insertBefore(node.firstChild,before);}else{target.appendChild(node.firstChild);}}
node.parentNode.removeChild(node);return nodes;};dom.isMergable=function(node){return node.tagName&&"h1 h2 h3 h4 h5 h6 p b bold i u code sup strong small li a ul ol font".indexOf(node.tagName.toLowerCase())!==-1;};dom.isSplitable=function(node){return node.tagName&&"h1 h2 h3 h4 h5 h6 p b bold i u code sup strong small li a font".indexOf(node.tagName.toLowerCase())!==-1;};dom.isRemovableEmptyNode=function(node){return"h1 h2 h3 h4 h5 h6 p b bold i u code sup strong small li a ul ol font span br".indexOf(node.tagName.toLowerCase())!==-1;};dom.isForbiddenNode=function(node){return node.tagName==="BR"||$(node).is(".fa, img");};dom.listBetween=function(sc,ec){var nodes=[];var ancestor=dom.commonAncestor(sc,ec);dom.walkPoint({'node':sc,'offset':0},{'node':ec,'offset':0},function(point){if(ancestor!==point.node||ancestor===sc||ancestor===ec){nodes.push(point.node);}});return list.unique(nodes);};dom.isNotBreakable=function(node){return!dom.isText(node)&&!dom.isBR(dom.firstChild(node))&&dom.isVoid(dom.firstChild(node));};dom.isContentEditable=function(node){return $(node).closest('[contenteditable]').is('[contenteditable="true"]');};dom.isPre=function(node){return node.tagName==="PRE";};dom.isFont=function(node){var nodeName=node&&node.nodeName.toUpperCase();return node&&(nodeName==="FONT"||(nodeName==="SPAN"&&(node.className.match(/(^|\s)fa(\s|$)/i)||node.className.match(/(^|\s)(text|bg)-/i)||(node.attributes.style&&node.attributes.style.value.match(/(^|\s)(color|background-color|font-size):/i)))));};dom.isVisibleText=function(textNode){return!!textNode.textContent.match(/\S|\u00A0/);};var old_isVisiblePoint=dom.isVisiblePoint;dom.isVisiblePoint=function(point){return point.node.nodeType!==8&&old_isVisiblePoint.apply(this,arguments);};dom.orderStyle=function(node){var style=node.getAttribute('style');if(!style)return null;style=style.replace(/[\s\n\r]+/,' ').replace(/^ ?;? ?| ?;? ?$/g,'').replace(/ ?; ?/g,';');if(!style.length){node.removeAttribute("style");return null;}
style=style.split(";");style.sort();style=style.join("; ")+";";node.setAttribute('style',style);return style;};dom.orderClass=function(node){var className=node.getAttribute&&node.getAttribute('class');if(!className)return null;className=className.replace(/[\s\n\r]+/,' ').replace(/^ | $/g,'').replace(/ +/g,' ');if(!className.length){node.removeAttribute("class");return null;}
className=className.split(" ");className.sort();className=className.join(" ");node.setAttribute('class',className);return className;};dom.node=function(node){return dom.isText(node)?node.parentNode:node;};dom.moveContent=function(from,to){if(from===to){return;}
if(from.parentNode===to){while(from.lastChild){dom.insertAfter(from.lastChild,from);}}else{while(from.firstChild&&from.firstChild!=to){to.appendChild(from.firstChild);}}};dom.getComputedStyle=function(node){return node.nodeType==Node.COMMENT_NODE?{}:window.getComputedStyle(node);};range.WrappedRange.prototype.reRange=function(keep_end,isNotBreakable){var sc=this.sc;var so=this.so;var ec=this.ec;var eo=this.eo;isNotBreakable=isNotBreakable||dom.isNotBreakable;var start=keep_end?ec:sc;while(start){if(isNotBreakable(start,sc,so,ec,eo)){break;}
start=start.parentNode;}
var lastFilterEnd;var end=keep_end?sc:ec;while(end){if(start===end){break;}
if(isNotBreakable(end,sc,so,ec,eo)){lastFilterEnd=end;}
end=end.parentNode;}
if(lastFilterEnd){end=lastFilterEnd;}
if(!end){end=document.getElementsByTagName('body')[0];}
if(start===end||!start){return this;}
if($.contains(start,end)){if(keep_end){sc=dom.lastChild(dom.hasContentBefore(dom.ancestorHavePreviousSibling(end))||sc);so=sc.textContent.length;}else if(!eo){ec=dom.lastChild(dom.hasContentBefore(dom.ancestorHavePreviousSibling(end))||ec);eo=ec.textContent.length;}else{ec=dom.firstChild(dom.hasContentAfter(dom.ancestorHaveNextSibling(end))||ec);eo=0;}}else{if(keep_end){sc=dom.firstChild(start);so=0;}else{ec=dom.lastChild(start);eo=ec.textContent.length;}}
return new range.WrappedRange(sc,so,ec,eo);};range.WrappedRange.prototype.isOnImg=function(){var nb=0;var image;var startPoint={node:this.sc.childNodes.length&&this.sc.childNodes[this.so]||this.sc};startPoint.offset=startPoint.node===this.sc?this.so:0;var endPoint={node:this.ec.childNodes.length&&this.ec.childNodes[this.eo]||this.ec};endPoint.offset=endPoint.node===this.ec?this.eo:0;if(dom.isImg(startPoint.node)){nb++;image=startPoint.node;}
dom.walkPoint(startPoint,endPoint,function(point){if(!dom.isText(endPoint.node)&&point.node===endPoint.node&&point.offset===endPoint.offset){return;}
var node=point.node.childNodes.length&&point.node.childNodes[point.offset]||point.node;var offset=node===point.node?point.offset:0;var isImg=dom.ancestor(node,dom.isImg);if(!isImg&&((!dom.isBR(node)&&!dom.isText(node))||(offset&&node.textContent.length!==offset&&node.textContent.match(/\S|\u00A0/)))){nb++;}
if(isImg&&image!==isImg){image=isImg;nb++;}});return nb===1&&image;};range.WrappedRange.prototype.deleteContents=function(towrite){var prevBP=dom.removeBetween(this.sc,this.so,this.ec,this.eo,towrite);$(dom.node(prevBP.sc)).trigger("click");return new range.WrappedRange(prevBP.sc,prevBP.so,prevBP.ec,prevBP.eo);};range.WrappedRange.prototype.clean=function(mergeFilter,all){var node=dom.node(this.sc===this.ec?this.sc:this.commonAncestor());node=node||$(this.sc).closest('[contenteditable]')[0];if(node.childNodes.length<=1){return this;}
var merge=dom.merge(node,this.sc,this.so,this.ec,this.eo,mergeFilter,all);var rem=dom.removeSpace(node.parentNode,merge.sc,merge.so,merge.ec,merge.eo);if(merge.merged||rem.removed){return range.create(rem.sc,rem.so,rem.ec,rem.eo);}
return this;};range.WrappedRange.prototype.remove=function(mergeFilter){};range.WrappedRange.prototype.isOnCellFirst=function(){var node=dom.ancestor(this.sc,function(node){return["LI","DIV","TD","TH"].indexOf(node.tagName)!==-1;});return node&&["TD","TH"].indexOf(node.tagName)!==-1;};range.WrappedRange.prototype.isContentEditable=function(){return dom.isContentEditable(this.sc)&&(this.sc===this.ec||dom.isContentEditable(this.ec));};renderer.tplButtonInfo.fontsize=function(lang,options){var items=options.fontSizes.reduce(function(memo,v){return memo+'<li><a data-event="fontSize" href="#" data-value="'+v+'">'+'<i class="fa fa-check"></i> '+v+'</a></li>';},'');var sLabel='<span class="note-current-fontsize">11</span>';return renderer.getTemplate().button(sLabel,{title:lang.font.size,dropdown:'<ul class="dropdown-menu">'+items+'</ul>'});};key.nameFromCode[46]='DELETE';key.nameFromCode[27]='ESCAPE';options.keyMap.pc['BACKSPACE']='backspace';options.keyMap.pc['DELETE']='delete';options.keyMap.pc['ENTER']='enter';options.keyMap.pc['ESCAPE']='cancel';options.keyMap.mac['SHIFT+TAB']='untab';options.keyMap.pc['UP']='up';options.keyMap.pc['DOWN']='down';options.keyMap.mac['BACKSPACE']='backspace';options.keyMap.mac['DELETE']='delete';options.keyMap.mac['ENTER']='enter';options.keyMap.mac['ESCAPE']='cancel';options.keyMap.mac['UP']='up';options.keyMap.mac['DOWN']='down';$.summernote.pluginEvents.insertTable=function(event,editor,layoutInfo,sDim){var $editable=layoutInfo.editable();var dimension=sDim.split('x');var r=range.create();if(!r)return;r=r.deleteContents();var isBodyContainer=dom.isBodyContainer;dom.isBodyContainer=dom.isNotBreakable;r.insertNode(editor.table.createTable(dimension[0],dimension[1]));dom.isBodyContainer=isBodyContainer;editor.afterCommand($editable);event.preventDefault();return false;};$.summernote.pluginEvents.tab=function(event,editor,layoutInfo,outdent){var $editable=layoutInfo.editable();$editable.data('NoteHistory').recordUndo($editable,'tab');var r=range.create();var outdent=outdent||false;event.preventDefault();if(r&&(dom.ancestor(r.sc,dom.isCell)||dom.ancestor(r.ec,dom.isCell))){if(r.isCollapsed()&&r.isOnCell()&&r.isOnCellFirst()){var td=dom.ancestor(r.sc,dom.isCell);if(!outdent&&!dom.nextElementSibling(td)&&!dom.nextElementSibling(td.parentNode)){var last=dom.lastChild(td);range.create(last,dom.nodeLength(last),last,dom.nodeLength(last)).select();$.summernote.pluginEvents.enter(event,editor,layoutInfo);}else if(outdent&&!dom.previousElementSibling(td)&&!$(td.parentNode).text().match(/\S/)){$.summernote.pluginEvents.backspace(event,editor,layoutInfo);}else{editor.table.tab(r,outdent);}}else{$.summernote.pluginEvents.indent(event,editor,layoutInfo,outdent);}}else if(r&&r.isCollapsed()){if(!r.sc.textContent.slice(0,r.so).match(/\S/)&&r.isOnList()){if(outdent){$.summernote.pluginEvents.outdent(event,editor,layoutInfo);}else{$.summernote.pluginEvents.indent(event,editor,layoutInfo);}}else{if(!outdent){if(dom.isText(r.sc)){var next=r.sc.splitText(r.so);}else{var next=document.createTextNode('')
$(r.sc.childNodes[r.so]).before(next);}
editor.typing.insertTab($editable,r,options.tabsize);r=range.create(next,0,next,0);r=dom.merge(r.sc.parentNode,r.sc,r.so,r.ec,r.eo,null,true);range.create(r.sc,r.so,r.ec,r.eo).select();}else{r=dom.merge(r.sc.parentNode,r.sc,r.so,r.ec,r.eo,null,true);r=range.create(r.sc,r.so,r.ec,r.eo);var next=r.sc.splitText(r.so);r.sc.textContent=r.sc.textContent.replace(/(\u00A0)+$/g,'');next.textContent=next.textContent.replace(/^(\u00A0)+/g,'');range.create(r.sc,r.sc.textContent.length,r.sc,r.sc.textContent.length).select();}}}
return false;};$.summernote.pluginEvents.untab=function(event,editor,layoutInfo){return $.summernote.pluginEvents.tab(event,editor,layoutInfo,true);};$.summernote.pluginEvents.up=function(event,editor,layoutInfo){var r=range.create();var node=dom.firstChild(r.sc.childNodes[r.so]||r.sc);if(!r.isOnCell()||(!dom.isCell(node)&&dom.hasContentBefore(node)&&(!dom.isBR(dom.hasContentBefore(node))||!dom.isText(node)||dom.isVisibleText(node)||dom.hasContentBefore(dom.hasContentBefore(node))))){return;}
event.preventDefault();var td=dom.ancestor(r.sc,dom.isCell);var tr=td.parentNode;var target=tr.previousElementSibling&&tr.previousElementSibling.children[_.indexOf(tr.children,td)];if(!target){target=(dom.ancestorHavePreviousSibling(tr)||tr).previousSibling;}
if(target){range.create(dom.lastChild(target),dom.lastChild(target).textContent.length).select();}};$.summernote.pluginEvents.down=function(event,editor,layoutInfo){var r=range.create();var node=dom.firstChild(r.sc.childNodes[r.so]||r.sc);if(!r.isOnCell()||(!dom.isCell(node)&&dom.hasContentAfter(node)&&(!dom.isBR(dom.hasContentAfter(node))||!dom.isText(node)||dom.isVisibleText(node)||dom.hasContentAfter(dom.hasContentAfter(node))))){return;}
event.preventDefault();var td=dom.ancestor(r.sc,dom.isCell);var tr=td.parentNode;var target=tr.nextElementSibling&&tr.nextElementSibling.children[_.indexOf(tr.children,td)];if(!target){target=(dom.ancestorHaveNextSibling(tr)||tr).nextSibling;}
if(target){range.create(dom.firstChild(target),0).select();}};$.summernote.pluginEvents.enter=function(event,editor,layoutInfo){var $editable=layoutInfo.editable();$editable.data('NoteHistory').recordUndo($editable,'enter');var r=range.create();if(!r.isContentEditable()){event.preventDefault();return false;}
if(!r.isCollapsed()){r=r.deleteContents();r.select();}
var br=$("<br/>")[0];var contentBefore=r.sc.textContent.slice(0,r.so).match(/\S|\u00A0/);if(!contentBefore&&dom.isText(r.sc)){var node=r.sc.previousSibling;while(!contentBefore&&node&&dom.isText(node)){contentBefore=dom.isVisibleText(node);node=node.previousSibling;}}
var exist=r.sc.childNodes[r.so]||r.sc;var node=dom.node(exist);exist=dom.isVisibleText(exist)||dom.isBR(exist)?exist:dom.hasContentAfter(exist)||(dom.hasContentBefore(exist)||exist);var td=dom.ancestor(node,dom.isCell);if(td&&!dom.nextElementSibling(node)&&!dom.nextElementSibling(td)&&!dom.nextElementSibling(td.parentNode)&&(!dom.isText(r.sc)||!r.sc.textContent.slice(r.so).match(/\S|\u00A0/))){var $node=$(td.parentNode);var $clone=$node.clone();$clone.children().html(dom.blank);$node.after($clone);var node=dom.firstElementChild($clone[0])||$clone[0];range.create(node,0,node,0).select();dom.scrollIntoViewIfNeeded(br);event.preventDefault();return false;}
var last=node;while(node&&dom.isSplitable(node)&&!dom.isList(node)){last=node;node=node.parentNode;}
if(last===node&&!dom.isBR(node)){node=r.insertNode(br,true);if(isFormatNode(last.firstChild)&&$(last).closest(options.styleTags.join(',')).length){dom.moveContent(last.firstChild,last);last.removeChild(last.firstChild);}
do{node=dom.hasContentAfter(node);}while(node&&dom.isBR(node));if(!node&&(!br.nextElementSibling||!dom.isBR(br.nextElementSibling))){$(br).before($("<br/>")[0]);}
node=br.nextSibling||br;}else if(last===node&&dom.isBR(node)){$(node).after(br);node=br;}else if(!r.so&&r.isOnList()&&!r.sc.textContent.length&&!dom.ancestor(r.sc,dom.isLi).nextElementSibling){$('<p></p>').append(br).insertAfter(dom.ancestor(r.sc,dom.isList));node=br;}else if(dom.isBR(exist)&&$(r.sc).closest('blockquote, pre').length&&!dom.hasContentAfter($(exist.parentNode).closest('blockquote *, pre *').length?exist.parentNode:exist)){$('<p></p>').append(br).insertAfter($(r.sc).closest('blockquote, pre'));node=br;}else if(last===r.sc){if(dom.isBR(last)){last=last.parentNode;}
var $node=$(last);var $clone=$node.clone().text("");$node.after($clone);node=dom.node(dom.firstElementChild($clone[0])||$clone[0]);$(node).html(br);node=br;}else{node=dom.splitTree(last,{'node':r.sc,'offset':r.so})||r.sc;if(!contentBefore){var cur=dom.node(dom.lastChild(node.previousSibling));if(!dom.isBR(cur)){$(cur).html(br);}}
if(!dom.isVisibleText(node)){node=dom.firstChild(node);$(dom.node(dom.isBR(node)?node.parentNode:node)).html(br);node=br;}}
if(node){node=dom.firstChild(node);if(dom.isBR(node)){range.createFromNode(node).select();}else{range.create(node,0).select();}
dom.scrollIntoViewIfNeeded(node);}
event.preventDefault();return false;};$.summernote.pluginEvents.visible=function(event,editor,layoutInfo){var $editable=layoutInfo.editable();$editable.data('NoteHistory').recordUndo($editable,"visible");var r=range.create();if(!r)return;if(!r.isCollapsed()){if(dom.isCell(dom.node(r.sc))||dom.isCell(dom.node(r.ec))){remove_table_content(r);r=range.create(r.ec,0).select();}else{r=r.deleteContents(true);}
r.select();}
var node=dom.firstChild(r.sc.tagName&&r.so?r.sc.childNodes[r.so]||r.sc:r.sc);while(node.parentNode){if(dom.isForbiddenNode(node)){var text=node.previousSibling;if(text&&dom.isText(text)&&dom.isVisibleText(text)){range.create(text,text.textContent.length,text,text.textContent.length).select();}else{text=node.parentNode.insertBefore(document.createTextNode("."),node);range.create(text,1,text,1).select();setTimeout(function(){var text=range.create().sc;text.textContent=text.textContent.replace(/^./,'');range.create(text,text.textContent.length,text,text.textContent.length).select();},0);}
break;}
node=node.parentNode;}
return true;};function summernote_keydown_clean(field){setTimeout(function(){var r=range.create();if(!r)return;var node=r[field];while(dom.isText(node)){node=node.parentNode;}
node=node.parentNode;var data=dom.merge(node,r.sc,r.so,r.ec,r.eo,null,true);data=dom.removeSpace(node.parentNode,data.sc,data.so,data.sc,data.so);range.create(data.sc,data.so,data.sc,data.so).select();},0);}
function remove_table_content(r){var ancestor=r.commonAncestor();var nodes=dom.listBetween(r.sc,r.ec);if(dom.isText(r.sc)){r.sc.textContent=r.sc.textContent.slice(0,r.so);}
if(dom.isText(r.ec)){r.ec.textContent=r.ec.textContent.slice(r.eo);}
for(var i in nodes){var node=nodes[i];if(node===r.sc||node===r.ec||$.contains(node,r.sc)||$.contains(node,r.ec)){continue;}else if(dom.isCell(node)){$(node).html("<br/>");}else if(node.parentNode){do{var parent=node.parentNode;parent.removeChild(node);node=parent;}while(!dom.isVisibleText(node)&&!dom.firstElementChild(node)&&!dom.isCell(node)&&node.parentNode&&!$(node.parentNode).hasClass('o_editable'));}}
return false;}
$.summernote.pluginEvents.delete=function(event,editor,layoutInfo){var $editable=layoutInfo.editable();$editable.data('NoteHistory').recordUndo($editable,"delete");var r=range.create();if(!r)return;if(!r.isContentEditable()){event.preventDefault();return false;}
if(!r.isCollapsed()){if(dom.isCell(dom.node(r.sc))||dom.isCell(dom.node(r.ec))){remove_table_content(r);range.create(r.ec,0).select();}else{r=r.deleteContents();r.select();}
event.preventDefault();return false;}
var target=r.ec;var offset=r.eo;if(target.tagName&&target.childNodes[offset]){target=target.childNodes[offset];offset=0;}
var node=dom.node(target);var data=dom.merge(node,target,offset,target,offset,null,true);data=dom.removeSpace(node.parentNode,data.sc,data.so,data.ec,data.eo);r=range.create(data.sc,data.so);r.select();target=r.sc;offset=r.so;while(!dom.hasContentAfter(node)&&!dom.hasContentBefore(node)&&!dom.isImg(node)){node=node.parentNode;}
var contentAfter=target.textContent.slice(offset,Infinity).match(/\S|\u00A0/);var content=target.textContent.replace(/[ \t\r\n]+$/,'');var temp;var temp2;if(dom.isImg(node)||(!contentAfter&&dom.isImg(dom.hasContentAfter(node)))){var parent;var index;var r;if(!dom.isImg(node)){node=dom.hasContentAfter(node);}
while(dom.isImg(node)){parent=node.parentNode;index=dom.position(node);if(index>0){var next=node.previousSibling;r=range.create(next,next.textContent.length);}else{r=range.create(parent,0);}
if(!dom.hasContentAfter(node)&&!dom.hasContentBefore(node)){parent.appendChild($('<br/>')[0]);}
parent.removeChild(node);node=parent;r.select();}}
else if(!content.length&&target.tagName&&dom.isRemovableEmptyNode(dom.isBR(target)?target.parentNode:target)){if(node===$editable[0]||$.contains(node,$editable[0])){event.preventDefault();return false;}
var before=false;var next=dom.hasContentAfter(dom.ancestorHaveNextSibling(node));if(!dom.isContentEditable(next)){before=true;next=dom.hasContentBefore(dom.ancestorHavePreviousSibling(node));}
dom.removeSpace(next.parentNode,next,0,next,0);next=dom.firstChild(next);node.parentNode.removeChild(node);range.create(next,before?next.textContent.length:0).select();}
else if(contentAfter){return true;}
else if(dom.isText(target)&&(temp=dom.hasContentAfter(target))&&dom.isText(temp)){return true;}
else if((temp=dom.ancestorHaveNextSibling(target))&&!r.isOnCell()&&dom.isMergable(temp)&&dom.isMergable(temp2=dom.hasContentAfter(temp))&&temp.tagName===temp2.tagName&&(temp.tagName!=="LI"||!$('ul,ol',temp).length)&&(temp2.tagName!=="LI"||!$('ul,ol',temp2).length)&&!dom.isNotBreakable(temp)&&!dom.isNotBreakable(temp2)){dom.autoMerge(target,false);var next=dom.firstChild(dom.hasContentAfter(dom.ancestorHaveNextSibling(target)));if(dom.isBR(next)){if(dom.position(next)==0){range.create(next.parentNode,0).select();}
else{range.create(next.previousSibling,next.previousSibling.textContent.length).select();}
next.parentNode.removeChild(next);}else{range.create(next,0).select();}}
else if((temp=dom.ancestorHaveNextSibling(target))&&(temp2=dom.hasContentAfter(temp))&&dom.isContentEditable(temp2)){dom.removeSpace(temp2.parentNode,temp2,0,temp,0);temp2=dom.firstChild(temp2);r=range.create(temp2,0);r.select();if((dom.isText(temp)||dom.getComputedStyle(temp).display==="inline")&&(dom.isText(temp2)||dom.getComputedStyle(temp2).display==="inline")){if(dom.isText(temp2)){temp2.textContent=temp2.textContent.replace(/^\s*\S/,'');}else{$.summernote.pluginEvents.delete(event,editor,layoutInfo);}}}
$(dom.node(r.sc)).trigger("click");event.preventDefault();return false;};$.summernote.pluginEvents.backspace=function(event,editor,layoutInfo){var $editable=layoutInfo.editable();$editable.data('NoteHistory').recordUndo($editable,"backspace");var r=range.create();if(!r)return;if(!r.isContentEditable()){event.preventDefault();return false;}
if(!r.isCollapsed()){if(dom.isCell(dom.node(r.sc))||dom.isCell(dom.node(r.ec))){remove_table_content(r);range.create(r.sc,dom.nodeLength(r.sc)).select();}else{r=r.deleteContents();r.select();}
event.preventDefault();return false;}
var target=r.sc;var offset=r.so;if(target.tagName&&target.childNodes[offset]){target=target.childNodes[offset];offset=0;}
var node=dom.node(target);var data=dom.merge(node,target,offset,target,offset,null,true);data=dom.removeSpace(node.parentNode,data.sc,data.so,data.ec,data.eo);r=dom.isVoid(data.sc)?range.createFromNode(data.sc):range.create(data.sc,data.so);r.select();target=r.sc;offset=r.so;if(target.tagName&&target.childNodes[offset]){target=target.childNodes[offset];offset=0;node=dom.node(target);}
while(node.parentNode&&!dom.hasContentAfter(node)&&!dom.hasContentBefore(node)&&!dom.isImg(node)){node=node.parentNode;}
var contentBefore=target.textContent.slice(0,offset).match(/\S|\u00A0/);var content=target.textContent.replace(/[ \t\r\n]+$/,'');var temp;var temp2;if(dom.isImg(node)||(!contentBefore&&dom.isImg(dom.hasContentBefore(node)))){if(!dom.isImg(node)){node=dom.hasContentBefore(node);}
range.createFromNode(node).select();$.summernote.pluginEvents.delete(event,editor,layoutInfo);}
else if(r.isOnCell()&&!offset&&(target===(temp=dom.ancestor(target,dom.isCell))||target===temp.firstChild||(dom.isText(temp.firstChild)&&!dom.isVisibleText(temp.firstChild)&&target===temp.firstChild.nextSibling))){if(dom.previousElementSibling(temp)){var td=dom.previousElementSibling(temp);node=td.lastChild||td;}else{var tr=temp.parentNode;var prevTr=dom.previousElementSibling(tr);if(!$(temp.parentNode).text().match(/\S|\u00A0/)){if(prevTr){node=dom.lastChild(dom.lastElementChild(prevTr));}else{node=dom.lastChild(dom.hasContentBefore(dom.ancestorHavePreviousSibling(tr))||$editable.get(0));}
$(tr).empty();if(!$(tr).closest('table').has('td, th').length){$(tr).closest('table').remove();}
$(tr).remove();range.create(node,node.textContent.length,node,node.textContent.length).select();}else{node=dom.lastElementChild(prevTr).lastChild||dom.lastElementChild(prevTr);}}
if(dom.isBR(node)){range.createFromNode(node).select();}else{range.create(node,dom.nodeLength(node)).select();}}
else if(!content.length&&target.tagName&&dom.isRemovableEmptyNode(target)){if(node===$editable[0]||$.contains(node,$editable[0])){event.preventDefault();return false;}
var before=true;var prev=dom.hasContentBefore(dom.ancestorHavePreviousSibling(node));if(!dom.isContentEditable(prev)){before=false;prev=dom.hasContentAfter(dom.ancestorHaveNextSibling(node));}
dom.removeSpace(prev.parentNode,prev,0,prev,0);prev=dom.lastChild(prev);node.parentNode.removeChild(node);range.createFromNode(prev).select();range.create(prev,before?prev.textContent.length:0).select();}
else if(contentBefore){return true;}
else if(dom.isText(target)&&(temp=dom.hasContentBefore(target))&&(dom.isText(temp)||dom.isBR(temp))){return true;}
else if((temp=dom.ancestorHavePreviousSibling(target))&&dom.isMergable(temp)&&dom.isMergable(temp2=dom.hasContentBefore(temp))&&temp.tagName===temp2.tagName&&(temp.tagName!=="LI"||!$('ul,ol',temp).length)&&(temp2.tagName!=="LI"||!$('ul,ol',temp2).length)&&!dom.isNotBreakable(temp)&&!dom.isNotBreakable(temp2)){var prev=dom.firstChild(target);dom.autoMerge(target,true);range.create(prev,0).select();}
else if((temp=dom.ancestorHavePreviousSibling(target))&&(temp2=dom.hasContentBefore(temp))&&dom.isContentEditable(temp2)){dom.removeSpace(temp2.parentNode,temp2,0,temp,0);temp2=dom.lastChild(temp2);r=range.create(temp2,temp2.textContent.length,temp2,temp2.textContent.length);r.select();if((dom.isText(temp)||dom.getComputedStyle(temp).display==="inline")&&(dom.isText(temp2)||dom.getComputedStyle(temp2).display==="inline")){if(dom.isText(temp2)){temp2.textContent=temp2.textContent.replace(/\S\s*$/,'');}else{$.summernote.pluginEvents.backspace(event,editor,layoutInfo);}}}
var r=range.create();if(r){$(dom.node(r.sc)).trigger("click");dom.scrollIntoViewIfNeeded(r.sc.parentNode.previousElementSibling||r.sc);}
event.preventDefault();return false;};function isFormatNode(node){return node.tagName&&options.styleTags.indexOf(node.tagName.toLowerCase())!==-1;}
$.summernote.pluginEvents.insertUnorderedList=function(event,editor,layoutInfo,sorted){var $editable=layoutInfo.editable();$editable.data('NoteHistory').recordUndo($editable);var parent;var r=range.create();if(!r)return;var node=r.sc;while(node&&node!==$editable[0]){parent=node.parentNode;if(node.tagName===(sorted?"UL":"OL")){var ul=document.createElement(sorted?"ol":"ul");ul.className=node.className;parent.insertBefore(ul,node);while(node.firstChild){ul.appendChild(node.firstChild);}
parent.removeChild(node);r.select();return;}else if(node.tagName===(sorted?"OL":"UL")){var lis=[];for(var i=0;i<node.children.length;i++){lis.push(node.children[i]);}
if(parent.tagName==="LI"){node=parent;parent=node.parentNode;_.each(lis,function(li){parent.insertBefore(li,node);});}else{_.each(lis,function(li){while(li.firstChild){parent.insertBefore(li.firstChild,node);}});}
parent.removeChild(node);r.select();return;}
node=parent;}
var p0=r.sc;while(p0&&p0.parentNode&&p0.parentNode!==$editable[0]&&!isFormatNode(p0)){p0=p0.parentNode;}
if(!p0)return;var p1=r.ec;while(p1&&p1.parentNode&&p1.parentNode!==$editable[0]&&!isFormatNode(p1)){p1=p1.parentNode;}
if(!p0.parentNode||p0.parentNode!==p1.parentNode){return;}
var parent=p0.parentNode;var ul=document.createElement(sorted?"ol":"ul");parent.insertBefore(ul,p0);var childNodes=parent.childNodes;var brs=[];var begin=false;for(var i=0;i<childNodes.length;i++){if(begin&&dom.isBR(childNodes[i])){parent.removeChild(childNodes[i]);i--;}
if((!dom.isText(childNodes[i])&&!isFormatNode(childNodes[i]))||(!ul.firstChild&&childNodes[i]!==p0)||$.contains(ul,childNodes[i])||(dom.isText(childNodes[i])&&!childNodes[i].textContent.match(/\S|u00A0/))){continue;}
begin=true;var li=document.createElement('li');ul.appendChild(li);li.appendChild(childNodes[i]);if(li.firstChild===p1){break;}
i--;}
if(dom.isBR(childNodes[i])){parent.removeChild(childNodes[i]);}
for(var i=0;i<brs.length;i++){parent.removeChild(brs[i]);}
r.clean().select();event.preventDefault();return false;};$.summernote.pluginEvents.insertOrderedList=function(event,editor,layoutInfo){return $.summernote.pluginEvents.insertUnorderedList(event,editor,layoutInfo,true);};$.summernote.pluginEvents.indent=function(event,editor,layoutInfo,outdent){var $editable=layoutInfo.editable();$editable.data('NoteHistory').recordUndo($editable);var r=range.create();if(!r)return;var flag=false;function indentUL(UL,start,end){var next;var tagName=UL.tagName;var node=UL.firstChild;var parent=UL.parentNode;var ul=document.createElement(tagName);var li=document.createElement("li");li.style.listStyle="none";li.appendChild(ul);if(flag){flag=1;}
while(node){if(flag===1||node===start||$.contains(node,start)){flag=true;node.parentNode.insertBefore(li,node);}
next=dom.nextElementSibling(node);if(flag){ul.appendChild(node);}
if(node===end||$.contains(node,end)){flag=false;break;}
node=next;}
var temp;var prev=dom.previousElementSibling(li);if(prev&&prev.tagName==="LI"&&(temp=dom.firstElementChild(prev))&&temp.tagName===tagName&&((dom.firstElementChild(prev)||prev.firstChild)!==ul)){dom.doMerge(dom.firstElementChild(prev)||prev.firstChild,ul);li=prev;li.parentNode.removeChild(dom.nextElementSibling(li));}
var next=dom.nextElementSibling(li);if(next&&next.tagName==="LI"&&(temp=dom.firstElementChild(next))&&temp.tagName===tagName&&(dom.firstElementChild(li)!==dom.firstElementChild(next))){dom.doMerge(dom.firstElementChild(li),dom.firstElementChild(next));li.parentNode.removeChild(dom.nextElementSibling(li));}}
function outdenttUL(UL,start,end){var next;var tagName=UL.tagName;var node=UL.firstChild;var parent=UL.parentNode;var li=UL.parentNode.tagName==="LI"?UL.parentNode:UL;var ul=UL.parentNode.tagName==="LI"?UL.parentNode.parentNode:UL.parentNode;start=dom.ancestor(start,dom.isLi);end=dom.ancestor(end,dom.isLi);if(ul.tagName!=="UL"&&ul.tagName!=="OL")return;while(node){if(node===start||$.contains(node,start)){flag=true;if(dom.previousElementSibling(node)&&li.tagName==="LI"){li=dom.splitTree(li,dom.prevPoint({'node':node,'offset':0}));}}
next=dom.nextElementSibling(node);if(flag){ul=node.parentNode;li.parentNode.insertBefore(node,li);if(!ul.children.length){if(ul.parentNode.tagName==="LI"){ul=ul.parentNode;}
ul.parentNode.removeChild(ul);}}
if(node===end||$.contains(node,end)){flag=false;break;}
node=next;}
dom.merge(parent,start,0,end,1,null,true);}
function indentOther(p,start,end){if(p===start||$.contains(p,start)||$.contains(start,p)){flag=true;}
if(flag){if(outdent){dom.outdent(p);}else{dom.indent(p);}}
if(p===end||$.contains(p,end)||$.contains(end,p)){flag=false;}}
var ancestor=r.commonAncestor();var $dom=$(ancestor);if(!dom.isList(ancestor)){$dom=$(dom.node(ancestor)).children();}
if(!$dom.length){$dom=$(dom.ancestor(r.sc,dom.isList)||dom.ancestor(r.sc,dom.isCell));if(!$dom.length){$dom=$(r.sc).closest(options.styleTags.join(','));}}
$dom=$dom.map(function(){return this.tagName==="TR"?dom.firstElementChild(this):this;});$dom.each(function(){if(flag||$.contains(this,r.sc)){if(dom.isList(this)){if(outdent){outdenttUL(this,r.sc,r.ec);}else{indentUL(this,r.sc,r.ec);}}else if(isFormatNode(this)||dom.ancestor(this,dom.isCell)){indentOther(this,r.sc,r.ec);}}});if($dom.length){var $parent=$dom.parent();var $ul=$parent.find('ul, ol');if(!$ul.length){$ul=$(dom.ancestor(r.sc,dom.isList));}
$ul.each(function(){if(this.previousSibling&&this.previousSibling!==dom.previousElementSibling(this)&&!this.previousSibling.textContent.match(/\S/)){this.parentNode.removeChild(this.previousSibling);}
if(this.nextSibling&&this.nextSibling!==dom.nextElementSibling(this)&&!this.nextSibling.textContent.match(/\S/)){this.parentNode.removeChild(this.nextSibling);}});r=dom.merge($parent[0],r.sc,r.so,r.ec,r.eo,function(prev,cur){if(prev&&dom.isList(prev)&&dom.isEqual(prev,cur)){return true;}},true);range.create(r.sc,r.so,r.ec,r.eo).select();}
event.preventDefault();return false;};$.summernote.pluginEvents.outdent=function(event,editor,layoutInfo){return $.summernote.pluginEvents.indent(event,editor,layoutInfo,true);};$.summernote.pluginEvents.formatBlock=function(event,editor,layoutInfo,sTagName){var $editable=layoutInfo.editable();$editable.data('NoteHistory').recordUndo($editable);event.preventDefault();var r=range.create();if(!r){return;}
r.reRange().select();if(sTagName==="blockquote"||sTagName==="pre"){sTagName=$.summernote.core.agent.isMSIE?'<'+sTagName+'>':sTagName;document.execCommand('FormatBlock',false,sTagName);return;}
var nodes=dom.listBetween(r.sc,r.ec);for(var i=0;i<nodes.length;i++){if(dom.isBR(nodes[i])||(dom.isText(nodes[i])&&dom.isVisibleText(nodes[i]))||dom.isB(nodes[i])||dom.isU(nodes[i])||dom.isS(nodes[i])||dom.isI(nodes[i])||dom.isFont(nodes[i])){var ancestor=dom.ancestor(nodes[i],isFormatNode);if(!ancestor){dom.wrap(nodes[i],sTagName);}else if(ancestor.tagName.toLowerCase()!==sTagName){var tag=document.createElement(sTagName);ancestor.parentNode.insertBefore(tag,ancestor);dom.moveContent(ancestor,tag);if(ancestor.className){tag.className=ancestor.className;}
ancestor.parentNode.removeChild(ancestor);}}}
r.select();};$.summernote.pluginEvents.removeFormat=function(event,editor,layoutInfo,value){var $editable=layoutInfo.editable();$editable.data('NoteHistory').recordUndo($editable);var r=range.create();if(!r)return;var node=range.create().sc.parentNode;document.execCommand('removeFormat');document.execCommand('removeFormat');var r=range.create();if(!r)return;r=dom.merge(node,r.sc,r.so,r.ec,r.eo,null,true);range.create(r.sc,r.so,r.ec,r.eo).select();event.preventDefault();return false;};var fn_boutton_updateRecentColor=eventHandler.modules.toolbar.button.updateRecentColor;eventHandler.modules.toolbar.button.updateRecentColor=function(elBtn,sEvent,sValue){fn_boutton_updateRecentColor.call(this,elBtn,sEvent,sValue);var font=$(elBtn).closest('.note-color').find('.note-recent-color i')[0];if(sEvent==="foreColor"){if(sValue.indexOf('text-')!==-1){font.className+=' '+sValue;font.style.color='';}else{font.className=font.className.replace(/(^|\s+)text-\S+/);font.style.color=sValue!=='inherit'?sValue:"";}}else{if(sValue.indexOf('bg-')!==-1){font.className+=' '+sValue;font.style.backgroundColor="";}else{font.className=font.className.replace(/(^|\s+)bg-\S+/);font.style.backgroundColor=sValue!=='inherit'?sValue:"";}}
return false;};$(document).on('click keyup',function(){var $popover=$((range.create()||{}).sc).closest('[contenteditable]');var popover_history=($popover.data()||{}).NoteHistory;if(!popover_history||popover_history==history)return;var editor=$popover.parent('.note-editor');$('button[data-event="undo"]',editor).attr('disabled',!popover_history.hasUndo());$('button[data-event="redo"]',editor).attr('disabled',!popover_history.hasRedo());});eventHandler.modules.editor.undo=function($popover){if(!$popover.attr('disabled'))$popover.data('NoteHistory').undo();};eventHandler.modules.editor.redo=function($popover){if(!$popover.attr('disabled'))$popover.data('NoteHistory').redo();};var fn_editor_currentstyle=eventHandler.modules.editor.currentStyle;eventHandler.modules.editor.currentStyle=function(target){var styleInfo=fn_editor_currentstyle.apply(this,arguments);if(!styleInfo.image||!dom.isEditable(styleInfo.image)){styleInfo.image=undefined;var r=range.create();if(r)
styleInfo.image=r.isOnImg();}
return styleInfo;}
options.fontSizes=[_t('Default'),8,9,10,11,12,14,18,24,36,48,62];$.summernote.pluginEvents.applyFont=function(event,editor,layoutInfo,color,bgcolor,size){var r=range.create();if(!r)return;var startPoint=r.getStartPoint();var endPoint=r.getEndPoint();if(r.isCollapsed()&&!dom.isFont(r.sc)){return{sc:startPoint.node,so:startPoint.offset,ec:endPoint.node,offset:endPoint.offset};}
if(startPoint.node.tagName&&startPoint.node.childNodes[startPoint.offset]){startPoint.node=startPoint.node.childNodes[startPoint.offset];startPoint.offset=0;}
if(endPoint.node.tagName&&endPoint.node.childNodes[endPoint.offset]){endPoint.node=endPoint.node.childNodes[endPoint.offset];endPoint.offset=0;}
if(endPoint.offset&&endPoint.offset!=dom.nodeLength(endPoint.node)){var ancestor=dom.ancestor(endPoint.node,dom.isFont)||endPoint.node;dom.splitTree(ancestor,endPoint);}
if(startPoint.offset&&startPoint.offset!=dom.nodeLength(startPoint.node)){var ancestor=dom.ancestor(startPoint.node,dom.isFont)||startPoint.node;var node=dom.splitTree(ancestor,startPoint);if(endPoint.node===startPoint.node){endPoint.node=node;endPoint.offset=dom.nodeLength(node);}
startPoint.node=node;startPoint.offset=0;}
var nodes=[];dom.walkPoint(startPoint,endPoint,function(point){var node=point.node;if(((dom.isText(node)&&dom.isVisibleText(node))||(dom.isFont(node)&&!dom.isVisibleText(node)))&&(node!=endPoint.node||endPoint.offset)){nodes.push(point.node);}});nodes=list.unique(nodes);if(r.isCollapsed()){nodes.push(startPoint.node);}
var node,font,$font,fonts=[],className;if(color||bgcolor||size){for(var i=0;i<nodes.length;i++){node=nodes[i];font=dom.ancestor(node,dom.isFont);if(!font){if(node.textContent.match(/^[ ]|[ ]$/)){node.textContent=node.textContent.replace(/^[ ]|[ ]$/g,'\u00A0');}
font=dom.create("font");node.parentNode.insertBefore(font,node);font.appendChild(node);}
fonts.push(font);className=font.className.split(/\s+/);if(color){for(var k=0;k<className.length;k++){if(className[k].length&&className[k].slice(0,5)==="text-"){className.splice(k,1);k--;}}
if(color.indexOf('text-')!==-1){font.className=className.join(" ")+" "+color;font.style.color="inherit";}else{font.className=className.join(" ");font.style.color=color;}}
if(bgcolor){for(var k=0;k<className.length;k++){if(className[k].length&&className[k].slice(0,3)==="bg-"){className.splice(k,1);k--;}}
if(bgcolor.indexOf('bg-')!==-1){font.className=className.join(" ")+" "+bgcolor;font.style.backgroundColor="inherit";}else{font.className=className.join(" ");font.style.backgroundColor=bgcolor;}}
if(size){font.style.fontSize="inherit";if(!isNaN(size)&&Math.abs(parseInt(dom.getComputedStyle(font).fontSize,10)-size)/size>0.05){font.style.fontSize=size+"px";}}}}
for(var i=0;i<fonts.length;i++){font=fonts[i];if(font.style.backgroundColor==="inherit"){font.style.backgroundColor="";}
if(font.style.color==="inherit"){font.style.color="";}
if(font.style.fontSize==="inherit"){font.style.fontSize="";}
$font=$(font);if(!$font.css("color")&&!$font.css("background-color")&&!$font.css("font-size")){$font.removeAttr("style");}
if(!font.className.length){$font.removeAttr("class");}}
var nodes=[];dom.walkPoint(startPoint,endPoint,function(point){nodes.push(point.node);});nodes=list.unique(nodes);function remove(node,to){if(node===endPoint.node){endPoint=dom.prevPoint(endPoint);}
if(to){dom.moveContent(node,to);}
dom.remove(node);}
var className2,style,style2,$prev;for(var i=0;i<nodes.length;i++){node=nodes[i];if((dom.isText(node)||dom.isBR(node))&&!dom.isVisibleText(node)){remove(node);nodes.splice(i,1);i--;continue;}
font=dom.ancestor(node,dom.isFont);node=font||dom.ancestor(node,dom.isSpan);if(!node){continue;}
$font=$(node);className=dom.orderClass(node);style=dom.orderStyle(node);if(!className&&!style){remove(node,node.parentNode);nodes.splice(i,1);i--;continue;}
if(i>0&&(font=dom.ancestor(nodes[i-1],dom.isFont))){className2=font.getAttribute('class');style2=font.getAttribute('style');if(node!==font&&className==className2&&style==style2){remove(node,font);nodes.splice(i,1);i--;continue;}}}
range.create(startPoint.node,startPoint.offset,endPoint.node,endPoint.offset).select();};$.summernote.pluginEvents.fontSize=function(event,editor,layoutInfo,value){var $editable=layoutInfo.editable();event.preventDefault();$.summernote.pluginEvents.applyFont(event,editor,layoutInfo,null,null,value);editor.afterCommand($editable);};$.summernote.pluginEvents.color=function(event,editor,layoutInfo,sObjColor){var $editable=layoutInfo.editable();var oColor=JSON.parse(sObjColor);var foreColor=oColor.foreColor,backColor=oColor.backColor;if(foreColor){$.summernote.pluginEvents.foreColor(event,editor,layoutInfo,foreColor);}
if(backColor){$.summernote.pluginEvents.backColor(event,editor,layoutInfo,backColor);}};$.summernote.pluginEvents.foreColor=function(event,editor,layoutInfo,foreColor){var $editable=layoutInfo.editable();$.summernote.pluginEvents.applyFont(event,editor,layoutInfo,foreColor,null,null);editor.afterCommand($editable);};$.summernote.pluginEvents.backColor=function(event,editor,layoutInfo,backColor){var $editable=layoutInfo.editable();var r=range.create();if(!r)return;if(r.isCollapsed()&&r.isOnCell()){var cell=dom.ancestor(r.sc,dom.isCell);cell.className=cell.className.replace(new RegExp('(^|\\s+)bg-[^\\s]+(\\s+|$)','gi'),'');cell.style.backgroundColor="";if(backColor.indexOf('bg-')!==-1){cell.className+=' '+backColor;}else if(backColor!=='inherit'){cell.style.backgroundColor=backColor;}
return;}
$.summernote.pluginEvents.applyFont(event,editor,layoutInfo,null,backColor,null);editor.afterCommand($editable);};options.onCreateLink=function(sLinkUrl){if(sLinkUrl.indexOf('mailto:')===0){}else if(sLinkUrl.indexOf('@')!==-1&&sLinkUrl.indexOf(':')===-1){sLinkUrl='mailto:'+sLinkUrl;}else if(sLinkUrl.indexOf('://')===-1&&sLinkUrl.indexOf('/')!==0&&sLinkUrl.indexOf('#')!==0){sLinkUrl='http://'+sLinkUrl;}
return sLinkUrl;};function summernote_table_scroll(event){var r=range.create();if(r&&r.isOnCell()){$('.o_table_handler').remove();}}
function summernote_table_update(oStyle){var r=range.create();if(!oStyle.range||!r||!r.isOnCell()||!r.isOnCellFirst()){$('.o_table_handler').remove();return;}
var table=dom.ancestor(oStyle.range.sc,dom.isTable);if(!table){return;}
var $editable=$(table).closest('.o_editable');$('.o_table_handler').remove();var $dels=$();var $adds=$();var $tds=$('tr:first',table).children();$tds.each(function(){var $td=$(this);var pos=$td.offset();var $del=$('<span class="o_table_handler fa fa-minus-square"/>').appendTo('body');$del.data('td',this);$dels=$dels.add($del);$del.css({left:((pos.left+$td.outerWidth()/2)-6)+"px",top:(pos.top-6)+"px"});var $add=$('<span class="o_table_handler fa fa-plus-square"/>').appendTo('body');$add.data('td',this);$adds=$adds.add($add);$add.css({left:(pos.left-6)+"px",top:(pos.top-6)+"px"});});var $last=$tds.last();var pos=$last.offset();var $add=$('<span class="o_table_handler fa fa-plus-square"/>').appendTo('body');$adds=$adds.add($add);$add.css({left:(pos.left+$last.outerWidth()-6)+"px",top:(pos.top-6)+"px"});var $table=$(table);$dels.data('table',table).on('mousedown',function(event){var td=$(this).data('td');$editable.data('NoteHistory').recordUndo($editable);var newTd;if($(td).siblings().length){var eq=$(td).index();$table.find('tr').each(function(){$('> td:eq('+eq+')',this).remove();});newTd=$table.find('tr:first > td:eq('+eq+'), tr:first > td:last').first();}else{var prev=dom.lastChild(dom.hasContentBefore(dom.ancestorHavePreviousSibling($table[0])));$table.remove();$('.o_table_handler').remove();r=range.create(prev,prev.textContent.length);r.select();$(r.sc).trigger('mouseup');return;}
$('.o_table_handler').remove();range.create(newTd[0],0,newTd[0],0).select();newTd.trigger('mouseup');});$adds.data('table',table).on('mousedown',function(event){var td=$(this).data('td');$editable.data('NoteHistory').recordUndo($editable);var newTd;if(td){var eq=$(td).index();$table.find('tr').each(function(){$('td:eq('+eq+')',this).before('<td>'+dom.blank+'</td>');});newTd=$table.find('tr:first td:eq('+eq+')');}else{$table.find('tr').each(function(){$(this).append('<td>'+dom.blank+'</td>');});newTd=$table.find('tr:first td:last');}
$('.o_table_handler').remove();range.create(newTd[0],0,newTd[0],0).select();newTd.trigger('mouseup');});$dels.css({'position':'absolute','cursor':'pointer','background-color':'#fff','color':'#ff0000'});$adds.css({'position':'absolute','cursor':'pointer','background-color':'#fff','color':'#00ff00'});}
var fn_popover_update=eventHandler.modules.popover.update;eventHandler.modules.popover.update=function($popover,oStyle,isAirMode){fn_popover_update.call(this,$popover,oStyle,isAirMode);if(!!(isAirMode?$popover:$popover.parent()).find('.note-table').length){summernote_table_update(oStyle);}};var fn_attach=eventHandler.attach;eventHandler.attach=function(oLayoutInfo,options){var $editable=oLayoutInfo.editor().hasClass('note-editable')?oLayoutInfo.editor():oLayoutInfo.editor().find('.note-editable');fn_attach.call(this,oLayoutInfo,options);$editable.on("scroll",summernote_table_scroll);};var fn_detach=eventHandler.detach;eventHandler.detach=function(oLayoutInfo,options){var $editable=oLayoutInfo.editor().hasClass('note-editable')?oLayoutInfo.editor():oLayoutInfo.editor().find('.note-editable');fn_detach.call(this,oLayoutInfo,options);$editable.off("scroll",summernote_table_scroll);$('.o_table_handler').remove();};return $.summernote;});;

/* <inline asset> defined in bundle 'web.assets_backend' */
window.define=odoo.__define__;delete odoo.__define__;delete odoo.website_next_define;;

/* /web_editor/static/lib/nearest/jquery.nearest.js defined in bundle 'web.assets_backend' */
;(function($,undefined){var rPerc=/^([\d.]+)%$/;function nearest(selector,options,thisObj){selector||(selector='div');var $container=$(options.container),containerOffset=$container.offset()||{left:0,top:0},containerDims=[containerOffset.left+$container.width(),containerOffset.top+$container.height()],percProps={x:0,y:1,w:0,h:1},prop,match;for(prop in percProps)if(percProps.hasOwnProperty(prop)){match=rPerc.exec(options[prop]);if(match){options[prop]=containerDims[percProps[prop]]*match[1]/100;}}
var $all=$(selector),cache=[],furthest=!!options.furthest,checkX=!!options.checkHoriz,checkY=!!options.checkVert,compDist=furthest?0:Infinity,point1x=parseFloat(options.x)||0,point1y=parseFloat(options.y)||0,point2x=parseFloat(point1x+options.w)||point1x,point2y=parseFloat(point1y+options.h)||point1y,tolerance=options.tolerance||0,hasEach2=!!$.fn.each2,min=Math.min,max=Math.max;if(!options.includeSelf&&thisObj){$all=$all.not(thisObj);}
if(tolerance<0){tolerance=0;}
$all[hasEach2?'each2':'each'](function(i,elem){var $this=hasEach2?elem:$(this),off=$this.offset(),x=off.left,y=off.top,w=$this.outerWidth(),h=$this.outerHeight(),x2=x+w,y2=y+h,maxX1=max(x,point1x),minX2=min(x2,point2x),maxY1=max(y,point1y),minY2=min(y2,point2y),intersectX=minX2>=maxX1,intersectY=minY2>=maxY1,distX,distY,distT,isValid;if((checkX&&checkY)||(!checkX&&!checkY&&intersectX&&intersectY)||(checkX&&intersectY)||(checkY&&intersectX)){distX=intersectX?0:maxX1-minX2;distY=intersectY?0:maxY1-minY2;distT=intersectX||intersectY?max(distX,distY):Math.sqrt(distX*distX+distY*distY);isValid=furthest?distT>=compDist-tolerance:distT<=compDist+tolerance;if(isValid){compDist=furthest?max(compDist,distT):min(compDist,distT);cache.push({node:this,dist:distT});}}});var len=cache.length,filtered=[],compMin,compMax,i,item;if(len){if(furthest){compMin=compDist-tolerance;compMax=compDist;}else{compMin=compDist;compMax=compDist+tolerance;}
for(i=0;i<len;i++){item=cache[i];if(item.dist>=compMin&&item.dist<=compMax){filtered.push(item.node);}}}
return filtered;}
$.each(['nearest','furthest','touching'],function(i,name){var defaults={x:0,y:0,w:0,h:0,tolerance:1,container:document,furthest:name=='furthest',includeSelf:false,checkHoriz:name!='touching',checkVert:name!='touching'};$[name]=function(point,selector,options){if(!point||point.x===undefined||point.y===undefined){return $([]);}
var opts=$.extend({},defaults,point,options||{});return $(nearest(selector,opts));};$.fn[name]=function(selector,options){var opts;if(selector&&$.isPlainObject(selector)){opts=$.extend({},defaults,selector,options||{});return this.pushStack(nearest(this,opts));}
var offset=this.offset(),dimensions={x:offset.left,y:offset.top,w:this.outerWidth(),h:this.outerHeight()};opts=$.extend({},defaults,dimensions,options||{});return this.pushStack(nearest(selector,opts,this));};});})(jQuery);;

/* /web_editor/static/src/js/editor.js defined in bundle 'web.assets_backend' */
odoo.define('web_editor.editor',function(require){"use strict";var ajax=require('web.ajax');var Widget=require('web.Widget');var core=require('web.core');var base=require('web_editor.base');var rte=require('web_editor.rte');var qweb=core.qweb;var _t=core._t;var editor={};editor.dummy=function(){return true;};editor.editable=!!$('html').data('editable');ajax.loadXML('/web_editor/static/src/xml/editor.xml',qweb);$(document).on('click','.note-editable',function(ev){ev.preventDefault();});$(document).on('submit','.note-editable form .btn',function(ev){ev.preventDefault();});$(document).on('hide.bs.dropdown','.dropdown',function(ev){if(ev.originalEvent&&$(ev.target).has(ev.originalEvent.target).length&&$(ev.originalEvent.target).is('[contenteditable]')){ev.preventDefault();}});editor.reload=function(){location.hash="scrollTop="+window.document.body.scrollTop;if(location.search.indexOf("enable_editor")>-1){window.location.href=window.location.href.replace(/&?enable_editor(=[^&]*)?/g,'');}else{window.location.reload(true);}};base.ready().then(function(){if(editor.editable&&location.search.indexOf("enable_editor")>=0){editor.editor_bar=new editor.Class();editor.editor_bar.prependTo(document.body);}});editor.Class=Widget.extend({template:'web_editor.editorbar',events:{'click button[data-action=save]':'save','click a[data-action=cancel]':'cancel',},init:function(parent){var self=this;var res=this._super.apply(this,arguments);this.parent=parent;this.rte=new rte.Class(this);this.rte.on('rte:start',this,function(){self.trigger('rte:start');});return res;},start:function(){var self=this;$('.dropdown-toggle').dropdown();this.display_placeholder();this.rte.on('change',this,this.proxy('rte_changed'));this.rte.start();var flag=false;window.onbeforeunload=function(event){if(rte.history.getEditableHasUndo().length&&!flag){flag=true;setTimeout(function(){flag=false;},0);return _t('This document is not saved!');}};this.$('button[data-action="save"]').prop('disabled',true);return this._super();},display_placeholder:function(){var $area=$("#wrapwrap").find("[data-oe-model] .oe_structure.oe_empty, [data-oe-model].oe_structure.oe_empty, [data-oe-type=html]").filter(".oe_not_editable").filter(".oe_no_empty");this.on('rte:start',this,function(){$area.attr("data-oe-placeholder",_t("Write Your Text Here"));});this.on("snippets:ready",this,function(){if($("body").hasClass("editor_has_snippets")){$area.attr("data-oe-placeholder",_t("Write Your Text or Drag a Block Here"));}});$(document).on("keyup",function(event){if((event.keyCode===8||event.keyCode===46)){var $target=$(event.target).closest(".o_editable");if(!$target.is(":has(*:not(p):not(br))")&&!$target.text().match(/\S/)){$target.empty();}}});},rte_changed:function(){this.$('button[data-action=save]').prop('disabled',!rte.history.getEditableHasUndo().length);},save:function(){return this.rte.save().then(function(){editor.reload();});},save_without_reload:function(){return this.rte.save();},cancel:function(){new $.Deferred(function(d){if(!rte.history.getEditableHasUndo().length){return d.resolve();}
var $dialog=$(qweb.render('web_editor.discard')).appendTo(document.body);$dialog.on('click','.btn-danger',function(){d.resolve();}).on('hidden.bs.modal',function(){d.reject();}).on('keydown.dismiss.bs.modal',function(event){event.stopImmediatePropagation();});d.always(function(){$dialog.remove();});$dialog.modal('show');}).then(function(){window.onbeforeunload=null;editor.reload();});},});return editor;});;

/* /web_editor/static/src/js/rte.js defined in bundle 'web.assets_backend' */
odoo.define('web_editor.rte',function(require){'use strict';var ajax=require('web.ajax');var core=require('web.core');var utils=require('web.utils');var Widget=require('web.Widget');var summernote=require('web_editor.summernote');var base=require('web_editor.base');var _t=core._t;var dom=summernote.core.dom;var range=summernote.core.range;var History=function History($editable){var aUndo=[];var pos=0;this.makeSnap=function(event,rng){rng=rng||range.create();var elEditable=$(rng&&rng.sc).closest('.o_editable')[0];if(!elEditable){return false;}
return{event:event,editable:elEditable,contents:elEditable.innerHTML,bookmark:rng&&rng.bookmark(elEditable),scrollTop:$(elEditable).scrollTop()};};this.applySnap=function(oSnap){var $editable=$(oSnap.editable);if(!!document.documentMode){$editable.removeAttr("contentEditable").removeProp("contentEditable");}
$editable.html(oSnap.contents).scrollTop(oSnap.scrollTop);$(".oe_overlay").remove();$(".note-control-selection").hide();$editable.trigger("content_changed");try{var r=oSnap.editable.innerHTML===""?range.create(oSnap.editable,0):range.createFromBookmark(oSnap.editable,oSnap.bookmark);r.select();}catch(e){console.error(e);return;}
$(document).trigger("click");$(".o_editable *").filter(function(){var $el=$(this);if($el.data('snippet-editor')){$el.removeData();}});setTimeout(function(){var target=dom.isBR(r.sc)?r.sc.parentNode:dom.node(r.sc);if(!target){return;}
$editable.trigger("applySnap");var evt=document.createEvent("MouseEvents");evt.initMouseEvent("click",true,true,window,0,0,0,0,0,false,false,false,false,0,target);target.dispatchEvent(evt);$editable.trigger("keyup");},0);};this.undo=function(){if(!pos){return;}
var _toSnap=toSnap;if(_toSnap){this.saveSnap();}
if(!aUndo[pos]&&(!aUndo[pos]||aUndo[pos].event!=='undo')){var temp=this.makeSnap('undo');if(temp&&(!pos||temp.contents!==aUndo[pos-1].contents)){aUndo[pos]=temp;}else{pos--;}}else if(_toSnap){pos--;}
this.applySnap(aUndo[Math.max(--pos,0)]);while(pos&&(aUndo[pos].event==="blur"||(aUndo[pos+1].editable===aUndo[pos].editable&&aUndo[pos+1].contents===aUndo[pos].contents))){this.applySnap(aUndo[--pos]);}};this.hasUndo=function(){return(toSnap&&(toSnap.event!=="blur"&&toSnap.event!=="activate"&&toSnap.event!=="undo"))||!!_.find(aUndo.slice(0,pos+1),function(undo){return undo.event!=="blur"&&undo.event!=="activate"&&undo.event!=="undo";});};this.getEditableHasUndo=function(){var editable=[];if((toSnap&&(toSnap.event!=="blur"&&toSnap.event!=="activate"&&toSnap.event!=="undo"))){editable.push(toSnap.editable);}
_.each(aUndo.slice(0,pos+1),function(undo){if(undo.event!=="blur"&&undo.event!=="activate"&&undo.event!=="undo"){editable.push(undo.editable);}});return _.uniq(editable);};this.redo=function(){if(!aUndo[pos+1]){return;}
this.applySnap(aUndo[++pos]);while(aUndo[pos+1]&&aUndo[pos].event==="active"){this.applySnap(aUndo[pos++]);}};this.hasRedo=function(){return aUndo.length>pos+1;};var toSnap,split;this.recordUndo=function($editable,event,internal_history){var self=this;if(!$editable){var rng=range.create();if(!rng)return;$editable=$(rng.sc).closest(".o_editable");}
if(aUndo[pos]&&(event==="applySnap"||event==="activate")){return;}
if(!internal_history){if(!event||!toSnap||!aUndo[pos-1]||toSnap.event==="activate"){setTimeout(function(){$editable.trigger("content_changed");},0);}}
if(aUndo[pos]){pos=Math.min(pos,aUndo.length);aUndo.splice(Math.max(pos,1),aUndo.length);}
if(toSnap&&(toSnap.split||!event||toSnap.event!==event||toSnap.editable!==$editable[0])){this.saveSnap();}
if(pos&&aUndo[pos-1].editable!==$editable[0]){var snap=this.makeSnap('blur',range.create(aUndo[pos-1].editable,0));pos++;aUndo.push(snap);}
if(range.create()){toSnap=self.makeSnap(event);}else{toSnap=false;}};this.splitNext=function(){if(toSnap){toSnap.split=true;}};this.saveSnap=function(){if(toSnap){if(!aUndo[pos]){pos++;}
aUndo.push(toSnap);delete toSnap.split;toSnap=null;}};};var history=new History();$.extend($.expr[':'],{o_editable:function(node,i,m){while(node){if(node.className){if(node.className.indexOf('o_not_editable')!==-1){return false;}
if(node.className.indexOf('o_editable')!==-1){return true;}}
node=node.parentNode;}
return false;}});$.fn.extend({focusIn:function(){if(this.length){range.create(dom.firstChild(this[0]),0).select();}
return this;},focusInEnd:function(){if(this.length){var last=dom.lastChild(this[0]);range.create(last,dom.nodeLength(last)).select();}
return this;},selectContent:function(){if(this.length){var next=dom.lastChild(this[0]);range.create(dom.firstChild(this[0]),0,next,next.textContent.length).select();}
return this;}});var RTE=Widget.extend({init:function(EditorBar,config){var self=this;this.EditorBar=EditorBar;data.rte=this;this._super.apply(this,arguments);this.init_bootstrap_carousel=$.fn.carousel;this.edit_bootstrap_carousel=function(){var res=self.init_bootstrap_carousel.apply(this,arguments);$(this).off('keydown.bs.carousel');return res;};if(config){this.config=config;}},historyRecordUndo:function($target,event,internal_history){var rng=range.create();var $editable=$(rng&&rng.sc).closest(".o_editable");if(!rng||!$editable.length){$editable=$($target).closest(".o_editable");rng=range.create($target.closest("*")[0],0);}else{rng=$editable.data('range')||rng;}
rng.select();history.recordUndo($editable,event,internal_history);},start:function(){var self=this;this.saving_mutex=new utils.Mutex();$.fn.carousel=this.edit_bootstrap_carousel;this._onKeydown=_.bind(this.onKeydown,this);$(document).on('keydown',this,this._onKeydown);this._onMousedown=_.bind(this.onMousedown,this);$(document).on('mousedown activate',this,this._onMousedown);this._onMouseup=_.bind(this.onMouseup,this);$(document).on('mouseup',this,this._onMouseup);$('.o_not_editable').attr("contentEditable",false);var $editable=this.editable();$editable.addClass('o_editable').data('rte',self);$editable.each(function(){var $node=$(this);if(window.getComputedStyle(this).display==="inline"&&$node.data('oe-type')!=="image"){$node.addClass('o_is_inline_editable');}
$node.data('initInnerHTML',$node.html());});$(document).on('content_changed','.o_editable',function(event){self.trigger('change',this);if(!$(this).hasClass('o_dirty')){$(this).addClass('o_dirty');}});this._onClick=_.bind(this.onClick,this);$('#wrapwrap, .o_editable').on('click','*',this,this._onClick);$('body').addClass("editor_enable");$(document).tooltip({selector:'[data-oe-readonly]',container:'body',trigger:'hover',delay:{"show":1000,"hide":100},placement:'bottom',title:_t("Readonly field")}).on('click',function(){$(this).tooltip('hide');});$(document).trigger('mousedown');self.trigger('rte:start');},save:function(context){var self=this;this.__saved={};var editables=history.getEditableHasUndo();var defs=$('.o_dirty').removeAttr('contentEditable').removeClass('o_dirty oe_carlos_danger o_is_inline_editable').map(function(){var $el=$(this);$el.find('[class]').filter(function(){if(!this.className.match(/\S/)){this.removeAttribute("class");}});return self.saving_mutex.exec(function(){return self.saveElement($el,context).then(undefined,function(thing,response){var id=_.uniqueId('carlos_danger_');$el.addClass('o_dirty oe_carlos_danger '+id);return $.Deferred().reject({id:id,error:response.data,});});});}).get();return $.when.apply(null,defs).then(function(){window.onbeforeunload=null;},function(failed){self.stop();self.start();if(!_.isArray(failed)){failed=[failed];}
_(failed).each(function(failure){var html=failure.error.exception_type==="except_osv";if(html){var msg=$("<div/>").text(failure.error.message).html();var data=msg.substring(3,msg.length-2).split(/', u'/);failure.error.message='<b>'+data[0]+'</b>'+data[1];}
$('.o_editable.'+failure.id).removeClass(failure.id).popover({html:html,trigger:'hover',content:failure.error.message,placement:'auto top',}).popover('show');});});},getEscapedElement:function($el){var escaped_el=$el.clone();var to_escape=escaped_el.find('*').addBack();to_escape=to_escape.not(to_escape.filter('object,iframe,script,style,[data-oe-model][data-oe-model!="ir.ui.view"]').find('*').addBack());to_escape.contents().each(function(){if(this.nodeType==3){this.nodeValue=$('<div />').text(this.nodeValue).html();}});return escaped_el;},saveElement:function($el,context){if($el.data('oe-model')){var key=$el.data('oe-model')+":"+$el.data('oe-id')+":"+$el.data('oe-field')+":"+$el.data('oe-type')+":"+$el.data('oe-expression');if(this.__saved[key])return true;this.__saved[key]=true;}
var markup=this.getEscapedElement($el).prop('outerHTML');return ajax.jsonRpc('/web/dataset/call','call',{model:'ir.ui.view',method:'save',args:[$el.data('oe-id'),markup,$el.data('oe-xpath')||null,_.omit(context||base.get_context(),'lang')],});},stop:function(){if(this.$last){this.$last.destroy();this.$last=null;}
$.fn.carousel=this.init_bootstrap_carousel;$(document).off('keydown',this._onKeydown);$(document).off('mousedown applySnap',this._onMousedown);$(document).off('mouseup',this._onMouseup);$('.o_not_editable').removeAttr("contentEditable");$(document).off('content_changed').removeClass('o_is_inline_editable').removeData('rte');$('#wrapwrap, .o_editable').off('click',this._onClick);$(document).tooltip('destroy');$('body').removeClass("editor_enable");this.trigger('rte:stop');},cancel:function(){$('.o_editable').each(function(){var $node=$(this);$node.data('initInnerHTML',$node.html());});this.stop();},onClick:function(event){event.preventDefault();},onKeydown:function(event){if(event.keyCode===27&&!$('.modal-content:visible').length){setTimeout(function(){$('#editor-top-navbar [data-action="cancel"]').click();var $modal=$('.modal-content > .modal-body').parents(".modal:first");$modal.off('keyup.dismiss.bs.modal');setTimeout(function(){$modal.on('keyup.dismiss.bs.modal',function(){$(this).modal('hide');});},500);},0);}},onMousedown:function(event){var $target=$(event.target);var $editable=$target.closest('.o_editable');if(!$editable.size()){return;}
if($target.is('a')){$target.attr('contenteditable',true);setTimeout(function(){$editable.attr('contenteditable',false);});var reactive_editable=function(e){if($target.is(e.target)){return;}
$target.removeAttr('contenteditable');$editable.attr('contenteditable',true);$(document).off('mousedown',reactive_editable);}
$(document).on('mousedown',reactive_editable);}
if(this&&this.$last&&(!$editable.size()||this.$last[0]!=$editable[0])){var $destroy=this.$last;history.splitNext();setTimeout(function(){var id=$destroy.data('note-id');$destroy.destroy().removeData('note-id').removeAttr('data-note-id');$('#note-popover-'+id+', #note-handle-'+id+', #note-dialog-'+id+'').remove();},150);this.$last=null;}
if($editable.size()&&(!this.$last||this.$last[0]!=$editable[0])&&($target.closest('[contenteditable]').attr('contenteditable')||"").toLowerCase()!=='false'){$editable.summernote(this.config($editable));$editable.data('NoteHistory',history);this.$last=$editable;try{document.execCommand('enableObjectResizing',false,false);document.execCommand('enableInlineTableEditing',false,false);document.execCommand('2D-position',false,false);}catch(e){}
document.body.addEventListener('resizestart',function(evt){evt.preventDefault();return false;});document.body.addEventListener('movestart',function(evt){evt.preventDefault();return false;});document.body.addEventListener('dragstart',function(evt){evt.preventDefault();return false;});if(!range.create()){$editable.focusIn();}
if(dom.isImg($target[0])){$target.trigger('mousedown');}
this.onEnableEditableArea($editable);}},onEnableEditableArea:function($editable){},onMouseup:function(event){var $target=$(event.target);var $editable=$target.closest('.o_editable');if(!$editable.size()){return;}
var self=this;setTimeout(function(){self.historyRecordUndo($target,'activate',true);},0);},editable:function(){return $('#wrapwrap [data-oe-model]').not('.o_not_editable').filter(function(){return!$(this).closest('.o_not_editable').length;}).not('link, script').not('[data-oe-readonly]').not('img[data-oe-field="arch"], br[data-oe-field="arch"], input[data-oe-field="arch"]').not('.oe_snippet_editor').add('.o_editable');},config:function($editable){return{'airMode':true,'focus':false,'airPopover':[['style',['style']],['font',['bold','italic','underline','clear']],['fontsize',['fontsize']],['color',['color']],['para',['ul','ol','paragraph']],['table',['table']],['insert',['link','picture']],['history',['undo','redo']],],'styleWithSpan':false,'inlinemedia':['p'],'lang':"odoo",'onChange':function(html,$editable){$editable.trigger("content_changed");}};},});var data={'history':history,'Class':RTE};return data;});;

/* /web_editor/static/src/js/rte.summernote.js defined in bundle 'web.assets_backend' */
odoo.define('web_editor.rte.summernote',function(require){'use strict';var core=require('web.core');var ajax=require('web.ajax');var base=require('web_editor.base');var widgets=require('web_editor.widget');var rte=require('web_editor.rte');var QWeb=core.qweb;var _t=core._t;ajax.jsonRpc('/web/dataset/call','call',{'model':'ir.ui.view','method':'read_template','args':['web_editor.colorpicker',base.get_context()]}).done(function(data){QWeb.add_template(data);});var dom=$.summernote.core.dom;var range=$.summernote.core.range;var eventHandler=$.summernote.eventHandler;var renderer=$.summernote.renderer;var options=$.summernote.options;var tplButton=renderer.getTemplate().button;var tplIconButton=renderer.getTemplate().iconButton;var tplDropdown=renderer.getTemplate().dropdown;var fn_createPalette=renderer.createPalette;renderer.createPalette=function($container,options){fn_createPalette.call(this,$container,options);if(!QWeb.has_template('web_editor.colorpicker')){return;}
var $color=$container.find('.note-color');var html=QWeb.render('web_editor.colorpicker');$color.find('.note-color-palette').prepend(html);var $bg=$color.find('.colorpicker:first button');var $fore=$color.find('.colorpicker:last button');$bg.each(function(){$(this).attr('data-event','backColor').attr('data-value',$(this).attr('class'));});$fore.each(function(){$(this).attr('data-event','foreColor').attr('data-value',$(this).attr('class').replace(/bg-/,'text-'));});};var fn_tplPopovers=renderer.tplPopovers;renderer.tplPopovers=function(lang,options){var $popover=$(fn_tplPopovers.call(this,lang,options));var $imagePopover=$popover.find('.note-image-popover');var $linkPopover=$popover.find('.note-link-popover');var $airPopover=$popover.find('.note-air-popover');if(window===window.top){$popover.children().addClass("hidden-xs");}
var $centerbutton=$(tplIconButton('fa fa-align-center',{title:_t('Center'),event:'floatMe',value:'center'})).insertAfter($imagePopover.find('[data-event="floatMe"][data-value="left"]'));$imagePopover.find('button[data-event="removeMedia"]').parent().remove();$imagePopover.find('button[data-event="floatMe"][data-value="none"]').remove();var $alt=$('<div class="btn-group"/>');$alt.prependTo($imagePopover.find('.popover-content'));$alt.append('<button class="btn btn-default btn-sm btn-small" data-event="alt"><strong>Alt: </strong><span class="o_image_alt"></span></button>');var $padding=$('<div class="btn-group"/>');$padding.insertBefore($imagePopover.find('.btn-group:first'));var dropdown_content=['<li><a data-event="padding" href="#" data-value="">'+_t('None')+'</a></li>','<li><a data-event="padding" href="#" data-value="small">'+_t('Small')+'</a></li>','<li><a data-event="padding" href="#" data-value="medium">'+_t('Medium')+'</a></li>','<li><a data-event="padding" href="#" data-value="large">'+_t('Large')+'</a></li>','<li><a data-event="padding" href="#" data-value="xl">'+_t('Xl')+'</a></li>',];var $button=$(tplIconButton('fa fa-plus-square-o',{title:_t('Padding'),dropdown:tplDropdown(dropdown_content)})).appendTo($padding);$imagePopover.find('[data-event="imageShape"]:not([data-value])').remove();var $button=$(tplIconButton('fa fa-sun-o',{title:_t('Shadow'),event:'imageShape',value:'shadow'})).insertAfter($imagePopover.find('[data-event="imageShape"][data-value="img-circle"]'));var $spin=$('<div class="btn-group hidden only_fa"/>').insertAfter($button.parent());$(tplIconButton('fa fa-refresh',{title:_t('Spin'),event:'imageShape',value:'fa-spin'})).appendTo($spin);var $resizefa=$('<div class="btn-group hidden only_fa"/>').insertAfter($imagePopover.find('.btn-group:has([data-event="resize"])'));for(var size=1;size<=5;size++){$(tplButton('<span class="note-fontsize-10">'+size+'x</span>',{title:size+"x",event:'resizefa',value:size+''})).appendTo($resizefa);}
var $colorfa=$airPopover.find('.note-color').clone();$colorfa.find(".btn-group:first").remove();$colorfa.find("ul.dropdown-menu").css('min-width','172px');$colorfa.find('button[data-event="color"]').attr('data-value','{"foreColor": "#f00"}').find("i").css({'background':'','color':'#f00'});$resizefa.after($colorfa);var $imageprop=$('<div class="btn-group"/>');$imageprop.appendTo($imagePopover.find('.popover-content'));$(tplIconButton('fa fa-picture-o',{title:_t('Edit'),event:'showImageDialog'})).appendTo($imageprop);$(tplIconButton('fa fa-trash-o',{title:_t('Remove'),event:'delete'})).appendTo($imageprop);$imagePopover.find('.popover-content').append($airPopover.find(".note-history").clone());$imagePopover.find('[data-event="showImageDialog"]').before($airPopover.find('[data-event="showLinkDialog"]').clone());$linkPopover.find('.popover-content').append($airPopover.find(".note-history").clone());$linkPopover.find('button[data-event="showLinkDialog"] i').attr("class","fa fa-link");$linkPopover.find('button[data-event="unlink"]').before($airPopover.find('button[data-event="showImageDialog"]').clone());$airPopover.find('.note-style').on('mousedown',function(){var $format=$airPopover.find('[data-event="formatBlock"]');var node=range.create().sc;var formats=$format.map(function(){return $(this).data("value");}).get();while(node&&(!node.tagName||(!node.tagName||formats.indexOf(node.tagName.toLowerCase())===-1))){node=node.parentNode;}
$format.parent().removeClass('active');$format.filter('[data-value="'+(node?node.tagName.toLowerCase():"p")+'"]').parent().addClass("active");});setTimeout(function(){$airPopover.add($linkPopover).add($imagePopover).find("button").tooltip('destroy').tooltip({container:'body',trigger:'hover',placement:'bottom'}).on('click',function(){$(this).tooltip('hide');});});return $popover;};var fn_boutton_update=eventHandler.modules.popover.button.update;eventHandler.modules.popover.button.update=function($container,oStyle){var previous=$(".note-control-selection").data('target');if(previous){$(previous).css({"-webkit-animation-play-state":"","animation-play-state":"","-webkit-transition":"","transition":"","-webkit-animation":"","animation":""});}
if(oStyle.image){$(oStyle.image).css({"-webkit-animation":"none","animation":"none"});}
fn_boutton_update.call(this,$container,oStyle);$container.find('.note-color').removeClass("hidden");if(oStyle.image){$container.find('[data-event]').parent().removeClass("active");$container.find('a[data-event="padding"][data-value="small"]').parent().toggleClass("active",$(oStyle.image).hasClass("padding-small"));$container.find('a[data-event="padding"][data-value="medium"]').parent().toggleClass("active",$(oStyle.image).hasClass("padding-medium"));$container.find('a[data-event="padding"][data-value="large"]').parent().toggleClass("active",$(oStyle.image).hasClass("padding-large"));$container.find('a[data-event="padding"][data-value="xl"]').parent().toggleClass("active",$(oStyle.image).hasClass("padding-xl"));$container.find('a[data-event="padding"][data-value=""]').parent().toggleClass("active",!$container.find('.active a[data-event="padding"]').length);if(dom.isImgFont(oStyle.image)){$container.find('.btn-group:not(.only_fa):has(button[data-event="resize"],button[data-value="img-thumbnail"])').addClass("hidden");$container.find('.only_fa').removeClass("hidden");$container.find('button[data-event="resizefa"][data-value="2"]').toggleClass("active",$(oStyle.image).hasClass("fa-2x"));$container.find('button[data-event="resizefa"][data-value="3"]').toggleClass("active",$(oStyle.image).hasClass("fa-3x"));$container.find('button[data-event="resizefa"][data-value="4"]').toggleClass("active",$(oStyle.image).hasClass("fa-4x"));$container.find('button[data-event="resizefa"][data-value="5"]').toggleClass("active",$(oStyle.image).hasClass("fa-5x"));$container.find('button[data-event="resizefa"][data-value="1"]').toggleClass("active",!$container.find('.active[data-event="resizefa"]').length);$container.find('button[data-event="imageShape"][data-value="fa-spin"]').toggleClass("active",$(oStyle.image).hasClass("fa-spin"));$container.find('button[data-event="imageShape"][data-value="shadow"]').toggleClass("active",$(oStyle.image).hasClass("shadow"));}else{$container.find('.hidden:not(.only_fa)').removeClass("hidden");$container.find('.only_fa').addClass("hidden");var width=($(oStyle.image).attr('style')||'').match(/(^|;|\s)width:\s*([0-9]+%)/);if(width){width=width[2];}
$container.find('button[data-event="resize"][data-value="1"]').toggleClass("active",width==="100%");$container.find('button[data-event="resize"][data-value="0.5"]').toggleClass("active",width==="50%");$container.find('button[data-event="resize"][data-value="0.25"]').toggleClass("active",width==="25%");$container.find('button[data-event="imageShape"][data-value="shadow"]').toggleClass("active",$(oStyle.image).hasClass("shadow"));if(!$(oStyle.image).is("img")){$container.find('.btn-group:has(button[data-event="imageShape"])').addClass("hidden");}
$container.find('.note-color').addClass("hidden");}
$container.find('button[data-event="floatMe"][data-value="left"]').toggleClass("active",$(oStyle.image).hasClass("pull-left"));$container.find('button[data-event="floatMe"][data-value="center"]').toggleClass("active",$(oStyle.image).hasClass("center-block"));$container.find('button[data-event="floatMe"][data-value="right"]').toggleClass("active",$(oStyle.image).hasClass("pull-right"));$(oStyle.image).trigger('attributes_change');}};var fn_popover_update=eventHandler.modules.popover.update;eventHandler.modules.popover.update=function($popover,oStyle,isAirMode){var $imagePopover=$popover.find('.note-image-popover');var $linkPopover=$popover.find('.note-link-popover');var $airPopover=$popover.find('.note-air-popover');fn_popover_update.call(this,$popover,oStyle,isAirMode);if(oStyle.image){if(oStyle.image.parentNode.className.match(/(^|\s)media_iframe_video(\s|$)/i)){oStyle.image=oStyle.image.parentNode;}
var alt=$(oStyle.image).attr("alt");$imagePopover.find('.o_image_alt').text((alt||"").replace(/&quot;/g,'"')).parent().toggle(oStyle.image.tagName==="IMG");$imagePopover.show();range.createFromNode(dom.firstChild(oStyle.image)).select();}else{$(".note-control-selection").hide();}
if(oStyle.image||(oStyle.range&&(!oStyle.range.isCollapsed()||(oStyle.range.sc.tagName&&!dom.isAnchor(oStyle.range.sc))))||(oStyle.image&&!$(oStyle.image).closest('a').length)){$linkPopover.hide();oStyle.anchor=false;}
if(oStyle.image||oStyle.anchor||(oStyle.range&&!$(oStyle.range.sc).closest('.note-editable').length)){$airPopover.hide();}else{$airPopover.show();}};var fn_handle_update=eventHandler.modules.handle.update;eventHandler.modules.handle.update=function($handle,oStyle,isAirMode){fn_handle_update.call(this,$handle,oStyle,isAirMode);if(oStyle.image){$handle.find('.note-control-selection').hide();}};function getImgTarget(){return $(".note-control-selection").data('target');}
eventHandler.modules.editor.padding=function($editable,sValue){var $target=$(getImgTarget());var paddings="small medium large xl".split(/\s+/);$editable.data('NoteHistory').recordUndo();if(sValue.length){paddings.splice(paddings.indexOf(sValue),1);$target.toggleClass('padding-'+sValue);}
$target.removeClass("padding-"+paddings.join(" padding-"));};eventHandler.modules.editor.resize=function($editable,sValue){var $target=$(getImgTarget());$editable.data('NoteHistory').recordUndo();var width=($target.attr('style')||'').match(/(^|;|\s)width:\s*([0-9]+)%/);if(width){width=width[2]/100;}
$(getImgTarget()).css('width',width!=sValue?(sValue*100)+'%':'');};eventHandler.modules.editor.resizefa=function($editable,sValue){var $target=$(getImgTarget());$editable.data('NoteHistory').recordUndo();$target.attr('class',$target.attr('class').replace(/\s*fa-[0-9]+x/g,''));if(+sValue>1){$target.addClass('fa-'+sValue+'x');}};eventHandler.modules.editor.floatMe=function($editable,sValue){var $target=$(getImgTarget());$editable.data('NoteHistory').recordUndo();switch(sValue){case'center':$target.toggleClass('center-block').removeClass('pull-right pull-left');break;case'left':$target.toggleClass('pull-left').removeClass('pull-right center-block');break;case'right':$target.toggleClass('pull-right').removeClass('pull-left center-block');break;}};eventHandler.modules.editor.imageShape=function($editable,sValue){var $target=$(getImgTarget());$editable.data('NoteHistory').recordUndo();$target.toggleClass(sValue);};eventHandler.modules.linkDialog.showLinkDialog=function($editable,$dialog,linkInfo){$editable.data('range').select();$editable.data('NoteHistory').recordUndo();var editor=new widgets.LinkDialog($editable,linkInfo);editor.appendTo(document.body);var def=new $.Deferred();editor.on("save",this,function(linkInfo){linkInfo.range.select();$editable.data('range',linkInfo.range);def.resolve(linkInfo);$editable.trigger('keyup');$('.note-popover .note-link-popover').show();});editor.on("cancel",this,function(){def.reject();});return def;};eventHandler.modules.imageDialog.showImageDialog=function($editable){var r=$editable.data('range');if(r.sc.tagName&&r.sc.childNodes.length){r.sc=r.sc.childNodes[r.so];}
var editor=new widgets.MediaDialog($editable,dom.isImg(r.sc)?r.sc:null);editor.appendTo(document.body);return new $.Deferred().reject();};$.summernote.pluginEvents.alt=function(event,editor,layoutInfo,sorted){var $editable=layoutInfo.editable();var $selection=layoutInfo.handle().find('.note-control-selection');var media=$selection.data('target');new widgets.alt($editable,media).appendTo(document.body);};var fn_is_void=dom.isVoid;dom.isVoid=function(node){return fn_is_void(node)||dom.isImgFont(node)||(node&&node.className&&node.className.match(/(^|\s)media_iframe_video(\s|$)/i));};dom.isImg=function(node){return dom.isImgFont(node)||(node&&(node.nodeName==="IMG"||(node.className&&node.className.match(/(^|\s)(media_iframe_video|o_image)(\s|$)/i))));};dom.isForbiddenNode=function(node){return $(node).is(".media_iframe_video, .fa, img");};dom.isImgFont=function(node){var nodeName=node&&node.nodeName.toUpperCase();var className=(node&&node.className||"");if(node&&(nodeName==="SPAN"||nodeName==="I")&&className.length){var classNames=className.split(/\s+/);for(var k=0;k<widgets.fontIcons.length;k++){if(_.intersection(widgets.fontIcons[k].alias,classNames).length){return true;}}}
return false;};var isFont=dom.isFont;dom.isFont=function(node){return dom.isImgFont(node)||isFont(node);};var fn_visible=$.summernote.pluginEvents.visible;$.summernote.pluginEvents.visible=function(event,editor,layoutInfo){var res=fn_visible.call(this,event,editor,layoutInfo);var rng=range.create();if(!rng)return res;var $node=$(dom.node(rng.sc));if(($node.is('[data-oe-type="html"]')||$node.is('[data-oe-field="arch"]'))&&$node.hasClass("o_editable")&&!$node[0].children.length&&"h1 h2 h3 h4 h5 h6 p b bold i u code sup strong small pre th td".toUpperCase().indexOf($node[0].nodeName)===-1){var p=$('<p><br/></p>')[0];$node.append(p);range.createFromNode(p.firstChild).select();}
return res;};function prettify_html(html){html=html.trim();var result='',level=0,get_space=function(level){var i=level,space='';while(i--)space+='  ';return space;},reg=/^<\/?(a|span|font|strong|u|i|strong|b)(\s|>)/i,inline_level=Infinity,tokens=_.compact(_.flatten(_.map(html.split(/</),function(value){value=value.replace(/\s+/g,' ').split(/>/);value[0]=/\S/.test(value[0])?'<'+value[0]+'>':'';return value;})));for(var i=0,l=tokens.length;i<l;i++){var token=tokens[i];var inline_tag=reg.test(token);var inline=inline_tag||inline_level<=level;if(token[0]==='<'&&token[1]==='/'){if(inline_tag&&inline_level===level){inline_level=Infinity;}
level--;}
if(!inline&&!/\S/.test(token)){continue;}
if(!inline||(token[1]!=='/'&&inline_level>level)){result+=get_space(level);}
if(token[0]==='<'&&token[1]!=='/'){level++;if(inline_tag&&inline_level>level){inline_level=level;}}
if(token.match(/^<(img|hr|br)/)){level--;}
result+=token.trim().replace(/\s+/,' ');if(inline_level>level){result+='\n';}}
return result;}
$.summernote.pluginEvents.codeview=function(event,editor,layoutInfo){if(layoutInfo.toolbar){return eventHandler.modules.codeview.toggle(layoutInfo);}else{var $editor=layoutInfo.editor();var $textarea=$editor.prev('textarea');if(!$textarea.length){var html=prettify_html($editor.prop("innerHTML"));$editor.parent().css({'position':'absolute','top':0,'bottom':0,'left':0,'right':0});$textarea=$('<textarea/>').css({'margin':'0 -4px','padding':'0 4px','border':0,'top':'51px','left':'620px','width':'100%','font-family':'sans-serif','font-size':'13px','height':'98%','white-space':'pre','word-wrap':'normal'}).val(html).data('init',html);$editor.before($textarea);$editor.hide();}else{$editor.prop('innerHTML',$textarea.val().replace(/\s*\n\s*/g,'')).trigger('content_changed');$textarea.remove();$editor.show();}}};var initial_data={};function reRangeSelectKey(event){initial_data.range=null;if(event.shiftKey&&event.keyCode>=37&&event.keyCode<=40&&!$(event.target).is("input, textarea, select")){var r=range.create();if(r){var rng=r.reRange(event.keyCode<=38);if(r!==rng){rng.select();}}}}
function reRangeSelect(event,dx,dy){var r=range.create();if(!r||r.isCollapsed())return;var data=r.reRange(dy<0||(dy===0&&dx<0));if(data.sc!==r.sc||data.so!==r.so||data.ec!==r.ec||data.eo!==r.eo){setTimeout(function(){data.select();$(data.sc.parentNode).closest('.note-popover');},0);}
$(data.sc).closest('.o_editable').data('range',r);return r;}
function summernote_mouseup(event){if($(event.target).closest("#web_editor-top-navbar, .note-popover").length){return;}
if(initial_data.event){var dx=event.clientX-(event.shiftKey?initial_data.rect.left:initial_data.event.clientX);var dy=event.clientY-(event.shiftKey?initial_data.rect.top:initial_data.event.clientY);if(10<Math.pow(dx,2)+Math.pow(dy,2)){reRangeSelect(event,dx,dy);}}
if(!$(event.target).closest(".o_editable").length){return;}
if(!initial_data.range||!event.shiftKey){setTimeout(function(){initial_data.range=range.create();},0);}}
var remember_selection;function summernote_mousedown(event){rte.history.splitNext();var $editable=$(event.target).closest(".o_editable, .note-editor");if(!!document.documentMode){summernote_ie_fix(event,function(node){return node.tagName==="DIV"||node.tagName==="IMG"||(node.dataset&&node.dataset.oeModel);});}else if(last_div&&event.target!==last_div){if(last_div.tagName==="A"){summernote_ie_fix(event,function(node){return node.dataset&&node.dataset.oeModel;});}else if($editable.length){if(summernote_ie_fix(event,function(node){return node.tagName==="A";})){var r=range.create();r.select();}}}
var r=range.create();var editables=$(".o_editable[contenteditable], .note-editable[contenteditable]");var r_editable=editables.has((r||{}).sc);if(!r_editable.closest('.note-editor').is($editable)&&!r_editable.filter('.o_editable').is(editables)){var saved_editable=editables.has((remember_selection||{}).sc);if($editable.length&&!saved_editable.closest('.o_editable, .note-editor').is($editable)){remember_selection=range.create(dom.firstChild($editable[0]),0);}else if(!saved_editable.length){remember_selection=undefined;}
if(remember_selection){try{remember_selection.select();}catch(e){console.warn(e);}}}else if(r_editable.length){remember_selection=r;}
initial_data.event=event;if(event.shiftKey&&$editable.length){if(initial_data.range){initial_data.range.select();}
var rect=r&&r.getClientRects();initial_data.rect=rect&&rect.length?rect[0]:{top:0,left:0};}}
var last_div;var last_div_change;var last_editable;function summernote_ie_fix(event,pred){var editable;var div;var node=event.target;while(node.parentNode){if(!div&&pred(node)){div=node;}
if(last_div!==node&&(node.getAttribute('contentEditable')==='false'||node.className&&(node.className.indexOf('o_not_editable')!==-1))){break;}
if(node.className&&node.className.indexOf('o_editable')!==-1){if(!div){div=node;}
editable=node;break;}
node=node.parentNode;}
if(!editable){$(last_div_change).removeAttr("contentEditable").removeProp("contentEditable");$(last_editable).attr("contentEditable","true").prop("contentEditable","true");last_div_change=null;last_editable=null;return;}
if(div===last_div){return;}
last_div=div;$(last_div_change).removeAttr("contentEditable").removeProp("contentEditable");if(last_editable!==editable){if($(editable).is("[contentEditable='true']")){$(editable).removeAttr("contentEditable").removeProp("contentEditable");last_editable=editable;}else{last_editable=null;}}
if(!$(div).attr("contentEditable")&&!$(div).is("[data-oe-type='many2one'], [data-oe-type='contact']")){$(div).attr("contentEditable","true").prop("contentEditable","true");last_div_change=div;}else{last_div_change=null;}
return editable!==div?div:null;}
var fn_attach=eventHandler.attach;eventHandler.attach=function(oLayoutInfo,options){fn_attach.call(this,oLayoutInfo,options);oLayoutInfo.editor().on('dragstart','img',function(e){e.preventDefault();});$(document).on('mousedown',summernote_mousedown);$(document).on('mouseup',summernote_mouseup);oLayoutInfo.editor().off('click').on('click',function(e){e.preventDefault();});oLayoutInfo.editor().on('dblclick','img, .media_iframe_video, span.fa, i.fa, span.fa, a.o_image',function(event){if(!$(event.target).closest(".note-toolbar").length){new widgets.MediaDialog(oLayoutInfo.editor(),event.target).appendTo(document.body);}});if(oLayoutInfo.editor().is('[data-oe-model][data-oe-type="image"]')){oLayoutInfo.editor().on('click','img',function(event){$(event.target).trigger("dblclick");});}
oLayoutInfo.editable().on('mousedown',function(e){if(dom.isImg(e.target)){range.createFromNode(e.target).select();}});$(document).on("keyup",reRangeSelectKey);var clone_data=false;var $node=oLayoutInfo.editor();if($node.data('oe-model')||$node.data('oe-translation-id')){$node.on('content_changed',function(){var $nodes=$('[data-oe-model], [data-oe-translation-id]').filter(function(){return this!=$node[0];});if($node.data('oe-model')){$nodes=$nodes.filter('[data-oe-model="'+$node.data('oe-model')+'"]').filter('[data-oe-id="'+$node.data('oe-id')+'"]').filter('[data-oe-field="'+$node.data('oe-field')+'"]');}
if($node.data('oe-translation-id'))$nodes=$nodes.filter('[data-oe-translation-id="'+$node.data('oe-translation-id')+'"]');if($node.data('oe-type'))$nodes=$nodes.filter('[data-oe-type="'+$node.data('oe-type')+'"]');if($node.data('oe-expression'))$nodes=$nodes.filter('[data-oe-expression="'+$node.data('oe-expression')+'"]');if($node.data('oe-xpath'))$nodes=$nodes.filter('[data-oe-xpath="'+$node.data('oe-xpath')+'"]');if($node.data('oe-contact-options'))$nodes=$nodes.filter('[data-oe-contact-options="'+$node.data('oe-contact-options')+'"]');var nodes=$node.get();if($node.data('oe-type')==="many2one"){$nodes=$nodes.add($('[data-oe-model]').filter(function(){return this!=$node[0]&&nodes.indexOf(this)===-1;}).filter('[data-oe-many2one-model="'+$node.data('oe-many2one-model')+'"]').filter('[data-oe-many2one-id="'+$node.data('oe-many2one-id')+'"]').filter('[data-oe-type="many2one"]'));$nodes=$nodes.add($('[data-oe-model]').filter(function(){return this!=$node[0]&&nodes.indexOf(this)===-1;}).filter('[data-oe-model="'+$node.data('oe-many2one-model')+'"]').filter('[data-oe-id="'+$node.data('oe-many2one-id')+'"]').filter('[data-oe-field="name"]'));}
if(!clone_data){clone_data=true;$nodes.html(this.innerHTML);clone_data=false;}});}
var custom_toolbar=oLayoutInfo.toolbar?oLayoutInfo.toolbar():undefined;var $toolbar=$(oLayoutInfo.popover()).add(custom_toolbar);$('button[data-event="undo"], button[data-event="redo"]',$toolbar).attr('disabled',true);$(oLayoutInfo.editor()).add(oLayoutInfo.handle()).add(oLayoutInfo.popover()).add(custom_toolbar).on('click content_changed',function(){$('button[data-event="undo"]',$toolbar).attr('disabled',!oLayoutInfo.editable().data('NoteHistory').hasUndo());$('button[data-event="redo"]',$toolbar).attr('disabled',!oLayoutInfo.editable().data('NoteHistory').hasRedo());});};var fn_detach=eventHandler.detach;eventHandler.detach=function(oLayoutInfo,options){fn_detach.call(this,oLayoutInfo,options);oLayoutInfo.editable().off('mousedown');oLayoutInfo.editor().off("dragstart");oLayoutInfo.editor().off('click');$(document).off('mousedown',summernote_mousedown);$(document).off('mouseup',summernote_mouseup);oLayoutInfo.editor().off("dblclick");$(document).off("keyup",reRangeSelectKey);};$.summernote.lang.odoo={font:{bold:_t('Bold'),italic:_t('Italic'),underline:_t('Underline'),strikethrough:_t('Strikethrough'),subscript:_t('Subscript'),superscript:_t('Superscript'),clear:_t('Remove Font Style'),height:_t('Line Height'),name:_t('Font Family'),size:_t('Font Size')},image:{image:_t('Picture'),insert:_t('Insert Image'),resizeFull:_t('Resize Full'),resizeHalf:_t('Resize Half'),resizeQuarter:_t('Resize Quarter'),floatLeft:_t('Float Left'),floatRight:_t('Float Right'),floatNone:_t('Float None'),dragImageHere:_t('Drag an image here'),selectFromFiles:_t('Select from files'),url:_t('Image URL'),remove:_t('Remove Image')},link:{link:_t('Link'),insert:_t('Insert Link'),unlink:_t('Unlink'),edit:_t('Edit'),textToDisplay:_t('Text to display'),url:_t('To what URL should this link go?'),openInNewWindow:_t('Open in new window')},video:{video:_t('Video'),videoLink:_t('Video Link'),insert:_t('Insert Video'),url:_t('Video URL?'),providers:_t('(YouTube, Vimeo, Vine, Instagram, DailyMotion or Youku)')},table:{table:_t('Table')},hr:{insert:_t('Insert Horizontal Rule')},style:{style:_t('Style'),normal:_t('Normal'),blockquote:_t('Quote'),pre:_t('Code'),h1:_t('Header 1'),h2:_t('Header 2'),h3:_t('Header 3'),h4:_t('Header 4'),h5:_t('Header 5'),h6:_t('Header 6')},lists:{unordered:_t('Unordered list'),ordered:_t('Ordered list')},options:{help:_t('Help'),fullscreen:_t('Full Screen'),codeview:_t('Code View')},paragraph:{paragraph:_t('Paragraph'),outdent:_t('Outdent'),indent:_t('Indent'),left:_t('Align left'),center:_t('Align center'),right:_t('Align right'),justify:_t('Justify full')},color:{recent:_t('Recent Color'),more:_t('More Color'),background:_t('Background Color'),foreground:_t('Foreground Color'),transparent:_t('Transparent'),setTransparent:_t('Set transparent'),reset:_t('Reset'),resetToDefault:_t('Reset to default')},shortcut:{shortcuts:_t('Keyboard shortcuts'),close:_t('Close'),textFormatting:_t('Text formatting'),action:_t('Action'),paragraphFormatting:_t('Paragraph formatting'),documentStyle:_t('Document Style')},history:{undo:_t('Undo'),redo:_t('Redo')}};});;

/* /web_editor/static/src/js/widgets.js defined in bundle 'web.assets_backend' */
odoo.define('web_editor.widget',function(require){'use strict';var core=require('web.core');var ajax=require('web.ajax');var Widget=require('web.Widget');var base=require('web_editor.base');var rte=require('web_editor.rte');var QWeb=core.qweb;var range=$.summernote.core.range;var dom=$.summernote.core.dom;var Dialog=Widget.extend({events:{'hidden.bs.modal':'destroy','keydown.dismiss.bs.modal':'stop_escape','click button.save':'save','click button[data-dismiss="modal"]':'cancel',},init:function(){this._super();},start:function(){var sup=this._super();this.$el.modal({backdrop:'static'});this.$('input:first').focus();return sup;},save:function(){this.close();this.trigger("saved");},cancel:function(){this.trigger("cancel");},close:function(){this.$el.modal('hide');},stop_escape:function(event){if($(".modal.in").length>0&&event.which==27){event.stopPropagation();}}});var alt=Dialog.extend({template:'web_editor.dialog.alt',init:function($editable,media){this.$editable=$editable;this.media=media;this.alt=($(this.media).attr('alt')||"").replace(/&quot;/g,'"');this.title=($(this.media).attr('title')||"").replace(/&quot;/g,'"');return this._super();},save:function(){var self=this;range.createFromNode(self.media).select();this.$editable.data('NoteHistory').recordUndo();var alt=this.$('#alt').val();var title=this.$('#title').val();$(this.media).attr('alt',alt?alt.replace(/"/g,"&quot;"):null).attr('title',title?title.replace(/"/g,"&quot;"):null);setTimeout(function(){click_event(self.media,"mouseup");},0);return this._super();},});var click_event=function(el,type){var evt=document.createEvent("MouseEvents");evt.initMouseEvent(type,true,true,window,0,0,0,0,0,false,false,false,false,0,el);el.dispatchEvent(evt);};var MediaDialog=Dialog.extend({template:'web_editor.dialog.media',events:_.extend({},Dialog.prototype.events,{'input input#icon-search':'search',}),init:function($editable,media,options){this._super();if($editable){this.$editable=$editable;this.rte=this.$editable.rte||this.$editable.data('rte');}
this.options=options||{};this.old_media=media;this.media=media;this.isNewMedia=!media;this.range=range.create();},start:function(){var self=this;this.only_images=this.options.only_images||this.options.select_images||(this.media&&$(this.media).parent().data("oe-field")==="image");if(this.only_images){this.$('[href="#editor-media-document"], [href="#editor-media-video"], [href="#editor-media-icon"]').addClass('hidden');}
if(this.media){if(this.media.nodeName==="IMG"){this.$('[href="#editor-media-image"]').tab('show');}else if($(this.media).is('a.o_image')){this.$('[href="#editor-media-document"]').tab('show');}else if(this.media.className.match(/(^|\s)media_iframe_video($|\s)/)){this.$('[href="#editor-media-video"]').tab('show');}else if(this.media.parentNode.className.match(/(^|\s)media_iframe_video($|\s)/)){this.media=this.media.parentNode;this.$('[href="#editor-media-video"]').tab('show');}else if(this.media.className.match(/(^|\s)fa($|\s)/)){this.$('[href="#editor-media-icon"]').tab('show');}}
this.imageDialog=new ImageDialog(this,this.media,this.options);this.imageDialog.appendTo(this.$("#editor-media-image"));this.documentDialog=new ImageDialog(this,this.media,_.extend({'document':true},this.options));this.documentDialog.appendTo(this.$("#editor-media-document"));if(!this.only_images){this.iconDialog=new fontIconsDialog(this,this.media,this.options);this.iconDialog.appendTo(this.$("#editor-media-icon"));this.videoDialog=new VideoDialog(this,this.media,this.options);this.videoDialog.appendTo(this.$("#editor-media-video"));}
this.active=this.imageDialog;$('a[data-toggle="tab"]').on('shown.bs.tab',function(event){if($(event.target).is('[href="#editor-media-image"]')){self.active=self.imageDialog;self.$('li.search, li.previous, li.next').removeClass("hidden");}if($(event.target).is('[href="#editor-media-document"]')){self.active=self.documentDialog;self.$('li.search, li.previous, li.next').removeClass("hidden");}else if($(event.target).is('[href="#editor-media-icon"]')){self.active=self.iconDialog;self.$('li.search, li.previous, li.next').removeClass("hidden");self.$('.nav-tabs li.previous, .nav-tabs li.next').addClass("hidden");}else if($(event.target).is('[href="#editor-media-video"]')){self.active=self.videoDialog;self.$('.nav-tabs li.search').addClass("hidden");}});return this._super();},save:function(){if(this.options.select_images){this.trigger("saved",this.active.save());this.close();return;}
if(this.rte){this.range.select();this.rte.historyRecordUndo(this.media);}
var self=this;if(self.media){this.media.innerHTML="";if(this.active!==this.imageDialog&&this.active!==this.documentDialog){this.imageDialog.clear();}
if(this.iconDialog&&this.active!==this.iconDialog){this.iconDialog.clear();}
if(this.videoDialog&&this.active!==this.videoDialog){this.videoDialog.clear();}}else{this.media=document.createElement("img");this.range.insertNode(this.media,true);this.active.media=this.media;}
this.active.save();if(this.active.add_class){$(this.active.media).addClass(this.active.add_class);}
var media=this.active.media;$(document.body).trigger("media-saved",[media,self.old_media]);self.trigger("saved",[media,self.old_media]);setTimeout(function(){if(!media.parentNode){return;}
range.createFromNode(media).select();click_event(media,"mousedown");if(!this.only_images){setTimeout(function(){if($(media).parent().data("oe-field")!=="image"){click_event(media,"click");}
click_event(media,"mouseup");},0);}},0);this.close();},searchTimer:null,search:function(){var self=this;var needle=this.$("input#icon-search").val();clearTimeout(this.searchTimer);this.searchTimer=setTimeout(function(){self.active.search(needle||"");},250);}});var IMAGES_PER_ROW=6;var IMAGES_ROWS=2;var ImageDialog=Widget.extend({template:'web_editor.dialog.image',events:_.extend({},Dialog.prototype.events,{'change .url-source':function(e){this.changed($(e.target));},'click button.filepicker':function(){var filepicker=this.$('input[type=file]');if(!_.isEmpty(filepicker)){filepicker[0].click();}},'click .js_disable_optimization':function(){this.$('input[name="disable_optimization"]').val('1');var filepicker=this.$('button.filepicker');if(!_.isEmpty(filepicker)){filepicker[0].click();}},'change input[type=file]':'file_selection','submit form':'form_submit','change input.url':"change_input",'keyup input.url':"change_input",'click .existing-attachments [data-src]':'select_existing','click .existing-attachment-remove':'try_remove','keydown.dismiss.bs.modal':function(){},}),init:function(parent,media,options){this._super();this.options=options||{};this.accept=this.options.accept||this.options.document?"*/*":"image/*";this.domain=this.options.domain||['|',['mimetype','=',false],['mimetype',this.options.document?'not in':'in',['image/gif','image/jpe','image/jpeg','image/jpg','image/gif','image/png']]];this.parent=parent;this.old_media=media;this.media=media;this.images=[];this.page=0;},start:function(){this.$preview=this.$('.preview-container').detach();var self=this;var res=this._super();var o={url:null,alt:null};if($(this.media).is("img")){o.url=this.media.getAttribute('src');}else if($(this.media).is("a.o_image")){o.url=this.media.getAttribute('href').replace(/[?].*/,'');o.id=+o.url.match(/\/web\/content\/([0-9]*)/,'')[1];}
this.parent.$(".pager > li").click(function(e){if(!self.$el.is(':visible')){return;}
e.preventDefault();var $target=$(e.currentTarget);if($target.hasClass('disabled')){return;}
self.page+=$target.hasClass('previous')?-1:1;self.display_attachments();});this.fetch_existing().then(function(){self.set_image(_.find(self.records,function(record){return record.url===o.url;})||o);});return res;},push:function(attachment){if(this.options.select_images){var img=_.select(this.images,function(v){return v.id==attachment.id;});if(img.length){this.images.splice(this.images.indexOf(img[0]),1);}}else{this.images=[];}
this.images.push(attachment);},save:function(){if(this.options.select_images){this.parent.trigger("save",this.images);return this.images;}
this.parent.trigger("save",this.media);var img=this.images[0];if(!img){var id=this.$(".existing-attachments [data-src]:first").data('id');img=_.find(this.images,function(img){return img.id===id;});}
if(!img.is_document){if(this.media.tagName!=="IMG"||!this.old_media){this.add_class="pull-left";this.style={"width":"100%"};}
if(this.media.tagName!=="IMG"){var media=document.createElement('img');$(this.media).replaceWith(media);this.media=media;}
this.media.setAttribute('src',img.src);}else{if(this.media.tagName!=="A"){$('.note-control-selection').hide();var media=document.createElement('a');$(this.media).replaceWith(media);this.media=media;}
this.media.setAttribute('href','/web/content/'+img.id+'?unique='+img.checksum+'&download=true');$(this.media).addClass('o_image').attr('title',img.name).attr('data-mimetype',img.mimetype);}
$(this.media).attr('alt',img.alt);var style=this.style;if(style){$(this.media).css(style);}
return this.media;},clear:function(){this.media.className=this.media.className.replace(/(^|\s+)((img(\s|$)|img-(?!circle|rounded|thumbnail))[^\s]*)/g,' ');},cancel:function(){this.trigger('cancel');},change_input:function(e){var $input=$(e.target);var $button=$input.parent().find("button");if($input.val()===""){$button.addClass("btn-default").removeClass("btn-primary");}else{$button.removeClass("btn-default").addClass("btn-primary");}},search:function(needle){var self=this;this.fetch_existing(needle).then(function(){self.selected_existing();});},set_image:function(attachment,error){var self=this;this.push(attachment);this.$('input.url').val('');this.fetch_existing().then(function(){self.selected_existing();});},form_submit:function(event){var self=this;var $form=this.$('form[action="/web_editor/attachment/add"]');if(!$form.find('input[name="upload"]').val().length){var url=$form.find('input[name="url"]').val();if(this.selected_existing().size()){event.preventDefault();return false;}}
$form.find('.well > div').hide().last().after('<span class="fa fa-spin fa-3x fa-refresh"/>');var callback=_.uniqueId('func_');this.$('input[name=func]').val(callback);window[callback]=function(attachments,error){delete window[callback];$form.find('.well > span').remove();$form.find('.well > div').show();_.each(attachments,function(record){record.src=record.url||'/web/image/'+record.id;record.is_document=!(/gif|jpe|jpg|png/.test(record.mimetype));});if(error||!attachments.length){self.file_selected(null,error||!attachments.length);}
self.images=attachments;for(var i=0;i<attachments.length;i++){self.file_selected(attachments[i],error);}};},file_selection:function(){this.$el.addClass('nosave');this.$('form').removeClass('has-error').find('.help-block').empty();this.$('button.filepicker').removeClass('btn-danger btn-success');this.$('form').submit();},file_selected:function(attachment,error){var $button=this.$('button.filepicker');if(!error){$button.addClass('btn-success');this.set_image(attachment);}else{this.$('form').addClass('has-error').find('.help-block').text(error);$button.addClass('btn-danger');}
if(!this.options.select_images){this.parent.save();}},fetch_existing:function(needle){var domain=[['res_model','=','ir.ui.view']].concat(this.domain);if(needle&&needle.length){domain.push('|',['datas_fname','ilike',needle],['name','ilike',needle]);}
return ajax.jsonRpc('/web/dataset/call_kw','call',{model:'ir.attachment',method:'search_read',args:[],kwargs:{domain:domain,fields:['name','mimetype','checksum','url'],order:'id desc',context:base.get_context()}}).then(this.proxy('fetched_existing'));},fetched_existing:function(records){this.records=records;_.each(records,function(record){record.src=record.url||'/web/image/'+record.id;record.is_document=!(/gif|jpe|jpg|png/.test(record.mimetype));});this.display_attachments();},display_attachments:function(){var self=this;var per_screen=IMAGES_PER_ROW*IMAGES_ROWS;var from=this.page*per_screen;var records=this.records;var rows=_(records).chain().slice(from,from+per_screen).groupBy(function(_,index){return Math.floor(index/IMAGES_PER_ROW);}).values().value();this.$('.help-block').empty();this.$('.existing-attachments').replaceWith(QWeb.render('web_editor.dialog.image.existing.content',{rows:rows}));this.parent.$('.pager').find('li.previous').toggleClass('disabled',(from===0)).end().find('li.next').toggleClass('disabled',(from+per_screen>=records.length));this.$el.find('.o_image').each(function(){var $div=$(this);if(/gif|jpe|jpg|png/.test($div.data('mimetype'))){var $img=$('<img/>').addClass('img img-responsive').attr('src',$div.data('url')||$div.data('src'));$div.addClass('o_webimage').append($img);}});this.selected_existing();},select_existing:function(e){var $img=$(e.currentTarget);var attachment=_.find(this.records,function(record){return record.id===$img.data('id');});this.push(attachment);this.selected_existing();},selected_existing:function(){var self=this;this.$('.existing-attachment-cell.media_selected').removeClass("media_selected");var $select=this.$('.existing-attachment-cell [data-src]').filter(function(){var $img=$(this);return!!_.find(self.images,function(v){return(v.url===$img.data("src")||($img.data("url")&&v.url===$img.data("url"))||v.id===$img.data("id"));});});$select.closest('.existing-attachment-cell').addClass("media_selected");return $select;},try_remove:function(e){var $help_block=this.$('.help-block').empty();var self=this;var $a=$(e.target);var id=parseInt($a.data('id'),10);var attachment=_.findWhere(this.records,{id:id});var $both=$a.parent().children();$both.css({borderWidth:"5px",borderColor:"#f00"});return ajax.jsonRpc('/web_editor/attachment/remove','call',{'ids':[id]}).then(function(prevented){if(_.isEmpty(prevented)){self.records=_.without(self.records,attachment);self.display_attachments();return;}
$both.css({borderWidth:"",borderColor:""});$help_block.replaceWith(QWeb.render('web_editor.dialog.image.existing.error',{views:prevented[id]}));});},});var cacheCssSelectors={};var getCssSelectors=function(filter){var css=[];if(cacheCssSelectors[filter]){return cacheCssSelectors[filter];}
var sheets=document.styleSheets;for(var i=0;i<sheets.length;i++){var rules;if(sheets[i].rules){rules=sheets[i].rules;}else{try{rules=sheets[i].cssRules;}catch(e){console.warn("Can't read the css rules of: "+sheets[i].href,e);continue;}}
if(rules){for(var r=0;r<rules.length;r++){var selectorText=rules[r].selectorText;if(selectorText){selectorText=selectorText.split(/\s*,\s*/);var data=null;for(var s=0;s<selectorText.length;s++){var match=selectorText[s].match(filter);if(match){var clean=match[1].slice(1).replace(/::?before$/,'');if(!data){data=[match[1],rules[r].cssText.replace(/(^.*\{\s*)|(\s*\}\s*$)/g,''),clean,[clean]];}else{data[3].push(clean);}}}
if(data){css.push(data);}}}}}
return cacheCssSelectors[filter]=css;};var computeFonts=_.once(function(){_.each(fontIcons,function(data){data.cssData=getCssSelectors(data.parser);data.alias=[];data.icons=_.map(data.cssData,function(css){data.alias.push.apply(data.alias,css[3]);return css[2];});});});rte.Class.include({init:function(EditorBar){this._super.apply(this,arguments);computeFonts();},onEnableEditableArea:function($editable){if($editable.data('oe-type')==="monetary"){$editable.attr('contenteditable',false);$editable.find('.oe_currency_value').attr('contenteditable',true);}
if($editable.is('[data-oe-model]')&&!$editable.is('[data-oe-model="ir.ui.view"]')&&!$editable.is('[data-oe-type="html"]')){$editable.data('layoutInfo').popover().find('.btn-group:not(.note-history)').remove();}},});var fontIcons=[{'base':'fa','parser':/(?=^|\s)(\.fa-[0-9a-z_-]+::?before)/i}];var fontIconsDialog=Widget.extend({template:'web_editor.dialog.font-icons',events:_.extend({},Dialog.prototype.events,{'click .font-icons-icon':function(e){e.preventDefault();e.stopPropagation();this.$('#fa-icon').val(e.target.getAttribute('data-id'));$(".font-icons-icon").removeClass("font-icons-selected");$(e.target).addClass("font-icons-selected");},'keydown.dismiss.bs.modal':function(){},}),renderElement:function(){this.iconsParser=fontIcons;this.icons=_.flatten(_.map(fontIcons,function(data){return data.icons;}));this._super();},init:function(parent,media){this._super();this.parent=parent;this.media=media;computeFonts();},start:function(){return this._super().then(this.proxy('load_data'));},search:function(needle){var iconsParser=this.iconsParser;if(needle){var iconsParser=[];_.filter(this.iconsParser,function(data){var cssData=_.filter(data.cssData,function(cssData){return _.find(cssData[3],function(alias){return alias.indexOf(needle)!==-1;});});if(cssData.length){iconsParser.push({base:data.base,cssData:cssData});}});}
this.$('div.font-icons-icons').html(QWeb.render('web_editor.dialog.font-icons.icons',{'iconsParser':iconsParser}));},save:function(){var self=this;this.parent.trigger("save",this.media);var icons=this.icons;var style=this.media.attributes.style?this.media.attributes.style.value:'';var classes=(this.media.className||"").split(/\s+/);var custom_classes=/^fa(-[1-5]x|spin|rotate-(9|18|27)0|flip-(horizont|vertic)al|fw|border)?$/;var non_fa_classes=_.reject(classes,function(cls){return self.getFont(cls)||custom_classes.test(cls);});var final_classes=non_fa_classes.concat(this.get_fa_classes());if(this.media.tagName!=="SPAN"){var media=document.createElement('span');$(media).data($(this.media).data());$(this.media).replaceWith(media);this.media=media;style=style.replace(/\s*width:[^;]+/,'');}
$(this.media).attr("class",_.compact(final_classes).join(' ')).attr("style",style);},getFont:function(classNames){if(!(classNames instanceof Array)){classNames=(classNames||"").split(/\s+/);}
var fontIcon,cssData;for(var k=0;k<this.iconsParser.length;k++){fontIcon=this.iconsParser[k];for(var s=0;s<fontIcon.cssData.length;s++){cssData=fontIcon.cssData[s];if(_.intersection(classNames,cssData[3]).length){return{'base':fontIcon.base,'parser':fontIcon.parser,'icons':fontIcon.icons,'font':cssData[2]};}}}
return null;},load_data:function(){var classes=(this.media&&this.media.className||"").split(/\s+/);for(var i=0;i<classes.length;i++){var cls=classes[i];switch(cls){case'fa-1x':case'fa-2x':case'fa-3x':case'fa-4x':case'fa-5x':this.$('#fa-size').val(cls);continue;case'fa-spin':case'fa-rotate-90':case'fa-rotate-180':case'fa-rotate-270':case'fa-flip-horizontal':case'fa-rotate-vertical':this.$('#fa-rotation').val(cls);continue;case'fa-fw':continue;case'fa-border':this.$('#fa-border').prop('checked',true);continue;case'':continue;default:$(".font-icons-icon").removeClass("font-icons-selected").filter("[data-alias*=',"+cls+",']").addClass("font-icons-selected");for(var k=0;k<this.icons.length;k++){if(this.icons.indexOf(cls)!==-1){this.$('#fa-icon').val(cls);break;}}}}},get_fa_classes:function(){var font=this.getFont(this.$('#fa-icon').val());return[font?font.base:'fa',font?font.font:"",this.$('#fa-size').val(),this.$('#fa-rotation').val(),this.$('#fa-border').prop('checked')?'fa-border':''];},clear:function(){this.media.className=this.media.className.replace(/(^|\s)(fa(\s|$)|fa-[^\s]*)/g,' ');},});function createVideoNode(url){var ytRegExp=/^(?:(?:https?:)?\/\/)?(?:www\.)?(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))((\w|-){11})(?:\S+)?$/;var ytMatch=url.match(ytRegExp);var igRegExp=/\/\/instagram.com\/p\/(.[a-zA-Z0-9]*)/;var igMatch=url.match(igRegExp);var vRegExp=/\/\/vine.co\/v\/(.[a-zA-Z0-9]*)/;var vMatch=url.match(vRegExp);var vimRegExp=/\/\/(player.)?vimeo.com\/([a-z]*\/)*([0-9]{6,11})[?]?.*/;var vimMatch=url.match(vimRegExp);var dmRegExp=/.+dailymotion.com\/(video|hub)\/([^_]+)[^#]*(#video=([^_&]+))?/;var dmMatch=url.match(dmRegExp);var youkuRegExp=/\/\/v\.youku\.com\/v_show\/id_(\w+)\.html/;var youkuMatch=url.match(youkuRegExp);var $video=$('<iframe>');if(ytMatch&&ytMatch[1].length===11){var youtubeId=ytMatch[1];$video=$('<iframe>').attr('src','//www.youtube.com/embed/'+youtubeId).attr('width','640').attr('height','360');}else if(igMatch&&igMatch[0].length){$video=$('<iframe>').attr('src',igMatch[0]+'/embed/').attr('width','612').attr('height','710').attr('scrolling','no').attr('allowtransparency','true');}else if(vMatch&&vMatch[0].length){$video=$('<iframe>').attr('src',vMatch[0]+'/embed/simple').attr('width','600').attr('height','600').attr('class','vine-embed');}else if(vimMatch&&vimMatch[3].length){$video=$('<iframe webkitallowfullscreen mozallowfullscreen allowfullscreen>').attr('src','//player.vimeo.com/video/'+vimMatch[3]).attr('width','640').attr('height','360');}else if(dmMatch&&dmMatch[2].length){$video=$('<iframe>').attr('src','//www.dailymotion.com/embed/video/'+dmMatch[2]).attr('width','640').attr('height','360');}else if(youkuMatch&&youkuMatch[1].length){$video=$('<iframe webkitallowfullscreen mozallowfullscreen allowfullscreen>').attr('height','498').attr('width','510').attr('src','//player.youku.com/embed/'+youkuMatch[1]);}else{}
$video.attr('frameborder',0);return $video;}
var VideoDialog=Widget.extend({template:'web_editor.dialog.video',events:_.extend({},Dialog.prototype.events,{'click input#urlvideo ~ button':'get_video','click input#embedvideo ~ button':'get_embed_video','change input#urlvideo':'change_input','keyup input#urlvideo':'change_input','change input#embedvideo':'change_input','keyup input#embedvideo':'change_input','keydown.dismiss.bs.modal':function(){},}),init:function(parent,media){this._super();this.parent=parent;this.media=media;},start:function(){this.$preview=this.$('.preview-container').detach();this.$iframe=this.$("iframe");var $media=$(this.media);if($media.hasClass("media_iframe_video")){var src=$media.data('src');this.$("input#urlvideo").val(src);this.get_video();}
return this._super();},change_input:function(e){var $input=$(e.target);var $button=$input.parent().find("button");if($input.val()===""){$button.addClass("btn-default").removeClass("btn-primary");}else{$button.removeClass("btn-default").addClass("btn-primary");}},get_embed_video:function(event){event.preventDefault();var embedvideo=this.$("input#embedvideo").val().match(/src=["']?([^"']+)["' ]?/);if(embedvideo){this.$("input#urlvideo").val(embedvideo[1]);this.get_video(event);}
return false;},get_video:function(event){if(event)event.preventDefault();var $video=createVideoNode(this.$("input#urlvideo").val());this.$iframe.replaceWith($video);this.$iframe=$video;return false;},save:function(){this.parent.trigger("save",this.media);var video_id=this.$("#video_id").val();if(!video_id){this.$("button.btn-primary").click();video_id=this.$("#video_id").val();}
var video_type=this.$("#video_type").val();var $iframe=$('<div class="media_iframe_video" data-src="'+this.$iframe.attr("src")+'">'+'<div class="css_editable_mode_display">&nbsp;</div>'+'<div class="media_iframe_video_size" contentEditable="false">&nbsp;</div>'+'<iframe src="'+this.$iframe.attr("src")+'" frameborder="0" allowfullscreen="allowfullscreen" contentEditable="false"></iframe>'+'</div>');$(this.media).replaceWith($iframe);this.media=$iframe[0];},clear:function(){if(this.media.dataset.src){try{delete this.media.dataset.src;}catch(e){this.media.dataset.src=undefined;}}
this.media.className=this.media.className.replace(/(^|\s)media_iframe_video(\s|$)/g,' ');},});var LinkDialog=Dialog.extend({template:'web_editor.dialog.link',events:_.extend({},Dialog.prototype.events,{'change :input.url-source':'changed','keyup :input.url':'onkeyup','keyup :input':'preview','click button.remove':'remove_link','change input#link-text':function(e){this.text=$(e.target).val();},'change .link-style':function(e){this.preview();},}),init:function(editable,linkInfo){this._super(editable,linkInfo);this.editable=editable;this.data=linkInfo||{};this.data.className="";if(this.data.range){this.data.iniClassName=$(this.data.range.sc).filter("a").attr("class")||"";this.data.className=this.data.iniClassName.replace(/(^|\s+)btn(-[a-z0-9_-]*)?/gi,' ');var is_link=this.data.range.isOnAnchor();var r=this.data.range;var sc=r.sc;var so=r.so;var ec=r.ec;var eo=r.eo;var nodes;if(!is_link){if(sc.tagName){sc=dom.firstChild(so?sc.childNodes[so]:sc);so=0;}else if(so!==sc.textContent.length){if(sc===ec){ec=sc=sc.splitText(so);eo-=so;}else{sc=sc.splitText(so);}
so=0;}
if(ec.tagName){ec=dom.lastChild(eo?ec.childNodes[eo-1]:ec);eo=ec.textContent.length;}else if(eo!==ec.textContent.length){ec.splitText(eo);}
nodes=dom.listBetween(sc,ec);if(dom.isVoid(sc)||dom.isImg(sc)){so=dom.listPrev(sc).length-1;sc=sc.parentNode;}
if(dom.isBR(ec)){eo=dom.listPrev(ec).length-1;ec=ec.parentNode;}else if(dom.isVoid(ec)||dom.isImg(sc)){eo=dom.listPrev(ec).length;ec=ec.parentNode;}
this.data.range=range.create(sc,so,ec,eo);this.data.range.select();}else{nodes=dom.ancestor(sc,dom.isAnchor).childNodes;}
if(dom.isImg(sc)&&nodes.indexOf(sc)===-1){nodes.push(sc);}
if(nodes.length>1||dom.ancestor(nodes[0],dom.isImg)){var text="";this.data.images=[];for(var i=0;i<nodes.length;i++){if(dom.ancestor(nodes[i],dom.isImg)){this.data.images.push(dom.ancestor(nodes[i],dom.isImg));text+='[IMG]';}else if(!is_link&&i===0){text+=nodes[i].textContent.slice(so,Infinity);}else if(!is_link&&i===nodes.length-1){text+=nodes[i].textContent.slice(0,eo);}else{text+=nodes[i].textContent;}}
this.data.text=text;}}
this.data.text=this.data.text.replace(/[ \t\r\n]+/g,' ');},start:function(){this.bind_data();this.$('input.url-source:eq(1)').closest('.list-group-item').addClass('active');return this._super();},get_data:function(test){var self=this;var def=new $.Deferred();var $e=this.$('.active input.url-source');if(!$e.length){$e=this.$('input.url-source:first');}
var val=$e.val();var label=this.$('#link-text').val()||val;if(label&&this.data.images){for(var i=0;i<this.data.images.length;i++){label=label.replace(/</,"&lt;").replace(/>/,"&gt;").replace(/\[IMG\]/,this.data.images[i].outerHTML);}}
if(!test&&(!val||!$e[0].checkValidity())){$e.closest('.form-group').addClass('has-error');$e.focus();def.reject();}
var style=this.$("input[name='link-style-type']:checked").val()||'';var size=this.$("input[name='link-style-size']:checked").val()||'';var classes=(this.data.className||"")+(style&&style.length?" btn ":"")+style+" "+size;var isNewWindow=this.$('input.window-new').prop('checked');if($e.hasClass('email-address')&&$e.val().indexOf("@")!==-1){self.get_data_buy_mail(def,$e,isNewWindow,label,classes);}else{self.get_data_buy_url(def,$e,isNewWindow,label,classes);}
return def;},get_data_buy_mail:function(def,$e,isNewWindow,label,classes){var val=$e.val();def.resolve(val.indexOf("mailto:")===0?val:'mailto:'+val,isNewWindow,label,classes);},get_data_buy_url:function(def,$e,isNewWindow,label,classes){def.resolve($e.val(),isNewWindow,label,classes);},save:function(){var self=this;var _super=this._super.bind(this);return this.get_data().then(function(url,new_window,label,classes){self.data.url=url;self.data.isNewWindow=new_window;self.data.text=label;self.data.className=classes.replace(/\s+/gi,' ').replace(/^\s+|\s+$/gi,'');self.trigger("save",self.data);}).then(_super);},bind_data:function(){var href=this.data.url;var new_window=this.data.isNewWindow;var text=this.data.text;var classes=this.data.iniClassName;this.$('input#link-text').val(text);this.$('input.window-new').prop('checked',new_window);if(classes){this.$('input[value!=""]').each(function(){var $option=$(this);if(classes.indexOf($option.val())!==-1){$option.attr("checked","checked");}});}
if(href){var match;if(match=/mailto:(.+)/.exec(href)){this.$('input.email-address').val(match=/mailto:(.+)/.exec(href)?match[1]:'');}else{this.$('input.url').val(href);}}
this.preview();},changed:function(e){$(e.target).closest('.list-group-item').addClass('active').siblings().removeClass('active').addBack().removeClass('has-error');this.preview();},onkeyup:function(e){var $e=$(e.target);var is_link=($e.val()||'').length&&$e.val().indexOf("@")===-1;this.$('input.window-new').closest("div").toggle(is_link);this.preview();},preview:function(){var $preview=this.$("#link-preview");this.get_data(true).then(function(url,new_window,label,classes){$preview.attr("target",new_window?'_blank':"").attr("href",url&&url.length?url:"#").html((label&&label.length?label:url)).attr("class",classes.replace(/pull-\w+/,''));});}});return{'getCssSelectors':getCssSelectors,'Dialog':Dialog,'alt':alt,'MediaDialog':MediaDialog,'fontIcons':fontIcons,'LinkDialog':LinkDialog};});;

/* /web_editor/static/src/js/snippets.editor.js defined in bundle 'web.assets_backend' */
odoo.define('web_editor.snippet.editor',function(require){'use strict';var Class=require('web.Class');var ajax=require('web.ajax');var core=require('web.core');var Widget=require('web.Widget');var base=require('web_editor.base');var editor=require('web_editor.editor');var animation=require('web_editor.snippets.animation');var options=require('web_editor.snippets.options');var qweb=core.qweb;var dummy=editor.dummy;ajax.loadXML('/web_editor/static/src/xml/snippets.xml',qweb);editor.Class.include({init:function(){var self=this;var res=this._super.apply(this,arguments);var $editable=this.rte.editable();this.buildingBlock=new BuildingBlock(this,$editable);this.buildingBlock.on("snippets:ready",this,function(){self.trigger("snippets:ready");});return res;},start:function(){var self=this;animation.stop();this.buildingBlock.insertAfter(this.$el);animation.start(true);this.rte.editable().find("*").off('mousedown mouseup click');return this._super();},save:function(){this.buildingBlock.clean_for_save();this._super();},});$.extend($.expr[':'],{hasData:function(node,i,m){return!!_.toArray(node.dataset).length;},data:function(node,i,m){return $(node).data(m[3]);}});var globalSelector={closest:function(){return $();},all:function(){return $();},is:function(){return false;},};$.fn.extend({activateBlock:function(){var target=globalSelector.closest($(this))[0]||(dom.isBR(this)?this.parentNode:dom.node(this));var evt=document.createEvent("MouseEvents");evt.initMouseEvent("click",true,true,window,0,0,0,0,0,false,false,false,false,0,target);target.dispatchEvent(evt);return this;}});var BuildingBlock=Widget.extend({template:'web_editor.snippets',activeSnippets:[],init:function(parent,$editable){this.parent=parent;this.$editable=$editable;this._super.apply(this,arguments);if(!$('#oe_manipulators').length){$("<div id='oe_manipulators' class='o_css_editor'></div>").appendTo('body');}
this.$active_snipped_id=false;this.snippets=[];data.instance=this;},start:function(){var self=this;this.$snippet=$("#oe_snippets");this.$el.on("mouseenter",function(){self.show();}).on("mouseleave",function(event){if(event.clientX>0&&event.clientY>0)self.hide();});$(window).resize(function(){setTimeout('$(document).click()',0);});this.fetch_snippet_templates();this.bind_snippet_click_editor();$(document).on('click','.dropdown-submenu a[tabindex]',function(e){e.preventDefault();});var _isNotBreakable=$.summernote.core.dom.isNotBreakable;$.summernote.core.dom.isNotBreakable=function(node){return _isNotBreakable(node)||$(node).is('div')||globalSelector.is($(node));};$(window).on('resize',function(){if(self.$active_snipped_id&&self.$active_snipped_id.data("snippet-editor")){self.cover_target(self.$active_snipped_id.data("snippet-editor").$overlay,self.$active_snipped_id);}});$(document).on('mousemove',function(){if(self.$active_snipped_id&&self.$active_snipped_id.data("snippet-editor")){self.$active_snipped_id.data("snippet-editor").$overlay.removeClass('o_keypress');}});$(document).on('keydown',function(event){if(self.$active_snipped_id&&self.$active_snipped_id.data("snippet-editor")){self.$active_snipped_id.data("snippet-editor").$overlay.addClass('o_keypress');}
if((event.metaKey||(event.ctrlKey&&!event.altKey))&&event.shiftKey&&event.keyCode>=48&&event.keyCode<=57){self.$snippet.find('.scroll:first > ul li:eq('+(event.keyCode-49)+') a').trigger("click");self.show();event.preventDefault();}});},_get_snippet_url:function(){return'/web_editor/snippets';},_add_check_selector:function(selector,no_check,is_children){var self=this;var selector=selector.split(/\s*,/).join(":not(.o_snippet_not_selectable), ")+":not(.o_snippet_not_selectable)";if(no_check){return{closest:function($from,parentNode){return $from.closest(selector,parentNode);},all:function($from){return $from?$from.find(selector):$(selector);},is:function($from){return $from.is(selector);}};}else{var selector=selector.split(/\s*,/).join(":o_editable, ")+":o_editable";return{closest:function($from,parentNode){var parents=self.$editable.get();return $from.closest(selector,parentNode).filter(function(){var node=this;while(node.parentNode){if(parents.indexOf(node)!==-1){return true;}
node=node.parentNode;}
return false;});},all:is_children?function($from){return($from||self.$editable).find(selector);}:function($from){return $from?$from.find(selector):self.$editable.filter(selector).add(self.$editable.find(selector));},is:function($from){return $from.is(selector);}};}},fetch_snippet_templates:function(){var self=this;var url=this._get_snippet_url();if(!url||!url.length){this.$snippet.detach();return;}
this.$el.find("#o_left_bar").addClass("hidden");return ajax.jsonRpc(url,'call',{}).then(function(html){self.compute_snippet_templates(html);self.trigger("snippets:ready");},function(){self.$snippet.hide();console.warn('Snippets template not found:',url);});},compute_snippet_templates:function(html){var self=this;var $html=$(html);var $left_bar=this.$el.find("#o_left_bar");var $ul=$html.siblings("ul");var $scroll=$html.siblings("#o_scroll");if(!$scroll.length){throw new Error("Wrong snippets xml definition");}
$ul.children().tooltip({delay:{"show":500,"hide":100},container:'body',title:function(){return(navigator.appVersion.indexOf('Mac')>-1?'CMD':'CTRL')+'+SHIFT+'+($(this).index()+1);},trigger:'hover',placement:'top'}).on('click',function(){$(this).tooltip('hide');});$html.find('[data-oe-type="snippet"][data-oe-name]').each(function(){var $div=$('<div/>').insertAfter(this).append(this).attr('name',$(this).data('oe-name'));});self.templateOptions=[];var selector=[];var $styles=$html.find("[data-js], [data-selector]");$styles.each(function(){var $style=$(this);var no_check=$style.data('no-check');var option_id=$style.data('js');var option={'option':option_id,'base_selector':$style.data('selector'),'selector':self._add_check_selector($style.data('selector'),no_check),'$el':$style,'drop-near':$style.data('drop-near')&&self._add_check_selector($style.data('drop-near'),no_check,true),'drop-in':$style.data('drop-in')&&self._add_check_selector($style.data('drop-in'),no_check),'data':$style.data()};self.templateOptions.push(option);selector.push(option.selector);});$styles.addClass("hidden");globalSelector.closest=function($from){var $temp;var $target;var len=selector.length;for(var i=0;i<len;i++){$temp=selector[i].closest($from,$target&&$target[0]);if(!$target||$temp.length){$target=$temp;}}
return $target;};globalSelector.all=function($from){var $target;var len=selector.length;for(var i=0;i<len;i++){if(!$target)$target=selector[i].all($from);else $target=$target.add(selector[i].all($from));}
return $target;};globalSelector.is=function($from){var len=selector.length;for(var i=0;i<len;i++){if(selector[i].is($from)){return true;}}
return false;};var number=0;self.$snippets=$scroll.find(".o_panel_body").children().addClass("oe_snippet").each(function(){if(!$('.oe_snippet_thumbnail',this).size()){var $div=$('<div class="oe_snippet_thumbnail">'+'<div class="oe_snippet_thumbnail_img"/>'+'<span class="oe_snippet_thumbnail_title"></span>'+'</div>');$div.find('span').text($(this).attr("name"));$(this).prepend($div);var thumbnail=$("[data-oe-thumbnail]",this).data("oe-thumbnail");if(thumbnail){$div.find('.oe_snippet_thumbnail_img').css('background-image','url('+thumbnail+')');}}
if(!$(this).data("selector")){$("> *:not(.oe_snippet_thumbnail)",this).addClass('oe_snippet_body');}
number++;});if(!number){this.$snippet.detach();}else{this.$el.find("#o_left_bar").removeClass("hidden");}
$("body").toggleClass("editor_has_snippets",!!number);self.$snippets.find('.oe_snippet_body, .oe_snippet_body *').contents().filter(function(){return this.nodeType===3&&this.textContent.match(/\S/);}).parent().addClass("o_default_snippet_text");$(document).on("mouseup",".o_default_snippet_text",function(event){$(event.target).selectContent();});$(document).on("keyup",function(event){var r=$.summernote.core.range.create();$(r&&r.sc).closest(".o_default_snippet_text").removeClass("o_default_snippet_text");});$html.find('[data-oe-model], [data-oe-type]').each(function(){for(var k=0;k<this.attributes.length;k++){if(this.attributes[k].name.indexOf('data-oe-')===0){$(this).removeAttr(this.attributes[k].name);k--;}}});$html.find('.o_not_editable').attr("contentEditable",false);$left_bar.html($html);$left_bar.on('click','.scroll-link',function(event){event.preventDefault();var targetOffset=$($(this).attr("href")).position().top-$ul.outerHeight()+$scroll[0].scrollTop;$scroll.animate({'scrollTop':targetOffset},750);});$scroll.on('scroll',function(){var middle=$scroll.height()/4;var $li=$ul.find("a").parent().removeClass('active');var last;for(var k=0;k<$li.length;k++){var li=$($li[k]);if(!li.data('target')){li.data('target',$($("a",li).attr("href")));}
if(li.data('target').position().top>middle){break;}
last=$li[k];}
$(last).addClass("active");});$(window).on('resize',function(){$scroll.css("overflow","");var height=$left_bar.height()-$ul.outerHeight();$scroll.css("height",height);var $last=$scroll.children(":visible").last().children(".o_panel_body");$last.css({'min-height':(height-$last.prev().outerHeight())+'px'});if($scroll[0].scrollHeight+$ul[0].scrollHeight>document.body.clientHeight){$scroll.css("overflow","auto").css("width","226px");}else{$scroll.css("width","");}}).trigger('resize');self.make_snippet_draggable(self.$snippets);},cover_target:function($el,$target){if($el.data('not-cover_target'))return;var pos=$target.offset();var mt=parseInt($target.css("margin-top")||0);var mb=parseInt($target.css("margin-bottom")||0);var width=$target.outerWidth();var bigger=pos.left+width>$("body").outerWidth()-8;$el.css({'width':width,'top':pos.top-mt-5,'left':pos.left-1});$el.find(".oe_handle.e,.oe_handle.w").css({'height':$target.outerHeight()+mt+mb+1});if(bigger){$el.find(".oe_handle.e").css({right:0,margin:0}).find("div").css({right:0,left:'auto'});}else{$el.find(".oe_handle.e").css({right:"",margin:""}).find("div").css({right:"",left:""});}
$el.find(".oe_handle.s").css({'top':$target.outerHeight()+mt+mb});$el.find(".oe_handle.size").css({'top':$target.outerHeight()+mt});$el.find(".oe_handle.s,.oe_handle.n").css({'width':width-2});},show_blocks:function(){var self=this;var cache={};this.$snippet.find(".o_panel").each(function(){var catcheck=false;var $category=$(this);$category.find(".oe_snippet_body").each(function(){var $snippet=$(this);var check=false;for(var k in self.templateOptions){var option=self.templateOptions[k];if($snippet.is(option.base_selector)){cache[k]=cache[k]||{'drop-near':option['drop-near']?option['drop-near'].all():[],'drop-in':option['drop-in']?option['drop-in'].all():[]};if(cache[k]['drop-near'].length||cache[k]['drop-in'].length){catcheck=true;check=true;break;}}}
if(check){$snippet.closest(".oe_snippet").removeClass("disable");}else{$snippet.closest(".oe_snippet").addClass("disable");}});$('#oe_snippets .scroll a[data-toggle="tab"][href="#'+$category.attr("id")+'"]').toggle(catcheck);});},show:function(){var self=this;this.make_active(false);this.$el.addClass("o_open");this.show_blocks();},hide:function(){this.$el.removeClass("o_open");},bind_snippet_click_editor:function(){var self=this;var snipped_event_flag;$(document).on('click','*',function(event){var srcElement=event.srcElement||(event.originalEvent&&(event.originalEvent.originalTarget||event.originalEvent.target)||event.target);if(self.editor_busy||snipped_event_flag===srcElement||!srcElement){return;}
snipped_event_flag=srcElement;setTimeout(function(){snipped_event_flag=false;},0);var $target=$(srcElement);if($target.closest(".oe_overlay, .note-popover").length){return;}
if(!globalSelector.is($target)){$target=globalSelector.closest($target);}
if(self.$active_snipped_id&&self.$active_snipped_id.is($target)){return;}
self.make_active($target);});},snippet_blur:function($snippet){if($snippet){if($snippet.data("snippet-editor")){$snippet.data("snippet-editor").on_blur();}}},snippet_focus:function($snippet){if($snippet){if($snippet.data("snippet-editor")){$snippet.data("snippet-editor").on_focus();}}},clean_for_save:function(){var self=this;var opt=options.registry;var template=self.templateOptions;for(var k in template){var Option=opt[template[k]['option']];if(Option&&Option.prototype.clean_for_save!==dummy){template[k].selector.all().filter(function(){var node=this;while(!/o_dirty|o_editable/.test(node.className)&&node!==document){node=node.parentNode;}
return node.className.indexOf("o_dirty")!==-1;}).each(function(){new Option(self,null,$(this),k).clean_for_save();});}}
this.$editable.find("*[contentEditable], *[attributeEditable]").removeAttr('contentEditable').removeProp('contentEditable').removeAttr('attributeEditable').removeProp('attributeEditable');},make_active:function($snippet){if($snippet&&this.$active_snipped_id&&this.$active_snipped_id.get(0)===$snippet.get(0)){return;}
if(this.$active_snipped_id){this.snippet_blur(this.$active_snipped_id);this.$active_snipped_id=false;}
if($snippet&&$snippet.length){if(_.indexOf(this.snippets,$snippet.get(0))===-1){this.snippets.push($snippet.get(0));}
this.$active_snipped_id=$snippet;this.create_snippet_editor(this.$active_snipped_id);this.cover_target($snippet.data('overlay'),$snippet);this.snippet_focus($snippet);}
this.$snippet.trigger('snippet-activated',$snippet);if($snippet){$snippet.trigger('snippet-activated',$snippet);}},create_snippet_editor:function($snippet){if(typeof $snippet.data("snippet-editor")==='undefined'){if(!this.activate_overlay_zones($snippet).length)return;$snippet.data("snippet-editor",new Editor(this,$snippet));}},make_snippet_draggable:function($snippets){var self=this;var $tumb=$snippets.find(".oe_snippet_thumbnail_img:first");var left=$tumb.outerWidth()/2;var top=$tumb.outerHeight()/2;var $toInsert,dropped,$snippet,action,snipped_id;$snippets.draggable({greedy:true,helper:'clone',zIndex:'1000',appendTo:'body',cursor:"move",handle:".oe_snippet_thumbnail",cursorAt:{'left':left,'top':top},start:function(){self.hide();dropped=false;$snippet=$(this);var $base_body=$snippet.find('.oe_snippet_body');var $selector_siblings=$();var $selector_children=$();var vertical=false;var temp=self.templateOptions;for(var k in temp){if($base_body.is(temp[k].base_selector)){if(temp[k]['drop-near']){if(!$selector_siblings)$selector_siblings=temp[k]['drop-near'].all();else $selector_siblings=$selector_siblings.add(temp[k]['drop-near'].all());}
if(temp[k]['drop-in']){if(!$selector_children)$selector_children=temp[k]['drop-in'].all();else $selector_children=$selector_children.add(temp[k]['drop-in'].all());}}}
$toInsert=$base_body.clone();if(!$selector_siblings.length&&!$selector_children.length){console.debug($snippet.find(".oe_snippet_thumbnail_title").text()+" have not insert action: data-drop-near or data-drop-in");return;}
self.activate_insertion_zones($selector_siblings,$selector_children);$('.oe_drop_zone').droppable({over:function(){dropped=true;$(this).first().after($toInsert);},out:function(){var prev=$toInsert.prev();if(this===prev[0]){dropped=false;$toInsert.detach();}}});},stop:function(ev,ui){$toInsert.removeClass('oe_snippet_body');if(!dropped&&self.$editable.find('.oe_drop_zone')&&ui.position.top>3){var el=self.$editable.find('.oe_drop_zone').nearest({x:ui.position.left,y:ui.position.top}).first();if(el.length){el.after($toInsert);dropped=true;}}
self.$editable.find('.oe_drop_zone').droppable('destroy').remove();if(dropped){var prev=$toInsert.first()[0].previousSibling;var next=$toInsert.last()[0].nextSibling;var rte=self.parent.rte;if(prev){$toInsert.detach();rte.historyRecordUndo($(prev));$toInsert.insertAfter(prev);}else if(next){$toInsert.detach();rte.historyRecordUndo($(next));$toInsert.insertBefore(next);}else{var $parent=$toInsert.parent();$toInsert.detach();rte.historyRecordUndo($parent);$parent.prepend($toInsert);}
$toInsert.closest(".o_editable").trigger("content_changed");var $target=false;$target=$toInsert;setTimeout(function(){self.$snippet.trigger('snippet-dropped',$target);animation.start(true,$target);self.call_for_all_snippets($target,function(editor,$snippet){editor.drop_and_build_snippet();});self.create_snippet_editor($target);self.cover_target($target.data('overlay'),$target);$target.closest(".o_editable").trigger("content_changed");self.make_active($target);},0);}else{$toInsert.remove();}},});},call_for_all_snippets:function($snippet,callback){var self=this;$snippet.add(globalSelector.all($snippet)).each(function(){var $snippet=$(this);setTimeout(function(){self.create_snippet_editor($snippet);if($snippet.data("snippet-editor")){callback.call(self,$snippet.data("snippet-editor"),$snippet);}});});},get_snippet_from_id:function(id){return $('.oe_snippet').filter(function(){return $(this).data('option')===id;}).first();},activate_insertion_zones:function($selector_siblings,$selector_children){var self=this;var zone_template=$("<div class='oe_drop_zone oe_insert'></div>");if($selector_children){$selector_children.each(function(){var $zone=$(this);var css=window.getComputedStyle(this);var float=css.float||css.cssFloat;var $drop=zone_template.clone();$zone.append($drop);var node=$drop[0].previousSibling;var test=!!(node&&((!node.tagName&&node.textContent.match(/\S/))||node.tagName==="BR"));if(test){$drop.addClass("oe_vertical oe_vertical_text").css({'height':parseInt(window.getComputedStyle($zone[0]).lineHeight),'float':'none','display':'inline-block'});}else if(float==="left"||float==="right"){$drop.addClass("oe_vertical").css('height',Math.max(Math.min($zone.outerHeight(),$zone.children().last().outerHeight()),30));}
$drop=$drop.clone();$zone.prepend($drop);var node=$drop[0].nextSibling;var test=!!(node&&((!node.tagName&&node.textContent.match(/\S/))||node.tagName==="BR"));if(test){$drop.addClass("oe_vertical oe_vertical_text").css({'height':parseInt(window.getComputedStyle($zone[0]).lineHeight),'float':'none','display':'inline-block'});}else if(float==="left"||float==="right"){$drop.addClass("oe_vertical").css('height',Math.max(Math.min($zone.outerHeight(),$zone.children().first().outerHeight()),30));}
if(test){$drop.css({'float':'none','display':'inline-block'});}});$selector_siblings=$(_.uniq(($selector_siblings||$()).add($selector_children.children()).get()));}
if($selector_siblings){$selector_siblings.filter(':not(.oe_drop_zone):not(.oe_drop_clone)').each(function(){var $zone=$(this);var $drop;var css=window.getComputedStyle(this);var float=css.float||css.cssFloat;if($zone.prev('.oe_drop_zone:visible').length===0){$drop=zone_template.clone();if(float==="left"||float==="right"){$drop.addClass("oe_vertical").css('height',Math.max(Math.min($zone.outerHeight(),$zone.prev().outerHeight()||Infinity),30));}
$zone.before($drop);}
if($zone.next('.oe_drop_zone:visible').length===0){$drop=zone_template.clone();if(float==="left"||float==="right"){$drop.addClass("oe_vertical").css('height',Math.max(Math.min($zone.outerHeight(),$zone.next().outerHeight()||Infinity),30));}
$zone.after($drop);}});}
var count;do{count=0;$zones=self.$editable.find('.oe_drop_zone > .oe_drop_zone').remove();count+=$zones.length;$zones.remove();}while(count>0);var $zones=self.$editable.find('.oe_drop_zone:not(.oe_vertical)');$zones.each(function(){var zone=$(this);var prev=zone.prev();var next=zone.next();if(prev.is('.oe_drop_zone')||next.is('.oe_drop_zone')){zone.remove();return;}
var float_prev=prev.css('float')||'none';var float_next=next.css('float')||'none';var disp_prev=prev.css('display')||null;var disp_next=next.css('display')||null;if((float_prev==='left'||float_prev==='right')&&(float_next==='left'||float_next==='right')){zone.remove();}else if(!(disp_prev===null||disp_next===null||disp_prev==='block'||disp_next==='block')){zone.remove();}});},activate_overlay_zones:function($targets){var self=this;function is_visible($el){return $el.css('display')!='none'&&$el.css('opacity')!='0'&&$el.css('visibility')!='hidden';}
$targets=$targets.filter(function(){return is_visible($(this));});$targets=$targets.filter(function(){var parents=$(this).parents().filter(function(){return!is_visible($(this));});return parents.length===0;});$targets.each(function(){var $target=$(this);if(!$target.data('overlay')){var $zone=$(qweb.render('web_editor.snippet_overlay'));if(document.body&&document.body.addEventListener){$zone.on("click mousedown mousedown",function passThrough(event){event.preventDefault();$target.each(function(){event.srcElement=this;$(this).trigger(event.type);});return false;});}
$zone.appendTo('#oe_manipulators');$zone.data('target',$target);$target.data('overlay',$zone);var timer;$target.closest('.o_editable').on("content_changed",function(event){clearTimeout(timer);timer=setTimeout(function(){if($target.data('overlay')&&$target.data('overlay').hasClass("oe_active")){self.cover_target($target.data('overlay'),$target);}},50);});var resize=function(){if($zone.parent().length){self.cover_target($zone,$target);}else{$('body').off("resize",resize);}};$('body').on("resize",resize);}
self.cover_target($target.data('overlay'),$target);});return $targets;}});var Editor=Class.extend({init:function(BuildingBlock,dom){this.buildingBlock=BuildingBlock;this.$target=$(dom);this.$overlay=this.$target.data('overlay');this.load_style_options();this.get_parent_block();this.start();},_drag_and_drop:function(){var self=this;this.dropped=false;this.$overlay.draggable({greedy:true,appendTo:'body',cursor:"move",handle:".oe_snippet_move",cursorAt:{left:18,top:14},helper:function(){var $clone=$(this).clone().css({width:"24px",height:"24px",border:0});$clone.find(".oe_overlay_options >:not(:contains(.oe_snippet_move)), .oe_handle").remove();$clone.find(":not(.glyphicon)").css({position:'absolute',top:0,left:0});$clone.appendTo("body").removeClass("hidden");return $clone;},start:_.bind(self._drag_and_drop_start,self),stop:_.bind(self._drag_and_drop_stop,self)});},_drag_and_drop_after_insert_dropzone:function(){},_drag_and_drop_active_drop_zone:function($zones){var self=this;$zones.droppable({over:function(){$(".oe_drop_zone.hide").removeClass("hide");$(this).addClass("hide").first().after(self.$target);self.dropped=true;},out:function(){$(this).removeClass("hide");self.$target.detach();self.dropped=false;},});},_drag_and_drop_start:function(){var self=this;self.buildingBlock.hide();self.buildingBlock.editor_busy=true;self.size={width:self.$target.width(),height:self.$target.height()};self.$target.after("<div class='oe_drop_clone' style='display: none;'/>");self.$target.detach();self.$overlay.addClass("hidden");var $selector_siblings;for(var i=0;i<self.selector_siblings.length;i++){if(!$selector_siblings)$selector_siblings=self.selector_siblings[i].all();else $selector_siblings=$selector_siblings.add(self.selector_siblings[i].all());}
var $selector_children;for(var i=0;i<self.selector_children.length;i++){if(!$selector_children)$selector_children=self.selector_children[i].all();else $selector_children=$selector_children.add(self.selector_children[i].all());}
self.buildingBlock.activate_insertion_zones($selector_siblings,$selector_children);$("body").addClass('move-important');self._drag_and_drop_after_insert_dropzone();self._drag_and_drop_active_drop_zone($('.oe_drop_zone'));},_drag_and_drop_stop:function(){var self=this;var $dropzone=this.$target.prev();var prev=$dropzone.length&&$dropzone[0].previousSibling;var next=this.$target.last()[0].nextSibling;var $parent=this.$target.parent();$(".oe_drop_clone").after(this.$target);this.$overlay.removeClass("hidden");$("body").removeClass('move-important');$('.oe_drop_zone').droppable('destroy').remove();$(".oe_drop_clone, .oe_drop_to_remove").remove();if(this.dropped){this.buildingBlock.parent.rte.historyRecordUndo(this.$target);if(prev){this.$target.insertAfter(prev);}else if(next){this.$target.insertBefore(next);}else{$parent.prepend(this.$target);}
for(var i in this.styles){this.styles[i].on_move();}}
self.buildingBlock.editor_busy=false;self.get_parent_block();setTimeout(function(){self.buildingBlock.cover_target(self.$target.data('overlay'),self.$target);},0);},load_style_options:function(){var self=this;var $styles=this.$overlay.find('.oe_options');var $ul=$styles.find('ul:first');this.styles={};this.selector_siblings=[];this.selector_children=[];_.each(this.buildingBlock.templateOptions,function(val,option_id){if(!val.selector.is(self.$target)){return;}
if(val['drop-near'])self.selector_siblings.push(val['drop-near']);if(val['drop-in'])self.selector_children.push(val['drop-in']);var option=val['option'];var Editor=options.registry[option]||options.Class;var editor=self.styles[option]=new Editor(self.buildingBlock,self,self.$target,option_id);$ul.append(editor.$el.addClass("snippet-option-"+option));editor.start();});if(!this.selector_siblings.length&&!this.selector_children.length){this.$overlay.find(".oe_snippet_move, .oe_snippet_clone, .oe_snippet_remove").addClass('hidden');}
if($ul.find("li").length){$styles.removeClass("hidden");}
this.$overlay.find('[data-toggle="dropdown"]').dropdown();},get_parent_block:function(){var self=this;var $button=this.$overlay.find('.oe_snippet_parent');var $parent=this.$target.parents().filter(function(){return $(this).data("snippet-editor");});if(!$parent.length){$parent=globalSelector.closest(this.$target.parent());}
if($parent.length){$button.removeClass("hidden");$button.off("click").on('click',function(event){event.preventDefault();setTimeout(function(){self.buildingBlock.make_active($parent);},0);});}else{$button.addClass("hidden");}},start:function(){var self=this;if(!this.$target.parent().is(':o_editable')){this.$overlay.find('.oe_snippet_move, .oe_snippet_clone, .oe_snippet_remove').remove();}else{this.$overlay.on('click','.oe_snippet_clone',_.bind(this.on_clone,this));this.$overlay.on('click','.oe_snippet_remove',_.bind(this.on_remove,this));this._drag_and_drop();}},on_clone:function(event){event.preventDefault();var $clone=this.$target.clone(false);this.buildingBlock.parent.rte.historyRecordUndo(this.$target);this.$target.after($clone);this.buildingBlock.call_for_all_snippets($clone,function(editor,$snippet){for(var i in editor.styles){editor.styles[i].on_clone($snippet);}});return false;},on_remove:function(event){event.preventDefault();this.on_blur();this.buildingBlock.parent.rte.historyRecordUndo(this.$target);var index=_.indexOf(this.buildingBlock.snippets,this.$target.get(0));this.buildingBlock.call_for_all_snippets(this.$target,function(editor,$snippet){for(var i in editor.styles){editor.styles[i].on_remove();}});delete this.buildingBlock.snippets[index];var $editable=this.$target.closest(".o_editable");var node=this.$target.parent()[0];this.$target.remove();this.$overlay.remove();if(node&&node.firstChild){$.summernote.core.dom.removeSpace(node,node.firstChild,0,node.lastChild,1);if(!node.firstChild.tagName&&node.firstChild.textContent===" "){node.firstChild.parentNode.removeChild(node.firstChild);}}
$(".note-control-selection").hide();$('.o_table_handler').remove();return false;},drop_and_build_snippet:function(){for(var i in this.styles){this.styles[i].drop_and_build_snippet();}},on_focus:function(){this.$overlay.addClass('oe_active');for(var i in this.styles){this.styles[i].on_focus();}},on_blur:function(){for(var i in this.styles){this.styles[i].on_blur();}
this.$overlay.removeClass('oe_active');},});var data={Class:BuildingBlock,Editor:Editor,globalSelector:globalSelector,};return data;});;

/* /web_editor/static/src/js/snippets.options.js defined in bundle 'web.assets_backend' */
odoo.define('web_editor.snippets.options',function(require){'use strict';var Class=require('web.Class');var ajax=require('web.ajax');var core=require('web.core');var base=require('web_editor.base');var editor=require('web_editor.editor');var widget=require('web_editor.widget');var animation=require('web_editor.snippets.animation');var qweb=core.qweb;var Option=Class.extend({init:function(BuildingBlock,editor,$target,option_id){this.buildingBlock=BuildingBlock;this.editor=editor;this.$target=$target;var option=this.buildingBlock.templateOptions[option_id];var styles=this.$target.data("snippet-option-ids")||{};styles[option_id]=this;this.$target.data("snippet-option-ids",styles);this.$overlay=this.$target.data('overlay')||$('<div>');this.option=option_id;this.$el=option.$el.find(">li").clone();this.data=option.$el.data();},$:function(selector){return this.$target(selector);},_bind_li_menu:function(){this.$el.filter("li:hasData").find('a:first').off('mouseenter click').on('mouseenter click',_.bind(this._mouse,this));this.$el.off('mouseenter click',"li:hasData a").on('mouseenter click',"li:hasData a",_.bind(this._mouse,this));this.$el.closest("ul").add(this.$el).off('mouseleave').on('mouseleave',_.bind(this.reset,this));this.$el.off('mouseleave',"ul").on('mouseleave',"ul",_.bind(this.reset,this));this.reset_methods=[];},_time_mouseleave:null,_mouse:function(event){var $next=$(event.currentTarget).parent();this.select(event.type==="click"?"click":"over",$next);if(event.type==='click'){this.set_active();this.$target.trigger("snippet-option-change",[this]);}else{this.$target.trigger("snippet-option-preview",[this]);}},set_active:function(){var classes=_.uniq((this.$target.attr("class")||'').split(/\s+/));this.$el.find('[data-toggle_class], [data-select_class]').add(this.$el).filter('[data-toggle_class], [data-select_class]').removeClass("active").filter('[data-toggle_class="'+classes.join('"], [data-toggle_class="')+'"] ,'+'[data-select_class="'+classes.join('"], [data-select_class="')+'"]').addClass("active");},start:function(){this.set_active();this.$target.on('snippet-option-reset',_.bind(this.set_active,this));this._bind_li_menu();},on_focus:function(){this._bind_li_menu();},on_blur:function(){},on_clone:function($clone){},on_move:function(){},on_remove:function(){},drop_and_build_snippet:function(){},reset:function(){var self=this;var lis=self.$el.add(self.$el.find('li')).filter('.active').get();lis.reverse();_.each(lis,function(li){var $li=$(li);for(var k in self.reset_methods){var method=self.reset_methods[k];if($li.is('[data-'+method+']')||$li.closest('[data-'+method+']').size()){delete self.reset_methods[k];}}
self.select("reset",$li);});for(var k in self.reset_methods){var method=self.reset_methods[k];if(method){self[method]("reset",null);}}
self.reset_methods=[];self.$target.trigger("snippet-option-reset",[this]);},select:function(type,$li){var self=this,$methods=[],el=$li[0];if($li.data('only')&&type!==$li.data('only')){return;}
if(type==="click"){this.reset();this.buildingBlock.parent.rte.historyRecordUndo(this.$target);}
function filter(k){return k!=='oeId'&&k!=='oeModel'&&k!=='oeField'&&k!=='oeXpath'&&k!=='oeSourceId'&&k!=='only';}
function hasData(el){for(var k in el.dataset){if(filter(k)){return true;}}
return false;}
function method(el){var data={};for(var k in el.dataset){if(filter(k)){data[k]=el.dataset[k];}}
return data;}
while(el&&this.$el.is(el)||_.some(this.$el.map(function(){return $.contains(this,el);}).get())){if(hasData(el)){$methods.push(el);}
el=el.parentNode;}
$methods.reverse();_.each($methods,function(el){var $el=$(el);var methods=method(el);for(var k in methods){if(self[k]){if(type!=="reset"&&self.reset_methods.indexOf(k)===-1){self.reset_methods.push(k);}
self[k](type,methods[k],$el);}else{console.error("'"+self.option+"' snippet have not method '"+k+"'");}}});},toggle_class:function(type,value,$li){var $lis=this.$el.find('[data-toggle_class]').add(this.$el).filter('[data-toggle_class]');function map($lis){return $lis.map(function(){return $(this).data("toggle_class");}).get().join(" ");}
var classes=map($lis);var active_classes=map($lis.filter('.active, :has(.active)'));this.$target.removeClass(classes);this.$target.addClass(active_classes);if(type!=='reset'){this.$target.toggleClass(value);}},select_class:function(type,value,$li){var $lis=this.$el.find('[data-select_class]').add(this.$el).filter('[data-select_class]');var classes=$lis.map(function(){return $(this).data('select_class');}).get();this.$target.removeClass(classes.join(" "));if(value)this.$target.addClass(value);},eval:function(type,value,$li){var fn=new Function("node","type","value","$li",value);fn.call(this,this,type,value,$li);},clean_for_save:editor.dummy});var media=Option.extend({start:function(){var self=this;this._super();animation.start(true,this.$target);this.$target.closest(".o_editable").on("content_changed",function(){if(!self.$target.parent().length){self.$target.remove();self.$overlay.remove();}});},edition:function(type,value){if(type!=="click")return;var self=this;var _editor=new widget.MediaDialog(this.$target.closest('.o_editable'),this.$target[0]);_editor.appendTo(document.body);_editor.on('saved',this,function(item,old){self.editor.on_blur();self.buildingBlock.make_active(false);if(self.$target.parent().data("oe-field")!=="image"){setTimeout(function(){self.buildingBlock.make_active($(item));},0);}
$(item).trigger("content_changed");});},on_focus:function(){var self=this;var $parent=this.$target.parent();if($parent.data("oe-field")==="image"&&$parent.hasClass('o_editable')){this.$overlay.addClass("hidden");self.edition('click',null);self.buildingBlock.make_active(false);}}});var colorpicker=Option.extend({start:function(){var self=this;var res=this._super();if(!this.$el.find('.colorpicker').length){this.$el.find('li').append(qweb.render('web_editor.colorpicker'));}
if(this.$el.data('area')){this.$target=this.$target.find(this.$el.data('area'));this.$el.removeData('area').removeAttr('area');}
var classes=[];this.$el.find(".colorpicker button").map(function(){var $color=$(this);var color=$color.attr("class");if(self.$target.hasClass(color)){self.color=color;$color.parent().addClass("selected");}
classes.push(color);});this.classes=classes.join(" ");this.bind_events();return res;},bind_events:function(){var self=this;var $td=this.$el.find(".colorpicker td");var $colors=this.$el.find(".colorpicker button");$colors.mouseenter(function(){self.$target.removeClass(self.classes).addClass($(this).attr("class"));}).mouseleave(function(){self.$target.removeClass(self.classes).addClass($td.filter(".selected").children().attr("class"));}).click(function(){$td.removeClass("selected");$(this).parent().addClass("selected");self.$target.closest(".o_editable").trigger("content_changed");});}});var background=Option.extend({start:function($change_target){this.$target=$change_target||this.$target;this._super();var src=this.$target.css("background-image").replace(/url\(['"]*|['"]*\)|^none$/g,"");if(this.$target.hasClass('oe_custom_bg')){this.$el.find('li[data-choose_image]').data("background",src).attr("data-background",src);}},background:function(type,value,$li){if(value&&value.length){this.$target.attr("style",'background-image: url('+value+'); '+(this.$target.attr("style")||'').replace(/background-image:[^;]+/,''));this.$target.addClass("oe_img_bg");}else{this.$target.css("background-image","");this.$target.removeClass("oe_img_bg").removeClass("oe_custom_bg");}},select_class:function(type,value,$li){this.background(type,'',$li);this._super(type,value,$li);},choose_image:function(type,value,$li){if(type!=="click")return;var self=this;var $image=$('<img class="hidden"/>');$image.attr("src",value);$image.appendTo(self.$target);var _editor=new widget.MediaDialog(null,$image[0]);_editor.appendTo(document.body);_editor.$('[href="#editor-media-video"], [href="#editor-media-icon"]').addClass('hidden');_editor.on('saved',self,function(){var value=$image.attr("src");$image.remove();self.$el.find('li[data-choose_image]').data("background",value).attr("data-background",value);self.background(type,value,$li);self.$target.addClass('oe_custom_bg');self.$target.trigger("snippet-option-change",[self]);self.set_active();});_editor.on('cancel',self,function(){$image.remove();});},set_active:function(){var self=this;var src=this.$target.css("background-image").replace(/url\(['"]*|['"]*\)|^none$/g,"");this._super();if(this.$target.hasClass('oe_custom_bg')){this.$el.find('li[data-choose_image]').data("background",src).attr("data-background",src);}
this.$el.find('li[data-background]:not([data-background=""])').removeClass("active").each(function(){var background=$(this).data("background")||$(this).attr("data-background");if((src.length&&background.length&&src.indexOf(background)!==-1)||(!src.length&&!background.length)){$(this).addClass("active");}});if(!this.$el.find('li[data-background].active').size()){this.$el.find('li[data-background=""]:not([data-choose_image])').addClass("active");}else{this.$el.find('li[data-background=""]:not([data-choose_image])').removeClass("active");}}});var many2one=Option.extend({start:function(){var self=this;this.Model=this.$target.data('oe-many2one-model');this.ID=+this.$target.data('oe-many2one-id');this.$btn=$(qweb.render("web_editor.many2one.button")).insertAfter(this.$overlay.find('.oe_options'));this.$ul=this.$btn.find("ul");this.$search=this.$ul.find('li:first');this.$search.find('input').on('mousedown click mouseup keyup keydown',function(e){e.stopPropagation();});setTimeout(function(){if(self.$overlay.find('.oe_options').hasClass('hidden')){self.$btn.css('height','0').find('> a').addClass('hidden');self.$ul.show().css({'top':'-24px','margin':'0','padding':'2px 0','position':'relative'});}else{self.$btn.find('a').on('click',function(e){self.clear();});}},0);this.$search.find('input').focus().on('keyup',function(e){self.find_existing($(this).val());});this.$ul.on('click',"li:not(:first) a",function(e){self.select_record(this);});},on_focus:function(){this.$target.attr('contentEditable','false');this.clear();this._super();},clear:function(){var self=this;this.$search.siblings().remove();self.$search.find('input').val("");setTimeout(function(){self.$search.find('input').focus();},0);},find_existing:function(name){var self=this;var domain=[];if(!name||!name.length){self.$search.siblings().remove();return;}
if(isNaN(+name)){if(this.Model!=="res.partner"){domain.push(['name','ilike',name]);}else{domain.push('|',['name','ilike',name],['email','ilike',name]);}}else{domain.push(['id','=',name]);}
ajax.jsonRpc('/web/dataset/call_kw','call',{model:this.Model,method:'search_read',args:[domain,this.Model==="res.partner"?['name','display_name','city','country_id']:['name','display_name']],kwargs:{order:'name DESC',limit:5,context:base.get_context(),}}).then(function(result){self.$search.siblings().remove();self.$search.after(qweb.render("web_editor.many2one.search",{contacts:result}));});},get_contact_rendering:function(options){return ajax.jsonRpc('/web/dataset/call_kw','call',{model:'ir.qweb.field.contact',method:'get_record_to_html',args:[[this.ID]],kwargs:{options:options,context:base.get_context(),}});},select_record:function(li){var self=this;this.ID=+$(li).data("id");this.$target.attr('data-oe-many2one-id',this.ID).data('oe-many2one-id',this.ID);this.buildingBlock.parent.rte.historyRecordUndo(this.$target);this.$target.trigger('content_changed');if(self.$target.data('oe-type')==="contact"){$('[data-oe-contact-options]').filter('[data-oe-model="'+self.$target.data('oe-model')+'"]').filter('[data-oe-id="'+self.$target.data('oe-id')+'"]').filter('[data-oe-field="'+self.$target.data('oe-field')+'"]').filter('[data-oe-contact-options!="'+self.$target.data('oe-contact-options')+'"]').add(self.$target).attr('data-oe-many2one-id',self.ID).data('oe-many2one-id',self.ID).each(function(){var $node=$(this);self.get_contact_rendering($node.data('oe-contact-options')).then(function(html){$node.html(html);});});}else{self.$target.html($(li).data("name"));}
setTimeout(function(){self.buildingBlock.make_active(false);},0);}});return{'registry':{'media':media,'colorpicker':colorpicker,'background':background,'many2one':many2one,},'Class':Option};});;

/* /web_editor/static/src/js/tour.rte.js defined in bundle 'web.assets_backend' */
odoo.define('web_editor.tour',function(require){'use strict';var core=require('web.core');var Tour=require('web.Tour');var base=require('web_editor.base');var snippet_editor=require('web_editor.snippet.editor');var _t=core._t;base.ready().done(function(){var click_event=function(el,type){var evt=document.createEvent("MouseEvents");evt.initMouseEvent(type,true,true,window,0,0,0,0,0,false,false,false,false,0,el);el.dispatchEvent(evt);};Tour.register({id:'rte',name:"Test RTE",mode:'test',path:'/web_editor/field/html?debug&callback=FieldTextHtml_0&enable_editor=1&datarecord=%7B%7D',steps:[{title:"Change html for this test",onload:function(){var html='\n'+'<section>\n'+'    <div class="container">\n'+'        <div class="row">\n'+'            <div class="col-md-6 mt16">\n'+'<h1 id="text_title_id">Batnae municipium in Anthemusia</h1>     \n'+'     <p>Batnae municipium in Anthemusia conditum Macedonum manu priscorum ab Euphrate flumine brevi spatio disparatur, refertum mercatoribus opulentis, ubi annua sollemnitate prope Septembris initium mensis ad.</p>\n'+'     <p>    Quam <img style="width: 25%" src="/web_editor/static/src/img/drag_here.png"/> quidem <span class="fa fa-flag fa-2x"></span> partem accusationis admiratus sum et moleste tuli potissimum esse Atratino datam. Neque enim decebat neque aetas.</p>\n'+'     <p>Et hanc quidem praeter oppida multa duae civitates exornant Seleucia opus Seleuci regis, et Claudiopolis quam deduxit coloniam Claudius Caesar. Isaura enim antehac nimium potens, olim subversa ut rebellatrix.</p>'+'<p>Harum trium sententiarum nulli prorsus assentior.</p>\n'+'        </div>\n'+'        <div class="col-md-6 mt16">\n'+'            <img class="img img-responsive shadow mb16" src="/web_editor/static/src/img/drag_here.png" alt="Odoo text and image block">\n'+'        </div>\n'+'    </div>\n'+'</section>\n';$("#editable_area").html(html);}},{element:'#editable_area > section .row > div:first',title:"simulate triple click and change text bg-color",onload:function(){var $el=$(this.element);var $h1=$('h1',$el);$.summernote.core.range.create($h1[0].firstChild,0,$('p',$el)[0],0).select();click_event($h1[0],'mouseup');}},{waitFor:'#editable_area > section .row > div:first',element:'.note-popover button[data-event="color"]:visible',title:"change text bg-color after triple click",},{waitFor:'#editable_area > section .row > div:first:not(:has(p font)) h1 font',element:'.note-color button.dropdown-toggle:visible',title:"change selection to change text color",onload:function(){var $el=$('#editable_area > section .row > div:first:not(:has(p font)) h1 font');$.summernote.core.range.create($el[0].firstChild,5,$el[0].firstChild,10).select();click_event($el[0],'mouseup');}},{element:'div[data-target-event="foreColor"]:visible .note-color-row:eq(1) button[data-event="foreColor"]:first',title:"change text color",},{waitFor:'#editable_area > section .row > div:first h1 font:eq(2)',element:'.note-color button.dropdown-toggle:visible',title:"change selection to change text bg-color again",onload:function(){var $el=$('#editable_area > section .row > div:first h1 font:eq(2)');$.summernote.core.range.create($el.prev()[0].firstChild,3,$el[0].firstChild,10).select();click_event($el.prev()[0],'mouseup');}},{element:'div[data-target-event="backColor"] .colorpicker button[data-event="backColor"]:first',title:"change text backColor again",},{waitFor:'#editable_area > section .row > div:first h1 font:eq(4)',element:'.note-color button.dropdown-toggle:visible',title:"change selection (h1 and p) to change text color with class",onload:function(){var $el=$('#editable_area > section .row > div:first h1 font:eq(4)');$.summernote.core.range.create($el.prev()[0].firstChild,3,$el.parent("h1").next("p")[0].firstChild,30).select();click_event($el.prev()[0],'mouseup');}},{element:'div[data-target-event="foreColor"]:visible button[data-event="foreColor"][data-value^="text-"]:first',title:"change text foreColor again",},{waitFor:'#editable_area > section .row > div:first p font',element:'.o_editable.note-editable.o_dirty',title:"delete selection",keydown:46},{waitFor:'#editable_area > section .row > div:first:not(:has(p font)) h1',element:'.o_editable.note-editable.o_dirty',title:"clean and delete (backspace) an other selection",onload:function(){var $el=$(this.waitFor);$.summernote.core.range.createFromNode($el.next("p")[0]).clean();$.summernote.core.range.create($el.find('font:containsExact(ici)')[0].firstChild,1,$el.next().next()[0].firstChild,5).select();click_event($el.find('font:last')[0],'mouseup');},keydown:8},{waitFor:'#editable_area > section .row > div:first:has( font:last:containsExact(i) ):has( p:first:containsRegex(/^uam/) ) h1',element:'.o_editable.note-editable.o_dirty',title:"delete an other selection",onload:function(){var $el=$(this.waitFor);$.summernote.core.range.create($el.find('font:first')[0].firstChild,3,$el.next("p")[0].childNodes[2],8).select();click_event($el.find('font:first')[0],'mouseup');},keydown:46},{waitFor:'#editable_area > section .row > div:first:has( font:last:containsExact(Bat) )',element:'.note-image-popover button[data-event="undo"]',title:"undo",},{waitFor:'#editable_area > section .row > div:first:has( font:last:containsExact(i) )',element:'.note-air-popover button[data-event="undo"]',title:"undo again",},{waitFor:'#editable_area > section .row > div:first:not(:has(p font)) h1',element:'.o_editable.note-editable.o_dirty',title:"delete (backspace) after undo",keydown:8},{waitFor:'#editable_area > section .row > div:first:has( font:last:containsExact(i) ):has( p:first:containsRegex(/^uam/) )',element:'#editable_area > section .row > div:first img[style*="25%"]',title:"click on image",},{element:'.note-image-popover:visible button[data-event="resize"][data-value="0.5"]',title:"Click on resize half",},{waitFor:'#editable_area > section .row > div:first img[style*="50%"]',element:'.note-image-popover:visible button[data-event="showImageDialog"]',title:"Click on edit picture",},{waitFor:'.modal #editor-media-image',element:'.modal a[data-toggle="tab"]:contains(Pictogram)',title:"Click on pictogram tab",},{element:'#editor-media-icon.active span.fa:first',title:"select a pictogram",},{waitFor:'#editor-media-icon.active span.font-icons-selected',element:'.modal button.save',title:"save pictogram",},{element:'.note-image-popover button[data-event="resizefa"][data-value="3"]',title:"select a size for the pictogram",},{waitFor:'#wrapwrap span.fa-3x',element:'.note-image-popover:visible button[data-event="floatMe"][data-value="right"]',title:"click on float right",},{waitFor:'#editable_area > section .row > div:first span.fa.pull-right',element:'.note-image-popover:visible button[data-event="showLinkDialog"]',title:"click on create link",},{waitFor:'.modal a#link-preview:containsRegex(/^<span [^>]+><\\/span>$/) > span.fa.fa-3x.pull-right',element:'.modal .dropdown:has(.link-style) a[data-toggle="dropdown"]',title:"click on color style",},{element:'.modal .dropdown ul label.btn-success',title:"choose success style",},{element:'#link-text',title:"change text label",sampleText:"ABC[IMG] DEF",},{waitFor:'.modal a#link-preview.btn',element:'#link-external',sampleText:"http://www.odoo.com",title:"insert a link url",},{waitFor:'.modal a#link-preview.btn:containsRegex(/^ABC<span [^>]+><\\/span> DEF$/)',element:'.modal button.save',title:"save link",},{waitNot:'#link-preview',waitFor:'a.btn[href^="http://"]:has(span.fa.fa-3x.pull-right)',element:'#editable_area > section .row > div:last img',title:"click on other picture",},{waitFor:'#editable_area > section .row > div:first span.fa.pull-right',element:'.note-image-popover:visible button[data-event="showLinkDialog"]',title:"click on create link again",},{waitFor:'.modal a#link-preview:containsRegex(/^<img [^>]+>$/)',element:'.modal .dropdown:has(.link-style) a[data-toggle="dropdown"]',title:"click on color style again",},{element:'.modal .dropdown ul label.btn-success',title:"choose success style",},{waitFor:'.modal a#link-preview.btn',element:'#link-external',sampleText:"test@test.test",title:"insert an email",},{waitFor:'.modal a#link-preview.btn[href="mailto:test@test.test"]',element:'.modal button.save',title:"save link",},{waitNot:'#link-preview',waitFor:'#editable_area > section .row > div:eq(1) > a > img',element:'#editable_area > section .row > div:first p:eq(2)',title:"triple enter then double backspace",keydown:[66,13,66,13,13,8,8],onload:function(){var p=$(this.element)[0].firstChild;$.summernote.core.range.create(p,p.textContent.length,p,p.textContent.length).select();click_event(p,'mouseup');},},{waitNot:'#editable_area > section .row > div:first p:eq(4), #editable_area > section .row > div:eq(3)',waitFor:'#editable_area > section .row > div:first p:eq(3)',title:"add ul content",onload:function(){var $el=$('#editable_area > section .row > div:first');var html='  <ul>     '+'\n     <li>   <p>Batnae municipium.  </p></li>'+'\n     <li>    Seleucia praeter.</li>'+'\n     <li><p>Et hanc quidem.</p></li>'+'\n    </ul>';$el.append(html);var node=$el.find('ul li p:last')[0].firstChild;$.summernote.core.range.create(node,6).select();click_event(node,'mouseup');}},{waitFor:'#editable_area > section .row > div:first ul li p:first',element:'.note-air-popover .note-style button.dropdown-toggle',title:"click on style dropdown",},{element:'.note-air-popover .note-style ul:visible a[data-value="h3"]',title:"select h3",onload:function(){var node=$('#editable_area > section .row > div:first ul li p:last')[0].firstChild;$.summernote.core.range.create(node,0).select();click_event(node,'mouseup');}},{element:'#editable_area > section .row > div:first > ul > li > h3',title:"double tabulation",keydown:[9,9]},{waitFor:'#editable_area > section .row > div:first ul > li > ul > li > ul > li > h3',element:'.note-air-popover button[data-event="insertOrderedList"]',title:"click on order list",},{waitFor:'#editable_area > section .row > div:first ul > li > ul > li > ol > li > h3',element:'#editable_area > section .row > div:first ul li > p:last',title:"enter in ul",keydown:[66,13],onload:function(){$(this.element)[0].firstChild.textContent+="";$.summernote.core.range.create($(this.element)[0].firstChild,7).select();click_event($(this.element)[0],'mouseup');}},{element:'#editable_area > section .row > div:first ul li > p:eq(1):containsRegex(/^municipium./)',title:"backspace in list",keydown:8},{waitFor:'#editable_area > section .row > div:first ul li p:eq(1)',title:"end",},]});Tour.register({id:'rte_inline',name:"Test RTE Inline",mode:'test',path:'/web_editor/field/html/inline?callback=FieldTextHtml_0&enable_editor=1&datarecord=%7B%7D',steps:[{title:"Change html for this test",onload:function(){var $el=$(this.element);var html='\n'+'<div>\n'+'  <table cellspacing="0" cellpadding="0" width="100%">\n'+'    <tbody>\n'+'      <tr>\n'+'        <td valign="center" width="270">\n'+'          <img src="/logo.png" alt="Your Logo" class="img-circle img-thumbnail">\n'+'        </td>\n'+'        <td valign="center" width="270">\n'+'          <a href="https://www.facebook.com/Odoo"><span class="fa fa-facebook-square fa-2x text-primary"></span></a>\n'+'          <span style="color: rgb(255, 0, 0);" class="fa fa-4x fa-google-plus-square pull-right"></span>\n'+'        </td>\n'+'      </tr>\n'+'    </tbody>\n'+'  </table>\n'+'</div>';$("#editable_area").html(html);}},{title:"call clean for save",element:'#wrapwrap table',onload:function(){snippet_editor.instance.clean_for_save();}},{waitFor:'#wrapwrap img:first[width][height][style*="-radius"][style*="1px"][style*="padding"]',title:"check the image style",},{waitFor:'#wrapwrap img:eq(1)[src^="/web_editor/font_to_img/"][src$="/rgb(66,139,202)/32"]',title:"check the font image src",},{waitFor:'#wrapwrap img:eq(1)[height]:not([class*="fa"])',title:"check the font class to css",},{waitFor:'#wrapwrap img:eq(2)[style*="float:right"]',title:"check the second font class to css",},]});});});;

/* /web_editor/static/src/js/transcoder.js defined in bundle 'web.assets_backend' */
odoo.define('web_editor.transcoder',function(require){'use strict';var widget=require('web_editor.widget');var cache={};var rulesCache=[];var getMatchedCSSRules=function(a){if(cache[a.tagName+"."+a.className]){return cache[a.tagName+"."+a.className];}
if(!rulesCache.length){var sheets=document.styleSheets;for(var i=sheets.length-1;i>=0;i--){var rules;if(sheets[i].rules){rules=sheets[i].rules;}else{try{rules=sheets[i].cssRules;}catch(e){console.warn("Can't read the css rules of: "+sheets[i].href,e);continue;}
rules=sheets[i].cssRules;}
if(rules){for(var r=rules.length-1;r>=0;r--){var selectorText=rules[r].selectorText;if(selectorText&&rules[r].cssText&&selectorText!=="*"&&selectorText.indexOf(":hover")===-1&&selectorText.indexOf(":before")===-1&&selectorText.indexOf(":after")===-1&&selectorText.indexOf(":active")===-1&&selectorText.indexOf(":link")===-1&&selectorText.indexOf("::")===-1&&selectorText.indexOf("\"")===-1&&selectorText.indexOf("'")===-1){var st=selectorText.split(/\s*,\s*/);for(var k=0;k<st.length;k++){rulesCache.push({'selector':st[k],'style':rules[r].style});}}}}}
rulesCache.reverse();}
var css=[];a.matches=a.matches||a.webkitMatchesSelector||a.mozMatchesSelector||a.msMatchesSelector||a.oMatchesSelector;for(var r=0;r<rulesCache.length;r++){if(a.matches(rulesCache[r].selector)){var style=rulesCache[r].style;if(style.parentRule){var style_obj={};for(var k=0,len=style.length;k<len;k++){style_obj[style[k]]=style[style[k].replace(/-(.)/g,function(a,b){return b.toUpperCase();})];if(new RegExp(style[k]+'\s*:[^:;]+!important').test(style.cssText)){style_obj[style[k]]+=' !important';}}
rulesCache[r].style=style=style_obj;}
css.push([rulesCache[r].selector,style]);}}
function specificity(selector){var a=0;selector.replace(/#[a-z0-9_-]+/gi,function(){a++;return"";});var b=0;selector.replace(/(\.[a-z0-9_-]+)|(\[.*?\])/gi,function(){b++;return"";});var c=0;selector.replace(/(\s+|:+)[a-z0-9_-]+/gi,function(a){if(a.indexOf(':not(')===-1)c++;return"";});return a*100+b*10+c;}
css.sort(function(a,b){return specificity(a[0])-specificity(b[0]);});var style={};_.each(css,function(v,k){_.each(v[1],function(v,k){if(v&&_.isString(v)&&k.indexOf('-webkit')===-1&&(!style[k]||style[k].indexOf('important')===-1||v.indexOf('important')!==-1)){style[k]=v;}});});_.each(style,function(v,k){if(v.indexOf('important')!==-1){style[k]=v.slice(0,v.length-11);}});if(style.display==='block'){delete style.display;}
if(style['margin-top']){style.margin=(style['margin-top']||0)+' '+(style['margin-right']||0)+' '+(style['margin-bottom']||0)+' '+(style['margin-left']||0);delete style['margin-top'];delete style['margin-right'];delete style['margin-bottom'];delete style['margin-left'];}
if(style['padding-top']){style.padding=(style['padding-top']||0)+' '+(style['padding-right']||0)+' '+(style['padding-bottom']||0)+' '+(style['padding-left']||0);delete style['padding-top'];delete style['padding-right'];delete style['padding-bottom'];delete style['padding-left'];}
return a.className?cache[a.tagName+"."+a.className]=style:style;};var font_to_img=function($editable){$(".fa",$editable).each(function(){var $font=$(this);var icon,content;_.find(widget.fontIcons,function(font){return _.find(widget.getCssSelectors(font.parser),function(css){if($font.is(css[0].replace(/::?before$/,''))){icon=css[2].split("-").shift();content=css[1].match(/content:\s*['"]?(.)['"]?/)[1];return true;}});});if(content){var color=$font.css("color").replace(/\s/g,'');var src=_.str.sprintf('/web_editor/font_to_img/%s/%s/'+Math.max(1,$font.height()),window.encodeURI(content),window.encodeURI(color));var $img=$("<img/>").attr("src",src).attr("data-class",$font.attr("class")).attr("class",$font.attr("class").replace(new RegExp("(^|\\s+)"+icon+"(-[^\\s]+)?","gi"),'')).attr("style",$font.attr("style")).attr("height",$font.height()).css("height","").css("font-size","");$font.replaceWith($img);}else{$font.remove();}});};var img_to_font=function($editable){$("img[src*='/web_editor/font_to_img/']",$editable).each(function(){var $img=$(this);var $font=$("<span/>").attr("class",$img.data("class")).attr("style",$img.attr("style")).css("height","");$img.replaceWith($font);});};var class_to_style=function($editable){if(!rulesCache.length){getMatchedCSSRules($editable[0]);}
$editable.find('*').each(function(){var $target=$(this);var css=getMatchedCSSRules(this);var style=$target.attr("style")||"";_.each(css,function(v,k){if(!(new RegExp('(^|;)\s*'+k).test(style))){style=k+":"+v+";"+style;}});if(_.isEmpty(style)){$target.removeAttr("style");}else{$target.attr("style",style);}});};var style_to_class=function($editable){getMatchedCSSRules($editable[0]);var $c=$('<span/>').appendTo("body");$editable.find('*').each(function(){var $target=$(this);var css=getMatchedCSSRules(this);var style="";_.each(css,function(v,k){if(!(new RegExp('(^|;)\s*'+k).test(style))){style=k+":"+v+";"+style;}});css=($c.attr("style",style).attr("style")||"").split(/\s*;\s*/);style=$target.attr("style")||"";_.each(css,function(v){style=style.replace(v,'');});style=style.replace(/;+(\s;)*/g,';').replace(/^;/g,'');if(style!==''){$target.attr("style",style);}else{$target.removeAttr("style");}});$c.remove();};return{'font_to_img':font_to_img,'img_to_font':img_to_font,'class_to_style':class_to_style,'style_to_class':style_to_class,};});;

/* /web_editor/static/src/js/translator.js defined in bundle 'web.assets_backend' */
odoo.define('web_editor.translate',function(require){'use strict';var core=require('web.core');var Model=require('web.Model');var ajax=require('web.ajax');var Class=require('web.Class');var Widget=require('web.Widget');var base=require('web_editor.base');var rte=require('web_editor.rte');var editor_widget=require('web_editor.widget');var qweb=core.qweb;var _t=core._t;ajax.loadXML('/web_editor/static/src/xml/translator.xml',qweb);var translatable=!!$('html').data('translatable');var edit_translations=!!$('html').data('edit_translations');$.fn.extend({prependEvent:function(events,selector,data,handler){this.on(events,selector,data,handler);events=events.split(' ');this.each(function(){var el=this;_.each(events,function(event){var handler=$._data(el,'events')[event].pop();$._data(el,'events')[event].unshift(handler);});});return this;}});var RTE_Translate=rte.Class.extend({saveElement:function($el,context){var key=$el.data('oe-translation-id')?'translation:'+$el.data('oe-translation-id'):($el.data('oe-model')?$el.data('oe-model')+":"+$el.data('oe-id')+":"+$el.data('oe-field')+":"+$el.data('oe-type')+":"+$el.data('oe-expression'):false);if(!key||this.__saved[key])return true;this.__saved[key]=true;if($el.data('oe-translation-id')){var translation_content=this.getEscapedElement($el).html();return ajax.jsonRpc('/web/dataset/call','call',{model:'ir.translation',method:'write',args:[[+$el.data('oe-translation-id')],{'value':translation_content,'state':'translated'},context||base.get_context()],});}else{var markup=this.getEscapedElement($el).prop('outerHTML');return ajax.jsonRpc('/web/dataset/call','call',{model:'ir.ui.view',method:'save',args:[$el.data('oe-id'),markup,$el.data('oe-xpath')||null,context||base.get_context()],});}},});var Translate_Modal=editor_widget.Dialog.extend({template:'web_editor.translator.attributes',init:function(parent,node){this._super();this.parent=parent;this.$target=$(node);this.translation=$(node).data('translation');},start:function(){var self=this;this._super();var $group=this.$el.find('.form-group');_.each(this.translation,function(node,attr){var $node=$(node);var $label=$('<label class="control-label"></label>').text(attr);var $input=$('<input class="form-control"/>').val($node.html());$input.on('change keyup',function(){var value=$input.val();$node.html(value).trigger('change',node);$node.data('$node').attr($node.data('attribute'),value).trigger('translate');self.parent.rte_changed(node);});$group.append($label).append($input);});}});var Translate=Widget.extend({events:{'click [data-action="save"]':'save_and_reload','click [data-action="cancel"]':'cancel',},template:'web_editor.translator',init:function(parent,$target,lang){this.parent=parent;this.ir_translation=new Model('ir.translation');this.lang=lang||base.get_context().lang;this.setTarget($target);this._super();this.rte=new RTE_Translate(this,this.config);this.rte.on('change',this,this.rte_changed);},start:function(){this._super();this.$('button[data-action=save]').prop('disabled',true);return this.edit();},setTarget:function($target){var $edit=$target.find('[data-oe-translation-id], [data-oe-model][data-oe-id][data-oe-field]');$edit.filter(':has([data-oe-translation-id], [data-oe-model][data-oe-id][data-oe-field])').attr('data-oe-readonly',true);this.$target=$edit.not('[data-oe-readonly]');var attrs=['placeholder','title','alt'];_.each(attrs,function(attr){$target.find('['+attr+'*="data-oe-translation-id="]').filter(':empty, input, select, textarea, img').each(function(){var $node=$(this);var translation=$node.data('translation')||{};var trans=$node.attr(attr);var match=trans.match(/<span [^>]*data-oe-translation-id="([0-9]+)"[^>]*>(.*)<\/span>/);var $trans=$(trans).addClass('hidden o_editable o_editable_translatable_attribute').appendTo('body');$trans.data('$node',$node).data('attribute',attr);translation[attr]=$trans[0];$node.attr(attr,match[2]);var select2=$node.data('select2');if(select2){select2.blur();$node.on('translate',function(){select2.blur();});$node=select2.container.find('input');}
$node.addClass('o_translatable_attribute').data('translation',translation);});});this.$target_attr=$target.find('.o_translatable_attribute');this.$target_attribute=$('.o_editable_translatable_attribute');},find:function(selector){return selector?this.$target.find(selector).addBack().filter(selector):this.$target;},edit:function(){var flag=false;window.onbeforeunload=function(event){if($('.o_editable.o_dirty').length&&!flag){flag=true;setTimeout(function(){flag=false;},0);return _t('This document is not saved!');}};this.$target.addClass("o_editable");this.rte.start();this.translations=[];this.markTranslatableNodes();this.onTranslateReady();},onTranslateReady:function(){this.$el.show();this.trigger("edit");},rte_changed:function(node){var $node=$(node);var trans=this.getTranlationObject($node[0]);$node.toggleClass('o_dirty',trans.value!==$node.html().replace(/[ \t\n\r]+/,' '));this.$('button[data-action=save]').prop('disabled',!$('.o_editable.o_dirty').length);},getTranlationObject:function(node){var $node=$(node);var id=+$node.data('oe-translation-id');if(!id){id=$node.data('oe-model')+','+$node.data('oe-id')+','+$node.data('oe-field');}
var trans=_.find(this.translations,function(trans){return trans.id===id;});if(!trans){this.translations.push(trans={'id':id});}
return trans;},__unbind_click:function(event){if(event.ctrlKey||!$(event.target).is(':o_editable')){return;}
event.preventDefault();event.stopPropagation();},__translate_attribute:function(event){if(event.ctrlKey){return;}
event.preventDefault();event.stopPropagation();if(event.type!=='mousedown'){return;}
new Translate_Modal(event.data,event.target).appendTo('body');},markTranslatableNodes:function(node){var self=this;this.$target.add(this.$target_attribute).each(function(){var $node=$(this);var trans=self.getTranlationObject(this);trans.value=(trans.value?trans.value:$node.html()).replace(/[ \t\n\r]+/,' ');});this.$target.parent().prependEvent('click',this,this.__unbind_click);this.$target_attr.each(function(){var $node=$(this);var translation=$node.data('translation');_.each(translation,function(node,attr){var trans=self.getTranlationObject(node);trans.value=(trans.value?trans.value:$node.html()).replace(/[ \t\n\r]+/,' ');$node.attr('data-oe-translation-state',(trans.state||'to_translate'));});});this.$target_attr.prependEvent('mousedown click mouseup',this,this.__translate_attribute);console.info('Click on CTRL when you click in an translatable area to have the default behavior');},unarkTranslatableNode:function(){this.$target.removeClass('o_editable').removeAttr('contentEditable');this.$target.parent().off('click',this.__unbind_click);this.$target_attr.off('mousedown click mouseup',this.__translate_attribute);},save_and_reload:function(){return this.save().then(function(){window.location.href=window.location.href.replace(/&?edit_translations(=[^&]*)?/g,'');});},save:function(){var context=base.get_context();context.lang=this.lang;return this.rte.save(context);},cancel:function(){var self=this;this.rte.cancel();this.$target.each(function(){$(this).html(self.getTranlationObject(this).value);});this.unarkTranslatableNode();this.trigger("cancel");this.$el.hide();window.onbeforeunload=null;},destroy:function(){this.cancel();this.$el.remove();this._super();},config:function($editable){if($editable.data('oe-model')){return{'airMode':true,'focus':false,'airPopover':[['history',['undo','redo']],],'styleWithSpan':false,'inlinemedia':['p'],'lang':"odoo",'onChange':function(html,$editable){$editable.trigger("content_changed");}};}
return{'airMode':true,'focus':false,'airPopover':[['font',['bold','italic','underline','clear']],['fontsize',['fontsize']],['color',['color']],['history',['undo','redo']],],'styleWithSpan':false,'inlinemedia':['p'],'lang':"odoo",'onChange':function(html,$editable){$editable.trigger("content_changed");}};}});if(edit_translations){base.ready().then(function(){data.instance=new Translate(this,$('#wrapwrap'));data.instance.prependTo(document.body);$('a[href*=edit_translations]').each(function(){this.href=this.href.replace(/[$?]edit_translations[^&?]+/,'');});$('form[action*=edit_translations]').each(function(){this.action=this.action.replace(/[$?]edit_translations[^&?]+/,'');});$('title').html($('title').html().replace(/&lt;span data-oe-model.+?&gt;(.+?)&lt;\/span&gt;/,'\$1'));});}
var data={'translatable':translatable,'edit_translations':edit_translations,'Class':Translate,};return data;});;

/* /web_editor/static/src/js/backend.js defined in bundle 'web.assets_backend' */
odoo.define('web_editor.backend',function(require){'use strict';var core=require('web.core');var session=require('web.session');var Model=require('web.DataModel');var common=require('web.form_common');var base=require('web_editor.base');var editor=require('web_editor.editor');var summernote=require('web_editor.summernote');var transcoder=require('web_editor.transcoder');var QWeb=core.qweb;var _t=core._t;$.trumbowyg.svgPath='/web_editor/static/lib/trumbowyg/dist/ui/icons.svg';var widget=common.AbstractField.extend(common.ReinitializeFieldMixin);var FieldTextHtmlSimple=widget.extend({template:'web_editor.FieldTextHtmlSimple',willStart:function(){var self=this;return new Model('res.lang').call("search_read",[[['code','!=','en_US']],["name","code"]]).then(function(res){self.languages=res;});},start:function(){var def=this._super.apply(this,arguments);this.$translate.remove();this.$translate=$();this.$content.trigger('mouseup');return def;},initialize_content:function(){var self=this;this.lang=this.view.dataset.context.lang;this.$textarea=this.$("textarea").val(this.get('value')||"<p><br/></p>");this.$content=$();if(this.get("effective_readonly")){if(this.options['style-inline']){this.$textarea.hide().after('<iframe class="o_readonly"/>');setTimeout(function(){self.$content=$("body",self.$('iframe').contents()[0]);self.$content.html(self.text_to_html(self.get('value')));self.resize();});}else{this.$content=$('<div class="o_readonly"/>');this.$textarea.hide().after(this.$content);}}else{var trumbowyg;if(window.location.hash.match(/tracker.issue/)){trumbowyg=this.$textarea.trumbowyg({btns:[['formatting'],'btnGrp-semantic',['superscript','subscript'],['link'],'btnGrp-justify','btnGrp-lists',['insertImage'],['removeformat'],],plugins:{upload:{serverPath:'/web_editor/attachment/add',data:[{name:'csrf_token',value:core.csrf_token,},{name:'func',value:'trumbop',},],success:function(res){var res_object=JSON.parse(res.match('{.*}')[0]);var url='/web/image/'+res_object.id;trumbowyg.trumbowyg('execCmd',{cmd:'insertImage',param:url});setTimeout(function(){trumbowyg.trumbowyg('closeModal');},250);},fileFieldName:'upload',},table:{styler:'table table-striped table-bordered',}},resetCss:false,lang:session.user_context.lang.substr(0,2),});}
else{trumbowyg=this.$textarea.trumbowyg({btns:[['formatting'],'btnGrp-semantic',['superscript','subscript'],['link'],'btnGrp-justify','btnGrp-lists',['removeformat'],],plugins:{upload:{serverPath:'/web_editor/attachment/add',data:[{name:'csrf_token',value:core.csrf_token,},{name:'func',value:'trumbop',},],success:function(res){var res_object=JSON.parse(res.match('{.*}')[0]);var url='/web/image/'+res_object.id;trumbowyg.trumbowyg('execCmd',{cmd:'insertImage',param:url});setTimeout(function(){trumbowyg.trumbowyg('closeModal');},250);},fileFieldName:'upload',},table:{styler:'table table-striped table-bordered',}},resetCss:false,lang:session.user_context.lang.substr(0,2),});}}
this._super();},reset_history:function(){var history=this.$content.data('NoteHistory');if(history){history.reset();self.$('.note-toolbar').find('button[data-event="undo"]').attr('disabled',true);}},text_to_html:function(text){var value=text||"";if(value.match(/^\s*$/)){value='<p><br/></p>';}else{value="<p>"+value.split(/<br\/?>/).join("<br/></p><p>")+"</p>";value=value.replace(/<p><\/p>/g,'').replace('<p><p>','<p>').replace('<p><p ','<p ').replace('</p></p>','</p>');}
return value;},focus:function(){if(this.get("effective_readonly")){return false;}
try{return this.$content.focusInEnd();}catch(e){return this.$content.focus();}},resize:function(){this.$('iframe').css('height','0px').css('height',Math.max(30,Math.min(this.$content[0]?this.$content[0].scrollHeight:0,500))+'px');},render_value:function(){var self=this;var value=this.get('value');this.$textarea.val(value||'');this.$content.html(this.text_to_html(value));if(this.get("effective_readonly")){this.resize();}else{this.$textarea.trumbowyg('html',value||'');}
if(this.$content.is(document.activeElement)){this.focus();}
var history=this.$content.data('NoteHistory');if(history&&history.recordUndo()){this.$('.note-toolbar').find('button[data-event="undo"]').attr('disabled',false);}
if(this.field.translate&&!this.$el.find('.translate_html_select').length){var $to=this.$el;$(QWeb.render('web_editor.FieldTextHtml.translate',{'widget':this})).appendTo($to).on('change','select',function(){var self2=this;self.new_textarea[self.old_select]=self.$textarea.val();if(self.view.ViewManager.$el.find('h2>.oe_form_field_translatable>input').length>0)
self.new_subject[self.old_select]=self.view.ViewManager.$el.find('h2>.oe_form_field_translatable>input').val();var lang=$(this).val();self.old_select=$(self2).val();var edit=!self.get("effective_readonly");var field=self.name;var model=self.field_manager.model;var id=self.field_manager.dataset.ids[self.field_manager.dataset.index];$.get('/web_editor/get_translation',{lang:lang,field:field,model:model,res_id:id}).then(function(res){if(self.new_textarea[self.old_select]){self.$textarea.val(self.new_textarea[self.old_select]);self.$content.html(self.text_to_html(self.new_textarea[self.old_select]));if(!edit){self.resize();}else{self.$textarea.trumbowyg("html",self.new_textarea[self.old_select]);}}
else{self.$textarea.val(res);self.new_textarea[self.old_select]=res;self.old_textarea[self.old_select]=res;self.$content.html(self.text_to_html(res));self.new_textarea["languages"].push($(self2).val());if(!edit){self.resize();}else{self.$textarea.trumbowyg("html",res);}}});field='subject';$.get('/web_editor/get_translation',{lang:lang,field:field,model:model,res_id:id}).then(function(res){if(self.new_subject[self.old_select]){self.view.ViewManager.$el.find('h2>.oe_form_field_translatable>span.oe_form_char_content').html(self.new_subject[self.old_select]);self.view.ViewManager.$el.find('h2>.oe_form_field_translatable>input').val(self.new_subject[self.old_select]);}
else{self.view.ViewManager.$el.find('h2>.oe_form_field_translatable>span.oe_form_char_content').html(res);self.view.ViewManager.$el.find('h2>.oe_form_field_translatable>input').val(res);}});});}
if(this.field.translate&&this.$el.find('.translate_html_select').length){if(!self.field_manager.dataset.ids[self.field_manager.dataset.index]){this.$el.find('select').hide();}
this.$el.find('select option[value='+self.lang+']').prop('selected',true);this.old_select=this.$el.find('select').val();this.old_textarea=new Object();this.new_textarea=new Object();this.old_subject=new Object();this.new_subject=new Object();this.old_textarea[this.old_select]=value;this.new_textarea[this.old_select]=value;this.old_subject[this.old_select]=this.view.ViewManager.$el.find('h2>.oe_form_field_translatable>span.oe_form_char_content').html();this.new_subject[this.old_select]=this.view.ViewManager.$el.find('h2>.oe_form_field_translatable>span.oe_form_char_content').html();this.new_textarea["languages"]=new Array();this.new_textarea["languages"].push(this.old_select);}},is_false:function(){return!this.get('value')||this.get('value')==="<p><br/></p>"||!this.get('value').match(/\S/);},before_save:function(){var self=this;if(this.field.translate&&this.$el.find('.translate_html_select').length&&self.field_manager.dataset.ids[self.field_manager.dataset.index]){var values={field:self.name,model:self.field_manager.model,res_id:self.field_manager.dataset.ids[self.field_manager.dataset.index],langues:new Array(),contents:new Array()};this.new_textarea[this.old_select]=this.$textarea.val();this.new_textarea["languages"].forEach(function(lang){if(this.old_textarea[lang]!==this.new_textarea[lang]){values.langues.push(lang);values.contents.push(self.new_textarea[lang])}},this);session.rpc('/web_editor/set_translation',values);values={field:"subject",model:self.field_manager.model,res_id:self.field_manager.dataset.ids[self.field_manager.dataset.index],langues:new Array(),contents:new Array()};this.new_subject[this.old_select]=self.view.ViewManager.$el.find('h2>.oe_form_field_translatable>input').val();this.new_textarea["languages"].forEach(function(lang){if(this.old_subject[lang]!==this.new_subject[lang]){values.langues.push(lang);values.contents.push(self.new_subject[lang])}},this);session.rpc('/web_editor/set_translation',values);}
if(this.options['style-inline']){transcoder.font_to_img(this.$content);}
if(!this.get('effective_readonly')){this.internal_set_value(this.$textarea.trumbowyg('html'));}},destroy_content:function(){$(".oe-view-manager-content").off("scroll");this.$textarea.destroy();this._super();},});var FieldTextHtml=widget.extend({template:'web_editor.FieldTextHtml',willStart:function(){var self=this;return new Model('res.lang').call("search_read",[[['code','!=','en_US']],["name","code"]]).then(function(res){self.languages=res;});},start:function(){var self=this;this.callback=_.uniqueId('FieldTextHtml_');window.odoo[this.callback+"_editor"]=function(EditorBar){setTimeout(function(){self.on_editor_loaded(EditorBar);},0);};window.odoo[this.callback+"_content"]=function(EditorBar){self.on_content_loaded();};window.odoo[this.callback+"_updown"]=null;window.odoo[this.callback+"_downup"]=function(value){self.internal_set_value(value);self.trigger('changed_value');self.resize();};this.$iframe=this.$el.find('iframe');this.document=null;this.$body=$();this.$content=$();this.$iframe.css('min-height','calc(100vh - 360px)');this.resize=function resize(){if(self.get('effective_readonly')){return;}
if($("body").hasClass("o_form_FieldTextHtml_fullscreen")){self.$iframe.css('height',(document.body.clientHeight-self.$iframe.offset().top)+'px');}else{self.$iframe.css("height",(self.$body.find("#oe_snippets").length?500:300)+"px");}};$(window).on('resize',self.resize);var def=this._super.apply(this,arguments);this.$translate.remove();this.$translate=$();return def;},get_url:function(_attr){var src=this.options.editor_url||"/web_editor/field/html";var datarecord=this.view.get_fields_values();var attr={'model':this.view.model,'field':this.name,'res_id':datarecord.id||'','callback':this.callback};_attr=_attr||{};if(this.options['style-inline']){attr.inline_mode=1;}
if(this.options.snippets){attr.snippets=this.options.snippets;}
if(this.options.template){attr.template=this.options.template;}
if(!this.get("effective_readonly")){attr.enable_editor=1;}
if(this.field.translate){attr.translatable=1;}
if(session.debug){attr.debug=1;}
attr.lang=attr.enable_editor?'en_US':this.session.user_context.lang;for(var k in _attr){attr[k]=_attr[k];}
if(src.indexOf('?')===-1){src+="?";}
for(var k in attr){if(attr[k]!==null){src+="&"+k+"="+(_.isBoolean(attr[k])?+attr[k]:attr[k]);}}
delete datarecord[this.name];src+="&datarecord="+encodeURIComponent(JSON.stringify(datarecord));return src;},initialize_content:function(){this.$el.closest('.modal-body').css('max-height','none');this.$iframe=this.$el.find('iframe');this.document=null;this.$body=$();this.$content=$();this.editor=false;window.odoo[this.callback+"_updown"]=null;this.$iframe.attr("src",this.get_url());},on_content_loaded:function(){var self=this;this.document=this.$iframe.contents()[0];this.$body=$("body",this.document);this.$content=this.$body.find("#editable_area");this._toggle_label();this._dirty_flag=false;this.render_value();setTimeout(function(){self.add_button();setTimeout(self.resize,0);},0);},on_editor_loaded:function(EditorBar){var self=this;this.editor=EditorBar;if(this.get('value')&&window.odoo[self.callback+"_updown"]&&!(this.$content.html()||"").length){this.render_value();}
setTimeout(function(){setTimeout(self.resize,0);},0);},add_button:function(){var self=this;var $to=this.$body.find("#web_editor-top-edit, #wrapwrap").first();$(QWeb.render('web_editor.FieldTextHtml.translate',{'widget':this})).appendTo($to).on('change','select',function(){var lang=$(this).val();var edit=!self.get("effective_readonly");var trans=lang!=='en_US';self.$iframe.attr("src",self.get_url({'edit_translations':edit&&trans,'enable_editor':edit&&!trans,'lang':lang}));});$(QWeb.render('web_editor.FieldTextHtml.fullscreen')).appendTo($to).on('click','.o_fullscreen',function(){$("body").toggleClass("o_form_FieldTextHtml_fullscreen");var full=$("body").hasClass("o_form_FieldTextHtml_fullscreen");self.$iframe.parents().toggleClass('o_form_fullscreen_ancestor',full);self.resize();});this.$body.on('click','[data-action="cancel"]',function(event){event.preventDefault();self.initialize_content();});},render_value:function(){if(this.lang!==this.view.dataset.context.lang||this.$iframe.attr('src').match(/[?&]edit_translations=1/)){return;}
var value=(this.get('value')||"").replace(/^<p[^>]*>(\s*|<br\/?>)<\/p>$/,'');if(!this.$content){return;}
if(!this.get("effective_readonly")){if(window.odoo[this.callback+"_updown"]){window.odoo[this.callback+"_updown"](value,this.view.get_fields_values(),this.name);this.resize();}}else{this.$content.html(value);if(this.$iframe[0].contentWindow){this.$iframe.css("height",(this.$body.height()+20)+"px");}}},is_false:function(){return this.get('value')===false||!this.$content.html()||!this.$content.html().match(/\S/);},before_save:function(){if(this.lang!=='en_US'&&this.$body.find('.o_dirty').length){this.internal_set_value(this.view.datarecord[this.name]);this._dirty_flag=false;return this.editor.save();}else if(this._dirty_flag&&this.editor&&this.editor.buildingBlock){this.editor.buildingBlock.clean_for_save();this.internal_set_value(this.$content.html());}},destroy:function(){$(window).off('resize',self.resize);delete window.odoo[this.callback+"_editor"];delete window.odoo[this.callback+"_content"];delete window.odoo[this.callback+"_updown"];delete window.odoo[this.callback+"_downup"];}});core.form_widget_registry.add('html',FieldTextHtmlSimple).add('html_frame',FieldTextHtml);});;

/* /web_export_view/static/src/js/web_export_view.js defined in bundle 'web.assets_backend' */
odoo.define('web_export_view',function(require){"use strict";var core=require('web.core');var Sidebar=require('web.Sidebar');var formats=require('web.formats');var _t=core._t,QWeb=core.qweb;var py=window.py;Sidebar.include({add_toolbar:function(toolbar){var self=this;this._super(toolbar);var view=self.getParent();var view_manager=view.getParent();var action=view_manager.action;var security_rule=action&&action.security_rule;if(!security_rule){return;}
if(_.isObject(security_rule)&&!security_rule.is_admin&&!(security_rule.can_export&&security_rule.show_export_current)){return;}
self.add_items("other",[{label:_t("Export Current View"),callback:self.on_sidebar_export_view_xls}]);},on_sidebar_export_view_xls:function(){var self=this,view=this.getParent(),children=view.getChildren();if(children){children.every(function(child){if(child.field&&child.field.type=='one2many'){view=child.viewmanager.views.list.controller;return false;}
if(child.field&&child.field.type=='many2many'){view=child.list_view;return false;}
return true;});}
var export_columns_keys=[];var export_columns_names=[];$.each(view.visible_columns,function(){if(this.tag=='field'){export_columns_keys.push(this.id);export_columns_names.push(this.string);}});var rows=view.$el.find('.oe_list_content > tbody > tr');var export_rows=[];var group=!!view.$el.find('.oe_group_header').length;if(group)
export_columns_names.unshift(_t('Group'));$.each(rows,function(){var $row=$(this);if($row.attr('data-id')){var export_row=[];if(group)
export_row.push('');var checked=$row.find('th input[type=checkbox]').prop("checked");if(children&&checked){$.each(export_columns_keys,function(){var cell=$row.find('td[data-field="'+this+'"]').get(0);var text=cell.text||cell.textContent||cell.innerHTML||"";if(cell.classList.contains("oe_list_field_float")){export_row.push(formats.parse_value(text,{'type':"float"}));}
else if(cell.classList.contains("oe_list_field_boolean")){var data_id=$('<div>'+cell.innerHTML+'</div>');if(data_id.find('input').get(0).checked){export_row.push(_t("True"));}
else{export_row.push(_t("False"));}}
else if(cell.classList.contains("oe_list_field_integer")){var tmp2=text;do{var tmp=tmp2;tmp2=tmp.replace(_t.database.parameters.thousands_sep,"");}while(tmp!==tmp2);export_row.push(parseInt(tmp2));}
else{export_row.push(text.trim());}});export_rows.push(export_row);}}else{var $header=$row.find('th.oe_list_group_name').get(0);if($header){export_row=[];export_row.push($header.textContent);var dataRows=$row.find('td');dataRows=dataRows.slice(dataRows.length-export_columns_keys.length,dataRows.length);_.each(dataRows,function(e){export_row.push(e.textContent);});export_rows.push(export_row);}}});$.blockUI();var group_by=view.getParent().searchview.build_search_data().groupbys;var domain=_.reduce(_.map(this.getParent().getParent().searchview.build_search_data().domains,function(domain){if(_.isString(domain)){domain=domain.replace("[('date_due','<=',(datetime.date.today().strftime('%Y-%m-%d'))), ('state', 'not in', ['paid','cancel'])]","[('date_due','<=','"+moment().format('YYYY-MM-DD')+"'), ('state', 'not in', ['paid','cancel'])]");return py.eval(domain);}else if(_.isArray(domain)){return domain;}else{return domain.eval();}}),function(memo,num){return Array.prototype.concat(memo,num);},[]);domain.concat(this.getParent().dataset.domain);view.session.get_file({url:'/web/export/xls_view',data:{data:JSON.stringify({model:view.model,headers:export_columns_names,rows:export_rows,group:group,group_by:group_by,domain:domain,})},complete:$.unblockUI});}});});;

/* /web_float_time_seconds/static/src/js/web_float_time_seconds.js defined in bundle 'web.assets_backend' */
odoo.define('web_float_time_seconds',function(require){var core=require('web.core');var QWeb=core.qweb;var formats=require('web.formats');var format_to_hms=function(value){var pattern='%02d:%02d:%02d';if(value<0){value=Math.abs(value);pattern='-'+pattern;}
var sec=Math.round((value%1)*3600);var minutes=Math.floor(sec/60);var seconds=sec%60;var formatted=_.str.sprintf(pattern,Math.floor(value),minutes,seconds);return formatted;}
var new_type='float_time_seconds';var old_format_value=formats.format_value;var old_parse_value=formats.parse_value;formats.format_value=function(value,descriptor,value_if_empty){value=old_format_value.apply(formats,arguments);if(descriptor.widget==new_type||descriptor.type==new_type){return format_to_hms(value);}
if(descriptor.widget=="datetime_time"||descriptor.type=="datetime_time"){return old_format_value(value,'float_time')}
return value;};formats.parse_value=function(value,descriptor,value_if_empty){value=old_parse_value.apply(formats,arguments);if(descriptor.widget==new_type||descriptor.type==new_type){var factor=1;if(value[0]==='-'){value=value.slice(1);factor=-1;}
var float_time_seconds=value.split(":");if(float_time_seconds.length!=3)
return factor*formats.parse_value(value,{type:"float"});var hours=formats.parse_value(float_time_seconds[0],{type:"integer"});var minutes=formats.parse_value(float_time_seconds[1],{type:"integer"});var seconds=formats.parse_value(float_time_seconds[2],{type:"integer"});var parsed=factor*(hours+(minutes/60)+(seconds/3600));return parsed;}
if(descriptor.widget=="datetime_time"||descriptor.type=="datetime_time"){var factor=1;if(value[0]==='-'){value=value.slice(1);factor=-1;}
var float_time_seconds=value.split(":");if(float_time_seconds.length!=3)
return factor*old_parse_value(value,{type:"float_time"});var hours=formats.parse_value(float_time_seconds[0],{type:"integer"});var minutes=formats.parse_value(float_time_seconds[1],{type:"integer"});var seconds=formats.parse_value(float_time_seconds[2],{type:"integer"});var parsed=factor*(hours+(minutes/60)+(seconds/3600));return parsed;}
return value;};core.form_widget_registry.add(new_type,openerp.web.form.FieldFloat);var kanban_widgets=require('web_kanban.widgets');var AbstractField=kanban_widgets.AbstractField;var fields_registry=kanban_widgets.registry;var FloatTimeSecondsWidget=AbstractField.extend({init:function(parent,field,$node){this._super.apply(this,arguments);this.name=$node.attr('name')
this.parent=parent;},renderElement:function(){var self=this;this.record_id=self.parent.id;var value=format_to_hms(this.field.raw_value)
var text_field=this.field.string;var attr_f=this.$node[0].attributes.getNamedItem("string");if(attr_f!=undefined)
{text_field=attr_f.nodeValue;}
text_field=text_field+" : ";var html=$("<div />").append($("<b />",{text:text_field})).append($('<span />',{text:value}));var html=$("<div />",{class:'op_no_padding oe_fold_column oe_kanban_record',text:value});this.$el=html;},reload_record:function(){this.do_reload();},});fields_registry.add("float_time_seconds",FloatTimeSecondsWidget);return{FloatTimeSecondsWidget:FloatTimeSecondsWidget,};});;

/* /web_kanban/static/src/js/kanban_record.js defined in bundle 'web.assets_backend' */
odoo.define('web_kanban.Record',function(require){"use strict";var core=require('web.core');var data=require('web.data');var formats=require('web.formats');var framework=require('web.framework');var session=require('web.session');var time=require('web.time');var utils=require('web.utils');var Widget=require('web.Widget');var kanban_widgets=require('web_kanban.widgets');var QWeb=core.qweb;var fields_registry=kanban_widgets.registry;var KanbanRecord=Widget.extend({template:'KanbanView.record',events:{'click .oe_kanban_action':'on_kanban_action_clicked','click .o_kanban_manage_toggle_button':'toggle_manage_pane',},custom_events:{'kanban_update_record':'update_record',},init:function(parent,record,options){this._super(parent);this.fields=options.fields;this.editable=options.editable;this.deletable=options.deletable;this.draggable=options.draggable;this.read_only_mode=options.read_only_mode;this.model=options.model;this.group_info=options.group_info;this.qweb=options.qweb;this.sub_widgets=[];this.init_content(record);},init_content:function(record){var self=this;this.id=record.id;this.values={};_.each(record,function(v,k){self.values[k]={value:v};});this.record=this.transform_record(record);var qweb_context={record:this.record,widget:this,read_only_mode:this.read_only_mode,user_context:session.user_context,formats:formats,};for(var p in this){if(_.str.startsWith(p,'kanban_')){qweb_context[p]=_.bind(this[p],this);}}
this.content=this.qweb.render('kanban-box',qweb_context);},add_widgets:function(){var self=this;this.$("field").each(function(){var $field=$(this);var field=self.record[$field.attr("name")];var type=$field.attr("widget")||field.type;var Widget=fields_registry.get(type);var widget=new Widget(self,field,$field);widget.replace($field);self.sub_widgets.push(widget);});},start:function(){this.add_widgets();},renderElement:function(){this._super();this.setup_color_picker();this.$el.addClass('o_kanban_record');this.$el.data('record',this);if(this.$el.hasClass('oe_kanban_global_click')||this.$el.hasClass('oe_kanban_global_click_edit')){this.$el.on('click',this.proxy('on_global_click'));}},transform_record:function(record){var self=this;var new_record={};_.each(_.extend(_.object(_.keys(this.fields),[]),record),function(value,name){var r=_.clone(self.fields[name]||{});if((r.type==='date'||r.type==='datetime')&&value){r.raw_value=time.auto_str_to_date(value);}else{r.raw_value=value;}
r.value=formats.format_value(value,r);new_record[name]=r;});return new_record;},update:function(record){_.invoke(this.sub_widgets,'destroy');this.sub_widgets=[];this.init_content(record);this.renderElement();this.add_widgets();},kanban_image:function(model,field,id,cache,options){options=options||{};var url;if(this.record[field]&&this.record[field].value&&!utils.is_bin_size(this.record[field].value)){url='data:image/png;base64,'+this.record[field].value;}else if(this.record[field]&&!this.record[field].value){url="/web/static/src/img/placeholder.png";}else{if(_.isArray(id)){id=id[0];}
if(!id){id=undefined;}
if(options.preview_image)
field=options.preview_image;var unique=this.record.__last_update&&this.record.__last_update.value.replace(/[^0-9]/g,'');url=session.url('/web/image',{model:model,field:field,id:id,unique:unique});if(cache!==undefined){url+='&cache='+parseInt(cache,10);}}
return url;},kanban_getcolor:function(variable){if(typeof(variable)==='number'){return Math.round(variable)%10;}
if(typeof(variable)==='string'){var index=0;for(var i=0;i<variable.length;i++){index+=variable.charCodeAt(i);}
return index%10;}
return 0;},kanban_color:function(variable){var color=this.kanban_getcolor(variable);return'oe_kanban_color_'+color;},on_global_click:function(ev){if($(ev.target).parents('.o_dropdown_kanban').length){return;}
if(!ev.isTrigger){var trigger=true;var elem=ev.target;var ischild=true;var children=[];while(elem){var events=$._data(elem,'events');if(elem==ev.currentTarget){ischild=false;}
if(ischild){children.push(elem);if(events&&events.click){trigger=false;}}
if(trigger&&events&&events.click){_.each(events.click,function(click_event){if(click_event.selector){_.each(children,function(child){if($(child).is(click_event.selector)){trigger=false;}});}});}
elem=elem.parentElement;}
if(trigger){this.on_card_clicked(ev);}}},on_card_clicked:function(){if(this.$el.hasClass('oe_kanban_global_click_edit')&&this.$el.data('routing')){framework.redirect(this.$el.data('routing')+"/"+this.id);}else if(this.$el.hasClass('oe_kanban_global_click_edit')){this.trigger_up('kanban_record_edit',{id:this.id});}else{this.trigger_up('kanban_record_open',{id:this.id});}},toggle_manage_pane:function(event){event.preventDefault();this.$('.o_kanban_card_content').toggleClass('o_visible o_invisible');this.$('.o_kanban_card_manage_pane').toggleClass('o_visible o_invisible');this.$('.o_kanban_manage_button_section').toggleClass(this.kanban_color((this.values['color']&&this.values['color'].value)||0));},on_kanban_action_clicked:function(ev){ev.preventDefault();var $action=$(ev.currentTarget);var type=$action.data('type')||'button';switch(type){case'edit':this.trigger_up('kanban_record_edit',{id:this.id});break;case'open':this.trigger_up('kanban_record_open',{id:this.id});break;case'delete':this.trigger_up('kanban_record_delete',{record:this});break;case'action':case'object':this.trigger_up('kanban_do_action',$action.data());break;default:this.do_warn("Kanban: no action for type : "+type);}},kanban_compute_domain:function(domain){return data.compute_domain(domain,this.values);},update_record:function(event){this.trigger_up('kanban_record_update',event.data);},setup_color_picker:function(){var self=this;var $colorpicker=this.$('ul.oe_kanban_colorpicker');if(!$colorpicker.length){return;}
$colorpicker.html(QWeb.render('KanbanColorPicker',{widget:this}));$colorpicker.on('click','a',function(ev){ev.preventDefault();var color_field=$colorpicker.data('field')||'color';var data={};data[color_field]=$(this).data('color');self.trigger_up('kanban_record_update',data);});},});return KanbanRecord;});;

/* /web_kanban/static/src/js/kanban_relational.js defined in bundle 'web.assets_backend' */
odoo.define('web_kanban.Many2ManyKanbanView',function(require){"use strict";var common=require('web.form_common');var core=require('web.core');var data=require('web.data');var KanbanView=require('web_kanban.KanbanView');var _t=core._t;var X2ManyKanbanView=KanbanView.extend({render_pager:function($node,options){options=_.extend(options||{},{single_page_hidden:true,});this._super($node,options);},});var One2ManyKanbanView=X2ManyKanbanView.extend({add_record:function(){var self=this;new common.FormViewDialog(this,{res_model:self.x2m.field.relation,domain:self.x2m.build_domain(),context:self.x2m.build_context(),title:_t("Create: ")+self.x2m.string,initial_view:"form",alternative_form_view:self.x2m.field.views?self.x2m.field.views.form:undefined,create_function:function(data,options){return self.x2m.data_create(data,options);},read_function:function(ids,fields,options){return self.x2m.data_read(ids,fields,options);},parent_view:self.x2m.view,child_name:self.x2m.name,form_view_options:{'not_interactible_on_create':true},on_selected:function(){self.x2m.reload_current_view();}}).open();},});var Many2ManyKanbanView=X2ManyKanbanView.extend({add_record:function(){var self=this;new common.SelectCreateDialog(this,{res_model:this.x2m.field.relation,domain:new data.CompoundDomain(this.x2m.build_domain(),["!",["id","in",this.dataset.ids]]),context:this.x2m.build_context(),title:_t("Add: ")+this.x2m.string,on_selected:function(element_ids){return self.x2m.data_link_multi(element_ids).then(function(){self.x2m.reload_current_view();});}}).open();},open_record:function(event){var self=this;new common.FormViewDialog(this,{res_model:this.x2m.field.relation,res_id:event.data.id,context:this.x2m.build_context(),title:_t("Open: ")+this.x2m.string,write_function:function(id,data,options){return self.x2m.data_update(id,data,options).done(function(){self.x2m.reload_current_view();});},alternative_form_view:this.x2m.field.views?this.x2m.field.views.form:undefined,parent_view:this.x2m.view,child_name:this.x2m.name,read_function:function(ids,fields,options){return self.x2m.data_read(ids,fields,options);},form_view_options:{'not_interactible_on_create':true},readonly:!this.is_action_enabled('edit')||this.x2m.get("effective_readonly")}).open();},});core.view_registry.add('one2many_kanban',One2ManyKanbanView);core.view_registry.add('many2many_kanban',Many2ManyKanbanView);});;

/* /web_kanban/static/src/js/kanban_quick_create.js defined in bundle 'web.assets_backend' */
odoo.define('web_kanban.quick_create',function(require){"use strict";var Widget=require('web.Widget');var RecordQuickCreate=Widget.extend({template:"KanbanView.QuickCreate",events:{'click .o_kanban_cancel':function(event){this.cancel();},'click .o_kanban_add':function(event){this.add_record();},'keypress input':function(event){if(event.keyCode===13){this.add_record();}},'keydown':function(event){if(event.keyCode===27){this.cancel();}},'mousedown .o_kanban_add':'suppress','mousedown .o_kanban_cancel':'suppress',},init:function(parent,width){this._super(parent);this.width=width;},start:function(){this.$el.css({width:this.width});this.$input=this.$('input');this.$input.focus();},cancel:function(){this.trigger_up('cancel_quick_create');},add_record:function(){var value=this.$input.val();this.$input.val('');if(/^\s*$/.test(value)){return;}
this.trigger_up('quick_create_add_record',{value:value});this.$input.focus();},suppress:function(e){e.preventDefault();},});var ColumnQuickCreate=Widget.extend({template:'KanbanView.ColumnQuickCreate',events:{'click':'toggle','click .o_kanban_add':function(event){event.stopPropagation();this.add_column();},'click .o_kanban_cancel':function(event){this.folded=true;this.update();},'click .o_kanban_quick_create':function(event){event.stopPropagation();},'keypress input':function(event){if(event.keyCode===13){this.add_column();}},'keydown':function(event){if(event.keyCode===27){this.folded=true;this.update();}},'focusout':function(){var hasFocus=this.$(':focus').length>0;if(hasFocus){return;}
this.folded=true;this.$input.val('');this.update();},'mousedown .o_kanban_add':'suppress','mousedown .o_kanban_cancel':'suppress',},init:function(parent){this._super(parent);this.folded=true;},start:function(){this.$header=this.$('.o_column_header');this.$quick_create=this.$('.o_kanban_quick_create');this.$input=this.$('input');},toggle:function(){this.folded=!this.folded;this.update();if(!this.folded){this.$input.focus();this.trigger_up('scrollTo',{selector:'.o_column_quick_create'});}},update:function(){this.$header.toggle(this.folded);this.$quick_create.toggle(!this.folded);},add_column:function(){var name=this.$input.val();this.$input.val('');if(/^\s*$/.test(name)){return;}
this.trigger_up('quick_create_add_column',{value:name});this.$input.focus();},suppress:function(e){e.preventDefault();},});return{RecordQuickCreate:RecordQuickCreate,ColumnQuickCreate:ColumnQuickCreate,};});;

/* /web_kanban/static/src/js/kanban_column.js defined in bundle 'web.assets_backend' */
odoo.define('web_kanban.Column',function(require){"use strict";var config=require('web.config');var core=require('web.core');var Dialog=require('web.Dialog');var form_common=require('web.form_common');var Widget=require('web.Widget');var quick_create=require('web_kanban.quick_create');var KanbanRecord=require('web_kanban.Record');var _t=core._t;var QWeb=core.qweb;var RecordQuickCreate=quick_create.RecordQuickCreate;var KanbanColumn=Widget.extend({template:"KanbanView.Group",events:{'click .o_kanban_toggle_fold':function(e){e.preventDefault();e.stopPropagation();this.folded=true;this.update_column();},'click .o_column_edit':'edit_column','click .o_column_delete':'delete_column','click .o_column_archive':'archive_records','click .o_column_unarchive':'unarchive_records','click .o_kanban_quick_add':'add_quick_create','click .o_kanban_load_more':'load_more',},custom_events:{'kanban_record_delete':'delete_record','cancel_quick_create':'cancel_quick_create','quick_create_add_record':'quick_create_add_record',},init:function(parent,group_data,options,record_options){this._super(parent);this.data_records=group_data.records;this.dataset=group_data.dataset;this.records=[];this.title=group_data.title;this.id=group_data.id;this.folded=group_data.attributes.folded;this.fields=options.fields;this.values=group_data.values;this.quick_create=options.quick_create;this.grouped_by_m2o=options.grouped_by_m2o;this.editable=options.editable;this.deletable=options.deletable;this.has_active_field=options.has_active_field;this.records_editable=options.records_editable;this.records_deletable=options.records_deletable;this.relation=options.relation;this.offset=0;this.remaining=this.dataset.size()-this.data_records.length;this.record_options=_.extend(_.clone(record_options),{group_info:this.values,});var self=this;if(group_data.options&&group_data.options.group_by_tooltip){this.tooltip_info=_.map(group_data.options.group_by_tooltip,function(key,value,list){return(self.values&&self.values[value]&&"<div>"+key+"<br>"+self.values[value]+"</div>")||'';}).join('');}else{this.tooltip_info="";}},start:function(){var self=this;this.$header=this.$('.o_kanban_header');for(var i=0;i<this.data_records.length;i++){this.add_record(this.data_records[i],{no_update:true});}
this.$header.tooltip();if(config.device.size_class>config.device.SIZES.XS){this.$el.sortable({connectWith:'.o_kanban_group',revert:0,delay:0,items:'> .o_kanban_record',helper:'clone',cursor:'move',over:function(){self.$el.addClass('o_kanban_hover');self.update_column();},out:function(){self.$el.removeClass('o_kanban_hover');},update:function(event,ui){var record=ui.item.data('record');var index=self.records.indexOf(record);var test2=$.contains(self.$el[0],record.$el[0]);record.$el.removeAttr('style');if(index>=0&&test2){self.trigger_up('kanban_column_resequence');}else if(index>=0&&!test2){self.records.splice(self.records.indexOf(record),1);self.dataset.remove_ids([record.id]);}else{self.records.push(record);record.setParent(self);self.trigger_up('kanban_column_add_record',{record:record});}
self.update_column();}});}
this.update_column();this.$el.click(function(event){if(self.$el.hasClass('o_column_folded')){event.preventDefault();self.folded=false;self.update_column();}});},is_empty:function(){return!this.records.length;},add_record:function(data,options){var record=new KanbanRecord(this,data,this.record_options);this.records.push(record);this.dataset.ids=_.uniq(this.dataset.ids.concat(record.id));if(options.position==='before'){record.insertAfter(this.quick_create_widget?this.quick_create_widget.$el:this.$header);}else{var $load_more=this.$('.o_kanban_load_more');if($load_more.length){record.insertBefore($load_more);}else{record.appendTo(this.$el);}}
if(!options.no_update){this.update_column();}},get_ids:function(){var ids=[];this.$('.o_kanban_record').each(function(index,r){ids.push($(r).data('record').id);});return ids;},update_column:function(){var title=this.folded?this.title+' ('+this.dataset.size()+')':this.title;this.$header.find('.o_column_title').text(title);this.$header.find('.o-kanban-count').text(this.records.length);this.$el.toggleClass('o_column_folded',this.folded);var tooltip;if(this.remaining){tooltip=this.records.length+'/'+this.dataset.size()+_t(' records');}else{tooltip=this.records.length+_t(' records');}
tooltip='<p>'+tooltip+'</p>'+this.tooltip_info;this.$header.tooltip({html:true}).attr('data-original-title',tooltip);if(!this.remaining){this.$('.o_kanban_load_more').remove();}else{this.$('.o_kanban_load_more').html(QWeb.render('KanbanView.LoadMore',{widget:this}))}},archive_records:function(event){event.preventDefault();this.trigger_up('kanban_column_archive_records',{archive:true});},unarchive_records:function(event){event.preventDefault();this.trigger_up('kanban_column_archive_records',{archive:false});},delete_column:function(event){event.preventDefault();var buttons=[{text:_t("Ok"),classes:'btn-primary',close:true,click:this.trigger_up.bind(this,'kanban_column_delete')},{text:_t("Cancel"),close:true}];new Dialog(this,{size:'medium',buttons:buttons,$content:$('<div>',{text:_t("Are you sure that you want to remove this column ?")}),}).open();},edit_column:function(event){event.preventDefault();var dialog=new form_common.FormViewDialog(this,{res_model:this.relation,res_id:this.id,title:_t("Edit Column"),}).open();dialog.on('record_saved',this,function(){this.trigger_up('kanban_reload');});},delete_record:function(event){event.stopped=false;var self=this;event.data.after=function cleanup(){var index=self.records.indexOf(event.data.record);self.records.splice(index,1);self.update_column();};},add_quick_create:function(){if(this.quick_create_widget){return;}
var self=this;var width=this.records.length?this.records[0].$el.innerWidth():this.$el.width()-8;this.quick_create_widget=new RecordQuickCreate(this,width);this.quick_create_widget.insertAfter(this.$header);this.quick_create_widget.$el.focusout(function(){var hasFocus=(self.quick_create_widget.$(':focus').length>0);if(!hasFocus&&self.quick_create_widget){self.cancel_quick_create();}});},cancel_quick_create:function(){this.quick_create_widget.destroy();this.quick_create_widget=undefined;},quick_create_add_record:function(event){this.trigger_up('column_add_record',event.data);},load_more:function(event){event.preventDefault();this.trigger_up('kanban_load_more');},});return KanbanColumn;});;

/* /web_kanban/static/src/js/kanban_view.js defined in bundle 'web.assets_backend' */
odoo.define('web_kanban.KanbanView',function(require){"use strict";var core=require('web.core');var data=require('web.data');var Model=require('web.DataModel');var Dialog=require('web.Dialog');var form_common=require('web.form_common');var Pager=require('web.Pager');var pyeval=require('web.pyeval');var session=require('web.session');var utils=require('web.utils');var View=require('web.View');var KanbanColumn=require('web_kanban.Column');var quick_create=require('web_kanban.quick_create');var KanbanRecord=require('web_kanban.Record');var kanban_widgets=require('web_kanban.widgets');var QWeb=core.qweb;var _lt=core._lt;var _t=core._t;var ColumnQuickCreate=quick_create.ColumnQuickCreate;var fields_registry=kanban_widgets.registry;var KanbanView=View.extend({accesskey:"K",className:"o_kanban_view",display_name:_lt("Kanban"),icon:'fa-th-large',mobile_friendly:true,view_type:"kanban",custom_events:{'kanban_record_open':'open_record','kanban_record_edit':'edit_record','kanban_record_delete':'delete_record','kanban_do_action':'open_action','kanban_reload':'do_reload','kanban_column_resequence':function(event){this.resequence_column(event.target);},'kanban_record_update':'update_record','kanban_column_add_record':'add_record_to_column','kanban_column_delete':'delete_column','kanban_column_archive_records':'archive_records','column_add_record':'column_add_record','quick_create_add_column':'add_new_column','kanban_load_more':'load_more','kanban_call_method':'call_method',},init:function(parent,dataset,view_id,options){this._super(parent,dataset,view_id,options);_.defaults(this.options,{"quick_creatable":false,"creatable":true,"create_text":undefined,"read_only_mode":false,"confirm_on_delete":true,});this.qweb=new QWeb2.Engine();this.qweb.debug=session.debug;this.qweb.default_dict=_.clone(QWeb.default_dict);this.model=this.dataset.model;this.limit=options.limit||40;this.grouped=undefined;this.group_by_field=undefined;this.default_group_by=undefined;this.grouped_by_m2o=undefined;this.relation=undefined;this.is_empty=undefined;this.many2manys=[];this.m2m_context={};this.widgets=[];this.data=undefined;this.model=dataset.model;this.quick_creatable=options.quick_creatable;this.no_content_msg=options.action&&(options.action.get_empty_list_help||options.action.help);this.search_orderer=new utils.DropMisordered();},view_loading:function(fvg){this.$el.addClass(fvg.arch.attrs.class);this.fields_view=fvg;this.default_group_by=fvg.arch.attrs.default_group_by;this.fields_keys=_.keys(this.fields_view.fields);var default_order=this.fields_view.arch.attrs.default_order;if(!this.dataset._sort.length&&default_order){this.dataset.set_sort(default_order.split(','));}
for(var i=0,ii=this.fields_view.arch.children.length;i<ii;i++){var child=this.fields_view.arch.children[i];if(child.tag==="templates"){transform_qweb_template(child,fvg,this.many2manys);this.qweb.add_template(utils.json_node_to_xml(child));break;}else if(child.tag==='field'){var ftype=child.attrs.widget||this.fields_view.fields[child.attrs.name].type;if(ftype=="many2many"&&"context"in child.attrs){this.m2m_context[child.attrs.name]=child.attrs.context;}}}
this.trigger('kanban_view_loaded');},do_search:function(domain,context,group_by){var self=this;var group_by_field=group_by[0]||this.default_group_by;var field=this.fields_view.fields[group_by_field];var grouped_by_m2o=field&&(field.type==='many2one');var options={search_domain:domain,search_context:context,group_by_field:group_by_field,grouped:group_by.length||this.default_group_by,grouped_by_m2o:grouped_by_m2o,relation:(grouped_by_m2o?field.relation:undefined),};return this.search_orderer.add(options.grouped?this.load_groups(options):this.load_records()).then(function(data){_.extend(self,options);if(options.grouped){var new_ids=_.union.apply(null,_.map(data.groups,function(group){return group.dataset.ids;}));self.dataset.alter_ids(new_ids);}
self.data=data;}).then(this.proxy('render')).then(this.proxy('update_pager'));},do_show:function(){this.do_push_state({});return this._super();},do_reload:function(){this.do_search(this.search_domain,this.search_context,[this.group_by_field]);},load_records:function(offset,dataset){var options={'limit':this.limit,'offset':offset,};dataset=dataset||this.dataset;return dataset.read_slice(this.fields_keys.concat(['__last_update']),options).then(function(records){return{records:records,is_empty:!records.length,grouped:false,};});},load_groups:function(options){var self=this;var group_by_field=options.group_by_field;var fields_keys=_.uniq(this.fields_keys.concat(group_by_field));return new Model(this.model,options.search_context,options.search_domain).query(fields_keys).group_by([group_by_field]).then(function(groups){var group_by_fields_to_read=[];var group_options={};var recurse=function(node){if(node.tag==="field"&&node.attrs&&node.attrs.options&&node.attrs.name===group_by_field){var options=pyeval.py_eval(node.attrs.options);group_options=options;var states_fields_to_read=_.map(options&&options.states_legend||{},function(value,key,list){return value;});var tooltip_fields_to_read=_.map(options&&options.group_by_tooltip||{},function(value,key,list){return key;});group_by_fields_to_read=_.union(group_by_fields_to_read,states_fields_to_read,tooltip_fields_to_read);return;}
_.each(node.children,function(child){recurse(child);});};recurse(self.fields_view.arch);var group_ids=_.without(_.map(groups,function(elem){return elem.attributes.value[0];}),undefined);if(options.grouped_by_m2o&&group_ids.length){return new data.DataSet(self,options.relation).read_ids(group_ids,_.union(['display_name'],group_by_fields_to_read)).then(function(results){_.each(groups,function(group){var group_id=group.attributes.value[0];var result=_.find(results,function(data){return group_id===data.id;});group.title=result?result.display_name:_t("Undefined");group.values=result;group.id=group_id;group.options=group_options;});return groups;});}else{_.each(groups,function(group){var value=group.attributes.value;group.id=value instanceof Array?value[0]:value;var field=self.fields_view.fields[options.group_by_field];if(field&&field.type==="selection"){value=_.find(field.selection,function(s){return s[0]===group.id;});}
group.title=(value instanceof Array?value[1]:value)||_t("Undefined");group.values={};});return $.when(groups);}}).then(function(groups){var undef_index=_.findIndex(groups,function(g){return g.title===_t("Undefined");});if(undef_index>=1){var undef_group=groups[undef_index];groups.splice(undef_index,1);groups.unshift(undef_group);}
return groups;}).then(function(groups){var is_empty=true;return $.when.apply(null,_.map(groups,function(group){var def=$.when([]);var dataset=new data.DataSetSearch(self,self.dataset.model,new data.CompoundContext(self.dataset.get_context(),group.model.context()),group.model.domain());if(self.dataset._sort){dataset.set_sort(self.dataset._sort);}
if(group.attributes.length>=1){def=dataset.read_slice(self.fields_keys.concat(['__last_update']),{'limit':self.limit});}
return def.then(function(records){self.dataset.ids.push.apply(self.dataset.ids,_.difference(dataset.ids,self.dataset.ids));group.records=records;group.dataset=dataset;is_empty=is_empty&&!records.length;return group;});})).then(function(){return{groups:Array.prototype.slice.call(arguments,0),is_empty:is_empty,grouped:true,};});});},is_action_enabled:function(action){if(action==='create'&&!this.options.creatable){return false;}
return this._super(action);},has_active_field:function(){return this.fields_view.fields.active;},_is_quick_create_enabled:function(){if(!this.quick_creatable||!this.is_action_enabled('create'))
return false;if(this.fields_view.arch.attrs.quick_create!==undefined)
return JSON.parse(this.fields_view.arch.attrs.quick_create);return!!this.grouped;},render_buttons:function($node){var display=false;if(this.options.action_buttons!==false){display=this.is_action_enabled('create');}else if(!this.view_id&&!this.options.read_only_mode){display=this.is_action_enabled('write')||this.is_action_enabled('create');}
this.$buttons=$(QWeb.render("KanbanView.buttons",{'widget':this,display:display}));this.$buttons.on('click','button.o-kanban-button-new',this.add_record.bind(this));$node=$node||this.options.$buttons;this.$buttons.appendTo($node);},render_pager:function($node,options){var self=this;this.pager=new Pager(this,this.dataset.size(),1,this.limit,options);this.pager.appendTo($node);this.pager.on('pager_changed',this,function(state){var limit_changed=(self.limit!==state.limit);self.limit=state.limit;self.load_records(state.current_min-1).then(function(data){self.data=data;if(!limit_changed){self.scrollTop=0;self.trigger_up('scrollTo',{offset:0});}}).done(this.proxy('render'));});this.update_pager();},update_pager:function(){if(this.pager){if(this.grouped){this.pager.do_hide();}else{this.pager.update_state({size:this.dataset.size(),current_min:1});}}},render:function(){this.$el.css({display:'-webkit-flex'});this.$el.css({display:'flex'});this.$el.removeClass('o_kanban_ungrouped o_kanban_grouped');_.invoke(this.widgets,'destroy');this.$el.empty();this.widgets=[];if(this.column_quick_create){this.column_quick_create.destroy();this.column_quick_create=undefined;}
this.record_options={editable:this.is_action_enabled('edit'),deletable:this.is_action_enabled('delete'),fields:this.fields_view.fields,qweb:this.qweb,model:this.model,read_only_mode:this.options.read_only_mode,};var fragment=document.createDocumentFragment();if(this.data.grouped){this.$el.addClass('o_kanban_grouped');this.render_grouped(fragment);}else if(this.data.is_empty){this.$el.addClass('o_kanban_ungrouped');this.render_no_content(fragment);}else{this.$el.addClass('o_kanban_ungrouped');this.render_ungrouped(fragment);}
this.$el.append(fragment);},render_no_content:function(fragment){var content=QWeb.render('KanbanView.nocontent',{content:this.no_content_msg});$(content).appendTo(fragment);},render_ungrouped:function(fragment){var self=this;var options=_.clone(this.record_options);_.each(this.data.records,function(record){var kanban_record=new KanbanRecord(self,record,options);self.widgets.push(kanban_record);kanban_record.appendTo(fragment);});for(var i=0,ghost_div;i<6;i++){ghost_div=$("<div>").addClass("o_kanban_record o_kanban_ghost");ghost_div.appendTo(fragment);}
this.postprocess_m2m_tags();},get_column_options:function(){return{editable:this.is_action_enabled('group_edit'),deletable:this.is_action_enabled('group_delete'),has_active_field:this.has_active_field(),grouped_by_m2o:this.grouped_by_m2o,relation:this.relation,qweb:this.qweb,fields:this.fields_view.fields,quick_create:this._is_quick_create_enabled(),};},render_grouped:function(fragment){var self=this;var record_options=_.extend(this.record_options,{draggable:true,});var column_options=this.get_column_options();_.each(this.data.groups,function(group){var column=new KanbanColumn(self,group,column_options,record_options);column.appendTo(fragment);self.widgets.push(column);});this.$el.sortable({axis:'x',items:'> .o_kanban_group',handle:'.o_kanban_header',cursor:'move',revert:150,delay:100,tolerance:'pointer',forcePlaceholderSize:true,stop:function(){var ids=[];self.$('.o_kanban_group').each(function(index,u){ids.push($(u).data('id'));});self.resequence(ids);},});if(this.is_action_enabled('group_create')&&this.grouped_by_m2o){this.column_quick_create=new ColumnQuickCreate(this);this.column_quick_create.appendTo(fragment);}
this.postprocess_m2m_tags();},add_record:function(){this.dataset.index=null;this.do_switch_view('form');},open_record:function(event,options){if(this.dataset.select_id(event.data.id)){this.do_switch_view('form',true,options);}else{this.do_warn("Kanban: could not find id#"+event.data.id);}},edit_record:function(event){this.open_record(event,{mode:'edit'});},delete_record:function(event){var self=this;var record=event.data.record;function do_it(){return $.when(self.dataset.unlink([record.id])).done(function(){record.destroy();if(event.data.after){event.data.after();}});}
if(this.options.confirm_on_delete){Dialog.confirm(this,_t("Are you sure you want to delete this record ?"),{confirm_callback:do_it});}else{do_it();}},open_action:function(event){var self=this;var node_context=event.data.context||{};var context=new data.CompoundContext(node_context);context.set_eval_context({active_id:event.target.id,active_ids:[event.target.id],active_model:this.dataset.model,});this.do_execute_action(event.data,this.dataset,event.target.id).then(function(){self.reload_record(event.target);});},postprocess_m2m_tags:function(records){var self=this;if(!this.many2manys.length){return;}
var relations={};records=records?(records instanceof Array?records:[records]):this.grouped?Array.prototype.concat.apply([],_.pluck(this.widgets,'records')):this.widgets;records.forEach(function(record){self.many2manys.forEach(function(name){var field=record.record[name];var $el=record.$('.oe_form_field.o_form_field_many2manytags[name='+name+']');if(!$el[0]){return;}
if(!relations[field.relation]){relations[field.relation]={ids:[],elements:{},context:self.m2m_context[name]};}
var rel=relations[field.relation];field.raw_value.forEach(function(id){rel.ids.push(id);if(!rel.elements[id]){rel.elements[id]=[];}
rel.elements[id].push($el[0]);});});});_.each(relations,function(rel,rel_name){var dataset=new data.DataSetSearch(self,rel_name,self.dataset.get_context(rel.context));dataset.read_ids(_.uniq(rel.ids),['name','color']).done(function(result){result.forEach(function(record){if(record.color){var $tag=$('<span>').addClass('badge o_tag o_tag_color_'+record.color).attr('title',_.str.escapeHTML(record.name)).text(record.name);$(rel.elements[record.id]).append($tag);}});self.$('span.o_tag').tooltip({delay:{'show':50}});});});},resequence:function(ids){if((ids.length<=1)||!this.relation){return;}
new data.DataSet(this,this.relation).resequence(ids).done(function(r){if(!r){console.warn('Resequence could not be complete. '+'Maybe the model does not have a "sequence" field?');}});},resequence_column:function(col){if(_.indexOf(this.fields_keys,'sequence')>-1){this.dataset.resequence(col.get_ids());}},delete_column:function(event){var self=this;var column=event.target;(new data.DataSet(this,this.relation)).unlink([column.id]).done(function(){if(column.is_empty()){var index=self.widgets.indexOf(column);self.widgets.splice(index,1);column.destroy();}else{self.do_reload();}});},archive_records:function(event){if(!this.has_active_field()){return;}
var active_value=!event.data.archive;var record_ids=[];_.each(event.target.records,function(kanban_record){if(kanban_record.record.active.value!=active_value){record_ids.push(kanban_record.id);}});if(record_ids.length){this.dataset.call('write',[record_ids,{active:active_value}]).done(this.do_reload);}},reload_record:function(record){var self=this;this.dataset.read_ids([record.id],this.fields_keys.concat(['__last_update'])).done(function(records){if(records.length){record.update(records[0]);self.postprocess_m2m_tags(record);}else{record.destroy();}});},add_record_to_column:function(event){var self=this;var column=event.target;var record=event.data.record;var data={};data[this.group_by_field]=event.target.id;this.dataset.write(record.id,data,{}).done(function(){if(!self.isDestroyed()){self.reload_record(record);self.resequence_column(column);}}).fail(this.do_reload);},update_record:function(event){var self=this;var record=event.target;return this.dataset.write(record.id,event.data).done(function(){if(!self.isDestroyed()){self.reload_record(record);}});},column_add_record:function(event){var self=this;var column=event.target;var context={};context['default_'+this.group_by_field]=column.id;var name=event.data.value;this.dataset.name_create(name,context).then(function on_success(data){add_record(data[0]);},function on_fail(event){event.preventDefault();var popup=new form_common.SelectCreatePopup(this);popup.select_element(self.dataset.model,{title:_t("Create: "),initial_view:"form",disable_multiple_selection:true},[],{"default_name":name});popup.on("elements_selected",self,function(element_ids){add_record(element_ids[0]);});});function add_record(id){self.dataset.add_ids([id],-1);self.dataset.read_ids([id],self.fields_keys.concat(['__last_update'])).done(function(record){column.add_record(record[0],{position:'before'});});}},add_new_column:function(event){var self=this;var model=new Model(this.relation,this.search_context);model.call('create',[{name:event.data.value}],{context:this.search_context,}).then(function(id){var dataset=new data.DataSetSearch(self,self.dataset.model,self.dataset.get_context(),[]);var group_data={records:[],title:event.data.value,id:id,attributes:{folded:false},dataset:dataset,values:{},};var options=self.get_column_options();var record_options=_.clone(self.record_options);var column=new KanbanColumn(self,group_data,options,record_options);column.insertBefore(self.$('.o_column_quick_create'));self.widgets.push(column);self.trigger_up('scrollTo',{selector:'.o_column_quick_create'});});},load_more:function(event){var self=this;var column=event.target;var offset=column.offset+this.limit;return this.load_records(offset,column.dataset).then(function(result){_.each(result.records,function(r){column.add_record(r,{no_update:true});self.dataset.add_ids([r.id]);});column.offset+=self.limit;column.remaining=Math.max(column.remaining-self.limit,0);column.update_column();self.postprocess_m2m_tags(column.records.slice(column.offset));});},call_method:function(event){var data=event.data;this.dataset.call(data.method,data.params).then(function(){if(data.callback){data.callback();}});}});function qweb_add_if(node,condition){if(node.attrs[QWeb.prefix+'-if']){condition=_.str.sprintf("(%s) and (%s)",node.attrs[QWeb.prefix+'-if'],condition);}
node.attrs[QWeb.prefix+'-if']=condition;}
function transform_qweb_template(node,fvg,many2manys){if(node.tag&&node.attrs.modifiers){var modifiers=JSON.parse(node.attrs.modifiers||'{}');if(modifiers.invisible){qweb_add_if(node,_.str.sprintf("!kanban_compute_domain(%s)",JSON.stringify(modifiers.invisible)));}}
switch(node.tag){case'field':var ftype=fvg.fields[node.attrs.name].type;ftype=node.attrs.widget?node.attrs.widget:ftype;if(ftype==='many2many'){if(_.indexOf(many2manys,node.attrs.name)<0){many2manys.push(node.attrs.name);}
node.tag='div';node.attrs['class']=(node.attrs['class']||'')+' oe_form_field o_form_field_many2manytags o_kanban_tags';}else if(fields_registry.contains(ftype)){}else{node.tag=QWeb.prefix;node.attrs[QWeb.prefix+'-esc']='record.'+node.attrs.name+'.value';}
break;case'button':case'a':var type=node.attrs.type||'';if(_.indexOf('action,object,edit,open,delete,url,set_cover'.split(','),type)!==-1){_.each(node.attrs,function(v,k){if(_.indexOf('icon,type,name,args,string,context,states,kanban_states'.split(','),k)!=-1){node.attrs['data-'+k]=v;delete(node.attrs[k]);}});if(node.attrs['data-string']){node.attrs.title=node.attrs['data-string'];}
if(node.attrs['data-icon']){node.children=[{tag:'img',attrs:{src:session.prefix+'/web/static/src/img/icons/'+node.attrs['data-icon']+'.png',width:'16',height:'16'}}];}
if(node.tag=='a'&&node.attrs['data-type']!="url"){node.attrs.href='#';}else{node.attrs.type='button';}
node.attrs['class']=(node.attrs['class']||'')+' oe_kanban_action oe_kanban_action_'+node.tag;}
break;}
if(node.children){for(var i=0,ii=node.children.length;i<ii;i++){transform_qweb_template(node.children[i],fvg,many2manys);}}}
var One2ManyKanbanView=KanbanView.extend({render_pager:function($node,options){options=_.extend(options||{},{single_page_hidden:true,});this._super($node,options);},});core.view_registry.add('kanban',KanbanView);core.one2many_view_registry.add('kanban',One2ManyKanbanView);return KanbanView;});;

/* /web_kanban/static/src/js/kanban_widgets.js defined in bundle 'web.assets_backend' */
odoo.define('web_kanban.widgets',function(require){"use strict";var core=require('web.core');var formats=require('web.formats');var Priority=require('web.Priority');var ProgressBar=require('web.ProgressBar');var pyeval=require('web.pyeval');var Registry=require('web.Registry');var session=require('web.session');var Widget=require('web.Widget');var QWeb=core.qweb;var _t=core._t;var FieldInterface={init:function(parent,field,$node){},};var AbstractField=Widget.extend(FieldInterface,{init:function(parent,field,$node){this._super(parent);this.field=field;this.$node=$node;this.options=pyeval.py_eval(this.$node.attr("options")||'{}');this.set("value",field.raw_value);},});var FormatChar=AbstractField.extend({tagName:'span',init:function(parent,field,$node){this._super.apply(this,arguments);this.format_descriptor=_.extend({},this.field,{'widget':this.$node.attr('widget')});},renderElement:function(){this.$el.text(formats.format_value(this.field.raw_value,this.format_descriptor));}});var KanbanPriority=AbstractField.extend({init:function(parent,field,$node){this._super.apply(this,arguments);this.name=$node.attr('name');},renderElement:function(){this._super();this.set('readonly',!!(this.field&&this.field.readonly));},start:function(){this.priority=new Priority(this,{readonly:this.get('readonly'),value:this.get('value'),values:this.field.selection||[],});this.priority.on('update',this,function(update){var data={};data[this.name]=update.value;this.trigger_up('kanban_update_record',data);});this.on('change:readonly',this,function(){this.priority.readonly=this.get('readonly');var $div=$('<div/>').insertAfter(this.$el);this.priority.replace($div);this.setElement(this.priority.$el);});var self=this;return $.when(this._super(),this.priority.appendTo('<div>').done(function(){self.priority.$el.addClass(self.$el.attr('class'));self.replaceElement(self.priority.$el);}));},});var KanbanSelection=AbstractField.extend({init:function(parent,field,$node){this._super.apply(this,arguments);this.name=$node.attr('name');this.parent=parent;},prepare_dropdown_selection:function(){var self=this;var _data=[];var stage_id=self.parent.values.stage_id.value[0];var stage_data={id:stage_id,legend_normal:self.parent.values.legend_normal?self.parent.values.legend_normal.value:undefined,legend_blocked:self.parent.values.legend_blocked?self.parent.values.legend_blocked.value:undefined,legend_done:self.parent.values.legend_done?self.parent.values.legend_done.value:undefined,};_.map(self.field.selection||[],function(res){var value={'name':res[0],'tooltip':res[1],};if(res[0]==='normal'){value.state_name=stage_data.legend_normal?stage_data.legend_normal:res[1];}else if(res[0]==='done'){value.state_class='oe_kanban_status_green';value.state_name=stage_data.legend_done?stage_data.legend_done:res[1];}else{value.state_class='oe_kanban_status_red';value.state_name=stage_data.legend_blocked?stage_data.legend_blocked:res[1];}
_data.push(value);});return _data;},renderElement:function(){var self=this;var state;self.states=this.prepare_dropdown_selection();var current_state=_.find(this.states,function(state){return state.name===self.get('value');});self.$el=$(QWeb.render("KanbanSelection",{current_state_class:current_state.state_class,states:_.without(this.states,current_state)}));self.$('a').click(function(ev){ev.preventDefault();});self.$('a').click(self.set_kanban_selection.bind(self));},set_kanban_selection:function(e){e.preventDefault();var self=this;var $li=$(e.target).closest("li");if($li.length){var value={};value[self.name]=String($li.data('value'));this.trigger_up('kanban_update_record',value,this);}},});var KanbanAttachmentImage=AbstractField.extend({template:'KanbanAttachmentImage',});var KanbanProgressBar=AbstractField.extend({events:{'click':function(){if(!this.readonly&&this.progressbar.readonly){this.toggle_progressbar();}}},init:function(parent,field,node){this._super(parent,field,node);var record=this.getParent().record;this.progressbar=new ProgressBar(this,{readonly:true,value:record[this.options.current_value].raw_value,max_value:record[this.options.max_value].raw_value,title:_t(node&&node[0].title||this.options.title),edit_max_value:this.options.edit_max_value,});this.readonly=!this.options.editable;this.on_change=this.options.on_change;},start:function(){var self=this;var def=this.progressbar.appendTo('<div>').done(function(){self.progressbar.$el.addClass(self.$el.attr('class'));self.replaceElement(self.progressbar.$el);});return $.when(this._super(),def).then(function(){if(!self.readonly){var parent=self.getParent();self.progressbar.on('update',self,function(update){var value=update.changed_value;if(!isNaN(value)){var data={method:this.on_change,params:[parent.id,value],callback:self.proxy('toggle_progressbar'),};self.trigger_up('kanban_call_method',data);}});}});},toggle_progressbar:function(){this.progressbar.readonly=!this.progressbar.readonly;var $div=$('<div/>').insertAfter(this.$el);this.progressbar.replace($div);this.setElement(this.progressbar.$el);},});var KanbanMonetary=AbstractField.extend({tagName:'span',renderElement:function(){var kanban_view=this.getParent();var currency_field=(this.options&&this.options.currency_field)||'currency_id';var currency_id=kanban_view.values[currency_field].value[0];var currency=session.get_currency(currency_id);var digits_precision=this.options.digits||(currency&&currency.digits);var value=formats.format_value(this.field.raw_value||0,{type:this.field.type,digits:digits_precision});if(currency){if(currency.position==="after"){value+=currency.symbol;}else{value=currency.symbol+value;}}
this.$el.text(value);}});var fields_registry=new Registry();fields_registry.add('priority',KanbanPriority).add('kanban_state_selection',KanbanSelection).add("attachment_image",KanbanAttachmentImage).add('progress',KanbanProgressBar).add('float_time',FormatChar).add('monetary',KanbanMonetary);return{AbstractField:AbstractField,registry:fields_registry,};});;

/* /web_kanban/static/src/js/compatibility.js defined in bundle 'web.assets_backend' */
odoo.define('web_kanban.compatibility',function(require){"use strict";var kanban_widgets=require('web_kanban.widgets');var KanbanRecord=require('web_kanban.Record');var KanbanColumn=require('web_kanban.Column');var KanbanView=require('web_kanban.KanbanView');return;openerp=window.openerp||{};openerp.web_kanban=openerp.web_kanban||{};openerp.web_kanban.AbstractField=kanban_widgets.AbstractField;openerp.web_kanban.KanbanGroup=KanbanColumn;openerp.web_kanban.KanbanRecord=KanbanRecord;openerp.web_kanban.KanbanView=KanbanView;});;

/* /web_kanban_gauge/static/lib/justgage/justgage.js defined in bundle 'web.assets_backend' */
JustGage=function(config){var obj=this;obj.config={id:config.id,parentNode:(config.parentNode)?config.parentNode:null,width:(config.width)?config.width:null,height:(config.height)?config.height:null,title:(config.title)?config.title:"",titleFontColor:(config.titleFontColor)?config.titleFontColor:"#999999",value:(config.value)?config.value:0,valueFontColor:(config.valueFontColor)?config.valueFontColor:"#010101",symbol:(config.symbol)?config.symbol:"",min:(config.min!==undefined)?parseFloat(config.min):0,max:(config.max!==undefined)?parseFloat(config.max):100,humanFriendlyDecimal:(config.humanFriendlyDecimal)?config.humanFriendlyDecimal:0,textRenderer:(config.textRenderer)?config.textRenderer:null,gaugeWidthScale:(config.gaugeWidthScale)?config.gaugeWidthScale:1.0,gaugeColor:(config.gaugeColor)?config.gaugeColor:"#edebeb",label:(config.label)?config.label:"",labelFontColor:(config.labelFontColor)?config.labelFontColor:"#b3b3b3",shadowOpacity:(config.shadowOpacity)?config.shadowOpacity:0.2,shadowSize:(config.shadowSize)?config.shadowSize:5,shadowVerticalOffset:(config.shadowVerticalOffset)?config.shadowVerticalOffset:3,levelColors:(config.levelColors)?config.levelColors:["#a9d70b","#f9c802","#ff0000"],startAnimationTime:(config.startAnimationTime)?config.startAnimationTime:700,startAnimationType:(config.startAnimationType)?config.startAnimationType:">",refreshAnimationTime:(config.refreshAnimationTime)?config.refreshAnimationTime:700,refreshAnimationType:(config.refreshAnimationType)?config.refreshAnimationType:">",donutStartAngle:(config.donutStartAngle)?config.donutStartAngle:90,valueMinFontSize:config.valueMinFontSize||16,titleMinFontSize:config.titleMinFontSize||10,labelMinFontSize:config.labelMinFontSize||10,minLabelMinFontSize:config.minLabelMinFontSize||10,maxLabelMinFontSize:config.maxLabelMinFontSize||10,hideValue:(config.hideValue)?config.hideValue:false,hideMinMax:(config.hideMinMax)?config.hideMinMax:false,hideInnerShadow:(config.hideInnerShadow)?config.hideInnerShadow:false,humanFriendly:(config.humanFriendly)?config.humanFriendly:false,noGradient:(config.noGradient)?config.noGradient:false,donut:(config.donut)?config.donut:false,relativeGaugeSize:(config.relativeGaugeSize)?config.relativeGaugeSize:false,counter:(config.counter)?config.counter:false,decimals:(config.decimals)?config.decimals:0,customSectors:(config.customSectors)?config.customSectors:[]};var
canvasW,canvasH,widgetW,widgetH,aspect,dx,dy,titleFontSize,titleX,titleY,valueFontSize,valueX,valueY,labelFontSize,labelX,labelY,minFontSize,minX,minY,maxFontSize,maxX,maxY;if(obj.config.value>obj.config.max)obj.config.value=obj.config.max;if(obj.config.value<obj.config.min)obj.config.value=obj.config.min;obj.originalValue=config.value;if(obj.config.id!==null&&(document.getElementById(obj.config.id))!==null){obj.canvas=Raphael(obj.config.id,"100%","100%");}else if(obj.config.parentNode!==null){obj.canvas=Raphael(obj.config.parentNode,"100%","100%");}
if(obj.config.relativeGaugeSize===true){obj.canvas.setViewBox(0,0,200,150,false);}
if(obj.config.relativeGaugeSize===true){canvasW=200;canvasH=150;}else if(obj.config.width!==null&&obj.config.height!==null){canvasW=obj.config.width;canvasH=obj.config.height;}else if(obj.config.parentNode!==null){obj.canvas.setViewBox(0,0,200,150,false);canvasW=200;canvasH=150;}else{canvasW=getStyle(document.getElementById(obj.config.id),"width").slice(0,-2)*1;canvasH=getStyle(document.getElementById(obj.config.id),"height").slice(0,-2)*1;}
if(obj.config.donut===true){if(canvasW>canvasH){widgetH=canvasH;widgetW=widgetH;}else if(canvasW<canvasH){widgetW=canvasW;widgetH=widgetW;if(widgetH>canvasH){aspect=widgetH/canvasH;widgetH=widgetH/aspect;widgetW=widgetH/aspect;}}else{widgetW=canvasW;widgetH=widgetW;}
dx=(canvasW-widgetW)/2;dy=(canvasH-widgetH)/2;titleFontSize=((widgetH/8)>10)?(widgetH/10):10;titleX=dx+widgetW/2;titleY=dy+widgetH/11;valueFontSize=((widgetH/6.4)>16)?(widgetH/5.4):18;valueX=dx+widgetW/2;if(obj.config.label!==''){valueY=dy+widgetH/1.85;}else{valueY=dy+widgetH/1.7;}
labelFontSize=((widgetH/16)>10)?(widgetH/16):10;labelX=dx+widgetW/2;labelY=valueY+labelFontSize;minFontSize=((widgetH/16)>10)?(widgetH/16):10;minX=dx+(widgetW/10)+(widgetW/6.666666666666667*obj.config.gaugeWidthScale)/2;minY=labelY;maxFontSize=((widgetH/16)>10)?(widgetH/16):10;maxX=dx+widgetW-(widgetW/10)-(widgetW/6.666666666666667*obj.config.gaugeWidthScale)/2;maxY=labelY;}else{if(canvasW>canvasH){widgetH=canvasH;widgetW=widgetH*1.25;if(widgetW>canvasW){aspect=widgetW/canvasW;widgetW=widgetW/aspect;widgetH=widgetH/aspect;}}else if(canvasW<canvasH){widgetW=canvasW;widgetH=widgetW/1.25;if(widgetH>canvasH){aspect=widgetH/canvasH;widgetH=widgetH/aspect;widgetW=widgetH/aspect;}}else{widgetW=canvasW;widgetH=widgetW*0.75;}
dx=(canvasW-widgetW)/2;dy=(canvasH-widgetH)/2;titleFontSize=((widgetH/8)>obj.config.titleMinFontSize)?(widgetH/10):obj.config.titleMinFontSize;titleX=dx+widgetW/2;titleY=dy+widgetH/6.4;valueFontSize=((widgetH/6.5)>obj.config.valueMinFontSize)?(widgetH/6.5):obj.config.valueMinFontSize;valueX=dx+widgetW/2;valueY=dy+widgetH/1.275;labelFontSize=((widgetH/16)>obj.config.labelMinFontSize)?(widgetH/16):obj.config.labelMinFontSize;labelX=dx+widgetW/2;labelY=valueY+valueFontSize/2+5;minFontSize=((widgetH/16)>obj.config.minLabelMinFontSize)?(widgetH/16):obj.config.minLabelMinFontSize;minX=dx+(widgetW/10)+(widgetW/6.666666666666667*obj.config.gaugeWidthScale)/2;minY=labelY;maxFontSize=((widgetH/16)>obj.config.maxLabelMinFontSize)?(widgetH/16):obj.config.maxLabelMinFontSize;maxX=dx+widgetW-(widgetW/10)-(widgetW/6.666666666666667*obj.config.gaugeWidthScale)/2;maxY=labelY;}
obj.params={canvasW:canvasW,canvasH:canvasH,widgetW:widgetW,widgetH:widgetH,dx:dx,dy:dy,titleFontSize:titleFontSize,titleX:titleX,titleY:titleY,valueFontSize:valueFontSize,valueX:valueX,valueY:valueY,labelFontSize:labelFontSize,labelX:labelX,labelY:labelY,minFontSize:minFontSize,minX:minX,minY:minY,maxFontSize:maxFontSize,maxX:maxX,maxY:maxY};canvasW,canvasH,widgetW,widgetH,aspect,dx,dy,titleFontSize,titleX,titleY,valueFontSize,valueX,valueY,labelFontSize,labelX,labelY,minFontSize,minX,minY,maxFontSize,maxX,maxY=null
obj.canvas.customAttributes.pki=function(value,min,max,w,h,dx,dy,gws,donut){var alpha,Ro,Ri,Cx,Cy,Xo,Yo,Xi,Yi,path;if(donut){alpha=(1-2*(value-min)/(max-min))*Math.PI;Ro=w/2-w/7;Ri=Ro-w/6.666666666666667*gws;Cx=w/2+dx;Cy=h/1.95+dy;Xo=w/2+dx+Ro*Math.cos(alpha);Yo=h-(h-Cy)+0-Ro*Math.sin(alpha);Xi=w/2+dx+Ri*Math.cos(alpha);Yi=h-(h-Cy)+0-Ri*Math.sin(alpha);path+="M"+(Cx-Ri)+","+Cy+" ";path+="L"+(Cx-Ro)+","+Cy+" ";if(value>((max-min)/2)){path+="A"+Ro+","+Ro+" 0 0 1 "+(Cx+Ro)+","+Cy+" ";}
path+="A"+Ro+","+Ro+" 0 0 1 "+Xo+","+Yo+" ";path+="L"+Xi+","+Yi+" ";if(value>((max-min)/2)){path+="A"+Ri+","+Ri+" 0 0 0 "+(Cx+Ri)+","+Cy+" ";}
path+="A"+Ri+","+Ri+" 0 0 0 "+(Cx-Ri)+","+Cy+" ";path+="Z ";return{path:path};}else{alpha=(1-(value-min)/(max-min))*Math.PI;Ro=w/2-w/10;Ri=Ro-w/6.666666666666667*gws;Cx=w/2+dx;Cy=h/1.25+dy;Xo=w/2+dx+Ro*Math.cos(alpha);Yo=h-(h-Cy)+0-Ro*Math.sin(alpha);Xi=w/2+dx+Ri*Math.cos(alpha);Yi=h-(h-Cy)+0-Ri*Math.sin(alpha);path+="M"+(Cx-Ri)+","+Cy+" ";path+="L"+(Cx-Ro)+","+Cy+" ";path+="A"+Ro+","+Ro+" 0 0 1 "+Xo+","+Yo+" ";path+="L"+Xi+","+Yi+" ";path+="A"+Ri+","+Ri+" 0 0 0 "+(Cx-Ri)+","+Cy+" ";path+="Z ";return{path:path};}
alpha,Ro,Ri,Cx,Cy,Xo,Yo,Xi,Yi,path=null;};obj.gauge=obj.canvas.path().attr({"stroke":"none","fill":obj.config.gaugeColor,pki:[obj.config.max,obj.config.min,obj.config.max,obj.params.widgetW,obj.params.widgetH,obj.params.dx,obj.params.dy,obj.config.gaugeWidthScale,obj.config.donut]});obj.level=obj.canvas.path().attr({"stroke":"none","fill":getColor(obj.config.value,(obj.config.value-obj.config.min)/(obj.config.max-obj.config.min),obj.config.levelColors,obj.config.noGradient,obj.config.customSectors),pki:[obj.config.min,obj.config.min,obj.config.max,obj.params.widgetW,obj.params.widgetH,obj.params.dx,obj.params.dy,obj.config.gaugeWidthScale,obj.config.donut]});if(obj.config.donut){obj.level.transform("r"+obj.config.donutStartAngle+", "+(obj.params.widgetW/2+obj.params.dx)+", "+(obj.params.widgetH/1.95+obj.params.dy));}
obj.txtTitle=obj.canvas.text(obj.params.titleX,obj.params.titleY,obj.config.title);obj.txtTitle.attr({"font-size":obj.params.titleFontSize,"font-weight":"bold","font-family":"Arial","fill":obj.config.titleFontColor,"fill-opacity":"1"});setDy(obj.txtTitle,obj.params.titleFontSize,obj.params.titleY);obj.txtValue=obj.canvas.text(obj.params.valueX,obj.params.valueY,0);obj.txtValue.attr({"font-size":obj.params.valueFontSize,"font-weight":"bold","font-family":"Arial","fill":obj.config.valueFontColor,"fill-opacity":"0"});setDy(obj.txtValue,obj.params.valueFontSize,obj.params.valueY);obj.txtLabel=obj.canvas.text(obj.params.labelX,obj.params.labelY,obj.config.label);obj.txtLabel.attr({"font-size":obj.params.labelFontSize,"font-weight":"normal","font-family":"Arial","fill":obj.config.labelFontColor,"fill-opacity":"0"});setDy(obj.txtLabel,obj.params.labelFontSize,obj.params.labelY);obj.txtMinimum=obj.config.min;if(obj.config.humanFriendly)obj.txtMinimum=humanFriendlyNumber(obj.config.min,obj.config.humanFriendlyDecimal);obj.txtMin=obj.canvas.text(obj.params.minX,obj.params.minY,obj.txtMinimum);obj.txtMin.attr({"font-size":obj.params.minFontSize,"font-weight":"normal","font-family":"Arial","fill":obj.config.labelFontColor,"fill-opacity":(obj.config.hideMinMax||obj.config.donut)?"0":"1"});setDy(obj.txtMin,obj.params.minFontSize,obj.params.minY);obj.txtMaximum=obj.config.max;if(obj.config.humanFriendly)obj.txtMaximum=humanFriendlyNumber(obj.config.max,obj.config.humanFriendlyDecimal);obj.txtMax=obj.canvas.text(obj.params.maxX,obj.params.maxY,obj.txtMaximum);obj.txtMax.attr({"font-size":obj.params.maxFontSize,"font-weight":"normal","font-family":"Arial","fill":obj.config.labelFontColor,"fill-opacity":(obj.config.hideMinMax||obj.config.donut)?"0":"1"});setDy(obj.txtMax,obj.params.maxFontSize,obj.params.maxY);var defs=obj.canvas.canvas.childNodes[1];var svg="http://www.w3.org/2000/svg";if(ie<9){onCreateElementNsReady(function(){obj.generateShadow(svg,defs);});}else{obj.generateShadow(svg,defs);}
defs,svg=null;if(obj.config.textRenderer){obj.originalValue=obj.config.textRenderer(obj.originalValue);}else if(obj.config.humanFriendly){obj.originalValue=humanFriendlyNumber(obj.originalValue,obj.config.humanFriendlyDecimal)+obj.config.symbol;}else{obj.originalValue=(obj.originalValue*1).toFixed(obj.config.decimals)+obj.config.symbol;}
if(obj.config.counter===true){eve.on("raphael.anim.frame."+(obj.level.id),function(){var currentValue=obj.level.attr("pki");if(obj.config.textRenderer){obj.txtValue.attr("text",obj.config.textRenderer(Math.floor(currentValue[0])));}else if(obj.config.humanFriendly){obj.txtValue.attr("text",humanFriendlyNumber(Math.floor(currentValue[0]),obj.config.humanFriendlyDecimal)+obj.config.symbol);}else{obj.txtValue.attr("text",(currentValue[0]*1).toFixed(obj.config.decimals)+obj.config.symbol);}
setDy(obj.txtValue,obj.params.valueFontSize,obj.params.valueY);currentValue=null;});eve.on("raphael.anim.finish."+(obj.level.id),function(){obj.txtValue.attr({"text":obj.originalValue});setDy(obj.txtValue,obj.params.valueFontSize,obj.params.valueY);});}else{eve.on("raphael.anim.start."+(obj.level.id),function(){obj.txtValue.attr({"text":obj.originalValue});setDy(obj.txtValue,obj.params.valueFontSize,obj.params.valueY);});}
obj.level.animate({pki:[obj.config.value,obj.config.min,obj.config.max,obj.params.widgetW,obj.params.widgetH,obj.params.dx,obj.params.dy,obj.config.gaugeWidthScale,obj.config.donut]},obj.config.startAnimationTime,obj.config.startAnimationType);obj.txtValue.animate({"fill-opacity":(obj.config.hideValue)?"0":"1"},obj.config.startAnimationTime,obj.config.startAnimationType);obj.txtLabel.animate({"fill-opacity":"1"},obj.config.startAnimationTime,obj.config.startAnimationType);};JustGage.prototype.refresh=function(val,max){var obj=this;var displayVal,color,max=max||null;if(max!==null){obj.config.max=max;obj.txtMaximum=obj.config.max;if(obj.config.humanFriendly)obj.txtMaximum=humanFriendlyNumber(obj.config.max,obj.config.humanFriendlyDecimal);obj.txtMax.attr({"text":obj.txtMaximum});setDy(obj.txtMax,obj.params.maxFontSize,obj.params.maxY);}
displayVal=val;if((val*1)>(obj.config.max*1)){val=(obj.config.max*1);}
if((val*1)<(obj.config.min*1)){val=(obj.config.min*1);}
color=getColor(val,(val-obj.config.min)/(obj.config.max-obj.config.min),obj.config.levelColors,obj.config.noGradient,obj.config.customSectors);if(obj.config.textRenderer){displayVal=obj.config.textRenderer(displayVal);}else if(obj.config.humanFriendly){displayVal=humanFriendlyNumber(displayVal,obj.config.humanFriendlyDecimal)+obj.config.symbol;}else{displayVal=(displayVal*1).toFixed(obj.config.decimals)+obj.config.symbol;}
obj.originalValue=displayVal;obj.config.value=val*1;if(!obj.config.counter){obj.txtValue.attr({"text":displayVal});setDy(obj.txtValue,obj.params.valueFontSize,obj.params.valueY);}
obj.level.animate({pki:[obj.config.value,obj.config.min,obj.config.max,obj.params.widgetW,obj.params.widgetH,obj.params.dx,obj.params.dy,obj.config.gaugeWidthScale,obj.config.donut],"fill":color},obj.config.refreshAnimationTime,obj.config.refreshAnimationType);obj,displayVal,color,max=null;};JustGage.prototype.generateShadow=function(svg,defs){var obj=this;var gaussFilter,feOffset,feGaussianBlur,feComposite1,feFlood,feComposite2,feComposite3;gaussFilter=document.createElementNS(svg,"filter");gaussFilter.setAttribute("id","inner-shadow");defs.appendChild(gaussFilter);feOffset=document.createElementNS(svg,"feOffset");feOffset.setAttribute("dx",0);feOffset.setAttribute("dy",obj.config.shadowVerticalOffset);gaussFilter.appendChild(feOffset);feGaussianBlur=document.createElementNS(svg,"feGaussianBlur");feGaussianBlur.setAttribute("result","offset-blur");feGaussianBlur.setAttribute("stdDeviation",obj.config.shadowSize);gaussFilter.appendChild(feGaussianBlur);feComposite1=document.createElementNS(svg,"feComposite");feComposite1.setAttribute("operator","out");feComposite1.setAttribute("in","SourceGraphic");feComposite1.setAttribute("in2","offset-blur");feComposite1.setAttribute("result","inverse");gaussFilter.appendChild(feComposite1);feFlood=document.createElementNS(svg,"feFlood");feFlood.setAttribute("flood-color","black");feFlood.setAttribute("flood-opacity",obj.config.shadowOpacity);feFlood.setAttribute("result","color");gaussFilter.appendChild(feFlood);feComposite2=document.createElementNS(svg,"feComposite");feComposite2.setAttribute("operator","in");feComposite2.setAttribute("in","color");feComposite2.setAttribute("in2","inverse");feComposite2.setAttribute("result","shadow");gaussFilter.appendChild(feComposite2);feComposite3=document.createElementNS(svg,"feComposite");feComposite3.setAttribute("operator","over");feComposite3.setAttribute("in","shadow");feComposite3.setAttribute("in2","SourceGraphic");gaussFilter.appendChild(feComposite3);if(!obj.config.hideInnerShadow){obj.canvas.canvas.childNodes[2].setAttribute("filter","url(#inner-shadow)");obj.canvas.canvas.childNodes[3].setAttribute("filter","url(#inner-shadow)");}
gaussFilter,feOffset,feGaussianBlur,feComposite1,feFlood,feComposite2,feComposite3=null;};function getColor(val,pct,col,noGradient,custSec){var no,inc,colors,percentage,rval,gval,bval,lower,upper,range,rangePct,pctLower,pctUpper,color;var noGradient=noGradient||custSec.length>0;if(custSec.length>0){for(var i=0;i<custSec.length;i++){if(val>custSec[i].lo&&val<=custSec[i].hi){return custSec[i].color;}}}
no=col.length;if(no===1)return col[0];inc=(noGradient)?(1/no):(1/(no-1));colors=[];for(var i=0;i<col.length;i++){percentage=(noGradient)?(inc*(i+1)):(inc*i);rval=parseInt((cutHex(col[i])).substring(0,2),16);gval=parseInt((cutHex(col[i])).substring(2,4),16);bval=parseInt((cutHex(col[i])).substring(4,6),16);colors[i]={pct:percentage,color:{r:rval,g:gval,b:bval}};}
if(pct===0){return'rgb('+[colors[0].color.r,colors[0].color.g,colors[0].color.b].join(',')+')';}
for(var j=0;j<colors.length;j++){if(pct<=colors[j].pct){if(noGradient){return'rgb('+[colors[j].color.r,colors[j].color.g,colors[j].color.b].join(',')+')';}else{lower=colors[j-1];upper=colors[j];range=upper.pct-lower.pct;rangePct=(pct-lower.pct)/range;pctLower=1-rangePct;pctUpper=rangePct;color={r:Math.floor(lower.color.r*pctLower+upper.color.r*pctUpper),g:Math.floor(lower.color.g*pctLower+upper.color.g*pctUpper),b:Math.floor(lower.color.b*pctLower+upper.color.b*pctUpper)};return'rgb('+[color.r,color.g,color.b].join(',')+')';}}}}
function setDy(elem,fontSize,txtYpos){if((!ie||ie>8)&&elem.node.firstChild.attributes.dy){elem.node.firstChild.attributes.dy.value=0;}}
function getRandomInt(min,max){return Math.floor(Math.random()*(max-min+1))+min;}
function cutHex(str){return(str.charAt(0)=="#")?str.substring(1,7):str;}
function humanFriendlyNumber(n,d){var p,d2,i,s;p=Math.pow;d2=p(10,d);i=7;while(i){s=p(10,i--*3);if(s<=n){n=Math.round(n*d2/s)/d2+"KMGTPE"[i];}}
return n;}
function getStyle(oElm,strCssRule){var strValue="";if(document.defaultView&&document.defaultView.getComputedStyle){strValue=document.defaultView.getComputedStyle(oElm,"").getPropertyValue(strCssRule);}
else if(oElm.currentStyle){strCssRule=strCssRule.replace(/\-(\w)/g,function(strMatch,p1){return p1.toUpperCase();});strValue=oElm.currentStyle[strCssRule];}
return strValue;}
function onCreateElementNsReady(func){if(document.createElementNS!==undefined){func();}else{setTimeout(function(){onCreateElementNsReady(func);},100);}}
var ie=(function(){var undef,v=3,div=document.createElement('div'),all=div.getElementsByTagName('i');while(div.innerHTML='<!--[if gt IE '+(++v)+']><i></i><![endif]-->',all[0]);return v>4?v:undef;}());;

/* /web_kanban_gauge/static/src/js/kanban_gauge.js defined in bundle 'web.assets_backend' */
odoo.define('web_kanban_gauge.widget',function(require){"use strict";var core=require('web.core');var kanban_widgets=require('web_kanban.widgets');var AbstractField=kanban_widgets.AbstractField;var fields_registry=kanban_widgets.registry;var _t=core._t;var GaugeWidget=AbstractField.extend({className:"oe_gauge",start:function(){var self=this;var parent=this.getParent();var max_value=this.options.max_value||100;if(this.options.max_field){max_value=this.getParent().record[this.options.max_field].raw_value;}
var label=this.options.label||"";if(this.options.label_field){label=this.getParent().record[this.options.label_field].raw_value;}
var title=this.$node.html()||this.field.string;var val=this.field.raw_value;if(_.isArray(JSON.parse(val))){val=JSON.parse(val);}
var value=_.isArray(val)&&val.length?val[val.length-1]['value']:val;var gauge_value=value;if(this.options.gauge_value_field){gauge_value=this.getParent().record[this.options.gauge_value_field].raw_value;}
this.$el.empty().attr('style',this.$node.attr('style')+';position:relative; display:inline-block;');this.gage=new JustGage({parentNode:this.$el[0],value:value,title:title,min:0,max:max_value,relativeGaugeSize:true,humanFriendly:true,titleFontColor:'#333333',valueFontColor:'#333333',labelFontColor:'#000',label:label,levelColors:self.options.levelcolors||["#ff0000","#f9c802","#a9d70b"],customSectors:self.options.customsectors||undefined,});this.gage.refresh(value,max_value);var flag_open=false;if(this.options.on_change){var $svg=this.$el.find('svg');this.$el.click(function(event){event.stopPropagation();flag_open=false;if(!parent.view.is_action_enabled('edit')){return;}
$svg.fadeTo(0,0.2);if(!self.$el.find(".oe_justgage_edit").size()){var $div=$('<div class="oe_justgage_edit" style="z-index:1"/>');$div.css({'text-align':'center','position':'absolute','width':self.$el.outerWidth()+'px','top':(self.$el.outerHeight()/2-5)+'px'});var $input=$('<input/>').val(gauge_value);$input.css({'text-align':'center','margin':'auto','width':($svg.outerWidth()-40)+'px'});$div.append($input);if(self.options.on_click_label){var $post_input=$('<span style="color: #000000;">'+self.options.on_click_label+'</span>');$div.append($post_input);}
self.$el.prepend($div);$input.focus().keydown(function(event){event.stopPropagation();if(isNaN($input.val())){self.do_warn(_t("Wrong value entered!"),_t("Only Integer Value should be valid."));$div.remove();$svg.fadeTo(0,1);}else{if(event.keyCode==13||event.keyCode==9){if($input.val()!=value){$svg.fadeTo(0,1);parent.view.dataset.call(self.options.on_change,[parent.id,$input.val()]).then(function(){parent.do_reload();});}else{$svg.fadeTo(0,1);$div.remove();}}}}).click(function(event){event.stopPropagation();flag_open=false;}).blur(function(){if(!flag_open){self.$el.find(".oe_justgage_edit").remove();$svg.fadeTo(0,1);}else{$svg.fadeTo(0,1);flag_open=false;setTimeout(function(){$input.focus();},0);}});}}).mousedown(function(){flag_open=true;});if(this.options.force_set&&!+input_value){$svg.fadeTo(0,0.3);var $div=$('<div/>').text(_t("Click to change value"));$div.css(css);this.$el.append($div);}}},});fields_registry.add("gauge",GaugeWidget);});;

/* /web_char_trim/static/src/js/web_char_trim.js defined in bundle 'web.assets_backend' */
odoo.define('web_char_trim',function web_char_trim(require){'use strict';var WebFormats=require('web.formats');var _=window._;var parse_value=WebFormats.parse_value;WebFormats.parse_value=function(value,descriptor,value_if_empty){if((descriptor.field&&descriptor.field.type=='char')||(descriptor.field&&descriptor.field.type=='text')||descriptor.type=='char'||descriptor.type=='text'){if(value!=false&&value!="false"){value=$.trim(value);return value;}}
return parse_value(value,descriptor,value_if_empty);};var format_value=WebFormats.format_value;WebFormats.format_value=function(value,descriptor,value_if_empty){if((descriptor.field&&descriptor.field.type=='char')||(descriptor.field&&descriptor.field.type=='text')||descriptor.type=='char'||descriptor.type=='text'){if(value!=false&&value!="false"){value=$.trim(value);return value;}}
return format_value(value,descriptor,value_if_empty);};return WebFormats;});;

/* /web_char_trim/static/src/js/web_char_trim_list_view.js defined in bundle 'web.assets_backend' */
odoo.define('web_char_trim_list_view',function web_char_trim(require){'use strict';var ListView=require('web.ListView');var time=require('web.time');ListView.include({change_list_filters:function(ev){if(ev.target.tagName==='SELECT'&&!ev.target.outerHTML.match(/☑/)&&!ev.target.className.match(/select_search_bar/)){return null;}
if(ev.target.offsetParent&&ev.target.offsetParent.className.match(/ms-drop/)){return null;}
var val=ev.target.value;if(ev.target.type=='datetime-local'){val=time.datetime_to_str(new Date(ev.target.value));}
if(ev.target.type=='text'||ev.target.type=='char'){val=$.trim(val);}
var field_name=ev.target.dataset.colname||ev.target.parentNode.dataset.colname||ev.target.parentNode.parentNode.dataset.colname;var op='ilike';if(ev.target.parentNode.dataset.colname||ev.target.parentNode.parentNode.dataset.colname){op=ev.target.lastElementChild&&ev.target.lastElementChild.value||ev.target.parentNode.lastElementChild.value;}
if(ev.target.tagName=='SELECT'){var label=$(ev.target).find(':selected').text();op='=';}
this.ViewManager.searchview.query.add(this.facet_for(this.fields_view.fields[field_name],field_name,val,op,label));}});return ListView;});;

/* /web_highstock/static/lib/highstock.js defined in bundle 'web.assets_backend' */
(function(root,factory){if(typeof module==='object'&&module.exports){module.exports=root.document?factory(root):factory;}else{root.Highcharts=factory(root);}}(typeof window!=='undefined'?window:this,function(win){var UNDEFINED,doc=win.document,math=Math,mathRound=math.round,mathFloor=math.floor,mathCeil=math.ceil,mathMax=math.max,mathMin=math.min,mathAbs=math.abs,mathCos=math.cos,mathSin=math.sin,mathPI=math.PI,deg2rad=mathPI*2/360,userAgent=(win.navigator&&win.navigator.userAgent)||'',isOpera=win.opera,isMS=/(msie|trident|edge)/i.test(userAgent)&&!isOpera,docMode8=doc&&doc.documentMode===8,isWebKit=!isMS&&/AppleWebKit/.test(userAgent),isFirefox=/Firefox/.test(userAgent),isTouchDevice=/(Mobile|Android|Windows Phone)/.test(userAgent),SVG_NS='http://www.w3.org/2000/svg',hasSVG=doc&&doc.createElementNS&&!!doc.createElementNS(SVG_NS,'svg').createSVGRect,hasBidiBug=isFirefox&&parseInt(userAgent.split('Firefox/')[1],10)<4,useCanVG=doc&&!hasSVG&&!isMS&&!!doc.createElement('canvas').getContext,Renderer,hasTouch,symbolSizes={},idCounter=0,garbageBin,defaultOptions,dateFormat,pathAnim,timeUnits,noop=function(){},charts=[],chartCount=0,PRODUCT='Highstock',VERSION='4.2.4',DIV='div',ABSOLUTE='absolute',RELATIVE='relative',HIDDEN='hidden',PREFIX='highcharts-',VISIBLE='visible',PX='px',NONE='none',M='M',L='L',numRegex=/^[0-9]+$/,NORMAL_STATE='',HOVER_STATE='hover',SELECT_STATE='select',marginNames=['plotTop','marginRight','marginBottom','plotLeft'],AxisPlotLineOrBandExtension,STROKE_WIDTH='stroke-width',Date,makeTime,timezoneOffset,getTimezoneOffset,getMinutes,getHours,getDay,getDate,getMonth,getFullYear,setMilliseconds,setSeconds,setMinutes,setHours,setDate,setMonth,setFullYear,seriesTypes={},Highcharts;function error(code,stop){var msg='Highcharts error #'+code+': www.highcharts.com/errors/'+code;if(stop){throw new Error(msg);}
if(win.console){console.log(msg);}}
Highcharts=win.Highcharts?error(16,true):{win:win};Highcharts.seriesTypes=seriesTypes;var timers=[],getStyle,inArray,each,grep,offset,map,addEvent,removeEvent,fireEvent,animate,stop;function Fx(elem,options,prop){this.options=options;this.elem=elem;this.prop=prop;}
Fx.prototype={dSetter:function(){var start=this.paths[0],end=this.paths[1],ret=[],now=this.now,i=start.length,startVal;if(now===1){ret=this.toD;}else if(i===end.length&&now<1){while(i--){startVal=parseFloat(start[i]);ret[i]=isNaN(startVal)?start[i]:now*(parseFloat(end[i]-startVal))+startVal;}}else{ret=end;}
this.elem.attr('d',ret);},update:function(){var elem=this.elem,prop=this.prop,now=this.now,step=this.options.step;if(this[prop+'Setter']){this[prop+'Setter']();}else if(elem.attr){if(elem.element){elem.attr(prop,now);}}else{elem.style[prop]=now+this.unit;}
if(step){step.call(elem,now,this);}},run:function(from,to,unit){var self=this,timer=function(gotoEnd){return timer.stopped?false:self.step(gotoEnd);},i;this.startTime=+new Date();this.start=from;this.end=to;this.unit=unit;this.now=this.start;this.pos=0;timer.elem=this.elem;if(timer()&&timers.push(timer)===1){timer.timerId=setInterval(function(){for(i=0;i<timers.length;i++){if(!timers[i]()){timers.splice(i--,1);}}
if(!timers.length){clearInterval(timer.timerId);}},13);}},step:function(gotoEnd){var t=+new Date(),ret,done,options=this.options,elem=this.elem,complete=options.complete,duration=options.duration,curAnim=options.curAnim,i;if(elem.attr&&!elem.element){ret=false;}else if(gotoEnd||t>=duration+this.startTime){this.now=this.end;this.pos=1;this.update();curAnim[this.prop]=true;done=true;for(i in curAnim){if(curAnim[i]!==true){done=false;}}
if(done&&complete){complete.call(elem);}
ret=false;}else{this.pos=options.easing((t-this.startTime)/duration);this.now=this.start+((this.end-this.start)*this.pos);this.update();ret=true;}
return ret;},initPath:function(elem,fromD,toD){fromD=fromD||'';var shift=elem.shift,bezier=fromD.indexOf('C')>-1,numParams=bezier?7:3,endLength,slice,i,start=fromD.split(' '),end=[].concat(toD),isArea=elem.isArea,positionFactor=isArea?2:1,sixify=function(arr){i=arr.length;while(i--){if(arr[i]===M||arr[i]===L){arr.splice(i+1,0,arr[i+1],arr[i+2],arr[i+1],arr[i+2]);}}};if(bezier){sixify(start);sixify(end);}
if(shift<=end.length/numParams&&start.length===end.length){while(shift--){end=end.slice(0,numParams).concat(end);if(isArea){end=end.concat(end.slice(end.length-numParams));}}}
elem.shift=0;if(start.length){endLength=end.length;while(start.length<endLength){slice=start.slice().splice((start.length/positionFactor)-numParams,numParams*positionFactor);if(bezier){slice[numParams-6]=slice[numParams-2];slice[numParams-5]=slice[numParams-1];}
[].splice.apply(start,[(start.length/positionFactor),0].concat(slice));}}
return[start,end];}};var extend=Highcharts.extend=function(a,b){var n;if(!a){a={};}
for(n in b){a[n]=b[n];}
return a;};function merge(){var i,args=arguments,len,ret={},doCopy=function(copy,original){var value,key;if(typeof copy!=='object'){copy={};}
for(key in original){if(original.hasOwnProperty(key)){value=original[key];if(value&&typeof value==='object'&&Object.prototype.toString.call(value)!=='[object Array]'&&key!=='renderTo'&&typeof value.nodeType!=='number'){copy[key]=doCopy(copy[key]||{},value);}else{copy[key]=original[key];}}}
return copy;};if(args[0]===true){ret=args[1];args=Array.prototype.slice.call(args,2);}
len=args.length;for(i=0;i<len;i++){ret=doCopy(ret,args[i]);}
return ret;}
function pInt(s,mag){return parseInt(s,mag||10);}
function isString(s){return typeof s==='string';}
function isObject(obj){return obj&&typeof obj==='object';}
function isArray(obj){return Object.prototype.toString.call(obj)==='[object Array]';}
function isNumber(n){return typeof n==='number';}
function erase(arr,item){var i=arr.length;while(i--){if(arr[i]===item){arr.splice(i,1);break;}}}
function defined(obj){return obj!==UNDEFINED&&obj!==null;}
function attr(elem,prop,value){var key,ret;if(isString(prop)){if(defined(value)){elem.setAttribute(prop,value);}else if(elem&&elem.getAttribute){ret=elem.getAttribute(prop);}}else if(defined(prop)&&isObject(prop)){for(key in prop){elem.setAttribute(key,prop[key]);}}
return ret;}
function splat(obj){return isArray(obj)?obj:[obj];}
function syncTimeout(fn,delay,context){if(delay){return setTimeout(fn,delay,context);}
fn.call(0,context);}
var pick=Highcharts.pick=function(){var args=arguments,i,arg,length=args.length;for(i=0;i<length;i++){arg=args[i];if(arg!==UNDEFINED&&arg!==null){return arg;}}};function css(el,styles){if(isMS&&!hasSVG){if(styles&&styles.opacity!==UNDEFINED){styles.filter='alpha(opacity='+(styles.opacity*100)+')';}}
extend(el.style,styles);}
function createElement(tag,attribs,styles,parent,nopad){var el=doc.createElement(tag);if(attribs){extend(el,attribs);}
if(nopad){css(el,{padding:0,border:'none',margin:0});}
if(styles){css(el,styles);}
if(parent){parent.appendChild(el);}
return el;}
function extendClass(Parent,members){var object=function(){};object.prototype=new Parent();extend(object.prototype,members);return object;}
function pad(number,length,padder){return new Array((length||2)+1-String(number).length).join(padder||0)+number;}
function relativeLength(value,base){return(/%$/).test(value)?base*parseFloat(value)/100:parseFloat(value);}
var wrap=Highcharts.wrap=function(obj,method,func){var proceed=obj[method];obj[method]=function(){var args=Array.prototype.slice.call(arguments);args.unshift(proceed);return func.apply(this,args);};};function getTZOffset(timestamp){return((getTimezoneOffset&&getTimezoneOffset(timestamp))||timezoneOffset||0)*60000;}
dateFormat=function(format,timestamp,capitalize){if(!defined(timestamp)||isNaN(timestamp)){return defaultOptions.lang.invalidDate||'';}
format=pick(format,'%Y-%m-%d %H:%M:%S');var date=new Date(timestamp-getTZOffset(timestamp)),key,hours=date[getHours](),day=date[getDay](),dayOfMonth=date[getDate](),month=date[getMonth](),fullYear=date[getFullYear](),lang=defaultOptions.lang,langWeekdays=lang.weekdays,shortWeekdays=lang.shortWeekdays,replacements=extend({'a':shortWeekdays?shortWeekdays[day]:langWeekdays[day].substr(0,3),'A':langWeekdays[day],'d':pad(dayOfMonth),'e':pad(dayOfMonth,2,' '),'w':day,'b':lang.shortMonths[month],'B':lang.months[month],'m':pad(month+1),'y':fullYear.toString().substr(2,2),'Y':fullYear,'H':pad(hours),'k':hours,'I':pad((hours%12)||12),'l':(hours%12)||12,'M':pad(date[getMinutes]()),'p':hours<12?'AM':'PM','P':hours<12?'am':'pm','S':pad(date.getSeconds()),'L':pad(mathRound(timestamp%1000),3)},Highcharts.dateFormats);for(key in replacements){while(format.indexOf('%'+key)!==-1){format=format.replace('%'+key,typeof replacements[key]==='function'?replacements[key](timestamp):replacements[key]);}}
return capitalize?format.substr(0,1).toUpperCase()+format.substr(1):format;};function formatSingle(format,val){var floatRegex=/f$/,decRegex=/\.([0-9])/,lang=defaultOptions.lang,decimals;if(floatRegex.test(format)){decimals=format.match(decRegex);decimals=decimals?decimals[1]:-1;if(val!==null){val=Highcharts.numberFormat(val,decimals,lang.decimalPoint,format.indexOf(',')>-1?lang.thousandsSep:'');}}else{val=dateFormat(format,val);}
return val;}
function format(str,ctx){var splitter='{',isInside=false,segment,valueAndFormat,path,i,len,ret=[],val,index;while((index=str.indexOf(splitter))!==-1){segment=str.slice(0,index);if(isInside){valueAndFormat=segment.split(':');path=valueAndFormat.shift().split('.');len=path.length;val=ctx;for(i=0;i<len;i++){val=val[path[i]];}
if(valueAndFormat.length){val=formatSingle(valueAndFormat.join(':'),val);}
ret.push(val);}else{ret.push(segment);}
str=str.slice(index+1);isInside=!isInside;splitter=isInside?'}':'{';}
ret.push(str);return ret.join('');}
function getMagnitude(num){return math.pow(10,mathFloor(math.log(num)/math.LN10));}
function normalizeTickInterval(interval,multiples,magnitude,allowDecimals,preventExceed){var normalized,i,retInterval=interval;magnitude=pick(magnitude,1);normalized=interval/magnitude;if(!multiples){multiples=[1,2,2.5,5,10];if(allowDecimals===false){if(magnitude===1){multiples=[1,2,5,10];}else if(magnitude<=0.1){multiples=[1/magnitude];}}}
for(i=0;i<multiples.length;i++){retInterval=multiples[i];if((preventExceed&&retInterval*magnitude>=interval)||(!preventExceed&&(normalized<=(multiples[i]+(multiples[i+1]||multiples[i]))/2))){break;}}
retInterval*=magnitude;return retInterval;}
function stableSort(arr,sortFunction){var length=arr.length,sortValue,i;for(i=0;i<length;i++){arr[i].safeI=i;}
arr.sort(function(a,b){sortValue=sortFunction(a,b);return sortValue===0?a.safeI-b.safeI:sortValue;});for(i=0;i<length;i++){delete arr[i].safeI;}}
function arrayMin(data){var i=data.length,min=data[0];while(i--){if(data[i]<min){min=data[i];}}
return min;}
function arrayMax(data){var i=data.length,max=data[0];while(i--){if(data[i]>max){max=data[i];}}
return max;}
function destroyObjectProperties(obj,except){var n;for(n in obj){if(obj[n]&&obj[n]!==except&&obj[n].destroy){obj[n].destroy();}
delete obj[n];}}
function discardElement(element){if(!garbageBin){garbageBin=createElement(DIV);}
if(element){garbageBin.appendChild(element);}
garbageBin.innerHTML='';}
function correctFloat(num,prec){return parseFloat(num.toPrecision(prec||14));}
function setAnimation(animation,chart){chart.renderer.globalAnimation=pick(animation,chart.animation);}
function animObject(animation){return isObject(animation)?merge(animation):{duration:animation?500:0};}
timeUnits={millisecond:1,second:1000,minute:60000,hour:3600000,day:24*3600000,week:7*24*3600000,month:28*24*3600000,year:364*24*3600000};Highcharts.numberFormat=function(number,decimals,decimalPoint,thousandsSep){number=+number||0;var lang=defaultOptions.lang,origDec=(number.toString().split('.')[1]||'').length,decimalComponent,strinteger,thousands,absNumber=Math.abs(number),ret;if(decimals===-1){decimals=Math.min(origDec,20);}else if(isNaN(decimals)){decimals=2;}
strinteger=String(pInt(absNumber.toFixed(decimals)));thousands=strinteger.length>3?strinteger.length%3:0;decimalPoint=pick(decimalPoint,lang.decimalPoint);thousandsSep=pick(thousandsSep,lang.thousandsSep);ret=number<0?'-':'';ret+=thousands?strinteger.substr(0,thousands)+thousandsSep:'';ret+=strinteger.substr(thousands).replace(/(\d{3})(?=\d)/g,'$1'+thousandsSep);if(+decimals){decimalComponent=Math.abs(absNumber-strinteger+Math.pow(10,-Math.max(decimals,origDec)-1));ret+=decimalPoint+decimalComponent.toFixed(decimals).slice(2);}
return ret;};Math.easeInOutSine=function(pos){return-0.5*(Math.cos(Math.PI*pos)-1);};getStyle=function(el,prop){var style;if(prop==='width'){return Math.min(el.offsetWidth,el.scrollWidth)-getStyle(el,'padding-left')-getStyle(el,'padding-right');}else if(prop==='height'){return Math.min(el.offsetHeight,el.scrollHeight)-getStyle(el,'padding-top')-getStyle(el,'padding-bottom');}
style=win.getComputedStyle(el,undefined);return style&&pInt(style.getPropertyValue(prop));};inArray=function(item,arr){return arr.indexOf?arr.indexOf(item):[].indexOf.call(arr,item);};grep=function(elements,callback){return[].filter.call(elements,callback);};map=function(arr,fn){var results=[],i=0,len=arr.length;for(;i<len;i++){results[i]=fn.call(arr[i],arr[i],i,arr);}
return results;};offset=function(el){var docElem=doc.documentElement,box=el.getBoundingClientRect();return{top:box.top+(win.pageYOffset||docElem.scrollTop)-(docElem.clientTop||0),left:box.left+(win.pageXOffset||docElem.scrollLeft)-(docElem.clientLeft||0)};};stop=function(el){var i=timers.length;while(i--){if(timers[i].elem===el){timers[i].stopped=true;}}};each=function(arr,fn){return Array.prototype.forEach.call(arr,fn);};addEvent=function(el,type,fn){var events=el.hcEvents=el.hcEvents||{};function wrappedFn(e){e.target=e.srcElement||win;fn.call(el,e);}
if(el.addEventListener){el.addEventListener(type,fn,false);}else if(el.attachEvent){if(!el.hcEventsIE){el.hcEventsIE={};}
el.hcEventsIE[fn.toString()]=wrappedFn;el.attachEvent('on'+type,wrappedFn);}
if(!events[type]){events[type]=[];}
events[type].push(fn);};removeEvent=function(el,type,fn){var events,hcEvents=el.hcEvents,index;function removeOneEvent(type,fn){if(el.removeEventListener){el.removeEventListener(type,fn,false);}else if(el.attachEvent){fn=el.hcEventsIE[fn.toString()];el.detachEvent('on'+type,fn);}}
function removeAllEvents(){var types,len,n;if(!el.nodeName){return;}
if(type){types={};types[type]=true;}else{types=hcEvents;}
for(n in types){if(hcEvents[n]){len=hcEvents[n].length;while(len--){removeOneEvent(n,hcEvents[n][len]);}}}}
if(hcEvents){if(type){events=hcEvents[type]||[];if(fn){index=inArray(fn,events);if(index>-1){events.splice(index,1);hcEvents[type]=events;}
removeOneEvent(type,fn);}else{removeAllEvents();hcEvents[type]=[];}}else{removeAllEvents();el.hcEvents={};}}};fireEvent=function(el,type,eventArguments,defaultFunction){var e,hcEvents=el.hcEvents,events,len,i,fn;eventArguments=eventArguments||{};if(doc.createEvent&&(el.dispatchEvent||el.fireEvent)){e=doc.createEvent('Events');e.initEvent(type,true,true);e.target=el;extend(e,eventArguments);if(el.dispatchEvent){el.dispatchEvent(e);}else{el.fireEvent(type,e);}}else if(hcEvents){events=hcEvents[type]||[];len=events.length;if(!eventArguments.preventDefault){eventArguments.preventDefault=function(){eventArguments.defaultPrevented=true;};}
eventArguments.target=el;if(!eventArguments.type){eventArguments.type=type;}
for(i=0;i<len;i++){fn=events[i];if(fn.call(el,eventArguments)===false){eventArguments.preventDefault();}}}
if(defaultFunction&&!eventArguments.defaultPrevented){defaultFunction(eventArguments);}};animate=function(el,params,opt){var start,unit='',end,fx,args,prop;if(!isObject(opt)){args=arguments;opt={duration:args[2],easing:args[3],complete:args[4]};}
if(!isNumber(opt.duration)){opt.duration=400;}
opt.easing=typeof opt.easing==='function'?opt.easing:(Math[opt.easing]||Math.easeInOutSine);opt.curAnim=merge(params);for(prop in params){fx=new Fx(el,opt,prop);end=null;if(prop==='d'){fx.paths=fx.initPath(el,el.d,params.d);fx.toD=params.d;start=0;end=1;}else if(el.attr){start=el.attr(prop);}else{start=parseFloat(getStyle(el,prop))||0;if(prop!=='opacity'){unit='px';}}
if(!end){end=params[prop];}
if(end.match&&end.match('px')){end=end.replace(/px/g,'');}
fx.run(start,end,unit);}};if(win.jQuery){win.jQuery.fn.highcharts=function(){var args=[].slice.call(arguments);if(this[0]){if(args[0]){new Highcharts[isString(args[0])?args.shift():'Chart'](this[0],args[0],args[1]);return this;}
return charts[attr(this[0],'data-highcharts-chart')];}};}
if(doc&&!doc.defaultView){getStyle=function(el,prop){var val,alias={width:'clientWidth',height:'clientHeight'}[prop];if(el.style[prop]){return pInt(el.style[prop]);}
if(prop==='opacity'){prop='filter';}
if(alias){el.style.zoom=1;return Math.max(el[alias]-2*getStyle(el,'padding'),0);}
val=el.currentStyle[prop.replace(/\-(\w)/g,function(a,b){return b.toUpperCase();})];if(prop==='filter'){val=val.replace(/alpha\(opacity=([0-9]+)\)/,function(a,b){return b/100;});}
return val===''?1:pInt(val);};}
if(!Array.prototype.forEach){each=function(arr,fn){var i=0,len=arr.length;for(;i<len;i++){if(fn.call(arr[i],arr[i],i,arr)===false){return i;}}};}
if(!Array.prototype.indexOf){inArray=function(item,arr){var len,i=0;if(arr){len=arr.length;for(;i<len;i++){if(arr[i]===item){return i;}}}
return-1;};}
if(!Array.prototype.filter){grep=function(elements,fn){var ret=[],i=0,length=elements.length;for(;i<length;i++){if(fn(elements[i],i)){ret.push(elements[i]);}}
return ret;};}
Highcharts.Fx=Fx;Highcharts.inArray=inArray;Highcharts.each=each;Highcharts.grep=grep;Highcharts.offset=offset;Highcharts.map=map;Highcharts.addEvent=addEvent;Highcharts.removeEvent=removeEvent;Highcharts.fireEvent=fireEvent;Highcharts.animate=animate;Highcharts.animObject=animObject;Highcharts.stop=stop;defaultOptions={colors:['#7cb5ec','#434348','#90ed7d','#f7a35c','#8085e9','#f15c80','#e4d354','#2b908f','#f45b5b','#91e8e1'],symbols:['circle','diamond','square','triangle','triangle-down'],lang:{loading:'Loading...',months:['January','February','March','April','May','June','July','August','September','October','November','December'],shortMonths:['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'],weekdays:['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'],decimalPoint:'.',numericSymbols:['k','M','G','T','P','E'],resetZoom:'Reset zoom',resetZoomTitle:'Reset zoom level 1:1',thousandsSep:' '},global:{useUTC:true,canvasToolsURL:'http://code.highcharts.com/modules/canvas-tools.js',VMLRadialGradientURL:'http://code.highcharts.com/stock/4.2.4/gfx/vml-radial-gradient.png'},chart:{borderColor:'#4572A7',borderRadius:0,defaultSeriesType:'line',ignoreHiddenSeries:true,spacing:[10,10,15,10],backgroundColor:'#FFFFFF',plotBorderColor:'#C0C0C0',resetZoomButton:{theme:{zIndex:20},position:{align:'right',x:-10,y:10}}},title:{text:'Chart title',align:'center',margin:15,style:{color:'#333333',fontSize:'18px'}},subtitle:{text:'',align:'center',style:{color:'#555555'}},plotOptions:{line:{allowPointSelect:false,showCheckbox:false,animation:{duration:1000},events:{},lineWidth:2,marker:{lineWidth:0,radius:4,lineColor:'#FFFFFF',states:{hover:{enabled:true,lineWidthPlus:1,radiusPlus:2},select:{fillColor:'#FFFFFF',lineColor:'#000000',lineWidth:2}}},point:{events:{}},dataLabels:{align:'center',formatter:function(){return this.y===null?'':Highcharts.numberFormat(this.y,-1);},style:{color:'contrast',fontSize:'11px',fontWeight:'bold',textShadow:'0 0 6px contrast, 0 0 3px contrast'},verticalAlign:'bottom',x:0,y:0,padding:5},cropThreshold:300,pointRange:0,softThreshold:true,states:{hover:{lineWidthPlus:1,marker:{},halo:{size:10,opacity:0.25}},select:{marker:{}}},stickyTracking:true,turboThreshold:1000}},labels:{style:{position:ABSOLUTE,color:'#3E576F'}},legend:{enabled:true,align:'center',layout:'horizontal',labelFormatter:function(){return this.name;},borderColor:'#909090',borderRadius:0,navigation:{activeColor:'#274b6d',inactiveColor:'#CCC'},shadow:false,itemStyle:{color:'#333333',fontSize:'12px',fontWeight:'bold'},itemHoverStyle:{color:'#000'},itemHiddenStyle:{color:'#CCC'},itemCheckboxStyle:{position:ABSOLUTE,width:'13px',height:'13px'},symbolPadding:5,verticalAlign:'bottom',x:0,y:0,title:{style:{fontWeight:'bold'}}},loading:{labelStyle:{fontWeight:'bold',position:RELATIVE,top:'45%'},style:{position:ABSOLUTE,backgroundColor:'white',opacity:0.5,textAlign:'center'}},tooltip:{enabled:true,animation:hasSVG,backgroundColor:'rgba(249, 249, 249, .85)',borderWidth:1,borderRadius:3,dateTimeLabelFormats:{millisecond:'%A, %b %e, %H:%M:%S.%L',second:'%A, %b %e, %H:%M:%S',minute:'%A, %b %e, %H:%M',hour:'%A, %b %e, %H:%M',day:'%A, %b %e, %Y',week:'Week from %A, %b %e, %Y',month:'%B %Y',year:'%Y'},footerFormat:'',headerFormat:'<span style="font-size: 10px">{point.key}</span><br/>',pointFormat:'<span style="color:{point.color}">\u25CF</span> {series.name}: <b>{point.y}</b><br/>',shadow:true,snap:isTouchDevice?25:10,style:{color:'#333333',cursor:'default',fontSize:'12px',padding:'8px',pointerEvents:'none',whiteSpace:'nowrap'}},credits:{enabled:true,text:'Highcharts.com',href:'http://www.highcharts.com',position:{align:'right',x:-10,verticalAlign:'bottom',y:-5},style:{cursor:'pointer',color:'#909090',fontSize:'9px'}}};function setTimeMethods(){var globalOptions=defaultOptions.global,useUTC=globalOptions.useUTC,GET=useUTC?'getUTC':'get',SET=useUTC?'setUTC':'set';Date=globalOptions.Date||win.Date;timezoneOffset=useUTC&&globalOptions.timezoneOffset;getTimezoneOffset=useUTC&&globalOptions.getTimezoneOffset;makeTime=function(year,month,date,hours,minutes,seconds){var d;if(useUTC){d=Date.UTC.apply(0,arguments);d+=getTZOffset(d);}else{d=new Date(year,month,pick(date,1),pick(hours,0),pick(minutes,0),pick(seconds,0)).getTime();}
return d;};getMinutes=GET+'Minutes';getHours=GET+'Hours';getDay=GET+'Day';getDate=GET+'Date';getMonth=GET+'Month';getFullYear=GET+'FullYear';setMilliseconds=SET+'Milliseconds';setSeconds=SET+'Seconds';setMinutes=SET+'Minutes';setHours=SET+'Hours';setDate=SET+'Date';setMonth=SET+'Month';setFullYear=SET+'FullYear';}
function setOptions(options){defaultOptions=merge(true,defaultOptions,options);setTimeMethods();return defaultOptions;}
function getOptions(){return defaultOptions;}
var defaultPlotOptions=defaultOptions.plotOptions,defaultSeriesOptions=defaultPlotOptions.line;setTimeMethods();function Color(input){if(!(this instanceof Color)){return new Color(input);}
this.init(input);}
Color.prototype={parsers:[{regex:/rgba\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]?(?:\.[0-9]+)?)\s*\)/,parse:function(result){return[pInt(result[1]),pInt(result[2]),pInt(result[3]),parseFloat(result[4],10)];}},{regex:/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/,parse:function(result){return[pInt(result[1],16),pInt(result[2],16),pInt(result[3],16),1];}},{regex:/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/,parse:function(result){return[pInt(result[1]),pInt(result[2]),pInt(result[3]),1];}}],init:function(input){var result,rgba,i,parser;this.input=input;if(input&&input.stops){this.stops=map(input.stops,function(stop){return new Color(stop[1]);});}else{i=this.parsers.length;while(i--&&!rgba){parser=this.parsers[i];result=parser.regex.exec(input);if(result){rgba=parser.parse(result);}}}
this.rgba=rgba||[];},get:function(format){var input=this.input,rgba=this.rgba,ret;if(this.stops){ret=merge(input);ret.stops=[].concat(ret.stops);each(this.stops,function(stop,i){ret.stops[i]=[ret.stops[i][0],stop.get(format)];});}else if(rgba&&!isNaN(rgba[0])){if(format==='rgb'||(!format&&rgba[3]===1)){ret='rgb('+rgba[0]+','+rgba[1]+','+rgba[2]+')';}else if(format==='a'){ret=rgba[3];}else{ret='rgba('+rgba.join(',')+')';}}else{ret=input;}
return ret;},brighten:function(alpha){var i,rgba=this.rgba;if(this.stops){each(this.stops,function(stop){stop.brighten(alpha);});}else if(isNumber(alpha)&&alpha!==0){for(i=0;i<3;i++){rgba[i]+=pInt(alpha*255);if(rgba[i]<0){rgba[i]=0;}
if(rgba[i]>255){rgba[i]=255;}}}
return this;},setOpacity:function(alpha){this.rgba[3]=alpha;return this;}};function SVGElement(){}
SVGElement.prototype={opacity:1,textProps:['direction','fontSize','fontWeight','fontFamily','fontStyle','color','lineHeight','width','textDecoration','textOverflow','textShadow'],init:function(renderer,nodeName){var wrapper=this;wrapper.element=nodeName==='span'?createElement(nodeName):doc.createElementNS(SVG_NS,nodeName);wrapper.renderer=renderer;},animate:function(params,options,complete){var animOptions=pick(options,this.renderer.globalAnimation,true);stop(this);if(animOptions){if(complete){animOptions.complete=complete;}
animate(this,params,animOptions);}else{this.attr(params,null,complete);}
return this;},colorGradient:function(color,prop,elem){var renderer=this.renderer,colorObject,gradName,gradAttr,radAttr,gradients,gradientObject,stops,stopColor,stopOpacity,radialReference,n,id,key=[],value;if(color.linearGradient){gradName='linearGradient';}else if(color.radialGradient){gradName='radialGradient';}
if(gradName){gradAttr=color[gradName];gradients=renderer.gradients;stops=color.stops;radialReference=elem.radialReference;if(isArray(gradAttr)){color[gradName]=gradAttr={x1:gradAttr[0],y1:gradAttr[1],x2:gradAttr[2],y2:gradAttr[3],gradientUnits:'userSpaceOnUse'};}
if(gradName==='radialGradient'&&radialReference&&!defined(gradAttr.gradientUnits)){radAttr=gradAttr;gradAttr=merge(gradAttr,renderer.getRadialAttr(radialReference,radAttr),{gradientUnits:'userSpaceOnUse'});}
for(n in gradAttr){if(n!=='id'){key.push(n,gradAttr[n]);}}
for(n in stops){key.push(stops[n]);}
key=key.join(',');if(gradients[key]){id=gradients[key].attr('id');}else{gradAttr.id=id=PREFIX+idCounter++;gradients[key]=gradientObject=renderer.createElement(gradName).attr(gradAttr).add(renderer.defs);gradientObject.radAttr=radAttr;gradientObject.stops=[];each(stops,function(stop){var stopObject;if(stop[1].indexOf('rgba')===0){colorObject=Color(stop[1]);stopColor=colorObject.get('rgb');stopOpacity=colorObject.get('a');}else{stopColor=stop[1];stopOpacity=1;}
stopObject=renderer.createElement('stop').attr({offset:stop[0],'stop-color':stopColor,'stop-opacity':stopOpacity}).add(gradientObject);gradientObject.stops.push(stopObject);});}
value='url('+renderer.url+'#'+id+')';elem.setAttribute(prop,value);elem.gradient=key;color.toString=function(){return value;};}},applyTextShadow:function(textShadow){var elem=this.element,tspans,hasContrast=textShadow.indexOf('contrast')!==-1,styles={},forExport=this.renderer.forExport,supports=forExport||(elem.style.textShadow!==UNDEFINED&&!isMS);if(hasContrast){styles.textShadow=textShadow=textShadow.replace(/contrast/g,this.renderer.getContrast(elem.style.fill));}
if(isWebKit||forExport){styles.textRendering='geometricPrecision';}
if(supports){this.css(styles);}else{this.fakeTS=true;this.ySetter=this.xSetter;tspans=[].slice.call(elem.getElementsByTagName('tspan'));each(textShadow.split(/\s?,\s?/g),function(textShadow){var firstChild=elem.firstChild,color,strokeWidth;textShadow=textShadow.split(' ');color=textShadow[textShadow.length-1];strokeWidth=textShadow[textShadow.length-2];if(strokeWidth){each(tspans,function(tspan,y){var clone;if(y===0){tspan.setAttribute('x',elem.getAttribute('x'));y=elem.getAttribute('y');tspan.setAttribute('y',y||0);if(y===null){elem.setAttribute('y',0);}}
clone=tspan.cloneNode(1);attr(clone,{'class':PREFIX+'text-shadow','fill':color,'stroke':color,'stroke-opacity':1/mathMax(pInt(strokeWidth),3),'stroke-width':strokeWidth,'stroke-linejoin':'round'});elem.insertBefore(clone,firstChild);});}});}},attr:function(hash,val,complete){var key,value,element=this.element,hasSetSymbolSize,ret=this,skipAttr,setter;if(typeof hash==='string'&&val!==UNDEFINED){key=hash;hash={};hash[key]=val;}
if(typeof hash==='string'){ret=(this[hash+'Getter']||this._defaultGetter).call(this,hash,element);}else{for(key in hash){value=hash[key];skipAttr=false;if(this.symbolName&&/^(x|y|width|height|r|start|end|innerR|anchorX|anchorY)/.test(key)){if(!hasSetSymbolSize){this.symbolAttr(hash);hasSetSymbolSize=true;}
skipAttr=true;}
if(this.rotation&&(key==='x'||key==='y')){this.doTransform=true;}
if(!skipAttr){setter=this[key+'Setter']||this._defaultSetter;setter.call(this,value,key,element);if(this.shadows&&/^(width|height|visibility|x|y|d|transform|cx|cy|r)$/.test(key)){this.updateShadows(key,value,setter);}}}
if(this.doTransform){this.updateTransform();this.doTransform=false;}}
if(complete){complete();}
return ret;},updateShadows:function(key,value,setter){var shadows=this.shadows,i=shadows.length;while(i--){setter.call(shadows[i],key==='height'?Math.max(value-(shadows[i].cutHeight||0),0):key==='d'?this.d:value,key,shadows[i]);}},addClass:function(className){var element=this.element,currentClassName=attr(element,'class')||'';if(currentClassName.indexOf(className)===-1){attr(element,'class',currentClassName+' '+className);}
return this;},symbolAttr:function(hash){var wrapper=this;each(['x','y','r','start','end','width','height','innerR','anchorX','anchorY'],function(key){wrapper[key]=pick(hash[key],wrapper[key]);});wrapper.attr({d:wrapper.renderer.symbols[wrapper.symbolName](wrapper.x,wrapper.y,wrapper.width,wrapper.height,wrapper)});},clip:function(clipRect){return this.attr('clip-path',clipRect?'url('+this.renderer.url+'#'+clipRect.id+')':NONE);},crisp:function(rect){var wrapper=this,key,attribs={},normalizer,strokeWidth=wrapper.strokeWidth||0;normalizer=mathRound(strokeWidth)%2/2;rect.x=mathFloor(rect.x||wrapper.x||0)+normalizer;rect.y=mathFloor(rect.y||wrapper.y||0)+normalizer;rect.width=mathFloor((rect.width||wrapper.width||0)-2*normalizer);rect.height=mathFloor((rect.height||wrapper.height||0)-2*normalizer);rect.strokeWidth=strokeWidth;for(key in rect){if(wrapper[key]!==rect[key]){wrapper[key]=attribs[key]=rect[key];}}
return attribs;},css:function(styles){var elemWrapper=this,oldStyles=elemWrapper.styles,newStyles={},elem=elemWrapper.element,textWidth,n,serializedCss='',hyphenate,hasNew=!oldStyles;if(styles&&styles.color){styles.fill=styles.color;}
if(oldStyles){for(n in styles){if(styles[n]!==oldStyles[n]){newStyles[n]=styles[n];hasNew=true;}}}
if(hasNew){textWidth=elemWrapper.textWidth=(styles&&styles.width&&elem.nodeName.toLowerCase()==='text'&&pInt(styles.width))||elemWrapper.textWidth;if(oldStyles){styles=extend(oldStyles,newStyles);}
elemWrapper.styles=styles;if(textWidth&&(useCanVG||(!hasSVG&&elemWrapper.renderer.forExport))){delete styles.width;}
if(isMS&&!hasSVG){css(elemWrapper.element,styles);}else{hyphenate=function(a,b){return'-'+b.toLowerCase();};for(n in styles){serializedCss+=n.replace(/([A-Z])/g,hyphenate)+':'+styles[n]+';';}
attr(elem,'style',serializedCss);}
if(textWidth&&elemWrapper.added){elemWrapper.renderer.buildText(elemWrapper);}}
return elemWrapper;},on:function(eventType,handler){var svgElement=this,element=svgElement.element;if(hasTouch&&eventType==='click'){element.ontouchstart=function(e){svgElement.touchEventFired=Date.now();e.preventDefault();handler.call(element,e);};element.onclick=function(e){if(userAgent.indexOf('Android')===-1||Date.now()-(svgElement.touchEventFired||0)>1100){handler.call(element,e);}};}else{element['on'+eventType]=handler;}
return this;},setRadialReference:function(coordinates){var existingGradient=this.renderer.gradients[this.element.gradient];this.element.radialReference=coordinates;if(existingGradient&&existingGradient.radAttr){existingGradient.animate(this.renderer.getRadialAttr(coordinates,existingGradient.radAttr));}
return this;},translate:function(x,y){return this.attr({translateX:x,translateY:y});},invert:function(){var wrapper=this;wrapper.inverted=true;wrapper.updateTransform();return wrapper;},updateTransform:function(){var wrapper=this,translateX=wrapper.translateX||0,translateY=wrapper.translateY||0,scaleX=wrapper.scaleX,scaleY=wrapper.scaleY,inverted=wrapper.inverted,rotation=wrapper.rotation,element=wrapper.element,transform;if(inverted){translateX+=wrapper.attr('width');translateY+=wrapper.attr('height');}
transform=['translate('+translateX+','+translateY+')'];if(inverted){transform.push('rotate(90) scale(-1,1)');}else if(rotation){transform.push('rotate('+rotation+' '+(element.getAttribute('x')||0)+' '+(element.getAttribute('y')||0)+')');}
if(defined(scaleX)||defined(scaleY)){transform.push('scale('+pick(scaleX,1)+' '+pick(scaleY,1)+')');}
if(transform.length){element.setAttribute('transform',transform.join(' '));}},toFront:function(){var element=this.element;element.parentNode.appendChild(element);return this;},align:function(alignOptions,alignByTranslate,box){var align,vAlign,x,y,attribs={},alignTo,renderer=this.renderer,alignedObjects=renderer.alignedObjects;if(alignOptions){this.alignOptions=alignOptions;this.alignByTranslate=alignByTranslate;if(!box||isString(box)){this.alignTo=alignTo=box||'renderer';erase(alignedObjects,this);alignedObjects.push(this);box=null;}}else{alignOptions=this.alignOptions;alignByTranslate=this.alignByTranslate;alignTo=this.alignTo;}
box=pick(box,renderer[alignTo],renderer);align=alignOptions.align;vAlign=alignOptions.verticalAlign;x=(box.x||0)+(alignOptions.x||0);y=(box.y||0)+(alignOptions.y||0);if(align==='right'||align==='center'){x+=(box.width-(alignOptions.width||0))/{right:1,center:2}[align];}
attribs[alignByTranslate?'translateX':'x']=mathRound(x);if(vAlign==='bottom'||vAlign==='middle'){y+=(box.height-(alignOptions.height||0))/({bottom:1,middle:2}[vAlign]||1);}
attribs[alignByTranslate?'translateY':'y']=mathRound(y);this[this.placed?'animate':'attr'](attribs);this.placed=true;this.alignAttr=attribs;return this;},getBBox:function(reload,rot){var wrapper=this,bBox,renderer=wrapper.renderer,width,height,rotation,rad,element=wrapper.element,styles=wrapper.styles,textStr=wrapper.textStr,textShadow,elemStyle=element.style,toggleTextShadowShim,cache=renderer.cache,cacheKeys=renderer.cacheKeys,cacheKey;rotation=pick(rot,wrapper.rotation);rad=rotation*deg2rad;if(textStr!==UNDEFINED){cacheKey=['',rotation||0,styles&&styles.fontSize,element.style.width].join(',');if(textStr===''||numRegex.test(textStr)){cacheKey='num:'+textStr.toString().length+cacheKey;}else{cacheKey=textStr+cacheKey;}}
if(cacheKey&&!reload){bBox=cache[cacheKey];}
if(!bBox){if(element.namespaceURI===SVG_NS||renderer.forExport){try{toggleTextShadowShim=this.fakeTS&&function(display){each(element.querySelectorAll('.'+PREFIX+'text-shadow'),function(tspan){tspan.style.display=display;});};if(isFirefox&&elemStyle.textShadow){textShadow=elemStyle.textShadow;elemStyle.textShadow='';}else if(toggleTextShadowShim){toggleTextShadowShim(NONE);}
bBox=element.getBBox?extend({},element.getBBox()):{width:element.offsetWidth,height:element.offsetHeight};if(textShadow){elemStyle.textShadow=textShadow;}else if(toggleTextShadowShim){toggleTextShadowShim('');}}catch(e){}
if(!bBox||bBox.width<0){bBox={width:0,height:0};}}else{bBox=wrapper.htmlGetBBox();}
if(renderer.isSVG){width=bBox.width;height=bBox.height;if(isMS&&styles&&styles.fontSize==='11px'&&height.toPrecision(3)==='16.9'){bBox.height=height=14;}
if(rotation){bBox.width=mathAbs(height*mathSin(rad))+mathAbs(width*mathCos(rad));bBox.height=mathAbs(height*mathCos(rad))+mathAbs(width*mathSin(rad));}}
if(cacheKey){while(cacheKeys.length>250){delete cache[cacheKeys.shift()];}
if(!cache[cacheKey]){cacheKeys.push(cacheKey);}
cache[cacheKey]=bBox;}}
return bBox;},show:function(inherit){return this.attr({visibility:inherit?'inherit':VISIBLE});},hide:function(){return this.attr({visibility:HIDDEN});},fadeOut:function(duration){var elemWrapper=this;elemWrapper.animate({opacity:0},{duration:duration||150,complete:function(){elemWrapper.attr({y:-9999});}});},add:function(parent){var renderer=this.renderer,element=this.element,inserted;if(parent){this.parentGroup=parent;}
this.parentInverted=parent&&parent.inverted;if(this.textStr!==undefined){renderer.buildText(this);}
this.added=true;if(!parent||parent.handleZ||this.zIndex){inserted=this.zIndexSetter();}
if(!inserted){(parent?parent.element:renderer.box).appendChild(element);}
if(this.onAdd){this.onAdd();}
return this;},safeRemoveChild:function(element){var parentNode=element.parentNode;if(parentNode){parentNode.removeChild(element);}},destroy:function(){var wrapper=this,element=wrapper.element||{},shadows=wrapper.shadows,parentToClean=wrapper.renderer.isSVG&&element.nodeName==='SPAN'&&wrapper.parentGroup,grandParent,key,i;element.onclick=element.onmouseout=element.onmouseover=element.onmousemove=element.point=null;stop(wrapper);if(wrapper.clipPath){wrapper.clipPath=wrapper.clipPath.destroy();}
if(wrapper.stops){for(i=0;i<wrapper.stops.length;i++){wrapper.stops[i]=wrapper.stops[i].destroy();}
wrapper.stops=null;}
wrapper.safeRemoveChild(element);if(shadows){each(shadows,function(shadow){wrapper.safeRemoveChild(shadow);});}
while(parentToClean&&parentToClean.div&&parentToClean.div.childNodes.length===0){grandParent=parentToClean.parentGroup;wrapper.safeRemoveChild(parentToClean.div);delete parentToClean.div;parentToClean=grandParent;}
if(wrapper.alignTo){erase(wrapper.renderer.alignedObjects,wrapper);}
for(key in wrapper){delete wrapper[key];}
return null;},shadow:function(shadowOptions,group,cutOff){var shadows=[],i,shadow,element=this.element,strokeWidth,shadowWidth,shadowElementOpacity,transform;if(shadowOptions){shadowWidth=pick(shadowOptions.width,3);shadowElementOpacity=(shadowOptions.opacity||0.15)/shadowWidth;transform=this.parentInverted?'(-1,-1)':'('+pick(shadowOptions.offsetX,1)+', '+pick(shadowOptions.offsetY,1)+')';for(i=1;i<=shadowWidth;i++){shadow=element.cloneNode(0);strokeWidth=(shadowWidth*2)+1-(2*i);attr(shadow,{'isShadow':'true','stroke':shadowOptions.color||'black','stroke-opacity':shadowElementOpacity*i,'stroke-width':strokeWidth,'transform':'translate'+transform,'fill':NONE});if(cutOff){attr(shadow,'height',mathMax(attr(shadow,'height')-strokeWidth,0));shadow.cutHeight=strokeWidth;}
if(group){group.element.appendChild(shadow);}else{element.parentNode.insertBefore(shadow,element);}
shadows.push(shadow);}
this.shadows=shadows;}
return this;},xGetter:function(key){if(this.element.nodeName==='circle'){key={x:'cx',y:'cy'}[key]||key;}
return this._defaultGetter(key);},_defaultGetter:function(key){var ret=pick(this[key],this.element?this.element.getAttribute(key):null,0);if(/^[\-0-9\.]+$/.test(ret)){ret=parseFloat(ret);}
return ret;},dSetter:function(value,key,element){if(value&&value.join){value=value.join(' ');}
if(/(NaN| {2}|^$)/.test(value)){value='M 0 0';}
element.setAttribute(key,value);this[key]=value;},dashstyleSetter:function(value){var i,strokeWidth=this['stroke-width'];if(strokeWidth==='inherit'){strokeWidth=1;}
value=value&&value.toLowerCase();if(value){value=value.replace('shortdashdotdot','3,1,1,1,1,1,').replace('shortdashdot','3,1,1,1').replace('shortdot','1,1,').replace('shortdash','3,1,').replace('longdash','8,3,').replace(/dot/g,'1,3,').replace('dash','4,3,').replace(/,$/,'').split(',');i=value.length;while(i--){value[i]=pInt(value[i])*strokeWidth;}
value=value.join(',').replace(/NaN/g,'none');this.element.setAttribute('stroke-dasharray',value);}},alignSetter:function(value){this.element.setAttribute('text-anchor',{left:'start',center:'middle',right:'end'}[value]);},opacitySetter:function(value,key,element){this[key]=value;element.setAttribute(key,value);},titleSetter:function(value){var titleNode=this.element.getElementsByTagName('title')[0];if(!titleNode){titleNode=doc.createElementNS(SVG_NS,'title');this.element.appendChild(titleNode);}
titleNode.appendChild(doc.createTextNode((String(pick(value),'')).replace(/<[^>]*>/g,'')));},textSetter:function(value){if(value!==this.textStr){delete this.bBox;this.textStr=value;if(this.added){this.renderer.buildText(this);}}},fillSetter:function(value,key,element){if(typeof value==='string'){element.setAttribute(key,value);}else if(value){this.colorGradient(value,key,element);}},visibilitySetter:function(value,key,element){if(value==='inherit'){element.removeAttribute(key);}else{element.setAttribute(key,value);}},zIndexSetter:function(value,key){var renderer=this.renderer,parentGroup=this.parentGroup,parentWrapper=parentGroup||renderer,parentNode=parentWrapper.element||renderer.box,childNodes,otherElement,otherZIndex,element=this.element,inserted,run=this.added,i;if(defined(value)){element.zIndex=value;value=+value;if(this[key]===value){run=false;}
this[key]=value;}
if(run){value=this.zIndex;if(value&&parentGroup){parentGroup.handleZ=true;}
childNodes=parentNode.childNodes;for(i=0;i<childNodes.length&&!inserted;i++){otherElement=childNodes[i];otherZIndex=otherElement.zIndex;if(otherElement!==element&&(pInt(otherZIndex)>value||(!defined(value)&&defined(otherZIndex)))){parentNode.insertBefore(element,otherElement);inserted=true;}}
if(!inserted){parentNode.appendChild(element);}}
return inserted;},_defaultSetter:function(value,key,element){element.setAttribute(key,value);}};SVGElement.prototype.yGetter=SVGElement.prototype.xGetter;SVGElement.prototype.translateXSetter=SVGElement.prototype.translateYSetter=SVGElement.prototype.rotationSetter=SVGElement.prototype.verticalAlignSetter=SVGElement.prototype.scaleXSetter=SVGElement.prototype.scaleYSetter=function(value,key){this[key]=value;this.doTransform=true;};SVGElement.prototype['stroke-widthSetter']=SVGElement.prototype.strokeSetter=function(value,key,element){this[key]=value;if(this.stroke&&this['stroke-width']){this.strokeWidth=this['stroke-width'];SVGElement.prototype.fillSetter.call(this,this.stroke,'stroke',element);element.setAttribute('stroke-width',this['stroke-width']);this.hasStroke=true;}else if(key==='stroke-width'&&value===0&&this.hasStroke){element.removeAttribute('stroke');this.hasStroke=false;}};var SVGRenderer=function(){this.init.apply(this,arguments);};SVGRenderer.prototype={Element:SVGElement,init:function(container,width,height,style,forExport,allowHTML){var renderer=this,boxWrapper,element,desc;boxWrapper=renderer.createElement('svg').attr({version:'1.1'}).css(this.getStyle(style));element=boxWrapper.element;container.appendChild(element);if(container.innerHTML.indexOf('xmlns')===-1){attr(element,'xmlns',SVG_NS);}
renderer.isSVG=true;renderer.box=element;renderer.boxWrapper=boxWrapper;renderer.alignedObjects=[];renderer.url=(isFirefox||isWebKit)&&doc.getElementsByTagName('base').length?win.location.href.replace(/#.*?$/,'').replace(/([\('\)])/g,'\\$1').replace(/ /g,'%20'):'';desc=this.createElement('desc').add();desc.element.appendChild(doc.createTextNode('Created with '+PRODUCT+' '+VERSION));renderer.defs=this.createElement('defs').add();renderer.allowHTML=allowHTML;renderer.forExport=forExport;renderer.gradients={};renderer.cache={};renderer.cacheKeys=[];renderer.imgCount=0;renderer.setSize(width,height,false);var subPixelFix,rect;if(isFirefox&&container.getBoundingClientRect){renderer.subPixelFix=subPixelFix=function(){css(container,{left:0,top:0});rect=container.getBoundingClientRect();css(container,{left:(mathCeil(rect.left)-rect.left)+PX,top:(mathCeil(rect.top)-rect.top)+PX});};subPixelFix();addEvent(win,'resize',subPixelFix);}},getStyle:function(style){this.style=extend({fontFamily:'"Lucida Grande", "Lucida Sans Unicode", Arial, Helvetica, sans-serif',fontSize:'12px'},style);return this.style;},isHidden:function(){return!this.boxWrapper.getBBox().width;},destroy:function(){var renderer=this,rendererDefs=renderer.defs;renderer.box=null;renderer.boxWrapper=renderer.boxWrapper.destroy();destroyObjectProperties(renderer.gradients||{});renderer.gradients=null;if(rendererDefs){renderer.defs=rendererDefs.destroy();}
if(renderer.subPixelFix){removeEvent(win,'resize',renderer.subPixelFix);}
renderer.alignedObjects=null;return null;},createElement:function(nodeName){var wrapper=new this.Element();wrapper.init(this,nodeName);return wrapper;},draw:function(){},getRadialAttr:function(radialReference,gradAttr){return{cx:(radialReference[0]-radialReference[2]/2)+gradAttr.cx*radialReference[2],cy:(radialReference[1]-radialReference[2]/2)+gradAttr.cy*radialReference[2],r:gradAttr.r*radialReference[2]};},buildText:function(wrapper){var textNode=wrapper.element,renderer=this,forExport=renderer.forExport,textStr=pick(wrapper.textStr,'').toString(),hasMarkup=textStr.indexOf('<')!==-1,lines,childNodes=textNode.childNodes,styleRegex,hrefRegex,parentX=attr(textNode,'x'),textStyles=wrapper.styles,width=wrapper.textWidth,textLineHeight=textStyles&&textStyles.lineHeight,textShadow=textStyles&&textStyles.textShadow,ellipsis=textStyles&&textStyles.textOverflow==='ellipsis',i=childNodes.length,tempParent=width&&!wrapper.added&&this.box,getLineHeight=function(tspan){return textLineHeight?pInt(textLineHeight):renderer.fontMetrics(/(px|em)$/.test(tspan&&tspan.style.fontSize)?tspan.style.fontSize:((textStyles&&textStyles.fontSize)||renderer.style.fontSize||12),tspan).h;},unescapeAngleBrackets=function(inputStr){return inputStr.replace(/&lt;/g,'<').replace(/&gt;/g,'>');};while(i--){textNode.removeChild(childNodes[i]);}
if(!hasMarkup&&!textShadow&&!ellipsis&&textStr.indexOf(' ')===-1){textNode.appendChild(doc.createTextNode(unescapeAngleBrackets(textStr)));}else{styleRegex=/<.*style="([^"]+)".*>/;hrefRegex=/<.*href="(http[^"]+)".*>/;if(tempParent){tempParent.appendChild(textNode);}
if(hasMarkup){lines=textStr.replace(/<(b|strong)>/g,'<span style="font-weight:bold">').replace(/<(i|em)>/g,'<span style="font-style:italic">').replace(/<a/g,'<span').replace(/<\/(b|strong|i|em|a)>/g,'</span>').split(/<br.*?>/g);}else{lines=[textStr];}
if(lines[lines.length-1]===''){lines.pop();}
each(lines,function buildTextLines(line,lineNo){var spans,spanNo=0;line=line.replace(/<span/g,'|||<span').replace(/<\/span>/g,'</span>|||');spans=line.split('|||');each(spans,function buildTextSpans(span){if(span!==''||spans.length===1){var attributes={},tspan=doc.createElementNS(SVG_NS,'tspan'),spanStyle;if(styleRegex.test(span)){spanStyle=span.match(styleRegex)[1].replace(/(;| |^)color([ :])/,'$1fill$2');attr(tspan,'style',spanStyle);}
if(hrefRegex.test(span)&&!forExport){attr(tspan,'onclick','location.href=\"'+span.match(hrefRegex)[1]+'\"');css(tspan,{cursor:'pointer'});}
span=unescapeAngleBrackets(span.replace(/<(.|\n)*?>/g,'')||' ');if(span!==' '){tspan.appendChild(doc.createTextNode(span));if(!spanNo){if(lineNo&&parentX!==null){attributes.x=parentX;}}else{attributes.dx=0;}
attr(tspan,attributes);textNode.appendChild(tspan);if(!spanNo&&lineNo){if(!hasSVG&&forExport){css(tspan,{display:'block'});}
attr(tspan,'dy',getLineHeight(tspan));}
if(width){var words=span.replace(/([^\^])-/g,'$1- ').split(' '),hasWhiteSpace=spans.length>1||lineNo||(words.length>1&&textStyles.whiteSpace!=='nowrap'),tooLong,wasTooLong,actualWidth,rest=[],dy=getLineHeight(tspan),softLineNo=1,rotation=wrapper.rotation,wordStr=span,cursor=wordStr.length,bBox;while((hasWhiteSpace||ellipsis)&&(words.length||rest.length)){wrapper.rotation=0;bBox=wrapper.getBBox(true);actualWidth=bBox.width;if(!hasSVG&&renderer.forExport){actualWidth=renderer.measureSpanWidth(tspan.firstChild.data,wrapper.styles);}
tooLong=actualWidth>width;if(wasTooLong===undefined){wasTooLong=tooLong;}
if(ellipsis&&wasTooLong){cursor/=2;if(wordStr===''||(!tooLong&&cursor<0.5)){words=[];}else{if(tooLong){wasTooLong=true;}
wordStr=span.substring(0,wordStr.length+(tooLong?-1:1)*mathCeil(cursor));words=[wordStr+(width>3?'\u2026':'')];tspan.removeChild(tspan.firstChild);}}else if(!tooLong||words.length===1){words=rest;rest=[];if(words.length){softLineNo++;tspan=doc.createElementNS(SVG_NS,'tspan');attr(tspan,{dy:dy,x:parentX});if(spanStyle){attr(tspan,'style',spanStyle);}
textNode.appendChild(tspan);}
if(actualWidth>width){width=actualWidth;}}else{tspan.removeChild(tspan.firstChild);rest.unshift(words.pop());}
if(words.length){tspan.appendChild(doc.createTextNode(words.join(' ').replace(/- /g,'-')));}}
if(wasTooLong){wrapper.attr('title',wrapper.textStr);}
wrapper.rotation=rotation;}
spanNo++;}}});});if(tempParent){tempParent.removeChild(textNode);}
if(textShadow&&wrapper.applyTextShadow){wrapper.applyTextShadow(textShadow);}}},getContrast:function(color){color=Color(color).rgba;return color[0]+color[1]+color[2]>384?'#000000':'#FFFFFF';},button:function(text,x,y,callback,normalState,hoverState,pressedState,disabledState,shape){var label=this.label(text,x,y,shape,null,null,null,null,'button'),curState=0,stateOptions,stateStyle,normalStyle,hoverStyle,pressedStyle,disabledStyle,verticalGradient={x1:0,y1:0,x2:0,y2:1};normalState=merge({'stroke-width':1,stroke:'#CCCCCC',fill:{linearGradient:verticalGradient,stops:[[0,'#FEFEFE'],[1,'#F6F6F6']]},r:2,padding:5,style:{color:'black'}},normalState);normalStyle=normalState.style;delete normalState.style;hoverState=merge(normalState,{stroke:'#68A',fill:{linearGradient:verticalGradient,stops:[[0,'#FFF'],[1,'#ACF']]}},hoverState);hoverStyle=hoverState.style;delete hoverState.style;pressedState=merge(normalState,{stroke:'#68A',fill:{linearGradient:verticalGradient,stops:[[0,'#9BD'],[1,'#CDF']]}},pressedState);pressedStyle=pressedState.style;delete pressedState.style;disabledState=merge(normalState,{style:{color:'#CCC'}},disabledState);disabledStyle=disabledState.style;delete disabledState.style;addEvent(label.element,isMS?'mouseover':'mouseenter',function(){if(curState!==3){label.attr(hoverState).css(hoverStyle);}});addEvent(label.element,isMS?'mouseout':'mouseleave',function(){if(curState!==3){stateOptions=[normalState,hoverState,pressedState][curState];stateStyle=[normalStyle,hoverStyle,pressedStyle][curState];label.attr(stateOptions).css(stateStyle);}});label.setState=function(state){label.state=curState=state;if(!state){label.attr(normalState).css(normalStyle);}else if(state===2){label.attr(pressedState).css(pressedStyle);}else if(state===3){label.attr(disabledState).css(disabledStyle);}};return label.on('click',function(e){if(curState!==3){callback.call(label,e);}}).attr(normalState).css(extend({cursor:'default'},normalStyle));},crispLine:function(points,width){if(points[1]===points[4]){points[1]=points[4]=mathRound(points[1])-(width%2/2);}
if(points[2]===points[5]){points[2]=points[5]=mathRound(points[2])+(width%2/2);}
return points;},path:function(path){var attr={fill:NONE};if(isArray(path)){attr.d=path;}else if(isObject(path)){extend(attr,path);}
return this.createElement('path').attr(attr);},circle:function(x,y,r){var attr=isObject(x)?x:{x:x,y:y,r:r},wrapper=this.createElement('circle');wrapper.xSetter=wrapper.ySetter=function(value,key,element){element.setAttribute('c'+key,value);};return wrapper.attr(attr);},arc:function(x,y,r,innerR,start,end){var arc;if(isObject(x)){y=x.y;r=x.r;innerR=x.innerR;start=x.start;end=x.end;x=x.x;}
arc=this.symbol('arc',x||0,y||0,r||0,r||0,{innerR:innerR||0,start:start||0,end:end||0});arc.r=r;return arc;},rect:function(x,y,width,height,r,strokeWidth){r=isObject(x)?x.r:r;var wrapper=this.createElement('rect'),attribs=isObject(x)?x:x===UNDEFINED?{}:{x:x,y:y,width:mathMax(width,0),height:mathMax(height,0)};if(strokeWidth!==UNDEFINED){wrapper.strokeWidth=strokeWidth;attribs=wrapper.crisp(attribs);}
if(r){attribs.r=r;}
wrapper.rSetter=function(value,key,element){attr(element,{rx:value,ry:value});};return wrapper.attr(attribs);},setSize:function(width,height,animate){var renderer=this,alignedObjects=renderer.alignedObjects,i=alignedObjects.length;renderer.width=width;renderer.height=height;renderer.boxWrapper[pick(animate,true)?'animate':'attr']({width:width,height:height});while(i--){alignedObjects[i].align();}},g:function(name){var elem=this.createElement('g');return defined(name)?elem.attr({'class':PREFIX+name}):elem;},image:function(src,x,y,width,height){var attribs={preserveAspectRatio:NONE},elemWrapper;if(arguments.length>1){extend(attribs,{x:x,y:y,width:width,height:height});}
elemWrapper=this.createElement('image').attr(attribs);if(elemWrapper.element.setAttributeNS){elemWrapper.element.setAttributeNS('http://www.w3.org/1999/xlink','href',src);}else{elemWrapper.element.setAttribute('hc-svg-href',src);}
return elemWrapper;},symbol:function(symbol,x,y,width,height,options){var ren=this,obj,symbolFn=this.symbols[symbol],path=symbolFn&&symbolFn(mathRound(x),mathRound(y),width,height,options),imageRegex=/^url\((.*?)\)$/,imageSrc,imageSize,centerImage;if(path){obj=this.path(path);extend(obj,{symbolName:symbol,x:x,y:y,width:width,height:height});if(options){extend(obj,options);}}else if(imageRegex.test(symbol)){centerImage=function(img,size){if(img.element){img.attr({width:size[0],height:size[1]});if(!img.alignByTranslate){img.translate(mathRound((width-size[0])/2),mathRound((height-size[1])/2));}}};imageSrc=symbol.match(imageRegex)[1];imageSize=symbolSizes[imageSrc]||(options&&options.width&&options.height&&[options.width,options.height]);obj=this.image(imageSrc).attr({x:x,y:y});obj.isImg=true;if(imageSize){centerImage(obj,imageSize);}else{obj.attr({width:0,height:0});createElement('img',{onload:function(){if(this.width===0){css(this,{position:ABSOLUTE,top:'-999em'});doc.body.appendChild(this);}
centerImage(obj,symbolSizes[imageSrc]=[this.width,this.height]);if(this.parentNode){this.parentNode.removeChild(this);}
ren.imgCount--;if(!ren.imgCount&&charts[ren.chartIndex].onload){charts[ren.chartIndex].onload();}},src:imageSrc});this.imgCount++;}}
return obj;},symbols:{'circle':function(x,y,w,h){var cpw=0.166*w;return[M,x+w/2,y,'C',x+w+cpw,y,x+w+cpw,y+h,x+w/2,y+h,'C',x-cpw,y+h,x-cpw,y,x+w/2,y,'Z'];},'square':function(x,y,w,h){return[M,x,y,L,x+w,y,x+w,y+h,x,y+h,'Z'];},'triangle':function(x,y,w,h){return[M,x+w/2,y,L,x+w,y+h,x,y+h,'Z'];},'triangle-down':function(x,y,w,h){return[M,x,y,L,x+w,y,x+w/2,y+h,'Z'];},'diamond':function(x,y,w,h){return[M,x+w/2,y,L,x+w,y+h/2,x+w/2,y+h,x,y+h/2,'Z'];},'arc':function(x,y,w,h,options){var start=options.start,radius=options.r||w||h,end=options.end-0.001,innerRadius=options.innerR,open=options.open,cosStart=mathCos(start),sinStart=mathSin(start),cosEnd=mathCos(end),sinEnd=mathSin(end),longArc=options.end-start<mathPI?0:1;return[M,x+radius*cosStart,y+radius*sinStart,'A',radius,radius,0,longArc,1,x+radius*cosEnd,y+radius*sinEnd,open?M:L,x+innerRadius*cosEnd,y+innerRadius*sinEnd,'A',innerRadius,innerRadius,0,longArc,0,x+innerRadius*cosStart,y+innerRadius*sinStart,open?'':'Z'];},callout:function(x,y,w,h,options){var arrowLength=6,halfDistance=6,r=mathMin((options&&options.r)||0,w,h),safeDistance=r+halfDistance,anchorX=options&&options.anchorX,anchorY=options&&options.anchorY,path;path=['M',x+r,y,'L',x+w-r,y,'C',x+w,y,x+w,y,x+w,y+r,'L',x+w,y+h-r,'C',x+w,y+h,x+w,y+h,x+w-r,y+h,'L',x+r,y+h,'C',x,y+h,x,y+h,x,y+h-r,'L',x,y+r,'C',x,y,x,y,x+r,y];if(anchorX&&anchorX>w&&anchorY>y+safeDistance&&anchorY<y+h-safeDistance){path.splice(13,3,'L',x+w,anchorY-halfDistance,x+w+arrowLength,anchorY,x+w,anchorY+halfDistance,x+w,y+h-r);}else if(anchorX&&anchorX<0&&anchorY>y+safeDistance&&anchorY<y+h-safeDistance){path.splice(33,3,'L',x,anchorY+halfDistance,x-arrowLength,anchorY,x,anchorY-halfDistance,x,y+r);}else if(anchorY&&anchorY>h&&anchorX>x+safeDistance&&anchorX<x+w-safeDistance){path.splice(23,3,'L',anchorX+halfDistance,y+h,anchorX,y+h+arrowLength,anchorX-halfDistance,y+h,x+r,y+h);}else if(anchorY&&anchorY<0&&anchorX>x+safeDistance&&anchorX<x+w-safeDistance){path.splice(3,3,'L',anchorX-halfDistance,y,anchorX,y-arrowLength,anchorX+halfDistance,y,w-r,y);}
return path;}},clipRect:function(x,y,width,height){var wrapper,id=PREFIX+idCounter++,clipPath=this.createElement('clipPath').attr({id:id}).add(this.defs);wrapper=this.rect(x,y,width,height,0).add(clipPath);wrapper.id=id;wrapper.clipPath=clipPath;wrapper.count=0;return wrapper;},text:function(str,x,y,useHTML){var renderer=this,fakeSVG=useCanVG||(!hasSVG&&renderer.forExport),wrapper,attr={};if(useHTML&&(renderer.allowHTML||!renderer.forExport)){return renderer.html(str,x,y);}
attr.x=Math.round(x||0);if(y){attr.y=Math.round(y);}
if(str||str===0){attr.text=str;}
wrapper=renderer.createElement('text').attr(attr);if(fakeSVG){wrapper.css({position:ABSOLUTE});}
if(!useHTML){wrapper.xSetter=function(value,key,element){var tspans=element.getElementsByTagName('tspan'),tspan,parentVal=element.getAttribute(key),i;for(i=0;i<tspans.length;i++){tspan=tspans[i];if(tspan.getAttribute(key)===parentVal){tspan.setAttribute(key,value);}}
element.setAttribute(key,value);};}
return wrapper;},fontMetrics:function(fontSize,elem){var lineHeight,baseline,style;fontSize=fontSize||this.style.fontSize;if(!fontSize&&elem&&win.getComputedStyle){elem=elem.element||elem;style=win.getComputedStyle(elem,'');fontSize=style&&style.fontSize;}
fontSize=/px/.test(fontSize)?pInt(fontSize):/em/.test(fontSize)?parseFloat(fontSize)*12:12;lineHeight=fontSize<24?fontSize+3:mathRound(fontSize*1.2);baseline=mathRound(lineHeight*0.8);return{h:lineHeight,b:baseline,f:fontSize};},rotCorr:function(baseline,rotation,alterY){var y=baseline;if(rotation&&alterY){y=mathMax(y*mathCos(rotation*deg2rad),4);}
return{x:(-baseline/3)*mathSin(rotation*deg2rad),y:y};},label:function(str,x,y,shape,anchorX,anchorY,useHTML,baseline,className){var renderer=this,wrapper=renderer.g(className),text=renderer.text('',0,0,useHTML).attr({zIndex:1}),box,bBox,alignFactor=0,padding=3,paddingLeft=0,width,height,wrapperX,wrapperY,crispAdjust=0,deferredAttr={},baselineOffset,needsBox,updateBoxSize,updateTextPadding,boxAttr;updateBoxSize=function(){var boxX,boxY,style=text.element.style;bBox=(width===undefined||height===undefined||wrapper.styles.textAlign)&&defined(text.textStr)&&text.getBBox();wrapper.width=(width||bBox.width||0)+2*padding+paddingLeft;wrapper.height=(height||bBox.height||0)+2*padding;baselineOffset=padding+renderer.fontMetrics(style&&style.fontSize,text).b;if(needsBox){if(!box){boxX=crispAdjust;boxY=(baseline?-baselineOffset:0)+crispAdjust;wrapper.box=box=shape?renderer.symbol(shape,boxX,boxY,wrapper.width,wrapper.height,deferredAttr):renderer.rect(boxX,boxY,wrapper.width,wrapper.height,0,deferredAttr[STROKE_WIDTH]);if(!box.isImg){box.attr('fill',NONE);}
box.add(wrapper);}
if(!box.isImg){box.attr(extend({width:mathRound(wrapper.width),height:mathRound(wrapper.height)},deferredAttr));}
deferredAttr=null;}};updateTextPadding=function(){var styles=wrapper.styles,textAlign=styles&&styles.textAlign,x=paddingLeft+padding,y;y=baseline?0:baselineOffset;if(defined(width)&&bBox&&(textAlign==='center'||textAlign==='right')){x+={center:0.5,right:1}[textAlign]*(width-bBox.width);}
if(x!==text.x||y!==text.y){text.attr('x',x);if(y!==UNDEFINED){text.attr('y',y);}}
text.x=x;text.y=y;};boxAttr=function(key,value){if(box){box.attr(key,value);}else{deferredAttr[key]=value;}};wrapper.onAdd=function(){text.add(wrapper);wrapper.attr({text:(str||str===0)?str:'',x:x,y:y});if(box&&defined(anchorX)){wrapper.attr({anchorX:anchorX,anchorY:anchorY});}};wrapper.widthSetter=function(value){width=value;};wrapper.heightSetter=function(value){height=value;};wrapper.paddingSetter=function(value){if(defined(value)&&value!==padding){padding=wrapper.padding=value;updateTextPadding();}};wrapper.paddingLeftSetter=function(value){if(defined(value)&&value!==paddingLeft){paddingLeft=value;updateTextPadding();}};wrapper.alignSetter=function(value){value={left:0,center:0.5,right:1}[value];if(value!==alignFactor){alignFactor=value;if(bBox){wrapper.attr({x:wrapperX});}}};wrapper.textSetter=function(value){if(value!==UNDEFINED){text.textSetter(value);}
updateBoxSize();updateTextPadding();};wrapper['stroke-widthSetter']=function(value,key){if(value){needsBox=true;}
crispAdjust=value%2/2;boxAttr(key,value);};wrapper.strokeSetter=wrapper.fillSetter=wrapper.rSetter=function(value,key){if(key==='fill'&&value){needsBox=true;}
boxAttr(key,value);};wrapper.anchorXSetter=function(value,key){anchorX=value;boxAttr(key,mathRound(value)-crispAdjust-wrapperX);};wrapper.anchorYSetter=function(value,key){anchorY=value;boxAttr(key,value-wrapperY);};wrapper.xSetter=function(value){wrapper.x=value;if(alignFactor){value-=alignFactor*((width||bBox.width)+2*padding);}
wrapperX=mathRound(value);wrapper.attr('translateX',wrapperX);};wrapper.ySetter=function(value){wrapperY=wrapper.y=mathRound(value);wrapper.attr('translateY',wrapperY);};var baseCss=wrapper.css;return extend(wrapper,{css:function(styles){if(styles){var textStyles={};styles=merge(styles);each(wrapper.textProps,function(prop){if(styles[prop]!==UNDEFINED){textStyles[prop]=styles[prop];delete styles[prop];}});text.css(textStyles);}
return baseCss.call(wrapper,styles);},getBBox:function(){return{width:bBox.width+2*padding,height:bBox.height+2*padding,x:bBox.x-padding,y:bBox.y-padding};},shadow:function(b){if(box){box.shadow(b);}
return wrapper;},destroy:function(){removeEvent(wrapper.element,'mouseenter');removeEvent(wrapper.element,'mouseleave');if(text){text=text.destroy();}
if(box){box=box.destroy();}
SVGElement.prototype.destroy.call(wrapper);wrapper=renderer=updateBoxSize=updateTextPadding=boxAttr=null;}});}};Renderer=SVGRenderer;extend(SVGElement.prototype,{htmlCss:function(styles){var wrapper=this,element=wrapper.element,textWidth=styles&&element.tagName==='SPAN'&&styles.width;if(textWidth){delete styles.width;wrapper.textWidth=textWidth;wrapper.updateTransform();}
if(styles&&styles.textOverflow==='ellipsis'){styles.whiteSpace='nowrap';styles.overflow='hidden';}
wrapper.styles=extend(wrapper.styles,styles);css(wrapper.element,styles);return wrapper;},htmlGetBBox:function(){var wrapper=this,element=wrapper.element;if(element.nodeName==='text'){element.style.position=ABSOLUTE;}
return{x:element.offsetLeft,y:element.offsetTop,width:element.offsetWidth,height:element.offsetHeight};},htmlUpdateTransform:function(){if(!this.added){this.alignOnAdd=true;return;}
var wrapper=this,renderer=wrapper.renderer,elem=wrapper.element,translateX=wrapper.translateX||0,translateY=wrapper.translateY||0,x=wrapper.x||0,y=wrapper.y||0,align=wrapper.textAlign||'left',alignCorrection={left:0,center:0.5,right:1}[align],shadows=wrapper.shadows,styles=wrapper.styles;css(elem,{marginLeft:translateX,marginTop:translateY});if(shadows){each(shadows,function(shadow){css(shadow,{marginLeft:translateX+1,marginTop:translateY+1});});}
if(wrapper.inverted){each(elem.childNodes,function(child){renderer.invertChild(child,elem);});}
if(elem.tagName==='SPAN'){var rotation=wrapper.rotation,baseline,textWidth=pInt(wrapper.textWidth),whiteSpace=styles&&styles.whiteSpace,currentTextTransform=[rotation,align,elem.innerHTML,wrapper.textWidth,wrapper.textAlign].join(',');if(currentTextTransform!==wrapper.cTT){baseline=renderer.fontMetrics(elem.style.fontSize).b;if(defined(rotation)){wrapper.setSpanRotation(rotation,alignCorrection,baseline);}
if(elem.offsetWidth>textWidth&&/[ \-]/.test(elem.textContent||elem.innerText)){css(elem,{width:textWidth+PX,display:'block',whiteSpace:whiteSpace||'normal'});wrapper.hasTextWidth=true;}else if(wrapper.hasTextWidth){css(elem,{width:'',display:'',whiteSpace:whiteSpace||'nowrap'});wrapper.hasTextWidth=false;}
wrapper.getSpanCorrection(wrapper.hasTextWidth?textWidth:elem.offsetWidth,baseline,alignCorrection,rotation,align);}
css(elem,{left:(x+(wrapper.xCorr||0))+PX,top:(y+(wrapper.yCorr||0))+PX});if(isWebKit){baseline=elem.offsetHeight;}
wrapper.cTT=currentTextTransform;}},setSpanRotation:function(rotation,alignCorrection,baseline){var rotationStyle={},cssTransformKey=isMS?'-ms-transform':isWebKit?'-webkit-transform':isFirefox?'MozTransform':isOpera?'-o-transform':'';rotationStyle[cssTransformKey]=rotationStyle.transform='rotate('+rotation+'deg)';rotationStyle[cssTransformKey+(isFirefox?'Origin':'-origin')]=rotationStyle.transformOrigin=(alignCorrection*100)+'% '+baseline+'px';css(this.element,rotationStyle);},getSpanCorrection:function(width,baseline,alignCorrection){this.xCorr=-width*alignCorrection;this.yCorr=-baseline;}});extend(SVGRenderer.prototype,{html:function(str,x,y){var wrapper=this.createElement('span'),element=wrapper.element,renderer=wrapper.renderer,isSVG=renderer.isSVG,addSetters=function(element,style){each(['opacity','visibility'],function(prop){wrap(element,prop+'Setter',function(proceed,value,key,elem){proceed.call(this,value,key,elem);style[key]=value;});});};wrapper.textSetter=function(value){if(value!==element.innerHTML){delete this.bBox;}
element.innerHTML=this.textStr=value;wrapper.htmlUpdateTransform();};if(isSVG){addSetters(wrapper,wrapper.element.style);}
wrapper.xSetter=wrapper.ySetter=wrapper.alignSetter=wrapper.rotationSetter=function(value,key){if(key==='align'){key='textAlign';}
wrapper[key]=value;wrapper.htmlUpdateTransform();};wrapper.attr({text:str,x:mathRound(x),y:mathRound(y)}).css({position:ABSOLUTE,fontFamily:this.style.fontFamily,fontSize:this.style.fontSize});element.style.whiteSpace='nowrap';wrapper.css=wrapper.htmlCss;if(isSVG){wrapper.add=function(svgGroupWrapper){var htmlGroup,container=renderer.box.parentNode,parentGroup,parents=[];this.parentGroup=svgGroupWrapper;if(svgGroupWrapper){htmlGroup=svgGroupWrapper.div;if(!htmlGroup){parentGroup=svgGroupWrapper;while(parentGroup){parents.push(parentGroup);parentGroup=parentGroup.parentGroup;}
each(parents.reverse(),function(parentGroup){var htmlGroupStyle,cls=attr(parentGroup.element,'class');if(cls){cls={className:cls};}
htmlGroup=parentGroup.div=parentGroup.div||createElement(DIV,cls,{position:ABSOLUTE,left:(parentGroup.translateX||0)+PX,top:(parentGroup.translateY||0)+PX,opacity:parentGroup.opacity},htmlGroup||container);htmlGroupStyle=htmlGroup.style;extend(parentGroup,{translateXSetter:function(value,key){htmlGroupStyle.left=value+PX;parentGroup[key]=value;parentGroup.doTransform=true;},translateYSetter:function(value,key){htmlGroupStyle.top=value+PX;parentGroup[key]=value;parentGroup.doTransform=true;}});addSetters(parentGroup,htmlGroupStyle);});}}else{htmlGroup=container;}
htmlGroup.appendChild(element);wrapper.added=true;if(wrapper.alignOnAdd){wrapper.htmlUpdateTransform();}
return wrapper;};}
return wrapper;}});var VMLRenderer,VMLElement;if(!hasSVG&&!useCanVG){VMLElement={init:function(renderer,nodeName){var wrapper=this,markup=['<',nodeName,' filled="f" stroked="f"'],style=['position: ',ABSOLUTE,';'],isDiv=nodeName===DIV;if(nodeName==='shape'||isDiv){style.push('left:0;top:0;width:1px;height:1px;');}
style.push('visibility: ',isDiv?HIDDEN:VISIBLE);markup.push(' style="',style.join(''),'"/>');if(nodeName){markup=isDiv||nodeName==='span'||nodeName==='img'?markup.join(''):renderer.prepVML(markup);wrapper.element=createElement(markup);}
wrapper.renderer=renderer;},add:function(parent){var wrapper=this,renderer=wrapper.renderer,element=wrapper.element,box=renderer.box,inverted=parent&&parent.inverted,parentNode=parent?parent.element||parent:box;if(parent){this.parentGroup=parent;}
if(inverted){renderer.invertChild(element,parentNode);}
parentNode.appendChild(element);wrapper.added=true;if(wrapper.alignOnAdd&&!wrapper.deferUpdateTransform){wrapper.updateTransform();}
if(wrapper.onAdd){wrapper.onAdd();}
return wrapper;},updateTransform:SVGElement.prototype.htmlUpdateTransform,setSpanRotation:function(){var rotation=this.rotation,costheta=mathCos(rotation*deg2rad),sintheta=mathSin(rotation*deg2rad);css(this.element,{filter:rotation?['progid:DXImageTransform.Microsoft.Matrix(M11=',costheta,', M12=',-sintheta,', M21=',sintheta,', M22=',costheta,', sizingMethod=\'auto expand\')'].join(''):NONE});},getSpanCorrection:function(width,baseline,alignCorrection,rotation,align){var costheta=rotation?mathCos(rotation*deg2rad):1,sintheta=rotation?mathSin(rotation*deg2rad):0,height=pick(this.elemHeight,this.element.offsetHeight),quad,nonLeft=align&&align!=='left';this.xCorr=costheta<0&&-width;this.yCorr=sintheta<0&&-height;quad=costheta*sintheta<0;this.xCorr+=sintheta*baseline*(quad?1-alignCorrection:alignCorrection);this.yCorr-=costheta*baseline*(rotation?(quad?alignCorrection:1-alignCorrection):1);if(nonLeft){this.xCorr-=width*alignCorrection*(costheta<0?-1:1);if(rotation){this.yCorr-=height*alignCorrection*(sintheta<0?-1:1);}
css(this.element,{textAlign:align});}},pathToVML:function(value){var i=value.length,path=[];while(i--){if(isNumber(value[i])){path[i]=mathRound(value[i]*10)-5;}else if(value[i]==='Z'){path[i]='x';}else{path[i]=value[i];if(value.isArc&&(value[i]==='wa'||value[i]==='at')){if(path[i+5]===path[i+7]){path[i+7]+=value[i+7]>value[i+5]?1:-1;}
if(path[i+6]===path[i+8]){path[i+8]+=value[i+8]>value[i+6]?1:-1;}}}}
return path.join(' ')||'x';},clip:function(clipRect){var wrapper=this,clipMembers,cssRet;if(clipRect){clipMembers=clipRect.members;erase(clipMembers,wrapper);clipMembers.push(wrapper);wrapper.destroyClip=function(){erase(clipMembers,wrapper);};cssRet=clipRect.getCSS(wrapper);}else{if(wrapper.destroyClip){wrapper.destroyClip();}
cssRet={clip:docMode8?'inherit':'rect(auto)'};}
return wrapper.css(cssRet);},css:SVGElement.prototype.htmlCss,safeRemoveChild:function(element){if(element.parentNode){discardElement(element);}},destroy:function(){if(this.destroyClip){this.destroyClip();}
return SVGElement.prototype.destroy.apply(this);},on:function(eventType,handler){this.element['on'+eventType]=function(){var evt=win.event;evt.target=evt.srcElement;handler(evt);};return this;},cutOffPath:function(path,length){var len;path=path.split(/[ ,]/);len=path.length;if(len===9||len===11){path[len-4]=path[len-2]=pInt(path[len-2])-10*length;}
return path.join(' ');},shadow:function(shadowOptions,group,cutOff){var shadows=[],i,element=this.element,renderer=this.renderer,shadow,elemStyle=element.style,markup,path=element.path,strokeWidth,modifiedPath,shadowWidth,shadowElementOpacity;if(path&&typeof path.value!=='string'){path='x';}
modifiedPath=path;if(shadowOptions){shadowWidth=pick(shadowOptions.width,3);shadowElementOpacity=(shadowOptions.opacity||0.15)/shadowWidth;for(i=1;i<=3;i++){strokeWidth=(shadowWidth*2)+1-(2*i);if(cutOff){modifiedPath=this.cutOffPath(path.value,strokeWidth+0.5);}
markup=['<shape isShadow="true" strokeweight="',strokeWidth,'" filled="false" path="',modifiedPath,'" coordsize="10 10" style="',element.style.cssText,'" />'];shadow=createElement(renderer.prepVML(markup),null,{left:pInt(elemStyle.left)+pick(shadowOptions.offsetX,1),top:pInt(elemStyle.top)+pick(shadowOptions.offsetY,1)});if(cutOff){shadow.cutOff=strokeWidth+1;}
markup=['<stroke color="',shadowOptions.color||'black','" opacity="',shadowElementOpacity*i,'"/>'];createElement(renderer.prepVML(markup),null,null,shadow);if(group){group.element.appendChild(shadow);}else{element.parentNode.insertBefore(shadow,element);}
shadows.push(shadow);}
this.shadows=shadows;}
return this;},updateShadows:noop,setAttr:function(key,value){if(docMode8){this.element[key]=value;}else{this.element.setAttribute(key,value);}},classSetter:function(value){this.element.className=value;},dashstyleSetter:function(value,key,element){var strokeElem=element.getElementsByTagName('stroke')[0]||createElement(this.renderer.prepVML(['<stroke/>']),null,null,element);strokeElem[key]=value||'solid';this[key]=value;},dSetter:function(value,key,element){var i,shadows=this.shadows;value=value||[];this.d=value.join&&value.join(' ');element.path=value=this.pathToVML(value);if(shadows){i=shadows.length;while(i--){shadows[i].path=shadows[i].cutOff?this.cutOffPath(value,shadows[i].cutOff):value;}}
this.setAttr(key,value);},fillSetter:function(value,key,element){var nodeName=element.nodeName;if(nodeName==='SPAN'){element.style.color=value;}else if(nodeName!=='IMG'){element.filled=value!==NONE;this.setAttr('fillcolor',this.renderer.color(value,element,key,this));}},'fill-opacitySetter':function(value,key,element){createElement(this.renderer.prepVML(['<',key.split('-')[0],' opacity="',value,'"/>']),null,null,element);},opacitySetter:noop,rotationSetter:function(value,key,element){var style=element.style;this[key]=style[key]=value;style.left=-mathRound(mathSin(value*deg2rad)+1)+PX;style.top=mathRound(mathCos(value*deg2rad))+PX;},strokeSetter:function(value,key,element){this.setAttr('strokecolor',this.renderer.color(value,element,key,this));},'stroke-widthSetter':function(value,key,element){element.stroked=!!value;this[key]=value;if(isNumber(value)){value+=PX;}
this.setAttr('strokeweight',value);},titleSetter:function(value,key){this.setAttr(key,value);},visibilitySetter:function(value,key,element){if(value==='inherit'){value=VISIBLE;}
if(this.shadows){each(this.shadows,function(shadow){shadow.style[key]=value;});}
if(element.nodeName==='DIV'){value=value===HIDDEN?'-999em':0;if(!docMode8){element.style[key]=value?VISIBLE:HIDDEN;}
key='top';}
element.style[key]=value;},xSetter:function(value,key,element){this[key]=value;if(key==='x'){key='left';}else if(key==='y'){key='top';}
if(this.updateClipping){this[key]=value;this.updateClipping();}else{element.style[key]=value;}},zIndexSetter:function(value,key,element){element.style[key]=value;}};VMLElement['stroke-opacitySetter']=VMLElement['fill-opacitySetter'];Highcharts.VMLElement=VMLElement=extendClass(SVGElement,VMLElement);VMLElement.prototype.ySetter=VMLElement.prototype.widthSetter=VMLElement.prototype.heightSetter=VMLElement.prototype.xSetter;var VMLRendererExtension={Element:VMLElement,isIE8:userAgent.indexOf('MSIE 8.0')>-1,init:function(container,width,height,style){var renderer=this,boxWrapper,box,css;renderer.alignedObjects=[];boxWrapper=renderer.createElement(DIV).css(extend(this.getStyle(style),{position:'relative'}));box=boxWrapper.element;container.appendChild(boxWrapper.element);renderer.isVML=true;renderer.box=box;renderer.boxWrapper=boxWrapper;renderer.gradients={};renderer.cache={};renderer.cacheKeys=[];renderer.imgCount=0;renderer.setSize(width,height,false);if(!doc.namespaces.hcv){doc.namespaces.add('hcv','urn:schemas-microsoft-com:vml');css='hcv\\:fill, hcv\\:path, hcv\\:shape, hcv\\:stroke'+'{ behavior:url(#default#VML); display: inline-block; } ';try{doc.createStyleSheet().cssText=css;}catch(e){doc.styleSheets[0].cssText+=css;}}},isHidden:function(){return!this.box.offsetWidth;},clipRect:function(x,y,width,height){var clipRect=this.createElement(),isObj=isObject(x);return extend(clipRect,{members:[],count:0,left:(isObj?x.x:x)+1,top:(isObj?x.y:y)+1,width:(isObj?x.width:width)-1,height:(isObj?x.height:height)-1,getCSS:function(wrapper){var element=wrapper.element,nodeName=element.nodeName,isShape=nodeName==='shape',inverted=wrapper.inverted,rect=this,top=rect.top-(isShape?element.offsetTop:0),left=rect.left,right=left+rect.width,bottom=top+rect.height,ret={clip:'rect('+
mathRound(inverted?left:top)+'px,'+
mathRound(inverted?bottom:right)+'px,'+
mathRound(inverted?right:bottom)+'px,'+
mathRound(inverted?top:left)+'px)'};if(!inverted&&docMode8&&nodeName==='DIV'){extend(ret,{width:right+PX,height:bottom+PX});}
return ret;},updateClipping:function(){each(clipRect.members,function(member){if(member.element){member.css(clipRect.getCSS(member));}});}});},color:function(color,elem,prop,wrapper){var renderer=this,colorObject,regexRgba=/^rgba/,markup,fillType,ret=NONE;if(color&&color.linearGradient){fillType='gradient';}else if(color&&color.radialGradient){fillType='pattern';}
if(fillType){var stopColor,stopOpacity,gradient=color.linearGradient||color.radialGradient,x1,y1,x2,y2,opacity1,opacity2,color1,color2,fillAttr='',stops=color.stops,firstStop,lastStop,colors=[],addFillNode=function(){markup=['<fill colors="'+colors.join(',')+'" opacity="',opacity2,'" o:opacity2="',opacity1,'" type="',fillType,'" ',fillAttr,'focus="100%" method="any" />'];createElement(renderer.prepVML(markup),null,null,elem);};firstStop=stops[0];lastStop=stops[stops.length-1];if(firstStop[0]>0){stops.unshift([0,firstStop[1]]);}
if(lastStop[0]<1){stops.push([1,lastStop[1]]);}
each(stops,function(stop,i){if(regexRgba.test(stop[1])){colorObject=Color(stop[1]);stopColor=colorObject.get('rgb');stopOpacity=colorObject.get('a');}else{stopColor=stop[1];stopOpacity=1;}
colors.push((stop[0]*100)+'% '+stopColor);if(!i){opacity1=stopOpacity;color2=stopColor;}else{opacity2=stopOpacity;color1=stopColor;}});if(prop==='fill'){if(fillType==='gradient'){x1=gradient.x1||gradient[0]||0;y1=gradient.y1||gradient[1]||0;x2=gradient.x2||gradient[2]||0;y2=gradient.y2||gradient[3]||0;fillAttr='angle="'+(90-math.atan((y2-y1)/(x2-x1))*180/mathPI)+'"';addFillNode();}else{var r=gradient.r,sizex=r*2,sizey=r*2,cx=gradient.cx,cy=gradient.cy,radialReference=elem.radialReference,bBox,applyRadialGradient=function(){if(radialReference){bBox=wrapper.getBBox();cx+=(radialReference[0]-bBox.x)/bBox.width-0.5;cy+=(radialReference[1]-bBox.y)/bBox.height-0.5;sizex*=radialReference[2]/bBox.width;sizey*=radialReference[2]/bBox.height;}
fillAttr='src="'+defaultOptions.global.VMLRadialGradientURL+'" '+'size="'+sizex+','+sizey+'" '+'origin="0.5,0.5" '+'position="'+cx+','+cy+'" '+'color2="'+color2+'" ';addFillNode();};if(wrapper.added){applyRadialGradient();}else{wrapper.onAdd=applyRadialGradient;}
ret=color1;}}else{ret=stopColor;}}else if(regexRgba.test(color)&&elem.tagName!=='IMG'){colorObject=Color(color);wrapper[prop+'-opacitySetter'](colorObject.get('a'),prop,elem);ret=colorObject.get('rgb');}else{var propNodes=elem.getElementsByTagName(prop);if(propNodes.length){propNodes[0].opacity=1;propNodes[0].type='solid';}
ret=color;}
return ret;},prepVML:function(markup){var vmlStyle='display:inline-block;behavior:url(#default#VML);',isIE8=this.isIE8;markup=markup.join('');if(isIE8){markup=markup.replace('/>',' xmlns="urn:schemas-microsoft-com:vml" />');if(markup.indexOf('style="')===-1){markup=markup.replace('/>',' style="'+vmlStyle+'" />');}else{markup=markup.replace('style="','style="'+vmlStyle);}}else{markup=markup.replace('<','<hcv:');}
return markup;},text:SVGRenderer.prototype.html,path:function(path){var attr={coordsize:'10 10'};if(isArray(path)){attr.d=path;}else if(isObject(path)){extend(attr,path);}
return this.createElement('shape').attr(attr);},circle:function(x,y,r){var circle=this.symbol('circle');if(isObject(x)){r=x.r;y=x.y;x=x.x;}
circle.isCircle=true;circle.r=r;return circle.attr({x:x,y:y});},g:function(name){var wrapper,attribs;if(name){attribs={'className':PREFIX+name,'class':PREFIX+name};}
wrapper=this.createElement(DIV).attr(attribs);return wrapper;},image:function(src,x,y,width,height){var obj=this.createElement('img').attr({src:src});if(arguments.length>1){obj.attr({x:x,y:y,width:width,height:height});}
return obj;},createElement:function(nodeName){return nodeName==='rect'?this.symbol(nodeName):SVGRenderer.prototype.createElement.call(this,nodeName);},invertChild:function(element,parentNode){var ren=this,parentStyle=parentNode.style,imgStyle=element.tagName==='IMG'&&element.style;css(element,{flip:'x',left:pInt(parentStyle.width)-(imgStyle?pInt(imgStyle.top):1),top:pInt(parentStyle.height)-(imgStyle?pInt(imgStyle.left):1),rotation:-90});each(element.childNodes,function(child){ren.invertChild(child,element);});},symbols:{arc:function(x,y,w,h,options){var start=options.start,end=options.end,radius=options.r||w||h,innerRadius=options.innerR,cosStart=mathCos(start),sinStart=mathSin(start),cosEnd=mathCos(end),sinEnd=mathSin(end),ret;if(end-start===0){return['x'];}
ret=['wa',x-radius,y-radius,x+radius,y+radius,x+radius*cosStart,y+radius*sinStart,x+radius*cosEnd,y+radius*sinEnd];if(options.open&&!innerRadius){ret.push('e',M,x,y);}
ret.push('at',x-innerRadius,y-innerRadius,x+innerRadius,y+innerRadius,x+innerRadius*cosEnd,y+innerRadius*sinEnd,x+innerRadius*cosStart,y+innerRadius*sinStart,'x','e');ret.isArc=true;return ret;},circle:function(x,y,w,h,wrapper){if(wrapper){w=h=2*wrapper.r;}
if(wrapper&&wrapper.isCircle){x-=w/2;y-=h/2;}
return['wa',x,y,x+w,y+h,x+w,y+h/2,x+w,y+h/2,'e'];},rect:function(x,y,w,h,options){return SVGRenderer.prototype.symbols[!defined(options)||!options.r?'square':'callout'].call(0,x,y,w,h,options);}}};Highcharts.VMLRenderer=VMLRenderer=function(){this.init.apply(this,arguments);};VMLRenderer.prototype=merge(SVGRenderer.prototype,VMLRendererExtension);Renderer=VMLRenderer;}
SVGRenderer.prototype.measureSpanWidth=function(text,styles){var measuringSpan=doc.createElement('span'),offsetWidth,textNode=doc.createTextNode(text);measuringSpan.appendChild(textNode);css(measuringSpan,styles);this.box.appendChild(measuringSpan);offsetWidth=measuringSpan.offsetWidth;discardElement(measuringSpan);return offsetWidth;};var CanVGRenderer,CanVGController;function getScript(scriptLocation,callback){var head=doc.getElementsByTagName('head')[0],script=doc.createElement('script');script.type='text/javascript';script.src=scriptLocation;script.onload=callback;head.appendChild(script);}
if(useCanVG){Highcharts.CanVGRenderer=CanVGRenderer=function(){SVG_NS='http://www.w3.org/1999/xhtml';};CanVGRenderer.prototype.symbols={};CanVGController=(function(){var deferredRenderCalls=[];function drawDeferred(){var callLength=deferredRenderCalls.length,callIndex;for(callIndex=0;callIndex<callLength;callIndex++){deferredRenderCalls[callIndex]();}
deferredRenderCalls=[];}
return{push:function(func,scriptLocation){if(deferredRenderCalls.length===0){getScript(scriptLocation,drawDeferred);}
deferredRenderCalls.push(func);}};}());Renderer=CanVGRenderer;}
function Tick(axis,pos,type,noLabel){this.axis=axis;this.pos=pos;this.type=type||'';this.isNew=true;if(!type&&!noLabel){this.addLabel();}}
Tick.prototype={addLabel:function(){var tick=this,axis=tick.axis,options=axis.options,chart=axis.chart,categories=axis.categories,names=axis.names,pos=tick.pos,labelOptions=options.labels,str,tickPositions=axis.tickPositions,isFirst=pos===tickPositions[0],isLast=pos===tickPositions[tickPositions.length-1],value=categories?pick(categories[pos],names[pos],pos):pos,label=tick.label,tickPositionInfo=tickPositions.info,dateTimeLabelFormat;if(axis.isDatetimeAxis&&tickPositionInfo){dateTimeLabelFormat=options.dateTimeLabelFormats[tickPositionInfo.higherRanks[pos]||tickPositionInfo.unitName];}
tick.isFirst=isFirst;tick.isLast=isLast;str=axis.labelFormatter.call({axis:axis,chart:chart,isFirst:isFirst,isLast:isLast,dateTimeLabelFormat:dateTimeLabelFormat,value:axis.isLog?correctFloat(axis.lin2log(value)):value});if(!defined(label)){tick.label=label=defined(str)&&labelOptions.enabled?chart.renderer.text(str,0,0,labelOptions.useHTML).css(merge(labelOptions.style)).add(axis.labelGroup):null;tick.labelLength=label&&label.getBBox().width;tick.rotation=0;}else if(label){label.attr({text:str});}},getLabelSize:function(){return this.label?this.label.getBBox()[this.axis.horiz?'height':'width']:0;},handleOverflow:function(xy){var axis=this.axis,pxPos=xy.x,chartWidth=axis.chart.chartWidth,spacing=axis.chart.spacing,leftBound=pick(axis.labelLeft,mathMin(axis.pos,spacing[3])),rightBound=pick(axis.labelRight,mathMax(axis.pos+axis.len,chartWidth-spacing[1])),label=this.label,rotation=this.rotation,factor={left:0,center:0.5,right:1}[axis.labelAlign],labelWidth=label.getBBox().width,slotWidth=axis.getSlotWidth(),modifiedSlotWidth=slotWidth,xCorrection=factor,goRight=1,leftPos,rightPos,textWidth,css={};if(!rotation){leftPos=pxPos-factor*labelWidth;rightPos=pxPos+(1-factor)*labelWidth;if(leftPos<leftBound){modifiedSlotWidth=xy.x+modifiedSlotWidth*(1-factor)-leftBound;}else if(rightPos>rightBound){modifiedSlotWidth=rightBound-xy.x+modifiedSlotWidth*factor;goRight=-1;}
modifiedSlotWidth=mathMin(slotWidth,modifiedSlotWidth);if(modifiedSlotWidth<slotWidth&&axis.labelAlign==='center'){xy.x+=goRight*(slotWidth-modifiedSlotWidth-xCorrection*(slotWidth-mathMin(labelWidth,modifiedSlotWidth)));}
if(labelWidth>modifiedSlotWidth||(axis.autoRotation&&label.styles.width)){textWidth=modifiedSlotWidth;}}else if(rotation<0&&pxPos-factor*labelWidth<leftBound){textWidth=mathRound(pxPos/mathCos(rotation*deg2rad)-leftBound);}else if(rotation>0&&pxPos+factor*labelWidth>rightBound){textWidth=mathRound((chartWidth-pxPos)/mathCos(rotation*deg2rad));}
if(textWidth){css.width=textWidth;if(!axis.options.labels.style.textOverflow){css.textOverflow='ellipsis';}
label.css(css);}},getPosition:function(horiz,pos,tickmarkOffset,old){var axis=this.axis,chart=axis.chart,cHeight=(old&&chart.oldChartHeight)||chart.chartHeight;return{x:horiz?axis.translate(pos+tickmarkOffset,null,null,old)+axis.transB:axis.left+axis.offset+(axis.opposite?((old&&chart.oldChartWidth)||chart.chartWidth)-axis.right-axis.left:0),y:horiz?cHeight-axis.bottom+axis.offset-(axis.opposite?axis.height:0):cHeight-axis.translate(pos+tickmarkOffset,null,null,old)-axis.transB};},getLabelPosition:function(x,y,label,horiz,labelOptions,tickmarkOffset,index,step){var axis=this.axis,transA=axis.transA,reversed=axis.reversed,staggerLines=axis.staggerLines,rotCorr=axis.tickRotCorr||{x:0,y:0},yOffset=labelOptions.y,line;if(!defined(yOffset)){if(axis.side===0){yOffset=label.rotation?-8:-label.getBBox().height;}else if(axis.side===2){yOffset=rotCorr.y+8;}else{yOffset=mathCos(label.rotation*deg2rad)*(rotCorr.y-label.getBBox(false,0).height/2);}}
x=x+labelOptions.x+rotCorr.x-(tickmarkOffset&&horiz?tickmarkOffset*transA*(reversed?-1:1):0);y=y+yOffset-(tickmarkOffset&&!horiz?tickmarkOffset*transA*(reversed?1:-1):0);if(staggerLines){line=(index/(step||1)%staggerLines);if(axis.opposite){line=staggerLines-line-1;}
y+=line*(axis.labelOffset/staggerLines);}
return{x:x,y:mathRound(y)};},getMarkPath:function(x,y,tickLength,tickWidth,horiz,renderer){return renderer.crispLine([M,x,y,L,x+(horiz?0:-tickLength),y+(horiz?tickLength:0)],tickWidth);},render:function(index,old,opacity){var tick=this,axis=tick.axis,options=axis.options,chart=axis.chart,renderer=chart.renderer,horiz=axis.horiz,type=tick.type,label=tick.label,pos=tick.pos,labelOptions=options.labels,gridLine=tick.gridLine,gridPrefix=type?type+'Grid':'grid',tickPrefix=type?type+'Tick':'tick',gridLineWidth=options[gridPrefix+'LineWidth'],gridLineColor=options[gridPrefix+'LineColor'],dashStyle=options[gridPrefix+'LineDashStyle'],tickSize=axis.tickSize(tickPrefix),tickColor=options[tickPrefix+'Color'],gridLinePath,mark=tick.mark,markPath,step=labelOptions.step,attribs,show=true,tickmarkOffset=axis.tickmarkOffset,xy=tick.getPosition(horiz,pos,tickmarkOffset,old),x=xy.x,y=xy.y,reverseCrisp=((horiz&&x===axis.pos+axis.len)||(!horiz&&y===axis.pos))?-1:1;opacity=pick(opacity,1);this.isActive=true;if(gridLineWidth){gridLinePath=axis.getPlotLinePath(pos+tickmarkOffset,gridLineWidth*reverseCrisp,old,true);if(gridLine===UNDEFINED){attribs={stroke:gridLineColor,'stroke-width':gridLineWidth};if(dashStyle){attribs.dashstyle=dashStyle;}
if(!type){attribs.zIndex=1;}
if(old){attribs.opacity=0;}
tick.gridLine=gridLine=gridLineWidth?renderer.path(gridLinePath).attr(attribs).add(axis.gridGroup):null;}
if(!old&&gridLine&&gridLinePath){gridLine[tick.isNew?'attr':'animate']({d:gridLinePath,opacity:opacity});}}
if(tickSize){if(axis.opposite){tickSize[0]=-tickSize[0];}
markPath=tick.getMarkPath(x,y,tickSize[0],tickSize[1]*reverseCrisp,horiz,renderer);if(mark){mark.animate({d:markPath,opacity:opacity});}else{tick.mark=renderer.path(markPath).attr({stroke:tickColor,'stroke-width':tickSize[1],opacity:opacity}).add(axis.axisGroup);}}
if(label&&!isNaN(x)){label.xy=xy=tick.getLabelPosition(x,y,label,horiz,labelOptions,tickmarkOffset,index,step);if((tick.isFirst&&!tick.isLast&&!pick(options.showFirstLabel,1))||(tick.isLast&&!tick.isFirst&&!pick(options.showLastLabel,1))){show=false;}else if(horiz&&!axis.isRadial&&!labelOptions.step&&!labelOptions.rotation&&!old&&opacity!==0){tick.handleOverflow(xy);}
if(step&&index%step){show=false;}
if(show&&!isNaN(xy.y)){xy.opacity=opacity;label[tick.isNew?'attr':'animate'](xy);tick.isNew=false;}else{label.attr('y',-9999);}}},destroy:function(){destroyObjectProperties(this,this.axis);}};Highcharts.PlotLineOrBand=function(axis,options){this.axis=axis;if(options){this.options=options;this.id=options.id;}};Highcharts.PlotLineOrBand.prototype={render:function(){var plotLine=this,axis=plotLine.axis,horiz=axis.horiz,options=plotLine.options,optionsLabel=options.label,label=plotLine.label,width=options.width,to=options.to,from=options.from,isBand=defined(from)&&defined(to),value=options.value,dashStyle=options.dashStyle,svgElem=plotLine.svgElem,path=[],addEvent,eventType,color=options.color,zIndex=pick(options.zIndex,0),events=options.events,attribs={},renderer=axis.chart.renderer,log2lin=axis.log2lin;if(axis.isLog){from=log2lin(from);to=log2lin(to);value=log2lin(value);}
if(width){path=axis.getPlotLinePath(value,width);attribs={stroke:color,'stroke-width':width};if(dashStyle){attribs.dashstyle=dashStyle;}}else if(isBand){path=axis.getPlotBandPath(from,to,options);if(color){attribs.fill=color;}
if(options.borderWidth){attribs.stroke=options.borderColor;attribs['stroke-width']=options.borderWidth;}}else{return;}
attribs.zIndex=zIndex;if(svgElem){if(path){svgElem.show();svgElem.animate({d:path});}else{svgElem.hide();if(label){plotLine.label=label=label.destroy();}}}else if(path&&path.length){plotLine.svgElem=svgElem=renderer.path(path).attr(attribs).add();if(events){addEvent=function(eventType){svgElem.on(eventType,function(e){events[eventType].apply(plotLine,[e]);});};for(eventType in events){addEvent(eventType);}}}
if(optionsLabel&&defined(optionsLabel.text)&&path&&path.length&&axis.width>0&&axis.height>0&&!path.flat){optionsLabel=merge({align:horiz&&isBand&&'center',x:horiz?!isBand&&4:10,verticalAlign:!horiz&&isBand&&'middle',y:horiz?isBand?16:10:isBand?6:-4,rotation:horiz&&!isBand&&90},optionsLabel);this.renderLabel(optionsLabel,path,isBand,zIndex);}else if(label){label.hide();}
return plotLine;},renderLabel:function(optionsLabel,path,isBand,zIndex){var plotLine=this,label=plotLine.label,renderer=plotLine.axis.chart.renderer,attribs,xs,ys,x,y;if(!label){attribs={align:optionsLabel.textAlign||optionsLabel.align,rotation:optionsLabel.rotation};attribs.zIndex=zIndex;plotLine.label=label=renderer.text(optionsLabel.text,0,0,optionsLabel.useHTML).attr(attribs).css(optionsLabel.style).add();}
xs=[path[1],path[4],(isBand?path[6]:path[1])];ys=[path[2],path[5],(isBand?path[7]:path[2])];x=arrayMin(xs);y=arrayMin(ys);label.align(optionsLabel,false,{x:x,y:y,width:arrayMax(xs)-x,height:arrayMax(ys)-y});label.show();},destroy:function(){erase(this.axis.plotLinesAndBands,this);delete this.axis;destroyObjectProperties(this);}};AxisPlotLineOrBandExtension={getPlotBandPath:function(from,to){var toPath=this.getPlotLinePath(to,null,null,true),path=this.getPlotLinePath(from,null,null,true);if(path&&toPath){path.flat=path.toString()===toPath.toString();path.push(toPath[4],toPath[5],toPath[1],toPath[2]);}else{path=null;}
return path;},addPlotBand:function(options){return this.addPlotBandOrLine(options,'plotBands');},addPlotLine:function(options){return this.addPlotBandOrLine(options,'plotLines');},addPlotBandOrLine:function(options,coll){var obj=new Highcharts.PlotLineOrBand(this,options).render(),userOptions=this.userOptions;if(obj){if(coll){userOptions[coll]=userOptions[coll]||[];userOptions[coll].push(options);}
this.plotLinesAndBands.push(obj);}
return obj;},removePlotBandOrLine:function(id){var plotLinesAndBands=this.plotLinesAndBands,options=this.options,userOptions=this.userOptions,i=plotLinesAndBands.length;while(i--){if(plotLinesAndBands[i].id===id){plotLinesAndBands[i].destroy();}}
each([options.plotLines||[],userOptions.plotLines||[],options.plotBands||[],userOptions.plotBands||[]],function(arr){i=arr.length;while(i--){if(arr[i].id===id){erase(arr,arr[i]);}}});}};var Axis=Highcharts.Axis=function(){this.init.apply(this,arguments);};Axis.prototype={defaultOptions:{dateTimeLabelFormats:{millisecond:'%H:%M:%S.%L',second:'%H:%M:%S',minute:'%H:%M',hour:'%H:%M',day:'%e. %b',week:'%e. %b',month:'%b \'%y',year:'%Y'},endOnTick:false,gridLineColor:'#D8D8D8',labels:{enabled:true,style:{color:'#606060',cursor:'default',fontSize:'11px'},x:0},lineColor:'#C0D0E0',lineWidth:1,minPadding:0.01,maxPadding:0.01,minorGridLineColor:'#E0E0E0',minorGridLineWidth:1,minorTickColor:'#A0A0A0',minorTickLength:2,minorTickPosition:'outside',startOfWeek:1,startOnTick:false,tickColor:'#C0D0E0',tickLength:10,tickmarkPlacement:'between',tickPixelInterval:100,tickPosition:'outside',title:{align:'middle',style:{color:'#707070'}},type:'linear'},defaultYAxisOptions:{endOnTick:true,gridLineWidth:1,tickPixelInterval:72,showLastLabel:true,labels:{x:-8},lineWidth:0,maxPadding:0.05,minPadding:0.05,startOnTick:true,title:{rotation:270,text:'Values'},stackLabels:{enabled:false,formatter:function(){return Highcharts.numberFormat(this.total,-1);},style:merge(defaultPlotOptions.line.dataLabels.style,{color:'#000000'})}},defaultLeftAxisOptions:{labels:{x:-15},title:{rotation:270}},defaultRightAxisOptions:{labels:{x:15},title:{rotation:90}},defaultBottomAxisOptions:{labels:{autoRotation:[-45],x:0},title:{rotation:0}},defaultTopAxisOptions:{labels:{autoRotation:[-45],x:0},title:{rotation:0}},init:function(chart,userOptions){var isXAxis=userOptions.isX,axis=this;axis.chart=chart;axis.horiz=chart.inverted?!isXAxis:isXAxis;axis.isXAxis=isXAxis;axis.coll=isXAxis?'xAxis':'yAxis';axis.opposite=userOptions.opposite;axis.side=userOptions.side||(axis.horiz?(axis.opposite?0:2):(axis.opposite?1:3));axis.setOptions(userOptions);var options=this.options,type=options.type,isDatetimeAxis=type==='datetime';axis.labelFormatter=options.labels.formatter||axis.defaultLabelFormatter;axis.userOptions=userOptions;axis.minPixelPadding=0;axis.reversed=options.reversed;axis.visible=options.visible!==false;axis.zoomEnabled=options.zoomEnabled!==false;axis.categories=options.categories||type==='category';axis.names=axis.names||[];axis.isLog=type==='logarithmic';axis.isDatetimeAxis=isDatetimeAxis;axis.isLinked=defined(options.linkedTo);axis.ticks={};axis.labelEdge=[];axis.minorTicks={};axis.plotLinesAndBands=[];axis.alternateBands={};axis.len=0;axis.minRange=axis.userMinRange=options.minRange||options.maxZoom;axis.range=options.range;axis.offset=options.offset||0;axis.stacks={};axis.oldStacks={};axis.stacksTouched=0;axis.max=null;axis.min=null;axis.crosshair=pick(options.crosshair,splat(chart.options.tooltip.crosshairs)[isXAxis?0:1],false);var eventType,events=axis.options.events;if(inArray(axis,chart.axes)===-1){if(isXAxis&&!this.isColorAxis){chart.axes.splice(chart.xAxis.length,0,axis);}else{chart.axes.push(axis);}
chart[axis.coll].push(axis);}
axis.series=axis.series||[];if(chart.inverted&&isXAxis&&axis.reversed===UNDEFINED){axis.reversed=true;}
axis.removePlotBand=axis.removePlotBandOrLine;axis.removePlotLine=axis.removePlotBandOrLine;for(eventType in events){addEvent(axis,eventType,events[eventType]);}
if(axis.isLog){axis.val2lin=axis.log2lin;axis.lin2val=axis.lin2log;}},setOptions:function(userOptions){this.options=merge(this.defaultOptions,this.isXAxis?{}:this.defaultYAxisOptions,[this.defaultTopAxisOptions,this.defaultRightAxisOptions,this.defaultBottomAxisOptions,this.defaultLeftAxisOptions][this.side],merge(defaultOptions[this.coll],userOptions));},defaultLabelFormatter:function(){var axis=this.axis,value=this.value,categories=axis.categories,dateTimeLabelFormat=this.dateTimeLabelFormat,numericSymbols=defaultOptions.lang.numericSymbols,i=numericSymbols&&numericSymbols.length,multi,ret,formatOption=axis.options.labels.format,numericSymbolDetector=axis.isLog?value:axis.tickInterval;if(formatOption){ret=format(formatOption,this);}else if(categories){ret=value;}else if(dateTimeLabelFormat){ret=dateFormat(dateTimeLabelFormat,value);}else if(i&&numericSymbolDetector>=1000){while(i--&&ret===UNDEFINED){multi=Math.pow(1000,i+1);if(numericSymbolDetector>=multi&&(value*10)%multi===0&&numericSymbols[i]!==null){ret=Highcharts.numberFormat(value/multi,-1)+numericSymbols[i];}}}
if(ret===UNDEFINED){if(mathAbs(value)>=10000){ret=Highcharts.numberFormat(value,-1);}else{ret=Highcharts.numberFormat(value,-1,UNDEFINED,'');}}
return ret;},getSeriesExtremes:function(){var axis=this,chart=axis.chart;axis.hasVisibleSeries=false;axis.dataMin=axis.dataMax=axis.threshold=null;axis.softThreshold=!axis.isXAxis;if(axis.buildStacks){axis.buildStacks();}
each(axis.series,function(series){if(series.visible||!chart.options.chart.ignoreHiddenSeries){var seriesOptions=series.options,xData,threshold=seriesOptions.threshold,seriesDataMin,seriesDataMax;axis.hasVisibleSeries=true;if(axis.isLog&&threshold<=0){threshold=null;}
if(axis.isXAxis){xData=series.xData;if(xData.length){axis.dataMin=mathMin(pick(axis.dataMin,xData[0]),arrayMin(xData));axis.dataMax=mathMax(pick(axis.dataMax,xData[0]),arrayMax(xData));}}else{series.getExtremes();seriesDataMax=series.dataMax;seriesDataMin=series.dataMin;if(defined(seriesDataMin)&&defined(seriesDataMax)){axis.dataMin=mathMin(pick(axis.dataMin,seriesDataMin),seriesDataMin);axis.dataMax=mathMax(pick(axis.dataMax,seriesDataMax),seriesDataMax);}
if(defined(threshold)){axis.threshold=threshold;}
if(!seriesOptions.softThreshold||axis.isLog){axis.softThreshold=false;}}}});},translate:function(val,backwards,cvsCoord,old,handleLog,pointPlacement){var axis=this.linkedParent||this,sign=1,cvsOffset=0,localA=old?axis.oldTransA:axis.transA,localMin=old?axis.oldMin:axis.min,returnValue,minPixelPadding=axis.minPixelPadding,doPostTranslate=(axis.isOrdinal||axis.isBroken||(axis.isLog&&handleLog))&&axis.lin2val;if(!localA){localA=axis.transA;}
if(cvsCoord){sign*=-1;cvsOffset=axis.len;}
if(axis.reversed){sign*=-1;cvsOffset-=sign*(axis.sector||axis.len);}
if(backwards){val=val*sign+cvsOffset;val-=minPixelPadding;returnValue=val/localA+localMin;if(doPostTranslate){returnValue=axis.lin2val(returnValue);}}else{if(doPostTranslate){val=axis.val2lin(val);}
if(pointPlacement==='between'){pointPlacement=0.5;}
returnValue=sign*(val-localMin)*localA+cvsOffset+(sign*minPixelPadding)+
(isNumber(pointPlacement)?localA*pointPlacement*axis.pointRange:0);}
return returnValue;},toPixels:function(value,paneCoordinates){return this.translate(value,false,!this.horiz,null,true)+(paneCoordinates?0:this.pos);},toValue:function(pixel,paneCoordinates){return this.translate(pixel-(paneCoordinates?0:this.pos),true,!this.horiz,null,true);},getPlotLinePath:function(value,lineWidth,old,force,translatedValue){var axis=this,chart=axis.chart,axisLeft=axis.left,axisTop=axis.top,x1,y1,x2,y2,cHeight=(old&&chart.oldChartHeight)||chart.chartHeight,cWidth=(old&&chart.oldChartWidth)||chart.chartWidth,skip,transB=axis.transB,between=function(x,a,b){if(x<a||x>b){if(force){x=mathMin(mathMax(a,x),b);}else{skip=true;}}
return x;};translatedValue=pick(translatedValue,axis.translate(value,null,null,old));x1=x2=mathRound(translatedValue+transB);y1=y2=mathRound(cHeight-translatedValue-transB);if(isNaN(translatedValue)){skip=true;}else if(axis.horiz){y1=axisTop;y2=cHeight-axis.bottom;x1=x2=between(x1,axisLeft,axisLeft+axis.width);}else{x1=axisLeft;x2=cWidth-axis.right;y1=y2=between(y1,axisTop,axisTop+axis.height);}
return skip&&!force?null:chart.renderer.crispLine([M,x1,y1,L,x2,y2],lineWidth||1);},getLinearTickPositions:function(tickInterval,min,max){var pos,lastPos,roundedMin=correctFloat(mathFloor(min/tickInterval)*tickInterval),roundedMax=correctFloat(mathCeil(max/tickInterval)*tickInterval),tickPositions=[];if(min===max&&isNumber(min)){return[min];}
pos=roundedMin;while(pos<=roundedMax){tickPositions.push(pos);pos=correctFloat(pos+tickInterval);if(pos===lastPos){break;}
lastPos=pos;}
return tickPositions;},getMinorTickPositions:function(){var axis=this,options=axis.options,tickPositions=axis.tickPositions,minorTickInterval=axis.minorTickInterval,minorTickPositions=[],pos,i,pointRangePadding=axis.pointRangePadding||0,min=axis.min-pointRangePadding,max=axis.max+pointRangePadding,range=max-min,len;if(range&&range/minorTickInterval<axis.len/3){if(axis.isLog){len=tickPositions.length;for(i=1;i<len;i++){minorTickPositions=minorTickPositions.concat(axis.getLogTickPositions(minorTickInterval,tickPositions[i-1],tickPositions[i],true));}}else if(axis.isDatetimeAxis&&options.minorTickInterval==='auto'){minorTickPositions=minorTickPositions.concat(axis.getTimeTicks(axis.normalizeTimeTickInterval(minorTickInterval),min,max,options.startOfWeek));}else{for(pos=min+(tickPositions[0]-min)%minorTickInterval;pos<=max;pos+=minorTickInterval){minorTickPositions.push(pos);}}}
if(minorTickPositions.length!==0){axis.trimTicks(minorTickPositions,options.startOnTick,options.endOnTick);}
return minorTickPositions;},adjustForMinRange:function(){var axis=this,options=axis.options,min=axis.min,max=axis.max,zoomOffset,spaceAvailable=axis.dataMax-axis.dataMin>=axis.minRange,closestDataRange,i,distance,xData,loopLength,minArgs,maxArgs,minRange;if(axis.isXAxis&&axis.minRange===UNDEFINED&&!axis.isLog){if(defined(options.min)||defined(options.max)){axis.minRange=null;}else{each(axis.series,function(series){xData=series.xData;loopLength=series.xIncrement?1:xData.length-1;for(i=loopLength;i>0;i--){distance=xData[i]-xData[i-1];if(closestDataRange===UNDEFINED||distance<closestDataRange){closestDataRange=distance;}}});axis.minRange=mathMin(closestDataRange*5,axis.dataMax-axis.dataMin);}}
if(max-min<axis.minRange){minRange=axis.minRange;zoomOffset=(minRange-max+min)/2;minArgs=[min-zoomOffset,pick(options.min,min-zoomOffset)];if(spaceAvailable){minArgs[2]=axis.dataMin;}
min=arrayMax(minArgs);maxArgs=[min+minRange,pick(options.max,min+minRange)];if(spaceAvailable){maxArgs[2]=axis.dataMax;}
max=arrayMin(maxArgs);if(max-min<minRange){minArgs[0]=max-minRange;minArgs[1]=pick(options.min,max-minRange);min=arrayMax(minArgs);}}
axis.min=min;axis.max=max;},getClosest:function(){var ret;each(this.series,function(series){var seriesClosest=series.closestPointRange;if(!series.noSharedTooltip&&defined(seriesClosest)){ret=defined(ret)?mathMin(ret,seriesClosest):seriesClosest;}});return ret;},setAxisTranslation:function(saveOld){var axis=this,range=axis.max-axis.min,pointRange=axis.axisPointRange||0,closestPointRange,minPointOffset=0,pointRangePadding=0,linkedParent=axis.linkedParent,ordinalCorrection,hasCategories=!!axis.categories,transA=axis.transA,isXAxis=axis.isXAxis;if(isXAxis||hasCategories||pointRange){if(linkedParent){minPointOffset=linkedParent.minPointOffset;pointRangePadding=linkedParent.pointRangePadding;}else{closestPointRange=axis.getClosest();each(axis.series,function(series){var seriesPointRange=hasCategories?1:(isXAxis?pick(series.options.pointRange,closestPointRange,0):(axis.axisPointRange||0)),pointPlacement=series.options.pointPlacement;pointRange=mathMax(pointRange,seriesPointRange);if(!axis.single){minPointOffset=mathMax(minPointOffset,isString(pointPlacement)?0:seriesPointRange/2);pointRangePadding=mathMax(pointRangePadding,pointPlacement==='on'?0:seriesPointRange);}});}
ordinalCorrection=axis.ordinalSlope&&closestPointRange?axis.ordinalSlope/closestPointRange:1;axis.minPointOffset=minPointOffset=minPointOffset*ordinalCorrection;axis.pointRangePadding=pointRangePadding=pointRangePadding*ordinalCorrection;axis.pointRange=mathMin(pointRange,range);if(isXAxis){axis.closestPointRange=closestPointRange;}}
if(saveOld){axis.oldTransA=transA;}
axis.translationSlope=axis.transA=transA=axis.len/((range+pointRangePadding)||1);axis.transB=axis.horiz?axis.left:axis.bottom;axis.minPixelPadding=transA*minPointOffset;},minFromRange:function(){return this.max-this.range;},setTickInterval:function(secondPass){var axis=this,chart=axis.chart,options=axis.options,isLog=axis.isLog,log2lin=axis.log2lin,isDatetimeAxis=axis.isDatetimeAxis,isXAxis=axis.isXAxis,isLinked=axis.isLinked,maxPadding=options.maxPadding,minPadding=options.minPadding,length,linkedParentExtremes,tickIntervalOption=options.tickInterval,minTickInterval,tickPixelIntervalOption=options.tickPixelInterval,categories=axis.categories,threshold=axis.threshold,softThreshold=axis.softThreshold,thresholdMin,thresholdMax,hardMin,hardMax;if(!isDatetimeAxis&&!categories&&!isLinked){this.getTickAmount();}
hardMin=pick(axis.userMin,options.min);hardMax=pick(axis.userMax,options.max);if(isLinked){axis.linkedParent=chart[axis.coll][options.linkedTo];linkedParentExtremes=axis.linkedParent.getExtremes();axis.min=pick(linkedParentExtremes.min,linkedParentExtremes.dataMin);axis.max=pick(linkedParentExtremes.max,linkedParentExtremes.dataMax);if(options.type!==axis.linkedParent.options.type){error(11,1);}}else{if(!softThreshold&&defined(threshold)){if(axis.dataMin>=threshold){thresholdMin=threshold;minPadding=0;}else if(axis.dataMax<=threshold){thresholdMax=threshold;maxPadding=0;}}
axis.min=pick(hardMin,thresholdMin,axis.dataMin);axis.max=pick(hardMax,thresholdMax,axis.dataMax);}
if(isLog){if(!secondPass&&mathMin(axis.min,pick(axis.dataMin,axis.min))<=0){error(10,1);}
axis.min=correctFloat(log2lin(axis.min),15);axis.max=correctFloat(log2lin(axis.max),15);}
if(axis.range&&defined(axis.max)){axis.userMin=axis.min=hardMin=mathMax(axis.min,axis.minFromRange());axis.userMax=hardMax=axis.max;axis.range=null;}
if(axis.beforePadding){axis.beforePadding();}
axis.adjustForMinRange();if(!categories&&!axis.axisPointRange&&!axis.usePercentage&&!isLinked&&defined(axis.min)&&defined(axis.max)){length=axis.max-axis.min;if(length){if(!defined(hardMin)&&minPadding){axis.min-=length*minPadding;}
if(!defined(hardMax)&&maxPadding){axis.max+=length*maxPadding;}}}
if(isNumber(options.floor)){axis.min=mathMax(axis.min,options.floor);}
if(isNumber(options.ceiling)){axis.max=mathMin(axis.max,options.ceiling);}
if(softThreshold&&defined(axis.dataMin)){threshold=threshold||0;if(!defined(hardMin)&&axis.min<threshold&&axis.dataMin>=threshold){axis.min=threshold;}else if(!defined(hardMax)&&axis.max>threshold&&axis.dataMax<=threshold){axis.max=threshold;}}
if(axis.min===axis.max||axis.min===undefined||axis.max===undefined){axis.tickInterval=1;}else if(isLinked&&!tickIntervalOption&&tickPixelIntervalOption===axis.linkedParent.options.tickPixelInterval){axis.tickInterval=tickIntervalOption=axis.linkedParent.tickInterval;}else{axis.tickInterval=pick(tickIntervalOption,this.tickAmount?((axis.max-axis.min)/mathMax(this.tickAmount-1,1)):undefined,categories?1:(axis.max-axis.min)*tickPixelIntervalOption/mathMax(axis.len,tickPixelIntervalOption));}
if(isXAxis&&!secondPass){each(axis.series,function(series){series.processData(axis.min!==axis.oldMin||axis.max!==axis.oldMax);});}
axis.setAxisTranslation(true);if(axis.beforeSetTickPositions){axis.beforeSetTickPositions();}
if(axis.postProcessTickInterval){axis.tickInterval=axis.postProcessTickInterval(axis.tickInterval);}
if(axis.pointRange&&!tickIntervalOption){axis.tickInterval=mathMax(axis.pointRange,axis.tickInterval);}
minTickInterval=pick(options.minTickInterval,axis.isDatetimeAxis&&axis.closestPointRange);if(!tickIntervalOption&&axis.tickInterval<minTickInterval){axis.tickInterval=minTickInterval;}
if(!isDatetimeAxis&&!isLog&&!tickIntervalOption){axis.tickInterval=normalizeTickInterval(axis.tickInterval,null,getMagnitude(axis.tickInterval),pick(options.allowDecimals,!(axis.tickInterval>0.5&&axis.tickInterval<5&&axis.max>1000&&axis.max<9999)),!!this.tickAmount);}
if(!this.tickAmount&&this.len){axis.tickInterval=axis.unsquish();}
this.setTickPositions();},setTickPositions:function(){var options=this.options,tickPositions,tickPositionsOption=options.tickPositions,tickPositioner=options.tickPositioner,startOnTick=options.startOnTick,endOnTick=options.endOnTick,single;this.tickmarkOffset=(this.categories&&options.tickmarkPlacement==='between'&&this.tickInterval===1)?0.5:0;this.minorTickInterval=options.minorTickInterval==='auto'&&this.tickInterval?this.tickInterval/5:options.minorTickInterval;this.tickPositions=tickPositions=tickPositionsOption&&tickPositionsOption.slice();if(!tickPositions){if(this.isDatetimeAxis){tickPositions=this.getTimeTicks(this.normalizeTimeTickInterval(this.tickInterval,options.units),this.min,this.max,options.startOfWeek,this.ordinalPositions,this.closestPointRange,true);}else if(this.isLog){tickPositions=this.getLogTickPositions(this.tickInterval,this.min,this.max);}else{tickPositions=this.getLinearTickPositions(this.tickInterval,this.min,this.max);}
if(tickPositions.length>this.len){tickPositions=[tickPositions[0],tickPositions.pop()];}
this.tickPositions=tickPositions;if(tickPositioner){tickPositioner=tickPositioner.apply(this,[this.min,this.max]);if(tickPositioner){this.tickPositions=tickPositions=tickPositioner;}}}
if(!this.isLinked){this.trimTicks(tickPositions,startOnTick,endOnTick);if(this.min===this.max&&defined(this.min)&&!this.tickAmount){single=true;this.min-=0.5;this.max+=0.5;}
this.single=single;if(!tickPositionsOption&&!tickPositioner){this.adjustTickAmount();}}},trimTicks:function(tickPositions,startOnTick,endOnTick){var roundedMin=tickPositions[0],roundedMax=tickPositions[tickPositions.length-1],minPointOffset=this.minPointOffset||0;if(startOnTick){this.min=roundedMin;}else{while(this.min-minPointOffset>tickPositions[0]){tickPositions.shift();}}
if(endOnTick){this.max=roundedMax;}else{while(this.max+minPointOffset<tickPositions[tickPositions.length-1]){tickPositions.pop();}}
if(tickPositions.length===0&&defined(roundedMin)){tickPositions.push((roundedMax+roundedMin)/2);}},alignToOthers:function(){var others={},hasOther,options=this.options;if(this.chart.options.chart.alignTicks!==false&&options.alignTicks!==false){each(this.chart[this.coll],function(axis){var otherOptions=axis.options,horiz=axis.horiz,key=[horiz?otherOptions.left:otherOptions.top,otherOptions.width,otherOptions.height,otherOptions.pane].join(',');if(axis.series.length){if(others[key]){hasOther=true;}else{others[key]=1;}}});}
return hasOther;},getTickAmount:function(){var options=this.options,tickAmount=options.tickAmount,tickPixelInterval=options.tickPixelInterval;if(!defined(options.tickInterval)&&this.len<tickPixelInterval&&!this.isRadial&&!this.isLog&&options.startOnTick&&options.endOnTick){tickAmount=2;}
if(!tickAmount&&this.alignToOthers()){tickAmount=mathCeil(this.len/tickPixelInterval)+1;}
if(tickAmount<4){this.finalTickAmt=tickAmount;tickAmount=5;}
this.tickAmount=tickAmount;},adjustTickAmount:function(){var tickInterval=this.tickInterval,tickPositions=this.tickPositions,tickAmount=this.tickAmount,finalTickAmt=this.finalTickAmt,currentTickAmount=tickPositions&&tickPositions.length,i,len;if(currentTickAmount<tickAmount){while(tickPositions.length<tickAmount){tickPositions.push(correctFloat(tickPositions[tickPositions.length-1]+tickInterval));}
this.transA*=(currentTickAmount-1)/(tickAmount-1);this.max=tickPositions[tickPositions.length-1];}else if(currentTickAmount>tickAmount){this.tickInterval*=2;this.setTickPositions();}
if(defined(finalTickAmt)){i=len=tickPositions.length;while(i--){if((finalTickAmt===3&&i%2===1)||(finalTickAmt<=2&&i>0&&i<len-1)){tickPositions.splice(i,1);}}
this.finalTickAmt=UNDEFINED;}},setScale:function(){var axis=this,isDirtyData,isDirtyAxisLength;axis.oldMin=axis.min;axis.oldMax=axis.max;axis.oldAxisLength=axis.len;axis.setAxisSize();isDirtyAxisLength=axis.len!==axis.oldAxisLength;each(axis.series,function(series){if(series.isDirtyData||series.isDirty||series.xAxis.isDirty){isDirtyData=true;}});if(isDirtyAxisLength||isDirtyData||axis.isLinked||axis.forceRedraw||axis.userMin!==axis.oldUserMin||axis.userMax!==axis.oldUserMax||axis.alignToOthers()){if(axis.resetStacks){axis.resetStacks();}
axis.forceRedraw=false;axis.getSeriesExtremes();axis.setTickInterval();axis.oldUserMin=axis.userMin;axis.oldUserMax=axis.userMax;if(!axis.isDirty){axis.isDirty=isDirtyAxisLength||axis.min!==axis.oldMin||axis.max!==axis.oldMax;}}else if(axis.cleanStacks){axis.cleanStacks();}},setExtremes:function(newMin,newMax,redraw,animation,eventArguments){var axis=this,chart=axis.chart;redraw=pick(redraw,true);each(axis.series,function(serie){delete serie.kdTree;});eventArguments=extend(eventArguments,{min:newMin,max:newMax});fireEvent(axis,'setExtremes',eventArguments,function(){axis.userMin=newMin;axis.userMax=newMax;axis.eventArgs=eventArguments;if(redraw){chart.redraw(animation);}});},zoom:function(newMin,newMax){var dataMin=this.dataMin,dataMax=this.dataMax,options=this.options,min=mathMin(dataMin,pick(options.min,dataMin)),max=mathMax(dataMax,pick(options.max,dataMax));if(!this.allowZoomOutside){if(defined(dataMin)&&newMin<=min){newMin=min;}
if(defined(dataMax)&&newMax>=max){newMax=max;}}
this.displayBtn=newMin!==UNDEFINED||newMax!==UNDEFINED;this.setExtremes(newMin,newMax,false,UNDEFINED,{trigger:'zoom'});return true;},setAxisSize:function(){var chart=this.chart,options=this.options,offsetLeft=options.offsetLeft||0,offsetRight=options.offsetRight||0,horiz=this.horiz,width=pick(options.width,chart.plotWidth-offsetLeft+offsetRight),height=pick(options.height,chart.plotHeight),top=pick(options.top,chart.plotTop),left=pick(options.left,chart.plotLeft+offsetLeft),percentRegex=/%$/;if(percentRegex.test(height)){height=Math.round(parseFloat(height)/100*chart.plotHeight);}
if(percentRegex.test(top)){top=Math.round(parseFloat(top)/100*chart.plotHeight+chart.plotTop);}
this.left=left;this.top=top;this.width=width;this.height=height;this.bottom=chart.chartHeight-height-top;this.right=chart.chartWidth-width-left;this.len=mathMax(horiz?width:height,0);this.pos=horiz?left:top;},getExtremes:function(){var axis=this,isLog=axis.isLog,lin2log=axis.lin2log;return{min:isLog?correctFloat(lin2log(axis.min)):axis.min,max:isLog?correctFloat(lin2log(axis.max)):axis.max,dataMin:axis.dataMin,dataMax:axis.dataMax,userMin:axis.userMin,userMax:axis.userMax};},getThreshold:function(threshold){var axis=this,isLog=axis.isLog,lin2log=axis.lin2log,realMin=isLog?lin2log(axis.min):axis.min,realMax=isLog?lin2log(axis.max):axis.max;if(threshold===null){threshold=realMax<0?realMax:realMin;}else if(realMin>threshold){threshold=realMin;}else if(realMax<threshold){threshold=realMax;}
return axis.translate(threshold,0,1,0,1);},autoLabelAlign:function(rotation){var ret,angle=(pick(rotation,0)-(this.side*90)+720)%360;if(angle>15&&angle<165){ret='right';}else if(angle>195&&angle<345){ret='left';}else{ret='center';}
return ret;},tickSize:function(prefix){var options=this.options,tickLength=options[prefix+'Length'],tickWidth=pick(options[prefix+'Width'],prefix==='tick'&&this.isXAxis?1:0);if(tickWidth&&tickLength){if(options[prefix+'Position']==='inside'){tickLength=-tickLength;}
return[tickLength,tickWidth];}},labelMetrics:function(){return this.chart.renderer.fontMetrics(this.options.labels.style.fontSize,this.ticks[0]&&this.ticks[0].label);},unsquish:function(){var labelOptions=this.options.labels,horiz=this.horiz,tickInterval=this.tickInterval,newTickInterval=tickInterval,slotSize=this.len/(((this.categories?1:0)+this.max-this.min)/tickInterval),rotation,rotationOption=labelOptions.rotation,labelMetrics=this.labelMetrics(),step,bestScore=Number.MAX_VALUE,autoRotation,getStep=function(spaceNeeded){var step=spaceNeeded/(slotSize||1);step=step>1?mathCeil(step):1;return step*tickInterval;};if(horiz){autoRotation=!labelOptions.staggerLines&&!labelOptions.step&&(defined(rotationOption)?[rotationOption]:slotSize<pick(labelOptions.autoRotationLimit,80)&&labelOptions.autoRotation);if(autoRotation){each(autoRotation,function(rot){var score;if(rot===rotationOption||(rot&&rot>=-90&&rot<=90)){step=getStep(mathAbs(labelMetrics.h/mathSin(deg2rad*rot)));score=step+mathAbs(rot/360);if(score<bestScore){bestScore=score;rotation=rot;newTickInterval=step;}}});}}else if(!labelOptions.step){newTickInterval=getStep(labelMetrics.h);}
this.autoRotation=autoRotation;this.labelRotation=pick(rotation,rotationOption);return newTickInterval;},getSlotWidth:function(){var chart=this.chart,horiz=this.horiz,labelOptions=this.options.labels,slotCount=Math.max(this.tickPositions.length-(this.categories?0:1),1),marginLeft=chart.margin[3];return(horiz&&(labelOptions.step||0)<2&&!labelOptions.rotation&&((this.staggerLines||1)*chart.plotWidth)/slotCount)||(!horiz&&((marginLeft&&(marginLeft-chart.spacing[3]))||chart.chartWidth*0.33));},renderUnsquish:function(){var chart=this.chart,renderer=chart.renderer,tickPositions=this.tickPositions,ticks=this.ticks,labelOptions=this.options.labels,horiz=this.horiz,slotWidth=this.getSlotWidth(),innerWidth=mathMax(1,mathRound(slotWidth-2*(labelOptions.padding||5))),attr={},labelMetrics=this.labelMetrics(),textOverflowOption=labelOptions.style.textOverflow,css,labelLength=0,label,i,pos;if(!isString(labelOptions.rotation)){attr.rotation=labelOptions.rotation||0;}
if(this.autoRotation){each(tickPositions,function(tick){tick=ticks[tick];if(tick&&tick.labelLength>labelLength){labelLength=tick.labelLength;}});if(labelLength>innerWidth&&labelLength>labelMetrics.h){attr.rotation=this.labelRotation;}else{this.labelRotation=0;}}else if(slotWidth){css={width:innerWidth+PX};if(!textOverflowOption){css.textOverflow='clip';i=tickPositions.length;while(!horiz&&i--){pos=tickPositions[i];label=ticks[pos].label;if(label){if(label.styles.textOverflow==='ellipsis'){label.css({textOverflow:'clip'});}else if(ticks[pos].labelLength>slotWidth){label.css({width:slotWidth+'px'});}
if(label.getBBox().height>this.len/tickPositions.length-(labelMetrics.h-labelMetrics.f)){label.specCss={textOverflow:'ellipsis'};}}}}}
if(attr.rotation){css={width:(labelLength>chart.chartHeight*0.5?chart.chartHeight*0.33:chart.chartHeight)+PX};if(!textOverflowOption){css.textOverflow='ellipsis';}}
this.labelAlign=labelOptions.align||this.autoLabelAlign(this.labelRotation);if(this.labelAlign){attr.align=this.labelAlign;}
each(tickPositions,function(pos){var tick=ticks[pos],label=tick&&tick.label;if(label){label.attr(attr);if(css){label.css(merge(css,label.specCss));}
delete label.specCss;tick.rotation=attr.rotation;}});this.tickRotCorr=renderer.rotCorr(labelMetrics.b,this.labelRotation||0,this.side!==0);},hasData:function(){return this.hasVisibleSeries||(defined(this.min)&&defined(this.max)&&!!this.tickPositions);},getOffset:function(){var axis=this,chart=axis.chart,renderer=chart.renderer,options=axis.options,tickPositions=axis.tickPositions,ticks=axis.ticks,horiz=axis.horiz,side=axis.side,invertedSide=chart.inverted?[1,0,3,2][side]:side,hasData,showAxis,titleOffset=0,titleOffsetOption,titleMargin=0,axisTitleOptions=options.title,labelOptions=options.labels,labelOffset=0,labelOffsetPadded,opposite=axis.opposite,axisOffset=chart.axisOffset,clipOffset=chart.clipOffset,clip,directionFactor=[-1,1,1,-1][side],n,axisParent=axis.axisParent,lineHeightCorrection,tickSize=this.tickSize('tick');hasData=axis.hasData();axis.showAxis=showAxis=hasData||pick(options.showEmpty,true);axis.staggerLines=axis.horiz&&labelOptions.staggerLines;if(!axis.axisGroup){axis.gridGroup=renderer.g('grid').attr({zIndex:options.gridZIndex||1}).add(axisParent);axis.axisGroup=renderer.g('axis').attr({zIndex:options.zIndex||2}).add(axisParent);axis.labelGroup=renderer.g('axis-labels').attr({zIndex:labelOptions.zIndex||7}).addClass(PREFIX+axis.coll.toLowerCase()+'-labels').add(axisParent);}
if(hasData||axis.isLinked){each(tickPositions,function(pos){if(!ticks[pos]){ticks[pos]=new Tick(axis,pos);}else{ticks[pos].addLabel();}});axis.renderUnsquish();if(labelOptions.reserveSpace!==false&&(side===0||side===2||{1:'left',3:'right'}[side]===axis.labelAlign||axis.labelAlign==='center')){each(tickPositions,function(pos){labelOffset=mathMax(ticks[pos].getLabelSize(),labelOffset);});}
if(axis.staggerLines){labelOffset*=axis.staggerLines;axis.labelOffset=labelOffset*(axis.opposite?-1:1);}}else{for(n in ticks){ticks[n].destroy();delete ticks[n];}}
if(axisTitleOptions&&axisTitleOptions.text&&axisTitleOptions.enabled!==false){if(!axis.axisTitle){axis.axisTitle=renderer.text(axisTitleOptions.text,0,0,axisTitleOptions.useHTML).attr({zIndex:7,rotation:axisTitleOptions.rotation||0,align:axisTitleOptions.textAlign||{low:opposite?'right':'left',middle:'center',high:opposite?'left':'right'}[axisTitleOptions.align]}).addClass(PREFIX+this.coll.toLowerCase()+'-title').css(axisTitleOptions.style).add(axis.axisGroup);axis.axisTitle.isNew=true;}
if(showAxis){titleOffset=axis.axisTitle.getBBox()[horiz?'height':'width'];titleOffsetOption=axisTitleOptions.offset;titleMargin=defined(titleOffsetOption)?0:pick(axisTitleOptions.margin,horiz?5:10);}
axis.axisTitle[showAxis?'show':'hide'](true);}
axis.offset=directionFactor*pick(options.offset,axisOffset[side]);axis.tickRotCorr=axis.tickRotCorr||{x:0,y:0};if(side===0){lineHeightCorrection=-axis.labelMetrics().h;}else if(side===2){lineHeightCorrection=axis.tickRotCorr.y;}else{lineHeightCorrection=0;}
labelOffsetPadded=Math.abs(labelOffset)+titleMargin;if(labelOffset){labelOffsetPadded-=lineHeightCorrection;labelOffsetPadded+=directionFactor*(horiz?pick(labelOptions.y,axis.tickRotCorr.y+directionFactor*8):labelOptions.x);}
axis.axisTitleMargin=pick(titleOffsetOption,labelOffsetPadded);axisOffset[side]=mathMax(axisOffset[side],axis.axisTitleMargin+titleOffset+directionFactor*axis.offset,labelOffsetPadded,hasData&&tickPositions.length&&tickSize?tickSize[0]:0);clip=options.offset?0:mathFloor(options.lineWidth/2)*2;clipOffset[invertedSide]=mathMax(clipOffset[invertedSide],clip);},getLinePath:function(lineWidth){var chart=this.chart,opposite=this.opposite,offset=this.offset,horiz=this.horiz,lineLeft=this.left+(opposite?this.width:0)+offset,lineTop=chart.chartHeight-this.bottom-(opposite?this.height:0)+offset;if(opposite){lineWidth*=-1;}
return chart.renderer.crispLine([M,horiz?this.left:lineLeft,horiz?lineTop:this.top,L,horiz?chart.chartWidth-this.right:lineLeft,horiz?lineTop:chart.chartHeight-this.bottom],lineWidth);},getTitlePosition:function(){var horiz=this.horiz,axisLeft=this.left,axisTop=this.top,axisLength=this.len,axisTitleOptions=this.options.title,margin=horiz?axisLeft:axisTop,opposite=this.opposite,offset=this.offset,xOption=axisTitleOptions.x||0,yOption=axisTitleOptions.y||0,fontSize=pInt(axisTitleOptions.style.fontSize||12),alongAxis={low:margin+(horiz?0:axisLength),middle:margin+axisLength/2,high:margin+(horiz?axisLength:0)}[axisTitleOptions.align],offAxis=(horiz?axisTop+this.height:axisLeft)+
(horiz?1:-1)*(opposite?-1:1)*this.axisTitleMargin+
(this.side===2?fontSize:0);return{x:horiz?alongAxis+xOption:offAxis+(opposite?this.width:0)+offset+xOption,y:horiz?offAxis+yOption-(opposite?this.height:0)+offset:alongAxis+yOption};},render:function(){var axis=this,chart=axis.chart,renderer=chart.renderer,options=axis.options,isLog=axis.isLog,lin2log=axis.lin2log,isLinked=axis.isLinked,tickPositions=axis.tickPositions,axisTitle=axis.axisTitle,ticks=axis.ticks,minorTicks=axis.minorTicks,alternateBands=axis.alternateBands,stackLabelOptions=options.stackLabels,alternateGridColor=options.alternateGridColor,tickmarkOffset=axis.tickmarkOffset,lineWidth=options.lineWidth,linePath,hasRendered=chart.hasRendered,slideInTicks=hasRendered&&defined(axis.oldMin)&&!isNaN(axis.oldMin),showAxis=axis.showAxis,animation=animObject(renderer.globalAnimation),from,to;axis.labelEdge.length=0;axis.overlap=false;each([ticks,minorTicks,alternateBands],function(coll){var pos;for(pos in coll){coll[pos].isActive=false;}});if(axis.hasData()||isLinked){if(axis.minorTickInterval&&!axis.categories){each(axis.getMinorTickPositions(),function(pos){if(!minorTicks[pos]){minorTicks[pos]=new Tick(axis,pos,'minor');}
if(slideInTicks&&minorTicks[pos].isNew){minorTicks[pos].render(null,true);}
minorTicks[pos].render(null,false,1);});}
if(tickPositions.length){each(tickPositions,function(pos,i){if(!isLinked||(pos>=axis.min&&pos<=axis.max)){if(!ticks[pos]){ticks[pos]=new Tick(axis,pos);}
if(slideInTicks&&ticks[pos].isNew){ticks[pos].render(i,true,0.1);}
ticks[pos].render(i);}});if(tickmarkOffset&&(axis.min===0||axis.single)){if(!ticks[-1]){ticks[-1]=new Tick(axis,-1,null,true);}
ticks[-1].render(-1);}}
if(alternateGridColor){each(tickPositions,function(pos,i){to=tickPositions[i+1]!==UNDEFINED?tickPositions[i+1]+tickmarkOffset:axis.max-tickmarkOffset;if(i%2===0&&pos<axis.max&&to<=axis.max+(chart.polar?-tickmarkOffset:tickmarkOffset)){if(!alternateBands[pos]){alternateBands[pos]=new Highcharts.PlotLineOrBand(axis);}
from=pos+tickmarkOffset;alternateBands[pos].options={from:isLog?lin2log(from):from,to:isLog?lin2log(to):to,color:alternateGridColor};alternateBands[pos].render();alternateBands[pos].isActive=true;}});}
if(!axis._addedPlotLB){each((options.plotLines||[]).concat(options.plotBands||[]),function(plotLineOptions){axis.addPlotBandOrLine(plotLineOptions);});axis._addedPlotLB=true;}}
each([ticks,minorTicks,alternateBands],function(coll){var pos,i,forDestruction=[],delay=animation.duration,destroyInactiveItems=function(){i=forDestruction.length;while(i--){if(coll[forDestruction[i]]&&!coll[forDestruction[i]].isActive){coll[forDestruction[i]].destroy();delete coll[forDestruction[i]];}}};for(pos in coll){if(!coll[pos].isActive){coll[pos].render(pos,false,0);coll[pos].isActive=false;forDestruction.push(pos);}}
syncTimeout(destroyInactiveItems,coll===alternateBands||!chart.hasRendered||!delay?0:delay);});if(lineWidth){linePath=axis.getLinePath(lineWidth);if(!axis.axisLine){axis.axisLine=renderer.path(linePath).attr({stroke:options.lineColor,'stroke-width':lineWidth,zIndex:7}).add(axis.axisGroup);}else{axis.axisLine.animate({d:linePath});}
axis.axisLine[showAxis?'show':'hide'](true);}
if(axisTitle&&showAxis){axisTitle[axisTitle.isNew?'attr':'animate'](axis.getTitlePosition());axisTitle.isNew=false;}
if(stackLabelOptions&&stackLabelOptions.enabled){axis.renderStackTotals();}
axis.isDirty=false;},redraw:function(){if(this.visible){this.render();each(this.plotLinesAndBands,function(plotLine){plotLine.render();});}
each(this.series,function(series){series.isDirty=true;});},destroy:function(keepEvents){var axis=this,stacks=axis.stacks,stackKey,plotLinesAndBands=axis.plotLinesAndBands,i;if(!keepEvents){removeEvent(axis);}
for(stackKey in stacks){destroyObjectProperties(stacks[stackKey]);stacks[stackKey]=null;}
each([axis.ticks,axis.minorTicks,axis.alternateBands],function(coll){destroyObjectProperties(coll);});i=plotLinesAndBands.length;while(i--){plotLinesAndBands[i].destroy();}
each(['stackTotalGroup','axisLine','axisTitle','axisGroup','cross','gridGroup','labelGroup'],function(prop){if(axis[prop]){axis[prop]=axis[prop].destroy();}});if(this.cross){this.cross.destroy();}},drawCrosshair:function(e,point){var path,options=this.crosshair,pos,attribs,categorized,strokeWidth;if(!this.crosshair||((defined(point)||!pick(options.snap,true))===false)){this.hideCrosshair();}else{if(!pick(options.snap,true)){pos=(this.horiz?e.chartX-this.pos:this.len-e.chartY+this.pos);}else if(defined(point)){pos=this.isXAxis?point.plotX:this.len-point.plotY;}
if(this.isRadial){path=this.getPlotLinePath(this.isXAxis?point.x:pick(point.stackY,point.y))||null;}else{path=this.getPlotLinePath(null,null,null,null,pos)||null;}
if(path===null){this.hideCrosshair();return;}
categorized=this.categories&&!this.isRadial;strokeWidth=pick(options.width,(categorized?this.transA:1));if(this.cross){this.cross.attr({d:path,visibility:'visible','stroke-width':strokeWidth});}else{attribs={'stroke-width':strokeWidth,stroke:options.color||(categorized?'rgba(155,200,255,0.2)':'#C0C0C0'),zIndex:pick(options.zIndex,2)};if(options.dashStyle){attribs.dashstyle=options.dashStyle;}
this.cross=this.chart.renderer.path(path).attr(attribs).add();}}},hideCrosshair:function(){if(this.cross){this.cross.hide();}}};extend(Axis.prototype,AxisPlotLineOrBandExtension);Axis.prototype.getTimeTicks=function(normalizedInterval,min,max,startOfWeek){var tickPositions=[],i,higherRanks={},useUTC=defaultOptions.global.useUTC,minYear,minDate=new Date(min-getTZOffset(min)),interval=normalizedInterval.unitRange,count=normalizedInterval.count;if(defined(min)){minDate[setMilliseconds](interval>=timeUnits.second?0:count*mathFloor(minDate.getMilliseconds()/count));if(interval>=timeUnits.second){minDate[setSeconds](interval>=timeUnits.minute?0:count*mathFloor(minDate.getSeconds()/count));}
if(interval>=timeUnits.minute){minDate[setMinutes](interval>=timeUnits.hour?0:count*mathFloor(minDate[getMinutes]()/count));}
if(interval>=timeUnits.hour){minDate[setHours](interval>=timeUnits.day?0:count*mathFloor(minDate[getHours]()/count));}
if(interval>=timeUnits.day){minDate[setDate](interval>=timeUnits.month?1:count*mathFloor(minDate[getDate]()/count));}
if(interval>=timeUnits.month){minDate[setMonth](interval>=timeUnits.year?0:count*mathFloor(minDate[getMonth]()/count));minYear=minDate[getFullYear]();}
if(interval>=timeUnits.year){minYear-=minYear%count;minDate[setFullYear](minYear);}
if(interval===timeUnits.week){minDate[setDate](minDate[getDate]()-minDate[getDay]()+
pick(startOfWeek,1));}
i=1;if(timezoneOffset||getTimezoneOffset){minDate=minDate.getTime();minDate=new Date(minDate+getTZOffset(minDate));}
minYear=minDate[getFullYear]();var time=minDate.getTime(),minMonth=minDate[getMonth](),minDateDate=minDate[getDate](),variableDayLength=!useUTC||!!getTimezoneOffset,localTimezoneOffset=(timeUnits.day+
(useUTC?getTZOffset(minDate):minDate.getTimezoneOffset()*60*1000))%timeUnits.day;while(time<max){tickPositions.push(time);if(interval===timeUnits.year){time=makeTime(minYear+i*count,0);}else if(interval===timeUnits.month){time=makeTime(minYear,minMonth+i*count);}else if(variableDayLength&&(interval===timeUnits.day||interval===timeUnits.week)){time=makeTime(minYear,minMonth,minDateDate+
i*count*(interval===timeUnits.day?1:7));}else{time+=interval*count;}
i++;}
tickPositions.push(time);each(grep(tickPositions,function(time){return interval<=timeUnits.hour&&time%timeUnits.day===localTimezoneOffset;}),function(time){higherRanks[time]='day';});}
tickPositions.info=extend(normalizedInterval,{higherRanks:higherRanks,totalRange:interval*count});return tickPositions;};Axis.prototype.normalizeTimeTickInterval=function(tickInterval,unitsOption){var units=unitsOption||[['millisecond',[1,2,5,10,20,25,50,100,200,500]],['second',[1,2,5,10,15,30]],['minute',[1,2,5,10,15,30]],['hour',[1,2,3,4,6,8,12]],['day',[1,2]],['week',[1,2]],['month',[1,2,3,4,6]],['year',null]],unit=units[units.length-1],interval=timeUnits[unit[0]],multiples=unit[1],count,i;for(i=0;i<units.length;i++){unit=units[i];interval=timeUnits[unit[0]];multiples=unit[1];if(units[i+1]){var lessThan=(interval*multiples[multiples.length-1]+
timeUnits[units[i+1][0]])/2;if(tickInterval<=lessThan){break;}}}
if(interval===timeUnits.year&&tickInterval<5*interval){multiples=[1,2,5];}
count=normalizeTickInterval(tickInterval/interval,multiples,unit[0]==='year'?mathMax(getMagnitude(tickInterval/interval),1):1);return{unitRange:interval,count:count,unitName:unit[0]};};Axis.prototype.getLogTickPositions=function(interval,min,max,minor){var axis=this,options=axis.options,axisLength=axis.len,lin2log=axis.lin2log,log2lin=axis.log2lin,positions=[];if(!minor){axis._minorAutoInterval=null;}
if(interval>=0.5){interval=mathRound(interval);positions=axis.getLinearTickPositions(interval,min,max);}else if(interval>=0.08){var roundedMin=mathFloor(min),intermediate,i,j,len,pos,lastPos,break2;if(interval>0.3){intermediate=[1,2,4];}else if(interval>0.15){intermediate=[1,2,4,6,8];}else{intermediate=[1,2,3,4,5,6,7,8,9];}
for(i=roundedMin;i<max+1&&!break2;i++){len=intermediate.length;for(j=0;j<len&&!break2;j++){pos=log2lin(lin2log(i)*intermediate[j]);if(pos>min&&(!minor||lastPos<=max)&&lastPos!==UNDEFINED){positions.push(lastPos);}
if(lastPos>max){break2=true;}
lastPos=pos;}}}else{var realMin=lin2log(min),realMax=lin2log(max),tickIntervalOption=options[minor?'minorTickInterval':'tickInterval'],filteredTickIntervalOption=tickIntervalOption==='auto'?null:tickIntervalOption,tickPixelIntervalOption=options.tickPixelInterval/(minor?5:1),totalPixelLength=minor?axisLength/axis.tickPositions.length:axisLength;interval=pick(filteredTickIntervalOption,axis._minorAutoInterval,(realMax-realMin)*tickPixelIntervalOption/(totalPixelLength||1));interval=normalizeTickInterval(interval,null,getMagnitude(interval));positions=map(axis.getLinearTickPositions(interval,realMin,realMax),log2lin);if(!minor){axis._minorAutoInterval=interval/5;}}
if(!minor){axis.tickInterval=interval;}
return positions;};Axis.prototype.log2lin=function(num){return math.log(num)/math.LN10;};Axis.prototype.lin2log=function(num){return math.pow(10,num);};var Tooltip=Highcharts.Tooltip=function(){this.init.apply(this,arguments);};Tooltip.prototype={init:function(chart,options){var borderWidth=options.borderWidth,style=options.style,padding=pInt(style.padding);this.chart=chart;this.options=options;this.crosshairs=[];this.now={x:0,y:0};this.isHidden=true;this.label=chart.renderer.label('',0,0,options.shape||'callout',null,null,options.useHTML,null,'tooltip').attr({padding:padding,fill:options.backgroundColor,'stroke-width':borderWidth,r:options.borderRadius,zIndex:8}).css(style).css({padding:0}).add().attr({y:-9999});if(!useCanVG){this.label.shadow(options.shadow);}
this.shared=options.shared;},destroy:function(){if(this.label){this.label=this.label.destroy();}
clearTimeout(this.hideTimer);clearTimeout(this.tooltipTimeout);},move:function(x,y,anchorX,anchorY){var tooltip=this,now=tooltip.now,animate=tooltip.options.animation!==false&&!tooltip.isHidden&&(mathAbs(x-now.x)>1||mathAbs(y-now.y)>1),skipAnchor=tooltip.followPointer||tooltip.len>1;extend(now,{x:animate?(2*now.x+x)/3:x,y:animate?(now.y+y)/2:y,anchorX:skipAnchor?UNDEFINED:animate?(2*now.anchorX+anchorX)/3:anchorX,anchorY:skipAnchor?UNDEFINED:animate?(now.anchorY+anchorY)/2:anchorY});tooltip.label.attr(now);if(animate){clearTimeout(this.tooltipTimeout);this.tooltipTimeout=setTimeout(function(){if(tooltip){tooltip.move(x,y,anchorX,anchorY);}},32);}},hide:function(delay){var tooltip=this;clearTimeout(this.hideTimer);delay=pick(delay,this.options.hideDelay,500);if(!this.isHidden){this.hideTimer=syncTimeout(function(){tooltip.label[delay?'fadeOut':'hide']();tooltip.isHidden=true;},delay);}},getAnchor:function(points,mouseEvent){var ret,chart=this.chart,inverted=chart.inverted,plotTop=chart.plotTop,plotLeft=chart.plotLeft,plotX=0,plotY=0,yAxis,xAxis;points=splat(points);ret=points[0].tooltipPos;if(this.followPointer&&mouseEvent){if(mouseEvent.chartX===UNDEFINED){mouseEvent=chart.pointer.normalize(mouseEvent);}
ret=[mouseEvent.chartX-chart.plotLeft,mouseEvent.chartY-plotTop];}
if(!ret){each(points,function(point){yAxis=point.series.yAxis;xAxis=point.series.xAxis;plotX+=point.plotX+(!inverted&&xAxis?xAxis.left-plotLeft:0);plotY+=(point.plotLow?(point.plotLow+point.plotHigh)/2:point.plotY)+
(!inverted&&yAxis?yAxis.top-plotTop:0);});plotX/=points.length;plotY/=points.length;ret=[inverted?chart.plotWidth-plotY:plotX,this.shared&&!inverted&&points.length>1&&mouseEvent?mouseEvent.chartY-plotTop:inverted?chart.plotHeight-plotX:plotY];}
return map(ret,mathRound);},getPosition:function(boxWidth,boxHeight,point){var chart=this.chart,distance=this.distance,ret={},h=point.h||0,swapped,first=['y',chart.chartHeight,boxHeight,point.plotY+chart.plotTop,chart.plotTop,chart.plotTop+chart.plotHeight],second=['x',chart.chartWidth,boxWidth,point.plotX+chart.plotLeft,chart.plotLeft,chart.plotLeft+chart.plotWidth],preferFarSide=!this.followPointer&&pick(point.ttBelow,!chart.inverted===!!point.negative),firstDimension=function(dim,outerSize,innerSize,point,min,max){var roomLeft=innerSize<point-distance,roomRight=point+distance+innerSize<outerSize,alignedLeft=point-distance-innerSize,alignedRight=point+distance;if(preferFarSide&&roomRight){ret[dim]=alignedRight;}else if(!preferFarSide&&roomLeft){ret[dim]=alignedLeft;}else if(roomLeft){ret[dim]=mathMin(max-innerSize,alignedLeft-h<0?alignedLeft:alignedLeft-h);}else if(roomRight){ret[dim]=mathMax(min,alignedRight+h+innerSize>outerSize?alignedRight:alignedRight+h);}else{return false;}},secondDimension=function(dim,outerSize,innerSize,point){var retVal;if(point<distance||point>outerSize-distance){retVal=false;}else if(point<innerSize/2){ret[dim]=1;}else if(point>outerSize-innerSize/2){ret[dim]=outerSize-innerSize-2;}else{ret[dim]=point-innerSize/2;}
return retVal;},swap=function(count){var temp=first;first=second;second=temp;swapped=count;},run=function(){if(firstDimension.apply(0,first)!==false){if(secondDimension.apply(0,second)===false&&!swapped){swap(true);run();}}else if(!swapped){swap(true);run();}else{ret.x=ret.y=0;}};if(chart.inverted||this.len>1){swap();}
run();return ret;},defaultFormatter:function(tooltip){var items=this.points||splat(this),s;s=[tooltip.tooltipFooterHeaderFormatter(items[0])];s=s.concat(tooltip.bodyFormatter(items));s.push(tooltip.tooltipFooterHeaderFormatter(items[0],true));return s.join('');},refresh:function(point,mouseEvent){var tooltip=this,chart=tooltip.chart,label=tooltip.label,options=tooltip.options,x,y,anchor,textConfig={},text,pointConfig=[],formatter=options.formatter||tooltip.defaultFormatter,hoverPoints=chart.hoverPoints,borderColor,shared=tooltip.shared,currentSeries;clearTimeout(this.hideTimer);tooltip.followPointer=splat(point)[0].series.tooltipOptions.followPointer;anchor=tooltip.getAnchor(point,mouseEvent);x=anchor[0];y=anchor[1];if(shared&&!(point.series&&point.series.noSharedTooltip)){chart.hoverPoints=point;if(hoverPoints){each(hoverPoints,function(point){point.setState();});}
each(point,function(item){item.setState(HOVER_STATE);pointConfig.push(item.getLabelConfig());});textConfig={x:point[0].category,y:point[0].y};textConfig.points=pointConfig;this.len=pointConfig.length;point=point[0];}else{textConfig=point.getLabelConfig();}
text=formatter.call(textConfig,tooltip);currentSeries=point.series;this.distance=pick(currentSeries.tooltipOptions.distance,16);if(text===false){this.hide();}else{if(tooltip.isHidden){stop(label);label.attr('opacity',1).show();}
label.attr({text:text});borderColor=options.borderColor||point.color||currentSeries.color||'#606060';label.attr({stroke:borderColor});tooltip.updatePosition({plotX:x,plotY:y,negative:point.negative,ttBelow:point.ttBelow,h:anchor[2]||0});this.isHidden=false;}
fireEvent(chart,'tooltipRefresh',{text:text,x:x+chart.plotLeft,y:y+chart.plotTop,borderColor:borderColor});},updatePosition:function(point){var chart=this.chart,label=this.label,pos=(this.options.positioner||this.getPosition).call(this,label.width,label.height,point);this.move(mathRound(pos.x),mathRound(pos.y||0),point.plotX+chart.plotLeft,point.plotY+chart.plotTop);},getXDateFormat:function(point,options,xAxis){var xDateFormat,dateTimeLabelFormats=options.dateTimeLabelFormats,closestPointRange=xAxis&&xAxis.closestPointRange,n,blank='01-01 00:00:00.000',strpos={millisecond:15,second:12,minute:9,hour:6,day:3},date,lastN='millisecond';if(closestPointRange){date=dateFormat('%m-%d %H:%M:%S.%L',point.x);for(n in timeUnits){if(closestPointRange===timeUnits.week&&+dateFormat('%w',point.x)===xAxis.options.startOfWeek&&date.substr(6)===blank.substr(6)){n='week';break;}
if(timeUnits[n]>closestPointRange){n=lastN;break;}
if(strpos[n]&&date.substr(strpos[n])!==blank.substr(strpos[n])){break;}
if(n!=='week'){lastN=n;}}
if(n){xDateFormat=dateTimeLabelFormats[n];}}else{xDateFormat=dateTimeLabelFormats.day;}
return xDateFormat||dateTimeLabelFormats.year;},tooltipFooterHeaderFormatter:function(point,isFooter){var footOrHead=isFooter?'footer':'header',series=point.series,tooltipOptions=series.tooltipOptions,xDateFormat=tooltipOptions.xDateFormat,xAxis=series.xAxis,isDateTime=xAxis&&xAxis.options.type==='datetime'&&isNumber(point.key),formatString=tooltipOptions[footOrHead+'Format'];if(isDateTime&&!xDateFormat){xDateFormat=this.getXDateFormat(point,tooltipOptions,xAxis);}
if(isDateTime&&xDateFormat){formatString=formatString.replace('{point.key}','{point.key:'+xDateFormat+'}');}
return format(formatString,{point:point,series:series});},bodyFormatter:function(items){return map(items,function(item){var tooltipOptions=item.series.tooltipOptions;return(tooltipOptions.pointFormatter||item.point.tooltipFormatter).call(item.point,tooltipOptions.pointFormat);});}};var hoverChartIndex;hasTouch=doc&&doc.documentElement.ontouchstart!==UNDEFINED;var Pointer=Highcharts.Pointer=function(chart,options){this.init(chart,options);};Pointer.prototype={init:function(chart,options){var chartOptions=options.chart,chartEvents=chartOptions.events,zoomType=useCanVG?'':chartOptions.zoomType,inverted=chart.inverted,zoomX,zoomY;this.options=options;this.chart=chart;this.zoomX=zoomX=/x/.test(zoomType);this.zoomY=zoomY=/y/.test(zoomType);this.zoomHor=(zoomX&&!inverted)||(zoomY&&inverted);this.zoomVert=(zoomY&&!inverted)||(zoomX&&inverted);this.hasZoom=zoomX||zoomY;this.runChartClick=chartEvents&&!!chartEvents.click;this.pinchDown=[];this.lastValidTouch={};if(Highcharts.Tooltip&&options.tooltip.enabled){chart.tooltip=new Tooltip(chart,options.tooltip);this.followTouchMove=pick(options.tooltip.followTouchMove,true);}
this.setDOMEvents();},normalize:function(e,chartPosition){var chartX,chartY,ePos;e=e||win.event;if(!e.target){e.target=e.srcElement;}
ePos=e.touches?(e.touches.length?e.touches.item(0):e.changedTouches[0]):e;if(!chartPosition){this.chartPosition=chartPosition=offset(this.chart.container);}
if(ePos.pageX===UNDEFINED){chartX=mathMax(e.x,e.clientX-chartPosition.left);chartY=e.y;}else{chartX=ePos.pageX-chartPosition.left;chartY=ePos.pageY-chartPosition.top;}
return extend(e,{chartX:mathRound(chartX),chartY:mathRound(chartY)});},getCoordinates:function(e){var coordinates={xAxis:[],yAxis:[]};each(this.chart.axes,function(axis){coordinates[axis.isXAxis?'xAxis':'yAxis'].push({axis:axis,value:axis.toValue(e[axis.horiz?'chartX':'chartY'])});});return coordinates;},runPointActions:function(e){var pointer=this,chart=pointer.chart,series=chart.series,tooltip=chart.tooltip,shared=tooltip?tooltip.shared:false,followPointer,hoverPoint=chart.hoverPoint,hoverSeries=chart.hoverSeries,i,distance=[Number.MAX_VALUE,Number.MAX_VALUE],anchor,noSharedTooltip,stickToHoverSeries,directTouch,kdpoints=[],kdpoint=[],kdpointT;if(!shared&&!hoverSeries){for(i=0;i<series.length;i++){if(series[i].directTouch||!series[i].options.stickyTracking){series=[];}}}
stickToHoverSeries=hoverSeries&&(shared?hoverSeries.noSharedTooltip:hoverSeries.directTouch);if(stickToHoverSeries&&hoverPoint){kdpoint=[hoverPoint];}else{each(series,function(s){noSharedTooltip=s.noSharedTooltip&&shared;directTouch=!shared&&s.directTouch;if(s.visible&&!noSharedTooltip&&!directTouch&&pick(s.options.enableMouseTracking,true)){kdpointT=s.searchPoint(e,!noSharedTooltip&&s.kdDimensions===1);if(kdpointT){kdpoints.push(kdpointT);}}});each(kdpoints,function(p){if(p){each(['dist','distX'],function(dist,k){if(typeof p[dist]==='number'){var
isCloser=p[dist]<distance[k],isAbove=p[dist]===distance[k]&&p.series.group.zIndex>=kdpoint[k].series.group.zIndex;if(isCloser||isAbove){distance[k]=p[dist];kdpoint[k]=p;}}});}});}
if(shared){i=kdpoints.length;while(i--){if(kdpoints[i].clientX!==kdpoint[1].clientX||kdpoints[i].series.noSharedTooltip){kdpoints.splice(i,1);}}}
if(kdpoint[0]&&(kdpoint[0]!==this.prevKDPoint||(tooltip&&tooltip.isHidden))){if(shared&&!kdpoint[0].series.noSharedTooltip){if(kdpoints.length&&tooltip){tooltip.refresh(kdpoints,e);}
each(kdpoints,function(point){point.onMouseOver(e,point!==((hoverSeries&&hoverSeries.directTouch&&hoverPoint)||kdpoint[0]));});this.prevKDPoint=kdpoint[1];}else{if(tooltip){tooltip.refresh(kdpoint[0],e);}
if(!hoverSeries||!hoverSeries.directTouch){kdpoint[0].onMouseOver(e);}
this.prevKDPoint=kdpoint[0];}}else{followPointer=hoverSeries&&hoverSeries.tooltipOptions.followPointer;if(tooltip&&followPointer&&!tooltip.isHidden){anchor=tooltip.getAnchor([{}],e);tooltip.updatePosition({plotX:anchor[0],plotY:anchor[1]});}}
if(!pointer._onDocumentMouseMove){pointer._onDocumentMouseMove=function(e){if(charts[hoverChartIndex]){charts[hoverChartIndex].pointer.onDocumentMouseMove(e);}};addEvent(doc,'mousemove',pointer._onDocumentMouseMove);}
each(shared?kdpoints:[pick(kdpoint[1],hoverPoint)],function(point){each(chart.axes,function(axis){if(!point||point.series[axis.coll]===axis){axis.drawCrosshair(e,point);}});});},reset:function(allowMove,delay){var pointer=this,chart=pointer.chart,hoverSeries=chart.hoverSeries,hoverPoint=chart.hoverPoint,hoverPoints=chart.hoverPoints,tooltip=chart.tooltip,tooltipPoints=tooltip&&tooltip.shared?hoverPoints:hoverPoint;if(allowMove&&tooltipPoints){each(splat(tooltipPoints),function(point){if(point.series.isCartesian&&point.plotX===undefined){allowMove=false;}});}
if(allowMove){if(tooltip&&tooltipPoints){tooltip.refresh(tooltipPoints);if(hoverPoint){hoverPoint.setState(hoverPoint.state,true);each(chart.axes,function(axis){if(pick(axis.crosshair&&axis.crosshair.snap,true)){axis.drawCrosshair(null,hoverPoint);}else{axis.hideCrosshair();}});}}}else{if(hoverPoint){hoverPoint.onMouseOut();}
if(hoverPoints){each(hoverPoints,function(point){point.setState();});}
if(hoverSeries){hoverSeries.onMouseOut();}
if(tooltip){tooltip.hide(delay);}
if(pointer._onDocumentMouseMove){removeEvent(doc,'mousemove',pointer._onDocumentMouseMove);pointer._onDocumentMouseMove=null;}
each(chart.axes,function(axis){axis.hideCrosshair();});pointer.hoverX=chart.hoverPoints=chart.hoverPoint=null;}},scaleGroups:function(attribs,clip){var chart=this.chart,seriesAttribs;each(chart.series,function(series){seriesAttribs=attribs||series.getPlotBox();if(series.xAxis&&series.xAxis.zoomEnabled){series.group.attr(seriesAttribs);if(series.markerGroup){series.markerGroup.attr(seriesAttribs);series.markerGroup.clip(clip?chart.clipRect:null);}
if(series.dataLabelsGroup){series.dataLabelsGroup.attr(seriesAttribs);}}});chart.clipRect.attr(clip||chart.clipBox);},dragStart:function(e){var chart=this.chart;chart.mouseIsDown=e.type;chart.cancelClick=false;chart.mouseDownX=this.mouseDownX=e.chartX;chart.mouseDownY=this.mouseDownY=e.chartY;},drag:function(e){var chart=this.chart,chartOptions=chart.options.chart,chartX=e.chartX,chartY=e.chartY,zoomHor=this.zoomHor,zoomVert=this.zoomVert,plotLeft=chart.plotLeft,plotTop=chart.plotTop,plotWidth=chart.plotWidth,plotHeight=chart.plotHeight,clickedInside,size,selectionMarker=this.selectionMarker,mouseDownX=this.mouseDownX,mouseDownY=this.mouseDownY,panKey=chartOptions.panKey&&e[chartOptions.panKey+'Key'];if(selectionMarker&&selectionMarker.touch){return;}
if(chartX<plotLeft){chartX=plotLeft;}else if(chartX>plotLeft+plotWidth){chartX=plotLeft+plotWidth;}
if(chartY<plotTop){chartY=plotTop;}else if(chartY>plotTop+plotHeight){chartY=plotTop+plotHeight;}
this.hasDragged=Math.sqrt(Math.pow(mouseDownX-chartX,2)+
Math.pow(mouseDownY-chartY,2));if(this.hasDragged>10){clickedInside=chart.isInsidePlot(mouseDownX-plotLeft,mouseDownY-plotTop);if(chart.hasCartesianSeries&&(this.zoomX||this.zoomY)&&clickedInside&&!panKey){if(!selectionMarker){this.selectionMarker=selectionMarker=chart.renderer.rect(plotLeft,plotTop,zoomHor?1:plotWidth,zoomVert?1:plotHeight,0).attr({fill:chartOptions.selectionMarkerFill||'rgba(69,114,167,0.25)',zIndex:7}).add();}}
if(selectionMarker&&zoomHor){size=chartX-mouseDownX;selectionMarker.attr({width:mathAbs(size),x:(size>0?0:size)+mouseDownX});}
if(selectionMarker&&zoomVert){size=chartY-mouseDownY;selectionMarker.attr({height:mathAbs(size),y:(size>0?0:size)+mouseDownY});}
if(clickedInside&&!selectionMarker&&chartOptions.panning){chart.pan(e,chartOptions.panning);}}},drop:function(e){var pointer=this,chart=this.chart,hasPinched=this.hasPinched;if(this.selectionMarker){var selectionData={originalEvent:e,xAxis:[],yAxis:[]},selectionBox=this.selectionMarker,selectionLeft=selectionBox.attr?selectionBox.attr('x'):selectionBox.x,selectionTop=selectionBox.attr?selectionBox.attr('y'):selectionBox.y,selectionWidth=selectionBox.attr?selectionBox.attr('width'):selectionBox.width,selectionHeight=selectionBox.attr?selectionBox.attr('height'):selectionBox.height,runZoom;if(this.hasDragged||hasPinched){each(chart.axes,function(axis){if(axis.zoomEnabled&&defined(axis.min)&&(hasPinched||pointer[{xAxis:'zoomX',yAxis:'zoomY'}[axis.coll]])){var horiz=axis.horiz,minPixelPadding=e.type==='touchend'?axis.minPixelPadding:0,selectionMin=axis.toValue((horiz?selectionLeft:selectionTop)+minPixelPadding),selectionMax=axis.toValue((horiz?selectionLeft+selectionWidth:selectionTop+selectionHeight)-minPixelPadding);selectionData[axis.coll].push({axis:axis,min:mathMin(selectionMin,selectionMax),max:mathMax(selectionMin,selectionMax)});runZoom=true;}});if(runZoom){fireEvent(chart,'selection',selectionData,function(args){chart.zoom(extend(args,hasPinched?{animation:false}:null));});}}
this.selectionMarker=this.selectionMarker.destroy();if(hasPinched){this.scaleGroups();}}
if(chart){css(chart.container,{cursor:chart._cursor});chart.cancelClick=this.hasDragged>10;chart.mouseIsDown=this.hasDragged=this.hasPinched=false;this.pinchDown=[];}},onContainerMouseDown:function(e){e=this.normalize(e);if(e.preventDefault){e.preventDefault();}
this.dragStart(e);},onDocumentMouseUp:function(e){if(charts[hoverChartIndex]){charts[hoverChartIndex].pointer.drop(e);}},onDocumentMouseMove:function(e){var chart=this.chart,chartPosition=this.chartPosition;e=this.normalize(e,chartPosition);if(chartPosition&&!this.inClass(e.target,'highcharts-tracker')&&!chart.isInsidePlot(e.chartX-chart.plotLeft,e.chartY-chart.plotTop)){this.reset();}},onContainerMouseLeave:function(e){var chart=charts[hoverChartIndex];if(chart&&(e.relatedTarget||e.toElement)){chart.pointer.reset();chart.pointer.chartPosition=null;}},onContainerMouseMove:function(e){var chart=this.chart;if(!defined(hoverChartIndex)||!charts[hoverChartIndex]||!charts[hoverChartIndex].mouseIsDown){hoverChartIndex=chart.index;}
e=this.normalize(e);e.returnValue=false;if(chart.mouseIsDown==='mousedown'){this.drag(e);}
if((this.inClass(e.target,'highcharts-tracker')||chart.isInsidePlot(e.chartX-chart.plotLeft,e.chartY-chart.plotTop))&&!chart.openMenu){this.runPointActions(e);}},inClass:function(element,className){var elemClassName;while(element){elemClassName=attr(element,'class');if(elemClassName){if(elemClassName.indexOf(className)!==-1){return true;}
if(elemClassName.indexOf(PREFIX+'container')!==-1){return false;}}
element=element.parentNode;}},onTrackerMouseOut:function(e){var series=this.chart.hoverSeries,relatedTarget=e.relatedTarget||e.toElement;if(series&&relatedTarget&&!series.options.stickyTracking&&!this.inClass(relatedTarget,PREFIX+'tooltip')&&!this.inClass(relatedTarget,PREFIX+'series-'+series.index)){series.onMouseOut();}},onContainerClick:function(e){var chart=this.chart,hoverPoint=chart.hoverPoint,plotLeft=chart.plotLeft,plotTop=chart.plotTop;e=this.normalize(e);if(!chart.cancelClick){if(hoverPoint&&this.inClass(e.target,PREFIX+'tracker')){fireEvent(hoverPoint.series,'click',extend(e,{point:hoverPoint}));if(chart.hoverPoint){hoverPoint.firePointEvent('click',e);}}else{extend(e,this.getCoordinates(e));if(chart.isInsidePlot(e.chartX-plotLeft,e.chartY-plotTop)){fireEvent(chart,'click',e);}}}},setDOMEvents:function(){var pointer=this,container=pointer.chart.container;container.onmousedown=function(e){pointer.onContainerMouseDown(e);};container.onmousemove=function(e){pointer.onContainerMouseMove(e);};container.onclick=function(e){pointer.onContainerClick(e);};addEvent(container,'mouseleave',pointer.onContainerMouseLeave);if(chartCount===1){addEvent(doc,'mouseup',pointer.onDocumentMouseUp);}
if(hasTouch){container.ontouchstart=function(e){pointer.onContainerTouchStart(e);};container.ontouchmove=function(e){pointer.onContainerTouchMove(e);};if(chartCount===1){addEvent(doc,'touchend',pointer.onDocumentTouchEnd);}}},destroy:function(){var prop;removeEvent(this.chart.container,'mouseleave',this.onContainerMouseLeave);if(!chartCount){removeEvent(doc,'mouseup',this.onDocumentMouseUp);removeEvent(doc,'touchend',this.onDocumentTouchEnd);}
clearInterval(this.tooltipTimeout);for(prop in this){this[prop]=null;}}};extend(Highcharts.Pointer.prototype,{pinchTranslate:function(pinchDown,touches,transform,selectionMarker,clip,lastValidTouch){if(this.zoomHor||this.pinchHor){this.pinchTranslateDirection(true,pinchDown,touches,transform,selectionMarker,clip,lastValidTouch);}
if(this.zoomVert||this.pinchVert){this.pinchTranslateDirection(false,pinchDown,touches,transform,selectionMarker,clip,lastValidTouch);}},pinchTranslateDirection:function(horiz,pinchDown,touches,transform,selectionMarker,clip,lastValidTouch,forcedScale){var chart=this.chart,xy=horiz?'x':'y',XY=horiz?'X':'Y',sChartXY='chart'+XY,wh=horiz?'width':'height',plotLeftTop=chart['plot'+(horiz?'Left':'Top')],selectionWH,selectionXY,clipXY,scale=forcedScale||1,inverted=chart.inverted,bounds=chart.bounds[horiz?'h':'v'],singleTouch=pinchDown.length===1,touch0Start=pinchDown[0][sChartXY],touch0Now=touches[0][sChartXY],touch1Start=!singleTouch&&pinchDown[1][sChartXY],touch1Now=!singleTouch&&touches[1][sChartXY],outOfBounds,transformScale,scaleKey,setScale=function(){if(!singleTouch&&mathAbs(touch0Start-touch1Start)>20){scale=forcedScale||mathAbs(touch0Now-touch1Now)/mathAbs(touch0Start-touch1Start);}
clipXY=((plotLeftTop-touch0Now)/scale)+touch0Start;selectionWH=chart['plot'+(horiz?'Width':'Height')]/scale;};setScale();selectionXY=clipXY;if(selectionXY<bounds.min){selectionXY=bounds.min;outOfBounds=true;}else if(selectionXY+selectionWH>bounds.max){selectionXY=bounds.max-selectionWH;outOfBounds=true;}
if(outOfBounds){touch0Now-=0.8*(touch0Now-lastValidTouch[xy][0]);if(!singleTouch){touch1Now-=0.8*(touch1Now-lastValidTouch[xy][1]);}
setScale();}else{lastValidTouch[xy]=[touch0Now,touch1Now];}
if(!inverted){clip[xy]=clipXY-plotLeftTop;clip[wh]=selectionWH;}
scaleKey=inverted?(horiz?'scaleY':'scaleX'):'scale'+XY;transformScale=inverted?1/scale:scale;selectionMarker[wh]=selectionWH;selectionMarker[xy]=selectionXY;transform[scaleKey]=scale;transform['translate'+XY]=(transformScale*plotLeftTop)+(touch0Now-(transformScale*touch0Start));},pinch:function(e){var self=this,chart=self.chart,pinchDown=self.pinchDown,touches=e.touches,touchesLength=touches.length,lastValidTouch=self.lastValidTouch,hasZoom=self.hasZoom,selectionMarker=self.selectionMarker,transform={},fireClickEvent=touchesLength===1&&((self.inClass(e.target,PREFIX+'tracker')&&chart.runTrackerClick)||self.runChartClick),clip={};if(touchesLength>1){self.initiated=true;}
if(hasZoom&&self.initiated&&!fireClickEvent){e.preventDefault();}
map(touches,function(e){return self.normalize(e);});if(e.type==='touchstart'){each(touches,function(e,i){pinchDown[i]={chartX:e.chartX,chartY:e.chartY};});lastValidTouch.x=[pinchDown[0].chartX,pinchDown[1]&&pinchDown[1].chartX];lastValidTouch.y=[pinchDown[0].chartY,pinchDown[1]&&pinchDown[1].chartY];each(chart.axes,function(axis){if(axis.zoomEnabled){var bounds=chart.bounds[axis.horiz?'h':'v'],minPixelPadding=axis.minPixelPadding,min=axis.toPixels(pick(axis.options.min,axis.dataMin)),max=axis.toPixels(pick(axis.options.max,axis.dataMax)),absMin=mathMin(min,max),absMax=mathMax(min,max);bounds.min=mathMin(axis.pos,absMin-minPixelPadding);bounds.max=mathMax(axis.pos+axis.len,absMax+minPixelPadding);}});self.res=true;}else if(pinchDown.length){if(!selectionMarker){self.selectionMarker=selectionMarker=extend({destroy:noop,touch:true},chart.plotBox);}
self.pinchTranslate(pinchDown,touches,transform,selectionMarker,clip,lastValidTouch);self.hasPinched=hasZoom;self.scaleGroups(transform,clip);if(!hasZoom&&self.followTouchMove&&touchesLength===1){this.runPointActions(self.normalize(e));}else if(self.res){self.res=false;this.reset(false,0);}}},touch:function(e,start){var chart=this.chart,hasMoved,pinchDown;hoverChartIndex=chart.index;if(e.touches.length===1){e=this.normalize(e);if(chart.isInsidePlot(e.chartX-chart.plotLeft,e.chartY-chart.plotTop)&&!chart.openMenu){if(start){this.runPointActions(e);}
if(e.type==='touchmove'){pinchDown=this.pinchDown;hasMoved=Math.sqrt(Math.pow(pinchDown[0].chartX-e.chartX,2)+
Math.pow(pinchDown[0].chartY-e.chartY,2))>=4;}
if(pick(hasMoved,true)){this.pinch(e);}}else if(start){this.reset();}}else if(e.touches.length===2){this.pinch(e);}},onContainerTouchStart:function(e){this.touch(e,true);},onContainerTouchMove:function(e){this.touch(e);},onDocumentTouchEnd:function(e){if(charts[hoverChartIndex]){charts[hoverChartIndex].pointer.drop(e);}}});if(win.PointerEvent||win.MSPointerEvent){var touches={},hasPointerEvent=!!win.PointerEvent,getWebkitTouches=function(){var key,fake=[];fake.item=function(i){return this[i];};for(key in touches){if(touches.hasOwnProperty(key)){fake.push({pageX:touches[key].pageX,pageY:touches[key].pageY,target:touches[key].target});}}
return fake;},translateMSPointer=function(e,method,wktype,func){var p;if((e.pointerType==='touch'||e.pointerType===e.MSPOINTER_TYPE_TOUCH)&&charts[hoverChartIndex]){func(e);p=charts[hoverChartIndex].pointer;p[method]({type:wktype,target:e.currentTarget,preventDefault:noop,touches:getWebkitTouches()});}};extend(Pointer.prototype,{onContainerPointerDown:function(e){translateMSPointer(e,'onContainerTouchStart','touchstart',function(e){touches[e.pointerId]={pageX:e.pageX,pageY:e.pageY,target:e.currentTarget};});},onContainerPointerMove:function(e){translateMSPointer(e,'onContainerTouchMove','touchmove',function(e){touches[e.pointerId]={pageX:e.pageX,pageY:e.pageY};if(!touches[e.pointerId].target){touches[e.pointerId].target=e.currentTarget;}});},onDocumentPointerUp:function(e){translateMSPointer(e,'onDocumentTouchEnd','touchend',function(e){delete touches[e.pointerId];});},batchMSEvents:function(fn){fn(this.chart.container,hasPointerEvent?'pointerdown':'MSPointerDown',this.onContainerPointerDown);fn(this.chart.container,hasPointerEvent?'pointermove':'MSPointerMove',this.onContainerPointerMove);fn(doc,hasPointerEvent?'pointerup':'MSPointerUp',this.onDocumentPointerUp);}});wrap(Pointer.prototype,'init',function(proceed,chart,options){proceed.call(this,chart,options);if(this.hasZoom){css(chart.container,{'-ms-touch-action':NONE,'touch-action':NONE});}});wrap(Pointer.prototype,'setDOMEvents',function(proceed){proceed.apply(this);if(this.hasZoom||this.followTouchMove){this.batchMSEvents(addEvent);}});wrap(Pointer.prototype,'destroy',function(proceed){this.batchMSEvents(removeEvent);proceed.call(this);});}
var Legend=Highcharts.Legend=function(chart,options){this.init(chart,options);};Legend.prototype={init:function(chart,options){var legend=this,itemStyle=options.itemStyle,padding,itemMarginTop=options.itemMarginTop||0;this.options=options;if(!options.enabled){return;}
legend.itemStyle=itemStyle;legend.itemHiddenStyle=merge(itemStyle,options.itemHiddenStyle);legend.itemMarginTop=itemMarginTop;legend.padding=padding=pick(options.padding,8);legend.initialItemX=padding;legend.initialItemY=padding-5;legend.maxItemWidth=0;legend.chart=chart;legend.itemHeight=0;legend.symbolWidth=pick(options.symbolWidth,16);legend.pages=[];legend.render();addEvent(legend.chart,'endResize',function(){legend.positionCheckboxes();});},colorizeItem:function(item,visible){var legend=this,options=legend.options,legendItem=item.legendItem,legendLine=item.legendLine,legendSymbol=item.legendSymbol,hiddenColor=legend.itemHiddenStyle.color,textColor=visible?options.itemStyle.color:hiddenColor,symbolColor=visible?(item.legendColor||item.color||'#CCC'):hiddenColor,markerOptions=item.options&&item.options.marker,symbolAttr={fill:symbolColor},key,val;if(legendItem){legendItem.css({fill:textColor,color:textColor});}
if(legendLine){legendLine.attr({stroke:symbolColor});}
if(legendSymbol){if(markerOptions&&legendSymbol.isMarker){symbolAttr.stroke=symbolColor;markerOptions=item.convertAttribs(markerOptions);for(key in markerOptions){val=markerOptions[key];if(val!==UNDEFINED){symbolAttr[key]=val;}}}
legendSymbol.attr(symbolAttr);}},positionItem:function(item){var legend=this,options=legend.options,symbolPadding=options.symbolPadding,ltr=!options.rtl,legendItemPos=item._legendItemPos,itemX=legendItemPos[0],itemY=legendItemPos[1],checkbox=item.checkbox,legendGroup=item.legendGroup;if(legendGroup&&legendGroup.element){legendGroup.translate(ltr?itemX:legend.legendWidth-itemX-2*symbolPadding-4,itemY);}
if(checkbox){checkbox.x=itemX;checkbox.y=itemY;}},destroyItem:function(item){var checkbox=item.checkbox;each(['legendItem','legendLine','legendSymbol','legendGroup'],function(key){if(item[key]){item[key]=item[key].destroy();}});if(checkbox){discardElement(item.checkbox);}},destroy:function(){var legend=this,legendGroup=legend.group,box=legend.box;if(box){legend.box=box.destroy();}
if(legendGroup){legend.group=legendGroup.destroy();}},positionCheckboxes:function(scrollOffset){var alignAttr=this.group.alignAttr,translateY,clipHeight=this.clipHeight||this.legendHeight,titleHeight=this.titleHeight;if(alignAttr){translateY=alignAttr.translateY;each(this.allItems,function(item){var checkbox=item.checkbox,top;if(checkbox){top=translateY+titleHeight+checkbox.y+(scrollOffset||0)+3;css(checkbox,{left:(alignAttr.translateX+item.checkboxOffset+checkbox.x-20)+PX,top:top+PX,display:top>translateY-6&&top<translateY+clipHeight-6?'':NONE});}});}},renderTitle:function(){var options=this.options,padding=this.padding,titleOptions=options.title,titleHeight=0,bBox;if(titleOptions.text){if(!this.title){this.title=this.chart.renderer.label(titleOptions.text,padding-3,padding-4,null,null,null,null,null,'legend-title').attr({zIndex:1}).css(titleOptions.style).add(this.group);}
bBox=this.title.getBBox();titleHeight=bBox.height;this.offsetWidth=bBox.width;this.contentGroup.attr({translateY:titleHeight});}
this.titleHeight=titleHeight;},setText:function(item){var options=this.options;item.legendItem.attr({text:options.labelFormat?format(options.labelFormat,item):options.labelFormatter.call(item)});},renderItem:function(item){var legend=this,chart=legend.chart,renderer=chart.renderer,options=legend.options,horizontal=options.layout==='horizontal',symbolWidth=legend.symbolWidth,symbolPadding=options.symbolPadding,itemStyle=legend.itemStyle,itemHiddenStyle=legend.itemHiddenStyle,padding=legend.padding,itemDistance=horizontal?pick(options.itemDistance,20):0,ltr=!options.rtl,itemHeight,widthOption=options.width,itemMarginBottom=options.itemMarginBottom||0,itemMarginTop=legend.itemMarginTop,initialItemX=legend.initialItemX,bBox,itemWidth,li=item.legendItem,series=item.series&&item.series.drawLegendSymbol?item.series:item,seriesOptions=series.options,showCheckbox=legend.createCheckboxForItem&&seriesOptions&&seriesOptions.showCheckbox,useHTML=options.useHTML;if(!li){item.legendGroup=renderer.g('legend-item').attr({zIndex:1}).add(legend.scrollGroup);item.legendItem=li=renderer.text('',ltr?symbolWidth+symbolPadding:-symbolPadding,legend.baseline||0,useHTML).css(merge(item.visible?itemStyle:itemHiddenStyle)).attr({align:ltr?'left':'right',zIndex:2}).add(item.legendGroup);if(!legend.baseline){legend.fontMetrics=renderer.fontMetrics(itemStyle.fontSize,li);legend.baseline=legend.fontMetrics.f+3+itemMarginTop;li.attr('y',legend.baseline);}
series.drawLegendSymbol(legend,item);if(legend.setItemEvents){legend.setItemEvents(item,li,useHTML,itemStyle,itemHiddenStyle);}
if(showCheckbox){legend.createCheckboxForItem(item);}}
legend.colorizeItem(item,item.visible);legend.setText(item);bBox=li.getBBox();itemWidth=item.checkboxOffset=options.itemWidth||item.legendItemWidth||symbolWidth+symbolPadding+bBox.width+itemDistance+(showCheckbox?20:0);legend.itemHeight=itemHeight=mathRound(item.legendItemHeight||bBox.height);if(horizontal&&legend.itemX-initialItemX+itemWidth>(widthOption||(chart.chartWidth-2*padding-initialItemX-options.x))){legend.itemX=initialItemX;legend.itemY+=itemMarginTop+legend.lastLineHeight+itemMarginBottom;legend.lastLineHeight=0;}
legend.maxItemWidth=mathMax(legend.maxItemWidth,itemWidth);legend.lastItemY=itemMarginTop+legend.itemY+itemMarginBottom;legend.lastLineHeight=mathMax(itemHeight,legend.lastLineHeight);item._legendItemPos=[legend.itemX,legend.itemY];if(horizontal){legend.itemX+=itemWidth;}else{legend.itemY+=itemMarginTop+itemHeight+itemMarginBottom;legend.lastLineHeight=itemHeight;}
legend.offsetWidth=widthOption||mathMax((horizontal?legend.itemX-initialItemX-itemDistance:itemWidth)+padding,legend.offsetWidth);},getAllItems:function(){var allItems=[];each(this.chart.series,function(series){var seriesOptions=series.options;if(!pick(seriesOptions.showInLegend,!defined(seriesOptions.linkedTo)?UNDEFINED:false,true)){return;}
allItems=allItems.concat(series.legendItems||(seriesOptions.legendType==='point'?series.data:series));});return allItems;},adjustMargins:function(margin,spacing){var chart=this.chart,options=this.options,alignment=options.align.charAt(0)+options.verticalAlign.charAt(0)+options.layout.charAt(0);if(this.display&&!options.floating){each([/(lth|ct|rth)/,/(rtv|rm|rbv)/,/(rbh|cb|lbh)/,/(lbv|lm|ltv)/],function(alignments,side){if(alignments.test(alignment)&&!defined(margin[side])){chart[marginNames[side]]=mathMax(chart[marginNames[side]],chart.legend[(side+1)%2?'legendHeight':'legendWidth']+
[1,-1,-1,1][side]*options[(side%2)?'x':'y']+
pick(options.margin,12)+
spacing[side]);}});}},render:function(){var legend=this,chart=legend.chart,renderer=chart.renderer,legendGroup=legend.group,allItems,display,legendWidth,legendHeight,box=legend.box,options=legend.options,padding=legend.padding,legendBorderWidth=options.borderWidth,legendBackgroundColor=options.backgroundColor;legend.itemX=legend.initialItemX;legend.itemY=legend.initialItemY;legend.offsetWidth=0;legend.lastItemY=0;if(!legendGroup){legend.group=legendGroup=renderer.g('legend').attr({zIndex:7}).add();legend.contentGroup=renderer.g().attr({zIndex:1}).add(legendGroup);legend.scrollGroup=renderer.g().add(legend.contentGroup);}
legend.renderTitle();allItems=legend.getAllItems();stableSort(allItems,function(a,b){return((a.options&&a.options.legendIndex)||0)-((b.options&&b.options.legendIndex)||0);});if(options.reversed){allItems.reverse();}
legend.allItems=allItems;legend.display=display=!!allItems.length;legend.lastLineHeight=0;each(allItems,function(item){legend.renderItem(item);});legendWidth=(options.width||legend.offsetWidth)+padding;legendHeight=legend.lastItemY+legend.lastLineHeight+legend.titleHeight;legendHeight=legend.handleOverflow(legendHeight);legendHeight+=padding;if(legendBorderWidth||legendBackgroundColor){if(!box){legend.box=box=renderer.rect(0,0,legendWidth,legendHeight,options.borderRadius,legendBorderWidth||0).attr({stroke:options.borderColor,'stroke-width':legendBorderWidth||0,fill:legendBackgroundColor||NONE}).add(legendGroup).shadow(options.shadow);box.isNew=true;}else if(legendWidth>0&&legendHeight>0){box[box.isNew?'attr':'animate'](box.crisp({width:legendWidth,height:legendHeight}));box.isNew=false;}
box[display?'show':'hide']();}
legend.legendWidth=legendWidth;legend.legendHeight=legendHeight;each(allItems,function(item){legend.positionItem(item);});if(display){legendGroup.align(extend({width:legendWidth,height:legendHeight},options),true,'spacingBox');}
if(!chart.isResizing){this.positionCheckboxes();}},handleOverflow:function(legendHeight){var legend=this,chart=this.chart,renderer=chart.renderer,options=this.options,optionsY=options.y,alignTop=options.verticalAlign==='top',spaceHeight=chart.spacingBox.height+(alignTop?-optionsY:optionsY)-this.padding,maxHeight=options.maxHeight,clipHeight,clipRect=this.clipRect,navOptions=options.navigation,animation=pick(navOptions.animation,true),arrowSize=navOptions.arrowSize||12,nav=this.nav,pages=this.pages,padding=this.padding,lastY,allItems=this.allItems,clipToHeight=function(height){clipRect.attr({height:height});if(legend.contentGroup.div){legend.contentGroup.div.style.clip='rect('+padding+'px,9999px,'+(padding+height)+'px,0)';}};if(options.layout==='horizontal'){spaceHeight/=2;}
if(maxHeight){spaceHeight=mathMin(spaceHeight,maxHeight);}
pages.length=0;if(legendHeight>spaceHeight&&navOptions.enabled!==false){this.clipHeight=clipHeight=mathMax(spaceHeight-20-this.titleHeight-padding,0);this.currentPage=pick(this.currentPage,1);this.fullHeight=legendHeight;each(allItems,function(item,i){var y=item._legendItemPos[1],h=mathRound(item.legendItem.getBBox().height),len=pages.length;if(!len||(y-pages[len-1]>clipHeight&&(lastY||y)!==pages[len-1])){pages.push(lastY||y);len++;}
if(i===allItems.length-1&&y+h-pages[len-1]>clipHeight){pages.push(y);}
if(y!==lastY){lastY=y;}});if(!clipRect){clipRect=legend.clipRect=renderer.clipRect(0,padding,9999,0);legend.contentGroup.clip(clipRect);}
clipToHeight(clipHeight);if(!nav){this.nav=nav=renderer.g().attr({zIndex:1}).add(this.group);this.up=renderer.symbol('triangle',0,0,arrowSize,arrowSize).on('click',function(){legend.scroll(-1,animation);}).add(nav);this.pager=renderer.text('',15,10).css(navOptions.style).add(nav);this.down=renderer.symbol('triangle-down',0,0,arrowSize,arrowSize).on('click',function(){legend.scroll(1,animation);}).add(nav);}
legend.scroll(0);legendHeight=spaceHeight;}else if(nav){clipToHeight(chart.chartHeight);nav.hide();this.scrollGroup.attr({translateY:1});this.clipHeight=0;}
return legendHeight;},scroll:function(scrollBy,animation){var pages=this.pages,pageCount=pages.length,currentPage=this.currentPage+scrollBy,clipHeight=this.clipHeight,navOptions=this.options.navigation,activeColor=navOptions.activeColor,inactiveColor=navOptions.inactiveColor,pager=this.pager,padding=this.padding,scrollOffset;if(currentPage>pageCount){currentPage=pageCount;}
if(currentPage>0){if(animation!==UNDEFINED){setAnimation(animation,this.chart);}
this.nav.attr({translateX:padding,translateY:clipHeight+this.padding+7+this.titleHeight,visibility:VISIBLE});this.up.attr({fill:currentPage===1?inactiveColor:activeColor}).css({cursor:currentPage===1?'default':'pointer'});pager.attr({text:currentPage+'/'+pageCount});this.down.attr({x:18+this.pager.getBBox().width,fill:currentPage===pageCount?inactiveColor:activeColor}).css({cursor:currentPage===pageCount?'default':'pointer'});scrollOffset=-pages[currentPage-1]+this.initialItemY;this.scrollGroup.animate({translateY:scrollOffset});this.currentPage=currentPage;this.positionCheckboxes(scrollOffset);}}};var LegendSymbolMixin=Highcharts.LegendSymbolMixin={drawRectangle:function(legend,item){var symbolHeight=legend.options.symbolHeight||legend.fontMetrics.f;item.legendSymbol=this.chart.renderer.rect(0,legend.baseline-symbolHeight+1,legend.symbolWidth,symbolHeight,legend.options.symbolRadius||0).attr({zIndex:3}).add(item.legendGroup);},drawLineMarker:function(legend){var options=this.options,markerOptions=options.marker,radius,legendSymbol,symbolWidth=legend.symbolWidth,renderer=this.chart.renderer,legendItemGroup=this.legendGroup,verticalCenter=legend.baseline-mathRound(legend.fontMetrics.b*0.3),attr;if(options.lineWidth){attr={'stroke-width':options.lineWidth};if(options.dashStyle){attr.dashstyle=options.dashStyle;}
this.legendLine=renderer.path([M,0,verticalCenter,L,symbolWidth,verticalCenter]).attr(attr).add(legendItemGroup);}
if(markerOptions&&markerOptions.enabled!==false){radius=markerOptions.radius;this.legendSymbol=legendSymbol=renderer.symbol(this.symbol,(symbolWidth/2)-radius,verticalCenter-radius,2*radius,2*radius,markerOptions).add(legendItemGroup);legendSymbol.isMarker=true;}}};if(/Trident\/7\.0/.test(userAgent)||isFirefox){wrap(Legend.prototype,'positionItem',function(proceed,item){var legend=this,runPositionItem=function(){if(item._legendItemPos){proceed.call(legend,item);}};runPositionItem();setTimeout(runPositionItem);});}
var Chart=Highcharts.Chart=function(){this.getArgs.apply(this,arguments);};Highcharts.chart=function(a,b,c){return new Chart(a,b,c);};Chart.prototype={callbacks:[],getArgs:function(){var args=[].slice.call(arguments);if(isString(args[0])||args[0].nodeName){this.renderTo=args.shift();}
this.init(args[0],args[1]);},init:function(userOptions,callback){var options,seriesOptions=userOptions.series;userOptions.series=null;options=merge(defaultOptions,userOptions);options.series=userOptions.series=seriesOptions;this.userOptions=userOptions;var optionsChart=options.chart;this.margin=this.splashArray('margin',optionsChart);this.spacing=this.splashArray('spacing',optionsChart);var chartEvents=optionsChart.events;this.bounds={h:{},v:{}};this.callback=callback;this.isResizing=0;this.options=options;this.axes=[];this.series=[];this.hasCartesianSeries=optionsChart.showAxes;var chart=this,eventType;chart.index=charts.length;charts.push(chart);chartCount++;if(optionsChart.reflow!==false){addEvent(chart,'load',function(){chart.initReflow();});}
if(chartEvents){for(eventType in chartEvents){addEvent(chart,eventType,chartEvents[eventType]);}}
chart.xAxis=[];chart.yAxis=[];chart.animation=useCanVG?false:pick(optionsChart.animation,true);chart.pointCount=chart.colorCounter=chart.symbolCounter=0;chart.firstRender();},initSeries:function(options){var chart=this,optionsChart=chart.options.chart,type=options.type||optionsChart.type||optionsChart.defaultSeriesType,series,constr=seriesTypes[type];if(!constr){error(17,true);}
series=new constr();series.init(this,options);return series;},isInsidePlot:function(plotX,plotY,inverted){var x=inverted?plotY:plotX,y=inverted?plotX:plotY;return x>=0&&x<=this.plotWidth&&y>=0&&y<=this.plotHeight;},redraw:function(animation){var chart=this,axes=chart.axes,series=chart.series,pointer=chart.pointer,legend=chart.legend,redrawLegend=chart.isDirtyLegend,hasStackedSeries,hasDirtyStacks,hasCartesianSeries=chart.hasCartesianSeries,isDirtyBox=chart.isDirtyBox,seriesLength=series.length,i=seriesLength,serie,renderer=chart.renderer,isHiddenChart=renderer.isHidden(),afterRedraw=[];setAnimation(animation,chart);if(isHiddenChart){chart.cloneRenderTo();}
chart.layOutTitles();while(i--){serie=series[i];if(serie.options.stacking){hasStackedSeries=true;if(serie.isDirty){hasDirtyStacks=true;break;}}}
if(hasDirtyStacks){i=seriesLength;while(i--){serie=series[i];if(serie.options.stacking){serie.isDirty=true;}}}
each(series,function(serie){if(serie.isDirty){if(serie.options.legendType==='point'){if(serie.updateTotals){serie.updateTotals();}
redrawLegend=true;}}});if(redrawLegend&&legend.options.enabled){legend.render();chart.isDirtyLegend=false;}
if(hasStackedSeries){chart.getStacks();}
if(hasCartesianSeries){if(!chart.isResizing){chart.maxTicks=null;each(axes,function(axis){axis.setScale();});}}
chart.getMargins();if(hasCartesianSeries){each(axes,function(axis){if(axis.isDirty){isDirtyBox=true;}});each(axes,function(axis){var key=axis.min+','+axis.max;if(axis.extKey!==key){axis.extKey=key;afterRedraw.push(function(){fireEvent(axis,'afterSetExtremes',extend(axis.eventArgs,axis.getExtremes()));delete axis.eventArgs;});}
if(isDirtyBox||hasStackedSeries){axis.redraw();}});}
if(isDirtyBox){chart.drawChartBox();}
each(series,function(serie){if(serie.isDirty&&serie.visible&&(!serie.isCartesian||serie.xAxis)){serie.redraw();}});if(pointer){pointer.reset(true);}
renderer.draw();fireEvent(chart,'redraw');if(isHiddenChart){chart.cloneRenderTo(true);}
each(afterRedraw,function(callback){callback.call();});},get:function(id){var chart=this,axes=chart.axes,series=chart.series;var i,j,points;for(i=0;i<axes.length;i++){if(axes[i].options.id===id){return axes[i];}}
for(i=0;i<series.length;i++){if(series[i].options.id===id){return series[i];}}
for(i=0;i<series.length;i++){points=series[i].points||[];for(j=0;j<points.length;j++){if(points[j].id===id){return points[j];}}}
return null;},getAxes:function(){var chart=this,options=this.options,xAxisOptions=options.xAxis=splat(options.xAxis||{}),yAxisOptions=options.yAxis=splat(options.yAxis||{}),optionsArray;each(xAxisOptions,function(axis,i){axis.index=i;axis.isX=true;});each(yAxisOptions,function(axis,i){axis.index=i;});optionsArray=xAxisOptions.concat(yAxisOptions);each(optionsArray,function(axisOptions){new Axis(chart,axisOptions);});},getSelectedPoints:function(){var points=[];each(this.series,function(serie){points=points.concat(grep(serie.points||[],function(point){return point.selected;}));});return points;},getSelectedSeries:function(){return grep(this.series,function(serie){return serie.selected;});},setTitle:function(titleOptions,subtitleOptions,redraw){var chart=this,options=chart.options,chartTitleOptions,chartSubtitleOptions;chartTitleOptions=options.title=merge(options.title,titleOptions);chartSubtitleOptions=options.subtitle=merge(options.subtitle,subtitleOptions);each([['title',titleOptions,chartTitleOptions],['subtitle',subtitleOptions,chartSubtitleOptions]],function(arr){var name=arr[0],title=chart[name],titleOptions=arr[1],chartTitleOptions=arr[2];if(title&&titleOptions){chart[name]=title=title.destroy();}
if(chartTitleOptions&&chartTitleOptions.text&&!title){chart[name]=chart.renderer.text(chartTitleOptions.text,0,0,chartTitleOptions.useHTML).attr({align:chartTitleOptions.align,'class':PREFIX+name,zIndex:chartTitleOptions.zIndex||4}).css(chartTitleOptions.style).add();}});chart.layOutTitles(redraw);},layOutTitles:function(redraw){var titleOffset=0,title=this.title,subtitle=this.subtitle,options=this.options,titleOptions=options.title,subtitleOptions=options.subtitle,requiresDirtyBox,renderer=this.renderer,autoWidth=this.spacingBox.width-44;if(title){title.css({width:(titleOptions.width||autoWidth)+PX}).align(extend({y:renderer.fontMetrics(titleOptions.style.fontSize,title).b-3},titleOptions),false,'spacingBox');if(!titleOptions.floating&&!titleOptions.verticalAlign){titleOffset=title.getBBox().height;}}
if(subtitle){subtitle.css({width:(subtitleOptions.width||autoWidth)+PX}).align(extend({y:titleOffset+(titleOptions.margin-13)+renderer.fontMetrics(subtitleOptions.style.fontSize,title).b},subtitleOptions),false,'spacingBox');if(!subtitleOptions.floating&&!subtitleOptions.verticalAlign){titleOffset=mathCeil(titleOffset+subtitle.getBBox().height);}}
requiresDirtyBox=this.titleOffset!==titleOffset;this.titleOffset=titleOffset;if(!this.isDirtyBox&&requiresDirtyBox){this.isDirtyBox=requiresDirtyBox;if(this.hasRendered&&pick(redraw,true)&&this.isDirtyBox){this.redraw();}}},getChartSize:function(){var chart=this,optionsChart=chart.options.chart,widthOption=optionsChart.width,heightOption=optionsChart.height,renderTo=chart.renderToClone||chart.renderTo;if(!defined(widthOption)){chart.containerWidth=getStyle(renderTo,'width');}
if(!defined(heightOption)){chart.containerHeight=getStyle(renderTo,'height');}
chart.chartWidth=mathMax(0,widthOption||chart.containerWidth||600);chart.chartHeight=mathMax(0,pick(heightOption,chart.containerHeight>19?chart.containerHeight:400));},cloneRenderTo:function(revert){var clone=this.renderToClone,container=this.container;if(revert){if(clone){this.renderTo.appendChild(container);discardElement(clone);delete this.renderToClone;}}else{if(container&&container.parentNode===this.renderTo){this.renderTo.removeChild(container);}
this.renderToClone=clone=this.renderTo.cloneNode(0);css(clone,{position:ABSOLUTE,top:'-9999px',display:'block'});if(clone.style.setProperty){clone.style.setProperty('display','block','important');}
doc.body.appendChild(clone);if(container){clone.appendChild(container);}}},getContainer:function(){var chart=this,container,options=chart.options,optionsChart=options.chart,chartWidth,chartHeight,renderTo=chart.renderTo,indexAttrName='data-highcharts-chart',oldChartIndex,Ren,containerId='highcharts-'+idCounter++;if(!renderTo){chart.renderTo=renderTo=optionsChart.renderTo;}
if(isString(renderTo)){chart.renderTo=renderTo=doc.getElementById(renderTo);}
if(!renderTo){error(13,true);}
oldChartIndex=pInt(attr(renderTo,indexAttrName));if(!isNaN(oldChartIndex)&&charts[oldChartIndex]&&charts[oldChartIndex].hasRendered){charts[oldChartIndex].destroy();}
attr(renderTo,indexAttrName,chart.index);renderTo.innerHTML='';if(!optionsChart.skipClone&&!renderTo.offsetWidth){chart.cloneRenderTo();}
chart.getChartSize();chartWidth=chart.chartWidth;chartHeight=chart.chartHeight;chart.container=container=createElement(DIV,{className:PREFIX+'container'+
(optionsChart.className?' '+optionsChart.className:''),id:containerId},extend({position:RELATIVE,overflow:HIDDEN,width:chartWidth+PX,height:chartHeight+PX,textAlign:'left',lineHeight:'normal',zIndex:0,'-webkit-tap-highlight-color':'rgba(0,0,0,0)'},optionsChart.style),chart.renderToClone||renderTo);chart._cursor=container.style.cursor;Ren=Highcharts[optionsChart.renderer]||Renderer;chart.renderer=new Ren(container,chartWidth,chartHeight,optionsChart.style,optionsChart.forExport,options.exporting&&options.exporting.allowHTML);if(useCanVG){chart.renderer.create(chart,container,chartWidth,chartHeight);}
chart.renderer.chartIndex=chart.index;},getMargins:function(skipAxes){var chart=this,spacing=chart.spacing,margin=chart.margin,titleOffset=chart.titleOffset;chart.resetMargins();if(titleOffset&&!defined(margin[0])){chart.plotTop=mathMax(chart.plotTop,titleOffset+chart.options.title.margin+spacing[0]);}
chart.legend.adjustMargins(margin,spacing);if(chart.extraBottomMargin){chart.marginBottom+=chart.extraBottomMargin;}
if(chart.extraTopMargin){chart.plotTop+=chart.extraTopMargin;}
if(!skipAxes){this.getAxisMargins();}},getAxisMargins:function(){var chart=this,axisOffset=chart.axisOffset=[0,0,0,0],margin=chart.margin;if(chart.hasCartesianSeries){each(chart.axes,function(axis){if(axis.visible){axis.getOffset();}});}
each(marginNames,function(m,side){if(!defined(margin[side])){chart[m]+=axisOffset[side];}});chart.setChartSize();},reflow:function(e){var chart=this,optionsChart=chart.options.chart,renderTo=chart.renderTo,width=optionsChart.width||getStyle(renderTo,'width'),height=optionsChart.height||getStyle(renderTo,'height'),target=e?e.target:win;if(!chart.hasUserSize&&!chart.isPrinting&&width&&height&&(target===win||target===doc)){if(width!==chart.containerWidth||height!==chart.containerHeight){clearTimeout(chart.reflowTimeout);chart.reflowTimeout=syncTimeout(function(){if(chart.container){chart.setSize(width,height,false);chart.hasUserSize=null;}},e?100:0);}
chart.containerWidth=width;chart.containerHeight=height;}},initReflow:function(){var chart=this,reflow=function(e){chart.reflow(e);};addEvent(win,'resize',reflow);addEvent(chart,'destroy',function(){removeEvent(win,'resize',reflow);});},setSize:function(width,height,animation){var chart=this,chartWidth,chartHeight,renderer=chart.renderer,globalAnimation;chart.isResizing+=1;setAnimation(animation,chart);chart.oldChartHeight=chart.chartHeight;chart.oldChartWidth=chart.chartWidth;if(defined(width)){chart.chartWidth=chartWidth=mathMax(0,mathRound(width));chart.hasUserSize=!!chartWidth;}
if(defined(height)){chart.chartHeight=chartHeight=mathMax(0,mathRound(height));}
globalAnimation=renderer.globalAnimation;(globalAnimation?animate:css)(chart.container,{width:chartWidth+PX,height:chartHeight+PX},globalAnimation);chart.setChartSize(true);renderer.setSize(chartWidth,chartHeight,animation);chart.maxTicks=null;each(chart.axes,function(axis){axis.isDirty=true;axis.setScale();});each(chart.series,function(serie){serie.isDirty=true;});chart.isDirtyLegend=true;chart.isDirtyBox=true;chart.layOutTitles();chart.getMargins();chart.redraw(animation);chart.oldChartHeight=null;fireEvent(chart,'resize');syncTimeout(function(){if(chart){fireEvent(chart,'endResize',null,function(){chart.isResizing-=1;});}},animObject(globalAnimation).duration);},setChartSize:function(skipAxes){var chart=this,inverted=chart.inverted,renderer=chart.renderer,chartWidth=chart.chartWidth,chartHeight=chart.chartHeight,optionsChart=chart.options.chart,spacing=chart.spacing,clipOffset=chart.clipOffset,clipX,clipY,plotLeft,plotTop,plotWidth,plotHeight,plotBorderWidth;chart.plotLeft=plotLeft=mathRound(chart.plotLeft);chart.plotTop=plotTop=mathRound(chart.plotTop);chart.plotWidth=plotWidth=mathMax(0,mathRound(chartWidth-plotLeft-chart.marginRight));chart.plotHeight=plotHeight=mathMax(0,mathRound(chartHeight-plotTop-chart.marginBottom));chart.plotSizeX=inverted?plotHeight:plotWidth;chart.plotSizeY=inverted?plotWidth:plotHeight;chart.plotBorderWidth=optionsChart.plotBorderWidth||0;chart.spacingBox=renderer.spacingBox={x:spacing[3],y:spacing[0],width:chartWidth-spacing[3]-spacing[1],height:chartHeight-spacing[0]-spacing[2]};chart.plotBox=renderer.plotBox={x:plotLeft,y:plotTop,width:plotWidth,height:plotHeight};plotBorderWidth=2*mathFloor(chart.plotBorderWidth/2);clipX=mathCeil(mathMax(plotBorderWidth,clipOffset[3])/2);clipY=mathCeil(mathMax(plotBorderWidth,clipOffset[0])/2);chart.clipBox={x:clipX,y:clipY,width:mathFloor(chart.plotSizeX-mathMax(plotBorderWidth,clipOffset[1])/2-clipX),height:mathMax(0,mathFloor(chart.plotSizeY-mathMax(plotBorderWidth,clipOffset[2])/2-clipY))};if(!skipAxes){each(chart.axes,function(axis){axis.setAxisSize();axis.setAxisTranslation();});}},resetMargins:function(){var chart=this;each(marginNames,function(m,side){chart[m]=pick(chart.margin[side],chart.spacing[side]);});chart.axisOffset=[0,0,0,0];chart.clipOffset=[0,0,0,0];},drawChartBox:function(){var chart=this,optionsChart=chart.options.chart,renderer=chart.renderer,chartWidth=chart.chartWidth,chartHeight=chart.chartHeight,chartBackground=chart.chartBackground,plotBackground=chart.plotBackground,plotBorder=chart.plotBorder,plotBGImage=chart.plotBGImage,chartBorderWidth=optionsChart.borderWidth||0,chartBackgroundColor=optionsChart.backgroundColor,plotBackgroundColor=optionsChart.plotBackgroundColor,plotBackgroundImage=optionsChart.plotBackgroundImage,plotBorderWidth=optionsChart.plotBorderWidth||0,mgn,bgAttr,plotLeft=chart.plotLeft,plotTop=chart.plotTop,plotWidth=chart.plotWidth,plotHeight=chart.plotHeight,plotBox=chart.plotBox,clipRect=chart.clipRect,clipBox=chart.clipBox;mgn=chartBorderWidth+(optionsChart.shadow?8:0);if(chartBorderWidth||chartBackgroundColor){if(!chartBackground){bgAttr={fill:chartBackgroundColor||NONE};if(chartBorderWidth){bgAttr.stroke=optionsChart.borderColor;bgAttr['stroke-width']=chartBorderWidth;}
chart.chartBackground=renderer.rect(mgn/2,mgn/2,chartWidth-mgn,chartHeight-mgn,optionsChart.borderRadius,chartBorderWidth).attr(bgAttr).addClass(PREFIX+'background').add().shadow(optionsChart.shadow);}else{chartBackground.animate(chartBackground.crisp({width:chartWidth-mgn,height:chartHeight-mgn}));}}
if(plotBackgroundColor){if(!plotBackground){chart.plotBackground=renderer.rect(plotLeft,plotTop,plotWidth,plotHeight,0).attr({fill:plotBackgroundColor}).add().shadow(optionsChart.plotShadow);}else{plotBackground.animate(plotBox);}}
if(plotBackgroundImage){if(!plotBGImage){chart.plotBGImage=renderer.image(plotBackgroundImage,plotLeft,plotTop,plotWidth,plotHeight).add();}else{plotBGImage.animate(plotBox);}}
if(!clipRect){chart.clipRect=renderer.clipRect(clipBox);}else{clipRect.animate({width:clipBox.width,height:clipBox.height});}
if(plotBorderWidth){if(!plotBorder){chart.plotBorder=renderer.rect(plotLeft,plotTop,plotWidth,plotHeight,0,-plotBorderWidth).attr({stroke:optionsChart.plotBorderColor,'stroke-width':plotBorderWidth,fill:NONE,zIndex:1}).add();}else{plotBorder.strokeWidth=-plotBorderWidth;plotBorder.animate(plotBorder.crisp({x:plotLeft,y:plotTop,width:plotWidth,height:plotHeight}));}}
chart.isDirtyBox=false;},propFromSeries:function(){var chart=this,optionsChart=chart.options.chart,klass,seriesOptions=chart.options.series,i,value;each(['inverted','angular','polar'],function(key){klass=seriesTypes[optionsChart.type||optionsChart.defaultSeriesType];value=(chart[key]||optionsChart[key]||(klass&&klass.prototype[key]));i=seriesOptions&&seriesOptions.length;while(!value&&i--){klass=seriesTypes[seriesOptions[i].type];if(klass&&klass.prototype[key]){value=true;}}
chart[key]=value;});},linkSeries:function(){var chart=this,chartSeries=chart.series;each(chartSeries,function(series){series.linkedSeries.length=0;});each(chartSeries,function(series){var linkedTo=series.options.linkedTo;if(isString(linkedTo)){if(linkedTo===':previous'){linkedTo=chart.series[series.index-1];}else{linkedTo=chart.get(linkedTo);}
if(linkedTo){linkedTo.linkedSeries.push(series);series.linkedParent=linkedTo;series.visible=pick(series.options.visible,linkedTo.options.visible,series.visible);}}});},renderSeries:function(){each(this.series,function(serie){serie.translate();serie.render();});},renderLabels:function(){var chart=this,labels=chart.options.labels;if(labels.items){each(labels.items,function(label){var style=extend(labels.style,label.style),x=pInt(style.left)+chart.plotLeft,y=pInt(style.top)+chart.plotTop+12;delete style.left;delete style.top;chart.renderer.text(label.html,x,y).attr({zIndex:2}).css(style).add();});}},render:function(){var chart=this,axes=chart.axes,renderer=chart.renderer,options=chart.options,tempWidth,tempHeight,redoHorizontal,redoVertical;chart.setTitle();chart.legend=new Legend(chart,options.legend);if(chart.getStacks){chart.getStacks();}
chart.getMargins(true);chart.setChartSize();tempWidth=chart.plotWidth;tempHeight=chart.plotHeight=chart.plotHeight-21;each(axes,function(axis){axis.setScale();});chart.getAxisMargins();redoHorizontal=tempWidth/chart.plotWidth>1.1;redoVertical=tempHeight/chart.plotHeight>1.05;if(redoHorizontal||redoVertical){chart.maxTicks=null;each(axes,function(axis){if((axis.horiz&&redoHorizontal)||(!axis.horiz&&redoVertical)){axis.setTickInterval(true);}});chart.getMargins();}
chart.drawChartBox();if(chart.hasCartesianSeries){each(axes,function(axis){if(axis.visible){axis.render();}});}
if(!chart.seriesGroup){chart.seriesGroup=renderer.g('series-group').attr({zIndex:3}).add();}
chart.renderSeries();chart.renderLabels();chart.showCredits(options.credits);chart.hasRendered=true;},showCredits:function(credits){if(credits.enabled&&!this.credits){this.credits=this.renderer.text(credits.text,0,0).on('click',function(){if(credits.href){win.location.href=credits.href;}}).attr({align:credits.position.align,zIndex:8}).css(credits.style).add().align(credits.position);}},destroy:function(){var chart=this,axes=chart.axes,series=chart.series,container=chart.container,i,parentNode=container&&container.parentNode;fireEvent(chart,'destroy');charts[chart.index]=UNDEFINED;chartCount--;chart.renderTo.removeAttribute('data-highcharts-chart');removeEvent(chart);i=axes.length;while(i--){axes[i]=axes[i].destroy();}
i=series.length;while(i--){series[i]=series[i].destroy();}
each(['title','subtitle','chartBackground','plotBackground','plotBGImage','plotBorder','seriesGroup','clipRect','credits','pointer','scroller','rangeSelector','legend','resetZoomButton','tooltip','renderer'],function(name){var prop=chart[name];if(prop&&prop.destroy){chart[name]=prop.destroy();}});if(container){container.innerHTML='';removeEvent(container);if(parentNode){discardElement(container);}}
for(i in chart){delete chart[i];}},isReadyToRender:function(){var chart=this;if((!hasSVG&&(win==win.top&&doc.readyState!=='complete'))||(useCanVG&&!win.canvg)){if(useCanVG){CanVGController.push(function(){chart.firstRender();},chart.options.global.canvasToolsURL);}else{doc.attachEvent('onreadystatechange',function(){doc.detachEvent('onreadystatechange',chart.firstRender);if(doc.readyState==='complete'){chart.firstRender();}});}
return false;}
return true;},firstRender:function(){var chart=this,options=chart.options;if(!chart.isReadyToRender()){return;}
chart.getContainer();fireEvent(chart,'init');chart.resetMargins();chart.setChartSize();chart.propFromSeries();chart.getAxes();each(options.series||[],function(serieOptions){chart.initSeries(serieOptions);});chart.linkSeries();fireEvent(chart,'beforeRender');if(Highcharts.Pointer){chart.pointer=new Pointer(chart,options);}
chart.render();chart.renderer.draw();if(!chart.renderer.imgCount&&chart.onload){chart.onload();}
chart.cloneRenderTo(true);},onload:function(){var chart=this;each([this.callback].concat(this.callbacks),function(fn){if(fn&&chart.index!==undefined){fn.apply(chart,[chart]);}});fireEvent(chart,'load');this.onload=null;},splashArray:function(target,options){var oVar=options[target],tArray=isObject(oVar)?oVar:[oVar,oVar,oVar,oVar];return[pick(options[target+'Top'],tArray[0]),pick(options[target+'Right'],tArray[1]),pick(options[target+'Bottom'],tArray[2]),pick(options[target+'Left'],tArray[3])];}};var CenteredSeriesMixin=Highcharts.CenteredSeriesMixin={getCenter:function(){var options=this.options,chart=this.chart,slicingRoom=2*(options.slicedOffset||0),handleSlicingRoom,plotWidth=chart.plotWidth-2*slicingRoom,plotHeight=chart.plotHeight-2*slicingRoom,centerOption=options.center,positions=[pick(centerOption[0],'50%'),pick(centerOption[1],'50%'),options.size||'100%',options.innerSize||0],smallestSize=mathMin(plotWidth,plotHeight),i,value;for(i=0;i<4;++i){value=positions[i];handleSlicingRoom=i<2||(i===2&&/%$/.test(value));positions[i]=relativeLength(value,[plotWidth,plotHeight,smallestSize,positions[2]][i])+
(handleSlicingRoom?slicingRoom:0);}
if(positions[3]>positions[2]){positions[3]=positions[2];}
return positions;}};var Point=function(){};Point.prototype={init:function(series,options,x){var point=this,colors;point.series=series;point.color=series.color;point.applyOptions(options,x);point.pointAttr={};if(series.options.colorByPoint){colors=series.options.colors||series.chart.options.colors;point.color=point.color||colors[series.colorCounter++];if(series.colorCounter===colors.length){series.colorCounter=0;}}
series.chart.pointCount++;return point;},applyOptions:function(options,x){var point=this,series=point.series,pointValKey=series.options.pointValKey||series.pointValKey;options=Point.prototype.optionsToObject.call(this,options);extend(point,options);point.options=point.options?extend(point.options,options):options;if(pointValKey){point.y=point[pointValKey];}
point.isNull=point.y===null;if(point.x===undefined&&series){point.x=x===undefined?series.autoIncrement():x;}
return point;},optionsToObject:function(options){var ret={},series=this.series,keys=series.options.keys,pointArrayMap=keys||series.pointArrayMap||['y'],valueCount=pointArrayMap.length,firstItemType,i=0,j=0;if(typeof options==='number'||options===null){ret[pointArrayMap[0]]=options;}else if(isArray(options)){if(!keys&&options.length>valueCount){firstItemType=typeof options[0];if(firstItemType==='string'){ret.name=options[0];}else if(firstItemType==='number'){ret.x=options[0];}
i++;}
while(j<valueCount){if(!keys||options[i]!==undefined){ret[pointArrayMap[j]]=options[i];}
i++;j++;}}else if(typeof options==='object'){ret=options;if(options.dataLabels){series._hasPointLabels=true;}
if(options.marker){series._hasPointMarkers=true;}}
return ret;},destroy:function(){var point=this,series=point.series,chart=series.chart,hoverPoints=chart.hoverPoints,prop;chart.pointCount--;if(hoverPoints){point.setState();erase(hoverPoints,point);if(!hoverPoints.length){chart.hoverPoints=null;}}
if(point===chart.hoverPoint){point.onMouseOut();}
if(point.graphic||point.dataLabel){removeEvent(point);point.destroyElements();}
if(point.legendItem){chart.legend.destroyItem(point);}
for(prop in point){point[prop]=null;}},destroyElements:function(){var point=this,props=['graphic','dataLabel','dataLabelUpper','connector','shadowGroup'],prop,i=6;while(i--){prop=props[i];if(point[prop]){point[prop]=point[prop].destroy();}}},getLabelConfig:function(){return{x:this.category,y:this.y,color:this.color,key:this.name||this.category,series:this.series,point:this,percentage:this.percentage,total:this.total||this.stackTotal};},tooltipFormatter:function(pointFormat){var series=this.series,seriesTooltipOptions=series.tooltipOptions,valueDecimals=pick(seriesTooltipOptions.valueDecimals,''),valuePrefix=seriesTooltipOptions.valuePrefix||'',valueSuffix=seriesTooltipOptions.valueSuffix||'';each(series.pointArrayMap||['y'],function(key){key='{point.'+key;if(valuePrefix||valueSuffix){pointFormat=pointFormat.replace(key+'}',valuePrefix+key+'}'+valueSuffix);}
pointFormat=pointFormat.replace(key+'}',key+':,.'+valueDecimals+'f}');});return format(pointFormat,{point:this,series:this.series});},firePointEvent:function(eventType,eventArgs,defaultFunction){var point=this,series=this.series,seriesOptions=series.options;if(seriesOptions.point.events[eventType]||(point.options&&point.options.events&&point.options.events[eventType])){this.importEvents();}
if(eventType==='click'&&seriesOptions.allowPointSelect){defaultFunction=function(event){if(point.select){point.select(null,event.ctrlKey||event.metaKey||event.shiftKey);}};}
fireEvent(this,eventType,eventArgs,defaultFunction);},visible:true};var Series=Highcharts.Series=function(){};Series.prototype={isCartesian:true,type:'line',pointClass:Point,sorted:true,requireSorting:true,pointAttrToOptions:{stroke:'lineColor','stroke-width':'lineWidth',fill:'fillColor',r:'radius'},directTouch:false,axisTypes:['xAxis','yAxis'],colorCounter:0,parallelArrays:['x','y'],init:function(chart,options){var series=this,eventType,events,chartSeries=chart.series,sortByIndex=function(a,b){return pick(a.options.index,a._i)-pick(b.options.index,b._i);};series.chart=chart;series.options=options=series.setOptions(options);series.linkedSeries=[];series.bindAxes();extend(series,{name:options.name,state:NORMAL_STATE,pointAttr:{},visible:options.visible!==false,selected:options.selected===true});if(useCanVG){options.animation=false;}
events=options.events;for(eventType in events){addEvent(series,eventType,events[eventType]);}
if((events&&events.click)||(options.point&&options.point.events&&options.point.events.click)||options.allowPointSelect){chart.runTrackerClick=true;}
series.getColor();series.getSymbol();each(series.parallelArrays,function(key){series[key+'Data']=[];});series.setData(options.data,false);if(series.isCartesian){chart.hasCartesianSeries=true;}
chartSeries.push(series);series._i=chartSeries.length-1;stableSort(chartSeries,sortByIndex);if(this.yAxis){stableSort(this.yAxis.series,sortByIndex);}
each(chartSeries,function(series,i){series.index=i;series.name=series.name||'Series '+(i+1);});},bindAxes:function(){var series=this,seriesOptions=series.options,chart=series.chart,axisOptions;each(series.axisTypes||[],function(AXIS){each(chart[AXIS],function(axis){axisOptions=axis.options;if((seriesOptions[AXIS]===axisOptions.index)||(seriesOptions[AXIS]!==UNDEFINED&&seriesOptions[AXIS]===axisOptions.id)||(seriesOptions[AXIS]===UNDEFINED&&axisOptions.index===0)){axis.series.push(series);series[AXIS]=axis;axis.isDirty=true;}});if(!series[AXIS]&&series.optionalAxis!==AXIS){error(18,true);}});},updateParallelArrays:function(point,i){var series=point.series,args=arguments,fn=typeof i==='number'?function(key){var val=key==='y'&&series.toYData?series.toYData(point):point[key];series[key+'Data'][i]=val;}:function(key){Array.prototype[i].apply(series[key+'Data'],Array.prototype.slice.call(args,2));};each(series.parallelArrays,fn);},autoIncrement:function(){var options=this.options,xIncrement=this.xIncrement,date,pointInterval,pointIntervalUnit=options.pointIntervalUnit;xIncrement=pick(xIncrement,options.pointStart,0);this.pointInterval=pointInterval=pick(this.pointInterval,options.pointInterval,1);if(pointIntervalUnit){date=new Date(xIncrement);if(pointIntervalUnit==='day'){date=+date[setDate](date[getDate]()+pointInterval);}else if(pointIntervalUnit==='month'){date=+date[setMonth](date[getMonth]()+pointInterval);}else if(pointIntervalUnit==='year'){date=+date[setFullYear](date[getFullYear]()+pointInterval);}
pointInterval=date-xIncrement;}
this.xIncrement=xIncrement+pointInterval;return xIncrement;},setOptions:function(itemOptions){var chart=this.chart,chartOptions=chart.options,plotOptions=chartOptions.plotOptions,userOptions=chart.userOptions||{},userPlotOptions=userOptions.plotOptions||{},typeOptions=plotOptions[this.type],options,zones;this.userOptions=itemOptions;options=merge(typeOptions,plotOptions.series,itemOptions);this.tooltipOptions=merge(defaultOptions.tooltip,defaultOptions.plotOptions[this.type].tooltip,userOptions.tooltip,userPlotOptions.series&&userPlotOptions.series.tooltip,userPlotOptions[this.type]&&userPlotOptions[this.type].tooltip,itemOptions.tooltip);if(typeOptions.marker===null){delete options.marker;}
this.zoneAxis=options.zoneAxis;zones=this.zones=(options.zones||[]).slice();if((options.negativeColor||options.negativeFillColor)&&!options.zones){zones.push({value:options[this.zoneAxis+'Threshold']||options.threshold||0,color:options.negativeColor,fillColor:options.negativeFillColor});}
if(zones.length){if(defined(zones[zones.length-1].value)){zones.push({color:this.color,fillColor:this.fillColor});}}
return options;},getCyclic:function(prop,value,defaults){var i,userOptions=this.userOptions,indexName='_'+prop+'Index',counterName=prop+'Counter';if(!value){if(defined(userOptions[indexName])){i=userOptions[indexName];}else{userOptions[indexName]=i=this.chart[counterName]%defaults.length;this.chart[counterName]+=1;}
value=defaults[i];}
this[prop]=value;},getColor:function(){if(this.options.colorByPoint){this.options.color=null;}else{this.getCyclic('color',this.options.color||defaultPlotOptions[this.type].color,this.chart.options.colors);}},getSymbol:function(){var seriesMarkerOption=this.options.marker;this.getCyclic('symbol',seriesMarkerOption.symbol,this.chart.options.symbols);if(/^url/.test(this.symbol)){seriesMarkerOption.radius=0;}},drawLegendSymbol:LegendSymbolMixin.drawLineMarker,setData:function(data,redraw,animation,updatePoints){var series=this,oldData=series.points,oldDataLength=(oldData&&oldData.length)||0,dataLength,options=series.options,chart=series.chart,firstPoint=null,xAxis=series.xAxis,hasCategories=xAxis&&!!xAxis.categories,i,turboThreshold=options.turboThreshold,pt,xData=this.xData,yData=this.yData,pointArrayMap=series.pointArrayMap,valueCount=pointArrayMap&&pointArrayMap.length;data=data||[];dataLength=data.length;redraw=pick(redraw,true);if(updatePoints!==false&&dataLength&&oldDataLength===dataLength&&!series.cropped&&!series.hasGroupedData&&series.visible){each(data,function(point,i){if(oldData[i].update&&point!==options.data[i]){oldData[i].update(point,false,null,false);}});}else{series.xIncrement=null;series.colorCounter=0;each(this.parallelArrays,function(key){series[key+'Data'].length=0;});if(turboThreshold&&dataLength>turboThreshold){i=0;while(firstPoint===null&&i<dataLength){firstPoint=data[i];i++;}
if(isNumber(firstPoint)){var x=pick(options.pointStart,0),pointInterval=pick(options.pointInterval,1);for(i=0;i<dataLength;i++){xData[i]=x;yData[i]=data[i];x+=pointInterval;}
series.xIncrement=x;}else if(isArray(firstPoint)){if(valueCount){for(i=0;i<dataLength;i++){pt=data[i];xData[i]=pt[0];yData[i]=pt.slice(1,valueCount+1);}}else{for(i=0;i<dataLength;i++){pt=data[i];xData[i]=pt[0];yData[i]=pt[1];}}}else{error(12);}}else{for(i=0;i<dataLength;i++){if(data[i]!==UNDEFINED){pt={series:series};series.pointClass.prototype.applyOptions.apply(pt,[data[i]]);series.updateParallelArrays(pt,i);if(hasCategories&&defined(pt.name)){xAxis.names[pt.x]=pt.name;}}}}
if(isString(yData[0])){error(14,true);}
series.data=[];series.options.data=series.userOptions.data=data;i=oldDataLength;while(i--){if(oldData[i]&&oldData[i].destroy){oldData[i].destroy();}}
if(xAxis){xAxis.minRange=xAxis.userMinRange;}
series.isDirty=series.isDirtyData=chart.isDirtyBox=true;animation=false;}
if(options.legendType==='point'){this.processData();this.generatePoints();}
if(redraw){chart.redraw(animation);}},processData:function(force){var series=this,processedXData=series.xData,processedYData=series.yData,dataLength=processedXData.length,croppedData,cropStart=0,cropped,distance,closestPointRange,xAxis=series.xAxis,i,options=series.options,cropThreshold=options.cropThreshold,getExtremesFromAll=series.getExtremesFromAll||options.getExtremesFromAll,isCartesian=series.isCartesian,xExtremes,val2lin=xAxis&&xAxis.val2lin,isLog=xAxis&&xAxis.isLog,min,max;if(isCartesian&&!series.isDirty&&!xAxis.isDirty&&!series.yAxis.isDirty&&!force){return false;}
if(xAxis){xExtremes=xAxis.getExtremes();min=xExtremes.min;max=xExtremes.max;}
if(isCartesian&&series.sorted&&!getExtremesFromAll&&(!cropThreshold||dataLength>cropThreshold||series.forceCrop)){if(processedXData[dataLength-1]<min||processedXData[0]>max){processedXData=[];processedYData=[];}else if(processedXData[0]<min||processedXData[dataLength-1]>max){croppedData=this.cropData(series.xData,series.yData,min,max);processedXData=croppedData.xData;processedYData=croppedData.yData;cropStart=croppedData.start;cropped=true;}}
i=processedXData.length||1;while(--i){distance=isLog?val2lin(processedXData[i])-val2lin(processedXData[i-1]):processedXData[i]-processedXData[i-1];if(distance>0&&(closestPointRange===UNDEFINED||distance<closestPointRange)){closestPointRange=distance;}else if(distance<0&&series.requireSorting){error(15);}}
series.cropped=cropped;series.cropStart=cropStart;series.processedXData=processedXData;series.processedYData=processedYData;series.closestPointRange=closestPointRange;},cropData:function(xData,yData,min,max){var dataLength=xData.length,cropStart=0,cropEnd=dataLength,cropShoulder=pick(this.cropShoulder,1),i,j;for(i=0;i<dataLength;i++){if(xData[i]>=min){cropStart=mathMax(0,i-cropShoulder);break;}}
for(j=i;j<dataLength;j++){if(xData[j]>max){cropEnd=j+cropShoulder;break;}}
return{xData:xData.slice(cropStart,cropEnd),yData:yData.slice(cropStart,cropEnd),start:cropStart,end:cropEnd};},generatePoints:function(){var series=this,options=series.options,dataOptions=options.data,data=series.data,dataLength,processedXData=series.processedXData,processedYData=series.processedYData,pointClass=series.pointClass,processedDataLength=processedXData.length,cropStart=series.cropStart||0,cursor,hasGroupedData=series.hasGroupedData,point,points=[],i;if(!data&&!hasGroupedData){var arr=[];arr.length=dataOptions.length;data=series.data=arr;}
for(i=0;i<processedDataLength;i++){cursor=cropStart+i;if(!hasGroupedData){if(data[cursor]){point=data[cursor];}else if(dataOptions[cursor]!==UNDEFINED){data[cursor]=point=(new pointClass()).init(series,dataOptions[cursor],processedXData[i]);}
points[i]=point;}else{points[i]=(new pointClass()).init(series,[processedXData[i]].concat(splat(processedYData[i])));points[i].dataGroup=series.groupMap[i];}
points[i].index=cursor;}
if(data&&(processedDataLength!==(dataLength=data.length)||hasGroupedData)){for(i=0;i<dataLength;i++){if(i===cropStart&&!hasGroupedData){i+=processedDataLength;}
if(data[i]){data[i].destroyElements();data[i].plotX=UNDEFINED;}}}
series.data=data;series.points=points;},getExtremes:function(yData){var xAxis=this.xAxis,yAxis=this.yAxis,xData=this.processedXData,yDataLength,activeYData=[],activeCounter=0,xExtremes=xAxis.getExtremes(),xMin=xExtremes.min,xMax=xExtremes.max,validValue,withinRange,x,y,i,j;yData=yData||this.stackedYData||this.processedYData;yDataLength=yData.length;for(i=0;i<yDataLength;i++){x=xData[i];y=yData[i];validValue=y!==null&&y!==UNDEFINED&&(!yAxis.isLog||(y.length||y>0));withinRange=this.getExtremesFromAll||this.options.getExtremesFromAll||this.cropped||((xData[i+1]||x)>=xMin&&(xData[i-1]||x)<=xMax);if(validValue&&withinRange){j=y.length;if(j){while(j--){if(y[j]!==null){activeYData[activeCounter++]=y[j];}}}else{activeYData[activeCounter++]=y;}}}
this.dataMin=arrayMin(activeYData);this.dataMax=arrayMax(activeYData);},translate:function(){if(!this.processedXData){this.processData();}
this.generatePoints();var series=this,options=series.options,stacking=options.stacking,xAxis=series.xAxis,categories=xAxis.categories,yAxis=series.yAxis,points=series.points,dataLength=points.length,hasModifyValue=!!series.modifyValue,i,pointPlacement=options.pointPlacement,dynamicallyPlaced=pointPlacement==='between'||isNumber(pointPlacement),threshold=options.threshold,stackThreshold=options.startFromThreshold?threshold:0,plotX,plotY,lastPlotX,stackIndicator,closestPointRangePx=Number.MAX_VALUE;for(i=0;i<dataLength;i++){var point=points[i],xValue=point.x,yValue=point.y,yBottom=point.low,stack=stacking&&yAxis.stacks[(series.negStacks&&yValue<(stackThreshold?0:threshold)?'-':'')+series.stackKey],pointStack,stackValues;if(yAxis.isLog&&yValue!==null&&yValue<=0){point.y=yValue=null;error(10);}
point.plotX=plotX=mathMin(mathMax(-1e5,xAxis.translate(xValue,0,0,0,1,pointPlacement,this.type==='flags')),1e5);if(stacking&&series.visible&&!point.isNull&&stack&&stack[xValue]){stackIndicator=series.getStackIndicator(stackIndicator,xValue,series.index);pointStack=stack[xValue];stackValues=pointStack.points[stackIndicator.key];yBottom=stackValues[0];yValue=stackValues[1];if(yBottom===stackThreshold){yBottom=pick(threshold,yAxis.min);}
if(yAxis.isLog&&yBottom<=0){yBottom=null;}
point.total=point.stackTotal=pointStack.total;point.percentage=pointStack.total&&(point.y/pointStack.total*100);point.stackY=yValue;pointStack.setOffset(series.pointXOffset||0,series.barW||0);}
point.yBottom=defined(yBottom)?yAxis.translate(yBottom,0,1,0,1):null;if(hasModifyValue){yValue=series.modifyValue(yValue,point);}
point.plotY=plotY=(typeof yValue==='number'&&yValue!==Infinity)?mathMin(mathMax(-1e5,yAxis.translate(yValue,0,1,0,1)),1e5):UNDEFINED;point.isInside=plotY!==UNDEFINED&&plotY>=0&&plotY<=yAxis.len&&plotX>=0&&plotX<=xAxis.len;point.clientX=dynamicallyPlaced?xAxis.translate(xValue,0,0,0,1):plotX;point.negative=point.y<(threshold||0);point.category=categories&&categories[point.x]!==UNDEFINED?categories[point.x]:point.x;if(!point.isNull){if(lastPlotX!==undefined){closestPointRangePx=mathMin(closestPointRangePx,mathAbs(plotX-lastPlotX));}
lastPlotX=plotX;}}
series.closestPointRangePx=closestPointRangePx;},getValidPoints:function(points,insideOnly){var chart=this.chart;return grep(points||this.points||[],function isValidPoint(point){if(insideOnly&&!chart.isInsidePlot(point.plotX,point.plotY,chart.inverted)){return false;}
return!point.isNull;});},setClip:function(animation){var chart=this.chart,options=this.options,renderer=chart.renderer,inverted=chart.inverted,seriesClipBox=this.clipBox,clipBox=seriesClipBox||chart.clipBox,sharedClipKey=this.sharedClipKey||['_sharedClip',animation&&animation.duration,animation&&animation.easing,clipBox.height,options.xAxis,options.yAxis].join(','),clipRect=chart[sharedClipKey],markerClipRect=chart[sharedClipKey+'m'];if(!clipRect){if(animation){clipBox.width=0;chart[sharedClipKey+'m']=markerClipRect=renderer.clipRect(-99,inverted?-chart.plotLeft:-chart.plotTop,99,inverted?chart.chartWidth:chart.chartHeight);}
chart[sharedClipKey]=clipRect=renderer.clipRect(clipBox);}
if(animation){clipRect.count+=1;}
if(options.clip!==false){this.group.clip(animation||seriesClipBox?clipRect:chart.clipRect);this.markerGroup.clip(markerClipRect);this.sharedClipKey=sharedClipKey;}
if(!animation){clipRect.count-=1;if(clipRect.count<=0&&sharedClipKey&&chart[sharedClipKey]){if(!seriesClipBox){chart[sharedClipKey]=chart[sharedClipKey].destroy();}
if(chart[sharedClipKey+'m']){chart[sharedClipKey+'m']=chart[sharedClipKey+'m'].destroy();}}}},animate:function(init){var series=this,chart=series.chart,clipRect,animation=series.options.animation,sharedClipKey;if(animation&&!isObject(animation)){animation=defaultPlotOptions[series.type].animation;}
if(init){series.setClip(animation);}else{sharedClipKey=this.sharedClipKey;clipRect=chart[sharedClipKey];if(clipRect){clipRect.animate({width:chart.plotSizeX},animation);}
if(chart[sharedClipKey+'m']){chart[sharedClipKey+'m'].animate({width:chart.plotSizeX+99},animation);}
series.animate=null;}},afterAnimate:function(){this.setClip();fireEvent(this,'afterAnimate');},drawPoints:function(){var series=this,pointAttr,points=series.points,chart=series.chart,plotX,plotY,i,point,radius,symbol,isImage,graphic,options=series.options,seriesMarkerOptions=options.marker,seriesPointAttr=series.pointAttr[''],pointMarkerOptions,hasPointMarker,enabled,isInside,markerGroup=series.markerGroup,xAxis=series.xAxis,globallyEnabled=pick(seriesMarkerOptions.enabled,xAxis.isRadial,series.closestPointRangePx>2*seriesMarkerOptions.radius);if(seriesMarkerOptions.enabled!==false||series._hasPointMarkers){i=points.length;while(i--){point=points[i];plotX=mathFloor(point.plotX);plotY=point.plotY;graphic=point.graphic;pointMarkerOptions=point.marker||{};hasPointMarker=!!point.marker;enabled=(globallyEnabled&&pointMarkerOptions.enabled===UNDEFINED)||pointMarkerOptions.enabled;isInside=point.isInside;if(enabled&&plotY!==UNDEFINED&&!isNaN(plotY)&&point.y!==null){pointAttr=point.pointAttr[point.selected?SELECT_STATE:NORMAL_STATE]||seriesPointAttr;radius=pointAttr.r;symbol=pick(pointMarkerOptions.symbol,series.symbol);isImage=symbol.indexOf('url')===0;if(graphic){graphic[isInside?'show':'hide'](true).attr(pointAttr).animate(extend({x:plotX-radius,y:plotY-radius},graphic.symbolName?{width:2*radius,height:2*radius}:{}));}else if(isInside&&(radius>0||isImage)){point.graphic=graphic=chart.renderer.symbol(symbol,plotX-radius,plotY-radius,2*radius,2*radius,hasPointMarker?pointMarkerOptions:seriesMarkerOptions).attr(pointAttr).add(markerGroup);}}else if(graphic){point.graphic=graphic.destroy();}}}},convertAttribs:function(options,base1,base2,base3){var conversion=this.pointAttrToOptions,attr,option,obj={};options=options||{};base1=base1||{};base2=base2||{};base3=base3||{};for(attr in conversion){option=conversion[attr];obj[attr]=pick(options[option],base1[attr],base2[attr],base3[attr]);}
return obj;},getAttribs:function(){var series=this,seriesOptions=series.options,normalOptions=defaultPlotOptions[series.type].marker?seriesOptions.marker:seriesOptions,stateOptions=normalOptions.states,stateOptionsHover=stateOptions[HOVER_STATE],pointStateOptionsHover,seriesColor=series.color,seriesNegativeColor=series.options.negativeColor,normalDefaults={stroke:seriesColor,fill:seriesColor},points=series.points||[],i,j,threshold,point,seriesPointAttr=[],pointAttr,pointAttrToOptions=series.pointAttrToOptions,hasPointSpecificOptions=series.hasPointSpecificOptions,defaultLineColor=normalOptions.lineColor,defaultFillColor=normalOptions.fillColor,turboThreshold=seriesOptions.turboThreshold,zones=series.zones,zoneAxis=series.zoneAxis||'y',attr,key;if(seriesOptions.marker){stateOptionsHover.radius=stateOptionsHover.radius||normalOptions.radius+stateOptionsHover.radiusPlus;stateOptionsHover.lineWidth=stateOptionsHover.lineWidth||normalOptions.lineWidth+stateOptionsHover.lineWidthPlus;}else{stateOptionsHover.color=stateOptionsHover.color||Color(stateOptionsHover.color||seriesColor).brighten(stateOptionsHover.brightness).get();stateOptionsHover.negativeColor=stateOptionsHover.negativeColor||Color(stateOptionsHover.negativeColor||seriesNegativeColor).brighten(stateOptionsHover.brightness).get();}
seriesPointAttr[NORMAL_STATE]=series.convertAttribs(normalOptions,normalDefaults);each([HOVER_STATE,SELECT_STATE],function(state){seriesPointAttr[state]=series.convertAttribs(stateOptions[state],seriesPointAttr[NORMAL_STATE]);});series.pointAttr=seriesPointAttr;i=points.length;if(!turboThreshold||i<turboThreshold||hasPointSpecificOptions){while(i--){point=points[i];normalOptions=(point.options&&point.options.marker)||point.options;if(normalOptions&&normalOptions.enabled===false){normalOptions.radius=0;}
if(zones.length){j=0;threshold=zones[j];while(point[zoneAxis]>=threshold.value){threshold=zones[++j];}
point.color=point.fillColor=pick(threshold.color,series.color);}
hasPointSpecificOptions=seriesOptions.colorByPoint||point.color;if(point.options){for(key in pointAttrToOptions){if(defined(normalOptions[pointAttrToOptions[key]])){hasPointSpecificOptions=true;}}}
if(hasPointSpecificOptions){normalOptions=normalOptions||{};pointAttr=[];stateOptions=normalOptions.states||{};pointStateOptionsHover=stateOptions[HOVER_STATE]=stateOptions[HOVER_STATE]||{};if(!seriesOptions.marker||(point.negative&&!pointStateOptionsHover.fillColor&&!stateOptionsHover.fillColor)){pointStateOptionsHover[series.pointAttrToOptions.fill]=pointStateOptionsHover.color||(!point.options.color&&stateOptionsHover[(point.negative&&seriesNegativeColor?'negativeColor':'color')])||Color(point.color).brighten(pointStateOptionsHover.brightness||stateOptionsHover.brightness).get();}
attr={color:point.color};if(!defaultFillColor){attr.fillColor=point.color;}
if(!defaultLineColor){attr.lineColor=point.color;}
if(normalOptions.hasOwnProperty('color')&&!normalOptions.color){delete normalOptions.color;}
pointAttr[NORMAL_STATE]=series.convertAttribs(extend(attr,normalOptions),seriesPointAttr[NORMAL_STATE]);pointAttr[HOVER_STATE]=series.convertAttribs(stateOptions[HOVER_STATE],seriesPointAttr[HOVER_STATE],pointAttr[NORMAL_STATE]);pointAttr[SELECT_STATE]=series.convertAttribs(stateOptions[SELECT_STATE],seriesPointAttr[SELECT_STATE],pointAttr[NORMAL_STATE]);}else{pointAttr=seriesPointAttr;}
point.pointAttr=pointAttr;}}},destroy:function(){var series=this,chart=series.chart,issue134=/AppleWebKit\/533/.test(userAgent),destroy,i,data=series.data||[],point,prop,axis;fireEvent(series,'destroy');removeEvent(series);each(series.axisTypes||[],function(AXIS){axis=series[AXIS];if(axis){erase(axis.series,series);axis.isDirty=axis.forceRedraw=true;}});if(series.legendItem){series.chart.legend.destroyItem(series);}
i=data.length;while(i--){point=data[i];if(point&&point.destroy){point.destroy();}}
series.points=null;clearTimeout(series.animationTimeout);for(prop in series){if(series[prop]instanceof SVGElement&&!series[prop].survive){destroy=issue134&&prop==='group'?'hide':'destroy';series[prop][destroy]();}}
if(chart.hoverSeries===series){chart.hoverSeries=null;}
erase(chart.series,series);for(prop in series){delete series[prop];}},getGraphPath:function(points,nullsAsZeroes,connectCliffs){var series=this,options=series.options,step=options.step,reversed,graphPath=[],gap;points=points||series.points;reversed=points.reversed;if(reversed){points.reverse();}
step={right:1,center:2}[step]||(step&&3);if(step&&reversed){step=4-step;}
if(options.connectNulls&&!nullsAsZeroes&&!connectCliffs){points=this.getValidPoints(points);}
each(points,function(point,i){var plotX=point.plotX,plotY=point.plotY,lastPoint=points[i-1],pathToPoint;if((point.leftCliff||(lastPoint&&lastPoint.rightCliff))&&!connectCliffs){gap=true;}
if(point.isNull&&!defined(nullsAsZeroes)&&i>0){gap=!options.connectNulls;}else if(point.isNull&&!nullsAsZeroes){gap=true;}else{if(i===0||gap){pathToPoint=[M,point.plotX,point.plotY];}else if(series.getPointSpline){pathToPoint=series.getPointSpline(points,point,i);}else if(step){if(step===1){pathToPoint=[L,lastPoint.plotX,plotY];}else if(step===2){pathToPoint=[L,(lastPoint.plotX+plotX)/2,lastPoint.plotY,L,(lastPoint.plotX+plotX)/2,plotY];}else{pathToPoint=[L,plotX,lastPoint.plotY];}
pathToPoint.push(L,plotX,plotY);}else{pathToPoint=[L,plotX,plotY];}
graphPath.push.apply(graphPath,pathToPoint);gap=false;}});series.graphPath=graphPath;return graphPath;},drawGraph:function(){var series=this,options=this.options,props=[['graph',options.lineColor||this.color,options.dashStyle]],lineWidth=options.lineWidth,roundCap=options.linecap!=='square',graphPath=(this.gappedPath||this.getGraphPath).call(this),fillColor=(this.fillGraph&&this.color)||NONE,zones=this.zones;each(zones,function(threshold,i){props.push(['zoneGraph'+i,threshold.color||series.color,threshold.dashStyle||options.dashStyle]);});each(props,function(prop,i){var graphKey=prop[0],graph=series[graphKey],attribs;if(graph){graph.animate({d:graphPath});}else if((lineWidth||fillColor)&&graphPath.length){attribs={stroke:prop[1],'stroke-width':lineWidth,fill:fillColor,zIndex:1};if(prop[2]){attribs.dashstyle=prop[2];}else if(roundCap){attribs['stroke-linecap']=attribs['stroke-linejoin']='round';}
series[graphKey]=series.chart.renderer.path(graphPath).attr(attribs).add(series.group).shadow((i<2)&&options.shadow);}});},applyZones:function(){var series=this,chart=this.chart,renderer=chart.renderer,zones=this.zones,translatedFrom,translatedTo,clips=this.clips||[],clipAttr,graph=this.graph,area=this.area,chartSizeMax=mathMax(chart.chartWidth,chart.chartHeight),axis=this[(this.zoneAxis||'y')+'Axis'],extremes,reversed=axis.reversed,inverted=chart.inverted,horiz=axis.horiz,pxRange,pxPosMin,pxPosMax,ignoreZones=false;if(zones.length&&(graph||area)&&axis.min!==UNDEFINED){if(graph){graph.hide();}
if(area){area.hide();}
extremes=axis.getExtremes();each(zones,function(threshold,i){translatedFrom=reversed?(horiz?chart.plotWidth:0):(horiz?0:axis.toPixels(extremes.min));translatedFrom=mathMin(mathMax(pick(translatedTo,translatedFrom),0),chartSizeMax);translatedTo=mathMin(mathMax(mathRound(axis.toPixels(pick(threshold.value,extremes.max),true)),0),chartSizeMax);if(ignoreZones){translatedFrom=translatedTo=axis.toPixels(extremes.max);}
pxRange=Math.abs(translatedFrom-translatedTo);pxPosMin=mathMin(translatedFrom,translatedTo);pxPosMax=mathMax(translatedFrom,translatedTo);if(axis.isXAxis){clipAttr={x:inverted?pxPosMax:pxPosMin,y:0,width:pxRange,height:chartSizeMax};if(!horiz){clipAttr.x=chart.plotHeight-clipAttr.x;}}else{clipAttr={x:0,y:inverted?pxPosMax:pxPosMin,width:chartSizeMax,height:pxRange};if(horiz){clipAttr.y=chart.plotWidth-clipAttr.y;}}
if(chart.inverted&&renderer.isVML){if(axis.isXAxis){clipAttr={x:0,y:reversed?pxPosMin:pxPosMax,height:clipAttr.width,width:chart.chartWidth};}else{clipAttr={x:clipAttr.y-chart.plotLeft-chart.spacingBox.x,y:0,width:clipAttr.height,height:chart.chartHeight};}}
if(clips[i]){clips[i].animate(clipAttr);}else{clips[i]=renderer.clipRect(clipAttr);if(graph){series['zoneGraph'+i].clip(clips[i]);}
if(area){series['zoneArea'+i].clip(clips[i]);}}
ignoreZones=threshold.value>extremes.max;});this.clips=clips;}},invertGroups:function(){var series=this,chart=series.chart;if(!series.xAxis){return;}
function setInvert(){var size={width:series.yAxis.len,height:series.xAxis.len};each(['group','markerGroup'],function(groupName){if(series[groupName]){series[groupName].attr(size).invert();}});}
addEvent(chart,'resize',setInvert);addEvent(series,'destroy',function(){removeEvent(chart,'resize',setInvert);});setInvert();series.invertGroups=setInvert;},plotGroup:function(prop,name,visibility,zIndex,parent){var group=this[prop],isNew=!group;if(isNew){this[prop]=group=this.chart.renderer.g(name).attr({zIndex:zIndex||0.1}).add(parent);group.addClass('highcharts-series-'+this.index);}
group.attr({visibility:visibility})[isNew?'attr':'animate'](this.getPlotBox());return group;},getPlotBox:function(){var chart=this.chart,xAxis=this.xAxis,yAxis=this.yAxis;if(chart.inverted){xAxis=yAxis;yAxis=this.xAxis;}
return{translateX:xAxis?xAxis.left:chart.plotLeft,translateY:yAxis?yAxis.top:chart.plotTop,scaleX:1,scaleY:1};},render:function(){var series=this,chart=series.chart,group,options=series.options,animDuration=!!series.animate&&chart.renderer.isSVG&&animObject(options.animation).duration,visibility=series.visible?'inherit':'hidden',zIndex=options.zIndex,hasRendered=series.hasRendered,chartSeriesGroup=chart.seriesGroup;group=series.plotGroup('group','series',visibility,zIndex,chartSeriesGroup);series.markerGroup=series.plotGroup('markerGroup','markers',visibility,zIndex,chartSeriesGroup);if(animDuration){series.animate(true);}
series.getAttribs();group.inverted=series.isCartesian?chart.inverted:false;if(series.drawGraph){series.drawGraph();series.applyZones();}
each(series.points,function(point){if(point.redraw){point.redraw();}});if(series.drawDataLabels){series.drawDataLabels();}
if(series.visible){series.drawPoints();}
if(series.drawTracker&&series.options.enableMouseTracking!==false){series.drawTracker();}
if(chart.inverted){series.invertGroups();}
if(options.clip!==false&&!series.sharedClipKey&&!hasRendered){group.clip(chart.clipRect);}
if(animDuration){series.animate();}
if(!hasRendered){series.animationTimeout=syncTimeout(function(){series.afterAnimate();},animDuration);}
series.isDirty=series.isDirtyData=false;series.hasRendered=true;},redraw:function(){var series=this,chart=series.chart,wasDirtyData=series.isDirtyData,wasDirty=series.isDirty,group=series.group,xAxis=series.xAxis,yAxis=series.yAxis;if(group){if(chart.inverted){group.attr({width:chart.plotWidth,height:chart.plotHeight});}
group.animate({translateX:pick(xAxis&&xAxis.left,chart.plotLeft),translateY:pick(yAxis&&yAxis.top,chart.plotTop)});}
series.translate();series.render();if(wasDirtyData){fireEvent(series,'updatedData');}
if(wasDirty||wasDirtyData){delete this.kdTree;}},kdDimensions:1,kdAxisArray:['clientX','plotY'],searchPoint:function(e,compareX){var series=this,xAxis=series.xAxis,yAxis=series.yAxis,inverted=series.chart.inverted;return this.searchKDTree({clientX:inverted?xAxis.len-e.chartY+xAxis.pos:e.chartX-xAxis.pos,plotY:inverted?yAxis.len-e.chartX+yAxis.pos:e.chartY-yAxis.pos},compareX);},buildKDTree:function(){var series=this,dimensions=series.kdDimensions;function _kdtree(points,depth,dimensions){var axis,median,length=points&&points.length;if(length){axis=series.kdAxisArray[depth%dimensions];points.sort(function(a,b){return a[axis]-b[axis];});median=Math.floor(length/2);return{point:points[median],left:_kdtree(points.slice(0,median),depth+1,dimensions),right:_kdtree(points.slice(median+1),depth+1,dimensions)};}}
function startRecursive(){series.kdTree=_kdtree(series.getValidPoints(null,!series.directTouch),dimensions,dimensions);}
delete series.kdTree;syncTimeout(startRecursive,series.options.kdNow?0:1);},searchKDTree:function(point,compareX){var series=this,kdX=this.kdAxisArray[0],kdY=this.kdAxisArray[1],kdComparer=compareX?'distX':'dist';function setDistance(p1,p2){var x=(defined(p1[kdX])&&defined(p2[kdX]))?Math.pow(p1[kdX]-p2[kdX],2):null,y=(defined(p1[kdY])&&defined(p2[kdY]))?Math.pow(p1[kdY]-p2[kdY],2):null,r=(x||0)+(y||0);p2.dist=defined(r)?Math.sqrt(r):Number.MAX_VALUE;p2.distX=defined(x)?Math.sqrt(x):Number.MAX_VALUE;}
function _search(search,tree,depth,dimensions){var point=tree.point,axis=series.kdAxisArray[depth%dimensions],tdist,sideA,sideB,ret=point,nPoint1,nPoint2;setDistance(search,point);tdist=search[axis]-point[axis];sideA=tdist<0?'left':'right';sideB=tdist<0?'right':'left';if(tree[sideA]){nPoint1=_search(search,tree[sideA],depth+1,dimensions);ret=(nPoint1[kdComparer]<ret[kdComparer]?nPoint1:point);}
if(tree[sideB]){if(Math.sqrt(tdist*tdist)<ret[kdComparer]){nPoint2=_search(search,tree[sideB],depth+1,dimensions);ret=(nPoint2[kdComparer]<ret[kdComparer]?nPoint2:ret);}}
return ret;}
if(!this.kdTree){this.buildKDTree();}
if(this.kdTree){return _search(point,this.kdTree,this.kdDimensions,this.kdDimensions);}}};function StackItem(axis,options,isNegative,x,stackOption){var inverted=axis.chart.inverted;this.axis=axis;this.isNegative=isNegative;this.options=options;this.x=x;this.total=null;this.points={};this.stack=stackOption;this.leftCliff=0;this.rightCliff=0;this.alignOptions={align:options.align||(inverted?(isNegative?'left':'right'):'center'),verticalAlign:options.verticalAlign||(inverted?'middle':(isNegative?'bottom':'top')),y:pick(options.y,inverted?4:(isNegative?14:-6)),x:pick(options.x,inverted?(isNegative?-6:6):0)};this.textAlign=options.textAlign||(inverted?(isNegative?'right':'left'):'center');}
StackItem.prototype={destroy:function(){destroyObjectProperties(this,this.axis);},render:function(group){var options=this.options,formatOption=options.format,str=formatOption?format(formatOption,this):options.formatter.call(this);if(this.label){this.label.attr({text:str,visibility:'hidden'});}else{this.label=this.axis.chart.renderer.text(str,null,null,options.useHTML).css(options.style).attr({align:this.textAlign,rotation:options.rotation,visibility:HIDDEN}).add(group);}},setOffset:function(xOffset,xWidth){var stackItem=this,axis=stackItem.axis,chart=axis.chart,inverted=chart.inverted,reversed=axis.reversed,neg=(this.isNegative&&!reversed)||(!this.isNegative&&reversed),y=axis.translate(axis.usePercentage?100:this.total,0,0,0,1),yZero=axis.translate(0),h=mathAbs(y-yZero),x=chart.xAxis[0].translate(this.x)+xOffset,plotHeight=chart.plotHeight,stackBox={x:inverted?(neg?y:y-h):x,y:inverted?plotHeight-x-xWidth:(neg?(plotHeight-y-h):plotHeight-y),width:inverted?h:xWidth,height:inverted?xWidth:h},label=this.label,alignAttr;if(label){label.align(this.alignOptions,null,stackBox);alignAttr=label.alignAttr;label[this.options.crop===false||chart.isInsidePlot(alignAttr.x,alignAttr.y)?'show':'hide'](true);}}};Chart.prototype.getStacks=function(){var chart=this;each(chart.yAxis,function(axis){if(axis.stacks&&axis.hasVisibleSeries){axis.oldStacks=axis.stacks;}});each(chart.series,function(series){if(series.options.stacking&&(series.visible===true||chart.options.chart.ignoreHiddenSeries===false)){series.stackKey=series.type+pick(series.options.stack,'');}});};Axis.prototype.buildStacks=function(){var axisSeries=this.series,series,reversedStacks=pick(this.options.reversedStacks,true),len=axisSeries.length,i;if(!this.isXAxis){this.usePercentage=false;i=len;while(i--){axisSeries[reversedStacks?i:len-i-1].setStackedPoints();}
i=len;while(i--){series=axisSeries[reversedStacks?i:len-i-1];if(series.setStackCliffs){series.setStackCliffs();}}
if(this.usePercentage){for(i=0;i<len;i++){axisSeries[i].setPercentStacks();}}}};Axis.prototype.renderStackTotals=function(){var axis=this,chart=axis.chart,renderer=chart.renderer,stacks=axis.stacks,stackKey,oneStack,stackCategory,stackTotalGroup=axis.stackTotalGroup;if(!stackTotalGroup){axis.stackTotalGroup=stackTotalGroup=renderer.g('stack-labels').attr({visibility:VISIBLE,zIndex:6}).add();}
stackTotalGroup.translate(chart.plotLeft,chart.plotTop);for(stackKey in stacks){oneStack=stacks[stackKey];for(stackCategory in oneStack){oneStack[stackCategory].render(stackTotalGroup);}}};Axis.prototype.resetStacks=function(){var stacks=this.stacks,type,i;if(!this.isXAxis){for(type in stacks){for(i in stacks[type]){if(stacks[type][i].touched<this.stacksTouched){stacks[type][i].destroy();delete stacks[type][i];}else{stacks[type][i].total=null;stacks[type][i].cum=0;}}}}};Axis.prototype.cleanStacks=function(){var stacks,type,i;if(!this.isXAxis){if(this.oldStacks){stacks=this.stacks=this.oldStacks;}
for(type in stacks){for(i in stacks[type]){stacks[type][i].cum=stacks[type][i].total;}}}};Series.prototype.setStackedPoints=function(){if(!this.options.stacking||(this.visible!==true&&this.chart.options.chart.ignoreHiddenSeries!==false)){return;}
var series=this,xData=series.processedXData,yData=series.processedYData,stackedYData=[],yDataLength=yData.length,seriesOptions=series.options,threshold=seriesOptions.threshold,stackThreshold=seriesOptions.startFromThreshold?threshold:0,stackOption=seriesOptions.stack,stacking=seriesOptions.stacking,stackKey=series.stackKey,negKey='-'+stackKey,negStacks=series.negStacks,yAxis=series.yAxis,stacks=yAxis.stacks,oldStacks=yAxis.oldStacks,stackIndicator,isNegative,stack,other,key,pointKey,i,x,y;yAxis.stacksTouched+=1;for(i=0;i<yDataLength;i++){x=xData[i];y=yData[i];stackIndicator=series.getStackIndicator(stackIndicator,x,series.index);pointKey=stackIndicator.key;isNegative=negStacks&&y<(stackThreshold?0:threshold);key=isNegative?negKey:stackKey;if(!stacks[key]){stacks[key]={};}
if(!stacks[key][x]){if(oldStacks[key]&&oldStacks[key][x]){stacks[key][x]=oldStacks[key][x];stacks[key][x].total=null;}else{stacks[key][x]=new StackItem(yAxis,yAxis.options.stackLabels,isNegative,x,stackOption);}}
stack=stacks[key][x];if(y!==null){stack.points[pointKey]=stack.points[series.index]=[pick(stack.cum,stackThreshold)];stack.touched=yAxis.stacksTouched;if(stackIndicator.index>0&&series.singleStacks===false){stack.points[pointKey][0]=stack.points[series.index+','+x+',0'][0];}}
if(stacking==='percent'){other=isNegative?stackKey:negKey;if(negStacks&&stacks[other]&&stacks[other][x]){other=stacks[other][x];stack.total=other.total=mathMax(other.total,stack.total)+mathAbs(y)||0;}else{stack.total=correctFloat(stack.total+(mathAbs(y)||0));}}else{stack.total=correctFloat(stack.total+(y||0));}
stack.cum=pick(stack.cum,stackThreshold)+(y||0);if(y!==null){stack.points[pointKey].push(stack.cum);stackedYData[i]=stack.cum;}}
if(stacking==='percent'){yAxis.usePercentage=true;}
this.stackedYData=stackedYData;yAxis.oldStacks={};};Series.prototype.setPercentStacks=function(){var series=this,stackKey=series.stackKey,stacks=series.yAxis.stacks,processedXData=series.processedXData,stackIndicator;each([stackKey,'-'+stackKey],function(key){var i=processedXData.length,x,stack,pointExtremes,totalFactor;while(i--){x=processedXData[i];stackIndicator=series.getStackIndicator(stackIndicator,x,series.index);stack=stacks[key]&&stacks[key][x];pointExtremes=stack&&stack.points[stackIndicator.key];if(pointExtremes){totalFactor=stack.total?100/stack.total:0;pointExtremes[0]=correctFloat(pointExtremes[0]*totalFactor);pointExtremes[1]=correctFloat(pointExtremes[1]*totalFactor);series.stackedYData[i]=pointExtremes[1];}}});};Series.prototype.getStackIndicator=function(stackIndicator,x,index){if(!defined(stackIndicator)||stackIndicator.x!==x){stackIndicator={x:x,index:0};}else{stackIndicator.index++;}
stackIndicator.key=[index,x,stackIndicator.index].join(',');return stackIndicator;};extend(Chart.prototype,{addSeries:function(options,redraw,animation){var series,chart=this;if(options){redraw=pick(redraw,true);fireEvent(chart,'addSeries',{options:options},function(){series=chart.initSeries(options);chart.isDirtyLegend=true;chart.linkSeries();if(redraw){chart.redraw(animation);}});}
return series;},addAxis:function(options,isX,redraw,animation){var key=isX?'xAxis':'yAxis',chartOptions=this.options,userOptions=merge(options,{index:this[key].length,isX:isX});new Axis(this,userOptions);chartOptions[key]=splat(chartOptions[key]||{});chartOptions[key].push(userOptions);if(pick(redraw,true)){this.redraw(animation);}},showLoading:function(str){var chart=this,options=chart.options,loadingDiv=chart.loadingDiv,loadingOptions=options.loading,setLoadingSize=function(){if(loadingDiv){css(loadingDiv,{left:chart.plotLeft+PX,top:chart.plotTop+PX,width:chart.plotWidth+PX,height:chart.plotHeight+PX});}};if(!loadingDiv){chart.loadingDiv=loadingDiv=createElement(DIV,{className:PREFIX+'loading'},extend(loadingOptions.style,{zIndex:10,display:NONE}),chart.container);chart.loadingSpan=createElement('span',null,loadingOptions.labelStyle,loadingDiv);addEvent(chart,'redraw',setLoadingSize);}
chart.loadingSpan.innerHTML=str||options.lang.loading;if(!chart.loadingShown){css(loadingDiv,{opacity:0,display:''});animate(loadingDiv,{opacity:loadingOptions.style.opacity},{duration:loadingOptions.showDuration||0});chart.loadingShown=true;}
setLoadingSize();},hideLoading:function(){var options=this.options,loadingDiv=this.loadingDiv;if(loadingDiv){animate(loadingDiv,{opacity:0},{duration:options.loading.hideDuration||100,complete:function(){css(loadingDiv,{display:NONE});}});}
this.loadingShown=false;}});extend(Point.prototype,{update:function(options,redraw,animation,runEvent){var point=this,series=point.series,graphic=point.graphic,i,chart=series.chart,seriesOptions=series.options,names=series.xAxis&&series.xAxis.names;redraw=pick(redraw,true);function update(){point.applyOptions(options);if(point.y===null&&graphic){point.graphic=graphic.destroy();}
if(isObject(options)&&!isArray(options)){point.redraw=function(){if(graphic&&graphic.element){if(options&&options.marker&&options.marker.symbol){point.graphic=graphic.destroy();}}
if(options&&options.dataLabels&&point.dataLabel){point.dataLabel=point.dataLabel.destroy();}
point.redraw=null;};}
i=point.index;series.updateParallelArrays(point,i);if(names&&point.name){names[point.x]=point.name;}
seriesOptions.data[i]=(isObject(seriesOptions.data[i])&&!isArray(seriesOptions.data[i]))?point.options:options;series.isDirty=series.isDirtyData=true;if(!series.fixedBox&&series.hasCartesianSeries){chart.isDirtyBox=true;}
if(seriesOptions.legendType==='point'){chart.isDirtyLegend=true;}
if(redraw){chart.redraw(animation);}}
if(runEvent===false){update();}else{point.firePointEvent('update',{options:options},update);}},remove:function(redraw,animation){this.series.removePoint(inArray(this,this.series.data),redraw,animation);}});extend(Series.prototype,{addPoint:function(options,redraw,shift,animation){var series=this,seriesOptions=series.options,data=series.data,graph=series.graph,area=series.area,chart=series.chart,names=series.xAxis&&series.xAxis.names,currentShift=(graph&&graph.shift)||0,shiftShapes=['graph','area'],dataOptions=seriesOptions.data,point,isInTheMiddle,xData=series.xData,i,x;setAnimation(animation,chart);if(shift){i=series.zones.length;while(i--){shiftShapes.push('zoneGraph'+i,'zoneArea'+i);}
each(shiftShapes,function(shape){if(series[shape]){series[shape].shift=currentShift+(seriesOptions.step?2:1);}});}
if(area){area.isArea=true;}
redraw=pick(redraw,true);point={series:series};series.pointClass.prototype.applyOptions.apply(point,[options]);x=point.x;i=xData.length;if(series.requireSorting&&x<xData[i-1]){isInTheMiddle=true;while(i&&xData[i-1]>x){i--;}}
series.updateParallelArrays(point,'splice',i,0,0);series.updateParallelArrays(point,i);if(names&&point.name){names[x]=point.name;}
dataOptions.splice(i,0,options);if(isInTheMiddle){series.data.splice(i,0,null);series.processData();}
if(seriesOptions.legendType==='point'){series.generatePoints();}
if(shift){if(data[0]&&data[0].remove){data[0].remove(false);}else{data.shift();series.updateParallelArrays(point,'shift');dataOptions.shift();}}
series.isDirty=true;series.isDirtyData=true;if(redraw){series.getAttribs();chart.redraw();}},removePoint:function(i,redraw,animation){var series=this,data=series.data,point=data[i],points=series.points,chart=series.chart,remove=function(){if(points&&points.length===data.length){points.splice(i,1);}
data.splice(i,1);series.options.data.splice(i,1);series.updateParallelArrays(point||{series:series},'splice',i,1);if(point){point.destroy();}
series.isDirty=true;series.isDirtyData=true;if(redraw){chart.redraw();}};setAnimation(animation,chart);redraw=pick(redraw,true);if(point){point.firePointEvent('remove',null,remove);}else{remove();}},remove:function(redraw,animation){var series=this,chart=series.chart;fireEvent(series,'remove',null,function(){series.destroy();chart.isDirtyLegend=chart.isDirtyBox=true;chart.linkSeries();if(pick(redraw,true)){chart.redraw(animation);}});},update:function(newOptions,redraw){var series=this,chart=this.chart,oldOptions=this.userOptions,oldType=this.type,proto=seriesTypes[oldType].prototype,preserve=['group','markerGroup','dataLabelsGroup'],n;if((newOptions.type&&newOptions.type!==oldType)||newOptions.zIndex!==undefined){preserve.length=0;}
each(preserve,function(prop){preserve[prop]=series[prop];delete series[prop];});newOptions=merge(oldOptions,{animation:false,index:this.index,pointStart:this.xData[0]},{data:this.options.data},newOptions);this.remove(false);for(n in proto){this[n]=UNDEFINED;}
extend(this,seriesTypes[newOptions.type||oldType].prototype);each(preserve,function(prop){series[prop]=preserve[prop];});this.init(chart,newOptions);chart.linkSeries();if(pick(redraw,true)){chart.redraw(false);}}});extend(Axis.prototype,{update:function(newOptions,redraw){var chart=this.chart;newOptions=chart.options[this.coll][this.options.index]=merge(this.userOptions,newOptions);this.destroy(true);this._addedPlotLB=this.chart._labelPanes=UNDEFINED;this.init(chart,extend(newOptions,{events:UNDEFINED}));chart.isDirtyBox=true;if(pick(redraw,true)){chart.redraw();}},remove:function(redraw){var chart=this.chart,key=this.coll,axisSeries=this.series,i=axisSeries.length;while(i--){if(axisSeries[i]){axisSeries[i].remove(false);}}
erase(chart.axes,this);erase(chart[key],this);chart.options[key].splice(this.options.index,1);each(chart[key],function(axis,i){axis.options.index=i;});this.destroy();chart.isDirtyBox=true;if(pick(redraw,true)){chart.redraw();}},setTitle:function(newTitleOptions,redraw){this.update({title:newTitleOptions},redraw);},setCategories:function(categories,redraw){this.update({categories:categories},redraw);}});var LineSeries=extendClass(Series);seriesTypes.line=LineSeries;defaultPlotOptions.area=merge(defaultSeriesOptions,{softThreshold:false,threshold:0});var AreaSeries=extendClass(Series,{type:'area',singleStacks:false,getStackPoints:function(){var series=this,segment=[],keys=[],xAxis=this.xAxis,yAxis=this.yAxis,stack=yAxis.stacks[this.stackKey],pointMap={},points=this.points,seriesIndex=series.index,yAxisSeries=yAxis.series,seriesLength=yAxisSeries.length,visibleSeries,upOrDown=pick(yAxis.options.reversedStacks,true)?1:-1,i,x;if(this.options.stacking){for(i=0;i<points.length;i++){pointMap[points[i].x]=points[i];}
for(x in stack){if(stack[x].total!==null){keys.push(x);}}
keys.sort(function(a,b){return a-b;});visibleSeries=map(yAxisSeries,function(){return this.visible;});each(keys,function(x,idx){var y=0,stackPoint,stackedValues;if(pointMap[x]&&!pointMap[x].isNull){segment.push(pointMap[x]);each([-1,1],function(direction){var nullName=direction===1?'rightNull':'leftNull',cliffName=direction===1?'rightCliff':'leftCliff',cliff=0,otherStack=stack[keys[idx+direction]];if(otherStack){i=seriesIndex;while(i>=0&&i<seriesLength){stackPoint=otherStack.points[i];if(!stackPoint){if(i===seriesIndex){pointMap[x][nullName]=true;}else if(visibleSeries[i]){stackedValues=stack[x].points[i];if(stackedValues){cliff-=stackedValues[1]-stackedValues[0];}}}
i+=upOrDown;}}
pointMap[x][cliffName]=cliff;});}else{i=seriesIndex;while(i>=0&&i<seriesLength){stackPoint=stack[x].points[i];if(stackPoint){y=stackPoint[1];break;}
i+=upOrDown;}
y=yAxis.toPixels(y,true);segment.push({isNull:true,plotX:xAxis.toPixels(x,true),plotY:y,yBottom:y});}});}
return segment;},getGraphPath:function(points){var getGraphPath=Series.prototype.getGraphPath,graphPath,options=this.options,stacking=options.stacking,yAxis=this.yAxis,topPath,bottomPath,bottomPoints=[],graphPoints=[],seriesIndex=this.index,i,areaPath,plotX,stacks=yAxis.stacks[this.stackKey],threshold=options.threshold,translatedThreshold=yAxis.getThreshold(options.threshold),isNull,yBottom,connectNulls=options.connectNulls||stacking==='percent',addDummyPoints=function(i,otherI,side){var point=points[i],stackedValues=stacking&&stacks[point.x].points[seriesIndex],nullVal=point[side+'Null']||0,cliffVal=point[side+'Cliff']||0,top,bottom,isNull=true;if(cliffVal||nullVal){top=(nullVal?stackedValues[0]:stackedValues[1])+cliffVal;bottom=stackedValues[0]+cliffVal;isNull=!!nullVal;}else if(!stacking&&points[otherI]&&points[otherI].isNull){top=bottom=threshold;}
if(top!==undefined){graphPoints.push({plotX:plotX,plotY:top===null?translatedThreshold:yAxis.getThreshold(top),isNull:isNull});bottomPoints.push({plotX:plotX,plotY:bottom===null?translatedThreshold:yAxis.getThreshold(bottom)});}};points=points||this.points;if(stacking){points=this.getStackPoints();}
for(i=0;i<points.length;i++){isNull=points[i].isNull;plotX=pick(points[i].rectPlotX,points[i].plotX);yBottom=pick(points[i].yBottom,translatedThreshold);if(!isNull||connectNulls){if(!connectNulls){addDummyPoints(i,i-1,'left');}
if(!(isNull&&!stacking&&connectNulls)){graphPoints.push(points[i]);bottomPoints.push({x:i,plotX:plotX,plotY:yBottom});}
if(!connectNulls){addDummyPoints(i,i+1,'right');}}}
topPath=getGraphPath.call(this,graphPoints,true,true);bottomPoints.reversed=true;bottomPath=getGraphPath.call(this,bottomPoints,true,true);if(bottomPath.length){bottomPath[0]=L;}
areaPath=topPath.concat(bottomPath);graphPath=getGraphPath.call(this,graphPoints,false,connectNulls);this.areaPath=areaPath;return graphPath;},drawGraph:function(){this.areaPath=[];Series.prototype.drawGraph.apply(this);var series=this,areaPath=this.areaPath,options=this.options,zones=this.zones,props=[['area',this.color,options.fillColor]];each(zones,function(threshold,i){props.push(['zoneArea'+i,threshold.color||series.color,threshold.fillColor||options.fillColor]);});each(props,function(prop){var areaKey=prop[0],area=series[areaKey],attr;if(area){area.animate({d:areaPath});}else{attr={fill:prop[2]||prop[1],zIndex:0};if(!prop[2]){attr['fill-opacity']=pick(options.fillOpacity,0.75);}
series[areaKey]=series.chart.renderer.path(areaPath).attr(attr).add(series.group);}});},drawLegendSymbol:LegendSymbolMixin.drawRectangle});seriesTypes.area=AreaSeries;defaultPlotOptions.spline=merge(defaultSeriesOptions);var SplineSeries=extendClass(Series,{type:'spline',getPointSpline:function(points,point,i){var smoothing=1.5,denom=smoothing+1,plotX=point.plotX,plotY=point.plotY,lastPoint=points[i-1],nextPoint=points[i+1],leftContX,leftContY,rightContX,rightContY,ret;if(lastPoint&&!lastPoint.isNull&&nextPoint&&!nextPoint.isNull){var lastX=lastPoint.plotX,lastY=lastPoint.plotY,nextX=nextPoint.plotX,nextY=nextPoint.plotY,correction=0;leftContX=(smoothing*plotX+lastX)/denom;leftContY=(smoothing*plotY+lastY)/denom;rightContX=(smoothing*plotX+nextX)/denom;rightContY=(smoothing*plotY+nextY)/denom;if(rightContX!==leftContX){correction=((rightContY-leftContY)*(rightContX-plotX))/(rightContX-leftContX)+plotY-rightContY;}
leftContY+=correction;rightContY+=correction;if(leftContY>lastY&&leftContY>plotY){leftContY=mathMax(lastY,plotY);rightContY=2*plotY-leftContY;}else if(leftContY<lastY&&leftContY<plotY){leftContY=mathMin(lastY,plotY);rightContY=2*plotY-leftContY;}
if(rightContY>nextY&&rightContY>plotY){rightContY=mathMax(nextY,plotY);leftContY=2*plotY-rightContY;}else if(rightContY<nextY&&rightContY<plotY){rightContY=mathMin(nextY,plotY);leftContY=2*plotY-rightContY;}
point.rightContX=rightContX;point.rightContY=rightContY;}
ret=['C',pick(lastPoint.rightContX,lastPoint.plotX),pick(lastPoint.rightContY,lastPoint.plotY),pick(leftContX,plotX),pick(leftContY,plotY),plotX,plotY];lastPoint.rightContX=lastPoint.rightContY=null;return ret;}});seriesTypes.spline=SplineSeries;defaultPlotOptions.areaspline=merge(defaultPlotOptions.area);var areaProto=AreaSeries.prototype,AreaSplineSeries=extendClass(SplineSeries,{type:'areaspline',getStackPoints:areaProto.getStackPoints,getGraphPath:areaProto.getGraphPath,setStackCliffs:areaProto.setStackCliffs,drawGraph:areaProto.drawGraph,drawLegendSymbol:LegendSymbolMixin.drawRectangle});seriesTypes.areaspline=AreaSplineSeries;defaultPlotOptions.column=merge(defaultSeriesOptions,{borderColor:'#FFFFFF',borderRadius:0,groupPadding:0.2,marker:null,pointPadding:0.1,minPointLength:0,cropThreshold:50,pointRange:null,states:{hover:{brightness:0.1,shadow:false,halo:false},select:{color:'#C0C0C0',borderColor:'#000000',shadow:false}},dataLabels:{align:null,verticalAlign:null,y:null},softThreshold:false,startFromThreshold:true,stickyTracking:false,tooltip:{distance:6},threshold:0});var ColumnSeries=extendClass(Series,{type:'column',pointAttrToOptions:{stroke:'borderColor',fill:'color',r:'borderRadius'},cropShoulder:0,directTouch:true,trackerGroups:['group','dataLabelsGroup'],negStacks:true,init:function(){Series.prototype.init.apply(this,arguments);var series=this,chart=series.chart;if(chart.hasRendered){each(chart.series,function(otherSeries){if(otherSeries.type===series.type){otherSeries.isDirty=true;}});}},getColumnMetrics:function(){var series=this,options=series.options,xAxis=series.xAxis,yAxis=series.yAxis,reversedXAxis=xAxis.reversed,stackKey,stackGroups={},columnCount=0;if(options.grouping===false){columnCount=1;}else{each(series.chart.series,function(otherSeries){var otherOptions=otherSeries.options,otherYAxis=otherSeries.yAxis,columnIndex;if(otherSeries.type===series.type&&otherSeries.visible&&yAxis.len===otherYAxis.len&&yAxis.pos===otherYAxis.pos){if(otherOptions.stacking){stackKey=otherSeries.stackKey;if(stackGroups[stackKey]===UNDEFINED){stackGroups[stackKey]=columnCount++;}
columnIndex=stackGroups[stackKey];}else if(otherOptions.grouping!==false){columnIndex=columnCount++;}
otherSeries.columnIndex=columnIndex;}});}
var categoryWidth=mathMin(mathAbs(xAxis.transA)*(xAxis.ordinalSlope||options.pointRange||xAxis.closestPointRange||xAxis.tickInterval||1),xAxis.len),groupPadding=categoryWidth*options.groupPadding,groupWidth=categoryWidth-2*groupPadding,pointOffsetWidth=groupWidth/columnCount,pointWidth=mathMin(options.maxPointWidth||xAxis.len,pick(options.pointWidth,pointOffsetWidth*(1-2*options.pointPadding))),pointPadding=(pointOffsetWidth-pointWidth)/2,colIndex=(series.columnIndex||0)+(reversedXAxis?1:0),pointXOffset=pointPadding+(groupPadding+colIndex*pointOffsetWidth-(categoryWidth/2))*(reversedXAxis?-1:1);series.columnMetrics={width:pointWidth,offset:pointXOffset};return series.columnMetrics;},crispCol:function(x,y,w,h){var chart=this.chart,borderWidth=this.borderWidth,xCrisp=-(borderWidth%2?0.5:0),yCrisp=borderWidth%2?0.5:1,right,bottom,fromTop;if(chart.inverted&&chart.renderer.isVML){yCrisp+=1;}
right=Math.round(x+w)+xCrisp;x=Math.round(x)+xCrisp;w=right-x;bottom=Math.round(y+h)+yCrisp;fromTop=mathAbs(y)<=0.5&&bottom>0.5;y=Math.round(y)+yCrisp;h=bottom-y;if(fromTop&&h){y-=1;h+=1;}
return{x:x,y:y,width:w,height:h};},translate:function(){var series=this,chart=series.chart,options=series.options,borderWidth=series.borderWidth=pick(options.borderWidth,series.closestPointRange*series.xAxis.transA<2?0:1),yAxis=series.yAxis,threshold=options.threshold,translatedThreshold=series.translatedThreshold=yAxis.getThreshold(threshold),minPointLength=pick(options.minPointLength,5),metrics=series.getColumnMetrics(),pointWidth=metrics.width,seriesBarW=series.barW=mathMax(pointWidth,1+2*borderWidth),pointXOffset=series.pointXOffset=metrics.offset;if(chart.inverted){translatedThreshold-=0.5;}
if(options.pointPadding){seriesBarW=mathCeil(seriesBarW);}
Series.prototype.translate.apply(series);each(series.points,function(point){var yBottom=mathMin(pick(point.yBottom,translatedThreshold),9e4),safeDistance=999+mathAbs(yBottom),plotY=mathMin(mathMax(-safeDistance,point.plotY),yAxis.len+safeDistance),barX=point.plotX+pointXOffset,barW=seriesBarW,barY=mathMin(plotY,yBottom),up,barH=mathMax(plotY,yBottom)-barY;if(mathAbs(barH)<minPointLength){if(minPointLength){barH=minPointLength;up=(!yAxis.reversed&&!point.negative)||(yAxis.reversed&&point.negative);barY=mathAbs(barY-translatedThreshold)>minPointLength?yBottom-minPointLength:translatedThreshold-(up?minPointLength:0);}}
point.barX=barX;point.pointWidth=pointWidth;point.tooltipPos=chart.inverted?[yAxis.len+yAxis.pos-chart.plotLeft-plotY,series.xAxis.len-barX-barW/2,barH]:[barX+barW/2,plotY+yAxis.pos-chart.plotTop,barH];point.shapeType='rect';point.shapeArgs=series.crispCol(barX,barY,barW,barH);});},getSymbol:noop,drawLegendSymbol:LegendSymbolMixin.drawRectangle,drawGraph:noop,drawPoints:function(){var series=this,chart=this.chart,options=series.options,renderer=chart.renderer,animationLimit=options.animationLimit||250,shapeArgs,pointAttr;each(series.points,function(point){var plotY=point.plotY,graphic=point.graphic,borderAttr;if(plotY!==UNDEFINED&&!isNaN(plotY)&&point.y!==null){shapeArgs=point.shapeArgs;borderAttr=defined(series.borderWidth)?{'stroke-width':series.borderWidth}:{};pointAttr=point.pointAttr[point.selected?SELECT_STATE:NORMAL_STATE]||series.pointAttr[NORMAL_STATE];if(graphic){stop(graphic);graphic.attr(borderAttr).attr(pointAttr)[chart.pointCount<animationLimit?'animate':'attr'](merge(shapeArgs));}else{point.graphic=graphic=renderer[point.shapeType](shapeArgs).attr(borderAttr).attr(pointAttr).add(point.group||series.group).shadow(options.shadow,null,options.stacking&&!options.borderRadius);}}else if(graphic){point.graphic=graphic.destroy();}});},animate:function(init){var series=this,yAxis=this.yAxis,options=series.options,inverted=this.chart.inverted,attr={},translatedThreshold;if(hasSVG){if(init){attr.scaleY=0.001;translatedThreshold=mathMin(yAxis.pos+yAxis.len,mathMax(yAxis.pos,yAxis.toPixels(options.threshold)));if(inverted){attr.translateX=translatedThreshold-yAxis.len;}else{attr.translateY=translatedThreshold;}
series.group.attr(attr);}else{attr[inverted?'translateX':'translateY']=yAxis.pos;series.group.animate(attr,extend(animObject(series.options.animation),{step:function(val,fx){series.group.attr({scaleY:fx.pos});}}));series.animate=null;}}},remove:function(){var series=this,chart=series.chart;if(chart.hasRendered){each(chart.series,function(otherSeries){if(otherSeries.type===series.type){otherSeries.isDirty=true;}});}
Series.prototype.remove.apply(series,arguments);}});seriesTypes.column=ColumnSeries;defaultPlotOptions.bar=merge(defaultPlotOptions.column);var BarSeries=extendClass(ColumnSeries,{type:'bar',inverted:true});seriesTypes.bar=BarSeries;defaultPlotOptions.scatter=merge(defaultSeriesOptions,{lineWidth:0,marker:{enabled:true},tooltip:{headerFormat:'<span style="color:{point.color}">\u25CF</span> <span style="font-size: 10px;"> {series.name}</span><br/>',pointFormat:'x: <b>{point.x}</b><br/>y: <b>{point.y}</b><br/>'}});var ScatterSeries=extendClass(Series,{type:'scatter',sorted:false,requireSorting:false,noSharedTooltip:true,trackerGroups:['group','markerGroup','dataLabelsGroup'],takeOrdinalPosition:false,kdDimensions:2,drawGraph:function(){if(this.options.lineWidth){Series.prototype.drawGraph.call(this);}}});seriesTypes.scatter=ScatterSeries;defaultPlotOptions.pie=merge(defaultSeriesOptions,{borderColor:'#FFFFFF',borderWidth:1,center:[null,null],clip:false,colorByPoint:true,dataLabels:{distance:30,enabled:true,formatter:function(){return this.y===null?undefined:this.point.name;},x:0},ignoreHiddenPoint:true,legendType:'point',marker:null,size:null,showInLegend:false,slicedOffset:10,states:{hover:{brightness:0.1,shadow:false}},stickyTracking:false,tooltip:{followPointer:true}});var PiePoint=extendClass(Point,{init:function(){Point.prototype.init.apply(this,arguments);var point=this,toggleSlice;point.name=pick(point.name,'Slice');toggleSlice=function(e){point.slice(e.type==='select');};addEvent(point,'select',toggleSlice);addEvent(point,'unselect',toggleSlice);return point;},setVisible:function(vis,redraw){var point=this,series=point.series,chart=series.chart,ignoreHiddenPoint=series.options.ignoreHiddenPoint;redraw=pick(redraw,ignoreHiddenPoint);if(vis!==point.visible){point.visible=point.options.visible=vis=vis===UNDEFINED?!point.visible:vis;series.options.data[inArray(point,series.data)]=point.options;each(['graphic','dataLabel','connector','shadowGroup'],function(key){if(point[key]){point[key][vis?'show':'hide'](true);}});if(point.legendItem){chart.legend.colorizeItem(point,vis);}
if(!vis&&point.state==='hover'){point.setState('');}
if(ignoreHiddenPoint){series.isDirty=true;}
if(redraw){chart.redraw();}}},slice:function(sliced,redraw,animation){var point=this,series=point.series,chart=series.chart,translation;setAnimation(animation,chart);redraw=pick(redraw,true);point.sliced=point.options.sliced=sliced=defined(sliced)?sliced:!point.sliced;series.options.data[inArray(point,series.data)]=point.options;translation=sliced?point.slicedTranslation:{translateX:0,translateY:0};point.graphic.animate(translation);if(point.shadowGroup){point.shadowGroup.animate(translation);}},haloPath:function(size){var shapeArgs=this.shapeArgs,chart=this.series.chart;return this.sliced||!this.visible?[]:this.series.chart.renderer.symbols.arc(chart.plotLeft+shapeArgs.x,chart.plotTop+shapeArgs.y,shapeArgs.r+size,shapeArgs.r+size,{innerR:this.shapeArgs.r,start:shapeArgs.start,end:shapeArgs.end});}});var PieSeries={type:'pie',isCartesian:false,pointClass:PiePoint,requireSorting:false,directTouch:true,noSharedTooltip:true,trackerGroups:['group','dataLabelsGroup'],axisTypes:[],pointAttrToOptions:{stroke:'borderColor','stroke-width':'borderWidth',fill:'color'},animate:function(init){var series=this,points=series.points,startAngleRad=series.startAngleRad;if(!init){each(points,function(point){var graphic=point.graphic,args=point.shapeArgs;if(graphic){graphic.attr({r:point.startR||(series.center[3]/2),start:startAngleRad,end:startAngleRad});graphic.animate({r:args.r,start:args.start,end:args.end},series.options.animation);}});series.animate=null;}},updateTotals:function(){var i,total=0,points=this.points,len=points.length,point,ignoreHiddenPoint=this.options.ignoreHiddenPoint;for(i=0;i<len;i++){point=points[i];total+=(ignoreHiddenPoint&&!point.visible)?0:point.y;}
this.total=total;for(i=0;i<len;i++){point=points[i];point.percentage=(total>0&&(point.visible||!ignoreHiddenPoint))?point.y/total*100:0;point.total=total;}},generatePoints:function(){Series.prototype.generatePoints.call(this);this.updateTotals();},translate:function(positions){this.generatePoints();var series=this,cumulative=0,precision=1000,options=series.options,slicedOffset=options.slicedOffset,connectorOffset=slicedOffset+options.borderWidth,start,end,angle,startAngle=options.startAngle||0,startAngleRad=series.startAngleRad=mathPI/180*(startAngle-90),endAngleRad=series.endAngleRad=mathPI/180*((pick(options.endAngle,startAngle+360))-90),circ=endAngleRad-startAngleRad,points=series.points,radiusX,radiusY,labelDistance=options.dataLabels.distance,ignoreHiddenPoint=options.ignoreHiddenPoint,i,len=points.length,point;if(!positions){series.center=positions=series.getCenter();}
series.getX=function(y,left){angle=math.asin(mathMin((y-positions[1])/(positions[2]/2+labelDistance),1));return positions[0]+
(left?-1:1)*(mathCos(angle)*(positions[2]/2+labelDistance));};for(i=0;i<len;i++){point=points[i];start=startAngleRad+(cumulative*circ);if(!ignoreHiddenPoint||point.visible){cumulative+=point.percentage/100;}
end=startAngleRad+(cumulative*circ);point.shapeType='arc';point.shapeArgs={x:positions[0],y:positions[1],r:positions[2]/2,innerR:positions[3]/2,start:mathRound(start*precision)/precision,end:mathRound(end*precision)/precision};angle=(end+start)/2;if(angle>1.5*mathPI){angle-=2*mathPI;}else if(angle<-mathPI/2){angle+=2*mathPI;}
point.slicedTranslation={translateX:mathRound(mathCos(angle)*slicedOffset),translateY:mathRound(mathSin(angle)*slicedOffset)};radiusX=mathCos(angle)*positions[2]/2;radiusY=mathSin(angle)*positions[2]/2;point.tooltipPos=[positions[0]+radiusX*0.7,positions[1]+radiusY*0.7];point.half=angle<-mathPI/2||angle>mathPI/2?1:0;point.angle=angle;connectorOffset=mathMin(connectorOffset,labelDistance/2);point.labelPos=[positions[0]+radiusX+mathCos(angle)*labelDistance,positions[1]+radiusY+mathSin(angle)*labelDistance,positions[0]+radiusX+mathCos(angle)*connectorOffset,positions[1]+radiusY+mathSin(angle)*connectorOffset,positions[0]+radiusX,positions[1]+radiusY,labelDistance<0?'center':point.half?'right':'left',angle];}},drawGraph:null,drawPoints:function(){var series=this,chart=series.chart,renderer=chart.renderer,groupTranslation,graphic,shadow=series.options.shadow,shadowGroup,pointAttr,shapeArgs,attr;if(shadow&&!series.shadowGroup){series.shadowGroup=renderer.g('shadow').add(series.group);}
each(series.points,function(point){if(point.y!==null){graphic=point.graphic;shapeArgs=point.shapeArgs;shadowGroup=point.shadowGroup;pointAttr=point.pointAttr[point.selected?SELECT_STATE:NORMAL_STATE];if(!pointAttr.stroke){pointAttr.stroke=pointAttr.fill;}
if(shadow&&!shadowGroup){shadowGroup=point.shadowGroup=renderer.g('shadow').add(series.shadowGroup);}
groupTranslation=point.sliced?point.slicedTranslation:{translateX:0,translateY:0};if(shadowGroup){shadowGroup.attr(groupTranslation);}
if(graphic){graphic.setRadialReference(series.center).attr(pointAttr).animate(extend(shapeArgs,groupTranslation));}else{attr={'stroke-linejoin':'round'};if(!point.visible){attr.visibility='hidden';}
point.graphic=graphic=renderer[point.shapeType](shapeArgs).setRadialReference(series.center).attr(pointAttr).attr(attr).attr(groupTranslation).add(series.group).shadow(shadow,shadowGroup);}}});},searchPoint:noop,sortByAngle:function(points,sign){points.sort(function(a,b){return a.angle!==undefined&&(b.angle-a.angle)*sign;});},drawLegendSymbol:LegendSymbolMixin.drawRectangle,getCenter:CenteredSeriesMixin.getCenter,getSymbol:noop};PieSeries=extendClass(Series,PieSeries);seriesTypes.pie=PieSeries;Series.prototype.drawDataLabels=function(){var series=this,seriesOptions=series.options,cursor=seriesOptions.cursor,options=seriesOptions.dataLabels,points=series.points,pointOptions,generalOptions,hasRendered=series.hasRendered||0,str,dataLabelsGroup,defer=pick(options.defer,true),renderer=series.chart.renderer;if(options.enabled||series._hasPointLabels){if(series.dlProcessOptions){series.dlProcessOptions(options);}
dataLabelsGroup=series.plotGroup('dataLabelsGroup','data-labels',defer&&!hasRendered?'hidden':'visible',options.zIndex||6);if(defer){dataLabelsGroup.attr({opacity:+hasRendered});if(!hasRendered){addEvent(series,'afterAnimate',function(){if(series.visible){dataLabelsGroup.show();}
dataLabelsGroup[seriesOptions.animation?'animate':'attr']({opacity:1},{duration:200});});}}
generalOptions=options;each(points,function(point){var enabled,dataLabel=point.dataLabel,labelConfig,attr,name,rotation,connector=point.connector,isNew=true,style,moreStyle={};pointOptions=point.dlOptions||(point.options&&point.options.dataLabels);enabled=pick(pointOptions&&pointOptions.enabled,generalOptions.enabled)&&point.y!==null;if(dataLabel&&!enabled){point.dataLabel=dataLabel.destroy();}else if(enabled){options=merge(generalOptions,pointOptions);style=options.style;rotation=options.rotation;labelConfig=point.getLabelConfig();str=options.format?format(options.format,labelConfig):options.formatter.call(labelConfig,options);style.color=pick(options.color,style.color,series.color,'black');if(dataLabel){if(defined(str)){dataLabel.attr({text:str});isNew=false;}else{point.dataLabel=dataLabel=dataLabel.destroy();if(connector){point.connector=connector.destroy();}}}else if(defined(str)){attr={fill:options.backgroundColor,stroke:options.borderColor,'stroke-width':options.borderWidth,r:options.borderRadius||0,rotation:rotation,padding:options.padding,zIndex:1};if(style.color==='contrast'){moreStyle.color=options.inside||options.distance<0||!!seriesOptions.stacking?renderer.getContrast(point.color||series.color):'#000000';}
if(cursor){moreStyle.cursor=cursor;}
for(name in attr){if(attr[name]===UNDEFINED){delete attr[name];}}
dataLabel=point.dataLabel=renderer[rotation?'text':'label'](str,0,-9999,options.shape,null,null,options.useHTML).attr(attr).css(extend(style,moreStyle)).add(dataLabelsGroup).shadow(options.shadow);}
if(dataLabel){series.alignDataLabel(point,dataLabel,options,null,isNew);}}});}};Series.prototype.alignDataLabel=function(point,dataLabel,options,alignTo,isNew){var chart=this.chart,inverted=chart.inverted,plotX=pick(point.plotX,-9999),plotY=pick(point.plotY,-9999),bBox=dataLabel.getBBox(),baseline=chart.renderer.fontMetrics(options.style.fontSize).b,rotation=options.rotation,normRotation,negRotation,align=options.align,rotCorr,visible=this.visible&&(point.series.forceDL||chart.isInsidePlot(plotX,mathRound(plotY),inverted)||(alignTo&&chart.isInsidePlot(plotX,inverted?alignTo.x+1:alignTo.y+alignTo.height-1,inverted))),alignAttr,justify=pick(options.overflow,'justify')==='justify';if(visible){alignTo=extend({x:inverted?chart.plotWidth-plotY:plotX,y:mathRound(inverted?chart.plotHeight-plotX:plotY),width:0,height:0},alignTo);extend(options,{width:bBox.width,height:bBox.height});if(rotation){justify=false;rotCorr=chart.renderer.rotCorr(baseline,rotation);alignAttr={x:alignTo.x+options.x+alignTo.width/2+rotCorr.x,y:alignTo.y+options.y+alignTo.height/2};dataLabel[isNew?'attr':'animate'](alignAttr).attr({align:options.align});normRotation=(rotation+720)%360;negRotation=normRotation>180&&normRotation<360;if(align==='left'){alignAttr.y-=negRotation?bBox.height:0;}else if(align==='center'){alignAttr.x-=bBox.width/2;alignAttr.y-=bBox.height/2;}else if(align==='right'){alignAttr.x-=bBox.width;alignAttr.y-=negRotation?0:bBox.height;}}else{dataLabel.align(options,null,alignTo);alignAttr=dataLabel.alignAttr;}
if(justify){this.justifyDataLabel(dataLabel,options,alignAttr,bBox,alignTo,isNew);}else if(pick(options.crop,true)){visible=chart.isInsidePlot(alignAttr.x,alignAttr.y)&&chart.isInsidePlot(alignAttr.x+bBox.width,alignAttr.y+bBox.height);}
if(options.shape&&!rotation){dataLabel.attr({anchorX:point.plotX,anchorY:point.plotY});}}
if(!visible){stop(dataLabel);dataLabel.attr({y:-9999});dataLabel.placed=false;}};Series.prototype.justifyDataLabel=function(dataLabel,options,alignAttr,bBox,alignTo,isNew){var chart=this.chart,align=options.align,verticalAlign=options.verticalAlign,off,justified,padding=dataLabel.box?0:(dataLabel.padding||0);off=alignAttr.x+padding;if(off<0){if(align==='right'){options.align='left';}else{options.x=-off;}
justified=true;}
off=alignAttr.x+bBox.width-padding;if(off>chart.plotWidth){if(align==='left'){options.align='right';}else{options.x=chart.plotWidth-off;}
justified=true;}
off=alignAttr.y+padding;if(off<0){if(verticalAlign==='bottom'){options.verticalAlign='top';}else{options.y=-off;}
justified=true;}
off=alignAttr.y+bBox.height-padding;if(off>chart.plotHeight){if(verticalAlign==='top'){options.verticalAlign='bottom';}else{options.y=chart.plotHeight-off;}
justified=true;}
if(justified){dataLabel.placed=!isNew;dataLabel.align(options,null,alignTo);}};if(seriesTypes.pie){seriesTypes.pie.prototype.drawDataLabels=function(){var series=this,data=series.data,point,chart=series.chart,options=series.options.dataLabels,connectorPadding=pick(options.connectorPadding,10),connectorWidth=pick(options.connectorWidth,1),plotWidth=chart.plotWidth,plotHeight=chart.plotHeight,connector,connectorPath,softConnector=pick(options.softConnector,true),distanceOption=options.distance,seriesCenter=series.center,radius=seriesCenter[2]/2,centerY=seriesCenter[1],outside=distanceOption>0,dataLabel,dataLabelWidth,labelPos,labelHeight,halves=[[],[]],x,y,visibility,rankArr,i,j,overflow=[0,0,0,0],sort=function(a,b){return b.y-a.y;};if(!series.visible||(!options.enabled&&!series._hasPointLabels)){return;}
Series.prototype.drawDataLabels.apply(series);each(data,function(point){if(point.dataLabel&&point.visible){halves[point.half].push(point);point.dataLabel._pos=null;}});i=2;while(i--){var slots=[],slotsLength,usedSlots=[],points=halves[i],pos,bottom,length=points.length,slotIndex;if(!length){continue;}
series.sortByAngle(points,i-0.5);j=labelHeight=0;while(!labelHeight&&points[j]){labelHeight=points[j]&&points[j].dataLabel&&(points[j].dataLabel.getBBox().height||21);j++;}
if(distanceOption>0){bottom=mathMin(centerY+radius+distanceOption,chart.plotHeight);for(pos=mathMax(0,centerY-radius-distanceOption);pos<=bottom;pos+=labelHeight){slots.push(pos);}
slotsLength=slots.length;if(length>slotsLength){rankArr=[].concat(points);rankArr.sort(sort);j=length;while(j--){rankArr[j].rank=j;}
j=length;while(j--){if(points[j].rank>=slotsLength){points.splice(j,1);}}
length=points.length;}
for(j=0;j<length;j++){point=points[j];labelPos=point.labelPos;var closest=9999,distance,slotI;for(slotI=0;slotI<slotsLength;slotI++){distance=mathAbs(slots[slotI]-labelPos[1]);if(distance<closest){closest=distance;slotIndex=slotI;}}
if(slotIndex<j&&slots[j]!==null){slotIndex=j;}else if(slotsLength<length-j+slotIndex&&slots[j]!==null){slotIndex=slotsLength-length+j;while(slots[slotIndex]===null){slotIndex++;}}else{while(slots[slotIndex]===null){slotIndex++;}}
usedSlots.push({i:slotIndex,y:slots[slotIndex]});slots[slotIndex]=null;}
usedSlots.sort(sort);}
for(j=0;j<length;j++){var slot,naturalY;point=points[j];labelPos=point.labelPos;dataLabel=point.dataLabel;visibility=point.visible===false?HIDDEN:'inherit';naturalY=labelPos[1];if(distanceOption>0){slot=usedSlots.pop();slotIndex=slot.i;y=slot.y;if((naturalY>y&&slots[slotIndex+1]!==null)||(naturalY<y&&slots[slotIndex-1]!==null)){y=mathMin(mathMax(0,naturalY),chart.plotHeight);}}else{y=naturalY;}
x=options.justify?seriesCenter[0]+(i?-1:1)*(radius+distanceOption):series.getX(y===centerY-radius-distanceOption||y===centerY+radius+distanceOption?naturalY:y,i);dataLabel._attr={visibility:visibility,align:labelPos[6]};dataLabel._pos={x:x+options.x+
({left:connectorPadding,right:-connectorPadding}[labelPos[6]]||0),y:y+options.y-10};dataLabel.connX=x;dataLabel.connY=y;if(this.options.size===null){dataLabelWidth=dataLabel.width;if(x-dataLabelWidth<connectorPadding){overflow[3]=mathMax(mathRound(dataLabelWidth-x+connectorPadding),overflow[3]);}else if(x+dataLabelWidth>plotWidth-connectorPadding){overflow[1]=mathMax(mathRound(x+dataLabelWidth-plotWidth+connectorPadding),overflow[1]);}
if(y-labelHeight/2<0){overflow[0]=mathMax(mathRound(-y+labelHeight/2),overflow[0]);}else if(y+labelHeight/2>plotHeight){overflow[2]=mathMax(mathRound(y+labelHeight/2-plotHeight),overflow[2]);}}}}
if(arrayMax(overflow)===0||this.verifyDataLabelOverflow(overflow)){this.placeDataLabels();if(outside&&connectorWidth){each(this.points,function(point){connector=point.connector;labelPos=point.labelPos;dataLabel=point.dataLabel;if(dataLabel&&dataLabel._pos&&point.visible){visibility=dataLabel._attr.visibility;x=dataLabel.connX;y=dataLabel.connY;connectorPath=softConnector?[M,x+(labelPos[6]==='left'?5:-5),y,'C',x,y,2*labelPos[2]-labelPos[4],2*labelPos[3]-labelPos[5],labelPos[2],labelPos[3],L,labelPos[4],labelPos[5]]:[M,x+(labelPos[6]==='left'?5:-5),y,L,labelPos[2],labelPos[3],L,labelPos[4],labelPos[5]];if(connector){connector.animate({d:connectorPath});connector.attr('visibility',visibility);}else{point.connector=connector=series.chart.renderer.path(connectorPath).attr({'stroke-width':connectorWidth,stroke:options.connectorColor||point.color||'#606060',visibility:visibility}).add(series.dataLabelsGroup);}}else if(connector){point.connector=connector.destroy();}});}}};seriesTypes.pie.prototype.placeDataLabels=function(){each(this.points,function(point){var dataLabel=point.dataLabel,_pos;if(dataLabel&&point.visible){_pos=dataLabel._pos;if(_pos){dataLabel.attr(dataLabel._attr);dataLabel[dataLabel.moved?'animate':'attr'](_pos);dataLabel.moved=true;}else if(dataLabel){dataLabel.attr({y:-9999});}}});};seriesTypes.pie.prototype.alignDataLabel=noop;seriesTypes.pie.prototype.verifyDataLabelOverflow=function(overflow){var center=this.center,options=this.options,centerOption=options.center,minSize=options.minSize||80,newSize=minSize,ret;if(centerOption[0]!==null){newSize=mathMax(center[2]-mathMax(overflow[1],overflow[3]),minSize);}else{newSize=mathMax(center[2]-overflow[1]-overflow[3],minSize);center[0]+=(overflow[3]-overflow[1])/2;}
if(centerOption[1]!==null){newSize=mathMax(mathMin(newSize,center[2]-mathMax(overflow[0],overflow[2])),minSize);}else{newSize=mathMax(mathMin(newSize,center[2]-overflow[0]-overflow[2]),minSize);center[1]+=(overflow[0]-overflow[2])/2;}
if(newSize<center[2]){center[2]=newSize;center[3]=Math.min(relativeLength(options.innerSize||0,newSize),newSize);this.translate(center);if(this.drawDataLabels){this.drawDataLabels();}}else{ret=true;}
return ret;};}
if(seriesTypes.column){seriesTypes.column.prototype.alignDataLabel=function(point,dataLabel,options,alignTo,isNew){var inverted=this.chart.inverted,series=point.series,dlBox=point.dlBox||point.shapeArgs,below=pick(point.below,point.plotY>pick(this.translatedThreshold,series.yAxis.len)),inside=pick(options.inside,!!this.options.stacking),overshoot;if(dlBox){alignTo=merge(dlBox);if(alignTo.y<0){alignTo.height+=alignTo.y;alignTo.y=0;}
overshoot=alignTo.y+alignTo.height-series.yAxis.len;if(overshoot>0){alignTo.height-=overshoot;}
if(inverted){alignTo={x:series.yAxis.len-alignTo.y-alignTo.height,y:series.xAxis.len-alignTo.x-alignTo.width,width:alignTo.height,height:alignTo.width};}
if(!inside){if(inverted){alignTo.x+=below?0:alignTo.width;alignTo.width=0;}else{alignTo.y+=below?alignTo.height:0;alignTo.height=0;}}}
options.align=pick(options.align,!inverted||inside?'center':below?'right':'left');options.verticalAlign=pick(options.verticalAlign,inverted||inside?'middle':below?'top':'bottom');Series.prototype.alignDataLabel.call(this,point,dataLabel,options,alignTo,isNew);};}
(function(H){var Chart=H.Chart,each=H.each,pick=H.pick,addEvent=H.addEvent;Chart.prototype.callbacks.push(function(chart){function collectAndHide(){var labels=[];each(chart.series,function(series){var dlOptions=series.options.dataLabels,collections=series.dataLabelCollections||['dataLabel'];if((dlOptions.enabled||series._hasPointLabels)&&!dlOptions.allowOverlap&&series.visible){each(collections,function(coll){each(series.points,function(point){if(point[coll]){point[coll].labelrank=pick(point.labelrank,point.shapeArgs&&point.shapeArgs.height);labels.push(point[coll]);}});});}});chart.hideOverlappingLabels(labels);}
collectAndHide();addEvent(chart,'redraw',collectAndHide);});Chart.prototype.hideOverlappingLabels=function(labels){var len=labels.length,label,i,j,label1,label2,isIntersecting,pos1,pos2,parent1,parent2,padding,intersectRect=function(x1,y1,w1,h1,x2,y2,w2,h2){return!(x2>x1+w1||x2+w2<x1||y2>y1+h1||y2+h2<y1);};for(i=0;i<len;i++){label=labels[i];if(label){label.oldOpacity=label.opacity;label.newOpacity=1;}}
labels.sort(function(a,b){return(b.labelrank||0)-(a.labelrank||0);});for(i=0;i<len;i++){label1=labels[i];for(j=i+1;j<len;++j){label2=labels[j];if(label1&&label2&&label1.placed&&label2.placed&&label1.newOpacity!==0&&label2.newOpacity!==0){pos1=label1.alignAttr;pos2=label2.alignAttr;parent1=label1.parentGroup;parent2=label2.parentGroup;padding=2*(label1.box?0:label1.padding);isIntersecting=intersectRect(pos1.x+parent1.translateX,pos1.y+parent1.translateY,label1.width-padding,label1.height-padding,pos2.x+parent2.translateX,pos2.y+parent2.translateY,label2.width-padding,label2.height-padding);if(isIntersecting){(label1.labelrank<label2.labelrank?label1:label2).newOpacity=0;}}}}
each(labels,function(label){var complete,newOpacity;if(label){newOpacity=label.newOpacity;if(label.oldOpacity!==newOpacity&&label.placed){if(newOpacity){label.show(true);}else{complete=function(){label.hide();};}
label.alignAttr.opacity=newOpacity;label[label.isOld?'animate':'attr'](label.alignAttr,null,complete);}
label.isOld=true;}});};}(Highcharts));var TrackerMixin=Highcharts.TrackerMixin={drawTrackerPoint:function(){var series=this,chart=series.chart,pointer=chart.pointer,cursor=series.options.cursor,css=cursor&&{cursor:cursor},onMouseOver=function(e){var target=e.target,point;while(target&&!point){point=target.point;target=target.parentNode;}
if(point!==UNDEFINED&&point!==chart.hoverPoint){point.onMouseOver(e);}};each(series.points,function(point){if(point.graphic){point.graphic.element.point=point;}
if(point.dataLabel){point.dataLabel.element.point=point;}});if(!series._hasTracking){each(series.trackerGroups,function(key){if(series[key]){series[key].addClass(PREFIX+'tracker').on('mouseover',onMouseOver).on('mouseout',function(e){pointer.onTrackerMouseOut(e);}).css(css);if(hasTouch){series[key].on('touchstart',onMouseOver);}}});series._hasTracking=true;}},drawTrackerGraph:function(){var series=this,options=series.options,trackByArea=options.trackByArea,trackerPath=[].concat(trackByArea?series.areaPath:series.graphPath),trackerPathLength=trackerPath.length,chart=series.chart,pointer=chart.pointer,renderer=chart.renderer,snap=chart.options.tooltip.snap,tracker=series.tracker,cursor=options.cursor,css=cursor&&{cursor:cursor},i,onMouseOver=function(){if(chart.hoverSeries!==series){series.onMouseOver();}},TRACKER_FILL='rgba(192,192,192,'+(hasSVG?0.0001:0.002)+')';if(trackerPathLength&&!trackByArea){i=trackerPathLength+1;while(i--){if(trackerPath[i]===M){trackerPath.splice(i+1,0,trackerPath[i+1]-snap,trackerPath[i+2],L);}
if((i&&trackerPath[i]===M)||i===trackerPathLength){trackerPath.splice(i,0,L,trackerPath[i-2]+snap,trackerPath[i-1]);}}}
if(tracker){tracker.attr({d:trackerPath});}else{series.tracker=renderer.path(trackerPath).attr({'stroke-linejoin':'round',visibility:series.visible?VISIBLE:HIDDEN,stroke:TRACKER_FILL,fill:trackByArea?TRACKER_FILL:NONE,'stroke-width':options.lineWidth+(trackByArea?0:2*snap),zIndex:2}).add(series.group);each([series.tracker,series.markerGroup],function(tracker){tracker.addClass(PREFIX+'tracker').on('mouseover',onMouseOver).on('mouseout',function(e){pointer.onTrackerMouseOut(e);}).css(css);if(hasTouch){tracker.on('touchstart',onMouseOver);}});}}};if(seriesTypes.column){ColumnSeries.prototype.drawTracker=TrackerMixin.drawTrackerPoint;}
if(seriesTypes.pie){seriesTypes.pie.prototype.drawTracker=TrackerMixin.drawTrackerPoint;}
if(seriesTypes.scatter){ScatterSeries.prototype.drawTracker=TrackerMixin.drawTrackerPoint;}
extend(Legend.prototype,{setItemEvents:function(item,legendItem,useHTML,itemStyle,itemHiddenStyle){var legend=this;(useHTML?legendItem:item.legendGroup).on('mouseover',function(){item.setState(HOVER_STATE);legendItem.css(legend.options.itemHoverStyle);}).on('mouseout',function(){legendItem.css(item.visible?itemStyle:itemHiddenStyle);item.setState();}).on('click',function(event){var strLegendItemClick='legendItemClick',fnLegendItemClick=function(){if(item.setVisible){item.setVisible();}};event={browserEvent:event};if(item.firePointEvent){item.firePointEvent(strLegendItemClick,event,fnLegendItemClick);}else{fireEvent(item,strLegendItemClick,event,fnLegendItemClick);}});},createCheckboxForItem:function(item){var legend=this;item.checkbox=createElement('input',{type:'checkbox',checked:item.selected,defaultChecked:item.selected},legend.options.itemCheckboxStyle,legend.chart.container);addEvent(item.checkbox,'click',function(event){var target=event.target;fireEvent(item.series||item,'checkboxClick',{checked:target.checked,item:item},function(){item.select();});});}});defaultOptions.legend.itemStyle.cursor='pointer';extend(Chart.prototype,{showResetZoom:function(){var chart=this,lang=defaultOptions.lang,btnOptions=chart.options.chart.resetZoomButton,theme=btnOptions.theme,states=theme.states,alignTo=btnOptions.relativeTo==='chart'?null:'plotBox';function zoomOut(){chart.zoomOut();}
this.resetZoomButton=chart.renderer.button(lang.resetZoom,null,null,zoomOut,theme,states&&states.hover).attr({align:btnOptions.position.align,title:lang.resetZoomTitle}).add().align(btnOptions.position,false,alignTo);},zoomOut:function(){var chart=this;fireEvent(chart,'selection',{resetSelection:true},function(){chart.zoom();});},zoom:function(event){var chart=this,hasZoomed,pointer=chart.pointer,displayButton=false,resetZoomButton;if(!event||event.resetSelection){each(chart.axes,function(axis){hasZoomed=axis.zoom();});}else{each(event.xAxis.concat(event.yAxis),function(axisData){var axis=axisData.axis,isXAxis=axis.isXAxis;if(pointer[isXAxis?'zoomX':'zoomY']||pointer[isXAxis?'pinchX':'pinchY']){hasZoomed=axis.zoom(axisData.min,axisData.max);if(axis.displayBtn){displayButton=true;}}});}
resetZoomButton=chart.resetZoomButton;if(displayButton&&!resetZoomButton){chart.showResetZoom();}else if(!displayButton&&isObject(resetZoomButton)){chart.resetZoomButton=resetZoomButton.destroy();}
if(hasZoomed){chart.redraw(pick(chart.options.chart.animation,event&&event.animation,chart.pointCount<100));}},pan:function(e,panning){var chart=this,hoverPoints=chart.hoverPoints,doRedraw;if(hoverPoints){each(hoverPoints,function(point){point.setState();});}
each(panning==='xy'?[1,0]:[1],function(isX){var axis=chart[isX?'xAxis':'yAxis'][0],horiz=axis.horiz,mousePos=e[horiz?'chartX':'chartY'],mouseDown=horiz?'mouseDownX':'mouseDownY',startPos=chart[mouseDown],halfPointRange=(axis.pointRange||0)/2,extremes=axis.getExtremes(),newMin=axis.toValue(startPos-mousePos,true)+halfPointRange,newMax=axis.toValue(startPos+axis.len-mousePos,true)-halfPointRange,goingLeft=startPos>mousePos;if(axis.series.length&&(goingLeft||newMin>mathMin(extremes.dataMin,extremes.min))&&(!goingLeft||newMax<mathMax(extremes.dataMax,extremes.max))){axis.setExtremes(newMin,newMax,false,false,{trigger:'pan'});doRedraw=true;}
chart[mouseDown]=mousePos;});if(doRedraw){chart.redraw(false);}
css(chart.container,{cursor:'move'});}});extend(Point.prototype,{select:function(selected,accumulate){var point=this,series=point.series,chart=series.chart;selected=pick(selected,!point.selected);point.firePointEvent(selected?'select':'unselect',{accumulate:accumulate},function(){point.selected=point.options.selected=selected;series.options.data[inArray(point,series.data)]=point.options;point.setState(selected&&SELECT_STATE);if(!accumulate){each(chart.getSelectedPoints(),function(loopPoint){if(loopPoint.selected&&loopPoint!==point){loopPoint.selected=loopPoint.options.selected=false;series.options.data[inArray(loopPoint,series.data)]=loopPoint.options;loopPoint.setState(NORMAL_STATE);loopPoint.firePointEvent('unselect');}});}});},onMouseOver:function(e,byProximity){var point=this,series=point.series,chart=series.chart,tooltip=chart.tooltip,hoverPoint=chart.hoverPoint;if(chart.hoverSeries!==series){series.onMouseOver();}
if(hoverPoint&&hoverPoint!==point){hoverPoint.onMouseOut();}
if(point.series){point.firePointEvent('mouseOver');if(tooltip&&(!tooltip.shared||series.noSharedTooltip)){tooltip.refresh(point,e);}
point.setState(HOVER_STATE);if(!byProximity){chart.hoverPoint=point;}}},onMouseOut:function(){var chart=this.series.chart,hoverPoints=chart.hoverPoints;this.firePointEvent('mouseOut');if(!hoverPoints||inArray(this,hoverPoints)===-1){this.setState();chart.hoverPoint=null;}},importEvents:function(){if(!this.hasImportedEvents){var point=this,options=merge(point.series.options.point,point.options),events=options.events,eventType;point.events=events;for(eventType in events){addEvent(point,eventType,events[eventType]);}
this.hasImportedEvents=true;}},setState:function(state,move){var point=this,plotX=mathFloor(point.plotX),plotY=point.plotY,series=point.series,stateOptions=series.options.states,markerOptions=defaultPlotOptions[series.type].marker&&series.options.marker,normalDisabled=markerOptions&&!markerOptions.enabled,markerStateOptions=markerOptions&&markerOptions.states[state],stateDisabled=markerStateOptions&&markerStateOptions.enabled===false,stateMarkerGraphic=series.stateMarkerGraphic,pointMarker=point.marker||{},chart=series.chart,radius,halo=series.halo,haloOptions,newSymbol,pointAttr;state=state||NORMAL_STATE;pointAttr=point.pointAttr[state]||series.pointAttr[state];if((state===point.state&&!move)||(point.selected&&state!==SELECT_STATE)||(stateOptions[state]&&stateOptions[state].enabled===false)||(state&&(stateDisabled||(normalDisabled&&markerStateOptions.enabled===false)))||(state&&pointMarker.states&&pointMarker.states[state]&&pointMarker.states[state].enabled===false)){return;}
if(point.graphic){radius=markerOptions&&point.graphic.symbolName&&pointAttr.r;point.graphic.attr(merge(pointAttr,radius?{x:plotX-radius,y:plotY-radius,width:2*radius,height:2*radius}:{}));if(stateMarkerGraphic){stateMarkerGraphic.hide();}}else{if(state&&markerStateOptions){radius=markerStateOptions.radius;newSymbol=pointMarker.symbol||series.symbol;if(stateMarkerGraphic&&stateMarkerGraphic.currentSymbol!==newSymbol){stateMarkerGraphic=stateMarkerGraphic.destroy();}
if(!stateMarkerGraphic){if(newSymbol){series.stateMarkerGraphic=stateMarkerGraphic=chart.renderer.symbol(newSymbol,plotX-radius,plotY-radius,2*radius,2*radius).attr(pointAttr).add(series.markerGroup);stateMarkerGraphic.currentSymbol=newSymbol;}}else{stateMarkerGraphic[move?'animate':'attr']({x:plotX-radius,y:plotY-radius});}}
if(stateMarkerGraphic){stateMarkerGraphic[state&&chart.isInsidePlot(plotX,plotY,chart.inverted)?'show':'hide']();stateMarkerGraphic.element.point=point;}}
haloOptions=stateOptions[state]&&stateOptions[state].halo;if(haloOptions&&haloOptions.size){if(!halo){series.halo=halo=chart.renderer.path().add(chart.seriesGroup);}
halo.attr(extend({'fill':point.color||series.color,'fill-opacity':haloOptions.opacity,'zIndex':-1},haloOptions.attributes))[move?'animate':'attr']({d:point.haloPath(haloOptions.size)});}else if(halo){halo.attr({d:[]});}
point.state=state;},haloPath:function(size){var series=this.series,chart=series.chart,plotBox=series.getPlotBox(),inverted=chart.inverted,plotX=Math.floor(this.plotX);return chart.renderer.symbols.circle(plotBox.translateX+(inverted?series.yAxis.len-this.plotY:plotX)-size,plotBox.translateY+(inverted?series.xAxis.len-plotX:this.plotY)-size,size*2,size*2);}});extend(Series.prototype,{onMouseOver:function(){var series=this,chart=series.chart,hoverSeries=chart.hoverSeries;if(hoverSeries&&hoverSeries!==series){hoverSeries.onMouseOut();}
if(series.options.events.mouseOver){fireEvent(series,'mouseOver');}
series.setState(HOVER_STATE);chart.hoverSeries=series;},onMouseOut:function(){var series=this,options=series.options,chart=series.chart,tooltip=chart.tooltip,hoverPoint=chart.hoverPoint;chart.hoverSeries=null;if(hoverPoint){hoverPoint.onMouseOut();}
if(series&&options.events.mouseOut){fireEvent(series,'mouseOut');}
if(tooltip&&!options.stickyTracking&&(!tooltip.shared||series.noSharedTooltip)){tooltip.hide();}
series.setState();},setState:function(state){var series=this,options=series.options,graph=series.graph,stateOptions=options.states,lineWidth=options.lineWidth,attribs,i=0;state=state||NORMAL_STATE;if(series.state!==state){series.state=state;if(stateOptions[state]&&stateOptions[state].enabled===false){return;}
if(state){lineWidth=stateOptions[state].lineWidth||lineWidth+(stateOptions[state].lineWidthPlus||0);}
if(graph&&!graph.dashstyle){attribs={'stroke-width':lineWidth};graph.attr(attribs);while(series['zoneGraph'+i]){series['zoneGraph'+i].attr(attribs);i=i+1;}}}},setVisible:function(vis,redraw){var series=this,chart=series.chart,legendItem=series.legendItem,showOrHide,ignoreHiddenSeries=chart.options.chart.ignoreHiddenSeries,oldVisibility=series.visible;series.visible=vis=series.userOptions.visible=vis===UNDEFINED?!oldVisibility:vis;showOrHide=vis?'show':'hide';each(['group','dataLabelsGroup','markerGroup','tracker'],function(key){if(series[key]){series[key][showOrHide]();}});if(chart.hoverSeries===series||(chart.hoverPoint&&chart.hoverPoint.series)===series){series.onMouseOut();}
if(legendItem){chart.legend.colorizeItem(series,vis);}
series.isDirty=true;if(series.options.stacking){each(chart.series,function(otherSeries){if(otherSeries.options.stacking&&otherSeries.visible){otherSeries.isDirty=true;}});}
each(series.linkedSeries,function(otherSeries){otherSeries.setVisible(vis,false);});if(ignoreHiddenSeries){chart.isDirtyBox=true;}
if(redraw!==false){chart.redraw();}
fireEvent(series,showOrHide);},show:function(){this.setVisible(true);},hide:function(){this.setVisible(false);},select:function(selected){var series=this;series.selected=selected=(selected===UNDEFINED)?!series.selected:selected;if(series.checkbox){series.checkbox.checked=selected;}
fireEvent(series,selected?'select':'unselect');},drawTracker:TrackerMixin.drawTrackerGraph});wrap(Series.prototype,'init',function(proceed){var series=this,xAxis;proceed.apply(this,Array.prototype.slice.call(arguments,1));xAxis=series.xAxis;if(xAxis&&xAxis.options.ordinal){addEvent(series,'updatedData',function(){delete xAxis.ordinalIndex;});}});wrap(Axis.prototype,'getTimeTicks',function(proceed,normalizedInterval,min,max,startOfWeek,positions,closestDistance,findHigherRanks){var start=0,end,segmentPositions,higherRanks={},hasCrossedHigherRank,info,posLength,outsideMax,groupPositions=[],lastGroupPosition=-Number.MAX_VALUE,tickPixelIntervalOption=this.options.tickPixelInterval;if((!this.options.ordinal&&!this.options.breaks)||!positions||positions.length<3||min===UNDEFINED){return proceed.call(this,normalizedInterval,min,max,startOfWeek);}
posLength=positions.length;for(end=0;end<posLength;end++){outsideMax=end&&positions[end-1]>max;if(positions[end]<min){start=end;}
if(end===posLength-1||positions[end+1]-positions[end]>closestDistance*5||outsideMax){if(positions[end]>lastGroupPosition){segmentPositions=proceed.call(this,normalizedInterval,positions[start],positions[end],startOfWeek);while(segmentPositions.length&&segmentPositions[0]<=lastGroupPosition){segmentPositions.shift();}
if(segmentPositions.length){lastGroupPosition=segmentPositions[segmentPositions.length-1];}
groupPositions=groupPositions.concat(segmentPositions);}
start=end+1;}
if(outsideMax){break;}}
info=segmentPositions.info;if(findHigherRanks&&info.unitRange<=timeUnits.hour){end=groupPositions.length-1;for(start=1;start<end;start++){if(dateFormat('%d',groupPositions[start])!==dateFormat('%d',groupPositions[start-1])){higherRanks[groupPositions[start]]='day';hasCrossedHigherRank=true;}}
if(hasCrossedHigherRank){higherRanks[groupPositions[0]]='day';}
info.higherRanks=higherRanks;}
groupPositions.info=info;if(findHigherRanks&&defined(tickPixelIntervalOption)){var length=groupPositions.length,i=length,itemToRemove,translated,translatedArr=[],lastTranslated,medianDistance,distance,distances=[];while(i--){translated=this.translate(groupPositions[i]);if(lastTranslated){distances[i]=lastTranslated-translated;}
translatedArr[i]=lastTranslated=translated;}
distances.sort();medianDistance=distances[mathFloor(distances.length/2)];if(medianDistance<tickPixelIntervalOption*0.6){medianDistance=null;}
i=groupPositions[length-1]>max?length-1:length;lastTranslated=undefined;while(i--){translated=translatedArr[i];distance=lastTranslated-translated;if(lastTranslated&&distance<tickPixelIntervalOption*0.8&&(medianDistance===null||distance<medianDistance*0.8)){if(higherRanks[groupPositions[i]]&&!higherRanks[groupPositions[i+1]]){itemToRemove=i+1;lastTranslated=translated;}else{itemToRemove=i;}
groupPositions.splice(itemToRemove,1);}else{lastTranslated=translated;}}}
return groupPositions;});extend(Axis.prototype,{beforeSetTickPositions:function(){var axis=this,len,ordinalPositions=[],useOrdinal=false,dist,extremes=axis.getExtremes(),min=extremes.min,max=extremes.max,minIndex,maxIndex,slope,hasBreaks=axis.isXAxis&&!!axis.options.breaks,isOrdinal=axis.options.ordinal,i;if(isOrdinal||hasBreaks){each(axis.series,function(series,i){if(series.visible!==false&&(series.takeOrdinalPosition!==false||hasBreaks)){ordinalPositions=ordinalPositions.concat(series.processedXData);len=ordinalPositions.length;ordinalPositions.sort(function(a,b){return a-b;});if(len){i=len-1;while(i--){if(ordinalPositions[i]===ordinalPositions[i+1]){ordinalPositions.splice(i,1);}}}}});len=ordinalPositions.length;if(len>2){dist=ordinalPositions[1]-ordinalPositions[0];i=len-1;while(i--&&!useOrdinal){if(ordinalPositions[i+1]-ordinalPositions[i]!==dist){useOrdinal=true;}}
if(!axis.options.keepOrdinalPadding&&(ordinalPositions[0]-min>dist||max-ordinalPositions[ordinalPositions.length-1]>dist)){useOrdinal=true;}}
if(useOrdinal){axis.ordinalPositions=ordinalPositions;minIndex=axis.val2lin(mathMax(min,ordinalPositions[0]),true);maxIndex=mathMax(axis.val2lin(mathMin(max,ordinalPositions[ordinalPositions.length-1]),true),1);axis.ordinalSlope=slope=(max-min)/(maxIndex-minIndex);axis.ordinalOffset=min-(minIndex*slope);}else{axis.ordinalPositions=axis.ordinalSlope=axis.ordinalOffset=UNDEFINED;}}
axis.isOrdinal=isOrdinal&&useOrdinal;axis.groupIntervalFactor=null;},val2lin:function(val,toIndex){var axis=this,ordinalPositions=axis.ordinalPositions,ret;if(!ordinalPositions){ret=val;}else{var ordinalLength=ordinalPositions.length,i,distance,ordinalIndex;i=ordinalLength;while(i--){if(ordinalPositions[i]===val){ordinalIndex=i;break;}}
i=ordinalLength-1;while(i--){if(val>ordinalPositions[i]||i===0){distance=(val-ordinalPositions[i])/(ordinalPositions[i+1]-ordinalPositions[i]);ordinalIndex=i+distance;break;}}
ret=toIndex?ordinalIndex:axis.ordinalSlope*(ordinalIndex||0)+axis.ordinalOffset;}
return ret;},lin2val:function(val,fromIndex){var axis=this,ordinalPositions=axis.ordinalPositions,ret;if(!ordinalPositions){ret=val;}else{var ordinalSlope=axis.ordinalSlope,ordinalOffset=axis.ordinalOffset,i=ordinalPositions.length-1,linearEquivalentLeft,linearEquivalentRight,distance;if(fromIndex){if(val<0){val=ordinalPositions[0];}else if(val>i){val=ordinalPositions[i];}else{i=mathFloor(val);distance=val-i;}}else{while(i--){linearEquivalentLeft=(ordinalSlope*i)+ordinalOffset;if(val>=linearEquivalentLeft){linearEquivalentRight=(ordinalSlope*(i+1))+ordinalOffset;distance=(val-linearEquivalentLeft)/(linearEquivalentRight-linearEquivalentLeft);break;}}}
ret=distance!==UNDEFINED&&ordinalPositions[i]!==UNDEFINED?ordinalPositions[i]+(distance?distance*(ordinalPositions[i+1]-ordinalPositions[i]):0):val;}
return ret;},getExtendedPositions:function(){var axis=this,chart=axis.chart,grouping=axis.series[0].currentDataGrouping,ordinalIndex=axis.ordinalIndex,key=grouping?grouping.count+grouping.unitName:'raw',extremes=axis.getExtremes(),fakeAxis,fakeSeries;if(!ordinalIndex){ordinalIndex=axis.ordinalIndex={};}
if(!ordinalIndex[key]){fakeAxis={series:[],getExtremes:function(){return{min:extremes.dataMin,max:extremes.dataMax};},options:{ordinal:true},val2lin:Axis.prototype.val2lin};each(axis.series,function(series){fakeSeries={xAxis:fakeAxis,xData:series.xData,chart:chart,destroyGroupedData:noop};fakeSeries.options={dataGrouping:grouping?{enabled:true,forced:true,approximation:'open',units:[[grouping.unitName,[grouping.count]]]}:{enabled:false}};series.processData.apply(fakeSeries);fakeAxis.series.push(fakeSeries);});axis.beforeSetTickPositions.apply(fakeAxis);ordinalIndex[key]=fakeAxis.ordinalPositions;}
return ordinalIndex[key];},getGroupIntervalFactor:function(xMin,xMax,series){var i,processedXData=series.processedXData,len=processedXData.length,distances=[],median,groupIntervalFactor=this.groupIntervalFactor;if(!groupIntervalFactor){for(i=0;i<len-1;i++){distances[i]=processedXData[i+1]-processedXData[i];}
distances.sort(function(a,b){return a-b;});median=distances[mathFloor(len/2)];xMin=mathMax(xMin,processedXData[0]);xMax=mathMin(xMax,processedXData[len-1]);this.groupIntervalFactor=groupIntervalFactor=(len*median)/(xMax-xMin);}
return groupIntervalFactor;},postProcessTickInterval:function(tickInterval){var ordinalSlope=this.ordinalSlope,ret;if(ordinalSlope){if(!this.options.breaks){ret=tickInterval/(ordinalSlope/this.closestPointRange);}else{ret=this.closestPointRange;}}else{ret=tickInterval;}
return ret;}});wrap(Chart.prototype,'pan',function(proceed,e){var chart=this,xAxis=chart.xAxis[0],chartX=e.chartX,runBase=false;if(xAxis.options.ordinal&&xAxis.series.length){var mouseDownX=chart.mouseDownX,extremes=xAxis.getExtremes(),dataMax=extremes.dataMax,min=extremes.min,max=extremes.max,trimmedRange,hoverPoints=chart.hoverPoints,closestPointRange=xAxis.closestPointRange,pointPixelWidth=xAxis.translationSlope*(xAxis.ordinalSlope||closestPointRange),movedUnits=(mouseDownX-chartX)/pointPixelWidth,extendedAxis={ordinalPositions:xAxis.getExtendedPositions()},ordinalPositions,searchAxisLeft,lin2val=xAxis.lin2val,val2lin=xAxis.val2lin,searchAxisRight;if(!extendedAxis.ordinalPositions){runBase=true;}else if(mathAbs(movedUnits)>1){if(hoverPoints){each(hoverPoints,function(point){point.setState();});}
if(movedUnits<0){searchAxisLeft=extendedAxis;searchAxisRight=xAxis.ordinalPositions?xAxis:extendedAxis;}else{searchAxisLeft=xAxis.ordinalPositions?xAxis:extendedAxis;searchAxisRight=extendedAxis;}
ordinalPositions=searchAxisRight.ordinalPositions;if(dataMax>ordinalPositions[ordinalPositions.length-1]){ordinalPositions.push(dataMax);}
chart.fixedRange=max-min;trimmedRange=xAxis.toFixedRange(null,null,lin2val.apply(searchAxisLeft,[val2lin.apply(searchAxisLeft,[min,true])+movedUnits,true]),lin2val.apply(searchAxisRight,[val2lin.apply(searchAxisRight,[max,true])+movedUnits,true]));if(trimmedRange.min>=mathMin(extremes.dataMin,min)&&trimmedRange.max<=mathMax(dataMax,max)){xAxis.setExtremes(trimmedRange.min,trimmedRange.max,true,false,{trigger:'pan'});}
chart.mouseDownX=chartX;css(chart.container,{cursor:'move'});}}else{runBase=true;}
if(runBase){proceed.apply(this,Array.prototype.slice.call(arguments,1));}});Series.prototype.gappedPath=function(){var gapSize=this.options.gapSize,points=this.points.slice(),i=points.length-1;if(gapSize&&i>0){while(i--){if(points[i+1].x-points[i].x>this.closestPointRange*gapSize){points.splice(i+1,0,{isNull:true});}}}
return this.getGraphPath(points);};(function(factory){factory(Highcharts);}(function(H){'use strict';var pick=H.pick,wrap=H.wrap,each=H.each,extend=H.extend,fireEvent=H.fireEvent,Axis=H.Axis,Series=H.Series;function stripArguments(){return Array.prototype.slice.call(arguments,1);}
extend(Axis.prototype,{isInBreak:function(brk,val){var ret,repeat=brk.repeat||Infinity,from=brk.from,length=brk.to-brk.from,test=(val>=from?(val-from)%repeat:repeat-((from-val)%repeat));if(!brk.inclusive){ret=test<length&&test!==0;}else{ret=test<=length;}
return ret;},isInAnyBreak:function(val,testKeep){var breaks=this.options.breaks,i=breaks&&breaks.length,inbrk,keep,ret;if(i){while(i--){if(this.isInBreak(breaks[i],val)){inbrk=true;if(!keep){keep=pick(breaks[i].showPoints,this.isXAxis?false:true);}}}
if(inbrk&&testKeep){ret=inbrk&&!keep;}else{ret=inbrk;}}
return ret;}});wrap(Axis.prototype,'setTickPositions',function(proceed){proceed.apply(this,Array.prototype.slice.call(arguments,1));if(this.options.breaks){var axis=this,tickPositions=this.tickPositions,info=this.tickPositions.info,newPositions=[],i;for(i=0;i<tickPositions.length;i++){if(!axis.isInAnyBreak(tickPositions[i])){newPositions.push(tickPositions[i]);}}
this.tickPositions=newPositions;this.tickPositions.info=info;}});wrap(Axis.prototype,'init',function(proceed,chart,userOptions){if(userOptions.breaks&&userOptions.breaks.length){userOptions.ordinal=false;}
proceed.call(this,chart,userOptions);if(this.options.breaks){var axis=this;axis.isBroken=true;this.val2lin=function(val){var nval=val,brk,i;for(i=0;i<axis.breakArray.length;i++){brk=axis.breakArray[i];if(brk.to<=val){nval-=brk.len;}else if(brk.from>=val){break;}else if(axis.isInBreak(brk,val)){nval-=(val-brk.from);break;}}
return nval;};this.lin2val=function(val){var nval=val,brk,i;for(i=0;i<axis.breakArray.length;i++){brk=axis.breakArray[i];if(brk.from>=nval){break;}else if(brk.to<nval){nval+=brk.len;}else if(axis.isInBreak(brk,nval)){nval+=brk.len;}}
return nval;};this.setExtremes=function(newMin,newMax,redraw,animation,eventArguments){while(this.isInAnyBreak(newMin)){newMin-=this.closestPointRange;}
while(this.isInAnyBreak(newMax)){newMax-=this.closestPointRange;}
Axis.prototype.setExtremes.call(this,newMin,newMax,redraw,animation,eventArguments);};this.setAxisTranslation=function(saveOld){Axis.prototype.setAxisTranslation.call(this,saveOld);var breaks=axis.options.breaks,breakArrayT=[],breakArray=[],length=0,inBrk,repeat,brk,min=axis.userMin||axis.min,max=axis.userMax||axis.max,start,i,j;for(i in breaks){brk=breaks[i];repeat=brk.repeat||Infinity;if(axis.isInBreak(brk,min)){min+=(brk.to%repeat)-(min%repeat);}
if(axis.isInBreak(brk,max)){max-=(max%repeat)-(brk.from%repeat);}}
for(i in breaks){brk=breaks[i];start=brk.from;repeat=brk.repeat||Infinity;while(start-repeat>min){start-=repeat;}
while(start<min){start+=repeat;}
for(j=start;j<max;j+=repeat){breakArrayT.push({value:j,move:'in'});breakArrayT.push({value:j+(brk.to-brk.from),move:'out',size:brk.breakSize});}}
breakArrayT.sort(function(a,b){var ret;if(a.value===b.value){ret=(a.move==='in'?0:1)-(b.move==='in'?0:1);}else{ret=a.value-b.value;}
return ret;});inBrk=0;start=min;for(i in breakArrayT){brk=breakArrayT[i];inBrk+=(brk.move==='in'?1:-1);if(inBrk===1&&brk.move==='in'){start=brk.value;}
if(inBrk===0){breakArray.push({from:start,to:brk.value,len:brk.value-start-(brk.size||0)});length+=brk.value-start-(brk.size||0);}}
axis.breakArray=breakArray;fireEvent(axis,'afterBreaks');axis.transA*=((max-axis.min)/(max-min-length));axis.min=min;axis.max=max;};}});wrap(Series.prototype,'generatePoints',function(proceed){proceed.apply(this,stripArguments(arguments));var series=this,xAxis=series.xAxis,yAxis=series.yAxis,points=series.points,point,i=points.length,connectNulls=series.options.connectNulls,nullGap;if(xAxis&&yAxis&&(xAxis.options.breaks||yAxis.options.breaks)){while(i--){point=points[i];nullGap=point.y===null&&connectNulls===false;if(!nullGap&&(xAxis.isInAnyBreak(point.x,true)||yAxis.isInAnyBreak(point.y,true))){points.splice(i,1);if(this.data[i]){this.data[i].destroyElements();}}}}});function drawPointsWrapped(proceed){proceed.apply(this);this.drawBreaks(this.xAxis,['x']);this.drawBreaks(this.yAxis,pick(this.pointArrayMap,['y']));}
H.Series.prototype.drawBreaks=function(axis,keys){var series=this,points=series.points,breaks,threshold,eventName,y;each(keys,function(key){breaks=axis.breakArray||[];threshold=axis.isXAxis?axis.min:pick(series.options.threshold,axis.min);each(points,function(point){y=pick(point['stack'+key.toUpperCase()],point[key]);each(breaks,function(brk){eventName=false;if((threshold<brk.from&&y>brk.to)||(threshold>brk.from&&y<brk.from)){eventName='pointBreak';}else if((threshold<brk.from&&y>brk.from&&y<brk.to)||(threshold>brk.from&&y>brk.to&&y<brk.from)){eventName='pointInBreak';}
if(eventName){fireEvent(axis,eventName,{point:point,brk:brk});}});});});};wrap(H.seriesTypes.column.prototype,'drawPoints',drawPointsWrapped);wrap(H.Series.prototype,'drawPoints',drawPointsWrapped);}));var DATA_GROUPING='dataGrouping',seriesProto=Series.prototype,baseProcessData=seriesProto.processData,baseGeneratePoints=seriesProto.generatePoints,baseDestroy=seriesProto.destroy,commonOptions={approximation:'average',groupPixelWidth:2,dateTimeLabelFormats:{millisecond:['%A, %b %e, %H:%M:%S.%L','%A, %b %e, %H:%M:%S.%L','-%H:%M:%S.%L'],second:['%A, %b %e, %H:%M:%S','%A, %b %e, %H:%M:%S','-%H:%M:%S'],minute:['%A, %b %e, %H:%M','%A, %b %e, %H:%M','-%H:%M'],hour:['%A, %b %e, %H:%M','%A, %b %e, %H:%M','-%H:%M'],day:['%A, %b %e, %Y','%A, %b %e','-%A, %b %e, %Y'],week:['Week from %A, %b %e, %Y','%A, %b %e','-%A, %b %e, %Y'],month:['%B %Y','%B','-%B %Y'],year:['%Y','%Y','-%Y']}},specificOptions={line:{},spline:{},area:{},areaspline:{},column:{approximation:'sum',groupPixelWidth:10},arearange:{approximation:'range'},areasplinerange:{approximation:'range'},columnrange:{approximation:'range',groupPixelWidth:10},candlestick:{approximation:'ohlc',groupPixelWidth:10},ohlc:{approximation:'ohlc',groupPixelWidth:5}},defaultDataGroupingUnits=[['millisecond',[1,2,5,10,20,25,50,100,200,500]],['second',[1,2,5,10,15,30]],['minute',[1,2,5,10,15,30]],['hour',[1,2,3,4,6,8,12]],['day',[1]],['week',[1]],['month',[1,3,6]],['year',null]],approximations={sum:function(arr){var len=arr.length,ret;if(!len&&arr.hasNulls){ret=null;}else if(len){ret=0;while(len--){ret+=arr[len];}}
return ret;},average:function(arr){var len=arr.length,ret=approximations.sum(arr);if(typeof ret==='number'&&len){ret=ret/len;}
return ret;},open:function(arr){return arr.length?arr[0]:(arr.hasNulls?null:UNDEFINED);},high:function(arr){return arr.length?arrayMax(arr):(arr.hasNulls?null:UNDEFINED);},low:function(arr){return arr.length?arrayMin(arr):(arr.hasNulls?null:UNDEFINED);},close:function(arr){return arr.length?arr[arr.length-1]:(arr.hasNulls?null:UNDEFINED);},ohlc:function(open,high,low,close){open=approximations.open(open);high=approximations.high(high);low=approximations.low(low);close=approximations.close(close);if(typeof open==='number'||typeof high==='number'||typeof low==='number'||typeof close==='number'){return[open,high,low,close];}},range:function(low,high){low=approximations.low(low);high=approximations.high(high);if(typeof low==='number'||typeof high==='number'){return[low,high];}}};seriesProto.groupData=function(xData,yData,groupPositions,approximation){var series=this,data=series.data,dataOptions=series.options.data,groupedXData=[],groupedYData=[],groupMap=[],dataLength=xData.length,pointX,pointY,groupedY,handleYData=!!yData,values=[[],[],[],[]],approximationFn=typeof approximation==='function'?approximation:approximations[approximation],pointArrayMap=series.pointArrayMap,pointArrayMapLength=pointArrayMap&&pointArrayMap.length,i,start=0;for(i=0;i<=dataLength;i++){if(xData[i]>=groupPositions[0]){break;}}
for(i;i<=dataLength;i++){while((groupPositions[1]!==UNDEFINED&&xData[i]>=groupPositions[1])||i===dataLength){pointX=groupPositions.shift();groupedY=approximationFn.apply(0,values);if(groupedY!==UNDEFINED){groupedXData.push(pointX);groupedYData.push(groupedY);groupMap.push({start:start,length:values[0].length});}
start=i;values[0]=[];values[1]=[];values[2]=[];values[3]=[];if(i===dataLength){break;}}
if(i===dataLength){break;}
if(pointArrayMap){var index=series.cropStart+i,point=(data&&data[index])||series.pointClass.prototype.applyOptions.apply({series:series},[dataOptions[index]]),j,val;for(j=0;j<pointArrayMapLength;j++){val=point[pointArrayMap[j]];if(typeof val==='number'){values[j].push(val);}else if(val===null){values[j].hasNulls=true;}}}else{pointY=handleYData?yData[i]:null;if(typeof pointY==='number'){values[0].push(pointY);}else if(pointY===null){values[0].hasNulls=true;}}}
return[groupedXData,groupedYData,groupMap];};seriesProto.processData=function(){var series=this,chart=series.chart,options=series.options,dataGroupingOptions=options[DATA_GROUPING],groupingEnabled=series.allowDG!==false&&dataGroupingOptions&&pick(dataGroupingOptions.enabled,chart.options._stock),hasGroupedData,skip;series.forceCrop=groupingEnabled;series.groupPixelWidth=null;series.hasProcessed=true;skip=baseProcessData.apply(series,arguments)===false||!groupingEnabled;if(!skip){series.destroyGroupedData();var i,processedXData=series.processedXData,processedYData=series.processedYData,plotSizeX=chart.plotSizeX,xAxis=series.xAxis,ordinal=xAxis.options.ordinal,groupPixelWidth=series.groupPixelWidth=xAxis.getGroupPixelWidth&&xAxis.getGroupPixelWidth();if(groupPixelWidth){hasGroupedData=true;series.points=null;var extremes=xAxis.getExtremes(),xMin=extremes.min,xMax=extremes.max,groupIntervalFactor=(ordinal&&xAxis.getGroupIntervalFactor(xMin,xMax,series))||1,interval=(groupPixelWidth*(xMax-xMin)/plotSizeX)*groupIntervalFactor,groupPositions=xAxis.getTimeTicks(xAxis.normalizeTimeTickInterval(interval,dataGroupingOptions.units||defaultDataGroupingUnits),Math.min(xMin,processedXData[0]),Math.max(xMax,processedXData[processedXData.length-1]),xAxis.options.startOfWeek,processedXData,series.closestPointRange),groupedData=seriesProto.groupData.apply(series,[processedXData,processedYData,groupPositions,dataGroupingOptions.approximation]),groupedXData=groupedData[0],groupedYData=groupedData[1];if(dataGroupingOptions.smoothed){i=groupedXData.length-1;groupedXData[i]=Math.min(groupedXData[i],xMax);while(i--&&i>0){groupedXData[i]+=interval/2;}
groupedXData[0]=Math.max(groupedXData[0],xMin);}
series.currentDataGrouping=groupPositions.info;series.closestPointRange=groupPositions.info.totalRange;series.groupMap=groupedData[2];if(defined(groupedXData[0])&&groupedXData[0]<xAxis.dataMin){if(xAxis.min===xAxis.dataMin){xAxis.min=groupedXData[0];}
xAxis.dataMin=groupedXData[0];}
series.processedXData=groupedXData;series.processedYData=groupedYData;}else{series.currentDataGrouping=series.groupMap=null;}
series.hasGroupedData=hasGroupedData;}};seriesProto.destroyGroupedData=function(){var groupedData=this.groupedData;each(groupedData||[],function(point,i){if(point){groupedData[i]=point.destroy?point.destroy():null;}});this.groupedData=null;};seriesProto.generatePoints=function(){baseGeneratePoints.apply(this);this.destroyGroupedData();this.groupedData=this.hasGroupedData?this.points:null;};wrap(Tooltip.prototype,'tooltipFooterHeaderFormatter',function(proceed,point,isFooter){var tooltip=this,series=point.series,options=series.options,tooltipOptions=series.tooltipOptions,dataGroupingOptions=options.dataGrouping,xDateFormat=tooltipOptions.xDateFormat,xDateFormatEnd,xAxis=series.xAxis,currentDataGrouping,dateTimeLabelFormats,labelFormats,formattedKey;if(xAxis&&xAxis.options.type==='datetime'&&dataGroupingOptions&&isNumber(point.key)){currentDataGrouping=series.currentDataGrouping;dateTimeLabelFormats=dataGroupingOptions.dateTimeLabelFormats;if(currentDataGrouping){labelFormats=dateTimeLabelFormats[currentDataGrouping.unitName];if(currentDataGrouping.count===1){xDateFormat=labelFormats[0];}else{xDateFormat=labelFormats[1];xDateFormatEnd=labelFormats[2];}}else if(!xDateFormat&&dateTimeLabelFormats){xDateFormat=tooltip.getXDateFormat(point,tooltipOptions,xAxis);}
formattedKey=dateFormat(xDateFormat,point.key);if(xDateFormatEnd){formattedKey+=dateFormat(xDateFormatEnd,point.key+currentDataGrouping.totalRange-1);}
return format(tooltipOptions[(isFooter?'footer':'header')+'Format'],{point:extend(point,{key:formattedKey}),series:series});}
return proceed.call(tooltip,point,isFooter);});seriesProto.destroy=function(){var series=this,groupedData=series.groupedData||[],i=groupedData.length;while(i--){if(groupedData[i]){groupedData[i].destroy();}}
baseDestroy.apply(series);};wrap(seriesProto,'setOptions',function(proceed,itemOptions){var options=proceed.call(this,itemOptions),type=this.type,plotOptions=this.chart.options.plotOptions,defaultOptions=defaultPlotOptions[type].dataGrouping;if(specificOptions[type]){if(!defaultOptions){defaultOptions=merge(commonOptions,specificOptions[type]);}
options.dataGrouping=merge(defaultOptions,plotOptions.series&&plotOptions.series.dataGrouping,plotOptions[type].dataGrouping,itemOptions.dataGrouping);}
if(this.chart.options._stock){this.requireSorting=true;}
return options;});wrap(Axis.prototype,'setScale',function(proceed){proceed.call(this);each(this.series,function(series){series.hasProcessed=false;});});Axis.prototype.getGroupPixelWidth=function(){var series=this.series,len=series.length,i,groupPixelWidth=0,doGrouping=false,dataLength,dgOptions;i=len;while(i--){dgOptions=series[i].options.dataGrouping;if(dgOptions){groupPixelWidth=mathMax(groupPixelWidth,dgOptions.groupPixelWidth);}}
i=len;while(i--){dgOptions=series[i].options.dataGrouping;if(dgOptions&&series[i].hasProcessed){dataLength=(series[i].processedXData||series[i].data).length;if(series[i].groupPixelWidth||dataLength>(this.chart.plotSizeX/groupPixelWidth)||(dataLength&&dgOptions.forced)){doGrouping=true;}}}
return doGrouping?groupPixelWidth:0;};Axis.prototype.setDataGrouping=function(dataGrouping,redraw){var i;redraw=pick(redraw,true);if(!dataGrouping){dataGrouping={forced:false,units:null};}
if(this instanceof Axis){i=this.series.length;while(i--){this.series[i].update({dataGrouping:dataGrouping},false);}}else{each(this.chart.options.series,function(seriesOptions){seriesOptions.dataGrouping=dataGrouping;},false);}
if(redraw){this.chart.redraw();}};defaultPlotOptions.ohlc=merge(defaultPlotOptions.column,{lineWidth:1,tooltip:{pointFormat:'<span style="color:{point.color}">\u25CF</span> <b> {series.name}</b><br/>'+'Open: {point.open}<br/>'+'High: {point.high}<br/>'+'Low: {point.low}<br/>'+'Close: {point.close}<br/>'},states:{hover:{lineWidth:3}},threshold:null});var OHLCSeries=extendClass(seriesTypes.column,{type:'ohlc',pointArrayMap:['open','high','low','close'],toYData:function(point){return[point.open,point.high,point.low,point.close];},pointValKey:'high',pointAttrToOptions:{stroke:'color','stroke-width':'lineWidth'},upColorProp:'stroke',getAttribs:function(){seriesTypes.column.prototype.getAttribs.apply(this,arguments);var series=this,options=series.options,stateOptions=options.states,upColor=options.upColor||series.color,seriesDownPointAttr=merge(series.pointAttr),upColorProp=series.upColorProp;seriesDownPointAttr[''][upColorProp]=upColor;seriesDownPointAttr.hover[upColorProp]=stateOptions.hover.upColor||upColor;seriesDownPointAttr.select[upColorProp]=stateOptions.select.upColor||upColor;each(series.points,function(point){if(point.open<point.close&&!point.options.color){point.pointAttr=seriesDownPointAttr;}});},translate:function(){var series=this,yAxis=series.yAxis;seriesTypes.column.prototype.translate.apply(series);each(series.points,function(point){if(point.open!==null){point.plotOpen=yAxis.translate(point.open,0,1,0,1);}
if(point.close!==null){point.plotClose=yAxis.translate(point.close,0,1,0,1);}});},drawPoints:function(){var series=this,points=series.points,chart=series.chart,pointAttr,plotOpen,plotClose,crispCorr,halfWidth,path,graphic,crispX;each(points,function(point){if(point.plotY!==UNDEFINED){graphic=point.graphic;pointAttr=point.pointAttr[point.selected?'selected':'']||series.pointAttr[NORMAL_STATE];crispCorr=(pointAttr['stroke-width']%2)/2;crispX=mathRound(point.plotX)-crispCorr;halfWidth=mathRound(point.shapeArgs.width/2);path=['M',crispX,mathRound(point.yBottom),'L',crispX,mathRound(point.plotY)];if(point.open!==null){plotOpen=mathRound(point.plotOpen)+crispCorr;path.push('M',crispX,plotOpen,'L',crispX-halfWidth,plotOpen);}
if(point.close!==null){plotClose=mathRound(point.plotClose)+crispCorr;path.push('M',crispX,plotClose,'L',crispX+halfWidth,plotClose);}
if(graphic){graphic.attr(pointAttr).animate({d:path});}else{point.graphic=chart.renderer.path(path).attr(pointAttr).add(series.group);}}});},animate:null});seriesTypes.ohlc=OHLCSeries;defaultPlotOptions.candlestick=merge(defaultPlotOptions.column,{lineColor:'black',lineWidth:1,states:{hover:{lineWidth:2}},tooltip:defaultPlotOptions.ohlc.tooltip,threshold:null,upColor:'white'});var CandlestickSeries=extendClass(OHLCSeries,{type:'candlestick',pointAttrToOptions:{fill:'color',stroke:'lineColor','stroke-width':'lineWidth'},upColorProp:'fill',getAttribs:function(){seriesTypes.ohlc.prototype.getAttribs.apply(this,arguments);var series=this,options=series.options,stateOptions=options.states,upLineColor=options.upLineColor||options.lineColor,hoverStroke=stateOptions.hover.upLineColor||upLineColor,selectStroke=stateOptions.select.upLineColor||upLineColor;each(series.points,function(point){if(point.open<point.close){if(point.lineColor){point.pointAttr=merge(point.pointAttr);upLineColor=point.lineColor;}
point.pointAttr[''].stroke=upLineColor;point.pointAttr.hover.stroke=hoverStroke;point.pointAttr.select.stroke=selectStroke;}});},drawPoints:function(){var series=this,points=series.points,chart=series.chart,pointAttr,seriesPointAttr=series.pointAttr[''],plotOpen,plotClose,topBox,bottomBox,hasTopWhisker,hasBottomWhisker,crispCorr,crispX,graphic,path,halfWidth;each(points,function(point){graphic=point.graphic;if(point.plotY!==UNDEFINED){pointAttr=point.pointAttr[point.selected?'selected':'']||seriesPointAttr;crispCorr=(pointAttr['stroke-width']%2)/2;crispX=mathRound(point.plotX)-crispCorr;plotOpen=point.plotOpen;plotClose=point.plotClose;topBox=math.min(plotOpen,plotClose);bottomBox=math.max(plotOpen,plotClose);halfWidth=mathRound(point.shapeArgs.width/2);hasTopWhisker=mathRound(topBox)!==mathRound(point.plotY);hasBottomWhisker=bottomBox!==point.yBottom;topBox=mathRound(topBox)+crispCorr;bottomBox=mathRound(bottomBox)+crispCorr;path=['M',crispX-halfWidth,bottomBox,'L',crispX-halfWidth,topBox,'L',crispX+halfWidth,topBox,'L',crispX+halfWidth,bottomBox,'Z','M',crispX,topBox,'L',crispX,hasTopWhisker?mathRound(point.plotY):topBox,'M',crispX,bottomBox,'L',crispX,hasBottomWhisker?mathRound(point.yBottom):bottomBox];if(graphic){graphic.attr(pointAttr).animate({d:path});}else{point.graphic=chart.renderer.path(path).attr(pointAttr).add(series.group).shadow(series.options.shadow);}}});}});seriesTypes.candlestick=CandlestickSeries;var symbols=SVGRenderer.prototype.symbols;defaultPlotOptions.flags=merge(defaultPlotOptions.column,{fillColor:'white',lineWidth:1,pointRange:0,shape:'flag',stackDistance:12,states:{hover:{lineColor:'black',fillColor:'#FCFFC5'}},style:{fontSize:'11px',fontWeight:'bold',textAlign:'center'},tooltip:{pointFormat:'{point.text}<br/>'},threshold:null,y:-30});seriesTypes.flags=extendClass(seriesTypes.column,{type:'flags',sorted:false,noSharedTooltip:true,allowDG:false,takeOrdinalPosition:false,trackerGroups:['markerGroup'],forceCrop:true,init:Series.prototype.init,pointAttrToOptions:{fill:'fillColor',stroke:'color','stroke-width':'lineWidth',r:'radius'},translate:function(){seriesTypes.column.prototype.translate.apply(this);var series=this,options=series.options,chart=series.chart,points=series.points,cursor=points.length-1,point,lastPoint,optionsOnSeries=options.onSeries,onSeries=optionsOnSeries&&chart.get(optionsOnSeries),onKey=options.onKey||'y',step=onSeries&&onSeries.options.step,onData=onSeries&&onSeries.points,i=onData&&onData.length,xAxis=series.xAxis,xAxisExt=xAxis.getExtremes(),leftPoint,lastX,rightPoint,currentDataGrouping;if(onSeries&&onSeries.visible&&i){currentDataGrouping=onSeries.currentDataGrouping;lastX=onData[i-1].x+(currentDataGrouping?currentDataGrouping.totalRange:0);points.sort(function(a,b){return(a.x-b.x);});onKey='plot'+onKey[0].toUpperCase()+onKey.substr(1);while(i--&&points[cursor]){point=points[cursor];leftPoint=onData[i];if(leftPoint.x<=point.x&&leftPoint[onKey]!==undefined){if(point.x<=lastX){point.plotY=leftPoint[onKey];if(leftPoint.x<point.x&&!step){rightPoint=onData[i+1];if(rightPoint&&rightPoint[onKey]!==UNDEFINED){point.plotY+=((point.x-leftPoint.x)/(rightPoint.x-leftPoint.x))*(rightPoint[onKey]-leftPoint[onKey]);}}}
cursor--;i++;if(cursor<0){break;}}}}
each(points,function(point,i){var stackIndex;if(point.plotY===UNDEFINED){if(point.x>=xAxisExt.min&&point.x<=xAxisExt.max){point.plotY=chart.chartHeight-xAxis.bottom-(xAxis.opposite?xAxis.height:0)+xAxis.offset-chart.plotTop;}else{point.shapeArgs={};}}
lastPoint=points[i-1];if(lastPoint&&lastPoint.plotX===point.plotX){if(lastPoint.stackIndex===UNDEFINED){lastPoint.stackIndex=0;}
stackIndex=lastPoint.stackIndex+1;}
point.stackIndex=stackIndex;});},drawPoints:function(){var series=this,pointAttr,seriesPointAttr=series.pointAttr[''],points=series.points,chart=series.chart,renderer=chart.renderer,plotX,plotY,options=series.options,optionsY=options.y,shape,i,point,graphic,stackIndex,anchorX,anchorY,outsideRight,yAxis=series.yAxis;i=points.length;while(i--){point=points[i];outsideRight=point.plotX>series.xAxis.len;plotX=point.plotX;if(plotX>0){plotX-=pick(point.lineWidth,options.lineWidth)%2;}
stackIndex=point.stackIndex;shape=point.options.shape||options.shape;plotY=point.plotY;if(plotY!==UNDEFINED){plotY=point.plotY+optionsY-(stackIndex!==UNDEFINED&&stackIndex*options.stackDistance);}
anchorX=stackIndex?UNDEFINED:point.plotX;anchorY=stackIndex?UNDEFINED:point.plotY;graphic=point.graphic;if(plotY!==UNDEFINED&&plotX>=0&&!outsideRight){pointAttr=point.pointAttr[point.selected?'select':'']||seriesPointAttr;if(graphic){graphic.attr({x:plotX,y:plotY,r:pointAttr.r,anchorX:anchorX,anchorY:anchorY});}else{graphic=point.graphic=renderer.label(point.options.title||options.title||'A',plotX,plotY,shape,anchorX,anchorY,options.useHTML).css(merge(options.style,point.style)).attr(pointAttr).attr({align:shape==='flag'?'left':'center',width:options.width,height:options.height}).add(series.markerGroup).shadow(options.shadow);}
point.tooltipPos=chart.inverted?[yAxis.len+yAxis.pos-chart.plotLeft-plotY,series.xAxis.len-plotX]:[plotX,plotY];}else if(graphic){point.graphic=graphic.destroy();}}},drawTracker:function(){var series=this,points=series.points;TrackerMixin.drawTrackerPoint.apply(this);each(points,function(point){var graphic=point.graphic;if(graphic){addEvent(graphic.element,'mouseover',function(){if(point.stackIndex>0&&!point.raised){point._y=graphic.y;graphic.attr({y:point._y-8});point.raised=true;}
each(points,function(otherPoint){if(otherPoint!==point&&otherPoint.raised&&otherPoint.graphic){otherPoint.graphic.attr({y:otherPoint._y});otherPoint.raised=false;}});});}});},animate:noop,buildKDTree:noop,setClip:noop});symbols.flag=function(x,y,w,h,options){var anchorX=(options&&options.anchorX)||x,anchorY=(options&&options.anchorY)||y;return['M',anchorX,anchorY,'L',x,y+h,x,y,x+w,y,x+w,y+h,x,y+h,'Z'];};each(['circle','square'],function(shape){symbols[shape+'pin']=function(x,y,w,h,options){var anchorX=options&&options.anchorX,anchorY=options&&options.anchorY,path,labelTopOrBottomY;if(shape==='circle'&&h>w){x-=mathRound((h-w)/2);w=h;}
path=symbols[shape](x,y,w,h);if(anchorX&&anchorY){labelTopOrBottomY=(y>anchorY)?y:y+h;path.push('M',anchorX,labelTopOrBottomY,'L',anchorX,anchorY);}
return path;};});if(Renderer===Highcharts.VMLRenderer){each(['flag','circlepin','squarepin'],function(shape){VMLRenderer.prototype.symbols[shape]=symbols[shape];});}
var units=[].concat(defaultDataGroupingUnits),defaultSeriesType,numExt=function(extreme){var numbers=grep(arguments,function(n){return typeof n==='number';});if(numbers.length){return Math[extreme].apply(0,numbers);}};units[4]=['day',[1,2,3,4]];units[5]=['week',[1,2,3]];defaultSeriesType=seriesTypes.areaspline===UNDEFINED?'line':'areaspline';extend(defaultOptions,{navigator:{handles:{backgroundColor:'#ebe7e8',borderColor:'#b2b1b6'},height:40,margin:25,maskFill:'rgba(128,179,236,0.3)',maskInside:true,outlineColor:'#b2b1b6',outlineWidth:1,series:{type:defaultSeriesType,color:'#4572A7',compare:null,fillOpacity:0.05,dataGrouping:{approximation:'average',enabled:true,groupPixelWidth:2,smoothed:true,units:units},dataLabels:{enabled:false,zIndex:2},id:PREFIX+'navigator-series',lineColor:null,lineWidth:1,marker:{enabled:false},pointRange:0,shadow:false,threshold:null},xAxis:{tickWidth:0,lineWidth:0,gridLineColor:'#EEE',gridLineWidth:1,tickPixelInterval:200,labels:{align:'left',style:{color:'#888'},x:3,y:-4},crosshair:false},yAxis:{gridLineWidth:0,startOnTick:false,endOnTick:false,minPadding:0.1,maxPadding:0.1,labels:{enabled:false},crosshair:false,title:{text:null},tickWidth:0}},scrollbar:{height:isTouchDevice?20:14,barBackgroundColor:'#bfc8d1',barBorderRadius:0,barBorderWidth:1,barBorderColor:'#bfc8d1',buttonArrowColor:'#666',buttonBackgroundColor:'#ebe7e8',buttonBorderColor:'#bbb',buttonBorderRadius:0,buttonBorderWidth:1,minWidth:6,rifleColor:'#666',trackBackgroundColor:'#eeeeee',trackBorderColor:'#eeeeee',trackBorderWidth:1,liveRedraw:hasSVG&&!isTouchDevice}});function Scroller(chart){var chartOptions=chart.options,navigatorOptions=chartOptions.navigator,navigatorEnabled=navigatorOptions.enabled,scrollbarOptions=chartOptions.scrollbar,scrollbarEnabled=scrollbarOptions.enabled,height=navigatorEnabled?navigatorOptions.height:0,scrollbarHeight=scrollbarEnabled?scrollbarOptions.height:0;this.handles=[];this.scrollbarButtons=[];this.elementsToDestroy=[];this.chart=chart;this.setBaseSeries();this.height=height;this.scrollbarHeight=scrollbarHeight;this.scrollbarEnabled=scrollbarEnabled;this.navigatorEnabled=navigatorEnabled;this.navigatorOptions=navigatorOptions;this.scrollbarOptions=scrollbarOptions;this.outlineHeight=height+scrollbarHeight;this.init();}
Scroller.prototype={drawHandle:function(x,index){var scroller=this,chart=scroller.chart,renderer=chart.renderer,elementsToDestroy=scroller.elementsToDestroy,handles=scroller.handles,handlesOptions=scroller.navigatorOptions.handles,attr={fill:handlesOptions.backgroundColor,stroke:handlesOptions.borderColor,'stroke-width':1},tempElem;if(!scroller.rendered){handles[index]=renderer.g('navigator-handle-'+['left','right'][index]).css({cursor:'ew-resize'}).attr({zIndex:10-index}).add();tempElem=renderer.rect(-4.5,0,9,16,0,1).attr(attr).add(handles[index]);elementsToDestroy.push(tempElem);tempElem=renderer.path(['M',-1.5,4,'L',-1.5,12,'M',0.5,4,'L',0.5,12]).attr(attr).add(handles[index]);elementsToDestroy.push(tempElem);}
handles[index][chart.isResizing?'animate':'attr']({translateX:scroller.scrollerLeft+scroller.scrollbarHeight+parseInt(x,10),translateY:scroller.top+scroller.height/2-8});},drawScrollbarButton:function(index){var scroller=this,chart=scroller.chart,renderer=chart.renderer,elementsToDestroy=scroller.elementsToDestroy,scrollbarButtons=scroller.scrollbarButtons,scrollbarHeight=scroller.scrollbarHeight,scrollbarOptions=scroller.scrollbarOptions,tempElem;if(!scroller.rendered){scrollbarButtons[index]=renderer.g().add(scroller.scrollbarGroup);tempElem=renderer.rect(-0.5,-0.5,scrollbarHeight+1,scrollbarHeight+1,scrollbarOptions.buttonBorderRadius,scrollbarOptions.buttonBorderWidth).attr({stroke:scrollbarOptions.buttonBorderColor,'stroke-width':scrollbarOptions.buttonBorderWidth,fill:scrollbarOptions.buttonBackgroundColor}).add(scrollbarButtons[index]);elementsToDestroy.push(tempElem);tempElem=renderer.path(['M',scrollbarHeight/2+(index?-1:1),scrollbarHeight/2-3,'L',scrollbarHeight/2+(index?-1:1),scrollbarHeight/2+3,scrollbarHeight/2+(index?2:-2),scrollbarHeight/2]).attr({fill:scrollbarOptions.buttonArrowColor}).add(scrollbarButtons[index]);elementsToDestroy.push(tempElem);}
if(index){scrollbarButtons[index].attr({translateX:scroller.scrollerWidth-scrollbarHeight});}},render:function(min,max,pxMin,pxMax){var scroller=this,chart=scroller.chart,renderer=chart.renderer,navigatorLeft,navigatorWidth,scrollerLeft,scrollerWidth,scrollbarGroup=scroller.scrollbarGroup,navigatorGroup=scroller.navigatorGroup,scrollbar=scroller.scrollbar,xAxis=scroller.xAxis,scrollbarTrack=scroller.scrollbarTrack,scrollbarHeight=scroller.scrollbarHeight,scrollbarEnabled=scroller.scrollbarEnabled,navigatorOptions=scroller.navigatorOptions,scrollbarOptions=scroller.scrollbarOptions,scrollbarMinWidth=scrollbarOptions.minWidth,height=scroller.height,top=scroller.top,navigatorEnabled=scroller.navigatorEnabled,outlineWidth=navigatorOptions.outlineWidth,halfOutline=outlineWidth/2,zoomedMin,zoomedMax,range,scrX,scrWidth,scrollbarPad=0,outlineHeight=scroller.outlineHeight,barBorderRadius=scrollbarOptions.barBorderRadius,strokeWidth,scrollbarStrokeWidth=scrollbarOptions.barBorderWidth,centerBarX,outlineTop=top+halfOutline,verb,unionExtremes;if(!defined(min)||isNaN(min)||!defined(max)||isNaN(max)||(scroller.hasDragged&&!defined(pxMin))){return;}
scroller.navigatorLeft=navigatorLeft=pick(xAxis.left,chart.plotLeft+scrollbarHeight);scroller.navigatorWidth=navigatorWidth=pick(xAxis.len,chart.plotWidth-2*scrollbarHeight);scroller.scrollerLeft=scrollerLeft=navigatorLeft-scrollbarHeight;scroller.scrollerWidth=scrollerWidth=scrollerWidth=navigatorWidth+2*scrollbarHeight;if(xAxis.getExtremes){unionExtremes=scroller.getUnionExtremes(true);if(unionExtremes&&(unionExtremes.dataMin!==xAxis.min||unionExtremes.dataMax!==xAxis.max)){xAxis.setExtremes(unionExtremes.dataMin,unionExtremes.dataMax,true,false);}}
pxMin=pick(pxMin,xAxis.translate(min));pxMax=pick(pxMax,xAxis.translate(max));if(isNaN(pxMin)||mathAbs(pxMin)===Infinity){pxMin=0;pxMax=scrollerWidth;}
if(xAxis.translate(pxMax,true)-xAxis.translate(pxMin,true)<chart.xAxis[0].minRange){return;}
scroller.zoomedMax=mathMin(mathMax(pxMin,pxMax,0),navigatorWidth);scroller.zoomedMin=mathMin(mathMax(scroller.fixedWidth?scroller.zoomedMax-scroller.fixedWidth:mathMin(pxMin,pxMax),0),navigatorWidth);scroller.range=scroller.zoomedMax-scroller.zoomedMin;zoomedMax=mathRound(scroller.zoomedMax);zoomedMin=mathRound(scroller.zoomedMin);range=zoomedMax-zoomedMin;if(!scroller.rendered){if(navigatorEnabled){scroller.navigatorGroup=navigatorGroup=renderer.g('navigator').attr({zIndex:3}).add();scroller.leftShade=renderer.rect().attr({fill:navigatorOptions.maskFill}).add(navigatorGroup);if(navigatorOptions.maskInside){scroller.leftShade.css({cursor:'ew-resize'});}else{scroller.rightShade=renderer.rect().attr({fill:navigatorOptions.maskFill}).add(navigatorGroup);}
scroller.outline=renderer.path().attr({'stroke-width':outlineWidth,stroke:navigatorOptions.outlineColor}).add(navigatorGroup);}
if(scrollbarEnabled){scroller.scrollbarGroup=scrollbarGroup=renderer.g('scrollbar').add();strokeWidth=scrollbarOptions.trackBorderWidth;scroller.scrollbarTrack=scrollbarTrack=renderer.rect().attr({x:0,y:-strokeWidth%2/2,fill:scrollbarOptions.trackBackgroundColor,stroke:scrollbarOptions.trackBorderColor,'stroke-width':strokeWidth,r:scrollbarOptions.trackBorderRadius||0,height:scrollbarHeight}).add(scrollbarGroup);scroller.scrollbar=scrollbar=renderer.rect().attr({y:-scrollbarStrokeWidth%2/2,height:scrollbarHeight,fill:scrollbarOptions.barBackgroundColor,stroke:scrollbarOptions.barBorderColor,'stroke-width':scrollbarStrokeWidth,r:barBorderRadius}).add(scrollbarGroup);scroller.scrollbarRifles=renderer.path().attr({stroke:scrollbarOptions.rifleColor,'stroke-width':1}).add(scrollbarGroup);}}
verb=chart.isResizing?'animate':'attr';if(navigatorEnabled){scroller.leftShade[verb](navigatorOptions.maskInside?{x:navigatorLeft+zoomedMin,y:top,width:zoomedMax-zoomedMin,height:height}:{x:navigatorLeft,y:top,width:zoomedMin,height:height});if(scroller.rightShade){scroller.rightShade[verb]({x:navigatorLeft+zoomedMax,y:top,width:navigatorWidth-zoomedMax,height:height});}
scroller.outline[verb]({d:[M,scrollerLeft,outlineTop,L,navigatorLeft+zoomedMin-halfOutline,outlineTop,navigatorLeft+zoomedMin-halfOutline,outlineTop+outlineHeight,L,navigatorLeft+zoomedMax-halfOutline,outlineTop+outlineHeight,L,navigatorLeft+zoomedMax-halfOutline,outlineTop,scrollerLeft+scrollerWidth,outlineTop].concat(navigatorOptions.maskInside?[M,navigatorLeft+zoomedMin+halfOutline,outlineTop,L,navigatorLeft+zoomedMax-halfOutline,outlineTop]:[])});scroller.drawHandle(zoomedMin+halfOutline,0);scroller.drawHandle(zoomedMax+halfOutline,1);}
if(scrollbarEnabled&&scrollbarGroup){scroller.drawScrollbarButton(0);scroller.drawScrollbarButton(1);scrollbarGroup[verb]({translateX:scrollerLeft,translateY:mathRound(outlineTop+height)});scrollbarTrack[verb]({width:scrollerWidth});scrX=scrollbarHeight+zoomedMin;scrWidth=range-scrollbarStrokeWidth;if(scrWidth<scrollbarMinWidth){scrollbarPad=(scrollbarMinWidth-scrWidth)/2;scrWidth=scrollbarMinWidth;scrX-=scrollbarPad;}
scroller.scrollbarPad=scrollbarPad;scrollbar[verb]({x:mathFloor(scrX)+(scrollbarStrokeWidth%2/2),width:scrWidth});centerBarX=scrollbarHeight+zoomedMin+range/2-0.5;scroller.scrollbarRifles.attr({visibility:range>12?VISIBLE:HIDDEN})[verb]({d:[M,centerBarX-3,scrollbarHeight/4,L,centerBarX-3,2*scrollbarHeight/3,M,centerBarX,scrollbarHeight/4,L,centerBarX,2*scrollbarHeight/3,M,centerBarX+3,scrollbarHeight/4,L,centerBarX+3,2*scrollbarHeight/3]});}
scroller.scrollbarPad=scrollbarPad;scroller.rendered=true;},addEvents:function(){var container=this.chart.container,mouseDownHandler=this.mouseDownHandler,mouseMoveHandler=this.mouseMoveHandler,mouseUpHandler=this.mouseUpHandler,_events;_events=[[container,'mousedown',mouseDownHandler],[container,'mousemove',mouseMoveHandler],[doc,'mouseup',mouseUpHandler]];if(hasTouch){_events.push([container,'touchstart',mouseDownHandler],[container,'touchmove',mouseMoveHandler],[doc,'touchend',mouseUpHandler]);}
each(_events,function(args){addEvent.apply(null,args);});this._events=_events;},removeEvents:function(){each(this._events,function(args){removeEvent.apply(null,args);});this._events=UNDEFINED;if(this.navigatorEnabled&&this.baseSeries){removeEvent(this.baseSeries,'updatedData',this.updatedDataHandler);}},init:function(){var scroller=this,chart=scroller.chart,xAxis,yAxis,scrollbarHeight=scroller.scrollbarHeight,navigatorOptions=scroller.navigatorOptions,height=scroller.height,top=scroller.top,dragOffset,baseSeries=scroller.baseSeries;scroller.mouseDownHandler=function(e){e=chart.pointer.normalize(e);var zoomedMin=scroller.zoomedMin,zoomedMax=scroller.zoomedMax,top=scroller.top,scrollbarHeight=scroller.scrollbarHeight,scrollerLeft=scroller.scrollerLeft,scrollerWidth=scroller.scrollerWidth,navigatorLeft=scroller.navigatorLeft,navigatorWidth=scroller.navigatorWidth,scrollbarPad=scroller.scrollbarPad,range=scroller.range,chartX=e.chartX,chartY=e.chartY,baseXAxis=chart.xAxis[0],fixedMax,ext,handleSensitivity=isTouchDevice?10:7,left,isOnNavigator;if(chartY>top&&chartY<top+height+scrollbarHeight){isOnNavigator=!scroller.scrollbarEnabled||chartY<top+height;if(isOnNavigator&&math.abs(chartX-zoomedMin-navigatorLeft)<handleSensitivity){scroller.grabbedLeft=true;scroller.otherHandlePos=zoomedMax;scroller.fixedExtreme=baseXAxis.max;chart.fixedRange=null;}else if(isOnNavigator&&math.abs(chartX-zoomedMax-navigatorLeft)<handleSensitivity){scroller.grabbedRight=true;scroller.otherHandlePos=zoomedMin;scroller.fixedExtreme=baseXAxis.min;chart.fixedRange=null;}else if(chartX>navigatorLeft+zoomedMin-scrollbarPad&&chartX<navigatorLeft+zoomedMax+scrollbarPad){scroller.grabbedCenter=chartX;scroller.fixedWidth=range;dragOffset=chartX-zoomedMin;}else if(chartX>scrollerLeft&&chartX<scrollerLeft+scrollerWidth){if(isOnNavigator){left=chartX-navigatorLeft-range/2;}else{if(chartX<navigatorLeft){left=zoomedMin-range*0.2;}else if(chartX>scrollerLeft+scrollerWidth-scrollbarHeight){left=zoomedMin+range*0.2;}else{left=chartX<navigatorLeft+zoomedMin?zoomedMin-range:zoomedMax;}}
if(left<0){left=0;}else if(left+range>=navigatorWidth){left=navigatorWidth-range;fixedMax=scroller.getUnionExtremes().dataMax;}
if(left!==zoomedMin){scroller.fixedWidth=range;ext=xAxis.toFixedRange(left,left+range,null,fixedMax);baseXAxis.setExtremes(ext.min,ext.max,true,false,{trigger:'navigator'});}}}};scroller.mouseMoveHandler=function(e){var scrollbarHeight=scroller.scrollbarHeight,navigatorLeft=scroller.navigatorLeft,navigatorWidth=scroller.navigatorWidth,scrollerLeft=scroller.scrollerLeft,scrollerWidth=scroller.scrollerWidth,range=scroller.range,chartX,hasDragged;if(!e.touches||e.touches[0].pageX!==0){e=chart.pointer.normalize(e);chartX=e.chartX;if(chartX<navigatorLeft){chartX=navigatorLeft;}else if(chartX>scrollerLeft+scrollerWidth-scrollbarHeight){chartX=scrollerLeft+scrollerWidth-scrollbarHeight;}
if(scroller.grabbedLeft){hasDragged=true;scroller.render(0,0,chartX-navigatorLeft,scroller.otherHandlePos);}else if(scroller.grabbedRight){hasDragged=true;scroller.render(0,0,scroller.otherHandlePos,chartX-navigatorLeft);}else if(scroller.grabbedCenter){hasDragged=true;if(chartX<dragOffset){chartX=dragOffset;}else if(chartX>navigatorWidth+dragOffset-range){chartX=navigatorWidth+dragOffset-range;}
scroller.render(0,0,chartX-dragOffset,chartX-dragOffset+range);}
if(hasDragged&&scroller.scrollbarOptions.liveRedraw){setTimeout(function(){scroller.mouseUpHandler(e);},0);}
scroller.hasDragged=hasDragged;}};scroller.mouseUpHandler=function(e){var ext,fixedMin,fixedMax;if(scroller.hasDragged){if(scroller.zoomedMin===scroller.otherHandlePos){fixedMin=scroller.fixedExtreme;}else if(scroller.zoomedMax===scroller.otherHandlePos){fixedMax=scroller.fixedExtreme;}
if(scroller.zoomedMax===scroller.navigatorWidth){fixedMax=scroller.getUnionExtremes().dataMax;}
ext=xAxis.toFixedRange(scroller.zoomedMin,scroller.zoomedMax,fixedMin,fixedMax);if(defined(ext.min)){chart.xAxis[0].setExtremes(ext.min,ext.max,true,false,{trigger:'navigator',triggerOp:'navigator-drag',DOMEvent:e});}}
if(e.type!=='mousemove'){scroller.grabbedLeft=scroller.grabbedRight=scroller.grabbedCenter=scroller.fixedWidth=scroller.fixedExtreme=scroller.otherHandlePos=scroller.hasDragged=dragOffset=null;}};var xAxisIndex=chart.xAxis.length,yAxisIndex=chart.yAxis.length;chart.extraBottomMargin=scroller.outlineHeight+navigatorOptions.margin;if(scroller.navigatorEnabled){scroller.xAxis=xAxis=new Axis(chart,merge({breaks:baseSeries&&baseSeries.xAxis.options.breaks,ordinal:baseSeries&&baseSeries.xAxis.options.ordinal},navigatorOptions.xAxis,{id:'navigator-x-axis',isX:true,type:'datetime',index:xAxisIndex,height:height,offset:0,offsetLeft:scrollbarHeight,offsetRight:-scrollbarHeight,keepOrdinalPadding:true,startOnTick:false,endOnTick:false,minPadding:0,maxPadding:0,zoomEnabled:false}));scroller.yAxis=yAxis=new Axis(chart,merge(navigatorOptions.yAxis,{id:'navigator-y-axis',alignTicks:false,height:height,offset:0,index:yAxisIndex,zoomEnabled:false}));if(baseSeries||navigatorOptions.series.data){scroller.addBaseSeries();}else if(chart.series.length===0){wrap(chart,'redraw',function(proceed,animation){if(chart.series.length>0&&!scroller.series){scroller.setBaseSeries();chart.redraw=proceed;}
proceed.call(chart,animation);});}}else{scroller.xAxis=xAxis={translate:function(value,reverse){var axis=chart.xAxis[0],ext=axis.getExtremes(),scrollTrackWidth=chart.plotWidth-2*scrollbarHeight,min=numExt('min',axis.options.min,ext.dataMin),valueRange=numExt('max',axis.options.max,ext.dataMax)-min;return reverse?(value*valueRange/scrollTrackWidth)+min:scrollTrackWidth*(value-min)/valueRange;},toFixedRange:Axis.prototype.toFixedRange};}
wrap(chart,'getMargins',function(proceed){var legend=this.legend,legendOptions=legend.options;proceed.apply(this,[].slice.call(arguments,1));scroller.top=top=scroller.navigatorOptions.top||this.chartHeight-scroller.height-scroller.scrollbarHeight-this.spacing[2]-
(legendOptions.verticalAlign==='bottom'&&legendOptions.enabled&&!legendOptions.floating?legend.legendHeight+pick(legendOptions.margin,10):0);if(xAxis&&yAxis){xAxis.options.top=yAxis.options.top=top;xAxis.setAxisSize();yAxis.setAxisSize();}});scroller.addEvents();},getUnionExtremes:function(returnFalseOnNoBaseSeries){var baseAxis=this.chart.xAxis[0],navAxis=this.xAxis,navAxisOptions=navAxis.options,baseAxisOptions=baseAxis.options,ret;if(!returnFalseOnNoBaseSeries||baseAxis.dataMin!==null){ret={dataMin:pick(navAxisOptions&&navAxisOptions.min,numExt('min',baseAxisOptions.min,baseAxis.dataMin,navAxis.dataMin)),dataMax:pick(navAxisOptions&&navAxisOptions.max,numExt('max',baseAxisOptions.max,baseAxis.dataMax,navAxis.dataMax))};}
return ret;},setBaseSeries:function(baseSeriesOption){var chart=this.chart;baseSeriesOption=baseSeriesOption||chart.options.navigator.baseSeries;if(this.series){this.series.remove();}
this.baseSeries=chart.series[baseSeriesOption]||(typeof baseSeriesOption==='string'&&chart.get(baseSeriesOption))||chart.series[0];if(this.xAxis){this.addBaseSeries();}},addBaseSeries:function(){var baseSeries=this.baseSeries,baseOptions=baseSeries?baseSeries.options:{},baseData=baseOptions.data,mergedNavSeriesOptions,navigatorSeriesOptions=this.navigatorOptions.series,navigatorData;navigatorData=navigatorSeriesOptions.data;this.hasNavigatorData=!!navigatorData;mergedNavSeriesOptions=merge(baseOptions,navigatorSeriesOptions,{enableMouseTracking:false,group:'nav',padXAxis:false,xAxis:'navigator-x-axis',yAxis:'navigator-y-axis',name:'Navigator',showInLegend:false,stacking:false,isInternal:true,visible:true});mergedNavSeriesOptions.data=navigatorData||baseData.slice(0);this.series=this.chart.initSeries(mergedNavSeriesOptions);if(baseSeries&&this.navigatorOptions.adaptToUpdatedData!==false){addEvent(baseSeries,'updatedData',this.updatedDataHandler);baseSeries.userOptions.events=extend(baseSeries.userOptions.event,{updatedData:this.updatedDataHandler});}},updatedDataHandler:function(){var scroller=this.chart.scroller,baseSeries=scroller.baseSeries,baseXAxis=baseSeries.xAxis,baseExtremes=baseXAxis.getExtremes(),baseMin=baseExtremes.min,baseMax=baseExtremes.max,baseDataMin=baseExtremes.dataMin,baseDataMax=baseExtremes.dataMax,range=baseMax-baseMin,stickToMin,stickToMax,newMax,newMin,doRedraw,navigatorSeries=scroller.series,navXData=navigatorSeries.xData,hasSetExtremes=!!baseXAxis.setExtremes;stickToMax=baseMax>=navXData[navXData.length-1]-(this.closestPointRange||0);stickToMin=baseMin<=baseDataMin;if(!scroller.hasNavigatorData){navigatorSeries.options.pointStart=baseSeries.xData[0];navigatorSeries.setData(baseSeries.options.data,false);doRedraw=true;}
if(stickToMin){newMin=baseDataMin;newMax=newMin+range;}
if(stickToMax){newMax=baseDataMax;if(!stickToMin){newMin=mathMax(newMax-range,navigatorSeries.xData[0]);}}
if(hasSetExtremes&&(stickToMin||stickToMax)){if(!isNaN(newMin)){baseXAxis.setExtremes(newMin,newMax,true,false,{trigger:'updatedData'});}}else{if(doRedraw){this.chart.redraw(false);}
scroller.render(mathMax(baseMin,baseDataMin),mathMin(baseMax,baseDataMax));}},destroy:function(){var scroller=this;scroller.removeEvents();each([scroller.xAxis,scroller.yAxis,scroller.leftShade,scroller.rightShade,scroller.outline,scroller.scrollbarTrack,scroller.scrollbarRifles,scroller.scrollbarGroup,scroller.scrollbar],function(prop){if(prop&&prop.destroy){prop.destroy();}});scroller.xAxis=scroller.yAxis=scroller.leftShade=scroller.rightShade=scroller.outline=scroller.scrollbarTrack=scroller.scrollbarRifles=scroller.scrollbarGroup=scroller.scrollbar=null;each([scroller.scrollbarButtons,scroller.handles,scroller.elementsToDestroy],function(coll){destroyObjectProperties(coll);});}};Highcharts.Scroller=Scroller;wrap(Axis.prototype,'zoom',function(proceed,newMin,newMax){var chart=this.chart,chartOptions=chart.options,zoomType=chartOptions.chart.zoomType,previousZoom,navigator=chartOptions.navigator,rangeSelector=chartOptions.rangeSelector,ret;if(this.isXAxis&&((navigator&&navigator.enabled)||(rangeSelector&&rangeSelector.enabled))){if(zoomType==='x'){chart.resetZoomButton='blocked';}else if(zoomType==='y'){ret=false;}else if(zoomType==='xy'){previousZoom=this.previousZoom;if(defined(newMin)){this.previousZoom=[this.min,this.max];}else if(previousZoom){newMin=previousZoom[0];newMax=previousZoom[1];delete this.previousZoom;}}}
return ret!==UNDEFINED?ret:proceed.call(this,newMin,newMax);});wrap(Chart.prototype,'init',function(proceed,options,callback){addEvent(this,'beforeRender',function(){var options=this.options;if(options.navigator.enabled||options.scrollbar.enabled){this.scroller=new Scroller(this);}});proceed.call(this,options,callback);});wrap(Series.prototype,'addPoint',function(proceed,options,redraw,shift,animation){var turboThreshold=this.options.turboThreshold;if(turboThreshold&&this.xData.length>turboThreshold&&isObject(options)&&!isArray(options)&&this.chart.scroller){error(20,true);}
proceed.call(this,options,redraw,shift,animation);});extend(defaultOptions,{rangeSelector:{buttonTheme:{width:28,height:18,fill:'#f7f7f7',padding:2,r:0,'stroke-width':0,style:{color:'#444',cursor:'pointer',fontWeight:'normal'},zIndex:7,states:{hover:{fill:'#e7e7e7'},select:{fill:'#e7f0f9',style:{color:'black',fontWeight:'bold'}}}},height:35,inputPosition:{align:'right'},labelStyle:{color:'#666'}}});defaultOptions.lang=merge(defaultOptions.lang,{rangeSelectorZoom:'Zoom',rangeSelectorFrom:'From',rangeSelectorTo:'To'});function RangeSelector(chart){this.init(chart);}
RangeSelector.prototype={clickButton:function(i,redraw){var rangeSelector=this,selected=rangeSelector.selected,chart=rangeSelector.chart,buttons=rangeSelector.buttons,rangeOptions=rangeSelector.buttonOptions[i],baseAxis=chart.xAxis[0],unionExtremes=(chart.scroller&&chart.scroller.getUnionExtremes())||baseAxis||{},dataMin=unionExtremes.dataMin,dataMax=unionExtremes.dataMax,newMin,newMax=baseAxis&&mathRound(mathMin(baseAxis.max,pick(dataMax,baseAxis.max))),now,type=rangeOptions.type,baseXAxisOptions,range=rangeOptions._range,rangeMin,year,minSetting,rangeSetting,ctx,dataGrouping=rangeOptions.dataGrouping;if(dataMin===null||dataMax===null||i===rangeSelector.selected){return;}
chart.fixedRange=range;if(dataGrouping){this.forcedDataGrouping=true;Axis.prototype.setDataGrouping.call(baseAxis||{chart:this.chart},dataGrouping,false);}
if(type==='month'||type==='year'){if(!baseAxis){range=rangeOptions;}else{ctx={range:rangeOptions,max:newMax,dataMin:dataMin,dataMax:dataMax};newMin=baseAxis.minFromRange.call(ctx);if(typeof ctx.newMax==='number'){newMax=ctx.newMax;}}}else if(range){newMin=mathMax(newMax-range,dataMin);newMax=mathMin(newMin+range,dataMax);}else if(type==='ytd'){if(baseAxis){if(dataMax===UNDEFINED){dataMin=Number.MAX_VALUE;dataMax=Number.MIN_VALUE;each(chart.series,function(series){var xData=series.xData;dataMin=mathMin(xData[0],dataMin);dataMax=mathMax(xData[xData.length-1],dataMax);});redraw=false;}
now=new Date(dataMax);year=now.getFullYear();newMin=rangeMin=mathMax(dataMin||0,Date.UTC(year,0,1));now=now.getTime();newMax=mathMin(dataMax||now,now);}else{addEvent(chart,'beforeRender',function(){rangeSelector.clickButton(i);});return;}}else if(type==='all'&&baseAxis){newMin=dataMin;newMax=dataMax;}
if(buttons[selected]){buttons[selected].setState(0);}
if(buttons[i]){buttons[i].setState(2);rangeSelector.lastSelected=i;}
if(!baseAxis){baseXAxisOptions=chart.options.xAxis[0];rangeSetting=baseXAxisOptions.range;baseXAxisOptions.range=range;minSetting=baseXAxisOptions.min;baseXAxisOptions.min=rangeMin;rangeSelector.setSelected(i);addEvent(chart,'load',function resetMinAndRange(){baseXAxisOptions.range=rangeSetting;baseXAxisOptions.min=minSetting;});}else{baseAxis.setExtremes(newMin,newMax,pick(redraw,1),0,{trigger:'rangeSelectorButton',rangeSelectorButton:rangeOptions});rangeSelector.setSelected(i);}},setSelected:function(selected){this.selected=this.options.selected=selected;},defaultButtons:[{type:'month',count:1,text:'1m'},{type:'month',count:3,text:'3m'},{type:'month',count:6,text:'6m'},{type:'ytd',text:'YTD'},{type:'year',count:1,text:'1y'},{type:'all',text:'All'}],init:function(chart){var rangeSelector=this,options=chart.options.rangeSelector,buttonOptions=options.buttons||[].concat(rangeSelector.defaultButtons),selectedOption=options.selected,blurInputs=rangeSelector.blurInputs=function(){var minInput=rangeSelector.minInput,maxInput=rangeSelector.maxInput;if(minInput&&minInput.blur){fireEvent(minInput,'blur');}
if(maxInput&&maxInput.blur){fireEvent(maxInput,'blur');}};rangeSelector.chart=chart;rangeSelector.options=options;rangeSelector.buttons=[];chart.extraTopMargin=options.height;rangeSelector.buttonOptions=buttonOptions;addEvent(chart.container,'mousedown',blurInputs);addEvent(chart,'resize',blurInputs);each(buttonOptions,rangeSelector.computeButtonRange);if(selectedOption!==UNDEFINED&&buttonOptions[selectedOption]){this.clickButton(selectedOption,false);}
addEvent(chart,'load',function(){addEvent(chart.xAxis[0],'setExtremes',function(e){if(this.max-this.min!==chart.fixedRange&&e.trigger!=='rangeSelectorButton'&&e.trigger!=='updatedData'&&rangeSelector.forcedDataGrouping){this.setDataGrouping(false,false);}});addEvent(chart.xAxis[0],'afterSetExtremes',function(){rangeSelector.updateButtonStates(true);});});},updateButtonStates:function(updating){var rangeSelector=this,chart=this.chart,baseAxis=chart.xAxis[0],unionExtremes=(chart.scroller&&chart.scroller.getUnionExtremes())||baseAxis,dataMin=unionExtremes.dataMin,dataMax=unionExtremes.dataMax,selected=rangeSelector.selected,allButtonsEnabled=rangeSelector.options.allButtonsEnabled,buttons=rangeSelector.buttons;if(updating&&chart.fixedRange!==mathRound(baseAxis.max-baseAxis.min)){if(buttons[selected]){buttons[selected].setState(0);}
rangeSelector.setSelected(null);}
each(rangeSelector.buttonOptions,function(rangeOptions,i){var actualRange=mathRound(baseAxis.max-baseAxis.min),range=rangeOptions._range,type=rangeOptions.type,count=rangeOptions.count||1,isTooGreatRange=range>dataMax-dataMin,isTooSmallRange=range<baseAxis.minRange,isAllButAlreadyShowingAll=rangeOptions.type==='all'&&baseAxis.max-baseAxis.min>=dataMax-dataMin&&buttons[i].state!==2,isYTDButNotAvailable=rangeOptions.type==='ytd'&&dateFormat('%Y',dataMin)===dateFormat('%Y',dataMax),isSelectedForExport=chart.renderer.forExport&&i===selected,isSameRange=range===actualRange,hasNoData=!baseAxis.hasVisibleSeries;if((type==='month'||type==='year')&&(actualRange>={month:28,year:365}[type]*24*36e5*count)&&(actualRange<={month:31,year:366}[type]*24*36e5*count)){isSameRange=true;}
if(isSelectedForExport||(isSameRange&&i!==selected)&&i===rangeSelector.lastSelected){rangeSelector.setSelected(i);buttons[i].setState(2);}else if(!allButtonsEnabled&&(isTooGreatRange||isTooSmallRange||isAllButAlreadyShowingAll||isYTDButNotAvailable||hasNoData)){buttons[i].setState(3);}else if(buttons[i].state===3){buttons[i].setState(0);}});},computeButtonRange:function(rangeOptions){var type=rangeOptions.type,count=rangeOptions.count||1,fixedTimes={millisecond:1,second:1000,minute:60*1000,hour:3600*1000,day:24*3600*1000,week:7*24*3600*1000};if(fixedTimes[type]){rangeOptions._range=fixedTimes[type]*count;}else if(type==='month'||type==='year'){rangeOptions._range={month:30,year:365}[type]*24*36e5*count;}},setInputValue:function(name,time){var options=this.chart.options.rangeSelector;if(defined(time)){this[name+'Input'].HCTime=time;}
this[name+'Input'].value=dateFormat(options.inputEditDateFormat||'%Y-%m-%d',this[name+'Input'].HCTime);this[name+'DateBox'].attr({text:dateFormat(options.inputDateFormat||'%b %e, %Y',this[name+'Input'].HCTime)});},showInput:function(name){var inputGroup=this.inputGroup,dateBox=this[name+'DateBox'];css(this[name+'Input'],{left:(inputGroup.translateX+dateBox.x)+PX,top:inputGroup.translateY+PX,width:(dateBox.width-2)+PX,height:(dateBox.height-2)+PX,border:'2px solid silver'});},hideInput:function(name){css(this[name+'Input'],{border:0,width:'1px',height:'1px'});this.setInputValue(name);},drawInput:function(name){var rangeSelector=this,chart=rangeSelector.chart,chartStyle=chart.renderer.style,renderer=chart.renderer,options=chart.options.rangeSelector,lang=defaultOptions.lang,div=rangeSelector.div,isMin=name==='min',input,label,dateBox,inputGroup=this.inputGroup;function updateExtremes(){var inputValue=input.value,value=(options.inputDateParser||Date.parse)(inputValue),xAxis=chart.xAxis[0],dataMin=xAxis.dataMin,dataMax=xAxis.dataMax;if(value!==input.previousValue){input.previousValue=value;if(isNaN(value)){value=inputValue.split('-');value=Date.UTC(pInt(value[0]),pInt(value[1])-1,pInt(value[2]));}
if(!isNaN(value)){if(!defaultOptions.global.useUTC){value=value+new Date().getTimezoneOffset()*60*1000;}
if(isMin){if(value>rangeSelector.maxInput.HCTime){value=UNDEFINED;}else if(value<dataMin){value=dataMin;}}else{if(value<rangeSelector.minInput.HCTime){value=UNDEFINED;}else if(value>dataMax){value=dataMax;}}
if(value!==UNDEFINED){chart.xAxis[0].setExtremes(isMin?value:xAxis.min,isMin?xAxis.max:value,UNDEFINED,UNDEFINED,{trigger:'rangeSelectorInput'});}}}}
this[name+'Label']=label=renderer.label(lang[isMin?'rangeSelectorFrom':'rangeSelectorTo'],this.inputGroup.offset).attr({padding:2}).css(merge(chartStyle,options.labelStyle)).add(inputGroup);inputGroup.offset+=label.width+5;this[name+'DateBox']=dateBox=renderer.label('',inputGroup.offset).attr({padding:2,width:options.inputBoxWidth||90,height:options.inputBoxHeight||17,stroke:options.inputBoxBorderColor||'silver','stroke-width':1}).css(merge({textAlign:'center',color:'#444'},chartStyle,options.inputStyle)).on('click',function(){rangeSelector.showInput(name);rangeSelector[name+'Input'].focus();}).add(inputGroup);inputGroup.offset+=dateBox.width+(isMin?10:0);this[name+'Input']=input=createElement('input',{name:name,className:PREFIX+'range-selector',type:'text'},extend({position:ABSOLUTE,border:0,width:'1px',height:'1px',padding:0,textAlign:'center',fontSize:chartStyle.fontSize,fontFamily:chartStyle.fontFamily,left:'-9em',top:chart.plotTop+PX},options.inputStyle),div);input.onfocus=function(){rangeSelector.showInput(name);};input.onblur=function(){rangeSelector.hideInput(name);};input.onchange=updateExtremes;input.onkeypress=function(event){if(event.keyCode===13){updateExtremes();}};},getPosition:function(){var chart=this.chart,options=chart.options.rangeSelector,buttonTop=pick((options.buttonPosition||{}).y,chart.plotTop-chart.axisOffset[0]-options.height);return{buttonTop:buttonTop,inputTop:buttonTop-10};},render:function(min,max){var rangeSelector=this,chart=rangeSelector.chart,renderer=chart.renderer,container=chart.container,chartOptions=chart.options,navButtonOptions=chartOptions.exporting&&chartOptions.exporting.enabled!==false&&chartOptions.navigation&&chartOptions.navigation.buttonOptions,options=chartOptions.rangeSelector,buttons=rangeSelector.buttons,lang=defaultOptions.lang,div=rangeSelector.div,inputGroup=rangeSelector.inputGroup,buttonTheme=options.buttonTheme,buttonPosition=options.buttonPosition||{},inputEnabled=options.inputEnabled,states=buttonTheme&&buttonTheme.states,plotLeft=chart.plotLeft,buttonLeft,pos=this.getPosition(),buttonGroup=rangeSelector.group,buttonBBox,rendered=rangeSelector.rendered;if(!rendered){rangeSelector.group=buttonGroup=renderer.g('range-selector-buttons').add();rangeSelector.zoomText=renderer.text(lang.rangeSelectorZoom,pick(buttonPosition.x,plotLeft),15).css(options.labelStyle).add(buttonGroup);buttonLeft=pick(buttonPosition.x,plotLeft)+rangeSelector.zoomText.getBBox().width+5;each(rangeSelector.buttonOptions,function(rangeOptions,i){buttons[i]=renderer.button(rangeOptions.text,buttonLeft,0,function(){rangeSelector.clickButton(i);rangeSelector.isActive=true;},buttonTheme,states&&states.hover,states&&states.select,states&&states.disabled).css({textAlign:'center'}).add(buttonGroup);buttonLeft+=buttons[i].width+pick(options.buttonSpacing,5);if(rangeSelector.selected===i){buttons[i].setState(2);}});rangeSelector.updateButtonStates();if(inputEnabled!==false){rangeSelector.div=div=createElement('div',null,{position:'relative',height:0,zIndex:1});container.parentNode.insertBefore(div,container);rangeSelector.inputGroup=inputGroup=renderer.g('input-group').add();inputGroup.offset=0;rangeSelector.drawInput('min');rangeSelector.drawInput('max');}}
buttonGroup[rendered?'animate':'attr']({translateY:pos.buttonTop});if(inputEnabled!==false){inputGroup.align(extend({y:pos.inputTop,width:inputGroup.offset,x:navButtonOptions&&(pos.inputTop<(navButtonOptions.y||0)+navButtonOptions.height-chart.spacing[0])?-40:0},options.inputPosition),true,chart.spacingBox);if(!defined(inputEnabled)){buttonBBox=buttonGroup.getBBox();inputGroup[inputGroup.translateX<buttonBBox.x+buttonBBox.width+10?'hide':'show']();}
rangeSelector.setInputValue('min',min);rangeSelector.setInputValue('max',max);}
rangeSelector.rendered=true;},destroy:function(){var minInput=this.minInput,maxInput=this.maxInput,chart=this.chart,blurInputs=this.blurInputs,key;removeEvent(chart.container,'mousedown',blurInputs);removeEvent(chart,'resize',blurInputs);destroyObjectProperties(this.buttons);if(minInput){minInput.onfocus=minInput.onblur=minInput.onchange=null;}
if(maxInput){maxInput.onfocus=maxInput.onblur=maxInput.onchange=null;}
for(key in this){if(this[key]&&key!=='chart'){if(this[key].destroy){this[key].destroy();}else if(this[key].nodeType){discardElement(this[key]);}}
this[key]=null;}}};Axis.prototype.toFixedRange=function(pxMin,pxMax,fixedMin,fixedMax){var fixedRange=this.chart&&this.chart.fixedRange,newMin=pick(fixedMin,this.translate(pxMin,true)),newMax=pick(fixedMax,this.translate(pxMax,true)),changeRatio=fixedRange&&(newMax-newMin)/fixedRange;if(changeRatio>0.7&&changeRatio<1.3){if(fixedMax){newMin=newMax-fixedRange;}else{newMax=newMin+fixedRange;}}
if(isNaN(newMin)){newMin=newMax=undefined;}
return{min:newMin,max:newMax};};Axis.prototype.minFromRange=function(){var rangeOptions=this.range,type=rangeOptions.type,timeName={month:'Month',year:'FullYear'}[type],min,max=this.max,dataMin,range,getTrueRange=function(base,count){var date=new Date(base);date['set'+timeName](date['get'+timeName]()+count);return date.getTime()-base;};if(typeof rangeOptions==='number'){min=this.max-rangeOptions;range=rangeOptions;}else{min=max+getTrueRange(max,-rangeOptions.count);}
dataMin=pick(this.dataMin,Number.MIN_VALUE);if(isNaN(min)){min=dataMin;}
if(min<=dataMin){min=dataMin;if(range===undefined){range=getTrueRange(min,rangeOptions.count);}
this.newMax=mathMin(min+range,this.dataMax);}
if(isNaN(max)){min=undefined;}
return min;};wrap(Chart.prototype,'init',function(proceed,options,callback){addEvent(this,'init',function(){if(this.options.rangeSelector.enabled){this.rangeSelector=new RangeSelector(this);}});proceed.call(this,options,callback);});Highcharts.RangeSelector=RangeSelector;Chart.prototype.callbacks.push(function(chart){var extremes,scroller=chart.scroller,rangeSelector=chart.rangeSelector;function renderScroller(){extremes=chart.xAxis[0].getExtremes();scroller.render(extremes.min,extremes.max);}
function renderRangeSelector(){extremes=chart.xAxis[0].getExtremes();if(!isNaN(extremes.min)){rangeSelector.render(extremes.min,extremes.max);}}
function afterSetExtremesHandlerScroller(e){if(e.triggerOp!=='navigator-drag'){scroller.render(e.min,e.max);}}
function afterSetExtremesHandlerRangeSelector(e){rangeSelector.render(e.min,e.max);}
function destroyEvents(){if(scroller){removeEvent(chart.xAxis[0],'afterSetExtremes',afterSetExtremesHandlerScroller);}
if(rangeSelector){removeEvent(chart,'resize',renderRangeSelector);removeEvent(chart.xAxis[0],'afterSetExtremes',afterSetExtremesHandlerRangeSelector);}}
if(scroller){addEvent(chart.xAxis[0],'afterSetExtremes',afterSetExtremesHandlerScroller);wrap(chart,'drawChartBox',function(proceed){var isDirtyBox=this.isDirtyBox;proceed.call(this);if(isDirtyBox){renderScroller();}});renderScroller();}
if(rangeSelector){addEvent(chart.xAxis[0],'afterSetExtremes',afterSetExtremesHandlerRangeSelector);addEvent(chart,'resize',renderRangeSelector);renderRangeSelector();}
addEvent(chart,'destroy',destroyEvents);});Highcharts.StockChart=Highcharts.stockChart=function(a,b,c){var hasRenderToArg=isString(a)||a.nodeName,options=arguments[hasRenderToArg?1:0],seriesOptions=options.series,opposite,navigatorEnabled=pick(options.navigator&&options.navigator.enabled,true),disableStartOnTick=navigatorEnabled?{startOnTick:false,endOnTick:false}:null,lineOptions={marker:{enabled:false,radius:2}},columnOptions={shadow:false,borderWidth:0};options.xAxis=map(splat(options.xAxis||{}),function(xAxisOptions){return merge({minPadding:0,maxPadding:0,ordinal:true,title:{text:null},labels:{overflow:'justify'},showLastLabel:true},xAxisOptions,{type:'datetime',categories:null},disableStartOnTick);});options.yAxis=map(splat(options.yAxis||{}),function(yAxisOptions){opposite=pick(yAxisOptions.opposite,true);return merge({labels:{y:-2},opposite:opposite,showLastLabel:false,title:{text:null}},yAxisOptions);});options.series=null;options=merge({chart:{panning:true,pinchType:'x'},navigator:{enabled:true},scrollbar:{enabled:true},rangeSelector:{enabled:true},title:{text:null,style:{fontSize:'16px'}},tooltip:{shared:true,crosshairs:true},legend:{enabled:false},plotOptions:{line:lineOptions,spline:lineOptions,area:lineOptions,areaspline:lineOptions,arearange:lineOptions,areasplinerange:lineOptions,column:columnOptions,columnrange:columnOptions,candlestick:columnOptions,ohlc:columnOptions}},options,{_stock:true,chart:{inverted:false}});options.series=seriesOptions;return hasRenderToArg?new Chart(a,options,c):new Chart(options,b);};wrap(Pointer.prototype,'init',function(proceed,chart,options){var pinchType=options.chart.pinchType||'';proceed.call(this,chart,options);this.pinchX=this.pinchHor=pinchType.indexOf('x')!==-1;this.pinchY=this.pinchVert=pinchType.indexOf('y')!==-1;this.hasZoom=this.hasZoom||this.pinchHor||this.pinchVert;});wrap(Axis.prototype,'autoLabelAlign',function(proceed){var chart=this.chart,options=this.options,panes=chart._labelPanes=chart._labelPanes||{},key,labelOptions=this.options.labels;if(this.chart.options._stock&&this.coll==='yAxis'){key=options.top+','+options.height;if(!panes[key]&&labelOptions.enabled){if(labelOptions.x===15){labelOptions.x=0;}
if(labelOptions.align===undefined){labelOptions.align='right';}
panes[key]=1;return'right';}}
return proceed.call(this,[].slice.call(arguments,1));});wrap(Axis.prototype,'getPlotLinePath',function(proceed,value,lineWidth,old,force,translatedValue){var axis=this,series=(this.isLinked&&!this.series?this.linkedParent.series:this.series),chart=axis.chart,renderer=chart.renderer,axisLeft=axis.left,axisTop=axis.top,x1,y1,x2,y2,result=[],axes=[],axes2,uniqueAxes,transVal;if(axis.coll==='colorAxis'){return proceed.apply(this,[].slice.call(arguments,1));}
axes=(axis.isXAxis?(defined(axis.options.yAxis)?[chart.yAxis[axis.options.yAxis]]:map(series,function(s){return s.yAxis;})):(defined(axis.options.xAxis)?[chart.xAxis[axis.options.xAxis]]:map(series,function(s){return s.xAxis;})));axes2=(axis.isXAxis?chart.yAxis:chart.xAxis);each(axes2,function(A){if(defined(A.options.id)?A.options.id.indexOf('navigator')===-1:true){var a=(A.isXAxis?'yAxis':'xAxis'),rax=(defined(A.options[a])?chart[a][A.options[a]]:chart[a][0]);if(axis===rax){axes.push(A);}}});uniqueAxes=axes.length?[]:[axis.isXAxis?chart.yAxis[0]:chart.xAxis[0]];each(axes,function(axis2){if(inArray(axis2,uniqueAxes)===-1){uniqueAxes.push(axis2);}});transVal=pick(translatedValue,axis.translate(value,null,null,old));if(!isNaN(transVal)){if(axis.horiz){each(uniqueAxes,function(axis2){var skip;y1=axis2.pos;y2=y1+axis2.len;x1=x2=mathRound(transVal+axis.transB);if(x1<axisLeft||x1>axisLeft+axis.width){if(force){x1=x2=mathMin(mathMax(axisLeft,x1),axisLeft+axis.width);}else{skip=true;}}
if(!skip){result.push('M',x1,y1,'L',x2,y2);}});}else{each(uniqueAxes,function(axis2){var skip;x1=axis2.pos;x2=x1+axis2.len;y1=y2=mathRound(axisTop+axis.height-transVal);if(y1<axisTop||y1>axisTop+axis.height){if(force){y1=y2=mathMin(mathMax(axisTop,y1),axis.top+axis.height);}else{skip=true;}}
if(!skip){result.push('M',x1,y1,'L',x2,y2);}});}}
return result.length>0?renderer.crispPolyLine(result,lineWidth||1):null;});Axis.prototype.getPlotBandPath=function(from,to){var toPath=this.getPlotLinePath(to,null,null,true),path=this.getPlotLinePath(from,null,null,true),result=[],i;if(path&&toPath&&path.toString()!==toPath.toString()){for(i=0;i<path.length;i+=6){result.push('M',path[i+1],path[i+2],'L',path[i+4],path[i+5],toPath[i+4],toPath[i+5],toPath[i+1],toPath[i+2]);}}else{result=null;}
return result;};SVGRenderer.prototype.crispPolyLine=function(points,width){var i;for(i=0;i<points.length;i=i+6){if(points[i+1]===points[i+4]){points[i+1]=points[i+4]=mathRound(points[i+1])-(width%2/2);}
if(points[i+2]===points[i+5]){points[i+2]=points[i+5]=mathRound(points[i+2])+(width%2/2);}}
return points;};if(Renderer===Highcharts.VMLRenderer){VMLRenderer.prototype.crispPolyLine=SVGRenderer.prototype.crispPolyLine;}
wrap(Axis.prototype,'hideCrosshair',function(proceed,i){proceed.call(this,i);if(this.crossLabel){this.crossLabel=this.crossLabel.hide();}});wrap(Axis.prototype,'drawCrosshair',function(proceed,e,point){proceed.call(this,e,point);if(!defined(this.crosshair.label)||!this.crosshair.label.enabled){return;}
var chart=this.chart,options=this.options.crosshair.label,horiz=this.horiz,opposite=this.opposite,left=this.left,top=this.top,crossLabel=this.crossLabel,posx,posy,crossBox,formatOption=options.format,formatFormat='',limit,align,tickInside=this.options.tickPosition==='inside',snap=this.crosshair.snap!==false,value;align=(horiz?'center':opposite?(this.labelAlign==='right'?'right':'left'):(this.labelAlign==='left'?'left':'center'));if(!crossLabel){crossLabel=this.crossLabel=chart.renderer.label(null,null,null,options.shape||'callout').attr({align:options.align||align,zIndex:12,fill:options.backgroundColor||(this.series[0]&&this.series[0].color)||'gray',padding:pick(options.padding,8),stroke:options.borderColor||'','stroke-width':options.borderWidth||0,r:pick(options.borderRadius,3)}).css(extend({color:'white',fontWeight:'normal',fontSize:'11px',textAlign:'center'},options.style)).add();}
if(horiz){posx=snap?point.plotX+left:e.chartX;posy=top+(opposite?0:this.height);}else{posx=opposite?this.width+left:0;posy=snap?point.plotY+top:e.chartY;}
if(!formatOption&&!options.formatter){if(this.isDatetimeAxis){formatFormat='%b %d, %Y';}
formatOption='{value'+(formatFormat?':'+formatFormat:'')+'}';}
value=snap?point[this.isXAxis?'x':'y']:this.toValue(horiz?e.chartX:e.chartY);crossLabel.attr({text:formatOption?format(formatOption,{value:value}):options.formatter.call(this,value),anchorX:horiz?posx:(this.opposite?0:chart.chartWidth),anchorY:horiz?(this.opposite?chart.chartHeight:0):posy,x:posx,y:posy,visibility:VISIBLE});crossBox=crossLabel.getBBox();if(horiz){if((tickInside&&!opposite)||(!tickInside&&opposite)){posy=crossLabel.y-crossBox.height;}}else{posy=crossLabel.y-(crossBox.height/2);}
if(horiz){limit={left:left-crossBox.x,right:left+this.width-crossBox.x};}else{limit={left:this.labelAlign==='left'?left:0,right:this.labelAlign==='right'?left+this.width:chart.chartWidth};}
if(crossLabel.translateX<limit.left){posx+=limit.left-crossLabel.translateX;}
if(crossLabel.translateX+crossBox.width>=limit.right){posx-=crossLabel.translateX+crossBox.width-limit.right;}
crossLabel.attr({x:posx,y:posy,visibility:'visible'});});var seriesInit=seriesProto.init,seriesProcessData=seriesProto.processData,pointTooltipFormatter=Point.prototype.tooltipFormatter;seriesProto.init=function(){seriesInit.apply(this,arguments);this.setCompare(this.options.compare);};seriesProto.setCompare=function(compare){this.modifyValue=(compare==='value'||compare==='percent')?function(value,point){var compareValue=this.compareValue;if(value!==UNDEFINED){value=compare==='value'?value-compareValue:value=100*(value/compareValue)-100;if(point){point.change=value;}}
return value;}:null;if(this.chart.hasRendered){this.isDirty=true;}};seriesProto.processData=function(){var series=this,i,keyIndex=-1,processedXData,processedYData,length,compareValue;seriesProcessData.apply(this,arguments);if(series.xAxis&&series.processedYData){processedXData=series.processedXData;processedYData=series.processedYData;length=processedYData.length;if(series.pointArrayMap){keyIndex=inArray(series.pointValKey||'y',series.pointArrayMap);}
for(i=0;i<length;i++){compareValue=keyIndex>-1?processedYData[i][keyIndex]:processedYData[i];if(typeof compareValue==='number'&&processedXData[i]>=series.xAxis.min&&compareValue!==0){series.compareValue=compareValue;break;}}}};wrap(seriesProto,'getExtremes',function(proceed){var extremes;proceed.apply(this,[].slice.call(arguments,1));if(this.modifyValue){extremes=[this.modifyValue(this.dataMin),this.modifyValue(this.dataMax)];this.dataMin=arrayMin(extremes);this.dataMax=arrayMax(extremes);}});Axis.prototype.setCompare=function(compare,redraw){if(!this.isXAxis){each(this.series,function(series){series.setCompare(compare);});if(pick(redraw,true)){this.chart.redraw();}}};Point.prototype.tooltipFormatter=function(pointFormat){var point=this;pointFormat=pointFormat.replace('{point.change}',(point.change>0?'+':'')+Highcharts.numberFormat(point.change,pick(point.series.tooltipOptions.changeDecimals,2)));return pointTooltipFormatter.apply(this,[pointFormat]);};wrap(Series.prototype,'render',function(proceed){if(this.chart.options._stock&&this.xAxis){if(!this.clipBox&&this.animate){this.clipBox=merge(this.chart.clipBox);this.clipBox.width=this.xAxis.len;this.clipBox.height=this.yAxis.len;}else if(this.chart[this.sharedClipKey]){stop(this.chart[this.sharedClipKey]);this.chart[this.sharedClipKey].attr({width:this.xAxis.len,height:this.yAxis.len});}}
proceed.call(this);});extend(Highcharts,{Color:Color,Point:Point,Tick:Tick,Renderer:Renderer,SVGElement:SVGElement,SVGRenderer:SVGRenderer,arrayMin:arrayMin,arrayMax:arrayMax,charts:charts,correctFloat:correctFloat,dateFormat:dateFormat,error:error,format:format,pathAnim:pathAnim,getOptions:getOptions,hasBidiBug:hasBidiBug,isTouchDevice:isTouchDevice,setOptions:setOptions,addEvent:addEvent,removeEvent:removeEvent,createElement:createElement,discardElement:discardElement,css:css,each:each,map:map,merge:merge,splat:splat,stableSort:stableSort,extendClass:extendClass,pInt:pInt,svg:hasSVG,canvas:useCanVG,vml:!hasSVG&&!useCanVG,product:PRODUCT,version:VERSION});return Highcharts;}));(function(factory){if(typeof module==='object'&&module.exports){module.exports=factory;}else{factory(Highcharts);}}(function(Highcharts){var arrayMin=Highcharts.arrayMin,arrayMax=Highcharts.arrayMax,each=Highcharts.each,extend=Highcharts.extend,merge=Highcharts.merge,map=Highcharts.map,pick=Highcharts.pick,pInt=Highcharts.pInt,correctFloat=Highcharts.correctFloat,defaultPlotOptions=Highcharts.getOptions().plotOptions,seriesTypes=Highcharts.seriesTypes,extendClass=Highcharts.extendClass,splat=Highcharts.splat,wrap=Highcharts.wrap,Axis=Highcharts.Axis,Tick=Highcharts.Tick,Point=Highcharts.Point,Pointer=Highcharts.Pointer,CenteredSeriesMixin=Highcharts.CenteredSeriesMixin,TrackerMixin=Highcharts.TrackerMixin,Series=Highcharts.Series,math=Math,mathRound=math.round,mathFloor=math.floor,mathMax=math.max,Color=Highcharts.Color,noop=function(){},UNDEFINED;function Pane(options,chart,firstAxis){this.init(options,chart,firstAxis);}
extend(Pane.prototype,{init:function(options,chart,firstAxis){var pane=this,backgroundOption,defaultOptions=pane.defaultOptions;pane.chart=chart;pane.options=options=merge(defaultOptions,chart.angular?{background:{}}:undefined,options);backgroundOption=options.background;if(backgroundOption){each([].concat(splat(backgroundOption)).reverse(),function(config){var backgroundColor=config.backgroundColor,axisUserOptions=firstAxis.userOptions;config=merge(pane.defaultBackgroundOptions,config);if(backgroundColor){config.backgroundColor=backgroundColor;}
config.color=config.backgroundColor;firstAxis.options.plotBands.unshift(config);axisUserOptions.plotBands=axisUserOptions.plotBands||[];if(axisUserOptions.plotBands!==firstAxis.options.plotBands){axisUserOptions.plotBands.unshift(config);}});}},defaultOptions:{center:['50%','50%'],size:'85%',startAngle:0},defaultBackgroundOptions:{shape:'circle',borderWidth:1,borderColor:'silver',backgroundColor:{linearGradient:{x1:0,y1:0,x2:0,y2:1},stops:[[0,'#FFF'],[1,'#DDD']]},from:-Number.MAX_VALUE,innerRadius:0,to:Number.MAX_VALUE,outerRadius:'105%'}});var axisProto=Axis.prototype,tickProto=Tick.prototype;var hiddenAxisMixin={getOffset:noop,redraw:function(){this.isDirty=false;},render:function(){this.isDirty=false;},setScale:noop,setCategories:noop,setTitle:noop};var radialAxisMixin={isRadial:true,defaultRadialGaugeOptions:{labels:{align:'center',x:0,y:null},minorGridLineWidth:0,minorTickInterval:'auto',minorTickLength:10,minorTickPosition:'inside',minorTickWidth:1,tickLength:10,tickPosition:'inside',tickWidth:2,title:{rotation:0},zIndex:2},defaultRadialXOptions:{gridLineWidth:1,labels:{align:null,distance:15,x:0,y:null},maxPadding:0,minPadding:0,showLastLabel:false,tickLength:0},defaultRadialYOptions:{gridLineInterpolation:'circle',labels:{align:'right',x:-3,y:-2},showLastLabel:false,title:{x:4,text:null,rotation:90}},setOptions:function(userOptions){var options=this.options=merge(this.defaultOptions,this.defaultRadialOptions,userOptions);if(!options.plotBands){options.plotBands=[];}},getOffset:function(){axisProto.getOffset.call(this);this.chart.axisOffset[this.side]=0;this.center=this.pane.center=CenteredSeriesMixin.getCenter.call(this.pane);},getLinePath:function(lineWidth,radius){var center=this.center;radius=pick(radius,center[2]/2-this.offset);return this.chart.renderer.symbols.arc(this.left+center[0],this.top+center[1],radius,radius,{start:this.startAngleRad,end:this.endAngleRad,open:true,innerR:0});},setAxisTranslation:function(){axisProto.setAxisTranslation.call(this);if(this.center){if(this.isCircular){this.transA=(this.endAngleRad-this.startAngleRad)/((this.max-this.min)||1);}else{this.transA=(this.center[2]/2)/((this.max-this.min)||1);}
if(this.isXAxis){this.minPixelPadding=this.transA*this.minPointOffset;}else{this.minPixelPadding=0;}}},beforeSetTickPositions:function(){if(this.autoConnect){this.max+=(this.categories&&1)||this.pointRange||this.closestPointRange||0;}},setAxisSize:function(){axisProto.setAxisSize.call(this);if(this.isRadial){this.center=this.pane.center=Highcharts.CenteredSeriesMixin.getCenter.call(this.pane);if(this.isCircular){this.sector=this.endAngleRad-this.startAngleRad;}
this.len=this.width=this.height=this.center[2]*pick(this.sector,1)/2;}},getPosition:function(value,length){return this.postTranslate(this.isCircular?this.translate(value):0,pick(this.isCircular?length:this.translate(value),this.center[2]/2)-this.offset);},postTranslate:function(angle,radius){var chart=this.chart,center=this.center;angle=this.startAngleRad+angle;return{x:chart.plotLeft+center[0]+Math.cos(angle)*radius,y:chart.plotTop+center[1]+Math.sin(angle)*radius};},getPlotBandPath:function(from,to,options){var center=this.center,startAngleRad=this.startAngleRad,fullRadius=center[2]/2,radii=[pick(options.outerRadius,'100%'),options.innerRadius,pick(options.thickness,10)],percentRegex=/%$/,start,end,open,isCircular=this.isCircular,ret;if(this.options.gridLineInterpolation==='polygon'){ret=this.getPlotLinePath(from).concat(this.getPlotLinePath(to,true));}else{from=Math.max(from,this.min);to=Math.min(to,this.max);if(!isCircular){radii[0]=this.translate(from);radii[1]=this.translate(to);}
radii=map(radii,function(radius){if(percentRegex.test(radius)){radius=(pInt(radius,10)*fullRadius)/100;}
return radius;});if(options.shape==='circle'||!isCircular){start=-Math.PI/2;end=Math.PI*1.5;open=true;}else{start=startAngleRad+this.translate(from);end=startAngleRad+this.translate(to);}
ret=this.chart.renderer.symbols.arc(this.left+center[0],this.top+center[1],radii[0],radii[0],{start:Math.min(start,end),end:Math.max(start,end),innerR:pick(radii[1],radii[0]-radii[2]),open:open});}
return ret;},getPlotLinePath:function(value,reverse){var axis=this,center=axis.center,chart=axis.chart,end=axis.getPosition(value),xAxis,xy,tickPositions,ret;if(axis.isCircular){ret=['M',center[0]+chart.plotLeft,center[1]+chart.plotTop,'L',end.x,end.y];}else if(axis.options.gridLineInterpolation==='circle'){value=axis.translate(value);if(value){ret=axis.getLinePath(0,value);}}else{each(chart.xAxis,function(a){if(a.pane===axis.pane){xAxis=a;}});ret=[];value=axis.translate(value);tickPositions=xAxis.tickPositions;if(xAxis.autoConnect){tickPositions=tickPositions.concat([tickPositions[0]]);}
if(reverse){tickPositions=[].concat(tickPositions).reverse();}
each(tickPositions,function(pos,i){xy=xAxis.getPosition(pos,value);ret.push(i?'L':'M',xy.x,xy.y);});}
return ret;},getTitlePosition:function(){var center=this.center,chart=this.chart,titleOptions=this.options.title;return{x:chart.plotLeft+center[0]+(titleOptions.x||0),y:chart.plotTop+center[1]-({high:0.5,middle:0.25,low:0}[titleOptions.align]*center[2])+(titleOptions.y||0)};}};wrap(axisProto,'init',function(proceed,chart,userOptions){var axis=this,angular=chart.angular,polar=chart.polar,isX=userOptions.isX,isHidden=angular&&isX,isCircular,startAngleRad,endAngleRad,options,chartOptions=chart.options,paneIndex=userOptions.pane||0,pane,paneOptions;if(angular){extend(this,isHidden?hiddenAxisMixin:radialAxisMixin);isCircular=!isX;if(isCircular){this.defaultRadialOptions=this.defaultRadialGaugeOptions;}}else if(polar){extend(this,radialAxisMixin);isCircular=isX;this.defaultRadialOptions=isX?this.defaultRadialXOptions:merge(this.defaultYAxisOptions,this.defaultRadialYOptions);}
proceed.call(this,chart,userOptions);if(!isHidden&&(angular||polar)){options=this.options;if(!chart.panes){chart.panes=[];}
this.pane=pane=chart.panes[paneIndex]=chart.panes[paneIndex]||new Pane(splat(chartOptions.pane)[paneIndex],chart,axis);paneOptions=pane.options;chart.inverted=false;chartOptions.chart.zoomType=null;this.startAngleRad=startAngleRad=(paneOptions.startAngle-90)*Math.PI/180;this.endAngleRad=endAngleRad=(pick(paneOptions.endAngle,paneOptions.startAngle+360)-90)*Math.PI/180;this.offset=options.offset||0;this.isCircular=isCircular;if(isCircular&&userOptions.max===UNDEFINED&&endAngleRad-startAngleRad===2*Math.PI){this.autoConnect=true;}}});wrap(axisProto,'autoLabelAlign',function(proceed){if(!this.isRadial){return proceed.apply(this,[].slice.call(arguments,1));}});wrap(tickProto,'getPosition',function(proceed,horiz,pos,tickmarkOffset,old){var axis=this.axis;return axis.getPosition?axis.getPosition(pos):proceed.call(this,horiz,pos,tickmarkOffset,old);});wrap(tickProto,'getLabelPosition',function(proceed,x,y,label,horiz,labelOptions,tickmarkOffset,index,step){var axis=this.axis,optionsY=labelOptions.y,ret,centerSlot=20,align=labelOptions.align,angle=((axis.translate(this.pos)+axis.startAngleRad+Math.PI/2)/Math.PI*180)%360;if(axis.isRadial){ret=axis.getPosition(this.pos,(axis.center[2]/2)+pick(labelOptions.distance,-25));if(labelOptions.rotation==='auto'){label.attr({rotation:angle});}else if(optionsY===null){optionsY=axis.chart.renderer.fontMetrics(label.styles.fontSize).b-label.getBBox().height/2;}
if(align===null){if(axis.isCircular){if(this.label.getBBox().width>axis.len*axis.tickInterval/(axis.max-axis.min)){centerSlot=0;}
if(angle>centerSlot&&angle<180-centerSlot){align='left';}else if(angle>180+centerSlot&&angle<360-centerSlot){align='right';}else{align='center';}}else{align='center';}
label.attr({align:align});}
ret.x+=labelOptions.x;ret.y+=optionsY;}else{ret=proceed.call(this,x,y,label,horiz,labelOptions,tickmarkOffset,index,step);}
return ret;});wrap(tickProto,'getMarkPath',function(proceed,x,y,tickLength,tickWidth,horiz,renderer){var axis=this.axis,endPoint,ret;if(axis.isRadial){endPoint=axis.getPosition(this.pos,axis.center[2]/2+tickLength);ret=['M',x,y,'L',endPoint.x,endPoint.y];}else{ret=proceed.call(this,x,y,tickLength,tickWidth,horiz,renderer);}
return ret;});defaultPlotOptions.arearange=merge(defaultPlotOptions.area,{lineWidth:1,marker:null,threshold:null,tooltip:{pointFormat:'<span style="color:{series.color}">\u25CF</span> {series.name}: <b>{point.low}</b> - <b>{point.high}</b><br/>'},trackByArea:true,dataLabels:{align:null,verticalAlign:null,xLow:0,xHigh:0,yLow:0,yHigh:0},states:{hover:{halo:false}}});seriesTypes.arearange=extendClass(seriesTypes.area,{type:'arearange',pointArrayMap:['low','high'],dataLabelCollections:['dataLabel','dataLabelUpper'],toYData:function(point){return[point.low,point.high];},pointValKey:'low',deferTranslatePolar:true,highToXY:function(point){var chart=this.chart,xy=this.xAxis.postTranslate(point.rectPlotX,this.yAxis.len-point.plotHigh);point.plotHighX=xy.x-chart.plotLeft;point.plotHigh=xy.y-chart.plotTop;},translate:function(){var series=this,yAxis=series.yAxis;seriesTypes.area.prototype.translate.apply(series);each(series.points,function(point){var low=point.low,high=point.high,plotY=point.plotY;if(high===null||low===null){point.isNull=true;}else{point.plotLow=plotY;point.plotHigh=yAxis.translate(high,0,1,0,1);}});if(this.chart.polar){each(this.points,function(point){series.highToXY(point);});}},getGraphPath:function(){var points=this.points,highPoints=[],highAreaPoints=[],i=points.length,getGraphPath=Series.prototype.getGraphPath,point,pointShim,linePath,lowerPath,options=this.options,step=options.step,higherPath,higherAreaPath;i=points.length;while(i--){point=points[i];if(!point.isNull&&(!points[i+1]||points[i+1].isNull)){highAreaPoints.push({plotX:point.plotX,plotY:point.plotLow});}
pointShim={plotX:point.plotX,plotY:point.plotHigh,isNull:point.isNull};highAreaPoints.push(pointShim);highPoints.push(pointShim);if(!point.isNull&&(!points[i-1]||points[i-1].isNull)){highAreaPoints.push({plotX:point.plotX,plotY:point.plotLow});}}
lowerPath=getGraphPath.call(this,points);if(step){if(step===true){step='left';}
options.step={left:'right',center:'center',right:'left'}[step];}
higherPath=getGraphPath.call(this,highPoints);higherAreaPath=getGraphPath.call(this,highAreaPoints);options.step=step;linePath=[].concat(lowerPath,higherPath);if(!this.chart.polar&&higherAreaPath[0]==='M'){higherAreaPath[0]='L';}
this.areaPath=this.areaPath.concat(lowerPath,higherAreaPath);return linePath;},drawDataLabels:function(){var data=this.data,length=data.length,i,originalDataLabels=[],seriesProto=Series.prototype,dataLabelOptions=this.options.dataLabels,align=dataLabelOptions.align,verticalAlign=dataLabelOptions.verticalAlign,inside=dataLabelOptions.inside,point,up,inverted=this.chart.inverted;if(dataLabelOptions.enabled||this._hasPointLabels){i=length;while(i--){point=data[i];if(point){up=inside?point.plotHigh<point.plotLow:point.plotHigh>point.plotLow;point.y=point.high;point._plotY=point.plotY;point.plotY=point.plotHigh;originalDataLabels[i]=point.dataLabel;point.dataLabel=point.dataLabelUpper;point.below=up;if(inverted){if(!align){dataLabelOptions.align=up?'right':'left';}}else{if(!verticalAlign){dataLabelOptions.verticalAlign=up?'top':'bottom';}}
dataLabelOptions.x=dataLabelOptions.xHigh;dataLabelOptions.y=dataLabelOptions.yHigh;}}
if(seriesProto.drawDataLabels){seriesProto.drawDataLabels.apply(this,arguments);}
i=length;while(i--){point=data[i];if(point){up=inside?point.plotHigh<point.plotLow:point.plotHigh>point.plotLow;point.dataLabelUpper=point.dataLabel;point.dataLabel=originalDataLabels[i];point.y=point.low;point.plotY=point._plotY;point.below=!up;if(inverted){if(!align){dataLabelOptions.align=up?'left':'right';}}else{if(!verticalAlign){dataLabelOptions.verticalAlign=up?'bottom':'top';}}
dataLabelOptions.x=dataLabelOptions.xLow;dataLabelOptions.y=dataLabelOptions.yLow;}}
if(seriesProto.drawDataLabels){seriesProto.drawDataLabels.apply(this,arguments);}}
dataLabelOptions.align=align;dataLabelOptions.verticalAlign=verticalAlign;},alignDataLabel:function(){seriesTypes.column.prototype.alignDataLabel.apply(this,arguments);},setStackedPoints:noop,getSymbol:noop,drawPoints:noop});defaultPlotOptions.areasplinerange=merge(defaultPlotOptions.arearange);seriesTypes.areasplinerange=extendClass(seriesTypes.arearange,{type:'areasplinerange',getPointSpline:seriesTypes.spline.prototype.getPointSpline});(function(){var colProto=seriesTypes.column.prototype;defaultPlotOptions.columnrange=merge(defaultPlotOptions.column,defaultPlotOptions.arearange,{lineWidth:1,pointRange:null});seriesTypes.columnrange=extendClass(seriesTypes.arearange,{type:'columnrange',translate:function(){var series=this,yAxis=series.yAxis,xAxis=series.xAxis,startAngleRad=xAxis.startAngleRad,start,chart=series.chart,isRadial=series.xAxis.isRadial,plotHigh;colProto.translate.apply(series);each(series.points,function(point){var shapeArgs=point.shapeArgs,minPointLength=series.options.minPointLength,heightDifference,height,y;point.plotHigh=plotHigh=yAxis.translate(point.high,0,1,0,1);point.plotLow=point.plotY;y=plotHigh;height=pick(point.rectPlotY,point.plotY)-plotHigh;if(Math.abs(height)<minPointLength){heightDifference=(minPointLength-height);height+=heightDifference;y-=heightDifference/2;}else if(height<0){height*=-1;y-=height;}
if(isRadial){start=point.barX+startAngleRad;point.shapeType='path';point.shapeArgs={d:series.polarArc(y+height,y,start,start+point.pointWidth)};}else{shapeArgs.height=height;shapeArgs.y=y;point.tooltipPos=chart.inverted?[yAxis.len+yAxis.pos-chart.plotLeft-y-height/2,xAxis.len+xAxis.pos-chart.plotTop-shapeArgs.x-shapeArgs.width/2,height]:[xAxis.left-chart.plotLeft+shapeArgs.x+shapeArgs.width/2,yAxis.pos-chart.plotTop+y+height/2,height];}});},directTouch:true,trackerGroups:['group','dataLabelsGroup'],drawGraph:noop,crispCol:colProto.crispCol,pointAttrToOptions:colProto.pointAttrToOptions,drawPoints:colProto.drawPoints,drawTracker:colProto.drawTracker,getColumnMetrics:colProto.getColumnMetrics,animate:function(){return colProto.animate.apply(this,arguments);},polarArc:function(){return colProto.polarArc.apply(this,arguments);}});}());defaultPlotOptions.gauge=merge(defaultPlotOptions.line,{dataLabels:{enabled:true,defer:false,y:15,borderWidth:1,borderColor:'silver',borderRadius:3,crop:false,verticalAlign:'top',zIndex:2},dial:{},pivot:{},tooltip:{headerFormat:''},showInLegend:false});var GaugePoint=extendClass(Point,{setState:function(state){this.state=state;}});var GaugeSeries={type:'gauge',pointClass:GaugePoint,angular:true,directTouch:true,drawGraph:noop,fixedBox:true,forceDL:true,trackerGroups:['group','dataLabelsGroup'],translate:function(){var series=this,yAxis=series.yAxis,options=series.options,center=yAxis.center;series.generatePoints();each(series.points,function(point){var dialOptions=merge(options.dial,point.dial),radius=(pInt(pick(dialOptions.radius,80))*center[2])/200,baseLength=(pInt(pick(dialOptions.baseLength,70))*radius)/100,rearLength=(pInt(pick(dialOptions.rearLength,10))*radius)/100,baseWidth=dialOptions.baseWidth||3,topWidth=dialOptions.topWidth||1,overshoot=options.overshoot,rotation=yAxis.startAngleRad+yAxis.translate(point.y,null,null,null,true);if(overshoot&&typeof overshoot==='number'){overshoot=overshoot/180*Math.PI;rotation=Math.max(yAxis.startAngleRad-overshoot,Math.min(yAxis.endAngleRad+overshoot,rotation));}else if(options.wrap===false){rotation=Math.max(yAxis.startAngleRad,Math.min(yAxis.endAngleRad,rotation));}
rotation=rotation*180/Math.PI;point.shapeType='path';point.shapeArgs={d:dialOptions.path||['M',-rearLength,-baseWidth/2,'L',baseLength,-baseWidth/2,radius,-topWidth/2,radius,topWidth/2,baseLength,baseWidth/2,-rearLength,baseWidth/2,'z'],translateX:center[0],translateY:center[1],rotation:rotation};point.plotX=center[0];point.plotY=center[1];});},drawPoints:function(){var series=this,center=series.yAxis.center,pivot=series.pivot,options=series.options,pivotOptions=options.pivot,renderer=series.chart.renderer;each(series.points,function(point){var graphic=point.graphic,shapeArgs=point.shapeArgs,d=shapeArgs.d,dialOptions=merge(options.dial,point.dial);if(graphic){graphic.animate(shapeArgs);shapeArgs.d=d;}else{point.graphic=renderer[point.shapeType](shapeArgs).attr({stroke:dialOptions.borderColor||'none','stroke-width':dialOptions.borderWidth||0,fill:dialOptions.backgroundColor||'black',rotation:shapeArgs.rotation,zIndex:1}).add(series.group);}});if(pivot){pivot.animate({translateX:center[0],translateY:center[1]});}else{series.pivot=renderer.circle(0,0,pick(pivotOptions.radius,5)).attr({'stroke-width':pivotOptions.borderWidth||0,stroke:pivotOptions.borderColor||'silver',fill:pivotOptions.backgroundColor||'black',zIndex:2}).translate(center[0],center[1]).add(series.group);}},animate:function(init){var series=this;if(!init){each(series.points,function(point){var graphic=point.graphic;if(graphic){graphic.attr({rotation:series.yAxis.startAngleRad*180/Math.PI});graphic.animate({rotation:point.shapeArgs.rotation},series.options.animation);}});series.animate=null;}},render:function(){this.group=this.plotGroup('group','series',this.visible?'visible':'hidden',this.options.zIndex,this.chart.seriesGroup);Series.prototype.render.call(this);this.group.clip(this.chart.clipRect);},setData:function(data,redraw){Series.prototype.setData.call(this,data,false);this.processData();this.generatePoints();if(pick(redraw,true)){this.chart.redraw();}},drawTracker:TrackerMixin&&TrackerMixin.drawTrackerPoint};seriesTypes.gauge=extendClass(seriesTypes.line,GaugeSeries);defaultPlotOptions.boxplot=merge(defaultPlotOptions.column,{fillColor:'#FFFFFF',lineWidth:1,medianWidth:2,states:{hover:{brightness:-0.3}},threshold:null,tooltip:{pointFormat:'<span style="color:{point.color}">\u25CF</span> <b> {series.name}</b><br/>'+'Maximum: {point.high}<br/>'+'Upper quartile: {point.q3}<br/>'+'Median: {point.median}<br/>'+'Lower quartile: {point.q1}<br/>'+'Minimum: {point.low}<br/>'},whiskerLength:'50%',whiskerWidth:2});seriesTypes.boxplot=extendClass(seriesTypes.column,{type:'boxplot',pointArrayMap:['low','q1','median','q3','high'],toYData:function(point){return[point.low,point.q1,point.median,point.q3,point.high];},pointValKey:'high',pointAttrToOptions:{fill:'fillColor',stroke:'color','stroke-width':'lineWidth'},drawDataLabels:noop,translate:function(){var series=this,yAxis=series.yAxis,pointArrayMap=series.pointArrayMap;seriesTypes.column.prototype.translate.apply(series);each(series.points,function(point){each(pointArrayMap,function(key){if(point[key]!==null){point[key+'Plot']=yAxis.translate(point[key],0,1,0,1);}});});},drawPoints:function(){var series=this,points=series.points,options=series.options,chart=series.chart,renderer=chart.renderer,pointAttr,q1Plot,q3Plot,highPlot,lowPlot,medianPlot,crispCorr,crispX,graphic,stemPath,stemAttr,boxPath,whiskersPath,whiskersAttr,medianPath,medianAttr,width,left,right,halfWidth,shapeArgs,color,doQuartiles=series.doQuartiles!==false,pointWiskerLength,whiskerLength=series.options.whiskerLength;each(points,function(point){graphic=point.graphic;shapeArgs=point.shapeArgs;stemAttr={};whiskersAttr={};medianAttr={};color=point.color||series.color;if(point.plotY!==UNDEFINED){pointAttr=point.pointAttr[point.selected?'selected':''];width=shapeArgs.width;left=mathFloor(shapeArgs.x);right=left+width;halfWidth=mathRound(width/2);q1Plot=mathFloor(doQuartiles?point.q1Plot:point.lowPlot);q3Plot=mathFloor(doQuartiles?point.q3Plot:point.lowPlot);highPlot=mathFloor(point.highPlot);lowPlot=mathFloor(point.lowPlot);stemAttr.stroke=point.stemColor||options.stemColor||color;stemAttr['stroke-width']=pick(point.stemWidth,options.stemWidth,options.lineWidth);stemAttr.dashstyle=point.stemDashStyle||options.stemDashStyle;whiskersAttr.stroke=point.whiskerColor||options.whiskerColor||color;whiskersAttr['stroke-width']=pick(point.whiskerWidth,options.whiskerWidth,options.lineWidth);medianAttr.stroke=point.medianColor||options.medianColor||color;medianAttr['stroke-width']=pick(point.medianWidth,options.medianWidth,options.lineWidth);crispCorr=(stemAttr['stroke-width']%2)/2;crispX=left+halfWidth+crispCorr;stemPath=['M',crispX,q3Plot,'L',crispX,highPlot,'M',crispX,q1Plot,'L',crispX,lowPlot];if(doQuartiles){crispCorr=(pointAttr['stroke-width']%2)/2;crispX=mathFloor(crispX)+crispCorr;q1Plot=mathFloor(q1Plot)+crispCorr;q3Plot=mathFloor(q3Plot)+crispCorr;left+=crispCorr;right+=crispCorr;boxPath=['M',left,q3Plot,'L',left,q1Plot,'L',right,q1Plot,'L',right,q3Plot,'L',left,q3Plot,'z'];}
if(whiskerLength){crispCorr=(whiskersAttr['stroke-width']%2)/2;highPlot=highPlot+crispCorr;lowPlot=lowPlot+crispCorr;pointWiskerLength=(/%$/).test(whiskerLength)?halfWidth*parseFloat(whiskerLength)/100:whiskerLength/2;whiskersPath=['M',crispX-pointWiskerLength,highPlot,'L',crispX+pointWiskerLength,highPlot,'M',crispX-pointWiskerLength,lowPlot,'L',crispX+pointWiskerLength,lowPlot];}
crispCorr=(medianAttr['stroke-width']%2)/2;medianPlot=mathRound(point.medianPlot)+crispCorr;medianPath=['M',left,medianPlot,'L',right,medianPlot];if(graphic){point.stem.animate({d:stemPath});if(whiskerLength){point.whiskers.animate({d:whiskersPath});}
if(doQuartiles){point.box.animate({d:boxPath});}
point.medianShape.animate({d:medianPath});}else{point.graphic=graphic=renderer.g().add(series.group);point.stem=renderer.path(stemPath).attr(stemAttr).add(graphic);if(whiskerLength){point.whiskers=renderer.path(whiskersPath).attr(whiskersAttr).add(graphic);}
if(doQuartiles){point.box=renderer.path(boxPath).attr(pointAttr).add(graphic);}
point.medianShape=renderer.path(medianPath).attr(medianAttr).add(graphic);}}});},setStackedPoints:noop});defaultPlotOptions.errorbar=merge(defaultPlotOptions.boxplot,{color:'#000000',grouping:false,linkedTo:':previous',tooltip:{pointFormat:'<span style="color:{point.color}">\u25CF</span> {series.name}: <b>{point.low}</b> - <b>{point.high}</b><br/>'},whiskerWidth:null});seriesTypes.errorbar=extendClass(seriesTypes.boxplot,{type:'errorbar',pointArrayMap:['low','high'],toYData:function(point){return[point.low,point.high];},pointValKey:'high',doQuartiles:false,drawDataLabels:seriesTypes.arearange?seriesTypes.arearange.prototype.drawDataLabels:noop,getColumnMetrics:function(){return(this.linkedParent&&this.linkedParent.columnMetrics)||seriesTypes.column.prototype.getColumnMetrics.call(this);}});defaultPlotOptions.waterfall=merge(defaultPlotOptions.column,{lineWidth:1,lineColor:'#333',dashStyle:'dot',borderColor:'#333',dataLabels:{inside:true},states:{hover:{lineWidthPlus:0}}});seriesTypes.waterfall=extendClass(seriesTypes.column,{type:'waterfall',upColorProp:'fill',pointValKey:'y',translate:function(){var series=this,options=series.options,yAxis=series.yAxis,len,i,points,point,shapeArgs,stack,y,yValue,previousY,previousIntermediate,range,minPointLength=pick(options.minPointLength,5),threshold=options.threshold,stacking=options.stacking,tooltipY;seriesTypes.column.prototype.translate.apply(this);series.minPointLengthOffset=0;previousY=previousIntermediate=threshold;points=series.points;for(i=0,len=points.length;i<len;i++){point=points[i];yValue=this.processedYData[i];shapeArgs=point.shapeArgs;stack=stacking&&yAxis.stacks[(series.negStacks&&yValue<threshold?'-':'')+series.stackKey];range=stack?stack[point.x].points[series.index+','+i]:[0,yValue];if(point.isSum){point.y=correctFloat(yValue);}else if(point.isIntermediateSum){point.y=correctFloat(yValue-previousIntermediate);}
y=mathMax(previousY,previousY+point.y)+range[0];shapeArgs.y=yAxis.translate(y,0,1);if(point.isSum){shapeArgs.y=yAxis.translate(range[1],0,1);shapeArgs.height=Math.min(yAxis.translate(range[0],0,1),yAxis.len)-shapeArgs.y+series.minPointLengthOffset;}else if(point.isIntermediateSum){shapeArgs.y=yAxis.translate(range[1],0,1);shapeArgs.height=Math.min(yAxis.translate(previousIntermediate,0,1),yAxis.len)-shapeArgs.y+series.minPointLengthOffset;previousIntermediate=range[1];}else{if(previousY!==0){shapeArgs.height=yValue>0?yAxis.translate(previousY,0,1)-shapeArgs.y:yAxis.translate(previousY,0,1)-yAxis.translate(previousY-yValue,0,1);}
previousY+=yValue;}
if(shapeArgs.height<0){shapeArgs.y+=shapeArgs.height;shapeArgs.height*=-1;}
point.plotY=shapeArgs.y=mathRound(shapeArgs.y)-(series.borderWidth%2)/2;shapeArgs.height=mathMax(mathRound(shapeArgs.height),0.001);point.yBottom=shapeArgs.y+shapeArgs.height;if(shapeArgs.height<=minPointLength){shapeArgs.height=minPointLength;series.minPointLengthOffset+=minPointLength;}
shapeArgs.y-=series.minPointLengthOffset;tooltipY=point.plotY+(point.negative?shapeArgs.height:0)-series.minPointLengthOffset;if(series.chart.inverted){point.tooltipPos[0]=yAxis.len-tooltipY;}else{point.tooltipPos[1]=tooltipY;}}},processData:function(force){var series=this,options=series.options,yData=series.yData,points=series.options.data,point,dataLength=yData.length,threshold=options.threshold||0,subSum,sum,dataMin,dataMax,y,i;sum=subSum=dataMin=dataMax=threshold;for(i=0;i<dataLength;i++){y=yData[i];point=points&&points[i]?points[i]:{};if(y==='sum'||point.isSum){yData[i]=correctFloat(sum);}else if(y==='intermediateSum'||point.isIntermediateSum){yData[i]=correctFloat(subSum);}else{sum+=y;subSum+=y;}
dataMin=Math.min(sum,dataMin);dataMax=Math.max(sum,dataMax);}
Series.prototype.processData.call(this,force);series.dataMin=dataMin;series.dataMax=dataMax;},toYData:function(pt){if(pt.isSum){return(pt.x===0?null:'sum');}
if(pt.isIntermediateSum){return(pt.x===0?null:'intermediateSum');}
return pt.y;},getAttribs:function(){seriesTypes.column.prototype.getAttribs.apply(this,arguments);var series=this,options=series.options,stateOptions=options.states,upColor=options.upColor||series.color,hoverColor=Highcharts.Color(upColor).brighten(0.1).get(),seriesDownPointAttr=merge(series.pointAttr),upColorProp=series.upColorProp;seriesDownPointAttr[''][upColorProp]=upColor;seriesDownPointAttr.hover[upColorProp]=stateOptions.hover.upColor||hoverColor;seriesDownPointAttr.select[upColorProp]=stateOptions.select.upColor||upColor;each(series.points,function(point){if(!point.options.color){if(point.y>0){point.pointAttr=seriesDownPointAttr;point.color=upColor;}else{point.pointAttr=series.pointAttr;}}});},getGraphPath:function(){var data=this.data,length=data.length,lineWidth=this.options.lineWidth+this.borderWidth,normalizer=mathRound(lineWidth)%2/2,path=[],M='M',L='L',prevArgs,pointArgs,i,d;for(i=1;i<length;i++){pointArgs=data[i].shapeArgs;prevArgs=data[i-1].shapeArgs;d=[M,prevArgs.x+prevArgs.width,prevArgs.y+normalizer,L,pointArgs.x,prevArgs.y+normalizer];if(data[i-1].y<0){d[2]+=prevArgs.height;d[5]+=prevArgs.height;}
path=path.concat(d);}
return path;},getExtremes:noop,drawGraph:Series.prototype.drawGraph});defaultPlotOptions.polygon=merge(defaultPlotOptions.scatter,{marker:{enabled:false}});seriesTypes.polygon=extendClass(seriesTypes.scatter,{type:'polygon',fillGraph:true,getSegmentPath:function(segment){return Series.prototype.getSegmentPath.call(this,segment).concat('z');},drawGraph:Series.prototype.drawGraph,drawLegendSymbol:Highcharts.LegendSymbolMixin.drawRectangle});defaultPlotOptions.bubble=merge(defaultPlotOptions.scatter,{dataLabels:{formatter:function(){return this.point.z;},inside:true,verticalAlign:'middle'},marker:{lineColor:null,lineWidth:1},minSize:8,maxSize:'20%',softThreshold:false,states:{hover:{halo:{size:5}}},tooltip:{pointFormat:'({point.x}, {point.y}), Size: {point.z}'},turboThreshold:0,zThreshold:0,zoneAxis:'z'});var BubblePoint=extendClass(Point,{haloPath:function(){return Point.prototype.haloPath.call(this,this.shapeArgs.r+this.series.options.states.hover.halo.size);},ttBelow:false});seriesTypes.bubble=extendClass(seriesTypes.scatter,{type:'bubble',pointClass:BubblePoint,pointArrayMap:['y','z'],parallelArrays:['x','y','z'],trackerGroups:['group','dataLabelsGroup'],bubblePadding:true,zoneAxis:'z',pointAttrToOptions:{stroke:'lineColor','stroke-width':'lineWidth',fill:'fillColor'},applyOpacity:function(fill){var markerOptions=this.options.marker,fillOpacity=pick(markerOptions.fillOpacity,0.5);fill=fill||markerOptions.fillColor||this.color;if(fillOpacity!==1){fill=Color(fill).setOpacity(fillOpacity).get('rgba');}
return fill;},convertAttribs:function(){var obj=Series.prototype.convertAttribs.apply(this,arguments);obj.fill=this.applyOpacity(obj.fill);return obj;},getRadii:function(zMin,zMax,minSize,maxSize){var len,i,pos,zData=this.zData,radii=[],options=this.options,sizeByArea=options.sizeBy!=='width',zThreshold=options.zThreshold,zRange=zMax-zMin,value,radius;for(i=0,len=zData.length;i<len;i++){value=zData[i];if(options.sizeByAbsoluteValue&&value!==null){value=Math.abs(value-zThreshold);zMax=Math.max(zMax-zThreshold,Math.abs(zMin-zThreshold));zMin=0;}
if(value===null){radius=null;}else if(value<zMin){radius=minSize/2-1;}else{pos=zRange>0?(value-zMin)/zRange:0.5;if(sizeByArea&&pos>=0){pos=Math.sqrt(pos);}
radius=math.ceil(minSize+pos*(maxSize-minSize))/2;}
radii.push(radius);}
this.radii=radii;},animate:function(init){var animation=this.options.animation;if(!init){each(this.points,function(point){var graphic=point.graphic,shapeArgs=point.shapeArgs;if(graphic&&shapeArgs){graphic.attr('r',1);graphic.animate({r:shapeArgs.r},animation);}});this.animate=null;}},translate:function(){var i,data=this.data,point,radius,radii=this.radii;seriesTypes.scatter.prototype.translate.call(this);i=data.length;while(i--){point=data[i];radius=radii?radii[i]:0;if(typeof radius==='number'&&radius>=this.minPxSize/2){point.shapeType='circle';point.shapeArgs={x:point.plotX,y:point.plotY,r:radius};point.dlBox={x:point.plotX-radius,y:point.plotY-radius,width:2*radius,height:2*radius};}else{point.shapeArgs=point.plotY=point.dlBox=UNDEFINED;}}},drawLegendSymbol:function(legend,item){var renderer=this.chart.renderer,radius=renderer.fontMetrics(legend.itemStyle.fontSize).f/2;item.legendSymbol=renderer.circle(radius,legend.baseline-radius,radius).attr({zIndex:3}).add(item.legendGroup);item.legendSymbol.isMarker=true;},drawPoints:seriesTypes.column.prototype.drawPoints,alignDataLabel:seriesTypes.column.prototype.alignDataLabel,buildKDTree:noop,applyZones:noop});Axis.prototype.beforePadding=function(){var axis=this,axisLength=this.len,chart=this.chart,pxMin=0,pxMax=axisLength,isXAxis=this.isXAxis,dataKey=isXAxis?'xData':'yData',min=this.min,extremes={},smallestSize=math.min(chart.plotWidth,chart.plotHeight),zMin=Number.MAX_VALUE,zMax=-Number.MAX_VALUE,range=this.max-min,transA=axisLength/range,activeSeries=[];each(this.series,function(series){var seriesOptions=series.options,zData;if(series.bubblePadding&&(series.visible||!chart.options.chart.ignoreHiddenSeries)){axis.allowZoomOutside=true;activeSeries.push(series);if(isXAxis){each(['minSize','maxSize'],function(prop){var length=seriesOptions[prop],isPercent=/%$/.test(length);length=pInt(length);extremes[prop]=isPercent?smallestSize*length/100:length;});series.minPxSize=extremes.minSize;series.maxPxSize=extremes.maxSize;zData=series.zData;if(zData.length){zMin=pick(seriesOptions.zMin,math.min(zMin,math.max(arrayMin(zData),seriesOptions.displayNegative===false?seriesOptions.zThreshold:-Number.MAX_VALUE)));zMax=pick(seriesOptions.zMax,math.max(zMax,arrayMax(zData)));}}}});each(activeSeries,function(series){var data=series[dataKey],i=data.length,radius;if(isXAxis){series.getRadii(zMin,zMax,series.minPxSize,series.maxPxSize);}
if(range>0){while(i--){if(typeof data[i]==='number'&&axis.dataMin<=data[i]&&data[i]<=axis.dataMax){radius=series.radii[i];pxMin=Math.min(((data[i]-min)*transA)-radius,pxMin);pxMax=Math.max(((data[i]-min)*transA)+radius,pxMax);}}}});if(activeSeries.length&&range>0&&!this.isLog){pxMax-=axisLength;transA*=(axisLength+pxMin-pxMax)/axisLength;each([['min','userMin',pxMin],['max','userMax',pxMax]],function(keys){if(pick(axis.options[keys[0]],axis[keys[1]])===UNDEFINED){axis[keys[0]]+=keys[2]/transA;}});}};(function(){var seriesProto=Series.prototype,pointerProto=Pointer.prototype,colProto;seriesProto.searchPointByAngle=function(e){var series=this,chart=series.chart,xAxis=series.xAxis,center=xAxis.pane.center,plotX=e.chartX-center[0]-chart.plotLeft,plotY=e.chartY-center[1]-chart.plotTop;return this.searchKDTree({clientX:180+(Math.atan2(plotX,plotY)*(-180/Math.PI))});};wrap(seriesProto,'buildKDTree',function(proceed){if(this.chart.polar){if(this.kdByAngle){this.searchPoint=this.searchPointByAngle;}else{this.kdDimensions=2;}}
proceed.apply(this);});seriesProto.toXY=function(point){var xy,chart=this.chart,plotX=point.plotX,plotY=point.plotY,clientX;point.rectPlotX=plotX;point.rectPlotY=plotY;xy=this.xAxis.postTranslate(point.plotX,this.yAxis.len-plotY);point.plotX=point.polarPlotX=xy.x-chart.plotLeft;point.plotY=point.polarPlotY=xy.y-chart.plotTop;if(this.kdByAngle){clientX=((plotX/Math.PI*180)+this.xAxis.pane.options.startAngle)%360;if(clientX<0){clientX+=360;}
point.clientX=clientX;}else{point.clientX=point.plotX;}};if(seriesTypes.spline){wrap(seriesTypes.spline.prototype,'getPointSpline',function(proceed,segment,point,i){var ret,smoothing=1.5,denom=smoothing+1,plotX,plotY,lastPoint,nextPoint,lastX,lastY,nextX,nextY,leftContX,leftContY,rightContX,rightContY,distanceLeftControlPoint,distanceRightControlPoint,leftContAngle,rightContAngle,jointAngle;if(this.chart.polar){plotX=point.plotX;plotY=point.plotY;lastPoint=segment[i-1];nextPoint=segment[i+1];if(this.connectEnds){if(!lastPoint){lastPoint=segment[segment.length-2];}
if(!nextPoint){nextPoint=segment[1];}}
if(lastPoint&&nextPoint){lastX=lastPoint.plotX;lastY=lastPoint.plotY;nextX=nextPoint.plotX;nextY=nextPoint.plotY;leftContX=(smoothing*plotX+lastX)/denom;leftContY=(smoothing*plotY+lastY)/denom;rightContX=(smoothing*plotX+nextX)/denom;rightContY=(smoothing*plotY+nextY)/denom;distanceLeftControlPoint=Math.sqrt(Math.pow(leftContX-plotX,2)+Math.pow(leftContY-plotY,2));distanceRightControlPoint=Math.sqrt(Math.pow(rightContX-plotX,2)+Math.pow(rightContY-plotY,2));leftContAngle=Math.atan2(leftContY-plotY,leftContX-plotX);rightContAngle=Math.atan2(rightContY-plotY,rightContX-plotX);jointAngle=(Math.PI/2)+((leftContAngle+rightContAngle)/2);if(Math.abs(leftContAngle-jointAngle)>Math.PI/2){jointAngle-=Math.PI;}
leftContX=plotX+Math.cos(jointAngle)*distanceLeftControlPoint;leftContY=plotY+Math.sin(jointAngle)*distanceLeftControlPoint;rightContX=plotX+Math.cos(Math.PI+jointAngle)*distanceRightControlPoint;rightContY=plotY+Math.sin(Math.PI+jointAngle)*distanceRightControlPoint;point.rightContX=rightContX;point.rightContY=rightContY;}
if(!i){ret=['M',plotX,plotY];}else{ret=['C',lastPoint.rightContX||lastPoint.plotX,lastPoint.rightContY||lastPoint.plotY,leftContX||plotX,leftContY||plotY,plotX,plotY];lastPoint.rightContX=lastPoint.rightContY=null;}}else{ret=proceed.call(this,segment,point,i);}
return ret;});}
wrap(seriesProto,'translate',function(proceed){var chart=this.chart,points,i;proceed.call(this);if(chart.polar){this.kdByAngle=chart.tooltip&&chart.tooltip.shared;if(!this.preventPostTranslate){points=this.points;i=points.length;while(i--){this.toXY(points[i]);}}}});wrap(seriesProto,'getGraphPath',function(proceed,points){var series=this;if(this.chart.polar){points=points||this.points;if(this.options.connectEnds!==false&&points[0].y!==null){this.connectEnds=true;points.splice(points.length,0,points[0]);}
each(points,function(point){if(point.polarPlotY===undefined){series.toXY(point);}});}
return proceed.apply(this,[].slice.call(arguments,1));});function polarAnimate(proceed,init){var chart=this.chart,animation=this.options.animation,group=this.group,markerGroup=this.markerGroup,center=this.xAxis.center,plotLeft=chart.plotLeft,plotTop=chart.plotTop,attribs;if(chart.polar){if(chart.renderer.isSVG){if(animation===true){animation={};}
if(init){attribs={translateX:center[0]+plotLeft,translateY:center[1]+plotTop,scaleX:0.001,scaleY:0.001};group.attr(attribs);if(markerGroup){markerGroup.attr(attribs);}}else{attribs={translateX:plotLeft,translateY:plotTop,scaleX:1,scaleY:1};group.animate(attribs,animation);if(markerGroup){markerGroup.animate(attribs,animation);}
this.animate=null;}}}else{proceed.call(this,init);}}
wrap(seriesProto,'animate',polarAnimate);if(seriesTypes.column){colProto=seriesTypes.column.prototype;colProto.polarArc=function(low,high,start,end){var center=this.xAxis.center,len=this.yAxis.len;return this.chart.renderer.symbols.arc(center[0],center[1],len-high,null,{start:start,end:end,innerR:len-pick(low,len)});};wrap(colProto,'animate',polarAnimate);wrap(colProto,'translate',function(proceed){var xAxis=this.xAxis,startAngleRad=xAxis.startAngleRad,start,points,point,i;this.preventPostTranslate=true;proceed.call(this);if(xAxis.isRadial){points=this.points;i=points.length;while(i--){point=points[i];start=point.barX+startAngleRad;point.shapeType='path';point.shapeArgs=this.polarArc(point.yBottom,point.plotY,start,start+point.pointWidth);this.toXY(point);point.tooltipPos=[point.plotX,point.plotY];point.ttBelow=point.plotY>xAxis.center[1];}}});wrap(colProto,'alignDataLabel',function(proceed,point,dataLabel,options,alignTo,isNew){if(this.chart.polar){var angle=point.rectPlotX/Math.PI*180,align,verticalAlign;if(options.align===null){if(angle>20&&angle<160){align='left';}else if(angle>200&&angle<340){align='right';}else{align='center';}
options.align=align;}
if(options.verticalAlign===null){if(angle<45||angle>315){verticalAlign='bottom';}else if(angle>135&&angle<225){verticalAlign='top';}else{verticalAlign='middle';}
options.verticalAlign=verticalAlign;}
seriesProto.alignDataLabel.call(this,point,dataLabel,options,alignTo,isNew);}else{proceed.call(this,point,dataLabel,options,alignTo,isNew);}});}
wrap(pointerProto,'getCoordinates',function(proceed,e){var chart=this.chart,ret={xAxis:[],yAxis:[]};if(chart.polar){each(chart.axes,function(axis){var isXAxis=axis.isXAxis,center=axis.center,x=e.chartX-center[0]-chart.plotLeft,y=e.chartY-center[1]-chart.plotTop;ret[isXAxis?'xAxis':'yAxis'].push({axis:axis,value:axis.translate(isXAxis?Math.PI-Math.atan2(x,y):Math.sqrt(Math.pow(x,2)+Math.pow(y,2)),true)});});}else{ret=proceed.call(this,e);}
return ret;});}());}));;

/* /web_highstock/static/lib/exporting.js defined in bundle 'web.assets_backend' */
(function(f){var A=f.Chart,t=f.addEvent,B=f.removeEvent,l=f.createElement,o=f.discardElement,v=f.css,k=f.merge,r=f.each,p=f.extend,D=Math.max,j=document,C=window,E=f.isTouchDevice,F=f.Renderer.prototype.symbols,s=f.getOptions(),y;p(s.lang,{printChart:"Print chart",downloadPNG:"Download PNG image",downloadJPEG:"Download JPEG image",downloadPDF:"Download PDF document",downloadSVG:"Download SVG vector image",contextButtonTitle:"Chart context menu"});s.navigation={menuStyle:{border:"1px solid #A0A0A0",background:"#FFFFFF",padding:"5px 0"},menuItemStyle:{padding:"0 10px",background:"none",color:"#303030",fontSize:E?"14px":"11px"},menuItemHoverStyle:{background:"#4572A5",color:"#FFFFFF"},buttonOptions:{symbolFill:"#E0E0E0",symbolSize:14,symbolStroke:"#666",symbolStrokeWidth:3,symbolX:12.5,symbolY:10.5,align:"right",buttonSpacing:3,height:22,theme:{fill:"white",stroke:"none"},verticalAlign:"top",width:24}};s.exporting={type:"image/png",url:"http://export.highcharts.com/",buttons:{contextButton:{menuClassName:"highcharts-contextmenu",symbol:"menu",_titleKey:"contextButtonTitle",menuItems:[{textKey:"printChart",onclick:function(){this.print()}},{separator:!0},{textKey:"downloadPNG",onclick:function(){this.exportChart()}},{textKey:"downloadJPEG",onclick:function(){this.exportChart({type:"image/jpeg"})}},{textKey:"downloadPDF",onclick:function(){this.exportChart({type:"application/pdf"})}},{textKey:"downloadSVG",onclick:function(){this.exportChart({type:"image/svg+xml"})}}]}}};f.post=function(b,a,d){var c,b=l("form",k({method:"post",action:b,enctype:"multipart/form-data"},d),{display:"none"},j.body);for(c in a)l("input",{type:"hidden",name:c,value:a[c]},null,b);b.submit();o(b)};p(A.prototype,{getSVG:function(b){var a=this,d,c,z,h,g=k(a.options,b);if(!j.createElementNS)j.createElementNS=function(a,b){return j.createElement(b)};b=l("div",null,{position:"absolute",top:"-9999em",width:a.chartWidth+"px",height:a.chartHeight+"px"},j.body);c=a.renderTo.style.width;h=a.renderTo.style.height;c=g.exporting.sourceWidth||g.chart.width||/px$/.test(c)&&parseInt(c,10)||600;h=g.exporting.sourceHeight||g.chart.height||/px$/.test(h)&&parseInt(h,10)||400;p(g.chart,{animation:!1,renderTo:b,forExport:!0,width:c,height:h});g.exporting.enabled=!1;g.series=[];r(a.series,function(a){z=k(a.options,{animation:!1,enableMouseTracking:!1,showCheckbox:!1,visible:a.visible});z.isInternal||g.series.push(z)});d=new f.Chart(g,a.callback);r(["xAxis","yAxis"],function(b){r(a[b],function(a,c){var g=d[b][c],f=a.getExtremes(),h=f.userMin,f=f.userMax;g&&(h!==void 0||f!==void 0)&&g.setExtremes(h,f,!0,!1)})});c=d.container.innerHTML;g=null;d.destroy();o(b);c=c.replace(/zIndex="[^"]+"/g,"").replace(/isShadow="[^"]+"/g,"").replace(/symbolName="[^"]+"/g,"").replace(/jQuery[0-9]+="[^"]+"/g,"").replace(/url\([^#]+#/g,"url(#").replace(/<svg /,'<svg xmlns:xlink="http://www.w3.org/1999/xlink" ').replace(/ href=/g," xlink:href=").replace(/\n/," ").replace(/<\/svg>.*?$/,"</svg>").replace(/(fill|stroke)="rgba\(([ 0-9]+,[ 0-9]+,[ 0-9]+),([ 0-9\.]+)\)"/g,'$1="rgb($2)" $1-opacity="$3"').replace(/&nbsp;/g," ").replace(/&shy;/g,"­").replace(/<IMG /g,"<image ").replace(/height=([^" ]+)/g,'height="$1"').replace(/width=([^" ]+)/g,'width="$1"').replace(/hc-svg-href="([^"]+)">/g,'xlink:href="$1"/>').replace(/id=([^" >]+)/g,'id="$1"').replace(/class=([^" >]+)/g,'class="$1"').replace(/ transform /g," ").replace(/:(path|rect)/g,"$1").replace(/style="([^"]+)"/g,function(a){return a.toLowerCase()});return c=c.replace(/(url\(#highcharts-[0-9]+)&quot;/g,"$1").replace(/&quot;/g,"'")},exportChart:function(b,a){var b=b||{},d=this.options.exporting,d=this.getSVG(k({chart:{borderRadius:0}},d.chartOptions,a,{exporting:{sourceWidth:b.sourceWidth||d.sourceWidth,sourceHeight:b.sourceHeight||d.sourceHeight}})),b=k(this.options.exporting,b);f.post(b.url,{filename:b.filename||"chart",type:b.type,width:b.width||0,scale:b.scale||2,svg:d},b.formAttributes)},print:function(){var b=this,a=b.container,d=[],c=a.parentNode,f=j.body,h=f.childNodes;if(!b.isPrinting)b.isPrinting=!0,r(h,function(a,b){if(a.nodeType===1)d[b]=a.style.display,a.style.display="none"}),f.appendChild(a),C.focus(),C.print(),setTimeout(function(){c.appendChild(a);r(h,function(a,b){if(a.nodeType===1)a.style.display=d[b]});b.isPrinting=!1},1E3)},contextMenu:function(b,a,d,c,f,h,g){var e=this,k=e.options.navigation,q=k.menuItemStyle,m=e.chartWidth,n=e.chartHeight,j="cache-"+b,i=e[j],u=D(f,h),w,x,o,s=function(a){e.pointer.inClass(a.target,b)||x()};if(!i)e[j]=i=l("div",{className:b},{position:"absolute",zIndex:1E3,padding:u+"px"},e.container),w=l("div",null,p({MozBoxShadow:"3px 3px 10px #888",WebkitBoxShadow:"3px 3px 10px #888",boxShadow:"3px 3px 10px #888"},k.menuStyle),i),x=function(){v(i,{display:"none"});g&&g.setState(0);e.openMenu=!1},t(i,"mouseleave",function(){o=setTimeout(x,500)}),t(i,"mouseenter",function(){clearTimeout(o)}),t(document,"mouseup",s),t(e,"destroy",function(){B(document,"mouseup",s)}),r(a,function(a){if(a){var b=a.separator?l("hr",null,null,w):l("div",{onmouseover:function(){v(this,k.menuItemHoverStyle)},onmouseout:function(){v(this,q)},onclick:function(){x();a.onclick.apply(e,arguments)},innerHTML:a.text||e.options.lang[a.textKey]},p({cursor:"pointer"},q),w);e.exportDivElements.push(b)}}),e.exportDivElements.push(w,i),e.exportMenuWidth=i.offsetWidth,e.exportMenuHeight=i.offsetHeight;a={display:"block"};d+e.exportMenuWidth>m?a.right=m-d-f-u+"px":a.left=d-u+"px";c+h+e.exportMenuHeight>n&&g.alignOptions.verticalAlign!=="top"?a.bottom=n-c-u+"px":a.top=c+h-u+"px";v(i,a);e.openMenu=!0},addButton:function(b){var a=this,d=a.renderer,c=k(a.options.navigation.buttonOptions,b),j=c.onclick,h=c.menuItems,g,e,l={stroke:c.symbolStroke,fill:c.symbolFill},q=c.symbolSize||12;if(!a.btnCount)a.btnCount=0;if(!a.exportDivElements)a.exportDivElements=[],a.exportSVGElements=[];if(c.enabled!==!1){var m=c.theme,n=m.states,o=n&&n.hover,n=n&&n.select,i;delete m.states;j?i=function(){j.apply(a,arguments)}:h&&(i=function(){a.contextMenu(e.menuClassName,h,e.translateX,e.translateY,e.width,e.height,e);e.setState(2)});c.text&&c.symbol?m.paddingLeft=f.pick(m.paddingLeft,25):c.text||p(m,{width:c.width,height:c.height,padding:0});e=d.button(c.text,0,0,i,m,o,n).attr({title:a.options.lang[c._titleKey],"stroke-linecap":"round"});e.menuClassName=b.menuClassName||"highcharts-menu-"+a.btnCount++;c.symbol&&(g=d.symbol(c.symbol,c.symbolX-q/2,c.symbolY-q/2,q,q).attr(p(l,{"stroke-width":c.symbolStrokeWidth||1,zIndex:1})).add(e));e.add().align(p(c,{width:e.width,x:f.pick(c.x,y)}),!0,"spacingBox");y+=(e.width+c.buttonSpacing)*(c.align==="right"?-1:1);a.exportSVGElements.push(e,g)}},destroyExport:function(b){var b=b.target,a,d;for(a=0;a<b.exportSVGElements.length;a++)if(d=b.exportSVGElements[a])d.onclick=d.ontouchstart=null,b.exportSVGElements[a]=d.destroy();for(a=0;a<b.exportDivElements.length;a++)d=b.exportDivElements[a],B(d,"mouseleave"),b.exportDivElements[a]=d.onmouseout=d.onmouseover=d.ontouchstart=d.onclick=null,o(d)}});F.menu=function(b,a,d,c){return["M",b,a+2.5,"L",b+d,a+2.5,"M",b,a+c/2+0.5,"L",b+d,a+c/2+0.5,"M",b,a+c-1.5,"L",b+d,a+c-1.5]};A.prototype.callbacks.push(function(b){var a,d=b.options.exporting,c=d.buttons;y=0;if(d.enabled!==!1){for(a in c)b.addButton(c[a]);t(b,"destroy",b.destroyExport)}})})(Highcharts);;

/* /web_highstock/static/src/js/web_highstock2.js defined in bundle 'web.assets_backend' */
odoo.define('web_highstock',function(require){var core=require('web.core');var data=require('web.data');var form_common=require('web.form_common');var _t=core._t,_lt=core._lt;var QWeb=core.qweb;var ViewManager=require('web.ViewManager');var ControlPanel=require('web.ControlPanel');var View=require('web.View');var X2ManyViewManager=ViewManager.extend({init:function(parent,dataset,views,flags,x2many_views){var views_switcher=!!views.length;var flags=_.extend({},flags,{headless:false,search_view:false,action_buttons:true,pager:true,sidebar:false,views_switcher:views_switcher,});var cp_template=views.length>1?"ControlPanel":"X2ManyControlPanel";this.control_panel=new ControlPanel(parent,cp_template);this.set_cp_bus(this.control_panel.get_bus());this._super(parent,dataset,views,flags);this.registry=core.view_registry.extend(x2many_views);},start:function(){this.control_panel.prependTo(this.$el);return this._super();},switch_mode:function(mode,unused){if(typeof unused=="undefined"||unused==null){return this._super(mode,unused);}
var self=this;var id=self.x2m.dataset.index!==null?self.x2m.dataset.ids[self.x2m.dataset.index]:null;var pop=new form_common.FormViewDialog(this,{res_model:self.x2m.field.relation,res_id:id,context:self.x2m.build_context(),title:_t("Open: ")+self.x2m.string,create_function:function(data,options){return self.x2m.data_create(data,options);},write_function:function(id,data,options){return self.x2m.data_update(id,data,options).done(function(){self.x2m.reload_current_view();});},alternative_form_view:self.x2m.field.views?self.x2m.field.views.form:undefined,parent_view:self.x2m.view,child_name:self.x2m.name,read_function:function(ids,fields,options){return self.x2m.data_read(ids,fields,options);},form_view_options:{'not_interactible_on_create':true},readonly:self.x2m.get("effective_readonly")}).open();pop.on("elements_selected",self,function(){self.x2m.reload_current_view();});},});FieldX2Many=core.form_widget_registry.get('one2many').extend({load_views:function(){var self=this;var view_types=this.node.attrs.mode;view_types=!!view_types?view_types.split(","):[this.default_view];var views=[];_.each(view_types,function(view_type){if(!_.include(["list","tree","graph","kanban","highstock","form"],view_type)){throw new Error(_.str.sprintf(_t("View type '%s' is not supported in X2Many."),view_type));}
var view={view_id:false,view_type:view_type==="tree"?"list":view_type,options:{}};if(self.field.views&&self.field.views[view_type]){view.embedded_view=self.field.views[view_type];}
if(view.view_type==="list"){_.extend(view.options,{addable:null,selectable:self.multi_selection,sortable:true,import_enabled:false,deletable:true});if(self.get("effective_readonly")){_.extend(view.options,{deletable:null,reorderable:false,});}}else if(view.view_type==="kanban"){_.extend(view.options,{confirm_on_delete:false,});if(self.get("effective_readonly")){_.extend(view.options,{action_buttons:false,quick_creatable:false,creatable:false,read_only_mode:true,});}}
views.push(view);});this.views=views;this.viewmanager=new X2ManyViewManager(this,this.dataset,views,this.view_options,this.x2many_views);this.viewmanager.x2m=self;var def=$.Deferred().done(function(){self.initial_is_loaded.resolve();});this.viewmanager.on("controller_inited",self,function(view_type,controller){controller.x2m=self;if(view_type=="list"){if(self.get("effective_readonly")){controller.on('edit:before',self,function(e){e.cancel=true;});_(controller.columns).find(function(column){if(!(column instanceof core.list_widget_registry.get('field.handle'))){return false;}
column.modifiers.invisible=true;return true;});}}else if(view_type=="graph"){self.reload_current_view();}
def.resolve();});this.viewmanager.on("switch_mode",self,function(n_mode){$.when(self.commit_value()).done(function(){if(n_mode==="list"){$.async_when().done(function(){self.reload_current_view();});}});});$.async_when().done(function(){if(!self.isDestroyed()){self.viewmanager.appendTo(self.$el);}});return def;},});core.form_widget_registry.add('one2many',FieldX2Many);data.DataSetStatic.include({read_slice:function(fields,options){if(!(this.ids)){this.ids=[]}
return this._super(fields,options);}});var HighstockView=View.extend({display_name:_lt('Highstock'),view_type:"highstock",searchable:true,init:function(parent,dataset,view_id,options){this._super(parent);this.ready=$.Deferred();this.set_default_options(options);this.dataset=dataset;this.model=dataset.model;this.fields_view={};this.view_id=view_id;this.has_been_loaded=$.Deferred();this.creating_event_id=null;this.dataset_events=[];this.COLOR_PALETTE=['#f57900','#cc0000','#d400a8','#75507b','#3465a4','#73d216','#c17d11','#edd400','#fcaf3e','#ef2929','#ff00c9','#ad7fa8','#729fcf','#8ae234','#e9b96e','#fce94f','#ff8e00','#ff0000','#b0008c','#9000ff','#0078ff','#00ff00','#e6ff00','#ffff00','#905000','#9b0000','#840067','#510090','#0000c9','#009b00','#9abe00','#ffc900'];this.color_map={};this.last_search=[];this.range_start=null;this.range_stop=null;this.selected_filters=[];this.chart=null;this.ids_search=[];this.title='';this.title_model='';this.title_fields_to_read='';this.x_axis_name='';this.x_axis_field='';this.y_axis_name='';this.y_axis_field='';this.test_date=new Date();Highcharts.setOptions({lang:{months:moment.months(),weekdays:moment.weekdays(),},global:{timezoneOffset:this.test_date.getTimezoneOffset(),}});this.config_chart={xAxis:{type:'datetime',dateTimeLabelFormats:{second:'%Y-%m-%d<br/>%H:%M:%S',minute:'%Y-%m-%d<br/>%H:%M',hour:'%Y-%m-%d<br/>%H:%M',day:'%Y<br/>%m-%d',week:'%Y<br/>%m-%d',month:'%Y-%m',year:'%Y'},plotLines:[{value:Date.now(),width:2,color:'red',dashStyle:'dash',label:{text:'',align:'right',y:25,x:0}}]},scrollbar:{enabled:false},navigator:{xAxis:{type:'datetime',dateTimeLabelFormats:{second:'%Y-%m-%d<br/>%H:%M:%S',minute:'%Y-%m-%d<br/>%H:%M',hour:'%Y-%m-%d<br/>%H:%M',day:'%Y<br/>%m-%d',week:'%Y<br/>%m-%d',month:'%Y-%m',year:'%Y'},},},rangeSelector:{enabled:false,},title:{text:this.title},subtitle:{text:''},series:[{step:true,tooltip:{valueDecimals:2,}}]};},view_loading:function(r){return this.load_highstock(r);},load_highstock:function(fields_view_get,fields_get){var self=this;this.fields_view=fields_view_get;this.parse_fields(this,this.fields_view.arch.children,this.fields_view.fields);this.$el.addClass(this.fields_view.arch.attrs['class']);return this.on_loaded(fields_view_get);},on_loaded:function(data){this.fields_view=data;this.parse_fields(this,this.fields_view.arch.children,this.fields_view.fields);this.color_values=[];this.info_fields=[];this.name=this.fields_view.name||this.fields_view.arch.attrs.string;this.view_id=this.fields_view.view_id;this.mode=this.fields_view.arch.attrs.mode;this.fields=this.fields_view.fields;for(var fld=0;fld<this.fields_view.arch.children.length;fld++){this.info_fields.push(this.fields_view.arch.children[fld].attrs.name);}
this.$el.html(QWeb.render("HighstockView",{"fields_view":this.fields_view}));if(this.dataset.ids.length==0){this.dataset.ids=this.dataset.context.active_ids;this.last_search[0]=this.dataset.domain;this.do_ranged_search();}
else{this.ids=this.dataset.ids;}
this.has_been_loaded.resolve();},parse_fields:function(self,f_arch,f_obj){_.each(f_arch,function(f){if(f.attrs.usage=='x'){self.x_axis_field=f.attrs.name;self.x_axis_name=f.attrs.label;}
else if(f.attrs.usage=='y'){self.y_axis_field=f.attrs.name;self.y_axis_name=f.attrs.label;}
else if(f.attrs.usage=='title'){self.title_obj_name=f.attrs.name;self.title_model=f_obj[f.attrs.name].relation;self.title_id=f_obj[f.attrs.name].id;self.title_fields_to_read=f.attrs.fields_to_read;}});},do_search_domain:function(domain,self){aaa=self.dataset.read_slice(['id'],{offset:0,domain:domain,context:self.last_search[1]}).then(function(ids_read){self.do_toto(self,ids_read);});},do_toto:function(self,ids_read){_.each(ids_read,function(ev){self.ids_search.push(ev.id);});},init_highstock:function(){var self=this;this.chart=$('#openerp_highstock_container').highcharts('StockChart',this.config_chart);},on_events_loaded:function(events,fn_filter,no_filter_reload){var self=this;var res_events=[],sidebar_items={},in_moves=[],out_moves=[];var td=new Date();td.setDate(td.getDate()+1)
this.rpc("/web_highstock/convert_uom",{"model":this.model,"evts":events}).then(function(datas){events=datas;var states=['draft','progress'];_.each(events,function(event){if(event[self.x_axis_field]<=moment(td).format('YYYY-MM-DD')&$.inArray(event['state'],states)>=0){event[self.x_axis_field]=moment(td).format('YYYY-MM-DD HH:mm:ss')}});events_sorted_date=_(events).sortBy(function(a){return a[self.x_axis_field].substr(0,10);});var moves_by_date=_.groupBy(events_sorted_date,function(evt){return evt[self.x_axis_field].substr(0,10);});var in_out_by_date=[]
var total=0;var total_assigned=0;_.each(_.keys(moves_by_date),function(k){events_date=moves_by_date[k];var ins=[];var outs=[];_.each(events_date,function(evt){if(evt['type']=='in'){ins.push(evt[self.y_axis_field]);}
else if(evt['type']=='out'){outs.push(evt[self.y_axis_field]);}});k_list=k.split("-")
k_d=new Date(parseInt(k_list[0]),parseInt(k_list[1])-1,parseInt(k_list[2]))
var v_ins=_(ins).reduce(function(memo,i){return memo+i},0);var v_outs=_(outs).reduce(function(memos,i){return memos+i},0);total+=v_ins-v_outs
in_out_by_date.push([k_d.getTime(),total])});if(events[0]){var ok=true;var event_by_product=_.groupBy(events,function(a){return a[self.title_obj_name][0];});var product_keys=_.keys(event_by_product)
if(product_keys.length>1)
{ok=false;}
if(ok){self.rpc("/web_highstock/get_data",{model:self.title_model,id:events[0][self.title_obj_name][0],fields:self.title_fields_to_read}).then(function(datas){self.config_chart.title.text=events[0].product_id[1];self.config_chart.subtitle.text=datas[0]
self.config_chart.series=[{data:in_out_by_date,name:'Stock',step:true,tooltip:{valueDecimals:2,xDateFormat:"%Y-%m-%d",}}];self.config_chart.yAxis={plotLines:[{value:datas[1],width:2,color:'green',dashStyle:'dash',label:{text:datas[1],align:'left',y:-5,x:10}}]}
self.chart=$('#openerp_highstock_container').highcharts('StockChart',self.config_chart);});}
else{self.config_chart.title.text=_t("Please choose a product");self.chart=$('#openerp_highstock_container').highcharts('StockChart',self.config_chart);}}
else{self.config_chart.title.text=_t("No moves for this product");self.chart=$('#openerp_highstock_container').highcharts('StockChart',self.config_chart);}});},do_create_event:function(event_id,event_obj){var self=this,data=this.get_event_data(event_obj);this.dataset.create(data,function(r){var id=r.result;self.dataset.ids.push(id);scheduler.changeEventId(event_id,id);self.refresh_minical();self.reload_event(id);},function(r,event){event.preventDefault();self.do_create_event_with_formdialog(event_id,event_obj);});},do_search:function(domain,context,group_by){this.last_search=arguments;this.do_ranged_search();},do_ranged_search:function(){var self=this;if(this.fields==undefined)
{fields_to_read=["date","uom_qty","product_id","uom_id"]}
else
{fields_to_read=_.keys(self.fields)}
fields_to_read.push("type")
fields_to_read.push("state")
self.dataset.read_slice(fields_to_read,{offset:0,domain:self.get_range_domain(),context:self.last_search[1]}).then(function(events){self.dataset_events=events;self.on_events_loaded(events);});},get_range_domain:function(){domain=this.last_search[0];return domain;},do_show:function(){var self=this;$.when(this.has_been_loaded).then(function(){self.$el.show();if(self.sidebar){self.sidebar.$el.show();}
self.do_push_state({});});},do_hide:function(){this._super();},get_selected_ids:function(){return[];}});core.view_registry.add('highstock',HighstockView);});;

/* /web_openprod/static/src/js/web_openprod.js defined in bundle 'web.assets_backend' */
odoo.define('web_openprod',function(require){var ActionManager=require('web.ActionManager');var core=require('web.core');ActionManager.include({ir_actions_act_window_noclose:function(){},ir_actions_act_window_next:function(action,options){var model=action.context.model;core.bus.trigger('act_next',model);},ir_actions_act_window_dialog_reload:function(action,options){var widget=this.dialog_widget_stack[this.dialog_widget_stack.length-1]||this.dialog_widget;widget.views.form.controller.reload();},ir_actions_act_add_domain:function(action,options){window.new_domain=action.domain;this.dialog_stop();},ir_actions_act_window_dialog_parent_reload:function(action,options){var widget=this.dialog_widget;widget.views.form.controller.reload();this.dialog_stop();},});$(window.document).on('focus','.oe_list_header_search input',function(ev){var t=$(ev.target);var old_selected=$('.input_selected').toggleClass('input_selected');t.toggleClass('input_selected');});$(window.document).on('blur','.oe_list_header_search input',function(ev){var t=$(ev.relatedTarget||document.activeElement);if(!t.hasClass('search_type')){$(ev.target).removeClass('input_selected');}});});;

/* /binary_attachment/static/src/js/binary_attachment.js defined in bundle 'web.assets_backend' */
openerp.binary_attachment=function(instance){var _t=instance.web._t;instance.web.Sidebar.include({init:function(){this._super.apply(this,arguments);},do_attachement_update:function(dataset,model_id,args){var self=this;this.dataset=dataset;this.model_id=model_id;if(args&&args[0].error){this.do_warn(_t('Uploading Error'),args[0].error);}
if(!model_id){this.on_attachments_loaded([]);}else{var dom=[['res_model','=',dataset.model],['res_id','=',model_id],['type','in',['binary','url']],['is_binary_field','=',false]];var ds=new instance.web.DataSetSearch(this,'ir.attachment',dataset.get_context(),dom);ds.read_slice(['name','url','type','create_uid','create_date','write_uid','write_date'],{}).done(this.on_attachments_loaded);}}});};;

/* /web_tree_field_color/static/js/web_tree_field_color.js defined in bundle 'web.assets_backend' */
odoo.define('web_tree_field_color',function(require){"use strict";var core=require('web.core');var QWeb=core.qweb;var _t=core._t;var _lt=core._lt;var ListView=require('web.ListView');var fn_color=function(record,column){if(column.colors)
{var test=_(column.colors.split(';')).chain().compact().map(function(color_pair){var pair=color_pair.split(':'),color=pair[0],expr=pair[1];return[color,py.parse(py.tokenize(expr)),expr];}).value();var context=_.extend({},record.attributes,{uid:this.session.uid,current_date:new Date().toString('yyyy-MM-dd')});for(var i=0,len=test.length;i<len;++i){var pair=test[i];var color=pair[0];var expression=pair[1];if(py.evaluate(expression,context).toJSON()){return'background-color: '+color+';';}}};};ListView.include({init:function(){this._super.apply(this,arguments);this.group_colors=null;this.list_widget_registry=core.list_widget_registry;},load_list:function(data){if(this.fields_view.arch.attrs.group_colors){this.group_colors=_(this.fields_view.arch.attrs.group_colors.split(';')).chain().compact().map(function(color_pair){var pair=color_pair.split(':'),color=pair[0],expr=pair[1];return[color,py.parse(py.tokenize(expr)),expr];}).value();}
this._super(data);},compute_aggregates:function(records){var columns=_(this.aggregate_columns).filter(function(column){return column['function'];});if(_.isEmpty(columns)){return;}
if(_.isEmpty(records)){records=this.groups.get_records();}
records=_(records).compact();var count=0,sums={};_(columns).each(function(column){switch(column['function']){case'max':sums[column.id]=-Infinity;break;case'min':sums[column.id]=Infinity;break;default:sums[column.id]=0;}});_(records).each(function(record){count+=record.count||1;_(columns).each(function(column){var field=column.id,value=record.values[field];switch(column['function']){case'sum':if(!isNaN(value)){sums[field]+=Number(value);}
break;case'avg':sums[field]+=record.count*value;break;case'min':if(sums[field]>value){sums[field]=value;}
break;case'max':if(sums[field]<value){sums[field]=value;}
break;}});});var aggregates={};_(columns).each(function(column){if(column.label){var field=column.id;switch(column['function']){case'avg':aggregates[field]={value:sums[field]/count};break;case'avg_group':aggregates[field]={value:eval(column.avg_func)};break;default:aggregates[field]={value:sums[field]};}}});this.display_aggregates(aggregates);},});ListView.List.include({init:function(group,opts){this._super(group,opts);this.columns.get_display_color=fn_color;},get_display_color:fn_color,render:function(){this.$current.empty().append(QWeb.render('ListView.rows',_.extend({render_cell:function(){return self.render_cell.apply(self,arguments);},get_display_color:function(){return self.fn_color.apply(self,arguments);},readonly:this.view.getParent()&&this.view.getParent().getParent().get('effective_readonly'),},this)));this.pad_table_to(4);},render_record:function(record){var self=this;var index=this.records.indexOf(record);var columns=this.columns;var ret=QWeb.render('ListView.row',{columns:columns,options:this.options,record:record,row_parity:(index%2===0)?'even':'odd',view:this.view,render_cell:function(){return self.render_cell.apply(self,arguments);},get_display_color:function(){return fn_color.apply(self,arguments);}});var ret2=$(ret);_.each(self.columns,function(column){if(column.column_invisible){if(!self.view.getParent()){return true;}
var fm=self.view.getParent().getParent()._ic_field_manager;var invisible=fm.compute_domain(py.eval(column.column_invisible));if(invisible){ret2.find('[data-field='+column.name+']').hide();}else{ret2.find('[data-field='+column.name+']').show();}
return!invisible;}else{return true;}});return ret2[0].outerHTML;},});ListView.Groups.include({render_groups:function(datagroups){var self=this;var placeholder=this.make_fragment();var group_colors=self.view.group_colors;_(datagroups).each(function(group){var group_colors_parsed=new Object();_(group_colors).each(function(groupe){var obje=new Object();var g=groupe[1];obje['expression']=groupe[2]
obje['color']=groupe[0]
_(g.expressions).each(function(exp){if($.inArray(exp.value,_.keys(group.aggregates))>=0){if(group_colors_parsed[exp.value]==undefined){group_colors_parsed[exp.value]=[];}
group_colors_parsed[exp.value].push(obje);}})});if(self.children[group.value]){self.records.proxy(group.value).reset();delete self.children[group.value];}
var child=self.children[group.value]=new(self.view.options.GroupsType)(self.view,{records:self.records.proxy(group.value),options:self.options,columns:self.columns});self.bind_child_events(child);child.datagroup=group;var $row=child.$row=$('<tr class="oe_group_header">');if(group.openable&&group.length){$row.click(function(e){if(!$row.data('open')){$row.data('open',true).find('span.ui-icon').removeClass('ui-icon-triangle-1-e').addClass('ui-icon-triangle-1-s');child.open(self.point_insertion(e.currentTarget));}else{$row.removeData('open').find('span.ui-icon').removeClass('ui-icon-triangle-1-s').addClass('ui-icon-triangle-1-e');child.close();}});}
placeholder.appendChild($row[0]);var $group_column=$('<th class="oe-group-name">').appendTo($row);if(group.grouped_on){var row_data={};row_data[group.grouped_on]=group;var group_label=_t("Undefined");var group_column=_(self.columns).detect(function(column){return column.id===group.grouped_on;});if(group_column){try{group_label=group_column.format(row_data,{value_if_empty:_t("Undefined"),process_modifiers:false});}catch(e){group_label=_.str.escapeHTML(row_data[group_column.id].value);}}else{group_label=group.value;if(group_label instanceof Array){group_label=group_label[1];}
if(group_label===false){group_label=_t('Undefined');}
group_label=_.str.escapeHTML(group_label);}
$group_column.html(_.str.sprintf(_t("%s (%d)"),group_label,group.length));if(group.length&&group.openable){$group_column.prepend('<span class="ui-icon ui-icon-triangle-1-e" style="float: left;">');}else{$group_column.prepend('<span class="ui-icon" style="float: left; background-position: 150px 150px">');}}
self.indent($group_column,group.level);if(self.options.selectable){$row.append('<td>');}
if(self.options.isClarkGable){$row.append('<td>');}
_(self.columns).chain().filter(function(column){return column.invisible!=='1';}).each(function(column){if(column.meta){}else if(column.id in group.aggregates){var r={};r[column.id]={value:group.aggregates[column.id]};var td_create=$('<td class="oe_number">').html(column.format(r,{process_modifiers:false})).appendTo($row);if($.inArray(column.id,_.keys(group_colors_parsed))>=0){var g=group_colors_parsed[column.id];_(group_colors_parsed[column.id]).each(function(g){var expression=g.expression.replace(column.id,group.aggregates[column.id].toString());if(py.eval(expression)){td_create.css('background-color',g.color);}})}}else{$row.append('<td>');}});if(self.options.deletable){$row.append('<td class="oe-group-pagination">');}});return placeholder;},});core.list_widget_registry.map.field.include({to_aggregate:function(){if(this.type!=='integer'&&this.type!=='float'&&this.type!=='monetary'&&this.type!=='text'){return{};}
var aggregation_func=this['group_operator']||this['avg_group']||this['avg']||'sum';var C=function(fn,label,avg_func){this['function']=fn;this.label=label;this.avg_func=avg_func;};C.prototype=this;if(this.avg){return new C('avg','avg',null);}
if(this.avg_group){return new C('avg_group','avg_group',aggregation_func);}
return new C(aggregation_func,this[aggregation_func],null);},});return ListView;});;

/* /web_to_upper/static/src/js/web_to_upper.js defined in bundle 'web.assets_backend' */
odoo.define('web_to_upper',function web_to_upper(require){'use strict';var upper_regex=/[^µ]/g
function capitalize(str){if(typeof str==='string')
return str.replace(upper_regex,function(txt){return txt.toUpperCase();});return str;};var WebFormats=require('web.formats');var _=window._;var parse_value=WebFormats.parse_value;WebFormats.parse_value=function(value,descriptor,value_if_empty){value=parse_value(value,descriptor,value_if_empty);switch(descriptor.widget||descriptor.type||(descriptor.field&&descriptor.field.type)){case'toupper':if(value!=false&&value!="false"&&typeof value!=="undefined"){value=capitalize(value);}}
return value;};var format_value=WebFormats.format_value;WebFormats.format_value=function(value,descriptor,value_if_empty){value=format_value(value,descriptor,value_if_empty);switch(descriptor.widget||descriptor.type||(descriptor.field&&descriptor.field.type)){case'toupper':if(value!=false&&value!="false"&&typeof value!=="undefined"){value=capitalize(value);}}
return value;};return WebFormats;});;

/* /web_view_editor/static/src/js/view_editor.js defined in bundle 'web.assets_backend' */
odoo.define('web_view_editor.view_editor',function(require){"use strict";var ActionManager=require('web.ActionManager');var core=require('web.core');var data=require('web.data');var DebugManager=require('web.DebugManager');var Dialog=require('web.Dialog');var formats=require('web.formats');var Registry=require('web.Registry');var session=require('web.session');var utils=require('web.utils');var Widget=require('web.Widget');var QWeb=core.qweb;var _t=core._t;if(core.debug){DebugManager.include({manage_views:function(){if(this.view.fields_view&&this.view.fields_view.arch){var view_editor=new ViewEditor(this.view,this.view.$el,this.dataset,this.view.fields_view.arch);view_editor.start();}else{this.do_warn(_t("Manage Views"),_t("Could not find current view declaration"));}}});}
var ViewEditor=Widget.extend({init:function(parent,element_id,dataset){this._super(parent);this.parent=parent;this.dataset=new data.DataSetSearch(this,'ir.ui.view',null,null);this.model=dataset.model;this.xml_element_id=0;this.property=ViewEditor.property_widget;this.one_object=false;},start:function(){this.init_view_editor();},init_view_editor:function(){var self=this,action_title=_.str.sprintf(_t("Manage Views (%s)"),this.model);var action={name:action_title,context:session.user_context,domain:[["model","=",this.model]],res_model:'ir.ui.view',views:[[false,'list']],type:'ir.actions.act_window',target:"current",limit:this.dataset.limit||80,auto_search:true,flags:{sidebar:false,deletable:false,views_switcher:false,action_buttons:false,search_view:true,headless:true,pager:false,radio:true,select_view_id:self.parent.fields_view.view_id}};this.view_edit_dialog=new Dialog(this,{title:action_title,buttons:[{text:_t("Create"),click:function(){self.on_create_view();}},{text:_t("Edit"),click:function(){self.xml_element_id=0;self.get_arch();}},{text:_t("Remove"),click:function(){self.do_delete_view();}},{text:_t("Close"),click:function(){window.location.reload();},close:true}]}).open();this.view_edit_dialog.on("closed",this,function(){window.location.reload();});this.main_view_id=this.parent.fields_view.view_id;this.action_manager=new ActionManager(this);this.action_manager.appendTo(this.view_edit_dialog.$el);$.when(this.action_manager.do_action(action)).done(function(){var viewmanager=self.action_manager.inner_widget;var controller=viewmanager.active_view.controller;$(controller.groups).bind({'selected':function(e,ids){self.main_view_id=ids[0];}});});},on_create_view:function(){var self=this;this.create_view_dialog=new Dialog(this,{title:_.str.sprintf(_t("Create a view (%s)"),self.model),buttons:[{text:_t("Save"),click:function(){var view_values={};var warn=false;_.each(self.create_view_widget,function(widget){if(widget.is_invalid){warn=true;return false;}
if(widget.dirty&&!widget.is_invalid){view_values[widget.name]=widget.get_value();}});if(warn){self.on_valid_create_view(self.create_view_widget);}else{$.when(self.do_save_view(view_values)).done(function(){self.create_view_dialog.close();var controller=self.action_manager.inner_widget.views[self.action_manager.inner_widget.active_view].controller;controller.reload_content();});}}},{text:_t("Cancel"),click:function(){self.create_view_dialog.close();}}]}).open();var view_widget=[{'name':'view_name','string':'View Name','type':'char','required':true,'value':this.model+'.custom_'+Math.round(Math.random()*1000)},{'name':'view_type','string':'View Type','type':'selection','required':true,'value':'Form','selection':[['',''],['tree','Tree'],['form','Form'],['graph','Graph'],['calendar','Calender']]},{'name':'proirity','string':'Priority','type':'float','required':true,'value':'16'}];this.create_view_dialog.$el.append('<table id="create_view"  style="width:400px" class="oe_form"></table>');this.create_view_widget=[];_.each(view_widget,function(widget){var type_widget=new(self.property.get_any([widget.type]))(self.create_view_dialog,widget);self.create_view_dialog.$el.find('table[id=create_view]').append('<tr><td width="100px" align="right">'+widget.string+':</td>'+type_widget.render()+'</tr>');var value=null;if(widget.value){value=widget.value;type_widget.dirty=true;}
type_widget.start();type_widget.set_value(value);self.create_view_widget.push(type_widget);});},do_save_view:function(values){var def=$.Deferred();var field_dataset=new data.DataSetSearch(this,this.model,null,null);var model_dataset=new data.DataSetSearch(this,'ir.model',null,null);var view_string="",field_name=false,self=this;field_dataset.call('fields_get',[]).done(function(fields){_.each(['name','x_name'],function(value){if(_.include(_.keys(fields),value)){field_name=value;return false;}});if(field_name){model_dataset.read_slice(['name','field_id'],{"domain":[['model','=',self.model]]}).done(function(records){if(records){view_string=records[0].name;}
var arch=_.str.sprintf("<?xml version='1.0'?>\n<%s string='%s'>\n\t<field name='%s'/>\n</%s>",values.view_type,view_string,field_name,values.view_type);var vals={'model':self.model,'name':values.view_name,'priority':values.priority,'type':values.view_type,'arch':arch};def=self.dataset.create(vals);});}});return def.promise();},on_valid_create_view:function(widgets){var msg="<ul>";_.each(widgets,function(widget){if(widget.is_invalid){msg+="<li>"+widget.name+"</li>";}});msg+="</ul>";this.do_warn(_t("The following fields are invalid :"),msg);},add_node_name:function(node){if(node.tagName.toLowerCase()=="button"||node.tagName.toLowerCase()=="field"){return(node.getAttribute('name'))?_.str.sprintf("<%s name='%s'>",node.tagName.toLowerCase(),node.getAttribute('name')):_.str.sprintf("<%s>",node.tagName.toLowerCase());}else if(node.tagName.toLowerCase()=="group"){return(node.getAttribute('string'))?_.str.sprintf("<%s>",node.getAttribute('string')):_.str.sprintf("<%s>",node.tagName.toLowerCase());}else{return(node.getAttribute('string'))?_.str.sprintf("<%s string='%s'>",node.tagName.toLowerCase(),node.getAttribute('string')):_.str.sprintf("<%s>",node.tagName.toLowerCase());}},do_delete_view:function(){var self=this;if(confirm(_t("Do you really want to remove this view?"))){var controller=this.action_manager.inner_widget.views[this.action_manager.inner_widget.active_view.type].controller;this.dataset.unlink([this.main_view_id]).done(function(){controller.reload_content();self.main_view_id=self.parent.fields_view.view_id;});}},create_View_Node:function(node){var ViewNode={'level':($(node).parents()).length+1,'id':this.xml_element_id+=1,'att_list':[],'name':this.add_node_name(node),'child_id':[]};ViewNode.att_list.push(node.tagName.toLowerCase());_.each(node.attributes,function(att){ViewNode.att_list.push([att.nodeName,att.nodeValue]);});return ViewNode;},append_child_object:function(main_object,parent_id,child_obj_list){var self=this;if(main_object.id==parent_id){main_object.child_id=child_obj_list;return main_object;}else{_.each(main_object.child_id,function(child_object){self.append_child_object(child_object,parent_id,child_obj_list);});}},convert_arch_to_obj:function(xml_Node,main_object,parent_id){var self=this;var child_obj_list=[];_.each(xml_Node,function(element){child_obj_list.push(self.create_View_Node(element));});this.append_child_object(main_object,parent_id,child_obj_list);var obj_xml_list=_.zip(xml_Node,child_obj_list);_.each(obj_xml_list,function(node){var children=_.filter(node[0].childNodes,function(child){return child.nodeType==1;});if(children){self.convert_arch_to_obj(children,main_object,node[1].id);}});return main_object;},parse_xml:function(arch,view_id){var main_object={'level':0,'id':this.xml_element_id+=1,'att_list':["view"],'name':_.str.sprintf("<view view_id = %s>",view_id),'child_id':[]};var xml_arch=QWeb.load_xml(arch);return[this.convert_arch_to_obj(xml_arch.childNodes,main_object,this.xml_element_id)];},get_arch:function(){var self=this;var view_arch_list=[];this.dataset.read_ids([parseInt(self.main_view_id)],['arch','type','priority']).done(function(arch){if(arch.length){var arch_object=self.parse_xml(arch[0].arch,self.main_view_id);self.main_view_type=arch[0].type=='tree'?'list':arch[0].type;view_arch_list.push({"view_id":self.main_view_id,"arch":arch[0].arch,"priority":arch[0].priority});self.dataset.read_slice([],{domain:[['inherit_id','=',parseInt(self.main_view_id)]]}).done(function(result){_.each(result,function(res){view_arch_list.push({"view_id":res.id,"arch":res.arch,"priority":res.priority});self.inherit_view(arch_object,res);});return self.edit_view({"main_object":arch_object,"parent_child_id":self.parent_child_list(arch_object,[]),"arch":view_arch_list});});}else{self.do_warn(_t("Please select view in list :"));}});},parent_child_list:function(one_object,parent_list){var self=this;_.each(one_object,function(element){if(element.child_id.length!==0){parent_list.push({"key":element.id,"value":_.pluck(element.child_id,'id')});self.parent_child_list(element.child_id,parent_list);}});return parent_list;},inherit_view:function(arch_object,result){var self=this,xml_list=[],xml_arch=QWeb.load_xml(result.arch);if(xml_arch.childNodes[0].tagName=="data"){xml_list=_.filter(xml_arch.childNodes[0].childNodes,function(child){return child.nodeType==1;});}else{xml_list.push(xml_arch.childNodes[0]);}
_.each(xml_list,function(xml){var expr_to_list=[],xpath_arch_object=self.parse_xml(QWeb.tools.xml_node_to_string(xml),result.id);if(xml.tagName=="xpath"){var part_expr=_.without(xml.getAttribute('expr').split("/"),"");_.each(part_expr,function(part){expr_to_list.push(_.without($.trim(part.replace(/[^a-zA-Z 0-9 _]+/g,'!')).split("!"),""));});}else{var temp=_.reject(xpath_arch_object[0].child_id[0].att_list,function(list){return list instanceof Array?_.include(list,"position"):false;});expr_to_list=[_.flatten(temp)];}
self.inherit_apply(expr_to_list,arch_object,xpath_arch_object);});},inherit_apply:function(expr_list,arch_object,xpath_arch_object){var self=this;var temp_list;if(xpath_arch_object.length){var check=expr_list[0],obj=false;switch(check.length){case 2:if(parseInt(check[1])){temp_list=_.select(arch_object,function(element){return _.include(_.flatten(element.att_list),check[0]);});obj=arch_object[_.indexOf(arch_object,temp_list[parseInt(check[1])-1])];}else{obj=_.detect(arch_object,function(element){return _.include(_.flatten(element.att_list),check[0]);});}
break;case 3:obj=_.detect(arch_object,function(element){if((_.intersection(_.flatten(element.att_list),_.uniq(check))).length==_.uniq(check).length){return element;}});break;case 1:temp_list=_.select(arch_object,function(element){return _.include(_.flatten(element.att_list),check[0]);});if(temp_list.length!==0){expr_list.length===1?obj=temp_list[0]:expr_list.shift();}
break;}
if(obj){expr_list.shift();if(expr_list.length){self.inherit_apply(expr_list,obj.child_id,xpath_arch_object);}else{self.increase_level(xpath_arch_object[0],obj.level+1);obj.child_id.push(xpath_arch_object[0]);xpath_arch_object.pop();}}else{_.each(arch_object,function(element){self.inherit_apply(expr_list,element.child_id,xpath_arch_object);});}}},increase_level:function(val,level){var self=this;val.level=level;_.each(val.child_id,function(val){self.increase_level(val,level+1);});},do_select_row:function(row_id){this.edit_xml_dialog.$el.find("tr[id^='viewedit-']").removeClass('ui-selected');this.edit_xml_dialog.$el.find("tr[id=viewedit-"+row_id+"]").addClass('ui-selected');},do_parent_img_hide_show:function(img){if(_.str.include($(img).attr('src'),'/web/static/src/img/collapse.gif')){$(img).attr('src','/web/static/src/img/expand.gif');this.on_expand(img);}else{$(img).attr('src','/web/static/src/img/collapse.gif');this.on_collapse(img);}},edit_view:function(one_object){var self=this;this.one_object=one_object;this.edit_xml_dialog=new Dialog(this,{title:_.str.sprintf(_t("View Editor %d - %s"),self.main_view_id,self.model),buttons:[{text:_t("Inherited View"),click:function(){var selected_row=self.edit_xml_dialog.$el.find('.ui-selected');if(selected_row.length){if(selected_row.find('a').text().search("field")!=-1){if(confirm(_t("Do you really wants to create an inherited view here?"))){self.inherited_view(selected_row);}}else{alert(_t("Can't Update View"));}}else{alert(_t("Select an element"));}}},{text:_t("Preview"),click:function(){var action={context:self.session.user_context,res_model:self.model,views:[[self.main_view_id,self.main_view_type]],type:'ir.actions.act_window',target:"new",auto_search:true,flags:{sidebar:false,views_switcher:false,action_buttons:false}};var action_manager=new ActionManager(self);action_manager.do_action(action);}},{text:_t("Close"),click:function(){self.action_manager.inner_widget.active_view.controller.reload_content();self.edit_xml_dialog.close();}}]}).open();var no_property_att=[];_.each(_PROPERTIES,function(val,key){if(!val.length)no_property_att.push(key);});this.edit_xml_dialog.$el.html(QWeb.render('view_editor',{'data':one_object.main_object,'no_properties':no_property_att}));this.edit_xml_dialog.$el.find("tr[id^='viewedit-']").click(function(){self.do_select_row(this.id.split('-')[1]);});this.edit_xml_dialog.$el.find("img[id^='parentimg-']").click(function(){self.do_parent_img_hide_show(this);});this.edit_xml_dialog.$el.find("img[id^='side-']").click(function(){self.on_select_img(this);});},inherited_view:function(selected_row){var self=this;var row_id=parseInt((selected_row.attr('id')).split('-')[1]);var obj=self.get_object_by_id(row_id,self.one_object.main_object,[])[0];var view_name=this.model+'.inherit_'+Math.round(Math.random()*1000);var view_find=selected_row;var view_id;var min_level=parseInt(selected_row.attr('level'));while(1){view_find=view_find.prev();if(view_find.length===0||self.edit_xml_dialog.$el.find(view_find).find('a').text().search("view_id")!=-1&&parseInt(view_find.attr('level'))<min_level){view_id=parseInt($(view_find).find('a').text().replace(/[^0-9]+/g,''));break;}
if(view_find.attr('level')<min_level){min_level=parseInt(view_find.attr('level'));}}
var val=_.detect(obj.att_list,function(val){return val[0]=="name";});var priority=_.detect(self.one_object.arch,function(val){return val.view_id===view_id;});var arch=_.str.sprintf("<?xml version='1.0'?>\n\t <field name='%s' position='after'> </field>",val[1]);var vals={'model':self.model,'name':view_name,'priority':priority.priority+1,'type':"form",'arch':arch,'inherit_id':self.main_view_id};this.dataset.create(vals).done(function(id){var arch_to_obj=self.parse_xml(arch,id);obj.child_id.push(arch_to_obj[0]);self.one_object.parent_child_id=self.parent_child_list(self.one_object.main_object,[]);self.one_object.arch.push({'view_id':id,"arch":arch,'priority':priority.priority+1});self.increase_level(arch_to_obj[0],obj.level+1);self.render_inherited_view(selected_row,arch_to_obj[0]);});},render_inherited_view:function(selected_row,obj){var self=this,row_id=parseInt((selected_row.attr('id')).split('-')[1]);var clone=this.create_clone(selected_row.clone(),obj);if(selected_row.find("img[id^='parentimg-']").length===0){($(selected_row.find('a').parent()).siblings('td')).append($('<img width="16" height="16"></img>').attr('src','/web/static/src/img/collapse.gif').attr('id','parentimg-'+row_id).click(function(){self.do_parent_img_hide_show(this);}));}
self.edit_xml_dialog.$el.find("tr[id='viewedit-"+row_id+"']").after(clone.removeClass('ui-selected'));_.each(obj.child_id,function(obj){self.render_inherited_view(clone,obj);});},on_select_img:function(element_img){var self=this;var side=$(element_img).closest("tr[id^='viewedit-']");this.one_object.clicked_tr_id=parseInt((side.attr('id')).split('-')[1]);this.one_object.clicked_tr_level=parseInt(side.attr('level'));var img=side.find("img[id='parentimg-"+this.one_object.clicked_tr_id+"']").attr('src');var view_id=0,view_xml_id=0,view_find=side;var min_level=this.one_object.clicked_tr_id;if(($(side).find('a').text()).search("view_id")!=-1){view_id=parseInt(($(view_find).find('a').text()).replace(/[^0-9]+/g,''));view_xml_id=(view_find.attr('id')).split('-')[1];this.one_object.clicked_tr_id+=1;this.one_object.clicked_tr_level+=1;}else{while(1){view_find=view_find.prev();if(view_find.length===0||(self.edit_xml_dialog.$el.find(view_find).find('a').text()).search("view_id")!==-1&&parseInt(view_find.attr('level'))<min_level){view_id=parseInt(($(view_find).find('a').text()).replace(/[^0-9]+/g,''));view_xml_id=parseInt((view_find.attr('id')).split('-')[1]);break;}
if(view_find.attr('level')<min_level){min_level=parseInt(view_find.attr('level'));}}}
this.one_object.clicked_tr_view=[view_id,view_xml_id];switch(element_img.id){case"side-add":self.do_node_add(side);break;case"side-remove":if(confirm(_t("Do you really want to remove this node?"))){self.do_save_update_arch("remove_node");}
break;case"side-edit":self.do_node_edit(side);break;case"side-up":self.do_node_up(side,img);break;case"side-down":self.do_node_down(side,img);break;}},do_node_add:function(side){var self=this;var property_to_check=[];var tr=self.get_object_by_id(this.one_object.clicked_tr_id,this.one_object.main_object,[])[0].att_list[0];var parent_tr=($(side).prevAll("tr[level="+String(this.one_object.clicked_tr_level-1)+"]"))[0];var field_dataset=new data.DataSetSearch(this,this.model,null,null);if(_.isUndefined(parent_tr))
return;parent_tr=self.get_object_by_id(parseInt($(parent_tr).attr('id').replace(/[^0-9]+/g,'')),this.one_object.main_object,[])[0].att_list[0];_.each([tr,parent_tr],function(element){var value=_.has(_CHILDREN,element)?element:_.str.include(html_tag,element)?"html_tag":(element=='xpath')?element:false;property_to_check.push(value);});field_dataset.call('fields_get',[]).done(function(result){var fields=_.keys(result);fields.push(" ");fields.sort();self.on_add_node(property_to_check,fields,self.inject_position(parent_tr,tr));});},inject_position:function(parent_tag,current_tag){if(parent_tag=="view")
return['Inside'];if(current_tag=="field")
return['After','Before'];return['Inside','After','Before'];},do_node_edit:function(){var self=this;var result=self.get_object_by_id(this.one_object.clicked_tr_id,this.one_object.main_object,[]);if(result.length&&result[0]&&result[0].att_list){var properties=_PROPERTIES[result[0].att_list[0]];self.on_edit_node(properties);}},do_node_down:function(cur_tr,img){var self=this;var next_tr,last_tr,tr_to_move=[];tr_to_move.push(cur_tr);if(img){while(1){next_tr=cur_tr.next();if(parseInt(next_tr.attr('level'))<=this.one_object.clicked_tr_level||next_tr.length===0){last_tr=next_tr;break;}else{tr_to_move.push(next_tr);cur_tr=next_tr;}}}else{last_tr=cur_tr.next();}
if((self.edit_xml_dialog.$el.find(last_tr).find('a').text()).search("view_id")!=-1){return false;}
if(last_tr.length!==0&&parseInt(last_tr.attr('level'))==this.one_object.clicked_tr_level){var last_tr_id=(last_tr.attr('id')).split('-')[1];img=last_tr.find("img[id='parentimg-"+last_tr_id+"']").attr('src');if(img){self.edit_xml_dialog.$el.find("img[id='parentimg-"+last_tr_id+"']").attr('src','/web/static/src/img/expand.gif');while(1){next_tr=last_tr.next();if(next_tr.attr('level')<=this.one_object.clicked_tr_level||next_tr.length===0)break;next_tr.hide();last_tr=next_tr;}}
tr_to_move.reverse();_.each(tr_to_move,function(rec){$(last_tr).after(rec);});self.do_save_update_arch("down");}},do_node_up:function(cur_tr,img){var self=this;var side=cur_tr;var tr_to_move=[];var last_tr;var next_tr;tr_to_move.push(side);while(1){var prev_tr=cur_tr.prev();if(this.one_object.clicked_tr_level>=parseInt(prev_tr.attr('level'))||prev_tr.length===0){last_tr=prev_tr;break;}
cur_tr=prev_tr;}
if(img){self.edit_xml_dialog.$el.find("img[id='parentimg-"+this.one_object.clicked_tr_id+"']").attr('src','/web/static/src/img/expand.gif');while(1){next_tr=side.next();if(parseInt(next_tr.attr('level'))<=this.one_object.clicked_tr_level||next_tr.length===0){break;}else{next_tr.hide();tr_to_move.push(next_tr);side=next_tr;}}}
if(last_tr.length!==0&&parseInt(last_tr.attr('level'))==this.one_object.clicked_tr_level&&(self.edit_xml_dialog.$el.find(last_tr).find('a').text()).search("view_id")===-1){_.each(tr_to_move,function(rec){$(last_tr).before(rec);});self.do_save_update_arch("up");}},do_save_update_arch:function(move_direct,update_values){var self=this;var arch=_.detect(self.one_object.arch,function(element)
{return element.view_id===self.one_object.clicked_tr_view[0];});var obj=self.get_object_by_id(this.one_object.clicked_tr_view[1],this.one_object.main_object,[]);var xml_arch=QWeb.load_xml(arch.arch);if(xml_arch.childNodes[0].tagName=="data"){var check_list=_.flatten(obj[0].child_id[0].att_list);var children=_.filter(xml_arch.childNodes[0].childNodes,function(child){return child.nodeType==1;});var inherited_view=_.detect(children,function(xml_child){var temp_obj=self.create_View_Node(xml_child),insert=_.intersection(_.flatten(temp_obj.att_list),_.uniq(check_list));if(insert.length==_.uniq(check_list).length){return xml_child;}});xml_arch=QWeb.load_xml(utils.xml_to_str(inherited_view));}
return self.do_save_xml(xml_arch.documentElement,obj[0].child_id[0],obj[0].child_id,move_direct,update_values,arch);},get_object_by_id:function(id,one_object,result){var self=this;if(result.length===0){var check=_.detect(one_object,function(obj){return id===obj.id;});if(check){result.push(check);}
_.each(one_object,function(obj){self.get_object_by_id(id,obj.child_id,result);});}
return result;},create_clone:function(clone,new_node_obj){var self=this;clone.find('a').text(new_node_obj.name);($(clone.find('a').parent()).siblings('td')).css("padding-left",20*new_node_obj.level);clone.attr("id","viewedit-"+new_node_obj.id);clone.attr("level",new_node_obj.level);clone.find("img[id^='parentimg-']").remove();clone.bind("click",function(){self.do_select_row(this.id.split('-')[1]);});clone.find("img[id^='side-']").click(function(){self.on_select_img(this);});return clone;},do_save_xml:function(arch1,obj,child_list,move_direct,update_values,arch){var self=this;var children_list=$(arch1).children();var list_obj_xml;var re_insert_obj;try{list_obj_xml=_.zip(children_list,obj.child_id);}catch(err){return;}
if(this.one_object.clicked_tr_id){if(obj.id==this.one_object.clicked_tr_id){var parent=false,index=_.indexOf(child_list,obj);if(move_direct=="down"){var next=$(arch1).next();$(next).after(arch1);re_insert_obj=child_list.splice(index,1);child_list.splice(index+1,0,re_insert_obj[0]);parent=$(arch1).parents();}else if(move_direct=="up"){var prev=$(arch1).prev();$(prev).before(arch1);re_insert_obj=child_list.splice(index,1);child_list.splice(index-1,0,re_insert_obj[0]);parent=$(arch1).parents();}else if(move_direct=="update_node"){_.each(update_values,function(val){if(val[1])$(arch1)[0].setAttribute(val[0],val[1]);else $(arch1)[0].removeAttribute(val[0]);});var new_obj=self.create_View_Node(arch1);new_obj.id=obj.id,new_obj.child_id=obj.child_id;self.edit_xml_dialog.$el.find("tr[id='viewedit-"+this.one_object.clicked_tr_id+"']").find('a').text(new_obj.name);child_list.splice(index,1,new_obj);parent=$(arch1).parents();}else if(move_direct=="add_node"){var tr_click=self.edit_xml_dialog.$el.find("tr[id='viewedit-"+self.one_object.clicked_tr_id+"']"),temp_xml=QWeb.load_xml(update_values[0]),object_xml=self.create_View_Node(temp_xml.childNodes[0]);(update_values[1]=="Inside")?object_xml.level=obj.level+1:object_xml.level=obj.level;var clone=self.create_clone(tr_click.clone(),object_xml),after_append=_.detect(self.one_object.parent_child_id,function(ele){return self.one_object.clicked_tr_id==ele.key;});after_append=(after_append)?_.last(after_append.value):self.one_object.clicked_tr_id;switch(update_values[1]){case"After":self.edit_xml_dialog.$el.find("tr[id='viewedit-"+after_append+"']").after(clone);$(arch1).after($(update_values[0]));child_list.splice(index+1,0,object_xml);break;case"Before":tr_click.before(clone);$(arch1).before($(update_values[0]));child_list.splice(index-1,0,object_xml);break;case"Inside":if(tr_click.find("img[id^='parentimg-']").length===0){($(tr_click.find('a').parent()).siblings('td')).append($('<img width="16" height="16"></img>').attr('src','/web/static/src/img/collapse.gif').attr('id','parentimg-'+self.one_object.clicked_tr_id).click(function(){self.do_parent_img_hide_show(this);}));}
$(arch1).append($(update_values[0]));self.edit_xml_dialog.$el.find("tr[id='viewedit-"+after_append+"']").after(clone);obj.child_id.push(object_xml);break;}
self.edit_xml_dialog.$el.find("tr[id='viewedit-"+object_xml.id+"']").removeClass('ui-selected');parent=$(arch1).parents();}else if(move_direct=="remove_node"){parent=$(arch1).parents();if(parent.length===0||(parent[0].tagName.toLowerCase()=="data")){self.one_object.clicked_tr_id=self.one_object.clicked_tr_id-1;self.one_object.clicked_tr_level=self.one_object.clicked_tr_level-1;(parent.length===0)?parent.push("remove_view"):false;}
$(arch1).remove();child_list.splice(index,1);var cur_tr=self.edit_xml_dialog.$el.find("tr[id='viewedit-"+self.one_object.clicked_tr_id+"']");_.each(self.get_list_tr(cur_tr,self.one_object.clicked_tr_level),function(tr_element){tr_element.remove();});cur_tr.remove();var parent_img=_.detect(self.one_object.parent_child_id,function(element){return _.include(element.value,self.one_object.clicked_tr_id);});if(parent_img.value.length==1){self.edit_xml_dialog.$el.find("tr[id='viewedit-"+parent_img.key+"']").find("img[id^='parentimg-']").remove();}
self.one_object.parent_child_id=self.parent_child_list(self.one_object.main_object,[]);}
var convert_to_utf=(parent.length!==0)?parent[parent.length-1]:arch1;if(convert_to_utf!="remove_view"){convert_to_utf=QWeb.tools.xml_node_to_string(convert_to_utf);convert_to_utf=convert_to_utf.replace('xmlns="http://www.w3.org/1999/xhtml"',"");convert_to_utf='<?xml version="1.0"?>'+convert_to_utf;arch.arch=convert_to_utf;this.dataset.write(this.one_object.clicked_tr_view[0],{"arch":convert_to_utf});}else{this.dataset.unlink([this.one_object.clicked_tr_view[0]]);}
if(move_direct==="add_node"){self.add_node_dialog.close();self.on_select_img(clone.find("img[id='side-edit']")[0]);self.one_object.parent_child_id=self.parent_child_list(self.one_object.main_object,[]);}}
if(obj.level<=this.one_object.clicked_tr_level){_.each(list_obj_xml,function(child_node){self.do_save_xml(child_node[0],child_node[1],obj.child_id,move_direct,update_values,arch);});}}},on_expand:function(expand_img){var level=parseInt($(expand_img).closest("tr[id^='viewedit-']").attr('level'));var cur_tr=$(expand_img).closest("tr[id^='viewedit-']");_.each(this.get_list_tr(cur_tr,level),function(tr_element){tr_element.hide();});},get_list_tr:function(cur_tr,level){var tr_list=[];while(1){var nxt_tr=cur_tr.next();if(parseInt(nxt_tr.attr('level'))>level){cur_tr=nxt_tr;tr_list.push(nxt_tr);}else return tr_list;}},on_collapse:function(collapse_img){var self=this,id=collapse_img.id.split('-')[1];var datas=_.detect(self.one_object.parent_child_id,function(res){return res.key==id;});_.each(datas.value,function(rec){var tr=self.edit_xml_dialog.$el.find("tr[id='viewedit-"+rec+"']");tr.find("img[id='parentimg-"+rec+"']").attr('src','/web/static/src/img/expand.gif');tr.show();});},on_edit_node:function(properties){var self=this;this.edit_node_dialog=new Dialog(this,{title:_t("Properties"),size:'medium',buttons:[{text:_t("Update"),click:function(){var warn=false,update_values=[];_.each(self.edit_widget,function(widget){if(widget.is_invalid){warn=true;return false;}
if(widget.dirty&&!widget.is_invalid){update_values.push([widget.name,widget.get_value()]);}});if(warn){self.on_valid_create_view(self.edit_widget);}else{self.do_save_update_arch("update_node",update_values);self.edit_node_dialog.close();}}},{text:_t("Cancel"),click:function(){self.edit_node_dialog.close();}}]}).open();var _PROPERTIES_ATTRIBUTES={'name':{'name':'name','string':'Name','type':'char'},'string':{'name':'string','string':'String','type':'char'},'required':{'name':'required','string':'Required','type':'boolean'},'readonly':{'name':'readonly','string':'Readonly','type':'boolean'},'invisible':{'name':'invisible','string':'Invisible','type':'boolean'},'domain':{'name':'domain','string':'Domain','type':'char'},'context':{'name':'context','string':'Context','type':'char'},'limit':{'name':'limit','string':'Limit','type':'float'},'min_rows':{'name':'min_rows','string':'Minimum rows','type':'float'},'date_start':{'name':'date_start','string':'Start date','type':'char'},'date_delay':{'name':'date_delay','string':'Delay date','type':'char'},'day_length':{'name':'day_length','string':'Day length','type':'char'},'mode':{'name':'mode','string':'Mode','type':'char'},'align':{'name':'align','string':'Alignment ','type':'selection','selection':[['',''],['0.0','Left'],['0.5','Center'],['1.0','Right']]},'icon':{'name':'icon','string':'Icon','type':'selection','selection':_ICONS},'type':{'name':'type','string':'Type','type':'selection','selection':[['',''],['action','Action'],['object','Object'],['workflow','Workflow'],['server_action','Server Action']]},'special':{'name':'special','string':'Special','type':'selection','selection':[['',''],['save','Save Button'],['cancel','Cancel Button'],['open','Open Button']]},'target':{'name':'target','string':'Target','type':'selection','selection':[['',''],['new','New Window']]},'confirm':{'name':'confirm','string':'Confirm','type':'char'},'style':{'name':'style','string':'Style','type':'selection','selection':[["",""],["1","1"],["1-1","1-1"],["1-2","1-2"],["2-1","2-1"],["1-1-1","1-1-1"]]},'filename':{'name':'filename','string':'File Name','type':'char'},'width':{'name':'width','string':'Width','type':'float'},'height':{'name':'height','string':'Height','type':'float'},'attrs':{'name':'attrs','string':'Attrs','type':'char'},'col':{'name':'col','string':'col','type':'float'},'link':{'name':'link','string':'Link','type':'char'},'position':{'name':'position','string':'Position','type':'selection','selection':[['',''],['after','After'],['before','Before'],['inside','Inside'],['replace','Replace']]},'states':{'name':'states','string':'states','type':'char'},'eval':{'name':'eval','string':'Eval','type':'char'},'ref':{'name':'ref','string':'Ref','type':'char'},'on_change':{'name':'on_change','string':'On change','type':'char'},'nolabel':{'name':'nolabel','string':'No label','type':'boolean'},'completion':{'name':'completion','string':'Completion','type':'boolean'},'colspan':{'name':'colspan','string':'Colspan','type':'float'},'widget':{'name':'widget','string':'widget','type':'selection'},'colors':{'name':'colors','string':'Colors','type':'char'},'editable':{'name':'editable','string':'Editable','type':'selection','selection':[["",""],["top","Top"],["bottom","Bottom"]]},'groups':{'name':'groups','string':'Groups','type':'selection_multi'},'fonts':{'name':'fonts','string':'fonts','type':'char'},};var arch_val=self.get_object_by_id(this.one_object.clicked_tr_id,this.one_object.main_object,[]);this.edit_node_dialog.$el.append('<table id="rec_table"  style="width:400px" class="oe_form"></table>');this.edit_widget=[];self.ready=$.when(self.on_groups(properties)).done(function(){_PROPERTIES_ATTRIBUTES.groups.selection=self.groups;var values=_.keys(core.form_widget_registry.map);values.push('');values.sort();_PROPERTIES_ATTRIBUTES.widget.selection=values;var widgets=_.filter(_PROPERTIES_ATTRIBUTES,function(property){return _.include(properties,property.name);});_.each(widgets,function(widget){var type_widget=new(self.property.get_any([widget.type]))(self.edit_node_dialog,widget);var value=_.detect(arch_val[0].att_list,function(res){return res instanceof Array?_.include(res,widget.name):false;});value=value instanceof Array?value[1]:value;self.edit_node_dialog.$el.find('table[id=rec_table]').append('<tr><td align="right">'+widget.string+':</td>'+type_widget.render()+'</tr>');type_widget.start();type_widget.set_value(value);self.edit_widget.push(type_widget);});});},on_groups:function(properties){var self=this,def=$.Deferred();if(!_.include(properties,'groups')){self.groups=false;def.resolve();}
var group_ids=[],group_names={},groups=[];var res_groups=new data.DataSetSearch(this,'res.groups',null,null),model_data=new data.DataSetSearch(self,'ir.model.data',null,null);res_groups.read_slice([],{}).done(function(res_grp){_.each(res_grp,function(res){var key=res.id;group_names[key]=res.full_name;group_ids.push(res.id);});model_data.read_slice([],{domain:[['res_id','in',group_ids],['model','=','res.groups']]}).done(function(model_grp){_.each(model_grp,function(res_group){groups.push([res_group.module+"."+res_group.name,group_names[res_group.res_id]]);});self.groups=groups;def.resolve();});});return def.promise();},on_add_node:function(properties,fields,position){var self=this;var render_list=[{'name':'node_type','selection':_.keys(_CHILDREN).sort(),'value':'field','string':'Node Type','type':'selection'},{'name':'field_value','selection':fields,'value':false,'string':'','type':'selection'},{'name':'position','selection':position,'value':false,'string':'Position','type':'selection'}];this.add_widget=[];this.add_node_dialog=new Dialog(this,{title:_t("Properties"),size:'medium',buttons:[{text:_t("Update"),click:function(){var check_add_node=true,values={};_.each(self.add_widget,function(widget){values[widget.name]=widget.get_value()||false;});check_add_node=(values.position=="Inside")?(_.include(_CHILDREN[properties[0]],values.node_type)||properties[0]=='xpath')?true:false:(_.include(_CHILDREN[properties[1]],values.node_type)||properties[1]=='xpath')?true:false;if(values.node_type=="field"&&check_add_node)
{check_add_node=(values.field_value!=" ")?true:false;}
if(check_add_node){var tag=(values.node_type=="field")?_.str.sprintf("<%s name='%s'> </%s>",values.node_type,values.field_value,values.node_type):_.str.sprintf("<%s> </%s>",values.node_type,values.node_type);self.do_save_update_arch("add_node",[tag,values.position]);}else{alert("Can't Update View");}}},{text:_t("Cancel"),click:function(){self.add_node_dialog.close();}}]}).open();this.add_node_dialog.$el.append('<table id="rec_table"  style="width:420px" class="oe_form"><tbody><tr></tbody></table>');var table_selector=self.add_node_dialog.$el.find('table[id=rec_table] tbody');_.each(render_list,function(node){var type_widget=new(self.property.get_any([node.type]))(self.add_node_dialog,node);if(node.name=="position"){table_selector.append('</tr><tr><td align="right" width="100px">'+node.string+'</td>'+type_widget.render()+'</tr>');}else{table_selector.append('<td align="right">'+node.string+'</td>'+type_widget.render());if(node.name=="field_value"){table_selector.append('<td id="new_field" align="right"  width="100px"> <button>'+_.str.escapeHTML(_t("New Field"))+'</button></td>');}}
type_widget.start();type_widget.set_value(node.value);self.add_widget.push(type_widget);});table_selector.find("td[id^='']").attr("width","100px");self.add_node_dialog.$el.find('#new_field').click(function(){var model_data=new data.DataSetSearch(self,'ir.model',null,null);model_data.read_slice([],{domain:[['model','=',self.model]]}).done(function(result){self.render_new_field(result[0]);});});},render_new_field:function(result){var self=this;var action={context:{'default_model_id':result.id,'module':result.model},res_model:"ir.model.fields",views:[[false,'form']],type:'ir.actions.act_window',target:"new",flags:{action_buttons:true}};var action_manager=new ActionManager(self);$.when(action_manager.do_action(action)).done(function(){var controller=action_manager.dialog_widget.views.form.controller;controller.on("on_button_cancel",self,function(){action_manager.destroy();});controller.on("save",self,function(){action_manager.destroy();var value=controller.fields.name.get('value');self.add_node_dialog.$el.find('select[id=field_value]').append($("<option selected></option>").attr("value",value).text(value));_.detect(self.add_widget,function(widget){widget.name==="field_value"?widget.selection.push(value):false;});});});}});ViewEditor.Field=core.Class.extend({init:function(view,widget){this.$el=view.$el;this.dirty=false;this.name=widget.name;this.selection=widget.selection||[];this.required=widget.required||false;this.string=widget.string||"";this.type=widget.type;this.is_invalid=false;},start:function(){this.update_dom();},update_dom:function(){this.$el.find("td[id="+this.name+"]").toggleClass('invalid',this.is_invalid);this.$el.find("td[id="+this.name+"]").toggleClass('required',this.required);},on_ui_change:function(){this.validate();this.dirty=true;this.update_dom();},validate:function(){this.is_invalid=false;try{var value=formats.parse_value(this.get_value(),this,'');this.is_invalid=this.required&&value==='';}catch(e){this.is_invalid=true;}},render:function(){return _.str.sprintf("<td id = %s>%s</td>",this.name,QWeb.render(this.template,{widget:this}));}});ViewEditor.FieldBoolean=ViewEditor.Field.extend({template:"vieweditor_boolean",start:function(){var self=this;this._super();this.$el.find("input[id="+self.name+"]").change(function(){self.on_ui_change();});},set_value:function(value){if(value){this.$el.find("input[id="+this.name+"]").attr('checked',true);}},get_value:function(){return this.$el.find("input[id="+this.name+"]").is(':checked')?"1":null;}});ViewEditor.FieldChar=ViewEditor.Field.extend({template:"vieweditor_char",start:function(){var self=this;this._super();this.$el.find("input[id="+this.name+"]").css('width','100%').change(function(){self.on_ui_change();});},set_value:function(value){this.$el.find("input[id="+this.name+"]").val(value);},get_value:function(){return this.$el.find("input[id="+this.name+"]").val();}});ViewEditor.FieldSelect=ViewEditor.Field.extend({template:"vieweditor_selection",start:function(){var self=this;this._super();this.$el.find("select[id="+this.name+"]").css('width','100%').change(function(){self.on_ui_change();if(self.name=="node_type"){if(self.get_value()=="field"){self.$el.find('#new_field').show();self.$el.find("select[id=field_value]").show();}else{self.$el.find('#new_field').hide();self.$el.find("select[id=field_value]").hide();}}});},set_value:function(value){var index=0;value=value===null?false:value;for(var i=0,ii=this.selection.length;i<ii;i++){if((this.selection[i]instanceof Array&&this.selection[i][0]===value)||this.selection[i]===value)index=i;}
this.$el.find("select[id="+this.name+"]")[0].selectedIndex=index;},get_value:function(){return this.$el.find("select[id="+this.name+"]").val();}});ViewEditor.FieldSelectMulti=ViewEditor.FieldSelect.extend({start:function(){this._super();this.$el.find("select[id="+this.name+"]").css('height','100px').attr("multiple",true);},set_value:function(value){var self=this;self.$el.find("#groups option").attr("selected",false);if(!value)return false;_.each(this.selection,function(item){if(_.include(value.split(','),item[0])){self.$el.find("select[id="+self.name+"] option[value='"+item[0]+"']").attr("selected",1);}});}});ViewEditor.FieldFloat=ViewEditor.FieldChar.extend({});var _PROPERTIES={'field':['name','string','required','readonly','invisible','domain','context','nolabel','completion','colspan','widget','eval','ref','on_change','attrs','groups'],'form':['string','col','link'],'notebook':['colspan','position','groups'],'page':['string','states','attrs','groups'],'group':['string','col','colspan','invisible','states','attrs','groups'],'image':['filename','width','height','groups'],'separator':['string','colspan','groups'],'label':['string','align','colspan','groups'],'button':['name','string','icon','type','states','readonly','special','target','confirm','context','attrs','colspan','groups'],'newline':[],'board':['style'],'column':[],'action':['name','string','colspan','groups'],'tree':['string','colors','editable','link','limit','min_rows','fonts'],'graph':['string','type'],'calendar':['string','date_start','date_stop','date_delay','day_length','color','mode']};var _CHILDREN={'form':['notebook','group','field','label','button','board','newline','separator'],'tree':['field'],'graph':['field'],'calendar':['field'],'notebook':['page'],'page':['notebook','group','field','label','button','newline','separator'],'group':['field','label','button','separator','newline','group'],'board':['column'],'action':[],'field':['form','tree','graph','field'],'label':[],'button':[],'newline':[],'separator':[],'sheet':['group','field','notebook','label','separator','div','page'],'kanban':['field'],'html_tag':['notebook','group','field','label','button','board','newline','separator']};var html_tag=['div','h1','h2','h3','h4','h5','h6','td','tr'];var _ICONS=['','STOCK_ABOUT','STOCK_ADD','STOCK_APPLY','STOCK_BOLD','STOCK_CANCEL','STOCK_CDROM','STOCK_CLEAR','STOCK_CLOSE','STOCK_COLOR_PICKER','STOCK_CONNECT','STOCK_CONVERT','STOCK_COPY','STOCK_CUT','STOCK_DELETE','STOCK_DIALOG_AUTHENTICATION','STOCK_DIALOG_ERROR','STOCK_DIALOG_INFO','STOCK_DIALOG_QUESTION','STOCK_DIALOG_WARNING','STOCK_DIRECTORY','STOCK_DISCONNECT','STOCK_DND','STOCK_DND_MULTIPLE','STOCK_EDIT','STOCK_EXECUTE','STOCK_FILE','STOCK_FIND','STOCK_FIND_AND_REPLACE','STOCK_FLOPPY','STOCK_GOTO_BOTTOM','STOCK_GOTO_FIRST','STOCK_GOTO_LAST','STOCK_GOTO_TOP','STOCK_GO_BACK','STOCK_GO_DOWN','STOCK_GO_FORWARD','STOCK_GO_UP','STOCK_HARDDISK','STOCK_HELP','STOCK_HOME','STOCK_INDENT','STOCK_INDEX','STOCK_ITALIC','STOCK_JUMP_TO','STOCK_JUSTIFY_CENTER','STOCK_JUSTIFY_FILL','STOCK_JUSTIFY_LEFT','STOCK_JUSTIFY_RIGHT','STOCK_MEDIA_FORWARD','STOCK_MEDIA_NEXT','STOCK_MEDIA_PAUSE','STOCK_MEDIA_PLAY','STOCK_MEDIA_PREVIOUS','STOCK_MEDIA_RECORD','STOCK_MEDIA_REWIND','STOCK_MEDIA_STOP','STOCK_MISSING_IMAGE','STOCK_NETWORK','STOCK_NEW','STOCK_NO','STOCK_OK','STOCK_OPEN','STOCK_PASTE','STOCK_PREFERENCES','STOCK_PRINT','STOCK_PRINT_PREVIEW','STOCK_PROPERTIES','STOCK_QUIT','STOCK_REDO','STOCK_REFRESH','STOCK_REMOVE','STOCK_REVERT_TO_SAVED','STOCK_SAVE','STOCK_SAVE_AS','STOCK_SELECT_COLOR','STOCK_SELECT_FONT','STOCK_SORT_ASCENDING','STOCK_SORT_DESCENDING','STOCK_SPELL_CHECK','STOCK_STOP','STOCK_STRIKETHROUGH','STOCK_UNDELETE','STOCK_UNDERLINE','STOCK_UNDO','STOCK_UNINDENT','STOCK_YES','STOCK_ZOOM_100','STOCK_ZOOM_FIT','STOCK_ZOOM_IN','STOCK_ZOOM_OUT','terp-account','terp-crm','terp-mrp','terp-product','terp-purchase','terp-sale','terp-tools','terp-administration','terp-hr','terp-partner','terp-project','terp-report','terp-stock','terp-calendar','terp-graph'];ViewEditor.property_widget=new Registry({'boolean':ViewEditor.FieldBoolean,'selection_multi':ViewEditor.FieldSelectMulti,'selection':ViewEditor.FieldSelect,'char':ViewEditor.FieldChar,'float':ViewEditor.FieldFloat});return ViewEditor;});